import{$ as I,k as J,m as $}from"./main-B2XpWmPF.js";class v{constructor(s){this.counter=0,this.metadataRegistry=s?.metadata??J,this.target=s?.target??"draft-2020-12",this.unrepresentable=s?.unrepresentable??"throw",this.override=s?.override??(()=>{}),this.io=s?.io??"output",this.seen=new Map}process(s,c={path:[],schemaPath:[]}){var r;const t=s._zod.def,p={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},l=this.seen.get(s);if(l)return l.count++,c.schemaPath.includes(s)&&(l.cycle=c.path),l.schema;const f={schema:{},count:1,cycle:void 0,path:c.path};this.seen.set(s,f);const g=s._zod.toJSONSchema?.();if(g)f.schema=g;else{const i={...c,schemaPath:[...c.schemaPath,s],path:c.path},w=s._zod.parent;if(w)f.ref=w,this.process(w,i),this.seen.get(w).isParent=!0;else{const u=f.schema;switch(t.type){case"string":{const e=u;e.type="string";const{minimum:o,maximum:a,format:m,patterns:d,contentEncoding:b}=s._zod.bag;if(typeof o=="number"&&(e.minLength=o),typeof a=="number"&&(e.maxLength=a),m&&(e.format=p[m]??m,e.format===""&&delete e.format),b&&(e.contentEncoding=b),d&&d.size>0){const S=[...d];S.length===1?e.pattern=S[0].source:S.length>1&&(f.schema.allOf=[...S.map(x=>({...this.target==="draft-7"||this.target==="draft-4"||this.target==="openapi-3.0"?{type:"string"}:{},pattern:x.source}))])}break}case"number":{const e=u,{minimum:o,maximum:a,format:m,multipleOf:d,exclusiveMaximum:b,exclusiveMinimum:S}=s._zod.bag;typeof m=="string"&&m.includes("int")?e.type="integer":e.type="number",typeof S=="number"&&(this.target==="draft-4"||this.target==="openapi-3.0"?(e.minimum=S,e.exclusiveMinimum=!0):e.exclusiveMinimum=S),typeof o=="number"&&(e.minimum=o,typeof S=="number"&&this.target!=="draft-4"&&(S>=o?delete e.minimum:delete e.exclusiveMinimum)),typeof b=="number"&&(this.target==="draft-4"||this.target==="openapi-3.0"?(e.maximum=b,e.exclusiveMaximum=!0):e.exclusiveMaximum=b),typeof a=="number"&&(e.maximum=a,typeof b=="number"&&this.target!=="draft-4"&&(b<=a?delete e.maximum:delete e.exclusiveMaximum)),typeof d=="number"&&(e.multipleOf=d);break}case"boolean":{const e=u;e.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{this.target==="openapi-3.0"?(u.type="string",u.nullable=!0,u.enum=[null]):u.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{u.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const e=u,{minimum:o,maximum:a}=s._zod.bag;typeof o=="number"&&(e.minItems=o),typeof a=="number"&&(e.maxItems=a),e.type="array",e.items=this.process(t.element,{...i,path:[...i.path,"items"]});break}case"object":{const e=u;e.type="object",e.properties={};const o=t.shape;for(const d in o)e.properties[d]=this.process(o[d],{...i,path:[...i.path,"properties",d]});const a=new Set(Object.keys(o)),m=new Set([...a].filter(d=>{const b=t.shape[d]._zod;return this.io==="input"?b.optin===void 0:b.optout===void 0}));m.size>0&&(e.required=Array.from(m)),t.catchall?._zod.def.type==="never"?e.additionalProperties=!1:t.catchall?t.catchall&&(e.additionalProperties=this.process(t.catchall,{...i,path:[...i.path,"additionalProperties"]})):this.io==="output"&&(e.additionalProperties=!1);break}case"union":{const e=u,o=t.discriminator!==void 0,a=t.options.map((m,d)=>this.process(m,{...i,path:[...i.path,o?"oneOf":"anyOf",d]}));o?e.oneOf=a:e.anyOf=a;break}case"intersection":{const e=u,o=this.process(t.left,{...i,path:[...i.path,"allOf",0]}),a=this.process(t.right,{...i,path:[...i.path,"allOf",1]}),m=b=>"allOf"in b&&Object.keys(b).length===1,d=[...m(o)?o.allOf:[o],...m(a)?a.allOf:[a]];e.allOf=d;break}case"tuple":{const e=u;e.type="array";const o=this.target==="draft-2020-12"?"prefixItems":"items",a=this.target==="draft-2020-12"||this.target==="openapi-3.0"?"items":"additionalItems",m=t.items.map((x,Z)=>this.process(x,{...i,path:[...i.path,o,Z]})),d=t.rest?this.process(t.rest,{...i,path:[...i.path,a,...this.target==="openapi-3.0"?[t.items.length]:[]]}):null;this.target==="draft-2020-12"?(e.prefixItems=m,d&&(e.items=d)):this.target==="openapi-3.0"?(e.items={anyOf:m},d&&e.items.anyOf.push(d),e.minItems=m.length,d||(e.maxItems=m.length)):(e.items=m,d&&(e.additionalItems=d));const{minimum:b,maximum:S}=s._zod.bag;typeof b=="number"&&(e.minItems=b),typeof S=="number"&&(e.maxItems=S);break}case"record":{const e=u;e.type="object",(this.target==="draft-7"||this.target==="draft-2020-12")&&(e.propertyNames=this.process(t.keyType,{...i,path:[...i.path,"propertyNames"]})),e.additionalProperties=this.process(t.valueType,{...i,path:[...i.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const e=u,o=$(t.entries);o.every(a=>typeof a=="number")&&(e.type="number"),o.every(a=>typeof a=="string")&&(e.type="string"),e.enum=o;break}case"literal":{const e=u,o=[];for(const a of t.values)if(a===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof a=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");o.push(Number(a))}else o.push(a);if(o.length!==0)if(o.length===1){const a=o[0];e.type=a===null?"null":typeof a,this.target==="draft-4"||this.target==="openapi-3.0"?e.enum=[a]:e.const=a}else o.every(a=>typeof a=="number")&&(e.type="number"),o.every(a=>typeof a=="string")&&(e.type="string"),o.every(a=>typeof a=="boolean")&&(e.type="string"),o.every(a=>a===null)&&(e.type="null"),e.enum=o;break}case"file":{const e=u,o={type:"string",format:"binary",contentEncoding:"binary"},{minimum:a,maximum:m,mime:d}=s._zod.bag;a!==void 0&&(o.minLength=a),m!==void 0&&(o.maxLength=m),d?d.length===1?(o.contentMediaType=d[0],Object.assign(e,o)):e.anyOf=d.map(b=>({...o,contentMediaType:b})):Object.assign(e,o);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const e=this.process(t.innerType,i);this.target==="openapi-3.0"?(f.ref=t.innerType,u.nullable=!0):u.anyOf=[e,{type:"null"}];break}case"nonoptional":{this.process(t.innerType,i),f.ref=t.innerType;break}case"success":{const e=u;e.type="boolean";break}case"default":{this.process(t.innerType,i),f.ref=t.innerType,u.default=JSON.parse(JSON.stringify(t.defaultValue));break}case"prefault":{this.process(t.innerType,i),f.ref=t.innerType,this.io==="input"&&(u._prefault=JSON.parse(JSON.stringify(t.defaultValue)));break}case"catch":{this.process(t.innerType,i),f.ref=t.innerType;let e;try{e=t.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}u.default=e;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const e=u,o=s._zod.pattern;if(!o)throw new Error("Pattern not found in template literal");e.type="string",e.pattern=o.source;break}case"pipe":{const e=this.io==="input"?t.in._zod.def.type==="transform"?t.out:t.in:t.out;this.process(e,i),f.ref=e;break}case"readonly":{this.process(t.innerType,i),f.ref=t.innerType,u.readOnly=!0;break}case"promise":{this.process(t.innerType,i),f.ref=t.innerType;break}case"optional":{this.process(t.innerType,i),f.ref=t.innerType;break}case"lazy":{const e=s._zod.innerType;this.process(e,i),f.ref=e;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}case"function":{if(this.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema");break}}}}const y=this.metadataRegistry.get(s);return y&&Object.assign(f.schema,y),this.io==="input"&&O(s)&&(delete f.schema.examples,delete f.schema.default),this.io==="input"&&f.schema._prefault&&((r=f.schema).default??(r.default=f.schema._prefault)),delete f.schema._prefault,this.seen.get(s).schema}emit(s,c){const r={cycles:c?.cycles??"ref",reused:c?.reused??"inline",external:c?.external??void 0},t=this.seen.get(s);if(!t)throw new Error("Unprocessed schema. This is a bug in Zod.");const p=h=>{const i=this.target==="draft-2020-12"?"$defs":"definitions";if(r.external){const o=r.external.registry.get(h[0])?.id,a=r.external.uri??(d=>d);if(o)return{ref:a(o)};const m=h[1].defId??h[1].schema.id??`schema${this.counter++}`;return h[1].defId=m,{defId:m,ref:`${a("__shared")}#/${i}/${m}`}}if(h[1]===t)return{ref:"#"};const u=`#/${i}/`,e=h[1].schema.id??`__schema${this.counter++}`;return{defId:e,ref:u+e}},l=h=>{if(h[1].schema.$ref)return;const i=h[1],{ref:w,defId:u}=p(h);i.def={...i.schema},u&&(i.defId=u);const e=i.schema;for(const o in e)delete e[o];e.$ref=w};if(r.cycles==="throw")for(const h of this.seen.entries()){const i=h[1];if(i.cycle)throw new Error(`Cycle detected: #/${i.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const h of this.seen.entries()){const i=h[1];if(s===h[0]){l(h);continue}if(r.external){const u=r.external.registry.get(h[0])?.id;if(s!==h[0]&&u){l(h);continue}}if(this.metadataRegistry.get(h[0])?.id){l(h);continue}if(i.cycle){l(h);continue}if(i.count>1&&r.reused==="ref"){l(h);continue}}const f=(h,i)=>{const w=this.seen.get(h),u=w.def??w.schema,e={...u};if(w.ref===null)return;const o=w.ref;if(w.ref=null,o){f(o,i);const a=this.seen.get(o).schema;a.$ref&&(i.target==="draft-7"||i.target==="draft-4"||i.target==="openapi-3.0")?(u.allOf=u.allOf??[],u.allOf.push(a)):(Object.assign(u,a),Object.assign(u,e))}w.isParent||this.override({zodSchema:h,jsonSchema:u,path:w.path??[]})};for(const h of[...this.seen.entries()].reverse())f(h[0],{target:this.target});const g={};if(this.target==="draft-2020-12"?g.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?g.$schema="http://json-schema.org/draft-07/schema#":this.target==="draft-4"?g.$schema="http://json-schema.org/draft-04/schema#":this.target==="openapi-3.0"||console.warn(`Invalid target: ${this.target}`),r.external?.uri){const h=r.external.registry.get(s)?.id;if(!h)throw new Error("Schema is missing an `id` property");g.$id=r.external.uri(h)}Object.assign(g,t.def);const y=r.external?.defs??{};for(const h of this.seen.entries()){const i=h[1];i.def&&i.defId&&(y[i.defId]=i.def)}r.external||Object.keys(y).length>0&&(this.target==="draft-2020-12"?g.$defs=y:g.definitions=y);try{return JSON.parse(JSON.stringify(g))}catch{throw new Error("Error converting schema to JSON.")}}}function M(n,s){if(n instanceof I){const r=new v(s),t={};for(const f of n._idmap.entries()){const[g,y]=f;r.process(y)}const p={},l={registry:n,uri:s?.uri,defs:t};for(const f of n._idmap.entries()){const[g,y]=f;p[g]=r.emit(y,{...s,external:l})}if(Object.keys(t).length>0){const f=r.target==="draft-2020-12"?"$defs":"definitions";p.__shared={[f]:t}}return{schemas:p}}const c=new v(s);return c.process(n),c.emit(n,s)}function O(n,s){const c=s??{seen:new Set};if(c.seen.has(n))return!1;c.seen.add(n);const r=n._zod.def;if(r.type==="transform")return!0;if(r.type==="array")return O(r.element,c);if(r.type==="set")return O(r.valueType,c);if(r.type==="lazy")return O(r.getter(),c);if(r.type==="promise"||r.type==="optional"||r.type==="nonoptional"||r.type==="nullable"||r.type==="readonly"||r.type==="default"||r.type==="prefault")return O(r.innerType,c);if(r.type==="intersection")return O(r.left,c)||O(r.right,c);if(r.type==="record"||r.type==="map")return O(r.keyType,c)||O(r.valueType,c);if(r.type==="pipe")return O(r.in,c)||O(r.out,c);if(r.type==="object"){for(const t in r.shape)if(O(r.shape[t],c))return!0;return!1}if(r.type==="union"){for(const t of r.options)if(O(t,c))return!0;return!1}if(r.type==="tuple"){for(const t of r.items)if(O(t,c))return!0;return!!(r.rest&&O(r.rest,c))}return!1}var k;(function(n){n.assertEqual=t=>{};function s(t){}n.assertIs=s;function c(t){throw new Error}n.assertNever=c,n.arrayToEnum=t=>{const p={};for(const l of t)p[l]=l;return p},n.getValidEnumValues=t=>{const p=n.objectKeys(t).filter(f=>typeof t[t[f]]!="number"),l={};for(const f of p)l[f]=t[f];return n.objectValues(l)},n.objectValues=t=>n.objectKeys(t).map(function(p){return t[p]}),n.objectKeys=typeof Object.keys=="function"?t=>Object.keys(t):t=>{const p=[];for(const l in t)Object.prototype.hasOwnProperty.call(t,l)&&p.push(l);return p},n.find=(t,p)=>{for(const l of t)if(p(l))return l},n.isInteger=typeof Number.isInteger=="function"?t=>Number.isInteger(t):t=>typeof t=="number"&&Number.isFinite(t)&&Math.floor(t)===t;function r(t,p=" | "){return t.map(l=>typeof l=="string"?`'${l}'`:l).join(p)}n.joinValues=r,n.jsonStringifyReplacer=(t,p)=>typeof p=="bigint"?p.toString():p})(k||(k={}));var j;(function(n){n.mergeShapes=(s,c)=>({...s,...c})})(j||(j={}));k.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]);k.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class _ extends Error{get errors(){return this.issues}constructor(s){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const c=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,c):this.__proto__=c,this.name="ZodError",this.issues=s}format(s){const c=s||function(p){return p.message},r={_errors:[]},t=p=>{for(const l of p.issues)if(l.code==="invalid_union")l.unionErrors.map(t);else if(l.code==="invalid_return_type")t(l.returnTypeError);else if(l.code==="invalid_arguments")t(l.argumentsError);else if(l.path.length===0)r._errors.push(c(l));else{let f=r,g=0;for(;g<l.path.length;){const y=l.path[g];g===l.path.length-1?(f[y]=f[y]||{_errors:[]},f[y]._errors.push(c(l))):f[y]=f[y]||{_errors:[]},f=f[y],g++}}};return t(this),r}static assert(s){if(!(s instanceof _))throw new Error(`Not a ZodError: ${s}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,k.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(s=c=>c.message){const c=Object.create(null),r=[];for(const t of this.issues)if(t.path.length>0){const p=t.path[0];c[p]=c[p]||[],c[p].push(s(t))}else r.push(s(t));return{formErrors:r,fieldErrors:c}}get formErrors(){return this.flatten()}}_.create=n=>new _(n);var E;(function(n){n.errToObj=s=>typeof s=="string"?{message:s}:s||{},n.toString=s=>typeof s=="string"?s:s?.message})(E||(E={}));var N;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(N||(N={}));export{N as Z,M as t};
