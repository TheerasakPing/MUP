{"version":3,"file":"server.js","sourceRoot":"","sources":["../../src/cli/server.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * CLI entry point for the mux oRPC server.\r\n * Uses createOrpcServer from ./orpcServer.ts for the actual server logic.\r\n */\r\nimport { Config } from \"@/node/config\";\r\nimport { ServiceContainer } from \"@/node/services/serviceContainer\";\r\nimport { ServerLockfile } from \"@/node/services/serverLockfile\";\r\nimport { getMuxHome, migrateLegacyMuxHome } from \"@/common/constants/paths\";\r\nimport type { BrowserWindow } from \"electron\";\r\nimport { Command } from \"commander\";\r\nimport { validateProjectPath } from \"@/node/utils/pathUtils\";\r\nimport { createOrpcServer } from \"@/node/orpc/server\";\r\nimport { VERSION } from \"@/version\";\r\nimport {\r\n  buildMuxMdnsServiceOptions,\r\n  MdnsAdvertiserService,\r\n} from \"@/node/services/mdnsAdvertiserService\";\r\nimport * as os from \"os\";\r\nimport { getParseOptions } from \"./argv\";\r\n\r\nconst program = new Command();\r\nprogram\r\n  .name(\"mux server\")\r\n  .description(\"HTTP/WebSocket ORPC server for mux\")\r\n  .option(\"-h, --host <host>\", \"bind to specific host\", \"localhost\")\r\n  .option(\"-p, --port <port>\", \"bind to specific port\", \"3000\")\r\n  .option(\"--auth-token <token>\", \"optional bearer token for HTTP/WS auth\")\r\n  .option(\"--ssh-host <host>\", \"SSH hostname/alias for editor deep links (e.g., devbox)\")\r\n  .option(\"--add-project <path>\", \"add and open project at the specified path (idempotent)\")\r\n  .parse(process.argv, getParseOptions());\r\n\r\nconst options = program.opts();\r\nconst HOST = options.host as string;\r\nconst PORT = Number.parseInt(String(options.port), 10);\r\nconst rawAuthToken = (options.authToken as string | undefined) ?? process.env.MUX_SERVER_AUTH_TOKEN;\r\nconst AUTH_TOKEN = rawAuthToken?.trim() ? rawAuthToken.trim() : undefined;\r\nconst ADD_PROJECT_PATH = options.addProject as string | undefined;\r\n// SSH host for editor deep links (CLI flag > env var > config file, resolved later)\r\nconst CLI_SSH_HOST = options.sshHost as string | undefined;\r\n\r\n// Track the launch project path for initial navigation\r\nlet launchProjectPath: string | null = null;\r\n\r\nfunction isLoopbackHost(host: string): boolean {\r\n  const normalized = host.trim().toLowerCase();\r\n\r\n  // IPv4 loopback range (RFC 1122): 127.0.0.0/8\r\n  if (normalized.startsWith(\"127.\")) {\r\n    return true;\r\n  }\r\n\r\n  return normalized === \"localhost\" || normalized === \"::1\";\r\n}\r\n\r\n// Minimal BrowserWindow stub for services that expect one\r\nconst mockWindow: BrowserWindow = {\r\n  isDestroyed: () => false,\r\n  setTitle: () => undefined,\r\n  webContents: {\r\n    send: () => undefined,\r\n    openDevTools: () => undefined,\r\n  },\r\n} as unknown as BrowserWindow;\r\n\r\n(async () => {\r\n  // Keepalive interval to prevent premature process exit during async initialization.\r\n  // During startup, taskService.initialize() may resume running tasks by calling\r\n  // sendMessage(), which spawns background AI streams. Between the completion of\r\n  // serviceContainer.initialize() and the HTTP server starting to listen, there can\r\n  // be a brief moment where no ref'd handles exist, causing Node to exit with code 0.\r\n  // This interval ensures the event loop stays alive until the server is listening.\r\n  const startupKeepalive = setInterval(() => {\r\n    // Intentionally empty - keeps event loop alive during startup\r\n  }, 1000);\r\n\r\n  migrateLegacyMuxHome();\r\n\r\n  // Check for existing server (Electron or another mux server instance)\r\n  const lockfile = new ServerLockfile(getMuxHome());\r\n  const existing = await lockfile.read();\r\n  if (existing) {\r\n    console.error(`Error: mux API server is already running at ${existing.baseUrl}`);\r\n    console.error(`Use 'mux api' commands to interact with the running instance.`);\r\n    process.exit(1);\r\n  }\r\n\r\n  const config = new Config();\r\n  const serviceContainer = new ServiceContainer(config);\r\n  await serviceContainer.initialize();\r\n  serviceContainer.windowService.setMainWindow(mockWindow);\r\n\r\n  if (ADD_PROJECT_PATH) {\r\n    await initializeProjectDirect(ADD_PROJECT_PATH, serviceContainer);\r\n  }\r\n\r\n  // Set launch project path for clients\r\n  serviceContainer.serverService.setLaunchProject(launchProjectPath);\r\n\r\n  // Set SSH host for editor deep links (CLI > env > config file)\r\n  const sshHost = CLI_SSH_HOST ?? process.env.MUX_SSH_HOST ?? config.getServerSshHost();\r\n  serviceContainer.serverService.setSshHost(sshHost);\r\n\r\n  const context = serviceContainer.toORPCContext();\r\n\r\n  const mdnsAdvertiser = new MdnsAdvertiserService();\r\n  const server = await createOrpcServer({\r\n    host: HOST,\r\n    port: PORT,\r\n    authToken: AUTH_TOKEN,\r\n    context,\r\n    serveStatic: true,\r\n  });\r\n\r\n  // Server is now listening - clear the startup keepalive since httpServer keeps the loop alive\r\n  clearInterval(startupKeepalive);\r\n\r\n  // Acquire lockfile so other instances know we're running\r\n  await lockfile.acquire(server.baseUrl, AUTH_TOKEN ?? \"\");\r\n\r\n  const mdnsAdvertisementEnabled = config.getMdnsAdvertisementEnabled();\r\n  if (mdnsAdvertisementEnabled !== false && !isLoopbackHost(HOST)) {\r\n    const instanceName = config.getMdnsServiceName() ?? `mux-${os.hostname()}`;\r\n    const serviceOptions = buildMuxMdnsServiceOptions({\r\n      bindHost: HOST,\r\n      port: server.port,\r\n      instanceName,\r\n      version: VERSION.git_describe,\r\n      authRequired: AUTH_TOKEN?.trim().length ? true : false,\r\n    });\r\n\r\n    try {\r\n      await mdnsAdvertiser.start(serviceOptions);\r\n    } catch (err) {\r\n      console.warn(\"Failed to advertise mux API server via mDNS:\", err);\r\n    }\r\n  } else if (mdnsAdvertisementEnabled === true && isLoopbackHost(HOST)) {\r\n    console.warn(\r\n      \"mDNS advertisement requested, but the API server is loopback-only. \" +\r\n        \"Set --host 0.0.0.0 (or a LAN IP) to enable LAN discovery.\"\r\n    );\r\n  }\r\n\r\n  console.log(`Server is running on ${server.baseUrl}`);\r\n\r\n  // Cleanup on shutdown\r\n  let cleanupInProgress = false;\r\n  const cleanup = async () => {\r\n    if (cleanupInProgress) return;\r\n    cleanupInProgress = true;\r\n\r\n    console.log(\"Shutting down server...\");\r\n\r\n    // Force exit after timeout if cleanup hangs\r\n    const forceExitTimer = setTimeout(() => {\r\n      console.log(\"Cleanup timed out, forcing exit...\");\r\n      process.exit(1);\r\n    }, 5000);\r\n\r\n    try {\r\n      // Close all PTY sessions first (these are the \"sub-processes\" nodemon sees)\r\n      serviceContainer.terminalService.closeAllSessions();\r\n\r\n      // Dispose background processes\r\n      await serviceContainer.dispose();\r\n\r\n      // Release lockfile and close server\r\n      try {\r\n        await mdnsAdvertiser.stop();\r\n      } catch (err) {\r\n        console.warn(\"Failed to stop mDNS advertiser:\", err);\r\n      }\r\n\r\n      await lockfile.release();\r\n      await server.close();\r\n\r\n      clearTimeout(forceExitTimer);\r\n      process.exit(0);\r\n    } catch (err) {\r\n      console.error(\"Cleanup error:\", err);\r\n      clearTimeout(forceExitTimer);\r\n      process.exit(1);\r\n    }\r\n  };\r\n\r\n  process.on(\"SIGINT\", () => void cleanup());\r\n  process.on(\"SIGTERM\", () => void cleanup());\r\n})().catch((error) => {\r\n  console.error(\"Failed to initialize server:\", error);\r\n  process.exit(1);\r\n});\r\n\r\nasync function initializeProjectDirect(\r\n  projectPath: string,\r\n  serviceContainer: ServiceContainer\r\n): Promise<void> {\r\n  try {\r\n    let normalizedPath = projectPath.replace(/\\/+$/, \"\");\r\n    const validation = await validateProjectPath(normalizedPath);\r\n    if (!validation.valid || !validation.expandedPath) {\r\n      console.error(\r\n        `Invalid project path provided via --add-project: ${validation.error ?? \"unknown error\"}`\r\n      );\r\n      return;\r\n    }\r\n    normalizedPath = validation.expandedPath;\r\n\r\n    const projects = serviceContainer.projectService.list();\r\n    const alreadyExists = Array.isArray(projects)\r\n      ? projects.some(([path]) => path === normalizedPath)\r\n      : false;\r\n\r\n    if (alreadyExists) {\r\n      console.log(`Project already exists: ${normalizedPath}`);\r\n      launchProjectPath = normalizedPath;\r\n      return;\r\n    }\r\n\r\n    console.log(`Creating project via --add-project: ${normalizedPath}`);\r\n    const result = await serviceContainer.projectService.create(normalizedPath);\r\n    if (result.success) {\r\n      console.log(`Project created at ${normalizedPath}`);\r\n      launchProjectPath = normalizedPath;\r\n    } else {\r\n      const errorMsg =\r\n        typeof result.error === \"string\"\r\n          ? result.error\r\n          : JSON.stringify(result.error ?? \"unknown error\");\r\n      console.error(`Failed to create project at ${normalizedPath}: ${errorMsg}`);\r\n    }\r\n  } catch (error) {\r\n    console.error(`initializeProject failed for ${projectPath}:`, error);\r\n  }\r\n}\r\n"]}