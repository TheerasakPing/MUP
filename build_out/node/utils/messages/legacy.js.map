{"version":3,"file":"legacy.js","sourceRoot":"","sources":["../../../../src/node/utils/messages/legacy.ts"],"names":[],"mappings":";;;AAOA;;;;;;GAMG;AACH,oCAA2C,OAAmB,EAAc;IAC1E,MAAM,QAAQ,GAAG,OAAO,CAAC,QAAyC,CAAC;IACnE,IAAI,CAAC,QAAQ;QAAE,OAAO,OAAO,CAAC;IAE9B,IAAI,UAAU,GAAgB,EAAE,GAAG,QAAQ,EAAE,CAAC;IAC9C,IAAI,OAAO,GAAG,KAAK,CAAC;IAEpB,uCAAqC;IACrC,IAAI,QAAQ,CAAC,YAAY,KAAK,SAAS,EAAE,CAAC;QACxC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,EAAE,GAAG,UAA+B,CAAC;QAClE,UAAU,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC;YAC1B,UAAU,CAAC,WAAW,GAAG,YAAY,CAAC;QACxC,CAAC;QACD,OAAO,GAAG,IAAI,CAAC;IACjB,CAAC;IAED,oDAAkD;IAClD,IAAI,QAAQ,CAAC,aAAa,KAAK,IAAI,EAAE,CAAC;QACpC,MAAM,EAAE,aAAa,EAAE,GAAG,IAAI,EAAE,GAAG,UAA+B,CAAC;QACnE,UAAU,GAAG,EAAE,GAAG,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,CAAC;QAC5C,OAAO,GAAG,IAAI,CAAC;IACjB,CAAC;IAED,OAAO,OAAO,CAAC,CAAC,CAAC,EAAE,GAAG,OAAO,EAAE,QAAQ,EAAE,UAAU,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC;AAAA,CACjE","sourcesContent":["import type { MuxFrontendMetadata, MuxMessage, MuxMetadata } from \"@/common/types/message\";\n\ninterface LegacyMuxMetadata extends MuxMetadata {\n  cmuxMetadata?: MuxFrontendMetadata;\n  idleCompacted?: boolean;\n}\n\n/**\n * Normalize persisted messages from older builds.\n *\n * Migrations:\n * - `cmuxMetadata` → `muxMetadata` (mux rename)\n * - `{ compacted: true, idleCompacted: true }` → `{ compacted: \"idle\" }`\n */\nexport function normalizeLegacyMuxMetadata(message: MuxMessage): MuxMessage {\n  const metadata = message.metadata as LegacyMuxMetadata | undefined;\n  if (!metadata) return message;\n\n  let normalized: MuxMetadata = { ...metadata };\n  let changed = false;\n\n  // Migrate cmuxMetadata → muxMetadata\n  if (metadata.cmuxMetadata !== undefined) {\n    const { cmuxMetadata, ...rest } = normalized as LegacyMuxMetadata;\n    normalized = rest;\n    if (!metadata.muxMetadata) {\n      normalized.muxMetadata = cmuxMetadata;\n    }\n    changed = true;\n  }\n\n  // Migrate idleCompacted: true → compacted: \"idle\"\n  if (metadata.idleCompacted === true) {\n    const { idleCompacted, ...rest } = normalized as LegacyMuxMetadata;\n    normalized = { ...rest, compacted: \"idle\" };\n    changed = true;\n  }\n\n  return changed ? { ...message, metadata: normalized } : message;\n}\n"]}