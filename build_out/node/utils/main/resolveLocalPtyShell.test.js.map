{"version":3,"file":"resolveLocalPtyShell.test.js","sourceRoot":"","sources":["../../../../src/node/utils/main/resolveLocalPtyShell.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { resolveLocalPtyShell } from \"./resolveLocalPtyShell\";\r\n\r\ndescribe(\"resolveLocalPtyShell\", () => {\r\n  it(\"uses SHELL when it is set and non-empty\", () => {\r\n    const result = resolveLocalPtyShell({\r\n      platform: \"linux\",\r\n      env: { SHELL: \"  /usr/bin/fish  \" },\r\n      isCommandAvailable: () => {\r\n        throw new Error(\"isCommandAvailable should not be called\");\r\n      },\r\n      getBashPath: () => {\r\n        throw new Error(\"getBashPath should not be called\");\r\n      },\r\n    });\r\n\r\n    expect(result).toEqual({ command: \"/usr/bin/fish\", args: [] });\r\n  });\r\n\r\n  it(\"on Windows, treats empty SHELL as unset and prefers Git Bash\", () => {\r\n    const result = resolveLocalPtyShell({\r\n      platform: \"win32\",\r\n      env: { SHELL: \"\" },\r\n      isCommandAvailable: () => false,\r\n      getBashPath: () => \"C:\\\\Program Files\\\\Git\\\\bin\\\\bash.exe\",\r\n    });\r\n\r\n    expect(result).toEqual({\r\n      command: \"C:\\\\Program Files\\\\Git\\\\bin\\\\bash.exe\",\r\n      args: [\"--login\", \"-i\"],\r\n    });\r\n  });\r\n\r\n  it(\"on Windows, ignores POSIX-y SHELL paths and prefers Git Bash\", () => {\r\n    const result = resolveLocalPtyShell({\r\n      platform: \"win32\",\r\n      env: { SHELL: \"/bin/bash\" },\r\n      isCommandAvailable: () => false,\r\n      getBashPath: () => \"C:\\\\Program Files\\\\Git\\\\bin\\\\bash.exe\",\r\n    });\r\n\r\n    expect(result).toEqual({\r\n      command: \"C:\\\\Program Files\\\\Git\\\\bin\\\\bash.exe\",\r\n      args: [\"--login\", \"-i\"],\r\n    });\r\n  });\r\n  it(\"on Windows, ignores WSL SHELL and prefers Git Bash\", () => {\r\n    const result = resolveLocalPtyShell({\r\n      platform: \"win32\",\r\n      env: { SHELL: \"C:\\\\Windows\\\\System32\\\\bash.exe\" },\r\n      isCommandAvailable: () => false,\r\n      getBashPath: () => \"C:\\\\Program Files\\\\Git\\\\bin\\\\bash.exe\",\r\n    });\r\n\r\n    expect(result).toEqual({\r\n      command: \"C:\\\\Program Files\\\\Git\\\\bin\\\\bash.exe\",\r\n      args: [\"--login\", \"-i\"],\r\n    });\r\n  });\r\n\r\n  it(\"on Windows, ignores WSL wsl.exe in SHELL and prefers Git Bash\", () => {\r\n    const result = resolveLocalPtyShell({\r\n      platform: \"win32\",\r\n      env: { SHELL: \"C:\\\\Program Files\\\\WSL\\\\wsl.exe\" },\r\n      isCommandAvailable: () => false,\r\n      getBashPath: () => \"C:\\\\Program Files\\\\Git\\\\bin\\\\bash.exe\",\r\n    });\r\n\r\n    expect(result).toEqual({\r\n      command: \"C:\\\\Program Files\\\\Git\\\\bin\\\\bash.exe\",\r\n      args: [\"--login\", \"-i\"],\r\n    });\r\n  });\r\n\r\n  it(\"on Windows, falls back to pwsh when Git Bash is unavailable\", () => {\r\n    const result = resolveLocalPtyShell({\r\n      platform: \"win32\",\r\n      env: { SHELL: \"\" },\r\n      isCommandAvailable: (command) => command === \"pwsh\",\r\n      getBashPath: () => {\r\n        throw new Error(\"Git Bash not installed\");\r\n      },\r\n    });\r\n\r\n    expect(result).toEqual({ command: \"pwsh\", args: [] });\r\n  });\r\n\r\n  it(\"on Windows, falls back to COMSPEC/cmd.exe when no other shells are available\", () => {\r\n    const result = resolveLocalPtyShell({\r\n      platform: \"win32\",\r\n      env: { SHELL: \"   \", COMSPEC: \"C:\\\\Windows\\\\System32\\\\cmd.exe\" },\r\n      isCommandAvailable: () => false,\r\n      getBashPath: () => {\r\n        throw new Error(\"Git Bash not installed\");\r\n      },\r\n    });\r\n\r\n    expect(result).toEqual({ command: \"C:\\\\Windows\\\\System32\\\\cmd.exe\", args: [] });\r\n  });\r\n\r\n  it(\"on Linux, falls back to /bin/bash when SHELL is unset\", () => {\r\n    const result = resolveLocalPtyShell({\r\n      platform: \"linux\",\r\n      env: {},\r\n      isCommandAvailable: () => false,\r\n      getBashPath: () => \"bash\",\r\n    });\r\n\r\n    expect(result).toEqual({ command: \"/bin/bash\", args: [] });\r\n  });\r\n\r\n  it(\"on macOS, falls back to /bin/zsh when SHELL is unset\", () => {\r\n    const result = resolveLocalPtyShell({\r\n      platform: \"darwin\",\r\n      env: {},\r\n      isCommandAvailable: () => false,\r\n      getBashPath: () => \"bash\",\r\n    });\r\n\r\n    expect(result).toEqual({ command: \"/bin/zsh\", args: [] });\r\n  });\r\n});\r\n"]}