{"version":3,"file":"markdown.test.js","sourceRoot":"","sources":["../../../../src/node/utils/main/markdown.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { extractToolSection, stripScopedInstructionSections } from \"./markdown\";\r\n\r\ndescribe(\"extractToolSection\", () => {\r\n  describe(\"basic extraction\", () => {\r\n    it(\"should extract content under Tool: bash heading\", () => {\r\n      const markdown = `\r\n# General Instructions\r\nSome general content\r\n\r\n# Tool: bash\r\nUse bash conservatively\r\nPrefer single commands\r\n\r\n# Other Section\r\nOther content\r\n`.trim();\r\n\r\n      const result = extractToolSection(markdown, \"bash\");\r\n      expect(result).toBe(\"Use bash conservatively\\nPrefer single commands\");\r\n    });\r\n\r\n    it(\"should return null when tool section doesn't exist\", () => {\r\n      const markdown = `\r\n# General Instructions\r\nSome content\r\n\r\n# Other Section\r\nOther content\r\n`.trim();\r\n\r\n      const result = extractToolSection(markdown, \"bash\");\r\n      expect(result).toBeNull();\r\n    });\r\n\r\n    it(\"should return null for empty markdown\", () => {\r\n      expect(extractToolSection(\"\", \"bash\")).toBeNull();\r\n    });\r\n\r\n    it(\"should return null for empty tool name\", () => {\r\n      expect(extractToolSection(\"# Tool: bash\\nContent\", \"\")).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe(\"case insensitivity\", () => {\r\n    it(\"should match case-insensitive heading\", () => {\r\n      const markdown = \"# TOOL: BASH\\nContent here\";\r\n      const result = extractToolSection(markdown, \"bash\");\r\n      expect(result).toBe(\"Content here\");\r\n    });\r\n\r\n    it(\"should match mixed case heading\", () => {\r\n      const markdown = \"# ToOl: BaSh\\nContent here\";\r\n      const result = extractToolSection(markdown, \"bash\");\r\n      expect(result).toBe(\"Content here\");\r\n    });\r\n\r\n    it(\"should match with case-insensitive tool name parameter\", () => {\r\n      const markdown = \"# Tool: bash\\nContent here\";\r\n      const result = extractToolSection(markdown, \"BASH\");\r\n      expect(result).toBe(\"Content here\");\r\n    });\r\n  });\r\n\r\n  describe(\"multiple tools\", () => {\r\n    it(\"should extract specific tool section\", () => {\r\n      const markdown = `\r\n# Tool: bash\r\nBash instructions\r\n\r\n# Tool: file_read\r\nFile read instructions\r\n\r\n# Tool: propose_plan\r\nPlan instructions\r\n`.trim();\r\n\r\n      expect(extractToolSection(markdown, \"bash\")).toBe(\"Bash instructions\");\r\n      expect(extractToolSection(markdown, \"file_read\")).toBe(\"File read instructions\");\r\n      expect(extractToolSection(markdown, \"propose_plan\")).toBe(\"Plan instructions\");\r\n    });\r\n\r\n    it(\"should return only first matching section\", () => {\r\n      const markdown = `\r\n# Tool: bash\r\nFirst bash section\r\n\r\n# Other Section\r\nOther content\r\n\r\n# Tool: bash\r\nSecond bash section (should be ignored)\r\n`.trim();\r\n\r\n      const result = extractToolSection(markdown, \"bash\");\r\n      expect(result).toBe(\"First bash section\");\r\n      expect(result).not.toContain(\"Second bash section\");\r\n    });\r\n  });\r\n\r\n  describe(\"tool names with underscores\", () => {\r\n    it(\"should handle file_read tool\", () => {\r\n      const markdown = \"# Tool: file_read\\nRead instructions\";\r\n      expect(extractToolSection(markdown, \"file_read\")).toBe(\"Read instructions\");\r\n    });\r\n\r\n    it(\"should handle file_edit_replace_string tool\", () => {\r\n      const markdown = \"# Tool: file_edit_replace_string\\nReplace instructions\";\r\n      expect(extractToolSection(markdown, \"file_edit_replace_string\")).toBe(\"Replace instructions\");\r\n    });\r\n  });\r\n});\r\n\r\ndescribe(\"stripScopedInstructionSections\", () => {\r\n  it(\"should strip Model sections\", () => {\r\n    const markdown = `\r\n# General\r\nGeneral content\r\n\r\n# Model: gpt-4\r\nModel-specific content\r\n\r\n# More General\r\nMore general content\r\n`.trim();\r\n\r\n    const result = stripScopedInstructionSections(markdown);\r\n    expect(result).toContain(\"General content\");\r\n    expect(result).toContain(\"More general content\");\r\n    expect(result).not.toContain(\"Model-specific content\");\r\n  });\r\n\r\n  it(\"should strip Tool sections\", () => {\r\n    const markdown = `\r\n# General\r\nGeneral content\r\n\r\n# Tool: bash\r\nTool-specific content\r\n\r\n# More General\r\nMore general content\r\n`.trim();\r\n\r\n    const result = stripScopedInstructionSections(markdown);\r\n    expect(result).toContain(\"General content\");\r\n    expect(result).toContain(\"More general content\");\r\n    expect(result).not.toContain(\"Tool-specific content\");\r\n  });\r\n\r\n  it(\"should strip Model and Tool sections together\", () => {\r\n    const markdown = `\r\n# General\r\nGeneral content\r\n\r\n# Model: gpt-4\r\nModel content\r\n\r\n# Tool: bash\r\nTool content\r\n\r\n# More General\r\nMore general content\r\n`.trim();\r\n\r\n    const result = stripScopedInstructionSections(markdown);\r\n    expect(result).toContain(\"General content\");\r\n    expect(result).toContain(\"More general content\");\r\n    expect(result).not.toContain(\"Model content\");\r\n    expect(result).not.toContain(\"Tool content\");\r\n  });\r\n\r\n  it(\"should NOT strip Agent or Mode sections (no longer scoped)\", () => {\r\n    const markdown = `\r\n# General\r\nGeneral content\r\n\r\n# Agent: foo\r\nAgent content\r\n\r\n# Mode: plan\r\nMode content\r\n\r\n# More General\r\nMore general content\r\n`.trim();\r\n\r\n    const result = stripScopedInstructionSections(markdown);\r\n    expect(result).toContain(\"General content\");\r\n    expect(result).toContain(\"More general content\");\r\n    expect(result).toContain(\"Agent content\");\r\n    expect(result).toContain(\"Mode content\");\r\n  });\r\n\r\n  it(\"should return empty string for markdown with only scoped sections\", () => {\r\n    const markdown = `\r\n# Model: gpt-4\r\nModel content\r\n\r\n# Tool: bash\r\nTool content\r\n`.trim();\r\n\r\n    const result = stripScopedInstructionSections(markdown);\r\n    expect(result.trim()).toBe(\"\");\r\n  });\r\n\r\n  it(\"should handle empty markdown\", () => {\r\n    expect(stripScopedInstructionSections(\"\")).toBe(\"\");\r\n  });\r\n});\r\n"]}