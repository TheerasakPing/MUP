{"version":3,"file":"markdown.test.js","sourceRoot":"","sources":["../../../../src/node/utils/main/markdown.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { extractToolSection, stripScopedInstructionSections } from \"./markdown\";\n\ndescribe(\"extractToolSection\", () => {\n  describe(\"basic extraction\", () => {\n    it(\"should extract content under Tool: bash heading\", () => {\n      const markdown = `\n# General Instructions\nSome general content\n\n# Tool: bash\nUse bash conservatively\nPrefer single commands\n\n# Other Section\nOther content\n`.trim();\n\n      const result = extractToolSection(markdown, \"bash\");\n      expect(result).toBe(\"Use bash conservatively\\nPrefer single commands\");\n    });\n\n    it(\"should return null when tool section doesn't exist\", () => {\n      const markdown = `\n# General Instructions\nSome content\n\n# Other Section\nOther content\n`.trim();\n\n      const result = extractToolSection(markdown, \"bash\");\n      expect(result).toBeNull();\n    });\n\n    it(\"should return null for empty markdown\", () => {\n      expect(extractToolSection(\"\", \"bash\")).toBeNull();\n    });\n\n    it(\"should return null for empty tool name\", () => {\n      expect(extractToolSection(\"# Tool: bash\\nContent\", \"\")).toBeNull();\n    });\n  });\n\n  describe(\"case insensitivity\", () => {\n    it(\"should match case-insensitive heading\", () => {\n      const markdown = \"# TOOL: BASH\\nContent here\";\n      const result = extractToolSection(markdown, \"bash\");\n      expect(result).toBe(\"Content here\");\n    });\n\n    it(\"should match mixed case heading\", () => {\n      const markdown = \"# ToOl: BaSh\\nContent here\";\n      const result = extractToolSection(markdown, \"bash\");\n      expect(result).toBe(\"Content here\");\n    });\n\n    it(\"should match with case-insensitive tool name parameter\", () => {\n      const markdown = \"# Tool: bash\\nContent here\";\n      const result = extractToolSection(markdown, \"BASH\");\n      expect(result).toBe(\"Content here\");\n    });\n  });\n\n  describe(\"multiple tools\", () => {\n    it(\"should extract specific tool section\", () => {\n      const markdown = `\n# Tool: bash\nBash instructions\n\n# Tool: file_read\nFile read instructions\n\n# Tool: propose_plan\nPlan instructions\n`.trim();\n\n      expect(extractToolSection(markdown, \"bash\")).toBe(\"Bash instructions\");\n      expect(extractToolSection(markdown, \"file_read\")).toBe(\"File read instructions\");\n      expect(extractToolSection(markdown, \"propose_plan\")).toBe(\"Plan instructions\");\n    });\n\n    it(\"should return only first matching section\", () => {\n      const markdown = `\n# Tool: bash\nFirst bash section\n\n# Other Section\nOther content\n\n# Tool: bash\nSecond bash section (should be ignored)\n`.trim();\n\n      const result = extractToolSection(markdown, \"bash\");\n      expect(result).toBe(\"First bash section\");\n      expect(result).not.toContain(\"Second bash section\");\n    });\n  });\n\n  describe(\"tool names with underscores\", () => {\n    it(\"should handle file_read tool\", () => {\n      const markdown = \"# Tool: file_read\\nRead instructions\";\n      expect(extractToolSection(markdown, \"file_read\")).toBe(\"Read instructions\");\n    });\n\n    it(\"should handle file_edit_replace_string tool\", () => {\n      const markdown = \"# Tool: file_edit_replace_string\\nReplace instructions\";\n      expect(extractToolSection(markdown, \"file_edit_replace_string\")).toBe(\"Replace instructions\");\n    });\n  });\n});\n\ndescribe(\"stripScopedInstructionSections\", () => {\n  it(\"should strip Model sections\", () => {\n    const markdown = `\n# General\nGeneral content\n\n# Model: gpt-4\nModel-specific content\n\n# More General\nMore general content\n`.trim();\n\n    const result = stripScopedInstructionSections(markdown);\n    expect(result).toContain(\"General content\");\n    expect(result).toContain(\"More general content\");\n    expect(result).not.toContain(\"Model-specific content\");\n  });\n\n  it(\"should strip Tool sections\", () => {\n    const markdown = `\n# General\nGeneral content\n\n# Tool: bash\nTool-specific content\n\n# More General\nMore general content\n`.trim();\n\n    const result = stripScopedInstructionSections(markdown);\n    expect(result).toContain(\"General content\");\n    expect(result).toContain(\"More general content\");\n    expect(result).not.toContain(\"Tool-specific content\");\n  });\n\n  it(\"should strip Model and Tool sections together\", () => {\n    const markdown = `\n# General\nGeneral content\n\n# Model: gpt-4\nModel content\n\n# Tool: bash\nTool content\n\n# More General\nMore general content\n`.trim();\n\n    const result = stripScopedInstructionSections(markdown);\n    expect(result).toContain(\"General content\");\n    expect(result).toContain(\"More general content\");\n    expect(result).not.toContain(\"Model content\");\n    expect(result).not.toContain(\"Tool content\");\n  });\n\n  it(\"should NOT strip Agent or Mode sections (no longer scoped)\", () => {\n    const markdown = `\n# General\nGeneral content\n\n# Agent: foo\nAgent content\n\n# Mode: plan\nMode content\n\n# More General\nMore general content\n`.trim();\n\n    const result = stripScopedInstructionSections(markdown);\n    expect(result).toContain(\"General content\");\n    expect(result).toContain(\"More general content\");\n    expect(result).toContain(\"Agent content\");\n    expect(result).toContain(\"Mode content\");\n  });\n\n  it(\"should return empty string for markdown with only scoped sections\", () => {\n    const markdown = `\n# Model: gpt-4\nModel content\n\n# Tool: bash\nTool content\n`.trim();\n\n    const result = stripScopedInstructionSections(markdown);\n    expect(result.trim()).toBe(\"\");\n  });\n\n  it(\"should handle empty markdown\", () => {\n    expect(stripScopedInstructionSections(\"\")).toBe(\"\");\n  });\n});\n"]}