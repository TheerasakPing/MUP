{"version":3,"file":"bashPath.test.js","sourceRoot":"","sources":["../../../../src/node/utils/main/bashPath.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { getBashPath, getBashPathForPlatform, resetBashPathCache } from \"./bashPath\";\n\ndescribe(\"getBashPathForPlatform (Windows)\", () => {\n  it(\"skips WSL launcher when it is first in PATH\", () => {\n    const execSyncFn = (command: string) => {\n      if (command === \"where git\") {\n        throw new Error(\"git not in PATH\");\n      }\n\n      if (command === \"where bash\") {\n        return [\"C:\\\\Windows\\\\System32\\\\bash.exe\", \"D:\\\\Custom\\\\Git\\\\usr\\\\bin\\\\bash.exe\"].join(\n          \"\\r\\n\"\n        );\n      }\n\n      throw new Error(`unexpected command: ${command}`);\n    };\n\n    const existing = new Set<string>([\n      \"C:\\\\Windows\\\\System32\\\\bash.exe\",\n      \"D:\\\\Custom\\\\Git\\\\usr\\\\bin\\\\bash.exe\",\n      \"D:\\\\Custom\\\\Git\\\\cmd\\\\git.exe\",\n    ]);\n\n    const existsSyncFn = (p: unknown) => existing.has(String(p));\n\n    expect(\n      getBashPathForPlatform({\n        platform: \"win32\",\n        env: {},\n        execSyncFn,\n        existsSyncFn,\n      })\n    ).toBe(\"D:\\\\Custom\\\\Git\\\\usr\\\\bin\\\\bash.exe\");\n  });\n\n  it(\"throws when only WSL bash is available\", () => {\n    const execSyncFn = (command: string) => {\n      if (command === \"where git\") {\n        throw new Error(\"git not in PATH\");\n      }\n\n      if (command === \"where bash\") {\n        return \"C:\\\\Windows\\\\System32\\\\bash.exe\\r\\n\";\n      }\n\n      throw new Error(`unexpected command: ${command}`);\n    };\n\n    const existing = new Set<string>([\"C:\\\\Windows\\\\System32\\\\bash.exe\"]);\n    const existsSyncFn = (p: unknown) => existing.has(String(p));\n\n    expect(() =>\n      getBashPathForPlatform({\n        platform: \"win32\",\n        env: {},\n        execSyncFn,\n        existsSyncFn,\n      })\n    ).toThrow(/WSL is not supported/);\n  });\n});\n\ndescribe(\"getBashPath (Windows)\", () => {\n  beforeEach(() => {\n    resetBashPathCache();\n  });\n\n  it(\"caches failures to avoid repeated `where` probes\", () => {\n    let execCalls = 0;\n    const execSyncFn = () => {\n      execCalls++;\n      throw new Error(\"not in PATH\");\n    };\n\n    const existsSyncFn = () => false;\n    const nowFn = () => 0;\n\n    expect(() =>\n      getBashPath({\n        platform: \"win32\",\n        env: {},\n        execSyncFn,\n        existsSyncFn,\n        nowFn,\n      })\n    ).toThrow(/Git Bash not found/);\n\n    const callsAfterFirst = execCalls;\n    expect(callsAfterFirst).toBeGreaterThan(0);\n\n    expect(() =>\n      getBashPath({\n        platform: \"win32\",\n        env: {},\n        execSyncFn,\n        existsSyncFn,\n        nowFn,\n      })\n    ).toThrow(/Git Bash not found/);\n\n    expect(execCalls).toBe(callsAfterFirst);\n  });\n});\n"]}