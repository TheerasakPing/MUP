{"version":3,"file":"commandDiscovery.js","sourceRoot":"","sources":["../../../src/node/utils/commandDiscovery.ts"],"names":[],"mappings":";AAAA;;;GAGG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEH,MAAY,EAAE,wCAAoB;AAClC,iDAA0C;AAE1C,wDAAwD;AACxD,MAAM,eAAe,GAA6B;IAChD,MAAM,EAAE,CAAC,4DAA4D,EAAE,uBAAuB,CAAC;IAC/F,IAAI,EAAE;QACJ,sEAAsE;QACtE,qBAAqB;KACtB;IACD,GAAG,EAAE,CAAC,0CAA0C,EAAE,oBAAoB,CAAC;IACvE,IAAI,EAAE,CAAC,gEAAgE,EAAE,qBAAqB,CAAC;IAC/F,OAAO,EAAE;QACP,2BAA2B;QAC3B,kDAAkD;QAClD,wBAAwB;KACzB;CACF,CAAC;AAEF;;;GAGG;AACI,KAAK,6BAA6B,OAAe,EAAoB;IAC1E,mCAAmC;IACnC,IAAI,OAAO,CAAC,QAAQ,KAAK,QAAQ,IAAI,OAAO,IAAI,eAAe,EAAE,CAAC;QAChE,KAAK,MAAM,OAAO,IAAI,eAAe,CAAC,OAAO,CAAC,EAAE,CAAC;YAC/C,IAAI,CAAC;gBACH,MAAM,KAAK,GAAG,MAAM,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;gBACrC,qDAAqD;gBACrD,IAAI,KAAK,CAAC,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC;oBACjD,OAAO,IAAI,CAAC;gBACd,CAAC;YACH,CAAC;YAAC,MAAM,CAAC;gBACP,gBAAgB;YAClB,CAAC;QACH,CAAC;IACH,CAAC;IAED,+DAA+D;IAC/D,IAAI,CAAC;QACH,MAAM,MAAM,GAAG,IAAA,yBAAS,EAAC,OAAO,EAAE,CAAC,OAAO,CAAC,EAAE,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC,CAAC;QACnE,OAAO,MAAM,CAAC,MAAM,KAAK,CAAC,CAAC;IAC7B,CAAC;IAAC,MAAM,CAAC;QACP,OAAO,KAAK,CAAC;IACf,CAAC;AAAA,CACF;AAED;;;GAGG;AACI,KAAK,+BAA+B,QAAkB,EAA0B;IACrF,KAAK,MAAM,GAAG,IAAI,QAAQ,EAAE,CAAC;QAC3B,IAAI,MAAM,kBAAkB,CAAC,GAAG,CAAC,EAAE,CAAC;YAClC,OAAO,GAAG,CAAC;QACb,CAAC;IACH,CAAC;IACD,OAAO,IAAI,CAAC;AAAA,CACb;AAED,2DAA2D;AAC9C,QAAA,WAAW,GAAG,CAAC,QAAQ,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,CAAU,CAAC;AAEtE,uDAAuD;AAC1C,QAAA,gBAAgB,GAAG,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,CAAU,CAAC;AAEhF,uCAAuC;AAC1B,QAAA,kBAAkB,GAAG,CAAC,SAAS,EAAE,OAAO,EAAE,WAAW,EAAE,SAAS,EAAE,QAAQ,CAAU,CAAC","sourcesContent":["/**\r\n * Utilities for discovering available commands in the system.\r\n * Used by terminalService and openInEditor to find executables.\r\n */\r\n\r\nimport * as fs from \"fs/promises\";\r\nimport { spawnSync } from \"child_process\";\r\n\r\n/** Known installation paths for GUI editors on macOS */\r\nconst MACOS_APP_PATHS: Record<string, string[]> = {\r\n  cursor: [\"/Applications/Cursor.app/Contents/Resources/app/bin/cursor\", \"/usr/local/bin/cursor\"],\r\n  code: [\r\n    \"/Applications/Visual Studio Code.app/Contents/Resources/app/bin/code\",\r\n    \"/usr/local/bin/code\",\r\n  ],\r\n  zed: [\"/Applications/Zed.app/Contents/MacOS/cli\", \"/usr/local/bin/zed\"],\r\n  subl: [\"/Applications/Sublime Text.app/Contents/SharedSupport/bin/subl\", \"/usr/local/bin/subl\"],\r\n  ghostty: [\r\n    \"/opt/homebrew/bin/ghostty\",\r\n    \"/Applications/Ghostty.app/Contents/MacOS/ghostty\",\r\n    \"/usr/local/bin/ghostty\",\r\n  ],\r\n};\r\n\r\n/**\r\n * Check if a command is available in the system PATH or known locations.\r\n * First checks macOS-specific paths for known apps, then falls back to `which`.\r\n */\r\nexport async function isCommandAvailable(command: string): Promise<boolean> {\r\n  // Check known paths for macOS apps\r\n  if (process.platform === \"darwin\" && command in MACOS_APP_PATHS) {\r\n    for (const appPath of MACOS_APP_PATHS[command]) {\r\n      try {\r\n        const stats = await fs.stat(appPath);\r\n        // Check if it's a file and any executable bit is set\r\n        if (stats.isFile() && (stats.mode & 0o111) !== 0) {\r\n          return true;\r\n        }\r\n      } catch {\r\n        // Try next path\r\n      }\r\n    }\r\n  }\r\n\r\n  // Fall back to which (inherits enriched PATH from process.env)\r\n  try {\r\n    const result = spawnSync(\"which\", [command], { encoding: \"utf8\" });\r\n    return result.status === 0;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Find the first available command from a list of candidates.\r\n * Returns the command name (not full path) of the first available one.\r\n */\r\nexport async function findAvailableCommand(commands: string[]): Promise<string | null> {\r\n  for (const cmd of commands) {\r\n    if (await isCommandAvailable(cmd)) {\r\n      return cmd;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n/** GUI editors that spawn detached (no terminal needed) */\r\nexport const GUI_EDITORS = [\"cursor\", \"code\", \"zed\", \"subl\"] as const;\r\n\r\n/** Terminal editors that require a terminal session */\r\nexport const TERMINAL_EDITORS = [\"nvim\", \"vim\", \"vi\", \"nano\", \"emacs\"] as const;\r\n\r\n/** All known GUI terminal emulators */\r\nexport const TERMINAL_EMULATORS = [\"ghostty\", \"kitty\", \"alacritty\", \"wezterm\", \"iterm2\"] as const;\r\n"]}