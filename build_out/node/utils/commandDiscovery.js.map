{"version":3,"file":"commandDiscovery.js","sourceRoot":"","sources":["../../../src/node/utils/commandDiscovery.ts"],"names":[],"mappings":";AAAA;;;GAGG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEH,MAAY,EAAE,wCAAoB;AAClC,iDAA0C;AAE1C,wDAAwD;AACxD,MAAM,eAAe,GAA6B;IAChD,MAAM,EAAE,CAAC,4DAA4D,EAAE,uBAAuB,CAAC;IAC/F,IAAI,EAAE;QACJ,sEAAsE;QACtE,qBAAqB;KACtB;IACD,GAAG,EAAE,CAAC,0CAA0C,EAAE,oBAAoB,CAAC;IACvE,IAAI,EAAE,CAAC,gEAAgE,EAAE,qBAAqB,CAAC;IAC/F,OAAO,EAAE;QACP,2BAA2B;QAC3B,kDAAkD;QAClD,wBAAwB;KACzB;CACF,CAAC;AAEF;;;GAGG;AACI,KAAK,6BAA6B,OAAe,EAAoB;IAC1E,mCAAmC;IACnC,IAAI,OAAO,CAAC,QAAQ,KAAK,QAAQ,IAAI,OAAO,IAAI,eAAe,EAAE,CAAC;QAChE,KAAK,MAAM,OAAO,IAAI,eAAe,CAAC,OAAO,CAAC,EAAE,CAAC;YAC/C,IAAI,CAAC;gBACH,MAAM,KAAK,GAAG,MAAM,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;gBACrC,qDAAqD;gBACrD,IAAI,KAAK,CAAC,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC;oBACjD,OAAO,IAAI,CAAC;gBACd,CAAC;YACH,CAAC;YAAC,MAAM,CAAC;gBACP,gBAAgB;YAClB,CAAC;QACH,CAAC;IACH,CAAC;IAED,+DAA+D;IAC/D,IAAI,CAAC;QACH,MAAM,MAAM,GAAG,IAAA,yBAAS,EAAC,OAAO,EAAE,CAAC,OAAO,CAAC,EAAE,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC,CAAC;QACnE,OAAO,MAAM,CAAC,MAAM,KAAK,CAAC,CAAC;IAC7B,CAAC;IAAC,MAAM,CAAC;QACP,OAAO,KAAK,CAAC;IACf,CAAC;AAAA,CACF;AAED;;;GAGG;AACI,KAAK,+BAA+B,QAAkB,EAA0B;IACrF,KAAK,MAAM,GAAG,IAAI,QAAQ,EAAE,CAAC;QAC3B,IAAI,MAAM,kBAAkB,CAAC,GAAG,CAAC,EAAE,CAAC;YAClC,OAAO,GAAG,CAAC;QACb,CAAC;IACH,CAAC;IACD,OAAO,IAAI,CAAC;AAAA,CACb;AAED,2DAA2D;AAC9C,QAAA,WAAW,GAAG,CAAC,QAAQ,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,CAAU,CAAC;AAEtE,uDAAuD;AAC1C,QAAA,gBAAgB,GAAG,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,CAAU,CAAC;AAEhF,uCAAuC;AAC1B,QAAA,kBAAkB,GAAG,CAAC,SAAS,EAAE,OAAO,EAAE,WAAW,EAAE,SAAS,EAAE,QAAQ,CAAU,CAAC","sourcesContent":["/**\n * Utilities for discovering available commands in the system.\n * Used by terminalService and openInEditor to find executables.\n */\n\nimport * as fs from \"fs/promises\";\nimport { spawnSync } from \"child_process\";\n\n/** Known installation paths for GUI editors on macOS */\nconst MACOS_APP_PATHS: Record<string, string[]> = {\n  cursor: [\"/Applications/Cursor.app/Contents/Resources/app/bin/cursor\", \"/usr/local/bin/cursor\"],\n  code: [\n    \"/Applications/Visual Studio Code.app/Contents/Resources/app/bin/code\",\n    \"/usr/local/bin/code\",\n  ],\n  zed: [\"/Applications/Zed.app/Contents/MacOS/cli\", \"/usr/local/bin/zed\"],\n  subl: [\"/Applications/Sublime Text.app/Contents/SharedSupport/bin/subl\", \"/usr/local/bin/subl\"],\n  ghostty: [\n    \"/opt/homebrew/bin/ghostty\",\n    \"/Applications/Ghostty.app/Contents/MacOS/ghostty\",\n    \"/usr/local/bin/ghostty\",\n  ],\n};\n\n/**\n * Check if a command is available in the system PATH or known locations.\n * First checks macOS-specific paths for known apps, then falls back to `which`.\n */\nexport async function isCommandAvailable(command: string): Promise<boolean> {\n  // Check known paths for macOS apps\n  if (process.platform === \"darwin\" && command in MACOS_APP_PATHS) {\n    for (const appPath of MACOS_APP_PATHS[command]) {\n      try {\n        const stats = await fs.stat(appPath);\n        // Check if it's a file and any executable bit is set\n        if (stats.isFile() && (stats.mode & 0o111) !== 0) {\n          return true;\n        }\n      } catch {\n        // Try next path\n      }\n    }\n  }\n\n  // Fall back to which (inherits enriched PATH from process.env)\n  try {\n    const result = spawnSync(\"which\", [command], { encoding: \"utf8\" });\n    return result.status === 0;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Find the first available command from a list of candidates.\n * Returns the command name (not full path) of the first available one.\n */\nexport async function findAvailableCommand(commands: string[]): Promise<string | null> {\n  for (const cmd of commands) {\n    if (await isCommandAvailable(cmd)) {\n      return cmd;\n    }\n  }\n  return null;\n}\n\n/** GUI editors that spawn detached (no terminal needed) */\nexport const GUI_EDITORS = [\"cursor\", \"code\", \"zed\", \"subl\"] as const;\n\n/** Terminal editors that require a terminal session */\nexport const TERMINAL_EDITORS = [\"nvim\", \"vim\", \"vi\", \"nano\", \"emacs\"] as const;\n\n/** All known GUI terminal emulators */\nexport const TERMINAL_EMULATORS = [\"ghostty\", \"kitty\", \"alacritty\", \"wezterm\", \"iterm2\"] as const;\n"]}