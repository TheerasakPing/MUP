{"version":3,"file":"extensionMetadata.js","sourceRoot":"","sources":["../../../src/node/utils/extensionMetadata.ts"],"names":[],"mappings":";;;;AAAA,2BAA8C;AAE9C,oDAAuE;AACvE,sDAA8E;AAC9E,6CAA0C;AAqB1C;;;GAGG;AACH,kCAAyC,OAAgB,EAAU;IACjE,OAAO,IAAA,mCAA2B,EAAC,OAAO,CAAC,CAAC;AAAA,CAC7C;AAED;;;;GAIG;AACH,iCAAwE;IACtE,MAAM,YAAY,GAAG,wBAAwB,EAAE,CAAC;IAEhD,IAAI,CAAC,IAAA,eAAU,EAAC,YAAY,CAAC,EAAE,CAAC;QAC9B,OAAO,IAAI,GAAG,EAAE,CAAC;IACnB,CAAC;IAED,IAAI,CAAC;QACH,MAAM,OAAO,GAAG,IAAA,iBAAY,EAAC,YAAY,EAAE,OAAO,CAAC,CAAC;QACpD,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAA0B,CAAC;QAE1D,qBAAqB;QACrB,IAAI,OAAO,IAAI,KAAK,QAAQ,IAAI,IAAI,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;YACnD,SAAG,CAAC,KAAK,CAAC,8BAA8B,CAAC,CAAC;YAC1C,OAAO,IAAI,GAAG,EAAE,CAAC;QACnB,CAAC;QAED,MAAM,GAAG,GAAG,IAAI,GAAG,EAA6B,CAAC;QACjD,KAAK,MAAM,CAAC,WAAW,EAAE,QAAQ,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,IAAI,EAAE,CAAC,EAAE,CAAC;YAC5E,MAAM,gBAAgB,GAAI,QAA4C,CAAC,iBAAiB,CAAC;YACzF,GAAG,CAAC,GAAG,CAAC,WAAW,EAAE;gBACnB,OAAO,EAAE,QAAQ,CAAC,OAAO;gBACzB,SAAS,EAAE,QAAQ,CAAC,SAAS;gBAC7B,SAAS,EAAE,QAAQ,CAAC,SAAS,IAAI,IAAI;gBACrC,iBAAiB,EAAE,IAAA,0BAAe,EAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC,CAAC,IAAI;aAC/E,CAAC,CAAC;QACL,CAAC;QAED,OAAO,GAAG,CAAC;IACb,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,SAAG,CAAC,KAAK,CAAC,0BAA0B,EAAE,KAAK,CAAC,CAAC;QAC7C,OAAO,IAAI,GAAG,EAAE,CAAC;IACnB,CAAC;AAAA,CACF","sourcesContent":["import { readFileSync, existsSync } from \"fs\";\r\n\r\nimport { getMuxExtensionMetadataPath } from \"@/common/constants/paths\";\r\nimport { isThinkingLevel, type ThinkingLevel } from \"@/common/types/thinking\";\r\nimport { log } from \"@/node/services/log\";\r\n\r\n/**\r\n * Extension metadata for a single workspace.\r\n * Shared between main app (ExtensionMetadataService) and VS Code extension.\r\n */\r\nexport interface ExtensionMetadata {\r\n  recency: number;\r\n  streaming: boolean;\r\n  lastModel: string | null;\r\n  lastThinkingLevel: ThinkingLevel | null;\r\n}\r\n\r\n/**\r\n * File structure for extensionMetadata.json\r\n */\r\nexport interface ExtensionMetadataFile {\r\n  version: 1;\r\n  workspaces: Record<string, ExtensionMetadata>;\r\n}\r\n\r\n/**\r\n * Get the path to the extension metadata file.\r\n * @param rootDir - Optional root directory (defaults to getMuxHome())\r\n */\r\nexport function getExtensionMetadataPath(rootDir?: string): string {\r\n  return getMuxExtensionMetadataPath(rootDir);\r\n}\r\n\r\n/**\r\n * Read extension metadata from JSON file.\r\n * Returns a map of workspace ID to metadata.\r\n * Used by both the main app and VS Code extension.\r\n */\r\nexport function readExtensionMetadata(): Map<string, ExtensionMetadata> {\r\n  const metadataPath = getExtensionMetadataPath();\r\n\r\n  if (!existsSync(metadataPath)) {\r\n    return new Map();\r\n  }\r\n\r\n  try {\r\n    const content = readFileSync(metadataPath, \"utf-8\");\r\n    const data = JSON.parse(content) as ExtensionMetadataFile;\r\n\r\n    // Validate structure\r\n    if (typeof data !== \"object\" || data.version !== 1) {\r\n      log.error(\"Invalid metadata file format\");\r\n      return new Map();\r\n    }\r\n\r\n    const map = new Map<string, ExtensionMetadata>();\r\n    for (const [workspaceId, metadata] of Object.entries(data.workspaces || {})) {\r\n      const rawThinkingLevel = (metadata as { lastThinkingLevel?: unknown }).lastThinkingLevel;\r\n      map.set(workspaceId, {\r\n        recency: metadata.recency,\r\n        streaming: metadata.streaming,\r\n        lastModel: metadata.lastModel ?? null,\r\n        lastThinkingLevel: isThinkingLevel(rawThinkingLevel) ? rawThinkingLevel : null,\r\n      });\r\n    }\r\n\r\n    return map;\r\n  } catch (error) {\r\n    log.error(\"Failed to read metadata:\", error);\r\n    return new Map();\r\n  }\r\n}\r\n"]}