{"version":3,"file":"extensionMetadata.js","sourceRoot":"","sources":["../../../src/node/utils/extensionMetadata.ts"],"names":[],"mappings":";;;;AAAA,2BAA8C;AAE9C,oDAAuE;AACvE,sDAA8E;AAC9E,6CAA0C;AAqB1C;;;GAGG;AACH,kCAAyC,OAAgB,EAAU;IACjE,OAAO,IAAA,mCAA2B,EAAC,OAAO,CAAC,CAAC;AAAA,CAC7C;AAED;;;;GAIG;AACH,iCAAwE;IACtE,MAAM,YAAY,GAAG,wBAAwB,EAAE,CAAC;IAEhD,IAAI,CAAC,IAAA,eAAU,EAAC,YAAY,CAAC,EAAE,CAAC;QAC9B,OAAO,IAAI,GAAG,EAAE,CAAC;IACnB,CAAC;IAED,IAAI,CAAC;QACH,MAAM,OAAO,GAAG,IAAA,iBAAY,EAAC,YAAY,EAAE,OAAO,CAAC,CAAC;QACpD,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAA0B,CAAC;QAE1D,qBAAqB;QACrB,IAAI,OAAO,IAAI,KAAK,QAAQ,IAAI,IAAI,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;YACnD,SAAG,CAAC,KAAK,CAAC,8BAA8B,CAAC,CAAC;YAC1C,OAAO,IAAI,GAAG,EAAE,CAAC;QACnB,CAAC;QAED,MAAM,GAAG,GAAG,IAAI,GAAG,EAA6B,CAAC;QACjD,KAAK,MAAM,CAAC,WAAW,EAAE,QAAQ,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,IAAI,EAAE,CAAC,EAAE,CAAC;YAC5E,MAAM,gBAAgB,GAAI,QAA4C,CAAC,iBAAiB,CAAC;YACzF,GAAG,CAAC,GAAG,CAAC,WAAW,EAAE;gBACnB,OAAO,EAAE,QAAQ,CAAC,OAAO;gBACzB,SAAS,EAAE,QAAQ,CAAC,SAAS;gBAC7B,SAAS,EAAE,QAAQ,CAAC,SAAS,IAAI,IAAI;gBACrC,iBAAiB,EAAE,IAAA,0BAAe,EAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC,CAAC,IAAI;aAC/E,CAAC,CAAC;QACL,CAAC;QAED,OAAO,GAAG,CAAC;IACb,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,SAAG,CAAC,KAAK,CAAC,0BAA0B,EAAE,KAAK,CAAC,CAAC;QAC7C,OAAO,IAAI,GAAG,EAAE,CAAC;IACnB,CAAC;AAAA,CACF","sourcesContent":["import { readFileSync, existsSync } from \"fs\";\n\nimport { getMuxExtensionMetadataPath } from \"@/common/constants/paths\";\nimport { isThinkingLevel, type ThinkingLevel } from \"@/common/types/thinking\";\nimport { log } from \"@/node/services/log\";\n\n/**\n * Extension metadata for a single workspace.\n * Shared between main app (ExtensionMetadataService) and VS Code extension.\n */\nexport interface ExtensionMetadata {\n  recency: number;\n  streaming: boolean;\n  lastModel: string | null;\n  lastThinkingLevel: ThinkingLevel | null;\n}\n\n/**\n * File structure for extensionMetadata.json\n */\nexport interface ExtensionMetadataFile {\n  version: 1;\n  workspaces: Record<string, ExtensionMetadata>;\n}\n\n/**\n * Get the path to the extension metadata file.\n * @param rootDir - Optional root directory (defaults to getMuxHome())\n */\nexport function getExtensionMetadataPath(rootDir?: string): string {\n  return getMuxExtensionMetadataPath(rootDir);\n}\n\n/**\n * Read extension metadata from JSON file.\n * Returns a map of workspace ID to metadata.\n * Used by both the main app and VS Code extension.\n */\nexport function readExtensionMetadata(): Map<string, ExtensionMetadata> {\n  const metadataPath = getExtensionMetadataPath();\n\n  if (!existsSync(metadataPath)) {\n    return new Map();\n  }\n\n  try {\n    const content = readFileSync(metadataPath, \"utf-8\");\n    const data = JSON.parse(content) as ExtensionMetadataFile;\n\n    // Validate structure\n    if (typeof data !== \"object\" || data.version !== 1) {\n      log.error(\"Invalid metadata file format\");\n      return new Map();\n    }\n\n    const map = new Map<string, ExtensionMetadata>();\n    for (const [workspaceId, metadata] of Object.entries(data.workspaces || {})) {\n      const rawThinkingLevel = (metadata as { lastThinkingLevel?: unknown }).lastThinkingLevel;\n      map.set(workspaceId, {\n        recency: metadata.recency,\n        streaming: metadata.streaming,\n        lastModel: metadata.lastModel ?? null,\n        lastThinkingLevel: isThinkingLevel(rawThinkingLevel) ? rawThinkingLevel : null,\n      });\n    }\n\n    return map;\n  } catch (error) {\n    log.error(\"Failed to read metadata:\", error);\n    return new Map();\n  }\n}\n"]}