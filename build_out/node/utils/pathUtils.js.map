{"version":3,"file":"pathUtils.js","sourceRoot":"","sources":["../../../src/node/utils/pathUtils.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAY,EAAE,wCAAoB;AAClC,MAAY,IAAI,iCAAa;AAC7B,6CAA6C;AAW7C;;;;;;;;;;GAUG;AACH,qBAA4B,SAAiB,EAAU;IACrD,OAAO,0BAAa,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;AAAA,CAC5C;AAED;;;;;;;;;;GAUG;AACH,8BAAqC,SAAiB,EAAU;IAC9D,OAAO,SAAS,CAAC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;AAAA,CACzC;AAED;;;;;;;;;;;;;;;GAeG;AACI,KAAK,8BAA8B,SAAiB,EAAiC;IAC1F,0BAA0B;IAC1B,MAAM,YAAY,GAAG,WAAW,CAAC,SAAS,CAAC,CAAC;IAE5C,4EAA4E;IAC5E,MAAM,cAAc,GAAG,oBAAoB,CAAC,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC,CAAC;IAE1E,uBAAuB;IACvB,IAAI,CAAC;QACH,MAAM,KAAK,GAAG,MAAM,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAE5C,4BAA4B;QAC5B,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,EAAE,CAAC;YACzB,OAAO;gBACL,KAAK,EAAE,KAAK;gBACZ,KAAK,EAAE,4BAA4B,cAAc,EAAE;aACpD,CAAC;QACJ,CAAC;IACH,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACb,IAAK,GAA6B,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;YACrD,OAAO;gBACL,KAAK,EAAE,KAAK;gBACZ,KAAK,EAAE,wBAAwB,cAAc,EAAE;aAChD,CAAC;QACJ,CAAC;QACD,MAAM,GAAG,CAAC;IACZ,CAAC;IAED,OAAO;QACL,KAAK,EAAE,IAAI;QACX,YAAY,EAAE,cAAc;KAC7B,CAAC;AAAA,CACH;AAED;;;;;GAKG;AACI,KAAK,0BAA0B,WAAmB,EAAoB;IAC3E,MAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,MAAM,CAAC,CAAC;IAC/C,IAAI,CAAC;QACH,MAAM,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACvB,OAAO,IAAI,CAAC;IACd,CAAC;IAAC,MAAM,CAAC;QACP,OAAO,KAAK,CAAC;IACf,CAAC;AAAA,CACF","sourcesContent":["import * as fs from \"fs/promises\";\r\nimport * as path from \"path\";\r\nimport { PlatformPaths } from \"./paths.main\";\r\n\r\n/**\r\n * Result of path validation\r\n */\r\nexport interface PathValidationResult {\r\n  valid: boolean;\r\n  expandedPath?: string;\r\n  error?: string;\r\n}\r\n\r\n/**\r\n * Expand tilde (~) in paths to the user's home directory\r\n *\r\n * @param inputPath - Path that may contain tilde\r\n * @returns Path with tilde expanded to home directory\r\n *\r\n * @example\r\n * expandTilde(\"~/Documents\") // => \"/home/user/Documents\"\r\n * expandTilde(\"~\") // => \"/home/user\"\r\n * expandTilde(\"/absolute/path\") // => \"/absolute/path\"\r\n */\r\nexport function expandTilde(inputPath: string): string {\r\n  return PlatformPaths.expandHome(inputPath);\r\n}\r\n\r\n/**\r\n * Strip trailing slashes from a path.\r\n * path.normalize() preserves a single trailing slash which breaks basename extraction.\r\n *\r\n * @param inputPath - Path that may have trailing slashes\r\n * @returns Path without trailing slashes\r\n *\r\n * @example\r\n * stripTrailingSlashes(\"/home/user/project/\") // => \"/home/user/project\"\r\n * stripTrailingSlashes(\"/home/user/project//\") // => \"/home/user/project\"\r\n */\r\nexport function stripTrailingSlashes(inputPath: string): string {\r\n  return inputPath.replace(/[/\\\\]+$/, \"\");\r\n}\r\n\r\n/**\r\n * Validate that a project path exists and is a directory.\r\n * Git repository status is checked separately - non-git repos are valid\r\n * but will be restricted to local runtime only.\r\n * Automatically expands tilde and normalizes the path.\r\n *\r\n * @param inputPath - Path to validate (may contain tilde)\r\n * @returns Validation result with expanded path or error\r\n *\r\n * @example\r\n * await validateProjectPath(\"~/my-project\")\r\n * // => { valid: true, expandedPath: \"/home/user/my-project\" }\r\n *\r\n * await validateProjectPath(\"~/nonexistent\")\r\n * // => { valid: false, error: \"Path does not exist: /home/user/nonexistent\" }\r\n */\r\nexport async function validateProjectPath(inputPath: string): Promise<PathValidationResult> {\r\n  // Expand tilde if present\r\n  const expandedPath = expandTilde(inputPath);\r\n\r\n  // Normalize to resolve any .. or . in the path, then strip trailing slashes\r\n  const normalizedPath = stripTrailingSlashes(path.normalize(expandedPath));\r\n\r\n  // Check if path exists\r\n  try {\r\n    const stats = await fs.stat(normalizedPath);\r\n\r\n    // Check if it's a directory\r\n    if (!stats.isDirectory()) {\r\n      return {\r\n        valid: false,\r\n        error: `Path is not a directory: ${normalizedPath}`,\r\n      };\r\n    }\r\n  } catch (err) {\r\n    if ((err as NodeJS.ErrnoException).code === \"ENOENT\") {\r\n      return {\r\n        valid: false,\r\n        error: `Path does not exist: ${normalizedPath}`,\r\n      };\r\n    }\r\n    throw err;\r\n  }\r\n\r\n  return {\r\n    valid: true,\r\n    expandedPath: normalizedPath,\r\n  };\r\n}\r\n\r\n/**\r\n * Check if a path is a git repository\r\n *\r\n * @param projectPath - Path to check (should be already validated/normalized)\r\n * @returns true if the path contains a .git directory\r\n */\r\nexport async function isGitRepository(projectPath: string): Promise<boolean> {\r\n  const gitPath = path.join(projectPath, \".git\");\r\n  try {\r\n    await fs.stat(gitPath);\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n"]}