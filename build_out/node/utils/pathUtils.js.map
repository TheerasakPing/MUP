{"version":3,"file":"pathUtils.js","sourceRoot":"","sources":["../../../src/node/utils/pathUtils.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAY,EAAE,wCAAoB;AAClC,MAAY,IAAI,iCAAa;AAC7B,6CAA6C;AAW7C;;;;;;;;;;GAUG;AACH,qBAA4B,SAAiB,EAAU;IACrD,OAAO,0BAAa,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;AAAA,CAC5C;AAED;;;;;;;;;;GAUG;AACH,8BAAqC,SAAiB,EAAU;IAC9D,OAAO,SAAS,CAAC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;AAAA,CACzC;AAED;;;;;;;;;;;;;;;GAeG;AACI,KAAK,8BAA8B,SAAiB,EAAiC;IAC1F,0BAA0B;IAC1B,MAAM,YAAY,GAAG,WAAW,CAAC,SAAS,CAAC,CAAC;IAE5C,4EAA4E;IAC5E,MAAM,cAAc,GAAG,oBAAoB,CAAC,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC,CAAC;IAE1E,uBAAuB;IACvB,IAAI,CAAC;QACH,MAAM,KAAK,GAAG,MAAM,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAE5C,4BAA4B;QAC5B,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,EAAE,CAAC;YACzB,OAAO;gBACL,KAAK,EAAE,KAAK;gBACZ,KAAK,EAAE,4BAA4B,cAAc,EAAE;aACpD,CAAC;QACJ,CAAC;IACH,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACb,IAAK,GAA6B,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;YACrD,OAAO;gBACL,KAAK,EAAE,KAAK;gBACZ,KAAK,EAAE,wBAAwB,cAAc,EAAE;aAChD,CAAC;QACJ,CAAC;QACD,MAAM,GAAG,CAAC;IACZ,CAAC;IAED,OAAO;QACL,KAAK,EAAE,IAAI;QACX,YAAY,EAAE,cAAc;KAC7B,CAAC;AAAA,CACH;AAED;;;;;GAKG;AACI,KAAK,0BAA0B,WAAmB,EAAoB;IAC3E,MAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,MAAM,CAAC,CAAC;IAC/C,IAAI,CAAC;QACH,MAAM,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACvB,OAAO,IAAI,CAAC;IACd,CAAC;IAAC,MAAM,CAAC;QACP,OAAO,KAAK,CAAC;IACf,CAAC;AAAA,CACF","sourcesContent":["import * as fs from \"fs/promises\";\nimport * as path from \"path\";\nimport { PlatformPaths } from \"./paths.main\";\n\n/**\n * Result of path validation\n */\nexport interface PathValidationResult {\n  valid: boolean;\n  expandedPath?: string;\n  error?: string;\n}\n\n/**\n * Expand tilde (~) in paths to the user's home directory\n *\n * @param inputPath - Path that may contain tilde\n * @returns Path with tilde expanded to home directory\n *\n * @example\n * expandTilde(\"~/Documents\") // => \"/home/user/Documents\"\n * expandTilde(\"~\") // => \"/home/user\"\n * expandTilde(\"/absolute/path\") // => \"/absolute/path\"\n */\nexport function expandTilde(inputPath: string): string {\n  return PlatformPaths.expandHome(inputPath);\n}\n\n/**\n * Strip trailing slashes from a path.\n * path.normalize() preserves a single trailing slash which breaks basename extraction.\n *\n * @param inputPath - Path that may have trailing slashes\n * @returns Path without trailing slashes\n *\n * @example\n * stripTrailingSlashes(\"/home/user/project/\") // => \"/home/user/project\"\n * stripTrailingSlashes(\"/home/user/project//\") // => \"/home/user/project\"\n */\nexport function stripTrailingSlashes(inputPath: string): string {\n  return inputPath.replace(/[/\\\\]+$/, \"\");\n}\n\n/**\n * Validate that a project path exists and is a directory.\n * Git repository status is checked separately - non-git repos are valid\n * but will be restricted to local runtime only.\n * Automatically expands tilde and normalizes the path.\n *\n * @param inputPath - Path to validate (may contain tilde)\n * @returns Validation result with expanded path or error\n *\n * @example\n * await validateProjectPath(\"~/my-project\")\n * // => { valid: true, expandedPath: \"/home/user/my-project\" }\n *\n * await validateProjectPath(\"~/nonexistent\")\n * // => { valid: false, error: \"Path does not exist: /home/user/nonexistent\" }\n */\nexport async function validateProjectPath(inputPath: string): Promise<PathValidationResult> {\n  // Expand tilde if present\n  const expandedPath = expandTilde(inputPath);\n\n  // Normalize to resolve any .. or . in the path, then strip trailing slashes\n  const normalizedPath = stripTrailingSlashes(path.normalize(expandedPath));\n\n  // Check if path exists\n  try {\n    const stats = await fs.stat(normalizedPath);\n\n    // Check if it's a directory\n    if (!stats.isDirectory()) {\n      return {\n        valid: false,\n        error: `Path is not a directory: ${normalizedPath}`,\n      };\n    }\n  } catch (err) {\n    if ((err as NodeJS.ErrnoException).code === \"ENOENT\") {\n      return {\n        valid: false,\n        error: `Path does not exist: ${normalizedPath}`,\n      };\n    }\n    throw err;\n  }\n\n  return {\n    valid: true,\n    expandedPath: normalizedPath,\n  };\n}\n\n/**\n * Check if a path is a git repository\n *\n * @param projectPath - Path to check (should be already validated/normalized)\n * @returns true if the path contains a .git directory\n */\nexport async function isGitRepository(projectPath: string): Promise<boolean> {\n  const gitPath = path.join(projectPath, \".git\");\n  try {\n    await fs.stat(gitPath);\n    return true;\n  } catch {\n    return false;\n  }\n}\n"]}