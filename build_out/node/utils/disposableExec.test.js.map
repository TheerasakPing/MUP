{"version":3,"file":"disposableExec.test.js","sourceRoot":"","sources":["../../../src/node/utils/disposableExec.test.ts"],"names":[],"mappings":";AAAA,4DAA4D;AAC5D,+DAA+D;AAC/D,uDAAuD;AACvD,0DAA0D;AAC1D,sDAAsD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGtD,2CAA8E;AAC9E,qDAA6C;AAE7C;;;;;GAKG;AAEH,IAAA,kBAAQ,EAAC,gBAAgB,EAAE,GAAG,EAAE,CAAC;IAC/B,MAAM,eAAe,GAAG,IAAI,GAAG,EAAgB,CAAC;IAEhD,IAAA,oBAAU,EAAC,GAAG,EAAE,CAAC;QACf,eAAe,CAAC,KAAK,EAAE,CAAC;IAAA,CACzB,CAAC,CAAC;IAEH,IAAA,mBAAS,EAAC,GAAG,EAAE,CAAC;QACd,sDAAsD;QACtD,KAAK,MAAM,IAAI,IAAI,eAAe,EAAE,CAAC;YACnC,MAAM,SAAS,GAAG,IAAI,CAAC,QAAQ,KAAK,IAAI,IAAI,IAAI,CAAC,UAAU,KAAK,IAAI,CAAC;YACrE,IAAA,gBAAM,EAAC,SAAS,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC5C,IAAI,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;gBAC/B,IAAI,CAAC,IAAI,EAAE,CAAC;YACd,CAAC;QACH,CAAC;QACD,eAAe,CAAC,KAAK,EAAE,CAAC;IAAA,CACzB,CAAC,CAAC;IAEH,IAAA,cAAI,EAAC,0DAA0D,EAAE,KAAK,IAAI,EAAE,CAAC;QAC3E,IAAI,SAAuB,CAAC;QAE5B,CAAC;;;gBACC,MAAM,IAAI,kCAAG,IAAA,0BAAS,EAAC,oBAAoB,CAAC,QAAA,CAAC;gBAC7C,SAAS,GAAI,IAAY,CAAC,KAAK,CAAC;gBAChC,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;gBAE/B,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC;gBACrC,IAAA,gBAAM,EAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;;;;;;;;;QAC5C,CAAC;QAED,6CAA6C;QAC7C,IAAA,gBAAM,EAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACnC,IAAA,gBAAM,EAAC,SAAS,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CACtC,CAAC,CAAC;IAEH,IAAA,cAAI,EAAC,sDAAsD,EAAE,KAAK,IAAI,EAAE,CAAC;;;YACvE,MAAM,IAAI,kCAAG,IAAA,0BAAS,EAAC,QAAQ,CAAC,QAAA,CAAC;YACjC,MAAM,SAAS,GAAkB,IAAY,CAAC,KAAK,CAAC;YACpD,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;YAE/B,IAAI,CAAC;gBACH,MAAM,IAAI,CAAC,MAAM,CAAC;gBAClB,IAAA,gBAAM,EAAC,IAAI,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,wBAAwB;YACpD,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,IAAA,gBAAM,EAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC7B,CAAC;YAED,6CAA6C;YAC7C,IAAA,gBAAM,EAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YACnC,IAAA,gBAAM,EAAC,SAAS,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;;;;;;;;;IAAA,CACtC,CAAC,CAAC;IAEH,IAAA,cAAI,EAAC,+CAA+C,EAAE,KAAK,IAAI,EAAE,CAAC;QAChE,MAAM,IAAI,GAAG,IAAA,0BAAS,EAAC,SAAS,CAAC,CAAC;QAClC,MAAM,SAAS,GAAkB,IAAY,CAAC,KAAK,CAAC;QACpD,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QAE/B,6BAA6B;QAC7B,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,CAAC;QAExD,IAAA,gBAAM,EAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,QAAQ,EAAE,CAAC;QACtC,IAAA,gBAAM,EAAC,SAAS,CAAC,UAAU,CAAC,CAAC,QAAQ,EAAE,CAAC;QAExC,uCAAuC;QACvC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;QAEvB,gCAAgC;QAChC,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC;YAC7B,IAAI,SAAS,CAAC,MAAM,EAAE,CAAC;gBACrB,OAAO,CAAC,SAAS,CAAC,CAAC;YACrB,CAAC;iBAAM,CAAC;gBACN,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;YACnD,CAAC;QAAA,CACF,CAAC,CAAC;QAEH,2BAA2B;QAC3B,IAAA,gBAAM,EAAC,SAAS,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAEpC,kDAAkD;QAClD,MAAM,IAAA,gBAAM,EAAC,IAAI,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;IAAA,CAC7C,CAAC,CAAC;IAEH,IAAA,cAAI,EAAC,qDAAqD,EAAE,KAAK,IAAI,EAAE,CAAC;QACtE,IAAI,SAAuB,CAAC;QAC5B,IAAI,aAA0D,CAAC;QAE/D,CAAC;;;gBACC,MAAM,IAAI,kCAAG,IAAA,0BAAS,EAAC,SAAS,CAAC,QAAA,CAAC;gBAClC,SAAS,GAAI,IAAY,CAAC,KAAK,CAAC;gBAChC,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC;gBAC5B,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;gBAE/B,6BAA6B;gBAC7B,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,CAAC;gBAExD,IAAA,gBAAM,EAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,QAAQ,EAAE,CAAC;gBACtC,IAAA,gBAAM,EAAC,SAAS,CAAC,UAAU,CAAC,CAAC,QAAQ,EAAE,CAAC;;;;;;;;;YACxC,uCAAuC;QACzC,CAAC;QAED,gCAAgC;QAChC,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC;YAC7B,IAAI,SAAS,CAAC,MAAM,IAAI,SAAS,CAAC,QAAQ,KAAK,IAAI,EAAE,CAAC;gBACpD,OAAO,CAAC,SAAS,CAAC,CAAC;YACrB,CAAC;iBAAM,CAAC;gBACN,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;YACnD,CAAC;QAAA,CACF,CAAC,CAAC;QAEH,2BAA2B;QAC3B,IAAA,gBAAM,EAAC,SAAS,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAEpC,0CAA0C;QAC1C,MAAM,IAAA,gBAAM,EAAC,aAAa,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;IAAA,CAC/C,CAAC,CAAC;IAEH,IAAA,cAAI,EAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE,CAAC;QAC3D,MAAM,IAAI,GAAG,IAAA,0BAAS,EAAC,aAAa,CAAC,CAAC;QACtC,MAAM,SAAS,GAAkB,IAAY,CAAC,KAAK,CAAC;QACpD,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QAE/B,MAAM,IAAI,CAAC,MAAM,CAAC;QAElB,yBAAyB;QACzB,IAAA,gBAAM,EAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAEnC,mCAAmC;QACnC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;QAEvB,2BAA2B;QAC3B,IAAA,gBAAM,EAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACnC,IAAA,gBAAM,EAAC,SAAS,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CACtC,CAAC,CAAC;IAEH,IAAA,cAAI,EAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE,CAAC;;;YAC3D,MAAM,IAAI,kCAAG,IAAA,0BAAS,EAAC,oDAAoD,CAAC,QAAA,CAAC;YAC7E,MAAM,SAAS,GAAI,IAAY,CAAC,KAAK,CAAC;YACtC,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;YAE/B,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC;YAC7C,IAAA,gBAAM,EAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAC7C,IAAA,gBAAM,EAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;;;;;;;;;IAAA,CAC9C,CAAC,CAAC;IAEH,IAAA,cAAI,EAAC,+BAA+B,EAAE,KAAK,IAAI,EAAE,CAAC;QAChD,IAAI,CAAC;;;gBACH,MAAM,IAAI,kCAAG,IAAA,0BAAS,EAAC,qCAAqC,CAAC,QAAA,CAAC;gBAC9D,MAAM,SAAS,GAAI,IAAY,CAAC,KAAK,CAAC;gBACtC,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;gBAE/B,MAAM,IAAI,CAAC,MAAM,CAAC;gBAClB,IAAA,gBAAM,EAAC,IAAI,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,mBAAmB;;;;;;;;;QAC/C,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,IAAA,gBAAM,EAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YAC5B,IAAA,gBAAM,EAAC,KAAK,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;YAClD,IAAA,gBAAM,EAAC,KAAK,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC;QACnD,CAAC;IAAA,CACF,CAAC,CAAC;IAEH,IAAA,cAAI,EAAC,6CAA6C,EAAE,KAAK,IAAI,EAAE,CAAC;QAC9D,MAAM,UAAU,GAAmB,EAAE,CAAC;QAEtC,MAAM,OAAO,CAAC,GAAG,CACf,KAAK,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;;;gBACxC,MAAM,IAAI,kCAAG,IAAA,0BAAS,EAAC,iBAAiB,CAAC,GAAG,CAAC,QAAA,CAAC;gBAC9C,MAAM,SAAS,GAAI,IAAY,CAAC,KAAK,CAAC;gBACtC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gBAC3B,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;gBAE/B,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC;gBACrC,IAAA,gBAAM,EAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;;;;;;;;;QAAA,CAC5C,CAAC,CACH,CAAC;QAEF,iCAAiC;QACjC,KAAK,MAAM,IAAI,IAAI,UAAU,EAAE,CAAC;YAC9B,IAAA,gBAAM,EAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAChC,CAAC;IAAA,CACF,CAAC,CAAC;IAEH,IAAA,cAAI,EAAC,mDAAmD,EAAE,KAAK,IAAI,EAAE,CAAC;QACpE,IAAI,SAAmC,CAAC;QACxC,IAAI,aAAsE,CAAC;QAE3E,IAAI,CAAC;;;gBACH,MAAM,IAAI,kCAAG,IAAA,0BAAS,EAAC,SAAS,CAAC,QAAA,CAAC;gBAClC,SAAS,GAAI,IAAY,CAAC,KAAqB,CAAC;gBAChD,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC;gBAC5B,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;gBAE/B,6BAA6B;gBAC7B,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,CAAC;gBAExD,wFAAwF;gBACxF,MAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC;;;;;;;;;QACrC,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,IAAA,gBAAM,EAAC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAChD,CAAC;QAED,gCAAgC;QAChC,IAAI,SAAS,EAAE,CAAC;YACd,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC;gBAC7B,IAAI,SAAS,CAAC,MAAM,IAAI,SAAS,CAAC,QAAQ,KAAK,IAAI,EAAE,CAAC;oBACpD,OAAO,CAAC,SAAS,CAAC,CAAC;gBACrB,CAAC;qBAAM,CAAC;oBACN,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;gBACnD,CAAC;YAAA,CACF,CAAC,CAAC;QACL,CAAC;QAED,6CAA6C;QAC7C,IAAA,gBAAM,EAAC,SAAS,EAAE,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAErC,iDAAiD;QACjD,uDAAuD;QACvD,MAAM,IAAA,gBAAM,EAAC,aAAa,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;IAAA,CAC/C,CAAC,CAAC;IAEH,IAAA,cAAI,EAAC,+CAA+C,EAAE,KAAK,IAAI,EAAE,CAAC;;;YAChE,MAAM,IAAI,kCAAG,IAAA,0BAAS,EAAC,SAAS,CAAC,QAAA,CAAC;YAClC,MAAM,SAAS,GAAkB,IAAY,CAAC,KAAK,CAAC;YACpD,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;YAE/B,IAAI,CAAC;gBACH,6BAA6B;gBAC7B,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,CAAC;gBAExD,6BAA6B;gBAC7B,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gBAE1B,MAAM,IAAI,CAAC,MAAM,CAAC;gBAClB,IAAA,gBAAM,EAAC,IAAI,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,mBAAmB;YAC/C,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,IAAA,gBAAM,EAAC,KAAK,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gBACrC,IAAA,gBAAM,EAAC,KAAK,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;YAC7C,CAAC;YAED,iCAAiC;YACjC,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC;gBAC7B,IAAI,SAAS,CAAC,QAAQ,KAAK,IAAI,IAAI,SAAS,CAAC,UAAU,KAAK,IAAI,EAAE,CAAC;oBACjE,OAAO,CAAC,SAAS,CAAC,CAAC;gBACrB,CAAC;qBAAM,CAAC;oBACN,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;gBACnD,CAAC;YAAA,CACF,CAAC,CAAC;YAEH,2BAA2B;YAC3B,IAAA,gBAAM,EAAC,SAAS,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACpC,IAAA,gBAAM,EAAC,SAAS,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;;;;;;;;;IAAA,CAC9C,CAAC,CAAC;IAEH,IAAA,cAAI,EAAC,qDAAqD,EAAE,KAAK,IAAI,EAAE,CAAC;QACtE,MAAM,IAAI,GAAG,IAAA,0BAAS,EAAC,SAAS,CAAC,CAAC;QAClC,MAAM,SAAS,GAAI,IAAY,CAAC,KAAK,CAAC;QACtC,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QAE/B,6BAA6B;QAC7B,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,CAAC;QAExD,sBAAsB;QACtB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;QAEvB,gCAAgC;QAChC,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC;YAC7B,IAAI,SAAS,CAAC,MAAM,IAAI,SAAS,CAAC,QAAQ,KAAK,IAAI,EAAE,CAAC;gBACpD,OAAO,CAAC,SAAS,CAAC,CAAC;YACrB,CAAC;iBAAM,CAAC;gBACN,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;YACnD,CAAC;QAAA,CACF,CAAC,CAAC;QAEH,2BAA2B;QAC3B,IAAA,gBAAM,EAAC,SAAS,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAEpC,yCAAyC;QACzC,MAAM,IAAA,gBAAM,EAAC,IAAI,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;IAAA,CAC7C,CAAC,CAAC;IAEH,IAAA,cAAI,EAAC,wDAAwD,EAAE,KAAK,IAAI,EAAE,CAAC;QACzE,MAAM,IAAI,GAAG,IAAA,0BAAS,EAAC,SAAS,CAAC,CAAC;QAClC,MAAM,SAAS,GAAI,IAAY,CAAC,KAAK,CAAC;QACtC,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QAE/B,6BAA6B;QAC7B,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,CAAC;QAExD,wCAAwC;QACxC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;QACvB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;QACvB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;QAEvB,gCAAgC;QAChC,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC;YAC7B,IAAI,SAAS,CAAC,MAAM,IAAI,SAAS,CAAC,QAAQ,KAAK,IAAI,EAAE,CAAC;gBACpD,OAAO,CAAC,SAAS,CAAC,CAAC;YACrB,CAAC;iBAAM,CAAC;gBACN,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;YACnD,CAAC;QAAA,CACF,CAAC,CAAC;QAEH,gCAAgC;QAChC,IAAA,gBAAM,EAAC,SAAS,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAEpC,0CAA0C;QAC1C,MAAM,IAAA,gBAAM,EAAC,IAAI,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;IAAA,CAC7C,CAAC,CAAC;IAEH,IAAA,cAAI,EAAC,sCAAsC,EAAE,KAAK,IAAI,EAAE,CAAC;;;YACvD,gDAAgD;YAChD,MAAM,WAAW,GAAG,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YACvC,MAAM,IAAI,kCAAG,IAAA,0BAAS,EAAC,SAAS,WAAW,GAAG,CAAC,QAAA,CAAC;YAChD,MAAM,SAAS,GAAI,IAAY,CAAC,KAAK,CAAC;YACtC,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;YAE/B,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC;YAErC,2CAA2C;YAC3C,IAAA,gBAAM,EAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YACxC,IAAA,gBAAM,EAAC,MAAM,CAAC,IAAI,EAAE,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;;;;;;;;;IAAA,CACvD,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-assignment */\r\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n/* eslint-disable @typescript-eslint/no-unsafe-argument */\r\n/* eslint-disable @typescript-eslint/no-unsafe-call */\r\n\r\nimport type { ChildProcess } from \"child_process\";\r\nimport { describe, expect, test, beforeEach, afterEach } from \"@jest/globals\";\r\nimport { execAsync } from \"./disposableExec\";\r\n\r\n/**\r\n * Tests for DisposableExec - verifies no process leaks under any scenario\r\n *\r\n * These tests access internal implementation details (child process) to verify cleanup.\r\n * The eslint disables are necessary for test verification purposes.\r\n */\r\n\r\ndescribe(\"disposableExec\", () => {\r\n  const activeProcesses = new Set<ChildProcess>();\r\n\r\n  beforeEach(() => {\r\n    activeProcesses.clear();\r\n  });\r\n\r\n  afterEach(() => {\r\n    // Verify all processes are cleaned up after each test\r\n    for (const proc of activeProcesses) {\r\n      const hasExited = proc.exitCode !== null || proc.signalCode !== null;\r\n      expect(hasExited || proc.killed).toBe(true);\r\n      if (!hasExited && !proc.killed) {\r\n        proc.kill();\r\n      }\r\n    }\r\n    activeProcesses.clear();\r\n  });\r\n\r\n  test(\"successful command completes and cleans up automatically\", async () => {\r\n    let childProc: ChildProcess;\r\n\r\n    {\r\n      using proc = execAsync(\"echo 'hello world'\");\r\n      childProc = (proc as any).child;\r\n      activeProcesses.add(childProc);\r\n\r\n      const { stdout } = await proc.result;\r\n      expect(stdout.trim()).toBe(\"hello world\");\r\n    }\r\n\r\n    // After scope exit, process should be exited\r\n    expect(childProc.exitCode).toBe(0);\r\n    expect(childProc.killed).toBe(false);\r\n  });\r\n\r\n  test(\"failed command completes and cleans up automatically\", async () => {\r\n    using proc = execAsync(\"exit 1\");\r\n    const childProc: ChildProcess = (proc as any).child;\r\n    activeProcesses.add(childProc);\r\n\r\n    try {\r\n      await proc.result;\r\n      expect(true).toBe(false); // Should not reach here\r\n    } catch (error: any) {\r\n      expect(error.code).toBe(1);\r\n    }\r\n\r\n    // After scope exit, process should be exited\r\n    expect(childProc.exitCode).toBe(1);\r\n    expect(childProc.killed).toBe(false);\r\n  });\r\n\r\n  test(\"disposing before completion kills the process\", async () => {\r\n    const proc = execAsync(\"sleep 2\");\r\n    const childProc: ChildProcess = (proc as any).child;\r\n    activeProcesses.add(childProc);\r\n\r\n    // Give process time to start\r\n    await new Promise((resolve) => setTimeout(resolve, 50));\r\n\r\n    expect(childProc.exitCode).toBeNull();\r\n    expect(childProc.signalCode).toBeNull();\r\n\r\n    // Explicit disposal - kill the process\r\n    proc[Symbol.dispose]();\r\n\r\n    // Wait for process to be killed\r\n    await new Promise((resolve) => {\r\n      if (childProc.killed) {\r\n        resolve(undefined);\r\n      } else {\r\n        childProc.once(\"exit\", () => resolve(undefined));\r\n      }\r\n    });\r\n\r\n    // Process should be killed\r\n    expect(childProc.killed).toBe(true);\r\n\r\n    // Result promise should reject since we killed it\r\n    await expect(proc.result).rejects.toThrow();\r\n  });\r\n\r\n  test(\"using block disposes and kills long-running process\", async () => {\r\n    let childProc: ChildProcess;\r\n    let resultPromise: Promise<{ stdout: string; stderr: string }>;\r\n\r\n    {\r\n      using proc = execAsync(\"sleep 2\");\r\n      childProc = (proc as any).child;\r\n      resultPromise = proc.result;\r\n      activeProcesses.add(childProc);\r\n\r\n      // Give process time to start\r\n      await new Promise((resolve) => setTimeout(resolve, 50));\r\n\r\n      expect(childProc.exitCode).toBeNull();\r\n      expect(childProc.signalCode).toBeNull();\r\n      // Exit scope - should trigger disposal\r\n    }\r\n\r\n    // Wait for process to be killed\r\n    await new Promise((resolve) => {\r\n      if (childProc.killed || childProc.exitCode !== null) {\r\n        resolve(undefined);\r\n      } else {\r\n        childProc.once(\"exit\", () => resolve(undefined));\r\n      }\r\n    });\r\n\r\n    // Process should be killed\r\n    expect(childProc.killed).toBe(true);\r\n\r\n    // Result should reject since we killed it\r\n    await expect(resultPromise).rejects.toThrow();\r\n  });\r\n\r\n  test(\"disposing already-exited process is safe\", async () => {\r\n    const proc = execAsync(\"echo 'test'\");\r\n    const childProc: ChildProcess = (proc as any).child;\r\n    activeProcesses.add(childProc);\r\n\r\n    await proc.result;\r\n\r\n    // Process already exited\r\n    expect(childProc.exitCode).toBe(0);\r\n\r\n    // Should not throw or cause issues\r\n    proc[Symbol.dispose]();\r\n\r\n    // Still exited, not killed\r\n    expect(childProc.exitCode).toBe(0);\r\n    expect(childProc.killed).toBe(false);\r\n  });\r\n\r\n  test(\"stdout and stderr are captured correctly\", async () => {\r\n    using proc = execAsync(\"echo 'stdout message' && echo 'stderr message' >&2\");\r\n    const childProc = (proc as any).child;\r\n    activeProcesses.add(childProc);\r\n\r\n    const { stdout, stderr } = await proc.result;\r\n    expect(stdout.trim()).toBe(\"stdout message\");\r\n    expect(stderr.trim()).toBe(\"stderr message\");\r\n  });\r\n\r\n  test(\"error includes stderr content\", async () => {\r\n    try {\r\n      using proc = execAsync(\"echo 'error details' >&2 && exit 42\");\r\n      const childProc = (proc as any).child;\r\n      activeProcesses.add(childProc);\r\n\r\n      await proc.result;\r\n      expect(true).toBe(false); // Should not reach\r\n    } catch (error: any) {\r\n      expect(error.code).toBe(42);\r\n      expect(error.stderr.trim()).toBe(\"error details\");\r\n      expect(error.message).toContain(\"error details\");\r\n    }\r\n  });\r\n\r\n  test(\"multiple processes in parallel all clean up\", async () => {\r\n    const childProcs: ChildProcess[] = [];\r\n\r\n    await Promise.all(\r\n      Array.from({ length: 5 }, async (_, i) => {\r\n        using proc = execAsync(`echo 'process ${i}'`);\r\n        const childProc = (proc as any).child;\r\n        childProcs.push(childProc);\r\n        activeProcesses.add(childProc);\r\n\r\n        const { stdout } = await proc.result;\r\n        expect(stdout.trim()).toBe(`process ${i}`);\r\n      })\r\n    );\r\n\r\n    // All processes should be exited\r\n    for (const proc of childProcs) {\r\n      expect(proc.exitCode).toBe(0);\r\n    }\r\n  });\r\n\r\n  test(\"exception during process handling still cleans up\", async () => {\r\n    let childProc: ChildProcess | undefined;\r\n    let resultPromise: Promise<{ stdout: string; stderr: string }> | undefined;\r\n\r\n    try {\r\n      using proc = execAsync(\"sleep 2\");\r\n      childProc = (proc as any).child as ChildProcess;\r\n      resultPromise = proc.result;\r\n      activeProcesses.add(childProc);\r\n\r\n      // Give process time to start\r\n      await new Promise((resolve) => setTimeout(resolve, 50));\r\n\r\n      // Throw exception before awaiting result - disposal will happen when leaving this block\r\n      throw new Error(\"Simulated error\");\r\n    } catch (error: any) {\r\n      expect(error.message).toBe(\"Simulated error\");\r\n    }\r\n\r\n    // Wait for process to be killed\r\n    if (childProc) {\r\n      await new Promise((resolve) => {\r\n        if (childProc.killed || childProc.exitCode !== null) {\r\n          resolve(undefined);\r\n        } else {\r\n          childProc.once(\"exit\", () => resolve(undefined));\r\n        }\r\n      });\r\n    }\r\n\r\n    // Process should be killed despite exception\r\n    expect(childProc?.killed).toBe(true);\r\n\r\n    // After leaving try block, disposal has occurred\r\n    // Result should reject since we killed it via disposal\r\n    await expect(resultPromise).rejects.toThrow();\r\n  });\r\n\r\n  test(\"process killed by signal is handled correctly\", async () => {\r\n    using proc = execAsync(\"sleep 2\");\r\n    const childProc: ChildProcess = (proc as any).child;\r\n    activeProcesses.add(childProc);\r\n\r\n    try {\r\n      // Give process time to start\r\n      await new Promise((resolve) => setTimeout(resolve, 50));\r\n\r\n      // Manually kill with SIGTERM\r\n      childProc.kill(\"SIGTERM\");\r\n\r\n      await proc.result;\r\n      expect(true).toBe(false); // Should not reach\r\n    } catch (error: any) {\r\n      expect(error.signal).toBe(\"SIGTERM\");\r\n      expect(error.message).toContain(\"SIGTERM\");\r\n    }\r\n\r\n    // Wait for process to fully exit\r\n    await new Promise((resolve) => {\r\n      if (childProc.exitCode !== null || childProc.signalCode !== null) {\r\n        resolve(undefined);\r\n      } else {\r\n        childProc.once(\"exit\", () => resolve(undefined));\r\n      }\r\n    });\r\n\r\n    // Process should be killed\r\n    expect(childProc.killed).toBe(true);\r\n    expect(childProc.signalCode).toBe(\"SIGTERM\");\r\n  });\r\n\r\n  test(\"early disposal prevents result promise from hanging\", async () => {\r\n    const proc = execAsync(\"sleep 2\");\r\n    const childProc = (proc as any).child;\r\n    activeProcesses.add(childProc);\r\n\r\n    // Give process time to start\r\n    await new Promise((resolve) => setTimeout(resolve, 50));\r\n\r\n    // Dispose immediately\r\n    proc[Symbol.dispose]();\r\n\r\n    // Wait for process to be killed\r\n    await new Promise((resolve) => {\r\n      if (childProc.killed || childProc.exitCode !== null) {\r\n        resolve(undefined);\r\n      } else {\r\n        childProc.once(\"exit\", () => resolve(undefined));\r\n      }\r\n    });\r\n\r\n    // Process should be killed\r\n    expect(childProc.killed).toBe(true);\r\n\r\n    // Result should reject, not hang forever\r\n    await expect(proc.result).rejects.toThrow();\r\n  });\r\n\r\n  test(\"dispose is idempotent - calling multiple times is safe\", async () => {\r\n    const proc = execAsync(\"sleep 2\");\r\n    const childProc = (proc as any).child;\r\n    activeProcesses.add(childProc);\r\n\r\n    // Give process time to start\r\n    await new Promise((resolve) => setTimeout(resolve, 50));\r\n\r\n    // Multiple dispose calls should be safe\r\n    proc[Symbol.dispose]();\r\n    proc[Symbol.dispose]();\r\n    proc[Symbol.dispose]();\r\n\r\n    // Wait for process to be killed\r\n    await new Promise((resolve) => {\r\n      if (childProc.killed || childProc.exitCode !== null) {\r\n        resolve(undefined);\r\n      } else {\r\n        childProc.once(\"exit\", () => resolve(undefined));\r\n      }\r\n    });\r\n\r\n    // Process should be killed once\r\n    expect(childProc.killed).toBe(true);\r\n\r\n    // Result should reject since we killed it\r\n    await expect(proc.result).rejects.toThrow();\r\n  });\r\n\r\n  test(\"close event waits for stdio to flush\", async () => {\r\n    // Generate large output to test stdio buffering\r\n    const largeOutput = \"x\".repeat(100000);\r\n    using proc = execAsync(`echo '${largeOutput}'`);\r\n    const childProc = (proc as any).child;\r\n    activeProcesses.add(childProc);\r\n\r\n    const { stdout } = await proc.result;\r\n\r\n    // Should receive all output, not truncated\r\n    expect(stdout.trim()).toBe(largeOutput);\r\n    expect(stdout.trim().length).toBe(largeOutput.length);\r\n  });\r\n});\r\n"]}