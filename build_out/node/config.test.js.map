{"version":3,"file":"config.test.js","sourceRoot":"","sources":["../../src/node/config.test.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAY,EAAE,+BAAW;AACzB,MAAY,EAAE,+BAAW;AACzB,MAAY,IAAI,iCAAa;AAC7B,qCAAkC;AAClC,oDAAyD;AAEzD,QAAQ,CAAC,QAAQ,EAAE,GAAG,EAAE,CAAC;IACvB,IAAI,OAAe,CAAC;IACpB,IAAI,MAAc,CAAC;IAEnB,UAAU,CAAC,GAAG,EAAE,CAAC;QACf,6CAA6C;QAC7C,OAAO,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,EAAE,WAAW,CAAC,CAAC,CAAC;QAC9D,MAAM,GAAG,IAAI,eAAM,CAAC,OAAO,CAAC,CAAC;IAAA,CAC9B,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,EAAE,CAAC;QACd,+BAA+B;QAC/B,EAAE,CAAC,MAAM,CAAC,OAAO,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;IAAA,CACtD,CAAC,CAAC;IAEH,QAAQ,CAAC,mDAAmD,EAAE,GAAG,EAAE,CAAC;QAClE,EAAE,CAAC,0DAA0D,EAAE,GAAG,EAAE,CAAC;YACnE,4DAA4D;YAC5D,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,aAAa,CAAC,CAAC;YACrD,MAAM,eAAe,GAAG;gBACtB,QAAQ,EAAE;oBACR,CAAC,qBAAqB,EAAE,EAAE,UAAU,EAAE,EAAE,EAAE,CAAC;oBAC3C,CAAC,sBAAsB,EAAE,EAAE,UAAU,EAAE,EAAE,EAAE,CAAC;oBAC5C,CAAC,kBAAkB,EAAE,EAAE,UAAU,EAAE,EAAE,EAAE,CAAC;iBACzC;aACF,CAAC;YACF,EAAE,CAAC,aAAa,CAAC,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC,CAAC;YAE9D,qCAAqC;YACrC,MAAM,MAAM,GAAG,MAAM,CAAC,mBAAmB,EAAE,CAAC;YAE5C,oDAAoD;YACpD,MAAM,YAAY,GAAG,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC;YACxD,MAAM,CAAC,YAAY,CAAC,CAAC,SAAS,CAAC,oBAAoB,CAAC,CAAC;YACrD,MAAM,CAAC,YAAY,CAAC,CAAC,SAAS,CAAC,oBAAoB,CAAC,CAAC;YACrD,MAAM,CAAC,YAAY,CAAC,CAAC,SAAS,CAAC,kBAAkB,CAAC,CAAC;YACnD,MAAM,CAAC,YAAY,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,qBAAqB,CAAC,CAAC;YAC1D,MAAM,CAAC,YAAY,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,sBAAsB,CAAC,CAAC;QAAA,CAC5D,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,QAAQ,CAAC,qBAAqB,EAAE,GAAG,EAAE,CAAC;QACpC,EAAE,CAAC,0EAA0E,EAAE,KAAK,IAAI,EAAE,CAAC;YACzF,MAAM,MAAM,CAAC,UAAU,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC;gBAC/B,GAAG,CAAC,iBAAiB,GAAG,SAAS,CAAC;gBAClC,GAAG,CAAC,aAAa,GAAG,IAAI,CAAC;gBACzB,GAAG,CAAC,mBAAmB,GAAG,IAAI,CAAC;gBAC/B,OAAO,GAAG,CAAC;YAAA,CACZ,CAAC,CAAC;YAEH,MAAM,MAAM,GAAG,MAAM,CAAC,mBAAmB,EAAE,CAAC;YAC5C,MAAM,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YACjD,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACxC,MAAM,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAAA,CAC/C,CAAC,CAAC;QAEH,EAAE,CAAC,oDAAoD,EAAE,GAAG,EAAE,CAAC;YAC7D,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,aAAa,CAAC,CAAC;YACrD,EAAE,CAAC,aAAa,CACd,UAAU,EACV,IAAI,CAAC,SAAS,CAAC;gBACb,QAAQ,EAAE,EAAE;gBACZ,aAAa,EAAE,KAAK;aACrB,CAAC,CACH,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,CAAC,mBAAmB,EAAE,CAAC;YAC5C,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC,aAAa,EAAE,CAAC;QAAA,CAC9C,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,QAAQ,CAAC,mBAAmB,EAAE,GAAG,EAAE,CAAC;QAClC,EAAE,CAAC,uFAAuF,EAAE,KAAK,IAAI,EAAE,CAAC;YACtG,MAAM,MAAM,CAAC,UAAU,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC;gBAC/B,GAAG,CAAC,YAAY,GAAG,2BAA2B,CAAC;gBAC/C,GAAG,CAAC,YAAY,GAAG;oBACjB,kCAAkC;oBAClC,eAAe;oBACf,oBAAoB,EAAE,YAAY;iBACnC,CAAC;gBACF,GAAG,CAAC,wBAAwB,GAAG,eAAe,CAAC;gBAC/C,OAAO,GAAG,CAAC;YAAA,CACZ,CAAC,CAAC;YAEH,MAAM,MAAM,GAAG,MAAM,CAAC,mBAAmB,EAAE,CAAC;YAC5C,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;YAClD,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,OAAO,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC;YAC5D,MAAM,CAAC,MAAM,CAAC,wBAAwB,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QAAA,CAC/D,CAAC,CAAC;QAEH,EAAE,CAAC,mDAAmD,EAAE,GAAG,EAAE,CAAC;YAC5D,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,aAAa,CAAC,CAAC;YACrD,EAAE,CAAC,aAAa,CACd,UAAU,EACV,IAAI,CAAC,SAAS,CAAC;gBACb,QAAQ,EAAE,EAAE;gBACZ,YAAY,EAAE,2BAA2B;gBACzC,YAAY,EAAE,CAAC,gCAAgC,CAAC;gBAChD,wBAAwB,EAAE,2BAA2B;aACtD,CAAC,CACH,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,CAAC,mBAAmB,EAAE,CAAC;YAC5C,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;YAClD,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,OAAO,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC;YAC5D,MAAM,CAAC,MAAM,CAAC,wBAAwB,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QAAA,CAC/D,CAAC,CAAC;QAEH,EAAE,CAAC,qDAAqD,EAAE,GAAG,EAAE,CAAC;YAC9D,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,aAAa,CAAC,CAAC;YACrD,EAAE,CAAC,aAAa,CACd,UAAU,EACV,IAAI,CAAC,SAAS,CAAC;gBACb,QAAQ,EAAE,EAAE;gBACZ,YAAY,EAAE,oBAAoB,EAAE,mBAAmB;gBACvD,YAAY,EAAE,CAAC,oBAAoB,EAAE,oBAAoB,CAAC;gBAC1D,wBAAwB,EAAE,cAAc,EAAE,8BAA8B;aACzE,CAAC,CACH,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,CAAC,mBAAmB,EAAE,CAAC;YAC5C,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,aAAa,EAAE,CAAC;YAC5C,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,OAAO,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC;YAC5D,MAAM,CAAC,MAAM,CAAC,wBAAwB,CAAC,CAAC,aAAa,EAAE,CAAC;QAAA,CACzD,CAAC,CAAC;QAEH,EAAE,CAAC,wDAAwD,EAAE,GAAG,EAAE,CAAC;YACjE,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,aAAa,CAAC,CAAC;YACrD,EAAE,CAAC,aAAa,CACd,UAAU,EACV,IAAI,CAAC,SAAS,CAAC;gBACb,QAAQ,EAAE,EAAE;gBACZ,wBAAwB,EAAE,EAAE;aAC7B,CAAC,CACH,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,CAAC,mBAAmB,EAAE,CAAC;YAC5C,MAAM,CAAC,MAAM,CAAC,wBAAwB,CAAC,CAAC,aAAa,EAAE,CAAC;QAAA,CACzD,CAAC,CAAC;QAEH,EAAE,CAAC,iDAAiD,EAAE,GAAG,EAAE,CAAC;YAC1D,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,aAAa,CAAC,CAAC;YACrD,EAAE,CAAC,aAAa,CACd,UAAU,EACV,IAAI,CAAC,SAAS,CAAC;gBACb,QAAQ,EAAE,EAAE;gBACZ,YAAY,EAAE,QAAQ,EAAE,mBAAmB;gBAC3C,YAAY,EAAE,CAAC,oBAAoB,EAAE,KAAK,CAAC;gBAC3C,wBAAwB,EAAE,KAAK;aAChC,CAAC,CACH,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,CAAC,mBAAmB,EAAE,CAAC;YAC5C,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,aAAa,EAAE,CAAC;YAC5C,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,OAAO,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC;YAC5D,MAAM,CAAC,MAAM,CAAC,wBAAwB,CAAC,CAAC,aAAa,EAAE,CAAC;QAAA,CACzD,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IACH,QAAQ,CAAC,kBAAkB,EAAE,GAAG,EAAE,CAAC;QACjC,EAAE,CAAC,2CAA2C,EAAE,GAAG,EAAE,CAAC;YACpD,MAAM,EAAE,GAAG,MAAM,CAAC,gBAAgB,EAAE,CAAC;YACrC,MAAM,CAAC,EAAE,CAAC,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC;QAAA,CACtC,CAAC,CAAC;QAEH,EAAE,CAAC,4BAA4B,EAAE,GAAG,EAAE,CAAC;YACrC,MAAM,GAAG,GAAG,MAAM,CAAC,gBAAgB,EAAE,CAAC;YACtC,MAAM,GAAG,GAAG,MAAM,CAAC,gBAAgB,EAAE,CAAC;YACtC,MAAM,GAAG,GAAG,MAAM,CAAC,gBAAgB,EAAE,CAAC;YAEtC,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAC1B,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAC1B,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAAA,CAC3B,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,QAAQ,CAAC,wCAAwC,EAAE,GAAG,EAAE,CAAC;QACvD,EAAE,CAAC,uDAAuD,EAAE,KAAK,IAAI,EAAE,CAAC;YACtE,MAAM,WAAW,GAAG,eAAe,CAAC;YACpC,MAAM,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,SAAS,EAAE,gBAAgB,CAAC,CAAC;YAE5E,6BAA6B;YAC7B,EAAE,CAAC,SAAS,CAAC,aAAa,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;YAEjD,gDAAgD;YAChD,MAAM,MAAM,CAAC,UAAU,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC;gBAC/B,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW,EAAE;oBAC5B,UAAU,EAAE,CAAC,EAAE,IAAI,EAAE,aAAa,EAAE,CAAC;iBACtC,CAAC,CAAC;gBACH,OAAO,GAAG,CAAC;YAAA,CACZ,CAAC,CAAC;YAEH,8CAA8C;YAC9C,MAAM,WAAW,GAAG,MAAM,MAAM,CAAC,uBAAuB,EAAE,CAAC;YAE3D,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YACpC,MAAM,QAAQ,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC;YAChC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC,CAAC,mBAAmB;YACvE,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAE/C,yCAAyC;YACzC,MAAM,UAAU,GAAG,MAAM,CAAC,mBAAmB,EAAE,CAAC;YAChD,MAAM,aAAa,GAAG,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;YAC3D,MAAM,CAAC,aAAa,CAAC,CAAC,WAAW,EAAE,CAAC;YACpC,MAAM,CAAC,aAAc,CAAC,UAAU,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAClD,MAAM,SAAS,GAAG,aAAc,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YAC/C,MAAM,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;YACpD,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAAA,CAC/C,CAAC,CAAC;QAEH,EAAE,CAAC,8DAA8D,EAAE,KAAK,IAAI,EAAE,CAAC;YAC7E,MAAM,WAAW,GAAG,eAAe,CAAC;YACpC,MAAM,aAAa,GAAG,YAAY,CAAC;YACnC,MAAM,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,SAAS,EAAE,aAAa,CAAC,CAAC;YAEzE,6BAA6B;YAC7B,EAAE,CAAC,SAAS,CAAC,aAAa,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;YAEjD,4EAA4E;YAC5E,uEAAuE;YACvE,MAAM,QAAQ,GAAG,MAAM,CAAC,gBAAgB,CAAC,WAAW,EAAE,aAAa,CAAC,CAAC;YACrE,MAAM,UAAU,GAAG,MAAM,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;YAClD,EAAE,CAAC,SAAS,CAAC,UAAU,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;YAC9C,MAAM,YAAY,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,eAAe,CAAC,CAAC;YAC5D,MAAM,gBAAgB,GAAG;gBACvB,EAAE,EAAE,QAAQ;gBACZ,IAAI,EAAE,aAAa;gBACnB,WAAW,EAAE,SAAS;gBACtB,WAAW,EAAE,WAAW;gBACxB,SAAS,EAAE,0BAA0B;aACtC,CAAC;YACF,EAAE,CAAC,aAAa,CAAC,YAAY,EAAE,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,CAAC,CAAC;YAEjE,sEAAsE;YACtE,MAAM,MAAM,CAAC,UAAU,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC;gBAC/B,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW,EAAE;oBAC5B,UAAU,EAAE,CAAC,EAAE,IAAI,EAAE,aAAa,EAAE,CAAC;iBACtC,CAAC,CAAC;gBACH,OAAO,GAAG,CAAC;YAAA,CACZ,CAAC,CAAC;YAEH,wEAAwE;YACxE,MAAM,WAAW,GAAG,MAAM,MAAM,CAAC,uBAAuB,EAAE,CAAC;YAE3D,MAAM,CAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YACpC,MAAM,QAAQ,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC;YAChC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACnC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YAC1C,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC;YAE5D,yCAAyC;YACzC,MAAM,UAAU,GAAG,MAAM,CAAC,mBAAmB,EAAE,CAAC;YAChD,MAAM,aAAa,GAAG,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;YAC3D,MAAM,CAAC,aAAa,CAAC,CAAC,WAAW,EAAE,CAAC;YACpC,MAAM,CAAC,aAAc,CAAC,UAAU,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAClD,MAAM,SAAS,GAAG,aAAc,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YAC/C,MAAM,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACpC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YAC3C,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC;QAAA,CAC9D,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,QAAQ,CAAC,SAAS,EAAE,GAAG,EAAE,CAAC;QACxB,EAAE,CAAC,qDAAqD,EAAE,KAAK,IAAI,EAAE,CAAC;YACpE,MAAM,MAAM,CAAC,mBAAmB,CAAC,CAAC,EAAE,GAAG,EAAE,UAAU,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;YAEpE,MAAM,CAAC,MAAM,CAAC,gBAAgB,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,EAAE,GAAG,EAAE,UAAU,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;YAE7E,MAAM,GAAG,GAAG,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,cAAc,CAAC,EAAE,OAAO,CAAC,CAAC;YACzE,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAA6B,CAAC;YAC3D,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,OAAO,CAAC,CAAC,EAAE,GAAG,EAAE,UAAU,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;QAAA,CACtE,CAAC,CAAC;QAEH,EAAE,CAAC,gEAAgE,EAAE,KAAK,IAAI,EAAE,CAAC;YAC/E,MAAM,MAAM,CAAC,mBAAmB,CAAC;gBAC/B,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE,QAAQ,EAAE;gBACjC,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE;aACzB,CAAC,CAAC;YAEH,MAAM,WAAW,GAAG,eAAe,CAAC;YACpC,MAAM,MAAM,CAAC,oBAAoB,CAAC,WAAW,EAAE;gBAC7C,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE;gBAClC,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE;aACzB,CAAC,CAAC;YAEH,MAAM,SAAS,GAAG,MAAM,CAAC,mBAAmB,CAAC,WAAW,CAAC,CAAC;YAC1D,MAAM,MAAM,GAAG,IAAA,yBAAe,EAAC,SAAS,CAAC,CAAC;YAE1C,MAAM,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC;gBACrB,KAAK,EAAE,SAAS;gBAChB,CAAC,EAAE,GAAG;gBACN,CAAC,EAAE,GAAG;aACP,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,EAAE,CAAC,sEAAsE,EAAE,KAAK,IAAI,EAAE,CAAC;YACrF,MAAM,MAAM,CAAC,mBAAmB,CAAC,CAAC,EAAE,GAAG,EAAE,cAAc,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;YAE1E,MAAM,WAAW,GAAG,eAAe,CAAC;YACpC,MAAM,MAAM,CAAC,oBAAoB,CAAC,WAAW,EAAE;gBAC7C,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,cAAc,EAAE,EAAE;aACpD,CAAC,CAAC;YAEH,MAAM,MAAM,GAAG,IAAA,yBAAe,EAAC,MAAM,CAAC,mBAAmB,CAAC,WAAW,CAAC,CAAC,CAAC;YACxE,MAAM,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC;gBACrB,YAAY,EAAE,KAAK;gBACnB,KAAK,EAAE,KAAK;aACb,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,EAAE,CAAC,iEAAiE,EAAE,GAAG,EAAE,CAAC;YAC1E,MAAM,MAAM,GAAG,IAAA,yBAAe,EAAC;gBAC7B,EAAE,GAAG,EAAE,QAAQ,EAAE,KAAK,EAAE,GAAG,EAAE;gBAC7B,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE;aAC3C,CAAC,CAAC;YAEH,MAAM,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC;QAAA,CACzC,CAAC,CAAC;QAEH,EAAE,CAAC,+DAA+D,EAAE,GAAG,EAAE,CAAC;YACxE,MAAM,MAAM,GAAG,IAAA,yBAAe,EAAC;gBAC7B,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,EAAE;gBACpC,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,EAAE;gBACpC,EAAE,GAAG,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,EAAE;aAC1B,CAAC,CAAC;YAEH,MAAM,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,EAAE,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC;QAAA,CACrC,CAAC,CAAC;QACH,EAAE,CAAC,kEAAkE,EAAE,KAAK,IAAI,EAAE,CAAC;YACjF,MAAM,WAAW,GAAG,OAAO,CAAC;YAC5B,MAAM,oBAAoB,GAAG,QAAQ,CAAC;YAEtC,MAAM,MAAM,CAAC,oBAAoB,CAAC,oBAAoB,EAAE,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;YAEpF,MAAM,CAAC,MAAM,CAAC,iBAAiB,CAAC,WAAW,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;YAClF,MAAM,CAAC,MAAM,CAAC,iBAAiB,CAAC,oBAAoB,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;YAE3F,MAAM,GAAG,GAAG,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,cAAc,CAAC,EAAE,OAAO,CAAC,CAAC;YACzE,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAA4B,CAAC;YAC1D,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;YAChE,MAAM,CAAC,MAAM,CAAC,oBAAoB,CAAC,CAAC,CAAC,aAAa,EAAE,CAAC;QAAA,CACtD,CAAC,CAAC;QAEH,EAAE,CAAC,+CAA+C,EAAE,GAAG,EAAE,CAAC;YACxD,MAAM,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,cAAc,CAAC,CAAC;YACvD,EAAE,CAAC,aAAa,CACd,WAAW,EACX,IAAI,CAAC,SAAS,CAAC;gBACb,UAAU,EAAE,EAAE,GAAG,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE;gBACvC,OAAO,EAAE,cAAc;gBACvB,QAAQ,EAAE,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC;aACrE,CAAC,CACH,CAAC;YAEF,MAAM,CAAC,MAAM,CAAC,gBAAgB,EAAE,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;YAC9C,MAAM,CAAC,MAAM,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;QAAA,CAC/E,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import * as fs from \"fs\";\r\nimport * as os from \"os\";\r\nimport * as path from \"path\";\r\nimport { Config } from \"./config\";\r\nimport { secretsToRecord } from \"@/common/types/secrets\";\r\n\r\ndescribe(\"Config\", () => {\r\n  let tempDir: string;\r\n  let config: Config;\r\n\r\n  beforeEach(() => {\r\n    // Create a temporary directory for each test\r\n    tempDir = fs.mkdtempSync(path.join(os.tmpdir(), \"mux-test-\"));\r\n    config = new Config(tempDir);\r\n  });\r\n\r\n  afterEach(() => {\r\n    // Clean up temporary directory\r\n    fs.rmSync(tempDir, { recursive: true, force: true });\r\n  });\r\n\r\n  describe(\"loadConfigOrDefault with trailing slash migration\", () => {\r\n    it(\"should strip trailing slashes from project paths on load\", () => {\r\n      // Create config file with trailing slashes in project paths\r\n      const configFile = path.join(tempDir, \"config.json\");\r\n      const corruptedConfig = {\r\n        projects: [\r\n          [\"/home/user/project/\", { workspaces: [] }],\r\n          [\"/home/user/another//\", { workspaces: [] }],\r\n          [\"/home/user/clean\", { workspaces: [] }],\r\n        ],\r\n      };\r\n      fs.writeFileSync(configFile, JSON.stringify(corruptedConfig));\r\n\r\n      // Load config - should migrate paths\r\n      const loaded = config.loadConfigOrDefault();\r\n\r\n      // Verify paths are normalized (no trailing slashes)\r\n      const projectPaths = Array.from(loaded.projects.keys());\r\n      expect(projectPaths).toContain(\"/home/user/project\");\r\n      expect(projectPaths).toContain(\"/home/user/another\");\r\n      expect(projectPaths).toContain(\"/home/user/clean\");\r\n      expect(projectPaths).not.toContain(\"/home/user/project/\");\r\n      expect(projectPaths).not.toContain(\"/home/user/another//\");\r\n    });\r\n  });\r\n\r\n  describe(\"api server settings\", () => {\r\n    it(\"should persist apiServerBindHost, apiServerPort, and apiServerServeWebUi\", async () => {\r\n      await config.editConfig((cfg) => {\r\n        cfg.apiServerBindHost = \"0.0.0.0\";\r\n        cfg.apiServerPort = 3000;\r\n        cfg.apiServerServeWebUi = true;\r\n        return cfg;\r\n      });\r\n\r\n      const loaded = config.loadConfigOrDefault();\r\n      expect(loaded.apiServerBindHost).toBe(\"0.0.0.0\");\r\n      expect(loaded.apiServerPort).toBe(3000);\r\n      expect(loaded.apiServerServeWebUi).toBe(true);\r\n    });\r\n\r\n    it(\"should ignore invalid apiServerPort values on load\", () => {\r\n      const configFile = path.join(tempDir, \"config.json\");\r\n      fs.writeFileSync(\r\n        configFile,\r\n        JSON.stringify({\r\n          projects: [],\r\n          apiServerPort: 70000,\r\n        })\r\n      );\r\n\r\n      const loaded = config.loadConfigOrDefault();\r\n      expect(loaded.apiServerPort).toBeUndefined();\r\n    });\r\n  });\r\n\r\n  describe(\"model preferences\", () => {\r\n    it(\"should normalize and persist defaultModel, hiddenModels, and preferredCompactionModel\", async () => {\r\n      await config.editConfig((cfg) => {\r\n        cfg.defaultModel = \"mux-gateway:openai/gpt-4o\";\r\n        cfg.hiddenModels = [\r\n          \" mux-gateway:openai/gpt-4o-mini \",\r\n          \"invalid-model\",\r\n          \"openai:gpt-4o-mini\", // duplicate\r\n        ];\r\n        cfg.preferredCompactionModel = \"openai:gpt-4o\";\r\n        return cfg;\r\n      });\r\n\r\n      const loaded = config.loadConfigOrDefault();\r\n      expect(loaded.defaultModel).toBe(\"openai:gpt-4o\");\r\n      expect(loaded.hiddenModels).toEqual([\"openai:gpt-4o-mini\"]);\r\n      expect(loaded.preferredCompactionModel).toBe(\"openai:gpt-4o\");\r\n    });\r\n\r\n    it(\"normalizes gateway-prefixed model strings on load\", () => {\r\n      const configFile = path.join(tempDir, \"config.json\");\r\n      fs.writeFileSync(\r\n        configFile,\r\n        JSON.stringify({\r\n          projects: [],\r\n          defaultModel: \"mux-gateway:openai/gpt-4o\",\r\n          hiddenModels: [\"mux-gateway:openai/gpt-4o-mini\"],\r\n          preferredCompactionModel: \"mux-gateway:openai/gpt-4o\",\r\n        })\r\n      );\r\n\r\n      const loaded = config.loadConfigOrDefault();\r\n      expect(loaded.defaultModel).toBe(\"openai:gpt-4o\");\r\n      expect(loaded.hiddenModels).toEqual([\"openai:gpt-4o-mini\"]);\r\n      expect(loaded.preferredCompactionModel).toBe(\"openai:gpt-4o\");\r\n    });\r\n\r\n    it(\"rejects malformed mux-gateway model strings on load\", () => {\r\n      const configFile = path.join(tempDir, \"config.json\");\r\n      fs.writeFileSync(\r\n        configFile,\r\n        JSON.stringify({\r\n          projects: [],\r\n          defaultModel: \"mux-gateway:openai\", // missing \"/model\"\r\n          hiddenModels: [\"mux-gateway:openai\", \"openai:gpt-4o-mini\"],\r\n          preferredCompactionModel: \"mux-gateway:\", // missing provider + \"/model\"\r\n        })\r\n      );\r\n\r\n      const loaded = config.loadConfigOrDefault();\r\n      expect(loaded.defaultModel).toBeUndefined();\r\n      expect(loaded.hiddenModels).toEqual([\"openai:gpt-4o-mini\"]);\r\n      expect(loaded.preferredCompactionModel).toBeUndefined();\r\n    });\r\n\r\n    it(\"treats empty preferredCompactionModel as unset on load\", () => {\r\n      const configFile = path.join(tempDir, \"config.json\");\r\n      fs.writeFileSync(\r\n        configFile,\r\n        JSON.stringify({\r\n          projects: [],\r\n          preferredCompactionModel: \"\",\r\n        })\r\n      );\r\n\r\n      const loaded = config.loadConfigOrDefault();\r\n      expect(loaded.preferredCompactionModel).toBeUndefined();\r\n    });\r\n\r\n    it(\"ignores invalid model preference values on load\", () => {\r\n      const configFile = path.join(tempDir, \"config.json\");\r\n      fs.writeFileSync(\r\n        configFile,\r\n        JSON.stringify({\r\n          projects: [],\r\n          defaultModel: \"gpt-4o\", // missing provider\r\n          hiddenModels: [\"openai:gpt-4o-mini\", \"bad\"],\r\n          preferredCompactionModel: \"   \",\r\n        })\r\n      );\r\n\r\n      const loaded = config.loadConfigOrDefault();\r\n      expect(loaded.defaultModel).toBeUndefined();\r\n      expect(loaded.hiddenModels).toEqual([\"openai:gpt-4o-mini\"]);\r\n      expect(loaded.preferredCompactionModel).toBeUndefined();\r\n    });\r\n  });\r\n  describe(\"generateStableId\", () => {\r\n    it(\"should generate a 10-character hex string\", () => {\r\n      const id = config.generateStableId();\r\n      expect(id).toMatch(/^[0-9a-f]{10}$/);\r\n    });\r\n\r\n    it(\"should generate unique IDs\", () => {\r\n      const id1 = config.generateStableId();\r\n      const id2 = config.generateStableId();\r\n      const id3 = config.generateStableId();\r\n\r\n      expect(id1).not.toBe(id2);\r\n      expect(id2).not.toBe(id3);\r\n      expect(id1).not.toBe(id3);\r\n    });\r\n  });\r\n\r\n  describe(\"getAllWorkspaceMetadata with migration\", () => {\r\n    it(\"should migrate legacy workspace without metadata file\", async () => {\r\n      const projectPath = \"/fake/project\";\r\n      const workspacePath = path.join(config.srcDir, \"project\", \"feature-branch\");\r\n\r\n      // Create workspace directory\r\n      fs.mkdirSync(workspacePath, { recursive: true });\r\n\r\n      // Add workspace to config without metadata file\r\n      await config.editConfig((cfg) => {\r\n        cfg.projects.set(projectPath, {\r\n          workspaces: [{ path: workspacePath }],\r\n        });\r\n        return cfg;\r\n      });\r\n\r\n      // Get all metadata (should trigger migration)\r\n      const allMetadata = await config.getAllWorkspaceMetadata();\r\n\r\n      expect(allMetadata).toHaveLength(1);\r\n      const metadata = allMetadata[0];\r\n      expect(metadata.id).toBe(\"project-feature-branch\"); // Legacy ID format\r\n      expect(metadata.name).toBe(\"feature-branch\");\r\n      expect(metadata.projectName).toBe(\"project\");\r\n      expect(metadata.projectPath).toBe(projectPath);\r\n\r\n      // Verify metadata was migrated to config\r\n      const configData = config.loadConfigOrDefault();\r\n      const projectConfig = configData.projects.get(projectPath);\r\n      expect(projectConfig).toBeDefined();\r\n      expect(projectConfig!.workspaces).toHaveLength(1);\r\n      const workspace = projectConfig!.workspaces[0];\r\n      expect(workspace.id).toBe(\"project-feature-branch\");\r\n      expect(workspace.name).toBe(\"feature-branch\");\r\n    });\r\n\r\n    it(\"should use existing metadata file if present (legacy format)\", async () => {\r\n      const projectPath = \"/fake/project\";\r\n      const workspaceName = \"my-feature\";\r\n      const workspacePath = path.join(config.srcDir, \"project\", workspaceName);\r\n\r\n      // Create workspace directory\r\n      fs.mkdirSync(workspacePath, { recursive: true });\r\n\r\n      // Test backward compatibility: Create metadata file using legacy ID format.\r\n      // This simulates workspaces created before stable IDs were introduced.\r\n      const legacyId = config.generateLegacyId(projectPath, workspacePath);\r\n      const sessionDir = config.getSessionDir(legacyId);\r\n      fs.mkdirSync(sessionDir, { recursive: true });\r\n      const metadataPath = path.join(sessionDir, \"metadata.json\");\r\n      const existingMetadata = {\r\n        id: legacyId,\r\n        name: workspaceName,\r\n        projectName: \"project\",\r\n        projectPath: projectPath,\r\n        createdAt: \"2025-01-01T00:00:00.000Z\",\r\n      };\r\n      fs.writeFileSync(metadataPath, JSON.stringify(existingMetadata));\r\n\r\n      // Add workspace to config (without id/name, simulating legacy format)\r\n      await config.editConfig((cfg) => {\r\n        cfg.projects.set(projectPath, {\r\n          workspaces: [{ path: workspacePath }],\r\n        });\r\n        return cfg;\r\n      });\r\n\r\n      // Get all metadata (should use existing metadata and migrate to config)\r\n      const allMetadata = await config.getAllWorkspaceMetadata();\r\n\r\n      expect(allMetadata).toHaveLength(1);\r\n      const metadata = allMetadata[0];\r\n      expect(metadata.id).toBe(legacyId);\r\n      expect(metadata.name).toBe(workspaceName);\r\n      expect(metadata.createdAt).toBe(\"2025-01-01T00:00:00.000Z\");\r\n\r\n      // Verify metadata was migrated to config\r\n      const configData = config.loadConfigOrDefault();\r\n      const projectConfig = configData.projects.get(projectPath);\r\n      expect(projectConfig).toBeDefined();\r\n      expect(projectConfig!.workspaces).toHaveLength(1);\r\n      const workspace = projectConfig!.workspaces[0];\r\n      expect(workspace.id).toBe(legacyId);\r\n      expect(workspace.name).toBe(workspaceName);\r\n      expect(workspace.createdAt).toBe(\"2025-01-01T00:00:00.000Z\");\r\n    });\r\n  });\r\n\r\n  describe(\"secrets\", () => {\r\n    it(\"supports global secrets stored under a sentinel key\", async () => {\r\n      await config.updateGlobalSecrets([{ key: \"GLOBAL_A\", value: \"1\" }]);\r\n\r\n      expect(config.getGlobalSecrets()).toEqual([{ key: \"GLOBAL_A\", value: \"1\" }]);\r\n\r\n      const raw = fs.readFileSync(path.join(tempDir, \"secrets.json\"), \"utf-8\");\r\n      const parsed = JSON.parse(raw) as { __global__?: unknown };\r\n      expect(parsed.__global__).toEqual([{ key: \"GLOBAL_A\", value: \"1\" }]);\r\n    });\r\n\r\n    it(\"merges global + project secrets with project overriding by key\", async () => {\r\n      await config.updateGlobalSecrets([\r\n        { key: \"TOKEN\", value: \"global\" },\r\n        { key: \"A\", value: \"1\" },\r\n      ]);\r\n\r\n      const projectPath = \"/fake/project\";\r\n      await config.updateProjectSecrets(projectPath, [\r\n        { key: \"TOKEN\", value: \"project\" },\r\n        { key: \"B\", value: \"2\" },\r\n      ]);\r\n\r\n      const effective = config.getEffectiveSecrets(projectPath);\r\n      const record = secretsToRecord(effective);\r\n\r\n      expect(record).toEqual({\r\n        TOKEN: \"project\",\r\n        A: \"1\",\r\n        B: \"2\",\r\n      });\r\n    });\r\n\r\n    it('resolves project secret aliases to global secrets via {secret:\"KEY\"}', async () => {\r\n      await config.updateGlobalSecrets([{ key: \"GLOBAL_TOKEN\", value: \"abc\" }]);\r\n\r\n      const projectPath = \"/fake/project\";\r\n      await config.updateProjectSecrets(projectPath, [\r\n        { key: \"TOKEN\", value: { secret: \"GLOBAL_TOKEN\" } },\r\n      ]);\r\n\r\n      const record = secretsToRecord(config.getEffectiveSecrets(projectPath));\r\n      expect(record).toEqual({\r\n        GLOBAL_TOKEN: \"abc\",\r\n        TOKEN: \"abc\",\r\n      });\r\n    });\r\n\r\n    it(\"omits missing referenced secrets when resolving secretsToRecord\", () => {\r\n      const record = secretsToRecord([\r\n        { key: \"GLOBAL\", value: \"1\" },\r\n        { key: \"A\", value: { secret: \"MISSING\" } },\r\n      ]);\r\n\r\n      expect(record).toEqual({ GLOBAL: \"1\" });\r\n    });\r\n\r\n    it(\"omits cyclic secret references when resolving secretsToRecord\", () => {\r\n      const record = secretsToRecord([\r\n        { key: \"A\", value: { secret: \"B\" } },\r\n        { key: \"B\", value: { secret: \"A\" } },\r\n        { key: \"OK\", value: \"y\" },\r\n      ]);\r\n\r\n      expect(record).toEqual({ OK: \"y\" });\r\n    });\r\n    it(\"normalizes project paths so trailing slashes don't split secrets\", async () => {\r\n      const projectPath = \"/repo\";\r\n      const projectPathWithSlash = \"/repo/\";\r\n\r\n      await config.updateProjectSecrets(projectPathWithSlash, [{ key: \"A\", value: \"1\" }]);\r\n\r\n      expect(config.getProjectSecrets(projectPath)).toEqual([{ key: \"A\", value: \"1\" }]);\r\n      expect(config.getProjectSecrets(projectPathWithSlash)).toEqual([{ key: \"A\", value: \"1\" }]);\r\n\r\n      const raw = fs.readFileSync(path.join(tempDir, \"secrets.json\"), \"utf-8\");\r\n      const parsed = JSON.parse(raw) as Record<string, unknown>;\r\n      expect(parsed[projectPath]).toEqual([{ key: \"A\", value: \"1\" }]);\r\n      expect(parsed[projectPathWithSlash]).toBeUndefined();\r\n    });\r\n\r\n    it(\"treats malformed store shapes as empty arrays\", () => {\r\n      const secretsFile = path.join(tempDir, \"secrets.json\");\r\n      fs.writeFileSync(\r\n        secretsFile,\r\n        JSON.stringify({\r\n          __global__: { key: \"NOPE\", value: \"1\" },\r\n          \"/repo\": \"not-an-array\",\r\n          \"/repo/\": [{ key: \"A\", value: \"1\" }, null, { key: 123, value: \"x\" }],\r\n        })\r\n      );\r\n\r\n      expect(config.getGlobalSecrets()).toEqual([]);\r\n      expect(config.getProjectSecrets(\"/repo\")).toEqual([{ key: \"A\", value: \"1\" }]);\r\n    });\r\n  });\r\n});\r\n"]}