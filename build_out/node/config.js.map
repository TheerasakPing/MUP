{"version":3,"file":"config.js","sourceRoot":"","sources":["../../src/node/config.ts"],"names":[],"mappings":"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","sourcesContent":["import * as fs from \"fs\";\nimport * as path from \"path\";\nimport * as crypto from \"crypto\";\nimport * as jsonc from \"jsonc-parser\";\nimport writeFileAtomic from \"write-file-atomic\";\nimport { log } from \"@/node/services/log\";\nimport type { WorkspaceMetadata, FrontendWorkspaceMetadata } from \"@/common/types/workspace\";\nimport type { Secret, SecretsConfig } from \"@/common/types/secrets\";\nimport type {\n  Workspace,\n  ProjectConfig,\n  ProjectsConfig,\n  FeatureFlagOverride,\n  CustomModelConfig,\n} from \"@/common/types/project\";\nimport type { IconThemeConfig } from \"@/common/types/iconTheme\";\nimport {\n  DEFAULT_TASK_SETTINGS,\n  normalizeSubagentAiDefaults,\n  normalizeTaskSettings,\n} from \"@/common/types/tasks\";\nimport { isLayoutPresetsConfigEmpty, normalizeLayoutPresetsConfig } from \"@/common/types/uiLayouts\";\nimport { normalizeAgentAiDefaults } from \"@/common/types/agentAiDefaults\";\nimport { DEFAULT_RUNTIME_CONFIG } from \"@/common/constants/workspace\";\nimport { isIncompatibleRuntimeConfig } from \"@/common/utils/runtimeCompatibility\";\nimport { getMuxHome } from \"@/common/constants/paths\";\nimport { PlatformPaths } from \"@/common/utils/paths\";\nimport { isValidModelFormat, normalizeGatewayModel } from \"@/common/utils/ai/models\";\nimport { stripTrailingSlashes } from \"@/node/utils/pathUtils\";\nimport { getContainerName as getDockerContainerName } from \"@/node/runtime/DockerRuntime\";\n\n// Re-export project types from dedicated types file (for preload usage)\nexport type { Workspace, ProjectConfig, ProjectsConfig, CustomModelConfig };\n\nexport interface ProviderConfig {\n  apiKey?: string;\n  baseUrl?: string;\n  baseURL?: string;\n  headers?: Record<string, string>;\n  [key: string]: unknown;\n}\n\nfunction parseOptionalNonEmptyString(value: unknown): string | undefined {\n  if (typeof value !== \"string\") {\n    return undefined;\n  }\n\n  const trimmed = value.trim();\n  return trimmed ? trimmed : undefined;\n}\n\nfunction parseOptionalEnvBoolean(value: unknown): boolean | undefined {\n  if (typeof value !== \"string\") {\n    return undefined;\n  }\n\n  const normalized = value.trim().toLowerCase();\n  if (!normalized) {\n    return undefined;\n  }\n\n  if (normalized === \"1\" || normalized === \"true\" || normalized === \"yes\" || normalized === \"on\") {\n    return true;\n  }\n\n  if (normalized === \"0\" || normalized === \"false\" || normalized === \"no\" || normalized === \"off\") {\n    return false;\n  }\n\n  return undefined;\n}\nfunction parseOptionalBoolean(value: unknown): boolean | undefined {\n  return typeof value === \"boolean\" ? value : undefined;\n}\n\nfunction parseOptionalStringArray(value: unknown): string[] | undefined {\n  if (!Array.isArray(value)) {\n    return undefined;\n  }\n\n  return value.filter((item): item is string => typeof item === \"string\");\n}\nfunction normalizeOptionalModelString(value: unknown): string | undefined {\n  if (typeof value !== \"string\") {\n    return undefined;\n  }\n\n  const trimmed = value.trim();\n  if (!trimmed) {\n    return undefined;\n  }\n\n  // Reject malformed mux-gateway strings (\"mux-gateway:provider\" without \"/model\").\n  if (trimmed.startsWith(\"mux-gateway:\") && !trimmed.includes(\"/\")) {\n    return undefined;\n  }\n\n  const normalized = normalizeGatewayModel(trimmed);\n  if (!isValidModelFormat(normalized)) {\n    return undefined;\n  }\n\n  return normalized;\n}\n\nfunction normalizeOptionalModelStringArray(value: unknown): string[] | undefined {\n  if (!Array.isArray(value)) {\n    return undefined;\n  }\n\n  const out: string[] = [];\n  const seen = new Set<string>();\n\n  for (const item of value) {\n    const normalized = normalizeOptionalModelString(item);\n    if (!normalized) continue;\n    if (seen.has(normalized)) continue;\n    seen.add(normalized);\n    out.push(normalized);\n  }\n\n  return out;\n}\n\nfunction parseOptionalPort(value: unknown): number | undefined {\n  if (typeof value !== \"number\" || !Number.isFinite(value) || !Number.isInteger(value)) {\n    return undefined;\n  }\n\n  if (value < 0 || value > 65535) {\n    return undefined;\n  }\n\n  return value;\n}\nexport type ProvidersConfig = Record<string, ProviderConfig>;\n\n/**\n * Config - Centralized configuration management\n *\n * Encapsulates all config paths and operations, making them dependency-injectable\n * and testable. Pass a custom rootDir for tests to avoid polluting ~/.mux\n */\nexport class Config {\n  readonly rootDir: string;\n  readonly sessionsDir: string;\n  readonly srcDir: string;\n  private readonly configFile: string;\n  private readonly providersFile: string;\n  private readonly secretsFile: string;\n\n  constructor(rootDir?: string) {\n    this.rootDir = rootDir ?? getMuxHome();\n    this.sessionsDir = path.join(this.rootDir, \"sessions\");\n    this.srcDir = path.join(this.rootDir, \"src\");\n    this.configFile = path.join(this.rootDir, \"config.json\");\n    this.providersFile = path.join(this.rootDir, \"providers.jsonc\");\n    this.secretsFile = path.join(this.rootDir, \"secrets.json\");\n  }\n\n  loadConfigOrDefault(): ProjectsConfig {\n    try {\n      if (fs.existsSync(this.configFile)) {\n        const data = fs.readFileSync(this.configFile, \"utf-8\");\n        const parsed = JSON.parse(data) as {\n          projects?: unknown;\n          apiServerBindHost?: unknown;\n          apiServerPort?: unknown;\n          apiServerServeWebUi?: unknown;\n          mdnsAdvertisementEnabled?: unknown;\n          mdnsServiceName?: unknown;\n          serverSshHost?: string;\n          viewedSplashScreens?: string[];\n          featureFlagOverrides?: Record<string, \"default\" | \"on\" | \"off\">;\n          layoutPresets?: unknown;\n          taskSettings?: unknown;\n          muxGatewayEnabled?: unknown;\n          muxGatewayModels?: unknown;\n          defaultModel?: unknown;\n          hiddenModels?: unknown;\n          preferredCompactionModel?: unknown;\n          agentAiDefaults?: unknown;\n          subagentAiDefaults?: unknown;\n          useSSH2Transport?: unknown;\n          muxGovernorUrl?: unknown;\n          muxGovernorToken?: unknown;\n          stopCoderWorkspaceOnArchive?: unknown;\n          customModelPrices?: unknown;\n          iconThemeConfig?: unknown;\n        };\n\n        // Config is stored as array of [path, config] pairs\n        if (parsed.projects && Array.isArray(parsed.projects)) {\n          const rawPairs = parsed.projects as Array<[string, ProjectConfig]>;\n          // Migrate: normalize project paths by stripping trailing slashes\n          // This fixes configs created with paths like \"/home/user/project/\"\n          // Also filter out any malformed entries (null/undefined paths)\n          const normalizedPairs = rawPairs\n            .filter(([projectPath]) => {\n              if (!projectPath || typeof projectPath !== \"string\") {\n                log.warn(\"Filtering out project with invalid path\", { projectPath });\n                return false;\n              }\n              return true;\n            })\n            .map(([projectPath, projectConfig]) => {\n              return [stripTrailingSlashes(projectPath), projectConfig] as [string, ProjectConfig];\n            });\n          const projectsMap = new Map<string, ProjectConfig>(normalizedPairs);\n\n          const taskSettings = normalizeTaskSettings(parsed.taskSettings);\n\n          const muxGatewayEnabled = parseOptionalBoolean(parsed.muxGatewayEnabled);\n          const muxGatewayModels = parseOptionalStringArray(parsed.muxGatewayModels);\n\n          const defaultModel = normalizeOptionalModelString(parsed.defaultModel);\n          const hiddenModels = normalizeOptionalModelStringArray(parsed.hiddenModels);\n          const preferredCompactionModel = normalizeOptionalModelString(\n            parsed.preferredCompactionModel\n          );\n          const legacySubagentAiDefaults = normalizeSubagentAiDefaults(parsed.subagentAiDefaults);\n\n          // Default ON: store `false` only so config.json stays minimal.\n          const stopCoderWorkspaceOnArchive =\n            parseOptionalBoolean(parsed.stopCoderWorkspaceOnArchive) === false ? false : undefined;\n\n          const agentAiDefaults =\n            parsed.agentAiDefaults !== undefined\n              ? normalizeAgentAiDefaults(parsed.agentAiDefaults)\n              : normalizeAgentAiDefaults(legacySubagentAiDefaults);\n\n          const layoutPresetsRaw = normalizeLayoutPresetsConfig(parsed.layoutPresets);\n          const layoutPresets = isLayoutPresetsConfigEmpty(layoutPresetsRaw)\n            ? undefined\n            : layoutPresetsRaw;\n\n          return {\n            projects: projectsMap,\n            apiServerBindHost: parseOptionalNonEmptyString(parsed.apiServerBindHost),\n            apiServerServeWebUi: parseOptionalBoolean(parsed.apiServerServeWebUi)\n              ? true\n              : undefined,\n            apiServerPort: parseOptionalPort(parsed.apiServerPort),\n            mdnsAdvertisementEnabled: parseOptionalBoolean(parsed.mdnsAdvertisementEnabled),\n            mdnsServiceName: parseOptionalNonEmptyString(parsed.mdnsServiceName),\n            serverSshHost: parsed.serverSshHost,\n            viewedSplashScreens: parsed.viewedSplashScreens,\n            layoutPresets,\n            taskSettings,\n            muxGatewayEnabled,\n            muxGatewayModels,\n            defaultModel,\n            hiddenModels,\n            preferredCompactionModel,\n            agentAiDefaults,\n            // Legacy fields are still parsed and returned for downgrade compatibility.\n            subagentAiDefaults: legacySubagentAiDefaults,\n            featureFlagOverrides: parsed.featureFlagOverrides,\n            useSSH2Transport: parseOptionalBoolean(parsed.useSSH2Transport),\n            muxGovernorUrl: parseOptionalNonEmptyString(parsed.muxGovernorUrl),\n            muxGovernorToken: parseOptionalNonEmptyString(parsed.muxGovernorToken),\n            stopCoderWorkspaceOnArchive,\n            customModelPrices: parsed.customModelPrices as\n              | Record<string, CustomModelConfig>\n              | undefined,\n            iconThemeConfig: parsed.iconThemeConfig as IconThemeConfig | undefined,\n          };\n        }\n      }\n    } catch (error) {\n      log.error(\"Error loading config:\", error);\n    }\n\n    // Return default config\n    return {\n      projects: new Map(),\n      taskSettings: DEFAULT_TASK_SETTINGS,\n      agentAiDefaults: {},\n      subagentAiDefaults: {},\n    };\n  }\n\n  async saveConfig(config: ProjectsConfig): Promise<void> {\n    try {\n      if (!fs.existsSync(this.rootDir)) {\n        fs.mkdirSync(this.rootDir, { recursive: true });\n      }\n\n      const data: {\n        projects: Array<[string, ProjectConfig]>;\n        apiServerBindHost?: string;\n        apiServerPort?: number;\n        apiServerServeWebUi?: boolean;\n        mdnsAdvertisementEnabled?: boolean;\n        mdnsServiceName?: string;\n        serverSshHost?: string;\n        viewedSplashScreens?: string[];\n        layoutPresets?: ProjectsConfig[\"layoutPresets\"];\n        featureFlagOverrides?: ProjectsConfig[\"featureFlagOverrides\"];\n        taskSettings?: ProjectsConfig[\"taskSettings\"];\n        muxGatewayEnabled?: ProjectsConfig[\"muxGatewayEnabled\"];\n        muxGatewayModels?: ProjectsConfig[\"muxGatewayModels\"];\n        defaultModel?: ProjectsConfig[\"defaultModel\"];\n        hiddenModels?: ProjectsConfig[\"hiddenModels\"];\n        preferredCompactionModel?: ProjectsConfig[\"preferredCompactionModel\"];\n        agentAiDefaults?: ProjectsConfig[\"agentAiDefaults\"];\n        subagentAiDefaults?: ProjectsConfig[\"subagentAiDefaults\"];\n        useSSH2Transport?: boolean;\n        muxGovernorUrl?: string;\n        muxGovernorToken?: string;\n        stopCoderWorkspaceOnArchive?: boolean;\n        customModelPrices?: Record<string, CustomModelConfig>;\n        iconThemeConfig?: IconThemeConfig;\n      } = {\n        projects: Array.from(config.projects.entries()),\n        taskSettings: config.taskSettings ?? DEFAULT_TASK_SETTINGS,\n      };\n\n      const muxGatewayEnabled = parseOptionalBoolean(config.muxGatewayEnabled);\n      if (muxGatewayEnabled !== undefined) {\n        data.muxGatewayEnabled = muxGatewayEnabled;\n      }\n\n      const muxGatewayModels = parseOptionalStringArray(config.muxGatewayModels);\n      if (muxGatewayModels !== undefined) {\n        data.muxGatewayModels = muxGatewayModels;\n      }\n\n      const defaultModel = normalizeOptionalModelString(config.defaultModel);\n      if (defaultModel !== undefined) {\n        data.defaultModel = defaultModel;\n      }\n\n      const hiddenModels = normalizeOptionalModelStringArray(config.hiddenModels);\n      if (hiddenModels !== undefined) {\n        data.hiddenModels = hiddenModels;\n      }\n\n      const preferredCompactionModel = normalizeOptionalModelString(\n        config.preferredCompactionModel\n      );\n      if (preferredCompactionModel !== undefined) {\n        data.preferredCompactionModel = preferredCompactionModel;\n      }\n      const apiServerBindHost = parseOptionalNonEmptyString(config.apiServerBindHost);\n      if (apiServerBindHost) {\n        data.apiServerBindHost = apiServerBindHost;\n      }\n\n      const apiServerServeWebUi = parseOptionalBoolean(config.apiServerServeWebUi);\n      if (apiServerServeWebUi) {\n        data.apiServerServeWebUi = true;\n      }\n\n      const apiServerPort = parseOptionalPort(config.apiServerPort);\n      if (apiServerPort !== undefined) {\n        data.apiServerPort = apiServerPort;\n      }\n\n      const mdnsAdvertisementEnabled = parseOptionalBoolean(config.mdnsAdvertisementEnabled);\n      if (mdnsAdvertisementEnabled !== undefined) {\n        data.mdnsAdvertisementEnabled = mdnsAdvertisementEnabled;\n      }\n\n      const mdnsServiceName = parseOptionalNonEmptyString(config.mdnsServiceName);\n      if (mdnsServiceName) {\n        data.mdnsServiceName = mdnsServiceName;\n      }\n\n      if (config.serverSshHost) {\n        data.serverSshHost = config.serverSshHost;\n      }\n      if (config.featureFlagOverrides) {\n        data.featureFlagOverrides = config.featureFlagOverrides;\n      }\n      if (config.layoutPresets) {\n        const normalized = normalizeLayoutPresetsConfig(config.layoutPresets);\n        if (!isLayoutPresetsConfigEmpty(normalized)) {\n          data.layoutPresets = normalized;\n        }\n      }\n      if (config.viewedSplashScreens) {\n        data.viewedSplashScreens = config.viewedSplashScreens;\n      }\n      if (config.agentAiDefaults && Object.keys(config.agentAiDefaults).length > 0) {\n        data.agentAiDefaults = config.agentAiDefaults;\n\n        const legacySubagent: Record<string, unknown> = {};\n        for (const [id, entry] of Object.entries(config.agentAiDefaults)) {\n          if (id === \"plan\" || id === \"exec\" || id === \"compact\") continue;\n          legacySubagent[id] = entry;\n        }\n        if (Object.keys(legacySubagent).length > 0) {\n          data.subagentAiDefaults = legacySubagent as ProjectsConfig[\"subagentAiDefaults\"];\n        }\n      } else {\n        // Legacy only.\n        if (config.subagentAiDefaults && Object.keys(config.subagentAiDefaults).length > 0) {\n          data.subagentAiDefaults = config.subagentAiDefaults;\n        }\n      }\n\n      if (config.useSSH2Transport !== undefined) {\n        data.useSSH2Transport = config.useSSH2Transport;\n      }\n\n      const muxGovernorUrl = parseOptionalNonEmptyString(config.muxGovernorUrl);\n      if (muxGovernorUrl) {\n        data.muxGovernorUrl = muxGovernorUrl;\n      }\n\n      const muxGovernorToken = parseOptionalNonEmptyString(config.muxGovernorToken);\n      if (muxGovernorToken) {\n        data.muxGovernorToken = muxGovernorToken;\n      }\n\n      // Default ON: persist `false` only.\n      if (config.stopCoderWorkspaceOnArchive === false) {\n        data.stopCoderWorkspaceOnArchive = false;\n      }\n\n      if (config.customModelPrices) {\n        data.customModelPrices = config.customModelPrices;\n      }\n\n      if (config.iconThemeConfig) {\n        data.iconThemeConfig = config.iconThemeConfig;\n      }\n\n      await writeFileAtomic(this.configFile, JSON.stringify(data, null, 2), \"utf-8\");\n    } catch (error) {\n      log.error(\"Error saving config:\", error);\n    }\n  }\n\n  /**\n   * Edit config atomically using a transformation function\n   * @param fn Function that takes current config and returns modified config\n   */\n  async editConfig(fn: (config: ProjectsConfig) => ProjectsConfig): Promise<void> {\n    const config = this.loadConfigOrDefault();\n    const newConfig = fn(config);\n    await this.saveConfig(newConfig);\n  }\n\n  /**\n   * Cross-client feature flag overrides (shared via ~/.mux/config.json).\n   */\n  getFeatureFlagOverride(flagKey: string): FeatureFlagOverride {\n    const config = this.loadConfigOrDefault();\n    const override = config.featureFlagOverrides?.[flagKey];\n    if (override === \"on\" || override === \"off\" || override === \"default\") {\n      return override;\n    }\n    return \"default\";\n  }\n\n  async setFeatureFlagOverride(flagKey: string, override: FeatureFlagOverride): Promise<void> {\n    await this.editConfig((config) => {\n      const next = { ...(config.featureFlagOverrides ?? {}) };\n      if (override === \"default\") {\n        delete next[flagKey];\n      } else {\n        next[flagKey] = override;\n      }\n\n      config.featureFlagOverrides = Object.keys(next).length > 0 ? next : undefined;\n      return config;\n    });\n  }\n\n  /**\n   * mDNS advertisement enablement.\n   *\n   * - true: attempt to advertise (will warn if the API server is loopback-only)\n   * - false: never advertise\n   * - undefined: \"auto\" (advertise only when the API server is LAN-reachable)\n   */\n  getMdnsAdvertisementEnabled(): boolean | undefined {\n    const envOverride = parseOptionalEnvBoolean(process.env.MUX_MDNS_ADVERTISE);\n    if (envOverride !== undefined) {\n      return envOverride;\n    }\n\n    const config = this.loadConfigOrDefault();\n    return config.mdnsAdvertisementEnabled;\n  }\n\n  /** Optional DNS-SD service instance name override. */\n  getMdnsServiceName(): string | undefined {\n    const envName = parseOptionalNonEmptyString(process.env.MUX_MDNS_SERVICE_NAME);\n    if (envName) {\n      return envName;\n    }\n\n    const config = this.loadConfigOrDefault();\n    return config.mdnsServiceName;\n  }\n\n  /**\n   * Get the configured SSH hostname for this server (used for editor deep links in browser mode).\n   */\n  getServerSshHost(): string | undefined {\n    const config = this.loadConfigOrDefault();\n    return config.serverSshHost;\n  }\n\n  private getProjectName(projectPath: string): string {\n    return PlatformPaths.getProjectName(projectPath);\n  }\n\n  /**\n   * Generate a stable unique workspace ID.\n   * Uses 10 random hex characters for readability while maintaining uniqueness.\n   *\n   * Example: \"a1b2c3d4e5\"\n   */\n  generateStableId(): string {\n    // Generate 5 random bytes and convert to 10 hex chars\n    return crypto.randomBytes(5).toString(\"hex\");\n  }\n\n  /**\n   * DEPRECATED: Generate legacy workspace ID from project and workspace paths.\n   * This method is used only for legacy workspace migration to look up old workspaces.\n   * New workspaces use generateStableId() which returns a random stable ID.\n   *\n   * DO NOT use this method or its format to construct workspace IDs anywhere in the codebase.\n   * Workspace IDs are backend implementation details and must only come from backend operations.\n   */\n  generateLegacyId(projectPath: string, workspacePath: string): string {\n    const projectBasename = this.getProjectName(projectPath);\n    const workspaceBasename = PlatformPaths.basename(workspacePath);\n    return `${projectBasename}-${workspaceBasename}`;\n  }\n\n  /**\n   * Get the workspace directory path for a given directory name.\n   * The directory name is the workspace name (branch name).\n   */\n\n  /**\n   * Add paths to WorkspaceMetadata to create FrontendWorkspaceMetadata.\n   * Helper to avoid duplicating path computation logic.\n   */\n  private addPathsToMetadata(\n    metadata: WorkspaceMetadata,\n    workspacePath: string,\n    _projectPath: string\n  ): FrontendWorkspaceMetadata {\n    const result: FrontendWorkspaceMetadata = {\n      ...metadata,\n      namedWorkspacePath: workspacePath,\n    };\n\n    // Check for incompatible runtime configs (from newer mux versions)\n    if (isIncompatibleRuntimeConfig(metadata.runtimeConfig)) {\n      result.incompatibleRuntime =\n        \"This workspace was created with a newer version of mux. \" +\n        \"Please upgrade mux to use this workspace.\";\n    }\n\n    return result;\n  }\n\n  /**\n   * Find a workspace path and project path by workspace ID\n   * @returns Object with workspace and project paths, or null if not found\n   */\n  findWorkspace(workspaceId: string): { workspacePath: string; projectPath: string } | null {\n    const config = this.loadConfigOrDefault();\n\n    for (const [projectPath, project] of config.projects) {\n      for (const workspace of project.workspaces) {\n        // NEW FORMAT: Check config first (primary source of truth after migration)\n        if (workspace.id === workspaceId) {\n          return { workspacePath: workspace.path, projectPath };\n        }\n\n        // LEGACY FORMAT: Fall back to metadata.json and legacy ID for unmigrated workspaces\n        if (!workspace.id) {\n          // Extract workspace basename (could be stable ID or legacy name)\n          const workspaceBasename =\n            workspace.path.split(\"/\").pop() ?? workspace.path.split(\"\\\\\").pop() ?? \"unknown\";\n\n          // Try loading metadata with basename as ID (works for old workspaces)\n          const metadataPath = path.join(this.getSessionDir(workspaceBasename), \"metadata.json\");\n          if (fs.existsSync(metadataPath)) {\n            try {\n              const data = fs.readFileSync(metadataPath, \"utf-8\");\n              const metadata = JSON.parse(data) as WorkspaceMetadata;\n              if (metadata.id === workspaceId) {\n                return { workspacePath: workspace.path, projectPath };\n              }\n            } catch {\n              // Ignore parse errors, try legacy ID\n            }\n          }\n\n          // Try legacy ID format as last resort\n          const legacyId = this.generateLegacyId(projectPath, workspace.path);\n          if (legacyId === workspaceId) {\n            return { workspacePath: workspace.path, projectPath };\n          }\n        }\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Workspace Path Architecture:\n   *\n   * Workspace paths are computed on-demand from projectPath + workspace name using\n   * config.getWorkspacePath(projectPath, directoryName). This ensures a single source of truth.\n   *\n   * - Worktree directory name: uses workspace.name (the branch name)\n   * - Workspace ID: stable random identifier for identity and sessions (not used for directories)\n   *\n   * Backend: Uses getWorkspacePath(metadata.projectPath, metadata.name) for workspace directory paths\n   * Frontend: Gets enriched metadata with paths via IPC (FrontendWorkspaceMetadata)\n   *\n   * WorkspaceMetadata.workspacePath is deprecated and will be removed. Use computed\n   * paths from getWorkspacePath() or getWorkspacePaths() instead.\n   */\n\n  /**\n   * Get the session directory for a specific workspace\n   */\n  getSessionDir(workspaceId: string): string {\n    return path.join(this.sessionsDir, workspaceId);\n  }\n\n  /**\n   * Get all workspace metadata by loading config and metadata files.\n   *\n   * Returns FrontendWorkspaceMetadata with paths already computed.\n   * This eliminates the need for separate \"enrichment\" - paths are computed\n   * once during the loop when we already have all the necessary data.\n   *\n   * NEW BEHAVIOR: Config is the primary source of truth\n   * - If workspace has id/name/createdAt in config, use those directly\n   * - If workspace only has path, fall back to reading metadata.json\n   * - Migrate old workspaces by copying metadata from files to config\n   *\n   * This centralizes workspace metadata in config.json and eliminates the need\n   * for scattered metadata.json files (kept for backward compat with older versions).\n   *\n   * GUARANTEE: Every workspace returned will have a createdAt timestamp.\n   * If missing from config or legacy metadata, a new timestamp is assigned and\n   * saved to config for subsequent loads.\n   */\n  async getAllWorkspaceMetadata(): Promise<FrontendWorkspaceMetadata[]> {\n    const config = this.loadConfigOrDefault();\n    const workspaceMetadata: FrontendWorkspaceMetadata[] = [];\n    let configModified = false;\n\n    for (const [projectPath, projectConfig] of config.projects) {\n      // Validate project path is not empty (defensive check for corrupted config)\n      if (!projectPath) {\n        log.warn(\"Skipping project with empty path in config\", {\n          workspaceCount: projectConfig.workspaces?.length ?? 0,\n        });\n        continue;\n      }\n\n      const projectName = this.getProjectName(projectPath);\n\n      for (const workspace of projectConfig.workspaces) {\n        // Extract workspace basename from path (could be stable ID or legacy name)\n        const workspaceBasename =\n          workspace.path.split(\"/\").pop() ?? workspace.path.split(\"\\\\\").pop() ?? \"unknown\";\n\n        try {\n          // NEW FORMAT: If workspace has metadata in config, use it directly\n          if (workspace.id && workspace.name) {\n            const metadata: WorkspaceMetadata = {\n              id: workspace.id,\n              name: workspace.name,\n              title: workspace.title,\n              projectName,\n              projectPath,\n              // GUARANTEE: All workspaces must have createdAt (assign now if missing)\n              createdAt: workspace.createdAt ?? new Date().toISOString(),\n              // GUARANTEE: All workspaces must have runtimeConfig (apply default if missing)\n              runtimeConfig: workspace.runtimeConfig ?? DEFAULT_RUNTIME_CONFIG,\n              aiSettings: workspace.aiSettings,\n              aiSettingsByAgent:\n                workspace.aiSettingsByAgent ??\n                (workspace.aiSettings\n                  ? {\n                      plan: workspace.aiSettings,\n                      exec: workspace.aiSettings,\n                    }\n                  : undefined),\n              parentWorkspaceId: workspace.parentWorkspaceId,\n              agentType: workspace.agentType,\n              taskStatus: workspace.taskStatus,\n              reportedAt: workspace.reportedAt,\n              taskModelString: workspace.taskModelString,\n              taskThinkingLevel: workspace.taskThinkingLevel,\n              taskPrompt: workspace.taskPrompt,\n              taskTrunkBranch: workspace.taskTrunkBranch,\n              archivedAt: workspace.archivedAt,\n              unarchivedAt: workspace.unarchivedAt,\n              sectionId: workspace.sectionId,\n            };\n\n            // Migrate missing createdAt to config for next load\n            if (!workspace.createdAt) {\n              workspace.createdAt = metadata.createdAt;\n              configModified = true;\n            }\n\n            // Migrate missing runtimeConfig to config for next load\n            if (!workspace.aiSettingsByAgent) {\n              const derived = workspace.aiSettings\n                ? {\n                    plan: workspace.aiSettings,\n                    exec: workspace.aiSettings,\n                  }\n                : undefined;\n              if (derived) {\n                workspace.aiSettingsByAgent = derived;\n                configModified = true;\n              }\n            }\n\n            if (!workspace.runtimeConfig) {\n              workspace.runtimeConfig = metadata.runtimeConfig;\n              configModified = true;\n            }\n\n            // Populate containerName for Docker workspaces (computed from project path and workspace name)\n            if (\n              metadata.runtimeConfig?.type === \"docker\" &&\n              !metadata.runtimeConfig.containerName\n            ) {\n              metadata.runtimeConfig = {\n                ...metadata.runtimeConfig,\n                containerName: getDockerContainerName(projectPath, metadata.name),\n              };\n            }\n\n            workspaceMetadata.push(this.addPathsToMetadata(metadata, workspace.path, projectPath));\n            continue; // Skip metadata file lookup\n          }\n\n          // LEGACY FORMAT: Fall back to reading metadata.json\n          // Try legacy ID format first (project-workspace) - used by E2E tests and old workspaces\n          const legacyId = this.generateLegacyId(projectPath, workspace.path);\n          const metadataPath = path.join(this.getSessionDir(legacyId), \"metadata.json\");\n          let metadataFound = false;\n\n          if (fs.existsSync(metadataPath)) {\n            const data = fs.readFileSync(metadataPath, \"utf-8\");\n            const metadata = JSON.parse(data) as WorkspaceMetadata;\n\n            // Ensure required fields are present\n            if (!metadata.name) metadata.name = workspaceBasename;\n            if (!metadata.projectPath) metadata.projectPath = projectPath;\n            if (!metadata.projectName) metadata.projectName = projectName;\n\n            // GUARANTEE: All workspaces must have createdAt\n            metadata.createdAt ??= new Date().toISOString();\n\n            // GUARANTEE: All workspaces must have runtimeConfig\n            metadata.runtimeConfig ??= DEFAULT_RUNTIME_CONFIG;\n\n            // Preserve any config-only fields that may not exist in legacy metadata.json\n            metadata.aiSettingsByAgent ??=\n              workspace.aiSettingsByAgent ??\n              (workspace.aiSettings\n                ? {\n                    plan: workspace.aiSettings,\n                    exec: workspace.aiSettings,\n                  }\n                : undefined);\n            metadata.aiSettings ??= workspace.aiSettings;\n\n            // Preserve tree/task metadata when present in config (metadata.json won't have it)\n            metadata.parentWorkspaceId ??= workspace.parentWorkspaceId;\n            metadata.agentType ??= workspace.agentType;\n            metadata.taskStatus ??= workspace.taskStatus;\n            metadata.reportedAt ??= workspace.reportedAt;\n            metadata.taskModelString ??= workspace.taskModelString;\n            metadata.taskThinkingLevel ??= workspace.taskThinkingLevel;\n            metadata.taskPrompt ??= workspace.taskPrompt;\n            metadata.taskTrunkBranch ??= workspace.taskTrunkBranch;\n            // Preserve archived timestamps from config\n            metadata.archivedAt ??= workspace.archivedAt;\n            metadata.unarchivedAt ??= workspace.unarchivedAt;\n            // Preserve section assignment from config\n            metadata.sectionId ??= workspace.sectionId;\n            if (!workspace.aiSettingsByAgent && metadata.aiSettingsByAgent) {\n              workspace.aiSettingsByAgent = metadata.aiSettingsByAgent;\n              configModified = true;\n            }\n\n            // Migrate to config for next load\n            workspace.id = metadata.id;\n            workspace.name = metadata.name;\n            workspace.createdAt = metadata.createdAt;\n            workspace.runtimeConfig = metadata.runtimeConfig;\n            configModified = true;\n\n            workspaceMetadata.push(this.addPathsToMetadata(metadata, workspace.path, projectPath));\n            metadataFound = true;\n          }\n\n          // No metadata found anywhere - create basic metadata\n          if (!metadataFound) {\n            const legacyId = this.generateLegacyId(projectPath, workspace.path);\n            const metadata: WorkspaceMetadata = {\n              id: legacyId,\n              name: workspaceBasename,\n              projectName,\n              projectPath,\n              // GUARANTEE: All workspaces must have createdAt\n              createdAt: new Date().toISOString(),\n              // GUARANTEE: All workspaces must have runtimeConfig\n              runtimeConfig: DEFAULT_RUNTIME_CONFIG,\n              aiSettings: workspace.aiSettings,\n              aiSettingsByAgent:\n                workspace.aiSettingsByAgent ??\n                (workspace.aiSettings\n                  ? {\n                      plan: workspace.aiSettings,\n                      exec: workspace.aiSettings,\n                    }\n                  : undefined),\n              parentWorkspaceId: workspace.parentWorkspaceId,\n              agentType: workspace.agentType,\n              taskStatus: workspace.taskStatus,\n              reportedAt: workspace.reportedAt,\n              taskModelString: workspace.taskModelString,\n              taskThinkingLevel: workspace.taskThinkingLevel,\n              taskPrompt: workspace.taskPrompt,\n              taskTrunkBranch: workspace.taskTrunkBranch,\n              archivedAt: workspace.archivedAt,\n              unarchivedAt: workspace.unarchivedAt,\n              sectionId: workspace.sectionId,\n            };\n\n            // Save to config for next load\n            workspace.id = metadata.id;\n            workspace.name = metadata.name;\n            workspace.createdAt = metadata.createdAt;\n            workspace.runtimeConfig = metadata.runtimeConfig;\n            configModified = true;\n\n            workspaceMetadata.push(this.addPathsToMetadata(metadata, workspace.path, projectPath));\n          }\n        } catch (error) {\n          log.error(`Failed to load/migrate workspace metadata:`, error);\n          // Fallback to basic metadata if migration fails\n          const legacyId = this.generateLegacyId(projectPath, workspace.path);\n          const metadata: WorkspaceMetadata = {\n            id: legacyId,\n            name: workspaceBasename,\n            projectName,\n            projectPath,\n            // GUARANTEE: All workspaces must have createdAt (even in error cases)\n            createdAt: new Date().toISOString(),\n            // GUARANTEE: All workspaces must have runtimeConfig (even in error cases)\n            runtimeConfig: DEFAULT_RUNTIME_CONFIG,\n            aiSettings: workspace.aiSettings,\n            aiSettingsByAgent:\n              workspace.aiSettingsByAgent ??\n              (workspace.aiSettings\n                ? {\n                    plan: workspace.aiSettings,\n                    exec: workspace.aiSettings,\n                  }\n                : undefined),\n            parentWorkspaceId: workspace.parentWorkspaceId,\n            agentType: workspace.agentType,\n            taskStatus: workspace.taskStatus,\n            reportedAt: workspace.reportedAt,\n            taskModelString: workspace.taskModelString,\n            taskThinkingLevel: workspace.taskThinkingLevel,\n            taskPrompt: workspace.taskPrompt,\n            taskTrunkBranch: workspace.taskTrunkBranch,\n            sectionId: workspace.sectionId,\n          };\n          workspaceMetadata.push(this.addPathsToMetadata(metadata, workspace.path, projectPath));\n        }\n      }\n    }\n\n    // Save config if we migrated any workspaces\n    if (configModified) {\n      await this.saveConfig(config);\n    }\n\n    return workspaceMetadata;\n  }\n\n  /**\n   * Add a workspace to config.json (single source of truth for workspace metadata).\n   * Creates project entry if it doesn't exist.\n   *\n   * @param projectPath Absolute path to the project\n   * @param metadata Workspace metadata to save\n   */\n  async addWorkspace(\n    projectPath: string,\n    metadata: WorkspaceMetadata & { namedWorkspacePath?: string }\n  ): Promise<void> {\n    await this.editConfig((config) => {\n      let project = config.projects.get(projectPath);\n\n      if (!project) {\n        project = { workspaces: [] };\n        config.projects.set(projectPath, project);\n      }\n\n      // Check if workspace already exists (by ID)\n      const existingIndex = project.workspaces.findIndex((w) => w.id === metadata.id);\n\n      // Use provided namedWorkspacePath if available (runtime-aware),\n      // otherwise fall back to worktree-style path for legacy compatibility\n      const projectName = this.getProjectName(projectPath);\n      const workspacePath =\n        metadata.namedWorkspacePath ?? path.join(this.srcDir, projectName, metadata.name);\n      const workspaceEntry: Workspace = {\n        path: workspacePath,\n        id: metadata.id,\n        name: metadata.name,\n        title: metadata.title,\n        createdAt: metadata.createdAt,\n        aiSettingsByAgent: metadata.aiSettingsByAgent,\n        runtimeConfig: metadata.runtimeConfig,\n        aiSettings: metadata.aiSettings,\n        parentWorkspaceId: metadata.parentWorkspaceId,\n        agentType: metadata.agentType,\n        agentId: metadata.agentId,\n        taskStatus: metadata.taskStatus,\n        reportedAt: metadata.reportedAt,\n        taskModelString: metadata.taskModelString,\n        taskThinkingLevel: metadata.taskThinkingLevel,\n        taskPrompt: metadata.taskPrompt,\n        taskTrunkBranch: metadata.taskTrunkBranch,\n        archivedAt: metadata.archivedAt,\n        unarchivedAt: metadata.unarchivedAt,\n        sectionId: metadata.sectionId,\n      };\n\n      if (existingIndex >= 0) {\n        // Update existing workspace\n        project.workspaces[existingIndex] = workspaceEntry;\n      } else {\n        // Add new workspace\n        project.workspaces.push(workspaceEntry);\n      }\n\n      return config;\n    });\n  }\n\n  /**\n   * Remove a workspace from config.json\n   *\n   * @param workspaceId ID of the workspace to remove\n   */\n  async removeWorkspace(workspaceId: string): Promise<void> {\n    await this.editConfig((config) => {\n      let workspaceFound = false;\n\n      for (const [_projectPath, project] of config.projects) {\n        const index = project.workspaces.findIndex((w) => w.id === workspaceId);\n        if (index !== -1) {\n          project.workspaces.splice(index, 1);\n          workspaceFound = true;\n          // We don't break here in case duplicates exist (though they shouldn't)\n        }\n      }\n\n      if (!workspaceFound) {\n        log.warn(`Workspace ${workspaceId} not found in config during removal`);\n      }\n\n      return config;\n    });\n  }\n\n  /**\n   * Update workspace metadata fields (e.g., regenerate missing title/branch)\n   * Used to fix incomplete metadata after errors or restarts\n   */\n  async updateWorkspaceMetadata(\n    workspaceId: string,\n    updates: Partial<Pick<WorkspaceMetadata, \"name\" | \"runtimeConfig\">>\n  ): Promise<void> {\n    await this.editConfig((config) => {\n      for (const [_projectPath, projectConfig] of config.projects) {\n        const workspace = projectConfig.workspaces.find((w) => w.id === workspaceId);\n        if (workspace) {\n          if (updates.name !== undefined) workspace.name = updates.name;\n          if (updates.runtimeConfig !== undefined) workspace.runtimeConfig = updates.runtimeConfig;\n          return config;\n        }\n      }\n      throw new Error(`Workspace ${workspaceId} not found in config`);\n    });\n  }\n\n  /**\n   * Load providers configuration from JSONC file\n   * Supports comments in JSONC format\n   */\n  loadProvidersConfig(): ProvidersConfig | null {\n    try {\n      if (fs.existsSync(this.providersFile)) {\n        const data = fs.readFileSync(this.providersFile, \"utf-8\");\n        return jsonc.parse(data) as ProvidersConfig;\n      }\n    } catch (error) {\n      log.error(\"Error loading providers config:\", error);\n    }\n\n    return null;\n  }\n\n  /**\n   * Save providers configuration to JSONC file\n   * @param config The providers configuration to save\n   */\n  saveProvidersConfig(config: ProvidersConfig): void {\n    try {\n      if (!fs.existsSync(this.rootDir)) {\n        fs.mkdirSync(this.rootDir, { recursive: true });\n      }\n\n      // Format with 2-space indentation for readability\n      const jsonString = JSON.stringify(config, null, 2);\n\n      // Add a comment header to the file\n      const contentWithComments = `// Providers configuration for mux\n// Configure your AI providers here\n// Example:\n// {\n//   \"anthropic\": {\n//     \"apiKey\": \"sk-ant-...\"\n//   },\n//   \"openai\": {\n//     \"apiKey\": \"sk-...\"\n//   },\n//   \"xai\": {\n//     \"apiKey\": \"sk-xai-...\"\n//   },\n//   \"ollama\": {\n//     \"baseUrl\": \"http://localhost:11434/api\"  // Optional - only needed for remote/custom URL\n//   }\n// }\n${jsonString}`;\n\n      writeFileAtomic.sync(this.providersFile, contentWithComments, {\n        encoding: \"utf-8\",\n        mode: 0o600,\n      });\n    } catch (error) {\n      log.error(\"Error saving providers config:\", error);\n      throw error; // Re-throw to let caller handle\n    }\n  }\n\n  private static readonly GLOBAL_SECRETS_KEY = \"__global__\";\n\n  private static normalizeSecretsProjectPath(projectPath: string): string {\n    return stripTrailingSlashes(projectPath);\n  }\n\n  private static isSecretValue(value: unknown): value is Secret[\"value\"] {\n    if (typeof value === \"string\") {\n      return true;\n    }\n\n    return (\n      typeof value === \"object\" &&\n      value !== null &&\n      \"secret\" in value &&\n      typeof (value as { secret?: unknown }).secret === \"string\"\n    );\n  }\n\n  private static isSecret(value: unknown): value is Secret {\n    return (\n      typeof value === \"object\" &&\n      value !== null &&\n      \"key\" in value &&\n      \"value\" in value &&\n      typeof (value as { key?: unknown }).key === \"string\" &&\n      Config.isSecretValue((value as { value?: unknown }).value)\n    );\n  }\n\n  private static parseSecretsArray(value: unknown): Secret[] {\n    if (!Array.isArray(value)) {\n      return [];\n    }\n\n    // Filter invalid entries to avoid crashes when iterating secrets.\n    return value.filter((entry): entry is Secret => Config.isSecret(entry));\n  }\n\n  private static mergeSecretsByKey(primary: Secret[], secondary: Secret[]): Secret[] {\n    // Merge-by-key (last writer wins).\n    const mergedByKey = new Map<string, Secret>();\n    for (const secret of primary) {\n      mergedByKey.set(secret.key, secret);\n    }\n    for (const secret of secondary) {\n      mergedByKey.set(secret.key, secret);\n    }\n    return Array.from(mergedByKey.values());\n  }\n\n  private static normalizeSecretsConfig(raw: unknown): SecretsConfig {\n    if (raw === null || typeof raw !== \"object\" || Array.isArray(raw)) {\n      return {};\n    }\n\n    const record = raw as Record<string, unknown>;\n    const normalized: SecretsConfig = {};\n\n    for (const [rawKey, rawValue] of Object.entries(record)) {\n      let key = rawKey;\n      if (rawKey !== Config.GLOBAL_SECRETS_KEY) {\n        const normalizedKey = Config.normalizeSecretsProjectPath(rawKey);\n        key = normalizedKey || rawKey;\n      }\n\n      const secrets = Config.parseSecretsArray(rawValue);\n\n      if (!Object.prototype.hasOwnProperty.call(normalized, key)) {\n        normalized[key] = secrets;\n        continue;\n      }\n\n      normalized[key] = Config.mergeSecretsByKey(normalized[key], secrets);\n    }\n\n    return normalized;\n  }\n\n  /**\n   * Load secrets configuration from JSON file\n   * Returns empty config if file doesn't exist\n   */\n  loadSecretsConfig(): SecretsConfig {\n    try {\n      if (fs.existsSync(this.secretsFile)) {\n        const data = fs.readFileSync(this.secretsFile, \"utf-8\");\n        const parsed = JSON.parse(data) as unknown;\n        return Config.normalizeSecretsConfig(parsed);\n      }\n    } catch (error) {\n      log.error(\"Error loading secrets config:\", error);\n    }\n\n    return {};\n  }\n\n  /**\n   * Save secrets configuration to JSON file\n   * @param config The secrets configuration to save\n   */\n  async saveSecretsConfig(config: SecretsConfig): Promise<void> {\n    try {\n      if (!fs.existsSync(this.rootDir)) {\n        fs.mkdirSync(this.rootDir, { recursive: true });\n      }\n\n      await writeFileAtomic(this.secretsFile, JSON.stringify(config, null, 2), {\n        encoding: \"utf-8\",\n        mode: 0o600,\n      });\n    } catch (error) {\n      log.error(\"Error saving secrets config:\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get global secrets (not project-scoped).\n   *\n   * Stored in <muxHome>/secrets.json under a sentinel key for backwards compatibility.\n   */\n  getGlobalSecrets(): Secret[] {\n    const config = this.loadSecretsConfig();\n    return config[Config.GLOBAL_SECRETS_KEY] ?? [];\n  }\n\n  /** Update global secrets (not project-scoped). */\n  async updateGlobalSecrets(secrets: Secret[]): Promise<void> {\n    const config = this.loadSecretsConfig();\n    config[Config.GLOBAL_SECRETS_KEY] = secrets;\n    await this.saveSecretsConfig(config);\n  }\n\n  /**\n   * Get effective secrets for a project.\n   *\n   * Merges global + project secrets with project keys overriding global keys.\n   */\n  getEffectiveSecrets(projectPath: string): Secret[] {\n    const normalizedProjectPath = Config.normalizeSecretsProjectPath(projectPath) || projectPath;\n    const config = this.loadSecretsConfig();\n    const globalSecrets = config[Config.GLOBAL_SECRETS_KEY] ?? [];\n    const projectSecrets = config[normalizedProjectPath] ?? [];\n\n    // Merge-by-key (last writer wins).\n    const mergedByKey = new Map<string, Secret>();\n    for (const secret of globalSecrets) {\n      mergedByKey.set(secret.key, secret);\n    }\n    for (const secret of projectSecrets) {\n      mergedByKey.set(secret.key, secret);\n    }\n\n    return Array.from(mergedByKey.values());\n  }\n\n  /**\n   * Get secrets for a specific project.\n   *\n   * Note: this is project-only (does not include global secrets).\n   */\n  getProjectSecrets(projectPath: string): Secret[] {\n    const normalizedProjectPath = Config.normalizeSecretsProjectPath(projectPath) || projectPath;\n    const config = this.loadSecretsConfig();\n    return config[normalizedProjectPath] ?? [];\n  }\n\n  /**\n   * Update secrets for a specific project\n   * @param projectPath The path to the project\n   * @param secrets The secrets to save for the project\n   */\n  async updateProjectSecrets(projectPath: string, secrets: Secret[]): Promise<void> {\n    const normalizedProjectPath = Config.normalizeSecretsProjectPath(projectPath) || projectPath;\n    const config = this.loadSecretsConfig();\n    config[normalizedProjectPath] = secrets;\n    await this.saveSecretsConfig(config);\n  }\n}\n\n// Default instance for application use\nexport const defaultConfig = new Config();\n"]}