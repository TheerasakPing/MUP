{"version":3,"file":"formatOrpcError.test.js","sourceRoot":"","sources":["../../../src/node/orpc/formatOrpcError.test.ts"],"names":[],"mappings":";;AAAA,uCAAkD;AAClD,yCAA0D;AAC1D,uDAAoD;AAEpD,IAAA,mBAAQ,EAAC,iBAAiB,EAAE,GAAG,EAAE,CAAC;IAChC,IAAA,eAAI,EAAC,gEAAgE,EAAE,GAAG,EAAE,CAAC;QAC3E,MAAM,KAAK,GAAG,IAAI,wBAAe,CAAC;YAChC,OAAO,EAAE,mBAAmB;YAC5B,MAAM,EAAE;gBACN;oBACE,OAAO,EAAE,cAAc;oBACvB,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC,EAAE,QAAQ,CAAC;iBAC7B;aACF;YACD,IAAI,EAAE,EAAE,OAAO,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE;SAChC,CAAC,CAAC;QAEH,MAAM,KAAK,GAAG,IAAI,kBAAS,CAAC,uBAAuB,EAAE;YACnD,OAAO,EAAE,0BAA0B;YACnC,KAAK;SACN,CAAC,CAAC;QAEH,MAAM,SAAS,GAAG,IAAA,iCAAe,EAAC,KAAK,EAAE;YACvC,MAAM,EAAE,OAAO;YACf,OAAO,EAAE;gBACP,MAAM,EAAE,KAAK;gBACb,GAAG,EAAE,IAAI,GAAG,CAAC,wCAAwC,CAAC;gBACtD,OAAO,EAAE,EAAE,aAAa,EAAE,eAAe,EAAE;aAC5C;SACF,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,SAAS,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,4BAA4B,CAAC,CAAC;QAClE,IAAA,iBAAM,EAAC,SAAS,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,uBAAuB,CAAC,CAAC;QAC7D,IAAA,iBAAM,EAAC,SAAS,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,0BAA0B,CAAC,CAAC;QAChE,IAAA,iBAAM,EAAC,SAAS,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;QAEvD,uFAAuF;QACvF,IAAA,iBAAM,EAAC,SAAS,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;QACpD,IAAA,iBAAM,EAAC,SAAS,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;QAEnD,MAAM,OAAO,GAAG,SAAS,CAAC,SAAS,CAAC,OAAkC,CAAC;QACvE,MAAM,OAAO,GAAG,OAAO,CAAC,OAAkC,CAAC;QAC3D,IAAA,iBAAM,EAAC,OAAO,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;IAAA,CAClD,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,qCAAqC,EAAE,GAAG,EAAE,CAAC;QAChD,MAAM,SAAS,GAAG,IAAA,iCAAe,EAAC,EAAE,KAAK,EAAE,OAAO,EAAE,CAAC,CAAC;QACtD,IAAA,iBAAM,EAAC,SAAS,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;QAC5C,IAAA,iBAAM,EAAC,SAAS,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;IAAA,CAC9C,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { describe, expect, test } from \"bun:test\";\nimport { ORPCError, ValidationError } from \"@orpc/server\";\nimport { formatOrpcError } from \"./formatOrpcError\";\n\ndescribe(\"formatOrpcError\", () => {\n  test(\"formats output validation errors with request context + issues\", () => {\n    const cause = new ValidationError({\n      message: \"Validation failed\",\n      issues: [\n        {\n          message: \"Invalid type\",\n          path: [\"slots\", 0, \"preset\"],\n        },\n      ],\n      data: { version: 2, slots: [] },\n    });\n\n    const error = new ORPCError(\"INTERNAL_SERVER_ERROR\", {\n      message: \"Output validation failed\",\n      cause,\n    });\n\n    const formatted = formatOrpcError(error, {\n      prefix: \"/orpc\",\n      request: {\n        method: \"GET\",\n        url: new URL(\"http://localhost/orpc/uiLayouts/getAll\"),\n        headers: { authorization: \"Bearer secret\" },\n      },\n    });\n\n    expect(formatted.message).toContain(\"GET /orpc/uiLayouts/getAll\");\n    expect(formatted.message).toContain(\"INTERNAL_SERVER_ERROR\");\n    expect(formatted.message).toContain(\"Output validation failed\");\n    expect(formatted.message).toContain(\"slots[0].preset\");\n\n    // The whole point of this formatter is to avoid useless `[Object]` / `[Array]` output.\n    expect(formatted.message).not.toContain(\"[Object]\");\n    expect(formatted.message).not.toContain(\"[Array]\");\n\n    const request = formatted.debugDump.request as Record<string, unknown>;\n    const headers = request.headers as Record<string, unknown>;\n    expect(headers.authorization).toBe(\"<redacted>\");\n  });\n\n  test(\"does not throw for non-error values\", () => {\n    const formatted = formatOrpcError({ hello: \"world\" });\n    expect(formatted.message).toContain(\"ORPC\");\n    expect(formatted.message).toContain(\"hello\");\n  });\n});\n"]}