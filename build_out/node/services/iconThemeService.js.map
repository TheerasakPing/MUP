{"version":3,"file":"iconThemeService.js","sourceRoot":"","sources":["../../../src/node/services/iconThemeService.ts"],"names":[],"mappings":"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","sourcesContent":["import * as fs from \"fs\";\nimport * as path from \"path\";\nimport JSZip from \"jszip\";\nimport { log } from \"@/node/services/log\";\nimport { Config } from \"@/node/config\";\nimport {\n  IconThemeDocument,\n  InstalledIconTheme,\n  DEFAULT_MUP_THEME_ID,\n} from \"@/common/types/iconTheme\";\nimport { getMuxHome } from \"@/common/constants/paths\";\n\n/**\n * Service to manage icon themes in MUP.\n * Handles loading, activating, and listing icon themes.\n */\nexport class IconThemeService {\n  private config: Config;\n  private iconThemesDir: string;\n\n  constructor(config: Config) {\n    this.config = config;\n    this.iconThemesDir = path.join(getMuxHome(), \"icon-themes\");\n\n    // Ensure icon themes directory exists\n    if (!fs.existsSync(this.iconThemesDir)) {\n      try {\n        fs.mkdirSync(this.iconThemesDir, { recursive: true });\n      } catch (err) {\n        log.error(\"Failed to create icon themes directory:\", err);\n      }\n    }\n  }\n\n  /**\n   * Get the ID of the currently active icon theme.\n   */\n  public getActiveThemeId(): string {\n    const config = this.config.loadConfigOrDefault();\n    return config.iconThemeConfig?.activeThemeId ?? DEFAULT_MUP_THEME_ID;\n  }\n\n  /**\n   * Set the active icon theme.\n   */\n  public async setActiveTheme(themeId: string): Promise<void> {\n    await this.config.editConfig((config) => {\n      const currentConfig = config.iconThemeConfig ?? {\n        activeThemeId: DEFAULT_MUP_THEME_ID,\n        installedThemes: [],\n      };\n\n      return {\n        ...config,\n        iconThemeConfig: {\n          ...currentConfig,\n          activeThemeId: themeId,\n        },\n      };\n    });\n\n    log.info(`Active icon theme set to: ${themeId}`);\n  }\n\n  /**\n   * Get the list of all installed icon themes.\n   */\n  public getInstalledThemes(): InstalledIconTheme[] {\n    const config = this.config.loadConfigOrDefault();\n    const installed = config.iconThemeConfig?.installedThemes ?? [];\n\n    // Always include the built-in MUP default theme if not present\n    const hasDefault = installed.some((t) => t.id === DEFAULT_MUP_THEME_ID);\n    if (!hasDefault) {\n      return [this.getBuiltinThemeDefinition(), ...installed];\n    }\n\n    return installed;\n  }\n\n  /**\n   * Get the built-in MUP default theme definition.\n   * This theme uses the legacy hardcoded icons.\n   */\n  private getBuiltinThemeDefinition(): InstalledIconTheme {\n    // For now, the built-in theme doesn't have a real JSON file or folder on disk\n    // In Phase 5, we will bundle it properly.\n    return {\n      id: DEFAULT_MUP_THEME_ID,\n      label: \"MUP Default\",\n      description: \"Default MUP file icons\",\n      isBuiltin: true,\n      themeDir: \"\", // Built-in, handled specially on frontend\n      themeJsonPath: \"\",\n    };\n  }\n\n  /**\n   * Get the IconThemeDocument for the currently active theme.\n   */\n  public async getActiveThemeDocument(): Promise<IconThemeDocument | null> {\n    const activeId = this.getActiveThemeId();\n    return this.loadThemeDocument(activeId);\n  }\n\n  /**\n   * Load the IconThemeDocument (JSON) for a given theme ID.\n   * Returns null if theme not found or invalid.\n   */\n  public async loadThemeDocument(themeId: string): Promise<IconThemeDocument | null> {\n    if (themeId === DEFAULT_MUP_THEME_ID) {\n      // Built-in theme is handled by frontend fallback logic for now (Phase 3/5)\n      // or we could return a minimal JSON here.\n      return null;\n    }\n\n    const themes = this.getInstalledThemes();\n    const theme = themes.find((t) => t.id === themeId);\n\n    if (!theme) {\n      log.warn(`Icon theme not found: ${themeId}`);\n      return null;\n    }\n\n    try {\n      const jsonPath = path.join(theme.themeDir, theme.themeJsonPath);\n      if (!fs.existsSync(jsonPath)) {\n        log.error(`Icon theme JSON file missing: ${jsonPath}`);\n        return null;\n      }\n\n      const content = await fs.promises.readFile(jsonPath, \"utf-8\");\n      const doc = JSON.parse(content) as IconThemeDocument;\n\n      // Resolve iconPath values: they are relative to the JSON file, but the\n      // static file server serves from themeDir. Rewrite them to be relative\n      // to the theme root so the frontend can use them directly.\n      const jsonDir = path.posix.dirname(theme.themeJsonPath.replace(/\\\\/g, \"/\"));\n      if (doc.iconDefinitions) {\n        for (const def of Object.values(doc.iconDefinitions)) {\n          if (def.iconPath) {\n            // e.g. jsonDir=\"dist/macchiato\", iconPath=\"./icons/git.svg\"\n            // → \"dist/macchiato/icons/git.svg\"\n            const joined = path.posix.join(jsonDir, def.iconPath.replace(/\\\\/g, \"/\"));\n            // Normalize away any \"..\" or \".\" segments\n            def.iconPath = path.posix.normalize(joined);\n          }\n        }\n      }\n\n      return doc;\n    } catch (err) {\n      log.error(`Failed to load icon theme ${themeId}:`, err);\n      return null;\n    }\n  }\n\n  /**\n   * Delete an installed theme by ID.\n   * Cannot delete built-in themes.\n   */\n  public async deleteTheme(themeId: string): Promise<boolean> {\n    if (themeId === DEFAULT_MUP_THEME_ID) {\n      return false; // Cannot delete built-in theme\n    }\n\n    const config = this.config.loadConfigOrDefault();\n    const installed = config.iconThemeConfig?.installedThemes ?? [];\n    const themeIndex = installed.findIndex((t) => t.id === themeId);\n\n    if (themeIndex === -1) {\n      return false; // Theme not found\n    }\n\n    const theme = installed[themeIndex];\n    if (theme.isBuiltin) {\n      return false; // Should satisfy check above, but safe guard\n    }\n\n    // 1. Remove from config\n    await this.config.editConfig((cfg) => {\n      const currentConfig = cfg.iconThemeConfig;\n      if (!currentConfig) return cfg;\n\n      const newInstalled = [...currentConfig.installedThemes];\n      newInstalled.splice(themeIndex, 1);\n\n      // If deleted theme was active, revert to default\n      let newActiveId = currentConfig.activeThemeId;\n      if (newActiveId === themeId) {\n        newActiveId = DEFAULT_MUP_THEME_ID;\n      }\n\n      return {\n        ...cfg,\n        iconThemeConfig: {\n          ...currentConfig,\n          activeThemeId: newActiveId,\n          installedThemes: newInstalled,\n        },\n      };\n    });\n\n    // 2. Delete files from disk\n    try {\n      if (theme.themeDir && theme.themeDir.startsWith(this.iconThemesDir)) {\n        await fs.promises.rm(theme.themeDir, { recursive: true, force: true });\n        log.info(`Deleted icon theme files: ${theme.themeDir}`);\n      }\n    } catch (err) {\n      log.error(`Failed to delete theme directory: ${theme.themeDir}`, err);\n      // We still return true because it's removed from config\n    }\n\n    return true;\n  }\n\n  /**\n   * Import an icon theme from a .vsix file (base64-encoded).\n   * Extracts the ZIP, parses package.json for contributes.iconThemes,\n   * stores the theme files to disk, and registers in config.\n   */\n  public async importVsix(\n    vsixBase64: string\n  ): Promise<{ importedThemeIds: string[]; errors: string[] }> {\n    const importedThemeIds: string[] = [];\n    const errors: string[] = [];\n\n    try {\n      const buffer = Buffer.from(vsixBase64, \"base64\");\n      const zip = await JSZip.loadAsync(buffer);\n\n      // Find package.json inside the extension\n      const packageJsonFile = zip.file(\"extension/package.json\") ?? zip.file(\"package.json\");\n\n      if (!packageJsonFile) {\n        return { importedThemeIds, errors: [\"No package.json found in .vsix\"] };\n      }\n\n      const packageJsonStr = await packageJsonFile.async(\"string\");\n      const packageJson = JSON.parse(packageJsonStr) as {\n        name?: string;\n        publisher?: string;\n        version?: string;\n        displayName?: string;\n        contributes?: {\n          iconThemes?: Array<{\n            id: string;\n            label: string;\n            path: string;\n          }>;\n        };\n      };\n\n      const iconThemes = packageJson.contributes?.iconThemes;\n      if (!iconThemes || iconThemes.length === 0) {\n        return { importedThemeIds, errors: [\"No icon themes found in extension contributes\"] };\n      }\n\n      // Determine the prefix for files inside the ZIP\n      // .vsix files typically have files under \"extension/\"\n      const hasExtensionPrefix = zip.file(\"extension/package.json\") !== null;\n      const zipPrefix = hasExtensionPrefix ? \"extension/\" : \"\";\n\n      for (const themeContrib of iconThemes) {\n        try {\n          const themeId = `${packageJson.publisher ?? \"unknown\"}.${packageJson.name ?? \"unknown\"}-${themeContrib.id}`;\n          const themeDir = path.join(this.iconThemesDir, themeId);\n\n          // Clean existing directory if re-importing\n          if (fs.existsSync(themeDir)) {\n            await fs.promises.rm(themeDir, { recursive: true, force: true });\n          }\n          await fs.promises.mkdir(themeDir, { recursive: true });\n\n          // Extract all files from extension/ to the theme directory\n          const zipEntries = Object.keys(zip.files);\n          for (const entryName of zipEntries) {\n            const entry = zip.files[entryName];\n            if (entry.dir) continue;\n            if (!entryName.startsWith(zipPrefix)) continue;\n\n            // Strip the prefix to get relative path\n            const relativePath = entryName.slice(zipPrefix.length);\n            if (!relativePath) continue;\n\n            const targetPath = path.join(themeDir, relativePath);\n            const targetDir = path.dirname(targetPath);\n\n            // Security: ensure target stays within themeDir\n            const resolvedTarget = path.resolve(targetPath);\n            const resolvedThemeDir = path.resolve(themeDir);\n            if (!resolvedTarget.startsWith(resolvedThemeDir)) {\n              log.warn(`Skipping suspicious path in .vsix: ${entryName}`);\n              continue;\n            }\n\n            await fs.promises.mkdir(targetDir, { recursive: true });\n            const content = await entry.async(\"nodebuffer\");\n            await fs.promises.writeFile(targetPath, content);\n          }\n\n          // Normalize the theme JSON path (remove leading ./)\n          const themeJsonPath = themeContrib.path.replace(/^\\.[\\/\\\\]/, \"\");\n\n          // Verify the theme JSON file was extracted\n          const fullThemeJsonPath = path.join(themeDir, themeJsonPath);\n          if (!fs.existsSync(fullThemeJsonPath)) {\n            errors.push(`Theme JSON not found after extraction: ${themeJsonPath}`);\n            continue;\n          }\n\n          // Register the theme in config\n          const newTheme: InstalledIconTheme = {\n            id: themeId,\n            label: themeContrib.label || packageJson.displayName || themeContrib.id,\n            description: `Imported from ${packageJson.publisher ?? \"unknown\"}.${packageJson.name ?? \"unknown\"}`,\n            publisher: packageJson.publisher,\n            version: packageJson.version,\n            themeDir,\n            themeJsonPath,\n            isBuiltin: false,\n          };\n\n          await this.config.editConfig((cfg) => {\n            const currentConfig = cfg.iconThemeConfig ?? {\n              activeThemeId: DEFAULT_MUP_THEME_ID,\n              installedThemes: [],\n            };\n\n            // Remove existing theme with same ID if re-importing\n            const filteredThemes = currentConfig.installedThemes.filter((t) => t.id !== themeId);\n\n            return {\n              ...cfg,\n              iconThemeConfig: {\n                ...currentConfig,\n                installedThemes: [...filteredThemes, newTheme],\n              },\n            };\n          });\n\n          importedThemeIds.push(themeId);\n          log.info(`Imported icon theme: ${themeId} → ${themeDir}`);\n        } catch (themeErr) {\n          const msg = themeErr instanceof Error ? themeErr.message : String(themeErr);\n          errors.push(`Failed to import theme ${themeContrib.id}: ${msg}`);\n          log.error(`Failed to import theme ${themeContrib.id}:`, themeErr);\n        }\n      }\n    } catch (err) {\n      const msg = err instanceof Error ? err.message : String(err);\n      errors.push(`Failed to parse .vsix file: ${msg}`);\n      log.error(\"Failed to parse .vsix file:\", err);\n    }\n\n    return { importedThemeIds, errors };\n  }\n\n  /**\n   * Get the content of an icon file from a theme directory.\n   * Returns base64-encoded data and MIME type.\n   */\n  public async getIconFile(\n    themeId: string,\n    iconPath: string\n  ): Promise<{ data: string; mimeType: string } | null> {\n    const themes = this.getInstalledThemes();\n    const theme = themes.find((t) => t.id === themeId);\n    if (!theme || !theme.themeDir) return null;\n\n    // Resolve and validate path (prevent traversal)\n    const fullPath = path.resolve(theme.themeDir, iconPath);\n    const resolvedThemeDir = path.resolve(theme.themeDir);\n    if (!fullPath.startsWith(resolvedThemeDir)) {\n      log.warn(`Path traversal attempt blocked: ${iconPath}`);\n      return null;\n    }\n\n    if (!fs.existsSync(fullPath)) return null;\n\n    const content = await fs.promises.readFile(fullPath);\n    const ext = path.extname(fullPath).toLowerCase();\n    const mimeType = this.getMimeType(ext);\n\n    return {\n      data: content.toString(\"base64\"),\n      mimeType,\n    };\n  }\n\n  /**\n   * Get the base directory path for icon themes (for static file serving).\n   */\n  public getIconThemesDir(): string {\n    return this.iconThemesDir;\n  }\n\n  private getMimeType(ext: string): string {\n    const mimeMap: Record<string, string> = {\n      \".svg\": \"image/svg+xml\",\n      \".png\": \"image/png\",\n      \".jpg\": \"image/jpeg\",\n      \".jpeg\": \"image/jpeg\",\n      \".gif\": \"image/gif\",\n      \".webp\": \"image/webp\",\n      \".ico\": \"image/x-icon\",\n      \".woff\": \"font/woff\",\n      \".woff2\": \"font/woff2\",\n      \".ttf\": \"font/ttf\",\n    };\n    return mimeMap[ext] ?? \"application/octet-stream\";\n  }\n}\n"]}