{"version":3,"file":"mcpConfigService.test.js","sourceRoot":"","sources":["../../../src/node/services/mcpConfigService.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, test, expect, beforeEach, afterEach } from \"bun:test\";\nimport * as fs from \"fs/promises\";\nimport * as path from \"path\";\nimport * as os from \"os\";\nimport { Config } from \"@/node/config\";\nimport { MCPConfigService } from \"./mcpConfigService\";\nimport { MCPServerManager } from \"./mcpServerManager\";\nimport type { WorkspaceMCPOverrides } from \"@/common/types/mcp\";\n\ndescribe(\"MCPConfigService\", () => {\n  let tempDir: string;\n  let config: Config;\n  let configService: MCPConfigService;\n\n  beforeEach(async () => {\n    tempDir = await fs.mkdtemp(path.join(os.tmpdir(), \"mcp-test-\"));\n    config = new Config(tempDir);\n    configService = new MCPConfigService(config);\n  });\n\n  afterEach(async () => {\n    await fs.rm(tempDir, { recursive: true, force: true });\n  });\n\n  test(\"writes global config to <rootDir>/mcp.jsonc\", async () => {\n    const result = await configService.addServer(\"test\", {\n      transport: \"stdio\",\n      command: \"echo hi\",\n    });\n    expect(result).toEqual({ success: true, data: undefined });\n\n    const globalPath = path.join(config.rootDir, \"mcp.jsonc\");\n    const raw = await fs.readFile(globalPath, \"utf-8\");\n\n    // Basic smoke check: file exists and contains our server name.\n    expect(raw).toContain('\"test\"');\n  });\n\n  test(\"listServers merges repo overrides on top of global (override wins by name)\", async () => {\n    await configService.addServer(\"shared\", {\n      transport: \"stdio\",\n      command: \"global-shared\",\n    });\n\n    await configService.addServer(\"global-only\", {\n      transport: \"stdio\",\n      command: \"global-only\",\n    });\n\n    const projectPath = path.join(tempDir, \"repo\");\n    await fs.mkdir(path.join(projectPath, \".mux\"), { recursive: true });\n    await fs.writeFile(\n      path.join(projectPath, \".mux\", \"mcp.jsonc\"),\n      `// repo override\\n{\\n  \"servers\": {\\n    \"shared\": \"repo-shared\",\\n    \"repo-only\": { \"command\": \"repo-only\", \"disabled\": true }\\n  }\\n}\\n`,\n      \"utf-8\"\n    );\n\n    const merged = await configService.listServers(projectPath);\n\n    expect(merged).toEqual({\n      shared: { transport: \"stdio\", command: \"repo-shared\", disabled: false },\n      \"global-only\": { transport: \"stdio\", command: \"global-only\", disabled: false },\n      \"repo-only\": { transport: \"stdio\", command: \"repo-only\", disabled: true },\n    });\n  });\n});\n\ndescribe(\"MCP server disable filtering\", () => {\n  let tempDir: string;\n  let configService: MCPConfigService;\n  let serverManager: MCPServerManager;\n\n  beforeEach(async () => {\n    tempDir = await fs.mkdtemp(path.join(os.tmpdir(), \"mcp-test-\"));\n    const config = new Config(tempDir);\n\n    configService = new MCPConfigService(config);\n    serverManager = new MCPServerManager(configService);\n  });\n\n  afterEach(async () => {\n    serverManager.dispose();\n    await fs.rm(tempDir, { recursive: true, force: true });\n  });\n\n  test(\"disabled servers are filtered from manager.listServers\", async () => {\n    // Add two servers\n    await configService.addServer(\"enabled-server\", {\n      transport: \"stdio\",\n      command: \"cmd1\",\n    });\n    await configService.addServer(\"disabled-server\", {\n      transport: \"stdio\",\n      command: \"cmd2\",\n    });\n\n    // Disable one\n    await configService.setServerEnabled(\"disabled-server\", false);\n\n    // Config service returns both (with disabled flag)\n    const allServers = await configService.listServers(tempDir);\n    expect(allServers).toEqual({\n      \"enabled-server\": { transport: \"stdio\", command: \"cmd1\", disabled: false },\n      \"disabled-server\": { transport: \"stdio\", command: \"cmd2\", disabled: true },\n    });\n\n    // Server manager filters to enabled only\n    const enabledServers = await serverManager.listServers(tempDir);\n    expect(enabledServers).toEqual({\n      \"enabled-server\": { transport: \"stdio\", command: \"cmd1\", disabled: false },\n    });\n  });\n});\n\ndescribe(\"Workspace MCP overrides filtering\", () => {\n  let tempDir: string;\n  let configService: MCPConfigService;\n  let serverManager: MCPServerManager;\n\n  beforeEach(async () => {\n    tempDir = await fs.mkdtemp(path.join(os.tmpdir(), \"mcp-test-\"));\n    const config = new Config(tempDir);\n\n    configService = new MCPConfigService(config);\n    serverManager = new MCPServerManager(configService);\n\n    // Set up multiple servers for testing\n    await configService.addServer(\"server-a\", { transport: \"stdio\", command: \"cmd-a\" });\n    await configService.addServer(\"server-b\", { transport: \"stdio\", command: \"cmd-b\" });\n    await configService.addServer(\"server-c\", { transport: \"stdio\", command: \"cmd-c\" });\n  });\n\n  afterEach(async () => {\n    serverManager.dispose();\n    await fs.rm(tempDir, { recursive: true, force: true });\n  });\n\n  test(\"listServers with no overrides returns all enabled servers\", async () => {\n    const servers = await serverManager.listServers(tempDir);\n    expect(servers).toEqual({\n      \"server-a\": { transport: \"stdio\", command: \"cmd-a\", disabled: false },\n      \"server-b\": { transport: \"stdio\", command: \"cmd-b\", disabled: false },\n      \"server-c\": { transport: \"stdio\", command: \"cmd-c\", disabled: false },\n    });\n  });\n\n  test(\"listServers with empty overrides returns all enabled servers\", async () => {\n    const overrides: WorkspaceMCPOverrides = {};\n    const servers = await serverManager.listServers(tempDir, overrides);\n    expect(servers).toEqual({\n      \"server-a\": { transport: \"stdio\", command: \"cmd-a\", disabled: false },\n      \"server-b\": { transport: \"stdio\", command: \"cmd-b\", disabled: false },\n      \"server-c\": { transport: \"stdio\", command: \"cmd-c\", disabled: false },\n    });\n  });\n\n  test(\"listServers with disabledServers filters out disabled servers\", async () => {\n    const overrides: WorkspaceMCPOverrides = {\n      disabledServers: [\"server-a\", \"server-c\"],\n    };\n    const servers = await serverManager.listServers(tempDir, overrides);\n    expect(servers).toEqual({\n      \"server-b\": { transport: \"stdio\", command: \"cmd-b\", disabled: false },\n    });\n  });\n\n  test(\"listServers with disabledServers removes servers not in config (no error)\", async () => {\n    const overrides: WorkspaceMCPOverrides = {\n      disabledServers: [\"non-existent-server\"],\n    };\n    const servers = await serverManager.listServers(tempDir, overrides);\n    expect(servers).toEqual({\n      \"server-a\": { transport: \"stdio\", command: \"cmd-a\", disabled: false },\n      \"server-b\": { transport: \"stdio\", command: \"cmd-b\", disabled: false },\n      \"server-c\": { transport: \"stdio\", command: \"cmd-c\", disabled: false },\n    });\n  });\n\n  test(\"enabledServers overrides project-level disabled\", async () => {\n    // Disable server-a at project level\n    await configService.setServerEnabled(\"server-a\", false);\n\n    // Without override, server-a should be disabled\n    const serversWithoutOverride = await serverManager.listServers(tempDir);\n    expect(serversWithoutOverride).toEqual({\n      \"server-b\": { transport: \"stdio\", command: \"cmd-b\", disabled: false },\n      \"server-c\": { transport: \"stdio\", command: \"cmd-c\", disabled: false },\n    });\n\n    // With enabledServers override, server-a should be re-enabled\n    const overrides: WorkspaceMCPOverrides = {\n      enabledServers: [\"server-a\"],\n    };\n    const serversWithOverride = await serverManager.listServers(tempDir, overrides);\n    expect(serversWithOverride).toEqual({\n      \"server-a\": { transport: \"stdio\", command: \"cmd-a\", disabled: false },\n      \"server-b\": { transport: \"stdio\", command: \"cmd-b\", disabled: false },\n      \"server-c\": { transport: \"stdio\", command: \"cmd-c\", disabled: false },\n    });\n  });\n\n  test(\"project-disabled and workspace-disabled work together\", async () => {\n    // Disable server-a at project level\n    await configService.setServerEnabled(\"server-a\", false);\n\n    // Disable server-b at workspace level\n    const overrides: WorkspaceMCPOverrides = {\n      disabledServers: [\"server-b\"],\n    };\n\n    const servers = await serverManager.listServers(tempDir, overrides);\n    // Only server-c should remain\n    expect(servers).toEqual({\n      \"server-c\": { transport: \"stdio\", command: \"cmd-c\", disabled: false },\n    });\n  });\n});\n"]}