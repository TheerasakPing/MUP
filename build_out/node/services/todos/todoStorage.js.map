{"version":3,"file":"todoStorage.js","sourceRoot":"","sources":["../../../../src/node/services/todos/todoStorage.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAY,EAAE,wCAAoB;AAClC,MAAY,IAAI,iCAAa;AAI7B,MAAM,cAAc,GAAG,YAAY,CAAC;AAEpC;;GAEG;AACH,yBAAgC,mBAA2B,EAAU;IACnE,OAAO,IAAI,CAAC,IAAI,CAAC,mBAAmB,EAAE,cAAc,CAAC,CAAC;AAAA,CACvD;AAED,yBAAgC,KAAc,EAAc;IAC1D,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC;QAC1B,OAAO,EAAE,CAAC;IACZ,CAAC;IAED,MAAM,MAAM,GAAe,EAAE,CAAC;IAC9B,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE,CAAC;QACzB,IAAI,CAAC,IAAI,IAAI,OAAO,IAAI,KAAK,QAAQ;YAAE,SAAS;QAEhD,MAAM,OAAO,GAAI,IAA8B,CAAC,OAAO,CAAC;QACxD,MAAM,MAAM,GAAI,IAA6B,CAAC,MAAM,CAAC;QAErD,IAAI,OAAO,OAAO,KAAK,QAAQ;YAAE,SAAS;QAC1C,IAAI,MAAM,KAAK,SAAS,IAAI,MAAM,KAAK,aAAa,IAAI,MAAM,KAAK,WAAW;YAAE,SAAS;QAEzF,MAAM,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,CAAC;IACnC,CAAC;IAED,OAAO,MAAM,CAAC;AAAA,CACf;AAED;;GAEG;AACI,KAAK,iCAAiC,mBAA2B,EAAuB;IAC7F,MAAM,QAAQ,GAAG,eAAe,CAAC,mBAAmB,CAAC,CAAC;IAEtD,IAAI,CAAC;QACH,MAAM,OAAO,GAAG,MAAM,EAAE,CAAC,QAAQ,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;QACrD,MAAM,MAAM,GAAY,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;QAC5C,OAAO,eAAe,CAAC,MAAM,CAAC,CAAC;IACjC,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,uCAAuC;QACvC,IAAI,KAAK,IAAI,OAAO,KAAK,KAAK,QAAQ,IAAI,MAAM,IAAI,KAAK,IAAI,KAAK,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;YACrF,OAAO,EAAE,CAAC;QACZ,CAAC;QACD,OAAO,EAAE,CAAC;IACZ,CAAC;AAAA,CACF","sourcesContent":["import * as fs from \"fs/promises\";\r\nimport * as path from \"path\";\r\n\r\nimport type { TodoItem } from \"@/common/types/tools\";\r\n\r\nconst TODO_FILE_NAME = \"todos.json\";\r\n\r\n/**\r\n * Get path to todos.json file in the workspace's session directory.\r\n */\r\nexport function getTodoFilePath(workspaceSessionDir: string): string {\r\n  return path.join(workspaceSessionDir, TODO_FILE_NAME);\r\n}\r\n\r\nexport function coerceTodoItems(value: unknown): TodoItem[] {\r\n  if (!Array.isArray(value)) {\r\n    return [];\r\n  }\r\n\r\n  const result: TodoItem[] = [];\r\n  for (const item of value) {\r\n    if (!item || typeof item !== \"object\") continue;\r\n\r\n    const content = (item as { content?: unknown }).content;\r\n    const status = (item as { status?: unknown }).status;\r\n\r\n    if (typeof content !== \"string\") continue;\r\n    if (status !== \"pending\" && status !== \"in_progress\" && status !== \"completed\") continue;\r\n\r\n    result.push({ content, status });\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Read todos from the workspace session directory.\r\n */\r\nexport async function readTodosForSessionDir(workspaceSessionDir: string): Promise<TodoItem[]> {\r\n  const todoFile = getTodoFilePath(workspaceSessionDir);\r\n\r\n  try {\r\n    const content = await fs.readFile(todoFile, \"utf-8\");\r\n    const parsed: unknown = JSON.parse(content);\r\n    return coerceTodoItems(parsed);\r\n  } catch (error) {\r\n    // File doesn't exist yet or is invalid\r\n    if (error && typeof error === \"object\" && \"code\" in error && error.code === \"ENOENT\") {\r\n      return [];\r\n    }\r\n    return [];\r\n  }\r\n}\r\n"]}