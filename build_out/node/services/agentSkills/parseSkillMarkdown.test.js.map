{"version":3,"file":"parseSkillMarkdown.test.js","sourceRoot":"","sources":["../../../../src/node/services/agentSkills/parseSkillMarkdown.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, test } from \"bun:test\";\n\nimport { SkillNameSchema } from \"@/common/orpc/schemas\";\nimport { AgentSkillParseError, parseSkillMarkdown } from \"./parseSkillMarkdown\";\n\ndescribe(\"parseSkillMarkdown\", () => {\n  test(\"parses valid YAML frontmatter and body\", () => {\n    const content = `---\nname: pdf-processing\ndescription: Extract text from PDFs\n---\n# Instructions\nDo the thing.\n`;\n\n    const directoryName = SkillNameSchema.parse(\"pdf-processing\");\n\n    const result = parseSkillMarkdown({\n      content,\n      byteSize: Buffer.byteLength(content, \"utf-8\"),\n      directoryName,\n    });\n\n    expect(result.frontmatter.name).toBe(\"pdf-processing\");\n    expect(result.frontmatter.description).toBe(\"Extract text from PDFs\");\n    expect(result.body).toContain(\"# Instructions\");\n  });\n\n  test(\"tolerates unknown frontmatter keys (e.g., allowed-tools)\", () => {\n    const content = `---\nname: foo\ndescription: Hello\nallowed-tools: file_read\n---\nBody\n`;\n\n    const directoryName = SkillNameSchema.parse(\"foo\");\n\n    const result = parseSkillMarkdown({\n      content,\n      byteSize: Buffer.byteLength(content, \"utf-8\"),\n      directoryName,\n    });\n\n    expect(result.frontmatter.name).toBe(\"foo\");\n    expect(result.frontmatter.description).toBe(\"Hello\");\n  });\n\n  test(\"parses advertise field in frontmatter\", () => {\n    const content = `---\nname: internal-skill\ndescription: An internal skill not shown in the index\nadvertise: false\n---\nBody\n`;\n\n    const directoryName = SkillNameSchema.parse(\"internal-skill\");\n\n    const result = parseSkillMarkdown({\n      content,\n      byteSize: Buffer.byteLength(content, \"utf-8\"),\n      directoryName,\n    });\n\n    expect(result.frontmatter.name).toBe(\"internal-skill\");\n    expect(result.frontmatter.advertise).toBe(false);\n  });\n\n  test(\"throws on missing frontmatter\", () => {\n    const content = \"# No frontmatter\\n\";\n    expect(() =>\n      parseSkillMarkdown({\n        content,\n        byteSize: Buffer.byteLength(content, \"utf-8\"),\n      })\n    ).toThrow(AgentSkillParseError);\n  });\n\n  test(\"throws when frontmatter name does not match directory name\", () => {\n    const content = `---\nname: bar\ndescription: Hello\n---\nBody\n`;\n\n    const directoryName = SkillNameSchema.parse(\"foo\");\n\n    expect(() =>\n      parseSkillMarkdown({\n        content,\n        byteSize: Buffer.byteLength(content, \"utf-8\"),\n        directoryName,\n      })\n    ).toThrow(AgentSkillParseError);\n  });\n});\n"]}