{"version":3,"file":"parseSkillMarkdown.test.js","sourceRoot":"","sources":["../../../../src/node/services/agentSkills/parseSkillMarkdown.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, test } from \"bun:test\";\r\n\r\nimport { SkillNameSchema } from \"@/common/orpc/schemas\";\r\nimport { AgentSkillParseError, parseSkillMarkdown } from \"./parseSkillMarkdown\";\r\n\r\ndescribe(\"parseSkillMarkdown\", () => {\r\n  test(\"parses valid YAML frontmatter and body\", () => {\r\n    const content = `---\r\nname: pdf-processing\r\ndescription: Extract text from PDFs\r\n---\r\n# Instructions\r\nDo the thing.\r\n`;\r\n\r\n    const directoryName = SkillNameSchema.parse(\"pdf-processing\");\r\n\r\n    const result = parseSkillMarkdown({\r\n      content,\r\n      byteSize: Buffer.byteLength(content, \"utf-8\"),\r\n      directoryName,\r\n    });\r\n\r\n    expect(result.frontmatter.name).toBe(\"pdf-processing\");\r\n    expect(result.frontmatter.description).toBe(\"Extract text from PDFs\");\r\n    expect(result.body).toContain(\"# Instructions\");\r\n  });\r\n\r\n  test(\"tolerates unknown frontmatter keys (e.g., allowed-tools)\", () => {\r\n    const content = `---\r\nname: foo\r\ndescription: Hello\r\nallowed-tools: file_read\r\n---\r\nBody\r\n`;\r\n\r\n    const directoryName = SkillNameSchema.parse(\"foo\");\r\n\r\n    const result = parseSkillMarkdown({\r\n      content,\r\n      byteSize: Buffer.byteLength(content, \"utf-8\"),\r\n      directoryName,\r\n    });\r\n\r\n    expect(result.frontmatter.name).toBe(\"foo\");\r\n    expect(result.frontmatter.description).toBe(\"Hello\");\r\n  });\r\n\r\n  test(\"parses advertise field in frontmatter\", () => {\r\n    const content = `---\r\nname: internal-skill\r\ndescription: An internal skill not shown in the index\r\nadvertise: false\r\n---\r\nBody\r\n`;\r\n\r\n    const directoryName = SkillNameSchema.parse(\"internal-skill\");\r\n\r\n    const result = parseSkillMarkdown({\r\n      content,\r\n      byteSize: Buffer.byteLength(content, \"utf-8\"),\r\n      directoryName,\r\n    });\r\n\r\n    expect(result.frontmatter.name).toBe(\"internal-skill\");\r\n    expect(result.frontmatter.advertise).toBe(false);\r\n  });\r\n\r\n  test(\"throws on missing frontmatter\", () => {\r\n    const content = \"# No frontmatter\\n\";\r\n    expect(() =>\r\n      parseSkillMarkdown({\r\n        content,\r\n        byteSize: Buffer.byteLength(content, \"utf-8\"),\r\n      })\r\n    ).toThrow(AgentSkillParseError);\r\n  });\r\n\r\n  test(\"throws when frontmatter name does not match directory name\", () => {\r\n    const content = `---\r\nname: bar\r\ndescription: Hello\r\n---\r\nBody\r\n`;\r\n\r\n    const directoryName = SkillNameSchema.parse(\"foo\");\r\n\r\n    expect(() =>\r\n      parseSkillMarkdown({\r\n        content,\r\n        byteSize: Buffer.byteLength(content, \"utf-8\"),\r\n        directoryName,\r\n      })\r\n    ).toThrow(AgentSkillParseError);\r\n  });\r\n});\r\n"]}