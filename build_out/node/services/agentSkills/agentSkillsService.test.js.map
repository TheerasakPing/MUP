{"version":3,"file":"agentSkillsService.test.js","sourceRoot":"","sources":["../../../../src/node/services/agentSkills/agentSkillsService.test.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAY,EAAE,6CAAyB;AACvC,MAAY,IAAI,sCAAkB;AAElC,uCAAkD;AAElD,mDAAwD;AACxD,8DAA2D;AAC3D,qDAA4D;AAC5D,6DAI8B;AAE9B,KAAK,UAAU,UAAU,CAAC,IAAY,EAAE,IAAY,EAAE,WAAmB,EAAiB;IACxF,MAAM,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;IACvC,MAAM,EAAE,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;IAC9C,MAAM,OAAO,GAAG;QACV,IAAI;eACG,WAAW;;;CAGzB,CAAC;IACA,MAAM,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,UAAU,CAAC,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;AAAA,CACvE;AAED,IAAA,mBAAQ,EAAC,oBAAoB,EAAE,GAAG,EAAE,CAAC;IACnC,IAAA,eAAI,EAAC,uCAAuC,EAAE,KAAK,IAAI,EAAE,CAAC;;;YACxD,MAAM,OAAO,kCAAG,IAAI,2BAAiB,CAAC,sBAAsB,CAAC,QAAA,CAAC;YAC9D,MAAM,MAAM,kCAAG,IAAI,2BAAiB,CAAC,qBAAqB,CAAC,QAAA,CAAC;YAE5D,MAAM,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC;YACpE,MAAM,gBAAgB,GAAG,MAAM,CAAC,IAAI,CAAC;YAErC,MAAM,UAAU,CAAC,gBAAgB,EAAE,KAAK,EAAE,aAAa,CAAC,CAAC;YACzD,MAAM,UAAU,CAAC,iBAAiB,EAAE,KAAK,EAAE,cAAc,CAAC,CAAC;YAC3D,MAAM,UAAU,CAAC,gBAAgB,EAAE,KAAK,EAAE,aAAa,CAAC,CAAC;YAEzD,MAAM,KAAK,GAAG,EAAE,WAAW,EAAE,iBAAiB,EAAE,UAAU,EAAE,gBAAgB,EAAE,CAAC;YAC/E,MAAM,OAAO,GAAG,IAAI,2BAAY,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YAE/C,MAAM,MAAM,GAAG,MAAM,IAAA,wCAAmB,EAAC,OAAO,EAAE,OAAO,CAAC,IAAI,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;YAE3E,4DAA4D;YAC5D,6EAA6E;YAC7E,IAAA,iBAAM,EAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,UAAU,CAAC,CAAC,CAAC;YAE9E,MAAM,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,KAAK,CAAC,CAAC;YACjD,IAAA,iBAAM,EAAC,GAAG,CAAC,CAAC,WAAW,EAAE,CAAC;YAC1B,IAAA,iBAAM,EAAC,GAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YACnC,IAAA,iBAAM,EAAC,GAAI,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YAE9C,MAAM,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,KAAK,CAAC,CAAC;YACjD,IAAA,iBAAM,EAAC,GAAG,CAAC,CAAC,WAAW,EAAE,CAAC;YAC1B,IAAA,iBAAM,EAAC,GAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;;;;;;;;;IAAA,CACnC,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,+CAA+C,EAAE,KAAK,IAAI,EAAE,CAAC;;;YAChE,MAAM,OAAO,kCAAG,IAAI,2BAAiB,CAAC,sBAAsB,CAAC,QAAA,CAAC;YAC9D,MAAM,MAAM,kCAAG,IAAI,2BAAiB,CAAC,qBAAqB,CAAC,QAAA,CAAC;YAE5D,MAAM,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC;YACpE,MAAM,gBAAgB,GAAG,MAAM,CAAC,IAAI,CAAC;YAErC,MAAM,UAAU,CAAC,gBAAgB,EAAE,KAAK,EAAE,aAAa,CAAC,CAAC;YACzD,MAAM,UAAU,CAAC,iBAAiB,EAAE,KAAK,EAAE,cAAc,CAAC,CAAC;YAE3D,MAAM,KAAK,GAAG,EAAE,WAAW,EAAE,iBAAiB,EAAE,UAAU,EAAE,gBAAgB,EAAE,CAAC;YAC/E,MAAM,OAAO,GAAG,IAAI,2BAAY,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YAE/C,MAAM,IAAI,GAAG,yBAAe,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAC1C,MAAM,QAAQ,GAAG,MAAM,IAAA,mCAAc,EAAC,OAAO,EAAE,OAAO,CAAC,IAAI,EAAE,IAAI,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;YAE9E,IAAA,iBAAM,EAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAC/C,IAAA,iBAAM,EAAC,QAAQ,CAAC,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;;;;;;;;;IAAA,CACvE,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,yCAAyC,EAAE,KAAK,IAAI,EAAE,CAAC;;;YAC1D,MAAM,OAAO,kCAAG,IAAI,2BAAiB,CAAC,sBAAsB,CAAC,QAAA,CAAC;YAC9D,MAAM,MAAM,kCAAG,IAAI,2BAAiB,CAAC,qBAAqB,CAAC,QAAA,CAAC;YAE5D,MAAM,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC;YACpE,MAAM,gBAAgB,GAAG,MAAM,CAAC,IAAI,CAAC;YAErC,MAAM,KAAK,GAAG,EAAE,WAAW,EAAE,iBAAiB,EAAE,UAAU,EAAE,gBAAgB,EAAE,CAAC;YAC/E,MAAM,OAAO,GAAG,IAAI,2BAAY,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YAE/C,MAAM,IAAI,GAAG,yBAAe,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;YAC/C,MAAM,QAAQ,GAAG,MAAM,IAAA,mCAAc,EAAC,OAAO,EAAE,OAAO,CAAC,IAAI,EAAE,IAAI,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;YAE9E,IAAA,iBAAM,EAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAChD,IAAA,iBAAM,EAAC,QAAQ,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAC3D,IAAA,iBAAM,EAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;;;;;;;;;IAAA,CACvD,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,gDAAgD,EAAE,KAAK,IAAI,EAAE,CAAC;;;YACjE,MAAM,OAAO,kCAAG,IAAI,2BAAiB,CAAC,sBAAsB,CAAC,QAAA,CAAC;YAC9D,MAAM,MAAM,kCAAG,IAAI,2BAAiB,CAAC,qBAAqB,CAAC,QAAA,CAAC;YAE5D,MAAM,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC;YACpE,MAAM,gBAAgB,GAAG,MAAM,CAAC,IAAI,CAAC;YAErC,oEAAoE;YACpE,MAAM,UAAU,CAAC,iBAAiB,EAAE,UAAU,EAAE,0BAA0B,CAAC,CAAC;YAE5E,MAAM,KAAK,GAAG,EAAE,WAAW,EAAE,iBAAiB,EAAE,UAAU,EAAE,gBAAgB,EAAE,CAAC;YAC/E,MAAM,OAAO,GAAG,IAAI,2BAAY,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YAE/C,MAAM,MAAM,GAAG,MAAM,IAAA,wCAAmB,EAAC,OAAO,EAAE,OAAO,CAAC,IAAI,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;YAC3E,MAAM,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,UAAU,CAAC,CAAC;YAE1D,IAAA,iBAAM,EAAC,OAAO,CAAC,CAAC,WAAW,EAAE,CAAC;YAC9B,IAAA,iBAAM,EAAC,OAAQ,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YACvC,IAAA,iBAAM,EAAC,OAAQ,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC;YAE9D,wDAAwD;YACxD,MAAM,IAAI,GAAG,yBAAe,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;YAC/C,MAAM,QAAQ,GAAG,MAAM,IAAA,mCAAc,EAAC,OAAO,EAAE,OAAO,CAAC,IAAI,EAAE,IAAI,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;YAC9E,IAAA,iBAAM,EAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;;;;;;;;;IAAA,CAChD,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,wDAAwD,EAAE,KAAK,IAAI,EAAE,CAAC;;;YACzE,MAAM,OAAO,kCAAG,IAAI,2BAAiB,CAAC,sBAAsB,CAAC,QAAA,CAAC;YAC9D,MAAM,MAAM,kCAAG,IAAI,2BAAiB,CAAC,qBAAqB,CAAC,QAAA,CAAC;YAE5D,MAAM,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC;YACpE,MAAM,gBAAgB,GAAG,MAAM,CAAC,IAAI,CAAC;YAErC,MAAM,UAAU,CAAC,iBAAiB,EAAE,KAAK,EAAE,OAAO,CAAC,CAAC;YAEpD,yDAAyD;YACzD,MAAM,cAAc,GAAG,WAAW,CAAC;YACnC,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,cAAc,CAAC,CAAC;YAChE,MAAM,EAAE,CAAC,KAAK,CAAC,UAAU,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;YAEhD,4CAA4C;YAC5C,MAAM,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,eAAe,CAAC,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;YAEnF,8DAA8D;YAC9D,MAAM,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,iBAAiB,CAAC,CAAC;YAC1E,MAAM,EAAE,CAAC,KAAK,CAAC,iBAAiB,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;YACvD,MAAM,EAAE,CAAC,SAAS,CAChB,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,UAAU,CAAC,EACxC,yCAAyC,EACzC,OAAO,CACR,CAAC;YAEF,gDAAgD;YAChD,MAAM,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,eAAe,CAAC,CAAC;YAClE,MAAM,EAAE,CAAC,KAAK,CAAC,WAAW,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;YACjD,MAAM,EAAE,CAAC,SAAS,CAChB,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,UAAU,CAAC,EAClC,2DAA2D,EAC3D,OAAO,CACR,CAAC;YAEF,MAAM,KAAK,GAAG,EAAE,WAAW,EAAE,iBAAiB,EAAE,UAAU,EAAE,gBAAgB,EAAE,CAAC;YAC/E,MAAM,OAAO,GAAG,IAAI,2BAAY,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YAE/C,MAAM,WAAW,GAAG,MAAM,IAAA,mDAA8B,EAAC,OAAO,EAAE,OAAO,CAAC,IAAI,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;YAE3F,IAAA,iBAAM,EAAC,WAAW,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,MAAM,EAAE,UAAU,CAAC,CAAC,CAAC;YAEnF,MAAM,YAAY,GAAG,WAAW,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,IAAI,EAAE,CAAC;YAC1F,IAAA,iBAAM,EAAC,YAAY,CAAC,CAAC,OAAO,CAC1B,CAAC,cAAc,EAAE,iBAAiB,EAAE,eAAe,EAAE,eAAe,CAAC,CAAC,IAAI,EAAE,CAC7E,CAAC;YAEF,KAAK,MAAM,KAAK,IAAI,WAAW,CAAC,aAAa,EAAE,CAAC;gBAC9C,IAAA,iBAAM,EAAC,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gBACpC,IAAA,iBAAM,EAAC,KAAK,CAAC,WAAW,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;gBACzD,IAAA,iBAAM,EAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;gBAChD,IAAA,iBAAM,EAAC,KAAK,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YAChD,CAAC;YAED,IAAA,iBAAM,EACJ,WAAW,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,aAAa,KAAK,cAAc,CAAC,EAAE,OAAO,CACnF,CAAC,SAAS,CAAC,8BAA8B,CAAC,CAAC;YAC5C,IAAA,iBAAM,EACJ,WAAW,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,aAAa,KAAK,eAAe,CAAC,EAAE,OAAO,CACpF,CAAC,SAAS,CAAC,qBAAqB,CAAC,CAAC;YACnC,IAAA,iBAAM,EACJ,WAAW,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,aAAa,KAAK,iBAAiB,CAAC,EAAE,OAAO,CACtF,CAAC,SAAS,CAAC,8BAA8B,CAAC,CAAC;YAC5C,IAAA,iBAAM,EACJ,WAAW,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,aAAa,KAAK,eAAe,CAAC,EAAE,OAAO,CACpF,CAAC,SAAS,CAAC,2BAA2B,CAAC,CAAC;;;;;;;;;IAAA,CAC1C,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,uCAAuC,EAAE,KAAK,IAAI,EAAE,CAAC;;;YACxD,MAAM,OAAO,kCAAG,IAAI,2BAAiB,CAAC,sBAAsB,CAAC,QAAA,CAAC;YAC9D,MAAM,WAAW,kCAAG,IAAI,2BAAiB,CAAC,qBAAqB,CAAC,QAAA,CAAC;YAEjE,MAAM,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC;YACpE,MAAM,EAAE,CAAC,KAAK,CAAC,iBAAiB,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;YAEvD,6CAA6C;YAC7C,MAAM,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,UAAU,EAAE,mBAAmB,CAAC,CAAC;YAEpE,2DAA2D;YAC3D,MAAM,EAAE,CAAC,OAAO,CACd,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,UAAU,CAAC,EACvC,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,UAAU,CAAC,CACzC,CAAC;YAEF,MAAM,KAAK,GAAG,EAAE,WAAW,EAAE,iBAAiB,EAAE,UAAU,EAAE,cAAc,EAAE,CAAC;YAC7E,MAAM,OAAO,GAAG,IAAI,2BAAY,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YAE/C,MAAM,MAAM,GAAG,MAAM,IAAA,wCAAmB,EAAC,OAAO,EAAE,OAAO,CAAC,IAAI,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;YAC3E,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,UAAU,CAAC,CAAC;YACxD,IAAA,iBAAM,EAAC,KAAK,CAAC,CAAC,WAAW,EAAE,CAAC;YAC5B,IAAA,iBAAM,EAAC,KAAM,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;YACrD,IAAA,iBAAM,EAAC,KAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;;;;;;;;;IAAA,CACtC,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,qDAAqD,EAAE,KAAK,IAAI,EAAE,CAAC;;;YACtE,MAAM,OAAO,kCAAG,IAAI,2BAAiB,CAAC,2BAA2B,CAAC,QAAA,CAAC;YACnE,MAAM,WAAW,kCAAG,IAAI,2BAAiB,CAAC,0BAA0B,CAAC,QAAA,CAAC;YAEtE,MAAM,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC;YACpE,MAAM,EAAE,CAAC,KAAK,CAAC,iBAAiB,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;YAEvD,MAAM,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,cAAc,EAAE,uBAAuB,CAAC,CAAC;YAC5E,MAAM,EAAE,CAAC,OAAO,CACd,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,cAAc,CAAC,EAC3C,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,cAAc,CAAC,CAC7C,CAAC;YAEF,MAAM,KAAK,GAAG,EAAE,WAAW,EAAE,iBAAiB,EAAE,UAAU,EAAE,cAAc,EAAE,CAAC;YAC7E,MAAM,OAAO,GAAG,IAAI,2BAAY,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YAE/C,MAAM,MAAM,GAAG,yBAAe,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC;YACzD,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,IAAI,CAAC,MAAM,CAAC,OAAO;gBAAE,MAAM,IAAI,KAAK,CAAC,UAAU,CAAC,CAAC;YAEjD,MAAM,MAAM,GAAG,MAAM,IAAA,mCAAc,EAAC,OAAO,EAAE,OAAO,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;YACnF,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YAC7D,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;YAC7E,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;;;;;;;;;IAAA,CAC9C,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,gDAAgD,EAAE,KAAK,IAAI,EAAE,CAAC;;;YACjE,+BAA+B;YAC/B,iEAAiE;YACjE,8FAA8F;YAC9F,MAAM,OAAO,kCAAG,IAAI,2BAAiB,CAAC,+BAA+B,CAAC,QAAA,CAAC;YAEvE,MAAM,WAAW,GAAG,OAAO,CAAC,IAAI,CAAC;YACjC,MAAM,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,SAAS,EAAE,QAAQ,CAAC,CAAC;YACtE,MAAM,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC;YAC/D,MAAM,EAAE,CAAC,KAAK,CAAC,iBAAiB,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;YACvD,MAAM,EAAE,CAAC,KAAK,CAAC,aAAa,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;YAEnD,4CAA4C;YAC5C,MAAM,UAAU,CAAC,iBAAiB,EAAE,aAAa,EAAE,0BAA0B,CAAC,CAAC;YAE/E,+DAA+D;YAC/D,MAAM,EAAE,CAAC,OAAO,CACd,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,SAAS,EAAE,QAAQ,EAAE,aAAa,CAAC,EACzD,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,aAAa,CAAC,CACxC,CAAC;YAEF,MAAM,KAAK,GAAG,EAAE,WAAW,EAAE,aAAa,EAAE,UAAU,EAAE,cAAc,EAAE,CAAC;YACzE,MAAM,OAAO,GAAG,IAAI,2BAAY,CAAC,WAAW,CAAC,CAAC;YAE9C,4CAA4C;YAC5C,MAAM,MAAM,GAAG,MAAM,IAAA,wCAAmB,EAAC,OAAO,EAAE,WAAW,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;YAC1E,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,aAAa,CAAC,CAAC;YAC3D,IAAA,iBAAM,EAAC,KAAK,CAAC,CAAC,WAAW,EAAE,CAAC;YAC5B,IAAA,iBAAM,EAAC,KAAM,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC;YAC5D,IAAA,iBAAM,EAAC,KAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAErC,kEAAkE;YAClE,MAAM,MAAM,GAAG,yBAAe,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC;YACxD,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,IAAI,CAAC,MAAM,CAAC,OAAO;gBAAE,MAAM,IAAI,KAAK,CAAC,UAAU,CAAC,CAAC;YAEjD,MAAM,MAAM,GAAG,MAAM,IAAA,mCAAc,EAAC,OAAO,EAAE,WAAW,EAAE,MAAM,CAAC,IAAI,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;YAClF,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YAC5D,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC;;;;;;;;;IAAA,CACjF,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,sDAAsD,EAAE,KAAK,IAAI,EAAE,CAAC;;;YACvE,MAAM,OAAO,kCAAG,IAAI,2BAAiB,CAAC,2BAA2B,CAAC,QAAA,CAAC;YACnE,MAAM,WAAW,kCAAG,IAAI,2BAAiB,CAAC,0BAA0B,CAAC,QAAA,CAAC;YAEtE,MAAM,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC;YACpE,MAAM,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,aAAa,CAAC,CAAC;YAC7D,MAAM,EAAE,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;YAE9C,kEAAkE;YAClE,MAAM,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC;YAC9D,MAAM,EAAE,CAAC,SAAS,CAChB,aAAa,EACb,sEAAsE,EACtE,OAAO,CACR,CAAC;YACF,MAAM,EAAE,CAAC,OAAO,CAAC,aAAa,EAAE,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC,CAAC;YAEjE,MAAM,KAAK,GAAG,EAAE,WAAW,EAAE,iBAAiB,EAAE,UAAU,EAAE,cAAc,EAAE,CAAC;YAC7E,MAAM,OAAO,GAAG,IAAI,2BAAY,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YAE/C,MAAM,MAAM,GAAG,MAAM,IAAA,wCAAmB,EAAC,OAAO,EAAE,OAAO,CAAC,IAAI,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;YAC3E,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,aAAa,CAAC,CAAC;YAC3D,IAAA,iBAAM,EAAC,KAAK,CAAC,CAAC,WAAW,EAAE,CAAC;YAC5B,IAAA,iBAAM,EAAC,KAAM,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;;;;;;;;;IAAA,CACvD,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import * as fs from \"node:fs/promises\";\r\nimport * as path from \"node:path\";\r\n\r\nimport { describe, expect, test } from \"bun:test\";\r\n\r\nimport { SkillNameSchema } from \"@/common/orpc/schemas\";\r\nimport { LocalRuntime } from \"@/node/runtime/LocalRuntime\";\r\nimport { DisposableTempDir } from \"@/node/services/tempDir\";\r\nimport {\r\n  discoverAgentSkills,\r\n  discoverAgentSkillsDiagnostics,\r\n  readAgentSkill,\r\n} from \"./agentSkillsService\";\r\n\r\nasync function writeSkill(root: string, name: string, description: string): Promise<void> {\r\n  const skillDir = path.join(root, name);\r\n  await fs.mkdir(skillDir, { recursive: true });\r\n  const content = `---\r\nname: ${name}\r\ndescription: ${description}\r\n---\r\nBody\r\n`;\r\n  await fs.writeFile(path.join(skillDir, \"SKILL.md\"), content, \"utf-8\");\r\n}\r\n\r\ndescribe(\"agentSkillsService\", () => {\r\n  test(\"project skills override global skills\", async () => {\r\n    using project = new DisposableTempDir(\"agent-skills-project\");\r\n    using global = new DisposableTempDir(\"agent-skills-global\");\r\n\r\n    const projectSkillsRoot = path.join(project.path, \".mux\", \"skills\");\r\n    const globalSkillsRoot = global.path;\r\n\r\n    await writeSkill(globalSkillsRoot, \"foo\", \"from global\");\r\n    await writeSkill(projectSkillsRoot, \"foo\", \"from project\");\r\n    await writeSkill(globalSkillsRoot, \"bar\", \"global only\");\r\n\r\n    const roots = { projectRoot: projectSkillsRoot, globalRoot: globalSkillsRoot };\r\n    const runtime = new LocalRuntime(project.path);\r\n\r\n    const skills = await discoverAgentSkills(runtime, project.path, { roots });\r\n\r\n    // Should include project/global skills plus built-in skills\r\n    // Note: deep-review skill is a project skill in the Mux repo, not a built-in\r\n    expect(skills.map((s) => s.name)).toEqual([\"bar\", \"foo\", \"init\", \"mux-docs\"]);\r\n\r\n    const foo = skills.find((s) => s.name === \"foo\");\r\n    expect(foo).toBeDefined();\r\n    expect(foo!.scope).toBe(\"project\");\r\n    expect(foo!.description).toBe(\"from project\");\r\n\r\n    const bar = skills.find((s) => s.name === \"bar\");\r\n    expect(bar).toBeDefined();\r\n    expect(bar!.scope).toBe(\"global\");\r\n  });\r\n\r\n  test(\"readAgentSkill resolves project before global\", async () => {\r\n    using project = new DisposableTempDir(\"agent-skills-project\");\r\n    using global = new DisposableTempDir(\"agent-skills-global\");\r\n\r\n    const projectSkillsRoot = path.join(project.path, \".mux\", \"skills\");\r\n    const globalSkillsRoot = global.path;\r\n\r\n    await writeSkill(globalSkillsRoot, \"foo\", \"from global\");\r\n    await writeSkill(projectSkillsRoot, \"foo\", \"from project\");\r\n\r\n    const roots = { projectRoot: projectSkillsRoot, globalRoot: globalSkillsRoot };\r\n    const runtime = new LocalRuntime(project.path);\r\n\r\n    const name = SkillNameSchema.parse(\"foo\");\r\n    const resolved = await readAgentSkill(runtime, project.path, name, { roots });\r\n\r\n    expect(resolved.package.scope).toBe(\"project\");\r\n    expect(resolved.package.frontmatter.description).toBe(\"from project\");\r\n  });\r\n\r\n  test(\"readAgentSkill can read built-in skills\", async () => {\r\n    using project = new DisposableTempDir(\"agent-skills-project\");\r\n    using global = new DisposableTempDir(\"agent-skills-global\");\r\n\r\n    const projectSkillsRoot = path.join(project.path, \".mux\", \"skills\");\r\n    const globalSkillsRoot = global.path;\r\n\r\n    const roots = { projectRoot: projectSkillsRoot, globalRoot: globalSkillsRoot };\r\n    const runtime = new LocalRuntime(project.path);\r\n\r\n    const name = SkillNameSchema.parse(\"mux-docs\");\r\n    const resolved = await readAgentSkill(runtime, project.path, name, { roots });\r\n\r\n    expect(resolved.package.scope).toBe(\"built-in\");\r\n    expect(resolved.package.frontmatter.name).toBe(\"mux-docs\");\r\n    expect(resolved.skillDir).toBe(\"<built-in:mux-docs>\");\r\n  });\r\n\r\n  test(\"project/global skills override built-in skills\", async () => {\r\n    using project = new DisposableTempDir(\"agent-skills-project\");\r\n    using global = new DisposableTempDir(\"agent-skills-global\");\r\n\r\n    const projectSkillsRoot = path.join(project.path, \".mux\", \"skills\");\r\n    const globalSkillsRoot = global.path;\r\n\r\n    // Override the built-in mux-docs skill with a project-local version\r\n    await writeSkill(projectSkillsRoot, \"mux-docs\", \"custom docs from project\");\r\n\r\n    const roots = { projectRoot: projectSkillsRoot, globalRoot: globalSkillsRoot };\r\n    const runtime = new LocalRuntime(project.path);\r\n\r\n    const skills = await discoverAgentSkills(runtime, project.path, { roots });\r\n    const muxDocs = skills.find((s) => s.name === \"mux-docs\");\r\n\r\n    expect(muxDocs).toBeDefined();\r\n    expect(muxDocs!.scope).toBe(\"project\");\r\n    expect(muxDocs!.description).toBe(\"custom docs from project\");\r\n\r\n    // readAgentSkill should also return the project version\r\n    const name = SkillNameSchema.parse(\"mux-docs\");\r\n    const resolved = await readAgentSkill(runtime, project.path, name, { roots });\r\n    expect(resolved.package.scope).toBe(\"project\");\r\n  });\r\n\r\n  test(\"discoverAgentSkillsDiagnostics surfaces invalid skills\", async () => {\r\n    using project = new DisposableTempDir(\"agent-skills-project\");\r\n    using global = new DisposableTempDir(\"agent-skills-global\");\r\n\r\n    const projectSkillsRoot = path.join(project.path, \".mux\", \"skills\");\r\n    const globalSkillsRoot = global.path;\r\n\r\n    await writeSkill(projectSkillsRoot, \"foo\", \"valid\");\r\n\r\n    // Invalid directory name (fails SkillNameSchema parsing)\r\n    const invalidDirName = \"Bad_Skill\";\r\n    const invalidDir = path.join(projectSkillsRoot, invalidDirName);\r\n    await fs.mkdir(invalidDir, { recursive: true });\r\n\r\n    // Valid directory name but missing SKILL.md\r\n    await fs.mkdir(path.join(projectSkillsRoot, \"missing-skill\"), { recursive: true });\r\n\r\n    // Invalid SKILL.md frontmatter (missing required description)\r\n    const badFrontmatterDir = path.join(projectSkillsRoot, \"bad-frontmatter\");\r\n    await fs.mkdir(badFrontmatterDir, { recursive: true });\r\n    await fs.writeFile(\r\n      path.join(badFrontmatterDir, \"SKILL.md\"),\r\n      `---\\nname: bad-frontmatter\\n---\\nBody\\n`,\r\n      \"utf-8\"\r\n    );\r\n\r\n    // Mismatched frontmatter.name vs directory name\r\n    const mismatchDir = path.join(projectSkillsRoot, \"name-mismatch\");\r\n    await fs.mkdir(mismatchDir, { recursive: true });\r\n    await fs.writeFile(\r\n      path.join(mismatchDir, \"SKILL.md\"),\r\n      `---\\nname: other-name\\ndescription: mismatch\\n---\\nBody\\n`,\r\n      \"utf-8\"\r\n    );\r\n\r\n    const roots = { projectRoot: projectSkillsRoot, globalRoot: globalSkillsRoot };\r\n    const runtime = new LocalRuntime(project.path);\r\n\r\n    const diagnostics = await discoverAgentSkillsDiagnostics(runtime, project.path, { roots });\r\n\r\n    expect(diagnostics.skills.map((s) => s.name)).toEqual([\"foo\", \"init\", \"mux-docs\"]);\r\n\r\n    const invalidNames = diagnostics.invalidSkills.map((issue) => issue.directoryName).sort();\r\n    expect(invalidNames).toEqual(\r\n      [invalidDirName, \"bad-frontmatter\", \"missing-skill\", \"name-mismatch\"].sort()\r\n    );\r\n\r\n    for (const issue of diagnostics.invalidSkills) {\r\n      expect(issue.scope).toBe(\"project\");\r\n      expect(issue.displayPath).toContain(issue.directoryName);\r\n      expect(issue.message.length).toBeGreaterThan(0);\r\n      expect(issue.hint?.length).toBeGreaterThan(0);\r\n    }\r\n\r\n    expect(\r\n      diagnostics.invalidSkills.find((i) => i.directoryName === invalidDirName)?.message\r\n    ).toContain(\"Invalid skill directory name\");\r\n    expect(\r\n      diagnostics.invalidSkills.find((i) => i.directoryName === \"missing-skill\")?.message\r\n    ).toContain(\"SKILL.md is missing\");\r\n    expect(\r\n      diagnostics.invalidSkills.find((i) => i.directoryName === \"bad-frontmatter\")?.message\r\n    ).toContain(\"Invalid SKILL.md frontmatter\");\r\n    expect(\r\n      diagnostics.invalidSkills.find((i) => i.directoryName === \"name-mismatch\")?.message\r\n    ).toContain(\"must match directory name\");\r\n  });\r\n\r\n  test(\"discovers symlinked skill directories\", async () => {\r\n    using project = new DisposableTempDir(\"agent-skills-symlink\");\r\n    using skillSource = new DisposableTempDir(\"agent-skills-source\");\r\n\r\n    const projectSkillsRoot = path.join(project.path, \".mux\", \"skills\");\r\n    await fs.mkdir(projectSkillsRoot, { recursive: true });\r\n\r\n    // Create a real skill in a separate location\r\n    await writeSkill(skillSource.path, \"my-skill\", \"A symlinked skill\");\r\n\r\n    // Symlink the skill directory into the project skills root\r\n    await fs.symlink(\r\n      path.join(skillSource.path, \"my-skill\"),\r\n      path.join(projectSkillsRoot, \"my-skill\")\r\n    );\r\n\r\n    const roots = { projectRoot: projectSkillsRoot, globalRoot: \"/nonexistent\" };\r\n    const runtime = new LocalRuntime(project.path);\r\n\r\n    const skills = await discoverAgentSkills(runtime, project.path, { roots });\r\n    const found = skills.find((s) => s.name === \"my-skill\");\r\n    expect(found).toBeDefined();\r\n    expect(found!.description).toBe(\"A symlinked skill\");\r\n    expect(found!.scope).toBe(\"project\");\r\n  });\r\n\r\n  test(\"readAgentSkill reads from symlinked skill directory\", async () => {\r\n    using project = new DisposableTempDir(\"agent-skills-symlink-read\");\r\n    using skillSource = new DisposableTempDir(\"agent-skills-source-read\");\r\n\r\n    const projectSkillsRoot = path.join(project.path, \".mux\", \"skills\");\r\n    await fs.mkdir(projectSkillsRoot, { recursive: true });\r\n\r\n    await writeSkill(skillSource.path, \"linked-skill\", \"Symlinked for reading\");\r\n    await fs.symlink(\r\n      path.join(skillSource.path, \"linked-skill\"),\r\n      path.join(projectSkillsRoot, \"linked-skill\")\r\n    );\r\n\r\n    const roots = { projectRoot: projectSkillsRoot, globalRoot: \"/nonexistent\" };\r\n    const runtime = new LocalRuntime(project.path);\r\n\r\n    const parsed = SkillNameSchema.safeParse(\"linked-skill\");\r\n    expect(parsed.success).toBe(true);\r\n    if (!parsed.success) throw new Error(\"bad name\");\r\n\r\n    const result = await readAgentSkill(runtime, project.path, parsed.data, { roots });\r\n    expect(result.package.frontmatter.name).toBe(\"linked-skill\");\r\n    expect(result.package.frontmatter.description).toBe(\"Symlinked for reading\");\r\n    expect(result.package.scope).toBe(\"project\");\r\n  });\r\n\r\n  test(\"discovers skill directory via relative symlink\", async () => {\r\n    // Mirrors a real-world layout:\r\n    //   <project>/.agents/skills/kalshi-docs/SKILL.md   (real skill)\r\n    //   <project>/.mux/skills/kalshi-docs -> ../../.agents/skills/kalshi-docs  (relative symlink)\r\n    using project = new DisposableTempDir(\"agent-skills-relative-symlink\");\r\n\r\n    const projectRoot = project.path;\r\n    const externalSkillsDir = path.join(projectRoot, \".agents\", \"skills\");\r\n    const muxSkillsRoot = path.join(projectRoot, \".mux\", \"skills\");\r\n    await fs.mkdir(externalSkillsDir, { recursive: true });\r\n    await fs.mkdir(muxSkillsRoot, { recursive: true });\r\n\r\n    // Write the real skill outside .mux/skills/\r\n    await writeSkill(externalSkillsDir, \"kalshi-docs\", \"Kalshi API documentation\");\r\n\r\n    // Create a relative symlink (../../.agents/skills/kalshi-docs)\r\n    await fs.symlink(\r\n      path.join(\"..\", \"..\", \".agents\", \"skills\", \"kalshi-docs\"),\r\n      path.join(muxSkillsRoot, \"kalshi-docs\")\r\n    );\r\n\r\n    const roots = { projectRoot: muxSkillsRoot, globalRoot: \"/nonexistent\" };\r\n    const runtime = new LocalRuntime(projectRoot);\r\n\r\n    // Discovery should find the symlinked skill\r\n    const skills = await discoverAgentSkills(runtime, projectRoot, { roots });\r\n    const found = skills.find((s) => s.name === \"kalshi-docs\");\r\n    expect(found).toBeDefined();\r\n    expect(found!.description).toBe(\"Kalshi API documentation\");\r\n    expect(found!.scope).toBe(\"project\");\r\n\r\n    // readAgentSkill should also resolve through the relative symlink\r\n    const parsed = SkillNameSchema.safeParse(\"kalshi-docs\");\r\n    expect(parsed.success).toBe(true);\r\n    if (!parsed.success) throw new Error(\"bad name\");\r\n\r\n    const result = await readAgentSkill(runtime, projectRoot, parsed.data, { roots });\r\n    expect(result.package.frontmatter.name).toBe(\"kalshi-docs\");\r\n    expect(result.package.frontmatter.description).toBe(\"Kalshi API documentation\");\r\n  });\r\n\r\n  test(\"discovers symlinked SKILL.md inside a real directory\", async () => {\r\n    using project = new DisposableTempDir(\"agent-skills-symlink-file\");\r\n    using skillSource = new DisposableTempDir(\"agent-skills-source-file\");\r\n\r\n    const projectSkillsRoot = path.join(project.path, \".mux\", \"skills\");\r\n    const skillDir = path.join(projectSkillsRoot, \"file-linked\");\r\n    await fs.mkdir(skillDir, { recursive: true });\r\n\r\n    // Write SKILL.md to the source location and symlink just the file\r\n    const sourceSkillMd = path.join(skillSource.path, \"SKILL.md\");\r\n    await fs.writeFile(\r\n      sourceSkillMd,\r\n      `---\\nname: file-linked\\ndescription: Symlinked SKILL.md\\n---\\nBody\\n`,\r\n      \"utf-8\"\r\n    );\r\n    await fs.symlink(sourceSkillMd, path.join(skillDir, \"SKILL.md\"));\r\n\r\n    const roots = { projectRoot: projectSkillsRoot, globalRoot: \"/nonexistent\" };\r\n    const runtime = new LocalRuntime(project.path);\r\n\r\n    const skills = await discoverAgentSkills(runtime, project.path, { roots });\r\n    const found = skills.find((s) => s.name === \"file-linked\");\r\n    expect(found).toBeDefined();\r\n    expect(found!.description).toBe(\"Symlinked SKILL.md\");\r\n  });\r\n});\r\n"]}