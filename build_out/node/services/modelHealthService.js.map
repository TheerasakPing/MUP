{"version":3,"file":"modelHealthService.js","sourceRoot":"","sources":["../../../src/node/services/modelHealthService.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Model Health Check Service\r\n *\r\n * Validates model configurations by running a series of checks:\r\n * 1. Authentication  - Verify provider credentials are configured\r\n * 2. Model Exists    - Check if model ID is recognized (built-in) or custom\r\n * 3. Token Limits    - Validate configured limits are reasonable\r\n * 4. Pricing         - Sanity-check custom pricing values\r\n * 5. Connectivity    - Basic reachability check (provider base URL validation)\r\n */\r\n\r\nimport type { Config } from \"@/node/config\";\r\nimport { KNOWN_MODELS } from \"@/common/constants/knownModels\";\r\nimport { SUPPORTED_PROVIDERS, type ProviderName } from \"@/common/constants/providers\";\r\nimport {\r\n    resolveProviderCredentials,\r\n    type ProviderConfigRaw,\r\n} from \"@/node/utils/providerRequirements\";\r\nimport type { CustomModelMetadata } from \"@/common/orpc/schemas/api\";\r\nimport * as fs from \"fs\";\r\nimport * as path from \"path\";\r\n\r\n// ────────────────────────────────────────────────────────────────\r\n// Types\r\n// ────────────────────────────────────────────────────────────────\r\n\r\nexport type CheckStatus = \"pass\" | \"warn\" | \"fail\" | \"skip\";\r\nexport type OverallStatus = \"healthy\" | \"warning\" | \"error\";\r\n\r\nexport interface CheckResult {\r\n    status: CheckStatus;\r\n    message: string;\r\n    details?: string;\r\n}\r\n\r\nexport interface HealthCheckResult {\r\n    modelId: string;\r\n    provider: string;\r\n    timestamp: number;\r\n    status: OverallStatus;\r\n    checks: {\r\n        authentication: CheckResult;\r\n        modelExists: CheckResult;\r\n        tokenLimits: CheckResult;\r\n        pricing: CheckResult;\r\n        connectivity: CheckResult;\r\n    };\r\n}\r\n\r\n// ────────────────────────────────────────────────────────────────\r\n// Service\r\n// ────────────────────────────────────────────────────────────────\r\n\r\nexport class ModelHealthService {\r\n    private cache = new Map<string, HealthCheckResult>();\r\n\r\n    constructor(private readonly config: Config) { }\r\n\r\n    async checkModel(\r\n        provider: string,\r\n        modelId: string,\r\n        customMetadata?: CustomModelMetadata,\r\n    ): Promise<HealthCheckResult> {\r\n        const authentication = this.checkAuthentication(provider);\r\n        const modelExists = this.checkModelExists(provider, modelId);\r\n        const tokenLimits = this.checkTokenLimits(customMetadata);\r\n        const pricing = this.checkPricing(customMetadata);\r\n        const connectivity = this.checkConnectivity(provider);\r\n\r\n        const checks = { authentication, modelExists, tokenLimits, pricing, connectivity };\r\n\r\n        const statuses = Object.values(checks).map((c) => c.status);\r\n        let status: OverallStatus = \"healthy\";\r\n        if (statuses.some((s) => s === \"fail\")) status = \"error\";\r\n        else if (statuses.some((s) => s === \"warn\")) status = \"warning\";\r\n\r\n        const result: HealthCheckResult = {\r\n            modelId,\r\n            provider,\r\n            timestamp: Date.now(),\r\n            status,\r\n            checks,\r\n        };\r\n\r\n        this.cache.set(`${provider}:${modelId}`, result);\r\n        return result;\r\n    }\r\n\r\n    async checkAllModels(\r\n        models: Array<{ provider: string; modelId: string; metadata?: CustomModelMetadata }>,\r\n    ): Promise<HealthCheckResult[]> {\r\n        const results: HealthCheckResult[] = [];\r\n        for (const m of models) {\r\n            results.push(await this.checkModel(m.provider, m.modelId, m.metadata));\r\n        }\r\n        return results;\r\n    }\r\n\r\n    getLastResults(): HealthCheckResult[] {\r\n        return Array.from(this.cache.values());\r\n    }\r\n\r\n    // ────────────── Individual checks ──────────────\r\n\r\n    private checkAuthentication(provider: string): CheckResult {\r\n        try {\r\n            const rawConfig = this.loadProviderConfig(provider);\r\n            if (!rawConfig) {\r\n                return {\r\n                    status: \"warn\",\r\n                    message: \"No provider config found\",\r\n                    details: \"Provider section missing from providers.jsonc\",\r\n                };\r\n            }\r\n\r\n            if (!SUPPORTED_PROVIDERS.includes(provider as ProviderName)) {\r\n                const hasKey = typeof rawConfig.apiKey === \"string\" && rawConfig.apiKey.length > 0;\r\n                return hasKey\r\n                    ? { status: \"pass\", message: \"API key present (custom provider)\" }\r\n                    : { status: \"warn\", message: \"No API key found for custom provider\" };\r\n            }\r\n\r\n            const creds = resolveProviderCredentials(provider as ProviderName, rawConfig);\r\n            if (creds.isConfigured) {\r\n                return { status: \"pass\", message: \"Credentials configured\" };\r\n            }\r\n            return {\r\n                status: \"fail\",\r\n                message: `Missing ${creds.missingRequirement ?? \"credentials\"}`,\r\n                details: `Provider \"${provider}\" requires ${creds.missingRequirement ?? \"credentials\"} to be set`,\r\n            };\r\n        } catch {\r\n            return { status: \"fail\", message: \"Error checking authentication\" };\r\n        }\r\n    }\r\n\r\n    private checkModelExists(provider: string, modelId: string): CheckResult {\r\n        const fullId = `${provider}:${modelId}`;\r\n        const known = KNOWN_MODELS[fullId];\r\n        if (known) {\r\n            return { status: \"pass\", message: \"Built-in model recognized\" };\r\n        }\r\n\r\n        const knownByAlias = Object.values(KNOWN_MODELS).find(\r\n            (m) => m.provider === provider && m.aliases?.includes(modelId),\r\n        );\r\n        if (knownByAlias) {\r\n            return { status: \"pass\", message: `Known model (alias of ${knownByAlias.id})` };\r\n        }\r\n\r\n        return {\r\n            status: \"warn\",\r\n            message: \"Custom model — not in built-in registry\",\r\n            details:\r\n                \"Model may still work if the provider supports it. Verify by sending a test request.\",\r\n        };\r\n    }\r\n\r\n    private checkTokenLimits(customMetadata?: CustomModelMetadata): CheckResult {\r\n        if (!customMetadata?.maxInputTokens && !customMetadata?.maxOutputTokens) {\r\n            return { status: \"skip\", message: \"No custom token limits configured\" };\r\n        }\r\n\r\n        const warnings: string[] = [];\r\n\r\n        if (customMetadata.maxInputTokens && customMetadata.maxInputTokens < 1000) {\r\n            warnings.push(`Input token limit (${customMetadata.maxInputTokens}) seems very low`);\r\n        }\r\n        if (customMetadata.maxOutputTokens && customMetadata.maxOutputTokens < 100) {\r\n            warnings.push(`Output token limit (${customMetadata.maxOutputTokens}) seems very low`);\r\n        }\r\n        if (\r\n            customMetadata.maxInputTokens &&\r\n            customMetadata.maxOutputTokens &&\r\n            customMetadata.maxOutputTokens > customMetadata.maxInputTokens\r\n        ) {\r\n            warnings.push(\"Output limit exceeds input limit — this is unusual\");\r\n        }\r\n\r\n        if (warnings.length > 0) {\r\n            return {\r\n                status: \"warn\",\r\n                message: \"Token limit configuration may need review\",\r\n                details: warnings.join(\"; \"),\r\n            };\r\n        }\r\n        return { status: \"pass\", message: \"Token limits look reasonable\" };\r\n    }\r\n\r\n    private checkPricing(customMetadata?: CustomModelMetadata): CheckResult {\r\n        if (!customMetadata?.inputCostPerToken && !customMetadata?.outputCostPerToken) {\r\n            return { status: \"skip\", message: \"No custom pricing configured\" };\r\n        }\r\n\r\n        const warnings: string[] = [];\r\n\r\n        if (customMetadata.inputCostPerToken && customMetadata.inputCostPerToken < 0) {\r\n            warnings.push(\"Input cost per token is negative\");\r\n        }\r\n        if (customMetadata.outputCostPerToken && customMetadata.outputCostPerToken < 0) {\r\n            warnings.push(\"Output cost per token is negative\");\r\n        }\r\n        if (\r\n            customMetadata.inputCostPerToken &&\r\n            customMetadata.outputCostPerToken &&\r\n            customMetadata.inputCostPerToken > customMetadata.outputCostPerToken\r\n        ) {\r\n            warnings.push(\r\n                \"Input cost is higher than output cost — this is unusual for most providers\",\r\n            );\r\n        }\r\n\r\n        if (warnings.length > 0) {\r\n            return {\r\n                status: \"warn\",\r\n                message: \"Pricing configuration may need review\",\r\n                details: warnings.join(\"; \"),\r\n            };\r\n        }\r\n        return { status: \"pass\", message: \"Pricing looks reasonable\" };\r\n    }\r\n\r\n    private checkConnectivity(provider: string): CheckResult {\r\n        try {\r\n            const rawConfig = this.loadProviderConfig(provider);\r\n            if (!rawConfig) {\r\n                return { status: \"skip\", message: \"No provider config — skipping connectivity\" };\r\n            }\r\n\r\n            if (rawConfig.baseUrl || rawConfig.baseURL) {\r\n                const url = rawConfig.baseUrl ?? rawConfig.baseURL ?? \"\";\r\n                try {\r\n                    new URL(url);\r\n                    return { status: \"pass\", message: `Custom base URL configured: ${url}` };\r\n                } catch {\r\n                    return {\r\n                        status: \"fail\",\r\n                        message: \"Invalid base URL\",\r\n                        details: `\"${url}\" is not a valid URL`,\r\n                    };\r\n                }\r\n            }\r\n\r\n            return { status: \"pass\", message: \"Using default provider endpoint\" };\r\n        } catch {\r\n            return { status: \"warn\", message: \"Unable to check connectivity\" };\r\n        }\r\n    }\r\n\r\n    // ────────────── Helpers ──────────────\r\n\r\n    private loadProviderConfig(provider: string): ProviderConfigRaw | null {\r\n        try {\r\n            const providersFile = path.join(this.config.rootDir, \"providers.jsonc\");\r\n            if (!fs.existsSync(providersFile)) return null;\r\n\r\n            const raw = fs.readFileSync(providersFile, \"utf-8\");\r\n            const stripped = raw.replace(/\\/\\/.*$/gm, \"\").replace(/\\/\\*[\\s\\S]*?\\*\\//g, \"\");\r\n            const parsed = JSON.parse(stripped) as Record<string, unknown>;\r\n            const providerConfig = parsed[provider];\r\n            if (!providerConfig || typeof providerConfig !== \"object\") return null;\r\n\r\n            return providerConfig as ProviderConfigRaw;\r\n        } catch {\r\n            return null;\r\n        }\r\n    }\r\n}\r\n"]}