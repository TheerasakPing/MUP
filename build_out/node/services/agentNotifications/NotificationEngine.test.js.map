{"version":3,"file":"NotificationEngine.test.js","sourceRoot":"","sources":["../../../../src/node/services/agentNotifications/NotificationEngine.test.ts"],"names":[],"mappings":";;AAAA,uCAAkD;AAElD,6DAA0D;AAE1D,IAAA,mBAAQ,EAAC,oBAAoB,EAAE,GAAG,EAAE,CAAC;IACnC,IAAA,eAAI,EAAC,iCAAiC,EAAE,KAAK,IAAI,EAAE,CAAC;QAClD,MAAM,MAAM,GAAG,IAAI,uCAAkB,CAAC;YACpC;gBACE,4DAA4D;gBAC5D,IAAI,EAAE,KAAK,IAAI,EAAE,CAAC,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,iCAAiC,EAAE,CAAC;aACjF;SACF,CAAC,CAAC;QAEH,MAAM,KAAK,GAAG,MAAM,MAAM,CAAC,iBAAiB,CAAC,EAAE,QAAQ,EAAE,MAAM,EAAE,aAAa,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC;QAChG,IAAA,iBAAM,EAAC,KAAK,CAAC,CAAC,OAAO,CAAC,CAAC,iCAAiC,CAAC,CAAC,CAAC;QAE3D,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,iBAAiB,CAAC;YAC5C,QAAQ,EAAE,MAAM;YAChB,aAAa,EAAE,IAAI;YACnB,GAAG,EAAE,CAAC;SACP,CAAC,CAAC;QACH,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;IAAA,CAC5B,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,2BAA2B,EAAE,KAAK,IAAI,EAAE,CAAC;QAC5C,MAAM,MAAM,GAAG,IAAI,uCAAkB,CAAC;YACpC;gBACE,4DAA4D;gBAC5D,IAAI,EAAE,KAAK,IAAI,EAAE,CAAC,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,gCAAgC,EAAE,CAAC;aAChF;YACD;gBACE,4DAA4D;gBAC5D,IAAI,EAAE,KAAK,IAAI,EAAE,CAAC,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,gCAAgC,EAAE,CAAC;aAChF;SACF,CAAC,CAAC;QAEH,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,iBAAiB,CAAC;YAC5C,QAAQ,EAAE,MAAM;YAChB,aAAa,EAAE,IAAI;YACnB,GAAG,EAAE,CAAC;SACP,CAAC,CAAC;QACH,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,OAAO,CAAC,CAAC,gCAAgC,EAAE,gCAAgC,CAAC,CAAC,CAAC;IAAA,CAC9F,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { describe, expect, test } from \"bun:test\";\r\n\r\nimport { NotificationEngine } from \"./NotificationEngine\";\r\n\r\ndescribe(\"NotificationEngine\", () => {\r\n  test(\"dedupes by notification content\", async () => {\r\n    const engine = new NotificationEngine([\r\n      {\r\n        // eslint-disable-next-line @typescript-eslint/require-await\r\n        poll: async () => [{ source: \"s1\", content: \"<notification>hi</notification>\" }],\r\n      },\r\n    ]);\r\n\r\n    const first = await engine.pollAfterToolCall({ toolName: \"bash\", toolSucceeded: true, now: 0 });\r\n    expect(first).toEqual([\"<notification>hi</notification>\"]);\r\n\r\n    const second = await engine.pollAfterToolCall({\r\n      toolName: \"bash\",\r\n      toolSucceeded: true,\r\n      now: 1,\r\n    });\r\n    expect(second).toEqual([]);\r\n  });\r\n\r\n  test(\"aggregates across sources\", async () => {\r\n    const engine = new NotificationEngine([\r\n      {\r\n        // eslint-disable-next-line @typescript-eslint/require-await\r\n        poll: async () => [{ source: \"s1\", content: \"<notification>a</notification>\" }],\r\n      },\r\n      {\r\n        // eslint-disable-next-line @typescript-eslint/require-await\r\n        poll: async () => [{ source: \"s2\", content: \"<notification>b</notification>\" }],\r\n      },\r\n    ]);\r\n\r\n    const result = await engine.pollAfterToolCall({\r\n      toolName: \"bash\",\r\n      toolSucceeded: true,\r\n      now: 0,\r\n    });\r\n    expect(result).toEqual([\"<notification>a</notification>\", \"<notification>b</notification>\"]);\r\n  });\r\n});\r\n"]}