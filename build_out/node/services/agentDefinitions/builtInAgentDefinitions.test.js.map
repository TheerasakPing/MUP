{"version":3,"file":"builtInAgentDefinitions.test.js","sourceRoot":"","sources":["../../../../src/node/services/agentDefinitions/builtInAgentDefinitions.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { beforeEach, describe, expect, test } from \"bun:test\";\r\n\r\nimport { clearBuiltInAgentCache, getBuiltInAgentDefinitions } from \"./builtInAgentDefinitions\";\r\n\r\ndescribe(\"built-in agent definitions\", () => {\r\n  beforeEach(() => {\r\n    clearBuiltInAgentCache();\r\n  });\r\n\r\n  test(\"exec and orchestrator trust Explore sub-agent reports\", () => {\r\n    const pkgs = getBuiltInAgentDefinitions();\r\n    const byId = new Map(pkgs.map((pkg) => [pkg.id, pkg] as const));\r\n\r\n    const exec = byId.get(\"exec\");\r\n    expect(exec).toBeTruthy();\r\n    expect(exec?.body).toContain(\"sub-agent reports as authoritative for repo facts\");\r\n    expect(exec?.body).toContain(\"counts as having read the referenced files\");\r\n\r\n    const orchestrator = byId.get(\"orchestrator\");\r\n    expect(orchestrator).toBeTruthy();\r\n    expect(orchestrator?.body).toContain(\"sub-agent reports as authoritative for repo facts\");\r\n    expect(orchestrator?.body).toContain(\"counts as having read the referenced files\");\r\n  });\r\n\r\n  test(\"orchestrator includes an exec task brief template\", () => {\r\n    const pkgs = getBuiltInAgentDefinitions();\r\n    const byId = new Map(pkgs.map((pkg) => [pkg.id, pkg] as const));\r\n\r\n    const orchestrator = byId.get(\"orchestrator\");\r\n    expect(orchestrator).toBeTruthy();\r\n    expect(orchestrator?.body).toContain(\"Exec task brief template\");\r\n    expect(orchestrator?.body).toContain(\"Background (why this matters)\");\r\n    expect(orchestrator?.body).toContain(\"Starting points\");\r\n  });\r\n\r\n  test(\"exec subagent append_prompt warns about missing task brief context\", () => {\r\n    const pkgs = getBuiltInAgentDefinitions();\r\n    const byId = new Map(pkgs.map((pkg) => [pkg.id, pkg] as const));\r\n\r\n    const exec = byId.get(\"exec\");\r\n    expect(exec).toBeTruthy();\r\n\r\n    const appendPrompt = exec?.frontmatter.subagent?.append_prompt;\r\n    expect(appendPrompt).toBeTruthy();\r\n    expect(appendPrompt).toContain(\"task brief is missing critical information\");\r\n  });\r\n\r\n  test(\"includes orchestrator with expected flags\", () => {\r\n    const pkgs = getBuiltInAgentDefinitions();\r\n    const byId = new Map(pkgs.map((pkg) => [pkg.id, pkg] as const));\r\n\r\n    const orchestrator = byId.get(\"orchestrator\");\r\n    expect(orchestrator).toBeTruthy();\r\n    expect(orchestrator?.frontmatter.ui?.requires).toEqual([\"plan\"]);\r\n    expect(orchestrator?.frontmatter.ui?.hidden).toBeUndefined();\r\n    expect(orchestrator?.frontmatter.subagent?.runnable).toBe(false);\r\n  });\r\n\r\n  test(\"task_apply_git_patch is restricted to exec/orchestrator\", () => {\r\n    const pkgs = getBuiltInAgentDefinitions();\r\n    const byId = new Map(pkgs.map((pkg) => [pkg.id, pkg] as const));\r\n\r\n    const exec = byId.get(\"exec\");\r\n    expect(exec).toBeTruthy();\r\n    expect(exec?.frontmatter.tools?.remove ?? []).not.toContain(\"task_apply_git_patch\");\r\n\r\n    const orchestrator = byId.get(\"orchestrator\");\r\n    expect(orchestrator).toBeTruthy();\r\n    expect(orchestrator?.frontmatter.tools?.remove ?? []).not.toContain(\"task_apply_git_patch\");\r\n\r\n    const plan = byId.get(\"plan\");\r\n    expect(plan).toBeTruthy();\r\n    expect(plan?.frontmatter.tools?.remove ?? []).toContain(\"task_apply_git_patch\");\r\n\r\n    const explore = byId.get(\"explore\");\r\n    expect(explore).toBeTruthy();\r\n    expect(explore?.frontmatter.tools?.remove ?? []).toContain(\"task_apply_git_patch\");\r\n  });\r\n});\r\n"]}