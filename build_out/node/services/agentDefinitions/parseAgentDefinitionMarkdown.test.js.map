{"version":3,"file":"parseAgentDefinitionMarkdown.test.js","sourceRoot":"","sources":["../../../../src/node/services/agentDefinitions/parseAgentDefinitionMarkdown.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, test } from \"bun:test\";\n\nimport {\n  AgentDefinitionParseError,\n  parseAgentDefinitionMarkdown,\n} from \"./parseAgentDefinitionMarkdown\";\n\ndescribe(\"parseAgentDefinitionMarkdown\", () => {\n  test(\"parses valid YAML frontmatter and body (ignores unknown keys)\", () => {\n    const content = `---\nname: My Agent\ndescription: Does stuff\nbase: exec\ntools:\n  add: [\"file_read\", \"bash.*\"]\nunknownTopLevel: 123\nui:\n  hidden: false\n  color: \"#ff00ff\"\n  unknownNested: 456\n---\n# Instructions\nDo the thing.\n`;\n\n    const result = parseAgentDefinitionMarkdown({\n      content,\n      byteSize: Buffer.byteLength(content, \"utf-8\"),\n    });\n\n    expect(result.frontmatter.name).toBe(\"My Agent\");\n    expect(result.frontmatter.description).toBe(\"Does stuff\");\n    expect(result.frontmatter.base).toBe(\"exec\");\n    expect(result.frontmatter.tools).toEqual({ add: [\"file_read\", \"bash.*\"] });\n    expect(result.frontmatter.ui?.hidden).toBe(false);\n    expect(result.frontmatter.ui?.color).toBe(\"#ff00ff\");\n\n    const frontmatterUnknown = result.frontmatter as unknown as Record<string, unknown>;\n    expect(frontmatterUnknown.unknownTopLevel).toBeUndefined();\n\n    if (!result.frontmatter.ui) {\n      throw new Error(\"Expected ui to be present\");\n    }\n    const uiUnknown = result.frontmatter.ui as unknown as Record<string, unknown>;\n    expect(uiUnknown.unknownNested).toBeUndefined();\n\n    expect(result.body).toContain(\"# Instructions\");\n  });\n\n  test(\"accepts legacy ui.selectable\", () => {\n    const content = `---\nname: Legacy UI\nui:\n  selectable: false\n---\nBody\n`;\n\n    const result = parseAgentDefinitionMarkdown({\n      content,\n      byteSize: Buffer.byteLength(content, \"utf-8\"),\n    });\n\n    expect(result.frontmatter.ui?.selectable).toBe(false);\n  });\n\n  test(\"parses ui.requires\", () => {\n    const content = `---\nname: Requires Plan\nui:\n  requires:\n    - plan\n---\nBody\n`;\n\n    const result = parseAgentDefinitionMarkdown({\n      content,\n      byteSize: Buffer.byteLength(content, \"utf-8\"),\n    });\n\n    expect(result.frontmatter.ui?.requires).toEqual([\"plan\"]);\n  });\n\n  test(\"parses subagent.skip_init_hook\", () => {\n    const content = `---\nname: Skip Init\nsubagent:\n  runnable: true\n  skip_init_hook: true\n---\nBody\n`;\n\n    const result = parseAgentDefinitionMarkdown({\n      content,\n      byteSize: Buffer.byteLength(content, \"utf-8\"),\n    });\n\n    expect(result.frontmatter.subagent?.skip_init_hook).toBe(true);\n  });\n\n  test(\"throws on missing frontmatter\", () => {\n    expect(() =>\n      parseAgentDefinitionMarkdown({\n        content: \"# No frontmatter\\n\",\n        byteSize: 14,\n      })\n    ).toThrow(AgentDefinitionParseError);\n  });\n\n  test(\"parses tools as add/remove patterns\", () => {\n    const content = `---\nname: Regex Tools\ntools:\n  add:\n    - file_read\n    - \"bash.*\"\n    - \"task_.*\"\n  remove:\n    - task\n---\nBody\n`;\n\n    const result = parseAgentDefinitionMarkdown({\n      content,\n      byteSize: Buffer.byteLength(content, \"utf-8\"),\n    });\n\n    expect(result.frontmatter.tools).toEqual({\n      add: [\"file_read\", \"bash.*\", \"task_.*\"],\n      remove: [\"task\"],\n    });\n  });\n});\n"]}