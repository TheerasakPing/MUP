{"version":3,"file":"agentEnablement.js","sourceRoot":"","sources":["../../../../src/node/services/agentDefinitions/agentEnablement.ts"],"names":[],"mappings":";;;;;;;;AAAA,mEAA2C;AAK3C,MAAM,wBAAwB,GAAG,IAAI,GAAG,CAAU,CAAC,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,KAAK,CAAC,CAAC,CAAC;AAEtF,sCAA6C,WAAuC,EAAW;IAC7F,IAAA,gBAAM,EAAC,WAAW,EAAE,uDAAuD,CAAC,CAAC;IAE7E,yCAAyC;IACzC,iEAAiE;IACjE,IAAI,OAAO,WAAW,CAAC,QAAQ,KAAK,SAAS,EAAE,CAAC;QAC9C,OAAO,WAAW,CAAC,QAAQ,CAAC;IAC9B,CAAC;IAED,IAAI,OAAO,WAAW,CAAC,EAAE,EAAE,QAAQ,KAAK,SAAS,EAAE,CAAC;QAClD,OAAO,WAAW,CAAC,EAAE,CAAC,QAAQ,CAAC;IACjC,CAAC;IAED,OAAO,KAAK,CAAC;AAAA,CACd;AAED,qCACE,GAAmB,EACnB,OAAgB,EACK;IACrB,IAAA,gBAAM,EAAC,GAAG,EAAE,8CAA8C,CAAC,CAAC;IAC5D,IAAA,gBAAM,EAAC,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE,wDAAwD,CAAC,CAAC;IAErF,MAAM,KAAK,GAAG,GAAG,CAAC,eAAe,EAAE,CAAC,OAAO,CAAC,CAAC;IAC7C,OAAO,OAAO,KAAK,EAAE,OAAO,KAAK,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC;AAAA,CACxE;AAED,oCAA2C,IAI1C,EAAW;IACV,IAAA,gBAAM,EAAC,IAAI,EAAE,8CAA8C,CAAC,CAAC;IAC7D,IAAA,gBAAM,EAAC,IAAI,CAAC,GAAG,EAAE,6CAA6C,CAAC,CAAC;IAChE,IAAA,gBAAM,EAAC,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE,uDAAuD,CAAC,CAAC;IACzF,IAAA,gBAAM,EAAC,IAAI,CAAC,mBAAmB,EAAE,6DAA6D,CAAC,CAAC;IAEhG,wEAAwE;IACxE,IAAI,wBAAwB,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;QAC/C,OAAO,KAAK,CAAC;IACf,CAAC;IAED,MAAM,QAAQ,GAAG,2BAA2B,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;IACrE,IAAI,QAAQ,KAAK,IAAI,EAAE,CAAC;QACtB,OAAO,KAAK,CAAC;IACf,CAAC;IACD,IAAI,QAAQ,KAAK,KAAK,EAAE,CAAC;QACvB,OAAO,IAAI,CAAC;IACd,CAAC;IAED,OAAO,4BAA4B,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;AAAA,CAC/D","sourcesContent":["import assert from \"@/common/utils/assert\";\r\n\r\nimport type { AgentDefinitionFrontmatter, AgentId } from \"@/common/types/agentDefinition\";\r\nimport type { ProjectsConfig } from \"@/common/types/project\";\r\n\r\nconst ALWAYS_ENABLED_AGENT_IDS = new Set<AgentId>([\"exec\", \"plan\", \"compact\", \"mux\"]);\r\n\r\nexport function isAgentDisabledByFrontmatter(frontmatter: AgentDefinitionFrontmatter): boolean {\r\n  assert(frontmatter, \"isAgentDisabledByFrontmatter: frontmatter is required\");\r\n\r\n  // `disabled` is the new top-level field.\r\n  // When both are set, disabled takes precedence over ui.disabled.\r\n  if (typeof frontmatter.disabled === \"boolean\") {\r\n    return frontmatter.disabled;\r\n  }\r\n\r\n  if (typeof frontmatter.ui?.disabled === \"boolean\") {\r\n    return frontmatter.ui.disabled;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport function resolveAgentEnabledOverride(\r\n  cfg: ProjectsConfig,\r\n  agentId: AgentId\r\n): boolean | undefined {\r\n  assert(cfg, \"resolveAgentEnabledOverride: cfg is required\");\r\n  assert(agentId.length > 0, \"resolveAgentEnabledOverride: agentId must be non-empty\");\r\n\r\n  const entry = cfg.agentAiDefaults?.[agentId];\r\n  return typeof entry?.enabled === \"boolean\" ? entry.enabled : undefined;\r\n}\r\n\r\nexport function isAgentEffectivelyDisabled(args: {\r\n  cfg: ProjectsConfig;\r\n  agentId: AgentId;\r\n  resolvedFrontmatter: AgentDefinitionFrontmatter;\r\n}): boolean {\r\n  assert(args, \"isAgentEffectivelyDisabled: args is required\");\r\n  assert(args.cfg, \"isAgentEffectivelyDisabled: cfg is required\");\r\n  assert(args.agentId.length > 0, \"isAgentEffectivelyDisabled: agentId must be non-empty\");\r\n  assert(args.resolvedFrontmatter, \"isAgentEffectivelyDisabled: resolvedFrontmatter is required\");\r\n\r\n  // Core agents must always remain available so mux can safely fall back.\r\n  if (ALWAYS_ENABLED_AGENT_IDS.has(args.agentId)) {\r\n    return false;\r\n  }\r\n\r\n  const override = resolveAgentEnabledOverride(args.cfg, args.agentId);\r\n  if (override === true) {\r\n    return false;\r\n  }\r\n  if (override === false) {\r\n    return true;\r\n  }\r\n\r\n  return isAgentDisabledByFrontmatter(args.resolvedFrontmatter);\r\n}\r\n"]}