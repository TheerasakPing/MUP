{"version":3,"file":"agentEnablement.test.js","sourceRoot":"","sources":["../../../../src/node/services/agentDefinitions/agentEnablement.test.ts"],"names":[],"mappings":";;AAAA,uCAAkD;AAKlD,uDAI2B;AAE3B,SAAS,gBAAgB,CAAC,SAAgD,EAAkB;IAC1F,OAAO;QACL,QAAQ,EAAE,IAAI,GAAG,EAAE;QACnB,eAAe,EAAE,SAAS;KAC3B,CAAC;AAAA,CACH;AAED,IAAA,mBAAQ,EAAC,iBAAiB,EAAE,GAAG,EAAE,CAAC;IAChC,IAAA,eAAI,EAAC,kDAAkD,EAAE,GAAG,EAAE,CAAC;QAC7D,MAAM,WAAW,GAA+B;YAC9C,IAAI,EAAE,MAAM;YACZ,QAAQ,EAAE,KAAK;YACf,EAAE,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE;SACvB,CAAC;QAEF,IAAA,iBAAM,EAAC,IAAA,8CAA4B,EAAC,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CAC/D,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,kDAAkD,EAAE,GAAG,EAAE,CAAC;QAC7D,MAAM,WAAW,GAA+B;YAC9C,IAAI,EAAE,MAAM;YACZ,EAAE,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE;SACvB,CAAC;QAEF,IAAA,iBAAM,EAAC,IAAA,8CAA4B,EAAC,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAAA,CAC9D,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,wDAAwD,EAAE,GAAG,EAAE,CAAC;QACnE,MAAM,GAAG,GAAG,gBAAgB,CAAC,EAAE,GAAG,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC;QACzD,MAAM,WAAW,GAA+B,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;QAEhF,IAAA,iBAAM,EAAC,IAAA,6CAA2B,EAAC,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3D,IAAA,iBAAM,EACJ,IAAA,4CAA0B,EAAC;YACzB,GAAG;YACH,OAAO,EAAE,KAAK;YACd,mBAAmB,EAAE,WAAW;SACjC,CAAC,CACH,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CACf,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,uDAAuD,EAAE,GAAG,EAAE,CAAC;QAClE,MAAM,GAAG,GAAG,gBAAgB,CAAC,EAAE,GAAG,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC;QAC1D,MAAM,WAAW,GAA+B,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC;QAEhE,IAAA,iBAAM,EAAC,IAAA,6CAA2B,EAAC,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC5D,IAAA,iBAAM,EACJ,IAAA,4CAA0B,EAAC;YACzB,GAAG;YACH,OAAO,EAAE,KAAK;YACd,mBAAmB,EAAE,WAAW;SACjC,CAAC,CACH,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAAA,CACd,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,4CAA4C,EAAE,GAAG,EAAE,CAAC;QACvD,MAAM,GAAG,GAAG,gBAAgB,CAAC,EAAE,IAAI,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC;QAC3D,MAAM,WAAW,GAA+B,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;QAEjF,IAAA,iBAAM,EACJ,IAAA,4CAA0B,EAAC;YACzB,GAAG;YACH,OAAO,EAAE,MAAM;YACf,mBAAmB,EAAE,WAAW;SACjC,CAAC,CACH,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CACf,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { describe, expect, test } from \"bun:test\";\n\nimport type { AgentDefinitionFrontmatter } from \"@/common/types/agentDefinition\";\nimport type { ProjectsConfig } from \"@/common/types/project\";\n\nimport {\n  isAgentDisabledByFrontmatter,\n  isAgentEffectivelyDisabled,\n  resolveAgentEnabledOverride,\n} from \"./agentEnablement\";\n\nfunction cfgWithOverrides(overrides: Record<string, { enabled?: boolean }>): ProjectsConfig {\n  return {\n    projects: new Map(),\n    agentAiDefaults: overrides,\n  };\n}\n\ndescribe(\"agentEnablement\", () => {\n  test(\"disabled field takes precedence over ui.disabled\", () => {\n    const frontmatter: AgentDefinitionFrontmatter = {\n      name: \"Test\",\n      disabled: false,\n      ui: { disabled: true },\n    };\n\n    expect(isAgentDisabledByFrontmatter(frontmatter)).toBe(false);\n  });\n\n  test(\"falls back to ui.disabled when disabled is unset\", () => {\n    const frontmatter: AgentDefinitionFrontmatter = {\n      name: \"Test\",\n      ui: { disabled: true },\n    };\n\n    expect(isAgentDisabledByFrontmatter(frontmatter)).toBe(true);\n  });\n\n  test(\"user override enabled:true re-enables a disabled agent\", () => {\n    const cfg = cfgWithOverrides({ foo: { enabled: true } });\n    const frontmatter: AgentDefinitionFrontmatter = { name: \"Foo\", disabled: true };\n\n    expect(resolveAgentEnabledOverride(cfg, \"foo\")).toBe(true);\n    expect(\n      isAgentEffectivelyDisabled({\n        cfg,\n        agentId: \"foo\",\n        resolvedFrontmatter: frontmatter,\n      })\n    ).toBe(false);\n  });\n\n  test(\"user override enabled:false disables an enabled agent\", () => {\n    const cfg = cfgWithOverrides({ foo: { enabled: false } });\n    const frontmatter: AgentDefinitionFrontmatter = { name: \"Foo\" };\n\n    expect(resolveAgentEnabledOverride(cfg, \"foo\")).toBe(false);\n    expect(\n      isAgentEffectivelyDisabled({\n        cfg,\n        agentId: \"foo\",\n        resolvedFrontmatter: frontmatter,\n      })\n    ).toBe(true);\n  });\n\n  test(\"core agents are never effectively disabled\", () => {\n    const cfg = cfgWithOverrides({ exec: { enabled: false } });\n    const frontmatter: AgentDefinitionFrontmatter = { name: \"Exec\", disabled: true };\n\n    expect(\n      isAgentEffectivelyDisabled({\n        cfg,\n        agentId: \"exec\",\n        resolvedFrontmatter: frontmatter,\n      })\n    ).toBe(false);\n  });\n});\n"]}