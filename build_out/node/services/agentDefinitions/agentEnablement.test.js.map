{"version":3,"file":"agentEnablement.test.js","sourceRoot":"","sources":["../../../../src/node/services/agentDefinitions/agentEnablement.test.ts"],"names":[],"mappings":";;AAAA,uCAAkD;AAKlD,uDAI2B;AAE3B,SAAS,gBAAgB,CAAC,SAAgD,EAAkB;IAC1F,OAAO;QACL,QAAQ,EAAE,IAAI,GAAG,EAAE;QACnB,eAAe,EAAE,SAAS;KAC3B,CAAC;AAAA,CACH;AAED,IAAA,mBAAQ,EAAC,iBAAiB,EAAE,GAAG,EAAE,CAAC;IAChC,IAAA,eAAI,EAAC,kDAAkD,EAAE,GAAG,EAAE,CAAC;QAC7D,MAAM,WAAW,GAA+B;YAC9C,IAAI,EAAE,MAAM;YACZ,QAAQ,EAAE,KAAK;YACf,EAAE,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE;SACvB,CAAC;QAEF,IAAA,iBAAM,EAAC,IAAA,8CAA4B,EAAC,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CAC/D,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,kDAAkD,EAAE,GAAG,EAAE,CAAC;QAC7D,MAAM,WAAW,GAA+B;YAC9C,IAAI,EAAE,MAAM;YACZ,EAAE,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE;SACvB,CAAC;QAEF,IAAA,iBAAM,EAAC,IAAA,8CAA4B,EAAC,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAAA,CAC9D,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,wDAAwD,EAAE,GAAG,EAAE,CAAC;QACnE,MAAM,GAAG,GAAG,gBAAgB,CAAC,EAAE,GAAG,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC;QACzD,MAAM,WAAW,GAA+B,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;QAEhF,IAAA,iBAAM,EAAC,IAAA,6CAA2B,EAAC,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3D,IAAA,iBAAM,EACJ,IAAA,4CAA0B,EAAC;YACzB,GAAG;YACH,OAAO,EAAE,KAAK;YACd,mBAAmB,EAAE,WAAW;SACjC,CAAC,CACH,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CACf,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,uDAAuD,EAAE,GAAG,EAAE,CAAC;QAClE,MAAM,GAAG,GAAG,gBAAgB,CAAC,EAAE,GAAG,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC;QAC1D,MAAM,WAAW,GAA+B,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC;QAEhE,IAAA,iBAAM,EAAC,IAAA,6CAA2B,EAAC,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC5D,IAAA,iBAAM,EACJ,IAAA,4CAA0B,EAAC;YACzB,GAAG;YACH,OAAO,EAAE,KAAK;YACd,mBAAmB,EAAE,WAAW;SACjC,CAAC,CACH,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAAA,CACd,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,4CAA4C,EAAE,GAAG,EAAE,CAAC;QACvD,MAAM,GAAG,GAAG,gBAAgB,CAAC,EAAE,IAAI,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC;QAC3D,MAAM,WAAW,GAA+B,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;QAEjF,IAAA,iBAAM,EACJ,IAAA,4CAA0B,EAAC;YACzB,GAAG;YACH,OAAO,EAAE,MAAM;YACf,mBAAmB,EAAE,WAAW;SACjC,CAAC,CACH,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CACf,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { describe, expect, test } from \"bun:test\";\r\n\r\nimport type { AgentDefinitionFrontmatter } from \"@/common/types/agentDefinition\";\r\nimport type { ProjectsConfig } from \"@/common/types/project\";\r\n\r\nimport {\r\n  isAgentDisabledByFrontmatter,\r\n  isAgentEffectivelyDisabled,\r\n  resolveAgentEnabledOverride,\r\n} from \"./agentEnablement\";\r\n\r\nfunction cfgWithOverrides(overrides: Record<string, { enabled?: boolean }>): ProjectsConfig {\r\n  return {\r\n    projects: new Map(),\r\n    agentAiDefaults: overrides,\r\n  };\r\n}\r\n\r\ndescribe(\"agentEnablement\", () => {\r\n  test(\"disabled field takes precedence over ui.disabled\", () => {\r\n    const frontmatter: AgentDefinitionFrontmatter = {\r\n      name: \"Test\",\r\n      disabled: false,\r\n      ui: { disabled: true },\r\n    };\r\n\r\n    expect(isAgentDisabledByFrontmatter(frontmatter)).toBe(false);\r\n  });\r\n\r\n  test(\"falls back to ui.disabled when disabled is unset\", () => {\r\n    const frontmatter: AgentDefinitionFrontmatter = {\r\n      name: \"Test\",\r\n      ui: { disabled: true },\r\n    };\r\n\r\n    expect(isAgentDisabledByFrontmatter(frontmatter)).toBe(true);\r\n  });\r\n\r\n  test(\"user override enabled:true re-enables a disabled agent\", () => {\r\n    const cfg = cfgWithOverrides({ foo: { enabled: true } });\r\n    const frontmatter: AgentDefinitionFrontmatter = { name: \"Foo\", disabled: true };\r\n\r\n    expect(resolveAgentEnabledOverride(cfg, \"foo\")).toBe(true);\r\n    expect(\r\n      isAgentEffectivelyDisabled({\r\n        cfg,\r\n        agentId: \"foo\",\r\n        resolvedFrontmatter: frontmatter,\r\n      })\r\n    ).toBe(false);\r\n  });\r\n\r\n  test(\"user override enabled:false disables an enabled agent\", () => {\r\n    const cfg = cfgWithOverrides({ foo: { enabled: false } });\r\n    const frontmatter: AgentDefinitionFrontmatter = { name: \"Foo\" };\r\n\r\n    expect(resolveAgentEnabledOverride(cfg, \"foo\")).toBe(false);\r\n    expect(\r\n      isAgentEffectivelyDisabled({\r\n        cfg,\r\n        agentId: \"foo\",\r\n        resolvedFrontmatter: frontmatter,\r\n      })\r\n    ).toBe(true);\r\n  });\r\n\r\n  test(\"core agents are never effectively disabled\", () => {\r\n    const cfg = cfgWithOverrides({ exec: { enabled: false } });\r\n    const frontmatter: AgentDefinitionFrontmatter = { name: \"Exec\", disabled: true };\r\n\r\n    expect(\r\n      isAgentEffectivelyDisabled({\r\n        cfg,\r\n        agentId: \"exec\",\r\n        resolvedFrontmatter: frontmatter,\r\n      })\r\n    ).toBe(false);\r\n  });\r\n});\r\n"]}