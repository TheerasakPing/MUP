{"version":3,"file":"agentPresets.js","sourceRoot":"","sources":["../../../src/node/services/agentPresets.ts"],"names":[],"mappings":";;;AASA,MAAM,oBAAoB,GAAG,CAAC,cAAc,CAAU,CAAC;AAEvD,SAAS,UAAU,CAAC,GAAG,SAA4B,EAAc;IAC/D,OAAO;QACL,EAAE,WAAW,EAAE,IAAI,EAAE,MAAM,EAAE,SAAS,EAAE;QACxC,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC,EAAE,WAAW,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAiB,EAAE,CAAC,CAAC;KACvF,CAAC;AAAA,CACH;AAED,MAAM,sBAAsB,GAAG;IAC7B,YAAY;IACZ,iEAAiE;IACjE,6GAA6G;CACrG,CAAC;AAEX,SAAS,iBAAiB,CAAC,IAK1B,EAAU;IACT,OAAO;QACL,aAAa,IAAI,CAAC,UAAU,8CAA8C;QAC1E,EAAE;QACF,QAAQ;QACR,GAAG,IAAI,CAAC,KAAK;QACb,EAAE;QACF,QAAQ;QACR,GAAG,IAAI,CAAC,KAAK;QACb,EAAE;QACF,GAAG,CAAC,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC;YAC/C,CAAC,CAAC,CAAC,aAAa,EAAE,GAAG,IAAI,CAAC,UAAU,EAAE,EAAE,CAAC;YACzC,CAAC,CAAC,EAAE,CAAC;QACP,GAAG,sBAAsB;KAC1B,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAAA,CACd;AAED,MAAM,WAAW,GAAgB;IAC/B,SAAS,EAAE,MAAM;IACjB,UAAU,EAAE;QACV,4DAA4D;QAC5D,EAAE,WAAW,EAAE,cAAc,EAAE,MAAM,EAAE,SAAS,EAAE;KACnD;IACD,YAAY,EAAE,iBAAiB,CAAC;QAC9B,UAAU,EAAE,MAAM;QAClB,KAAK,EAAE;YACL,yEAAyE;YACzE,wEAAwE;SACzE;QACD,KAAK,EAAE;YACL,2HAA2H;YAC3H,6BAA6B;YAC7B,yEAAyE;SAC1E;KACF,CAAC;CACH,CAAC;AAEF,MAAM,cAAc,GAAgB;IAClC,SAAS,EAAE,SAAS;IACpB,UAAU,EAAE,UAAU,CACpB,WAAW,EACX,MAAM,EACN,YAAY,EACZ,WAAW,EACX,gBAAgB,EAChB,WAAW,EACX,YAAY,EACZ,eAAe,EACf,GAAG,oBAAoB,CACxB;IACD,YAAY,EAAE,iBAAiB,CAAC;QAC9B,UAAU,EAAE,SAAS;QACrB,KAAK,EAAE;YACL,8EAA8E;YAC9E,+EAA+E;SAChF;QACD,KAAK,EAAE;YACL,0DAA0D;YAC1D,2DAA2D;YAC3D,kEAAkE;YAClE,iFAAiF;YACjF,kHAAkH;YAClH,kFAAkF;YAClF,kDAAkD;SACnD;KACF,CAAC;CACH,CAAC;AAEF,MAAM,qBAAqB,GAAgC;IACzD,OAAO,EAAE,cAAc;IACvB,IAAI,EAAE,WAAW;CAClB,CAAC;AAEF,wBAA+B,SAA6B,EAAsB;IAChF,MAAM,UAAU,GAAG,CAAC,SAAS,IAAI,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC;IAC1D,OAAO,qBAAqB,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC;AAAA,CAClD","sourcesContent":["import type { ToolPolicy } from \"@/common/utils/tools/toolPolicy\";\n\nexport interface AgentPreset {\n  /** Normalized agentType key (e.g., \"explore\" or \"exec\") */\n  agentType: string;\n  toolPolicy: ToolPolicy;\n  systemPrompt: string;\n}\n\nconst REPORTING_TOOL_NAMES = [\"agent_report\"] as const;\n\nfunction enableOnly(...toolNames: readonly string[]): ToolPolicy {\n  return [\n    { regex_match: \".*\", action: \"disable\" },\n    ...toolNames.map((toolName) => ({ regex_match: toolName, action: \"enable\" as const })),\n  ];\n}\n\nconst REPORTING_PROMPT_LINES = [\n  \"Reporting:\",\n  \"- When you have a final answer, call agent_report exactly once.\",\n  \"- Do not call agent_report until you have completed the assigned task and integrated all relevant findings.\",\n] as const;\n\nfunction buildSystemPrompt(args: {\n  agentLabel: string;\n  goals: string[];\n  rules: string[];\n  delegation?: string[];\n}): string {\n  return [\n    `You are a ${args.agentLabel} sub-agent running inside a child workspace.`,\n    \"\",\n    \"Goals:\",\n    ...args.goals,\n    \"\",\n    \"Rules:\",\n    ...args.rules,\n    \"\",\n    ...(args.delegation && args.delegation.length > 0\n      ? [\"Delegation:\", ...args.delegation, \"\"]\n      : []),\n    ...REPORTING_PROMPT_LINES,\n  ].join(\"\\n\");\n}\n\nconst EXEC_PRESET: AgentPreset = {\n  agentType: \"exec\",\n  toolPolicy: [\n    // Only the main plan-mode session should call propose_plan.\n    { regex_match: \"propose_plan\", action: \"disable\" },\n  ],\n  systemPrompt: buildSystemPrompt({\n    agentLabel: \"Exec\",\n    goals: [\n      \"- Complete the assigned coding task end-to-end in this child workspace.\",\n      \"- Make minimal, correct changes that match existing codebase patterns.\",\n    ],\n    rules: [\n      \"- You may spawn additional sub-agent tasks when the task tools are available (nesting is limited by maxTaskNestingDepth).\",\n      \"- Do not call propose_plan.\",\n      \"- Prefer small, reviewable diffs and run targeted checks when feasible.\",\n    ],\n  }),\n};\n\nconst EXPLORE_PRESET: AgentPreset = {\n  agentType: \"explore\",\n  toolPolicy: enableOnly(\n    \"file_read\",\n    \"bash\",\n    \"task_await\",\n    \"task_list\",\n    \"task_terminate\",\n    \"web_fetch\",\n    \"web_search\",\n    \"google_search\",\n    ...REPORTING_TOOL_NAMES\n  ),\n  systemPrompt: buildSystemPrompt({\n    agentLabel: \"Explore\",\n    goals: [\n      \"- Explore the repository to answer the prompt using read-only investigation.\",\n      \"- Return concise, actionable findings (paths, symbols, callsites, and facts).\",\n    ],\n    rules: [\n      \"=== CRITICAL: READ-ONLY MODE - NO FILE MODIFICATIONS ===\",\n      \"- You MUST NOT create, edit, delete, move, or copy files.\",\n      \"- You MUST NOT create temporary files anywhere (including /tmp).\",\n      \"- You MUST NOT use redirect operators (>, >>, |) or heredocs to write to files.\",\n      \"- You MUST NOT run commands that change system state (rm, mv, cp, mkdir, touch, git add/commit, installs, etc.).\",\n      \"- Use bash only for read-only operations (rg, ls, cat, git diff/show/log, etc.).\",\n      \"- You MUST NOT spawn additional sub-agent tasks.\",\n    ],\n  }),\n};\n\nconst PRESETS_BY_AGENT_TYPE: Record<string, AgentPreset> = {\n  explore: EXPLORE_PRESET,\n  exec: EXEC_PRESET,\n};\n\nexport function getAgentPreset(agentType: string | undefined): AgentPreset | null {\n  const normalized = (agentType ?? \"\").trim().toLowerCase();\n  return PRESETS_BY_AGENT_TYPE[normalized] ?? null;\n}\n"]}