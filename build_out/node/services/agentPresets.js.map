{"version":3,"file":"agentPresets.js","sourceRoot":"","sources":["../../../src/node/services/agentPresets.ts"],"names":[],"mappings":";;;AASA,MAAM,oBAAoB,GAAG,CAAC,cAAc,CAAU,CAAC;AAEvD,SAAS,UAAU,CAAC,GAAG,SAA4B,EAAc;IAC/D,OAAO;QACL,EAAE,WAAW,EAAE,IAAI,EAAE,MAAM,EAAE,SAAS,EAAE;QACxC,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC,EAAE,WAAW,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAiB,EAAE,CAAC,CAAC;KACvF,CAAC;AAAA,CACH;AAED,MAAM,sBAAsB,GAAG;IAC7B,YAAY;IACZ,iEAAiE;IACjE,6GAA6G;CACrG,CAAC;AAEX,SAAS,iBAAiB,CAAC,IAK1B,EAAU;IACT,OAAO;QACL,aAAa,IAAI,CAAC,UAAU,8CAA8C;QAC1E,EAAE;QACF,QAAQ;QACR,GAAG,IAAI,CAAC,KAAK;QACb,EAAE;QACF,QAAQ;QACR,GAAG,IAAI,CAAC,KAAK;QACb,EAAE;QACF,GAAG,CAAC,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC;YAC/C,CAAC,CAAC,CAAC,aAAa,EAAE,GAAG,IAAI,CAAC,UAAU,EAAE,EAAE,CAAC;YACzC,CAAC,CAAC,EAAE,CAAC;QACP,GAAG,sBAAsB;KAC1B,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAAA,CACd;AAED,MAAM,WAAW,GAAgB;IAC/B,SAAS,EAAE,MAAM;IACjB,UAAU,EAAE;QACV,4DAA4D;QAC5D,EAAE,WAAW,EAAE,cAAc,EAAE,MAAM,EAAE,SAAS,EAAE;KACnD;IACD,YAAY,EAAE,iBAAiB,CAAC;QAC9B,UAAU,EAAE,MAAM;QAClB,KAAK,EAAE;YACL,yEAAyE;YACzE,wEAAwE;SACzE;QACD,KAAK,EAAE;YACL,2HAA2H;YAC3H,6BAA6B;YAC7B,yEAAyE;SAC1E;KACF,CAAC;CACH,CAAC;AAEF,MAAM,cAAc,GAAgB;IAClC,SAAS,EAAE,SAAS;IACpB,UAAU,EAAE,UAAU,CACpB,WAAW,EACX,MAAM,EACN,YAAY,EACZ,WAAW,EACX,gBAAgB,EAChB,WAAW,EACX,YAAY,EACZ,eAAe,EACf,GAAG,oBAAoB,CACxB;IACD,YAAY,EAAE,iBAAiB,CAAC;QAC9B,UAAU,EAAE,SAAS;QACrB,KAAK,EAAE;YACL,8EAA8E;YAC9E,+EAA+E;SAChF;QACD,KAAK,EAAE;YACL,0DAA0D;YAC1D,2DAA2D;YAC3D,kEAAkE;YAClE,iFAAiF;YACjF,kHAAkH;YAClH,kFAAkF;YAClF,kDAAkD;SACnD;KACF,CAAC;CACH,CAAC;AAEF,MAAM,qBAAqB,GAAgC;IACzD,OAAO,EAAE,cAAc;IACvB,IAAI,EAAE,WAAW;CAClB,CAAC;AAEF,wBAA+B,SAA6B,EAAsB;IAChF,MAAM,UAAU,GAAG,CAAC,SAAS,IAAI,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC;IAC1D,OAAO,qBAAqB,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC;AAAA,CAClD","sourcesContent":["import type { ToolPolicy } from \"@/common/utils/tools/toolPolicy\";\r\n\r\nexport interface AgentPreset {\r\n  /** Normalized agentType key (e.g., \"explore\" or \"exec\") */\r\n  agentType: string;\r\n  toolPolicy: ToolPolicy;\r\n  systemPrompt: string;\r\n}\r\n\r\nconst REPORTING_TOOL_NAMES = [\"agent_report\"] as const;\r\n\r\nfunction enableOnly(...toolNames: readonly string[]): ToolPolicy {\r\n  return [\r\n    { regex_match: \".*\", action: \"disable\" },\r\n    ...toolNames.map((toolName) => ({ regex_match: toolName, action: \"enable\" as const })),\r\n  ];\r\n}\r\n\r\nconst REPORTING_PROMPT_LINES = [\r\n  \"Reporting:\",\r\n  \"- When you have a final answer, call agent_report exactly once.\",\r\n  \"- Do not call agent_report until you have completed the assigned task and integrated all relevant findings.\",\r\n] as const;\r\n\r\nfunction buildSystemPrompt(args: {\r\n  agentLabel: string;\r\n  goals: string[];\r\n  rules: string[];\r\n  delegation?: string[];\r\n}): string {\r\n  return [\r\n    `You are a ${args.agentLabel} sub-agent running inside a child workspace.`,\r\n    \"\",\r\n    \"Goals:\",\r\n    ...args.goals,\r\n    \"\",\r\n    \"Rules:\",\r\n    ...args.rules,\r\n    \"\",\r\n    ...(args.delegation && args.delegation.length > 0\r\n      ? [\"Delegation:\", ...args.delegation, \"\"]\r\n      : []),\r\n    ...REPORTING_PROMPT_LINES,\r\n  ].join(\"\\n\");\r\n}\r\n\r\nconst EXEC_PRESET: AgentPreset = {\r\n  agentType: \"exec\",\r\n  toolPolicy: [\r\n    // Only the main plan-mode session should call propose_plan.\r\n    { regex_match: \"propose_plan\", action: \"disable\" },\r\n  ],\r\n  systemPrompt: buildSystemPrompt({\r\n    agentLabel: \"Exec\",\r\n    goals: [\r\n      \"- Complete the assigned coding task end-to-end in this child workspace.\",\r\n      \"- Make minimal, correct changes that match existing codebase patterns.\",\r\n    ],\r\n    rules: [\r\n      \"- You may spawn additional sub-agent tasks when the task tools are available (nesting is limited by maxTaskNestingDepth).\",\r\n      \"- Do not call propose_plan.\",\r\n      \"- Prefer small, reviewable diffs and run targeted checks when feasible.\",\r\n    ],\r\n  }),\r\n};\r\n\r\nconst EXPLORE_PRESET: AgentPreset = {\r\n  agentType: \"explore\",\r\n  toolPolicy: enableOnly(\r\n    \"file_read\",\r\n    \"bash\",\r\n    \"task_await\",\r\n    \"task_list\",\r\n    \"task_terminate\",\r\n    \"web_fetch\",\r\n    \"web_search\",\r\n    \"google_search\",\r\n    ...REPORTING_TOOL_NAMES\r\n  ),\r\n  systemPrompt: buildSystemPrompt({\r\n    agentLabel: \"Explore\",\r\n    goals: [\r\n      \"- Explore the repository to answer the prompt using read-only investigation.\",\r\n      \"- Return concise, actionable findings (paths, symbols, callsites, and facts).\",\r\n    ],\r\n    rules: [\r\n      \"=== CRITICAL: READ-ONLY MODE - NO FILE MODIFICATIONS ===\",\r\n      \"- You MUST NOT create, edit, delete, move, or copy files.\",\r\n      \"- You MUST NOT create temporary files anywhere (including /tmp).\",\r\n      \"- You MUST NOT use redirect operators (>, >>, |) or heredocs to write to files.\",\r\n      \"- You MUST NOT run commands that change system state (rm, mv, cp, mkdir, touch, git add/commit, installs, etc.).\",\r\n      \"- Use bash only for read-only operations (rg, ls, cat, git diff/show/log, etc.).\",\r\n      \"- You MUST NOT spawn additional sub-agent tasks.\",\r\n    ],\r\n  }),\r\n};\r\n\r\nconst PRESETS_BY_AGENT_TYPE: Record<string, AgentPreset> = {\r\n  explore: EXPLORE_PRESET,\r\n  exec: EXEC_PRESET,\r\n};\r\n\r\nexport function getAgentPreset(agentType: string | undefined): AgentPreset | null {\r\n  const normalized = (agentType ?? \"\").trim().toLowerCase();\r\n  return PRESETS_BY_AGENT_TYPE[normalized] ?? null;\r\n}\r\n"]}