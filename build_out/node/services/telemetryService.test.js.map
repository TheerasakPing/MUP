{"version":3,"file":"telemetryService.test.js","sourceRoot":"","sources":["../../../src/node/services/telemetryService.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, test } from \"bun:test\";\n\nimport { shouldEnableTelemetry, type TelemetryEnablementContext } from \"./telemetryService\";\n\nfunction createContext(overrides: Partial<TelemetryEnablementContext>): TelemetryEnablementContext {\n  return {\n    env: overrides.env ?? {},\n    isElectron: overrides.isElectron ?? false,\n    isPackaged: overrides.isPackaged ?? null,\n  };\n}\n\ndescribe(\"TelemetryService enablement\", () => {\n  test(\"disables telemetry when explicitly disabled\", () => {\n    const enabled = shouldEnableTelemetry(\n      createContext({\n        env: { MUX_DISABLE_TELEMETRY: \"1\" },\n        isElectron: true,\n        isPackaged: true,\n      })\n    );\n\n    expect(enabled).toBe(false);\n  });\n\n  test(\"disables telemetry in E2E runs\", () => {\n    const enabled = shouldEnableTelemetry(\n      createContext({\n        env: { MUX_E2E: \"1\" },\n        isElectron: true,\n        isPackaged: true,\n      })\n    );\n\n    expect(enabled).toBe(false);\n  });\n\n  test(\"disables telemetry in test environments\", () => {\n    const enabled = shouldEnableTelemetry(\n      createContext({\n        env: { NODE_ENV: \"test\" },\n        isElectron: true,\n        isPackaged: true,\n      })\n    );\n\n    expect(enabled).toBe(false);\n  });\n\n  test(\"disables telemetry in CI environments\", () => {\n    const enabled = shouldEnableTelemetry(\n      createContext({\n        env: { CI: \"true\" },\n        isElectron: true,\n        isPackaged: true,\n      })\n    );\n\n    expect(enabled).toBe(false);\n  });\n\n  test(\"enables telemetry in unpackaged Electron by default\", () => {\n    // Telemetry is now enabled by default in dev mode (unpackaged Electron)\n    const enabled = shouldEnableTelemetry(\n      createContext({\n        env: {},\n        isElectron: true,\n        isPackaged: false,\n      })\n    );\n\n    expect(enabled).toBe(true);\n  });\n\n  test(\"enables telemetry in packaged Electron by default\", () => {\n    const enabled = shouldEnableTelemetry(\n      createContext({\n        env: {},\n        isElectron: true,\n        isPackaged: true,\n      })\n    );\n\n    expect(enabled).toBe(true);\n  });\n\n  test(\"enables telemetry in NODE_ENV=development by default\", () => {\n    // Telemetry is now enabled by default in dev mode\n    const enabled = shouldEnableTelemetry(\n      createContext({\n        env: { NODE_ENV: \"development\" },\n        isElectron: false,\n      })\n    );\n\n    expect(enabled).toBe(true);\n  });\n\n  test(\"allows opting into telemetry in unpackaged Electron\", () => {\n    const enabled = shouldEnableTelemetry(\n      createContext({\n        env: { MUX_ENABLE_TELEMETRY_IN_DEV: \"1\" },\n        isElectron: true,\n        isPackaged: false,\n      })\n    );\n\n    expect(enabled).toBe(true);\n  });\n\n  test(\"dev opt-in does not bypass test env disable\", () => {\n    const enabled = shouldEnableTelemetry(\n      createContext({\n        env: {\n          NODE_ENV: \"test\",\n          MUX_ENABLE_TELEMETRY_IN_DEV: \"1\",\n        },\n        isElectron: false,\n      })\n    );\n\n    expect(enabled).toBe(false);\n  });\n});\n"]}