{"version":3,"file":"telemetryService.test.js","sourceRoot":"","sources":["../../../src/node/services/telemetryService.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, test } from \"bun:test\";\r\n\r\nimport { shouldEnableTelemetry, type TelemetryEnablementContext } from \"./telemetryService\";\r\n\r\nfunction createContext(overrides: Partial<TelemetryEnablementContext>): TelemetryEnablementContext {\r\n  return {\r\n    env: overrides.env ?? {},\r\n    isElectron: overrides.isElectron ?? false,\r\n    isPackaged: overrides.isPackaged ?? null,\r\n  };\r\n}\r\n\r\ndescribe(\"TelemetryService enablement\", () => {\r\n  test(\"disables telemetry when explicitly disabled\", () => {\r\n    const enabled = shouldEnableTelemetry(\r\n      createContext({\r\n        env: { MUX_DISABLE_TELEMETRY: \"1\" },\r\n        isElectron: true,\r\n        isPackaged: true,\r\n      })\r\n    );\r\n\r\n    expect(enabled).toBe(false);\r\n  });\r\n\r\n  test(\"disables telemetry in E2E runs\", () => {\r\n    const enabled = shouldEnableTelemetry(\r\n      createContext({\r\n        env: { MUX_E2E: \"1\" },\r\n        isElectron: true,\r\n        isPackaged: true,\r\n      })\r\n    );\r\n\r\n    expect(enabled).toBe(false);\r\n  });\r\n\r\n  test(\"disables telemetry in test environments\", () => {\r\n    const enabled = shouldEnableTelemetry(\r\n      createContext({\r\n        env: { NODE_ENV: \"test\" },\r\n        isElectron: true,\r\n        isPackaged: true,\r\n      })\r\n    );\r\n\r\n    expect(enabled).toBe(false);\r\n  });\r\n\r\n  test(\"disables telemetry in CI environments\", () => {\r\n    const enabled = shouldEnableTelemetry(\r\n      createContext({\r\n        env: { CI: \"true\" },\r\n        isElectron: true,\r\n        isPackaged: true,\r\n      })\r\n    );\r\n\r\n    expect(enabled).toBe(false);\r\n  });\r\n\r\n  test(\"enables telemetry in unpackaged Electron by default\", () => {\r\n    // Telemetry is now enabled by default in dev mode (unpackaged Electron)\r\n    const enabled = shouldEnableTelemetry(\r\n      createContext({\r\n        env: {},\r\n        isElectron: true,\r\n        isPackaged: false,\r\n      })\r\n    );\r\n\r\n    expect(enabled).toBe(true);\r\n  });\r\n\r\n  test(\"enables telemetry in packaged Electron by default\", () => {\r\n    const enabled = shouldEnableTelemetry(\r\n      createContext({\r\n        env: {},\r\n        isElectron: true,\r\n        isPackaged: true,\r\n      })\r\n    );\r\n\r\n    expect(enabled).toBe(true);\r\n  });\r\n\r\n  test(\"enables telemetry in NODE_ENV=development by default\", () => {\r\n    // Telemetry is now enabled by default in dev mode\r\n    const enabled = shouldEnableTelemetry(\r\n      createContext({\r\n        env: { NODE_ENV: \"development\" },\r\n        isElectron: false,\r\n      })\r\n    );\r\n\r\n    expect(enabled).toBe(true);\r\n  });\r\n\r\n  test(\"allows opting into telemetry in unpackaged Electron\", () => {\r\n    const enabled = shouldEnableTelemetry(\r\n      createContext({\r\n        env: { MUX_ENABLE_TELEMETRY_IN_DEV: \"1\" },\r\n        isElectron: true,\r\n        isPackaged: false,\r\n      })\r\n    );\r\n\r\n    expect(enabled).toBe(true);\r\n  });\r\n\r\n  test(\"dev opt-in does not bypass test env disable\", () => {\r\n    const enabled = shouldEnableTelemetry(\r\n      createContext({\r\n        env: {\r\n          NODE_ENV: \"test\",\r\n          MUX_ENABLE_TELEMETRY_IN_DEV: \"1\",\r\n        },\r\n        isElectron: false,\r\n      })\r\n    );\r\n\r\n    expect(enabled).toBe(false);\r\n  });\r\n});\r\n"]}