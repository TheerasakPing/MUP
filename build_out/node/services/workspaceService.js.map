{"version":3,"file":"workspaceService.js","sourceRoot":"","sources":["../../../src/node/services/workspaceService.ts"],"names":[],"mappings":"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","sourcesContent":["import { EventEmitter } from \"events\";\nimport * as path from \"path\";\nimport * as fsPromises from \"fs/promises\";\nimport assert from \"@/common/utils/assert\";\nimport { isWorkspaceArchived } from \"@/common/utils/archive\";\nimport { MUX_HELP_CHAT_WORKSPACE_ID } from \"@/common/constants/muxChat\";\nimport { getMuxHelpChatProjectPath } from \"@/node/constants/muxChat\";\nimport type { Config } from \"@/node/config\";\nimport type { Result } from \"@/common/types/result\";\nimport { Ok, Err } from \"@/common/types/result\";\nimport { askUserQuestionManager } from \"@/node/services/askUserQuestionManager\";\nimport { log } from \"@/node/services/log\";\nimport { AgentSession } from \"@/node/services/agentSession\";\nimport type { HistoryService } from \"@/node/services/historyService\";\nimport type { PartialService } from \"@/node/services/partialService\";\nimport type { AIService } from \"@/node/services/aiService\";\nimport type { InitStateManager } from \"@/node/services/initStateManager\";\nimport type { ExtensionMetadataService } from \"@/node/services/ExtensionMetadataService\";\nimport type { TelemetryService } from \"@/node/services/telemetryService\";\nimport type { ExperimentsService } from \"@/node/services/experimentsService\";\nimport { EXPERIMENT_IDS, EXPERIMENTS } from \"@/common/constants/experiments\";\nimport type { PolicyService } from \"@/node/services/policyService\";\nimport type { MCPServerManager } from \"@/node/services/mcpServerManager\";\nimport {\n  createRuntime,\n  IncompatibleRuntimeError,\n  runBackgroundInit,\n} from \"@/node/runtime/runtimeFactory\";\nimport { createRuntimeForWorkspace } from \"@/node/runtime/runtimeHelpers\";\nimport { validateWorkspaceName } from \"@/common/utils/validation/workspaceValidation\";\nimport { getPlanFilePath, getLegacyPlanFilePath } from \"@/common/utils/planStorage\";\nimport { shellQuote } from \"@/node/runtime/backgroundCommands\";\nimport { extractEditedFilePaths } from \"@/common/utils/messages/extractEditedFiles\";\nimport { fileExists } from \"@/node/utils/runtime/fileExists\";\nimport { applyForkRuntimeUpdates } from \"@/node/services/utils/forkRuntimeUpdates\";\nimport type { DevcontainerRuntime } from \"@/node/runtime/DevcontainerRuntime\";\nimport { getDevcontainerContainerName } from \"@/node/runtime/devcontainerCli\";\nimport { expandTilde, expandTildeForSSH } from \"@/node/runtime/tildeExpansion\";\n\nimport type { PostCompactionExclusions } from \"@/common/types/attachment\";\nimport type {\n  SendMessageOptions,\n  DeleteMessage,\n  FilePart,\n  WorkspaceChatMessage,\n} from \"@/common/orpc/types\";\n\nimport type { z } from \"zod\";\nimport type { SendMessageError } from \"@/common/types/errors\";\nimport type {\n  FrontendWorkspaceMetadata,\n  WorkspaceActivitySnapshot,\n  WorkspaceMetadata,\n} from \"@/common/types/workspace\";\nimport { isDynamicToolPart } from \"@/common/types/toolParts\";\nimport { buildAskUserQuestionSummary } from \"@/common/utils/tools/askUserQuestionSummary\";\nimport {\n  AskUserQuestionToolArgsSchema,\n  AskUserQuestionToolResultSchema,\n} from \"@/common/utils/tools/toolDefinitions\";\nimport type { UIMode } from \"@/common/types/mode\";\nimport type { MuxMessage } from \"@/common/types/message\";\nimport type { RuntimeConfig } from \"@/common/types/runtime\";\nimport {\n  hasSrcBaseDir,\n  getSrcBaseDir,\n  isSSHRuntime,\n  isDockerRuntime,\n} from \"@/common/types/runtime\";\nimport { isValidModelFormat, normalizeGatewayModel } from \"@/common/utils/ai/models\";\nimport { coerceThinkingLevel, type ThinkingLevel } from \"@/common/types/thinking\";\nimport { WORKSPACE_DEFAULTS } from \"@/constants/workspaceDefaults\";\nimport type { StreamEndEvent, StreamAbortEvent } from \"@/common/types/stream\";\nimport type { TerminalService } from \"@/node/services/terminalService\";\nimport type { WorkspaceAISettingsSchema } from \"@/common/orpc/schemas\";\nimport type { SessionTimingService } from \"@/node/services/sessionTimingService\";\nimport type { SessionUsageService } from \"@/node/services/sessionUsageService\";\nimport type { CostTrackingService } from \"@/node/services/costTrackingService\";\nimport type { BackgroundProcessManager } from \"@/node/services/backgroundProcessManager\";\nimport type { WorkspaceLifecycleHooks } from \"@/node/services/workspaceLifecycleHooks\";\nimport type { TaskService } from \"@/node/services/taskService\";\n\nimport { DisposableTempDir } from \"@/node/services/tempDir\";\nimport { createBashTool } from \"@/node/services/tools/bash\";\nimport type { AskUserQuestionToolSuccessResult, BashToolResult } from \"@/common/types/tools\";\nimport { secretsToRecord } from \"@/common/types/secrets\";\n\nimport { execBuffered, movePlanFile, copyPlanFile } from \"@/node/utils/runtime/helpers\";\nimport {\n  buildFileCompletionsIndex,\n  EMPTY_FILE_COMPLETIONS_INDEX,\n  searchFileCompletions,\n  type FileCompletionsIndex,\n} from \"@/node/services/fileCompletionsIndex\";\nimport { taskQueueDebug } from \"@/node/services/taskQueueDebug\";\nimport {\n  getSubagentGitPatchMboxPath,\n  readSubagentGitPatchArtifactsFile,\n  updateSubagentGitPatchArtifactsFile,\n} from \"@/node/services/subagentGitPatchArtifacts\";\nimport {\n  getSubagentReportArtifactPath,\n  readSubagentReportArtifactsFile,\n  updateSubagentReportArtifactsFile,\n} from \"@/node/services/subagentReportArtifacts\";\nimport {\n  getSubagentTranscriptChatPath,\n  getSubagentTranscriptPartialPath,\n  readSubagentTranscriptArtifactsFile,\n  updateSubagentTranscriptArtifactsFile,\n  upsertSubagentTranscriptArtifactIndexEntry,\n} from \"@/node/services/subagentTranscriptArtifacts\";\n\n/** Maximum number of retry attempts when workspace name collides */\nconst MAX_WORKSPACE_NAME_COLLISION_RETRIES = 3;\n\n// Keep short to feel instant, but debounce bursts of file_edit_* tool calls.\n\n// Shared type for workspace-scoped AI settings (model + thinking)\ntype WorkspaceAISettings = z.infer<typeof WorkspaceAISettingsSchema>;\nconst POST_COMPACTION_METADATA_REFRESH_DEBOUNCE_MS = 100;\n\ninterface FileCompletionsCacheEntry {\n  index: FileCompletionsIndex;\n  fetchedAt: number;\n  refreshing?: Promise<void>;\n}\n\ninterface ArchiveMergedInProjectResult {\n  archivedWorkspaceIds: string[];\n  skippedWorkspaceIds: string[];\n  errors: Array<{ workspaceId: string; error: string }>;\n}\n\n/**\n * Checks if an error indicates a workspace name collision\n */\nfunction isWorkspaceNameCollision(error: string | undefined): boolean {\n  return error?.includes(\"Workspace already exists\") ?? false;\n}\n\n/**\n * Generates a unique workspace name by appending a random suffix\n */\nfunction appendCollisionSuffix(baseName: string): string {\n  const suffix = Math.random().toString(36).substring(2, 6);\n  return `${baseName}-${suffix}`;\n}\n\nfunction isErrnoWithCode(error: unknown, code: string): boolean {\n  return Boolean(error && typeof error === \"object\" && \"code\" in error && error.code === code);\n}\n\nfunction isPathInsideDir(dirPath: string, filePath: string): boolean {\n  const resolvedDir = path.resolve(dirPath);\n  const resolvedFile = path.resolve(filePath);\n  const relative = path.relative(resolvedDir, resolvedFile);\n\n  return relative === \"\" || (!relative.startsWith(\"..\") && !path.isAbsolute(relative));\n}\n\nfunction isPositiveInteger(value: unknown): value is number {\n  return (\n    typeof value === \"number\" && Number.isFinite(value) && Number.isInteger(value) && value > 0\n  );\n}\n\nfunction hasDurableCompactedMarker(value: unknown): value is true | \"user\" | \"idle\" {\n  return value === true || value === \"user\" || value === \"idle\";\n}\n\nfunction isCompactedSummaryMessage(message: MuxMessage): boolean {\n  return hasDurableCompactedMarker(message.metadata?.compacted);\n}\n\nfunction getNextCompactionEpochForAppendBoundary(\n  workspaceId: string,\n  messages: MuxMessage[]\n): number {\n  let epochCursor = 0;\n\n  for (const message of messages) {\n    const metadata = message.metadata;\n    if (!metadata) {\n      continue;\n    }\n\n    const isCompactedSummary = isCompactedSummaryMessage(message);\n    const hasBoundaryMarker = metadata.compactionBoundary === true;\n    const epoch = metadata.compactionEpoch;\n\n    if (hasBoundaryMarker && !isCompactedSummary) {\n      // Self-healing read path: skip malformed persisted boundary markers.\n      // Boundary markers are only valid on compacted summaries.\n      log.warn(\"Skipping malformed compaction boundary while deriving next epoch\", {\n        workspaceId,\n        messageId: message.id,\n        reason: \"compactionBoundary set on non-compacted message\",\n      });\n      continue;\n    }\n\n    if (!isCompactedSummary) {\n      continue;\n    }\n\n    if (hasBoundaryMarker) {\n      if (!isPositiveInteger(epoch)) {\n        // Self-healing read path: invalid boundary metadata should not brick compaction.\n        log.warn(\"Skipping malformed compaction boundary while deriving next epoch\", {\n          workspaceId,\n          messageId: message.id,\n          reason: \"compactionBoundary missing positive integer compactionEpoch\",\n        });\n        continue;\n      }\n      epochCursor = Math.max(epochCursor, epoch);\n      continue;\n    }\n\n    if (epoch === undefined) {\n      // Legacy compacted summaries predate compactionEpoch metadata.\n      epochCursor += 1;\n      continue;\n    }\n\n    if (!isPositiveInteger(epoch)) {\n      // Self-healing read path: malformed compactionEpoch should not crash compaction.\n      log.warn(\"Skipping malformed compactionEpoch while deriving next epoch\", {\n        workspaceId,\n        messageId: message.id,\n        reason: \"compactionEpoch must be a positive integer when present\",\n      });\n      continue;\n    }\n\n    epochCursor = Math.max(epochCursor, epoch);\n  }\n\n  const nextEpoch = epochCursor + 1;\n  assert(nextEpoch > 0, \"next compaction epoch must be positive\");\n  return nextEpoch;\n}\n\nasync function copyFileBestEffort(params: {\n  srcPath: string;\n  destPath: string;\n  logContext: Record<string, unknown>;\n}): Promise<boolean> {\n  try {\n    await fsPromises.mkdir(path.dirname(params.destPath), { recursive: true });\n    await fsPromises.copyFile(params.srcPath, params.destPath);\n    return true;\n  } catch (error: unknown) {\n    if (isErrnoWithCode(error, \"ENOENT\")) {\n      return false;\n    }\n\n    log.error(\"Failed to copy session artifact file\", {\n      ...params.logContext,\n      srcPath: params.srcPath,\n      destPath: params.destPath,\n      error: error instanceof Error ? error.message : String(error),\n    });\n    return false;\n  }\n}\n\nasync function copyDirIfMissingBestEffort(params: {\n  srcDir: string;\n  destDir: string;\n  logContext: Record<string, unknown>;\n}): Promise<void> {\n  try {\n    try {\n      const stat = await fsPromises.stat(params.destDir);\n      if (stat.isDirectory()) {\n        return;\n      }\n      // If it's a file, fall through and try to copy (will likely fail).\n    } catch (error: unknown) {\n      if (!isErrnoWithCode(error, \"ENOENT\")) {\n        throw error;\n      }\n    }\n\n    await fsPromises.mkdir(path.dirname(params.destDir), { recursive: true });\n    await fsPromises.cp(params.srcDir, params.destDir, { recursive: true });\n  } catch (error: unknown) {\n    if (isErrnoWithCode(error, \"ENOENT\")) {\n      return;\n    }\n\n    log.error(\"Failed to copy session artifact directory\", {\n      ...params.logContext,\n      srcDir: params.srcDir,\n      destDir: params.destDir,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n}\n\nfunction coerceUpdatedAtMs(entry: { createdAtMs?: number; updatedAtMs?: number }): number {\n  if (typeof entry.updatedAtMs === \"number\" && Number.isFinite(entry.updatedAtMs)) {\n    return entry.updatedAtMs;\n  }\n\n  if (typeof entry.createdAtMs === \"number\" && Number.isFinite(entry.createdAtMs)) {\n    return entry.createdAtMs;\n  }\n\n  return 0;\n}\n\nfunction rollUpAncestorWorkspaceIds(params: {\n  ancestorWorkspaceIds: string[];\n  removedWorkspaceId: string;\n  newParentWorkspaceId: string;\n}): string[] {\n  const filtered = params.ancestorWorkspaceIds.filter((id) => id !== params.removedWorkspaceId);\n\n  // Ensure the roll-up target is first (parent-first ordering).\n  if (filtered[0] === params.newParentWorkspaceId) {\n    return filtered;\n  }\n\n  return [\n    params.newParentWorkspaceId,\n    ...filtered.filter((id) => id !== params.newParentWorkspaceId),\n  ];\n}\n\nasync function archiveChildSessionArtifactsIntoParentSessionDir(params: {\n  parentWorkspaceId: string;\n  parentSessionDir: string;\n  childWorkspaceId: string;\n  childSessionDir: string;\n  /** Task-level model string for the child workspace (optional; persists into transcript artifacts). */\n  childTaskModelString?: string;\n  /** Task-level thinking/reasoning level for the child workspace (optional; persists into transcript artifacts). */\n  childTaskThinkingLevel?: ThinkingLevel;\n}): Promise<void> {\n  if (params.parentWorkspaceId.length === 0) {\n    return;\n  }\n\n  if (params.childWorkspaceId.length === 0) {\n    return;\n  }\n\n  if (params.parentSessionDir.length === 0 || params.childSessionDir.length === 0) {\n    return;\n  }\n\n  // 1) Archive the child session transcript (chat.jsonl + partial.json) into the parent session dir\n  // BEFORE deleting ~/.mux/sessions/<childWorkspaceId>.\n  try {\n    const childChatPath = path.join(params.childSessionDir, \"chat.jsonl\");\n    const childPartialPath = path.join(params.childSessionDir, \"partial.json\");\n\n    const archivedChatPath = getSubagentTranscriptChatPath(\n      params.parentSessionDir,\n      params.childWorkspaceId\n    );\n    const archivedPartialPath = getSubagentTranscriptPartialPath(\n      params.parentSessionDir,\n      params.childWorkspaceId\n    );\n\n    // Defensive: avoid path traversal in workspace IDs.\n    if (!isPathInsideDir(params.parentSessionDir, archivedChatPath)) {\n      log.error(\"Refusing to archive session transcript outside parent session dir\", {\n        parentWorkspaceId: params.parentWorkspaceId,\n        childWorkspaceId: params.childWorkspaceId,\n        parentSessionDir: params.parentSessionDir,\n        archivedChatPath,\n      });\n    } else {\n      const didCopyChat = await copyFileBestEffort({\n        srcPath: childChatPath,\n        destPath: archivedChatPath,\n        logContext: {\n          parentWorkspaceId: params.parentWorkspaceId,\n          childWorkspaceId: params.childWorkspaceId,\n          artifact: \"chat.jsonl\",\n        },\n      });\n\n      const didCopyPartial = await copyFileBestEffort({\n        srcPath: childPartialPath,\n        destPath: archivedPartialPath,\n        logContext: {\n          parentWorkspaceId: params.parentWorkspaceId,\n          childWorkspaceId: params.childWorkspaceId,\n          artifact: \"partial.json\",\n        },\n      });\n\n      if (didCopyChat || didCopyPartial) {\n        const nowMs = Date.now();\n\n        const model =\n          typeof params.childTaskModelString === \"string\" &&\n          params.childTaskModelString.trim().length > 0\n            ? params.childTaskModelString.trim()\n            : undefined;\n        const thinkingLevel = coerceThinkingLevel(params.childTaskThinkingLevel);\n\n        await upsertSubagentTranscriptArtifactIndexEntry({\n          workspaceId: params.parentWorkspaceId,\n          workspaceSessionDir: params.parentSessionDir,\n          childTaskId: params.childWorkspaceId,\n          updater: (existing) => ({\n            childTaskId: params.childWorkspaceId,\n            parentWorkspaceId: params.parentWorkspaceId,\n            createdAtMs: existing?.createdAtMs ?? nowMs,\n            updatedAtMs: nowMs,\n            model: model ?? existing?.model,\n            thinkingLevel: thinkingLevel ?? existing?.thinkingLevel,\n            chatPath: didCopyChat ? archivedChatPath : existing?.chatPath,\n            partialPath: didCopyPartial ? archivedPartialPath : existing?.partialPath,\n          }),\n        });\n      }\n    }\n  } catch (error: unknown) {\n    log.error(\"Failed to archive child transcript into parent session dir\", {\n      parentWorkspaceId: params.parentWorkspaceId,\n      childWorkspaceId: params.childWorkspaceId,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n\n  // 2) Roll up nested subagent artifacts from the child session dir into the parent session dir.\n  // This preserves grandchild artifacts when intermediate subagent workspaces are cleaned up.\n\n  // --- subagent-patches.json + subagent-patches/<taskId>/...\n  try {\n    const childArtifacts = await readSubagentGitPatchArtifactsFile(params.childSessionDir);\n    const childEntries = Object.entries(childArtifacts.artifactsByChildTaskId);\n\n    for (const [taskId] of childEntries) {\n      if (!taskId) continue;\n\n      const srcDir = path.dirname(getSubagentGitPatchMboxPath(params.childSessionDir, taskId));\n      const destDir = path.dirname(getSubagentGitPatchMboxPath(params.parentSessionDir, taskId));\n\n      if (!isPathInsideDir(params.childSessionDir, srcDir)) {\n        log.error(\"Refusing to roll up patch artifact outside child session dir\", {\n          parentWorkspaceId: params.parentWorkspaceId,\n          childWorkspaceId: params.childWorkspaceId,\n          taskId,\n          childSessionDir: params.childSessionDir,\n          srcDir,\n        });\n        continue;\n      }\n\n      if (!isPathInsideDir(params.parentSessionDir, destDir)) {\n        log.error(\"Refusing to roll up patch artifact outside parent session dir\", {\n          parentWorkspaceId: params.parentWorkspaceId,\n          childWorkspaceId: params.childWorkspaceId,\n          taskId,\n          parentSessionDir: params.parentSessionDir,\n          destDir,\n        });\n        continue;\n      }\n\n      await copyDirIfMissingBestEffort({\n        srcDir,\n        destDir,\n        logContext: {\n          parentWorkspaceId: params.parentWorkspaceId,\n          childWorkspaceId: params.childWorkspaceId,\n          artifact: \"subagent-patches\",\n          taskId,\n        },\n      });\n    }\n\n    if (childEntries.length > 0) {\n      await updateSubagentGitPatchArtifactsFile({\n        workspaceId: params.parentWorkspaceId,\n        workspaceSessionDir: params.parentSessionDir,\n        update: (parentFile) => {\n          for (const [taskId, childEntry] of childEntries) {\n            if (!taskId) continue;\n            const existing = parentFile.artifactsByChildTaskId[taskId] ?? null;\n\n            const childUpdated = coerceUpdatedAtMs(childEntry);\n            const existingUpdated = existing ? coerceUpdatedAtMs(existing) : -1;\n\n            if (!existing || childUpdated > existingUpdated) {\n              parentFile.artifactsByChildTaskId[taskId] = {\n                ...childEntry,\n                childTaskId: taskId,\n                parentWorkspaceId: params.parentWorkspaceId,\n                mboxPath: getSubagentGitPatchMboxPath(params.parentSessionDir, taskId),\n              };\n            }\n          }\n        },\n      });\n    }\n  } catch (error: unknown) {\n    log.error(\"Failed to roll up subagent patch artifacts into parent\", {\n      parentWorkspaceId: params.parentWorkspaceId,\n      childWorkspaceId: params.childWorkspaceId,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n\n  // --- subagent-reports.json + subagent-reports/<taskId>/...\n  try {\n    const childArtifacts = await readSubagentReportArtifactsFile(params.childSessionDir);\n    const childEntries = Object.entries(childArtifacts.artifactsByChildTaskId);\n\n    for (const [taskId] of childEntries) {\n      if (!taskId) continue;\n\n      const srcDir = path.dirname(getSubagentReportArtifactPath(params.childSessionDir, taskId));\n      const destDir = path.dirname(getSubagentReportArtifactPath(params.parentSessionDir, taskId));\n\n      if (!isPathInsideDir(params.childSessionDir, srcDir)) {\n        log.error(\"Refusing to roll up report artifact outside child session dir\", {\n          parentWorkspaceId: params.parentWorkspaceId,\n          childWorkspaceId: params.childWorkspaceId,\n          taskId,\n          childSessionDir: params.childSessionDir,\n          srcDir,\n        });\n        continue;\n      }\n\n      if (!isPathInsideDir(params.parentSessionDir, destDir)) {\n        log.error(\"Refusing to roll up report artifact outside parent session dir\", {\n          parentWorkspaceId: params.parentWorkspaceId,\n          childWorkspaceId: params.childWorkspaceId,\n          taskId,\n          parentSessionDir: params.parentSessionDir,\n          destDir,\n        });\n        continue;\n      }\n\n      await copyDirIfMissingBestEffort({\n        srcDir,\n        destDir,\n        logContext: {\n          parentWorkspaceId: params.parentWorkspaceId,\n          childWorkspaceId: params.childWorkspaceId,\n          artifact: \"subagent-reports\",\n          taskId,\n        },\n      });\n    }\n\n    if (childEntries.length > 0) {\n      await updateSubagentReportArtifactsFile({\n        workspaceId: params.parentWorkspaceId,\n        workspaceSessionDir: params.parentSessionDir,\n        update: (parentFile) => {\n          for (const [taskId, childEntry] of childEntries) {\n            if (!taskId) continue;\n\n            const existing = parentFile.artifactsByChildTaskId[taskId] ?? null;\n            const childUpdated = coerceUpdatedAtMs(childEntry);\n            const existingUpdated = existing ? coerceUpdatedAtMs(existing) : -1;\n\n            if (!existing || childUpdated > existingUpdated) {\n              parentFile.artifactsByChildTaskId[taskId] = {\n                ...childEntry,\n                childTaskId: taskId,\n                parentWorkspaceId: params.parentWorkspaceId,\n                ancestorWorkspaceIds: rollUpAncestorWorkspaceIds({\n                  ancestorWorkspaceIds: childEntry.ancestorWorkspaceIds,\n                  removedWorkspaceId: params.childWorkspaceId,\n                  newParentWorkspaceId: params.parentWorkspaceId,\n                }),\n              };\n            }\n          }\n        },\n      });\n    }\n  } catch (error: unknown) {\n    log.error(\"Failed to roll up subagent report artifacts into parent\", {\n      parentWorkspaceId: params.parentWorkspaceId,\n      childWorkspaceId: params.childWorkspaceId,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n\n  // --- subagent-transcripts.json + subagent-transcripts/<taskId>/...\n  try {\n    const childArtifacts = await readSubagentTranscriptArtifactsFile(params.childSessionDir);\n    const childEntries = Object.entries(childArtifacts.artifactsByChildTaskId);\n\n    for (const [taskId] of childEntries) {\n      if (!taskId) continue;\n\n      const srcDir = path.dirname(getSubagentTranscriptChatPath(params.childSessionDir, taskId));\n      const destDir = path.dirname(getSubagentTranscriptChatPath(params.parentSessionDir, taskId));\n\n      if (!isPathInsideDir(params.childSessionDir, srcDir)) {\n        log.error(\"Refusing to roll up transcript artifact outside child session dir\", {\n          parentWorkspaceId: params.parentWorkspaceId,\n          childWorkspaceId: params.childWorkspaceId,\n          taskId,\n          childSessionDir: params.childSessionDir,\n          srcDir,\n        });\n        continue;\n      }\n\n      if (!isPathInsideDir(params.parentSessionDir, destDir)) {\n        log.error(\"Refusing to roll up transcript artifact outside parent session dir\", {\n          parentWorkspaceId: params.parentWorkspaceId,\n          childWorkspaceId: params.childWorkspaceId,\n          taskId,\n          parentSessionDir: params.parentSessionDir,\n          destDir,\n        });\n        continue;\n      }\n\n      await copyDirIfMissingBestEffort({\n        srcDir,\n        destDir,\n        logContext: {\n          parentWorkspaceId: params.parentWorkspaceId,\n          childWorkspaceId: params.childWorkspaceId,\n          artifact: \"subagent-transcripts\",\n          taskId,\n        },\n      });\n    }\n\n    if (childEntries.length > 0) {\n      await updateSubagentTranscriptArtifactsFile({\n        workspaceId: params.parentWorkspaceId,\n        workspaceSessionDir: params.parentSessionDir,\n        update: (parentFile) => {\n          for (const [taskId, childEntry] of childEntries) {\n            if (!taskId) continue;\n\n            const existing = parentFile.artifactsByChildTaskId[taskId] ?? null;\n            const childUpdated = coerceUpdatedAtMs(childEntry);\n            const existingUpdated = existing ? coerceUpdatedAtMs(existing) : -1;\n\n            if (!existing || childUpdated > existingUpdated) {\n              parentFile.artifactsByChildTaskId[taskId] = {\n                ...childEntry,\n                childTaskId: taskId,\n                parentWorkspaceId: params.parentWorkspaceId,\n                chatPath: childEntry.chatPath\n                  ? getSubagentTranscriptChatPath(params.parentSessionDir, taskId)\n                  : undefined,\n                partialPath: childEntry.partialPath\n                  ? getSubagentTranscriptPartialPath(params.parentSessionDir, taskId)\n                  : undefined,\n              };\n            }\n          }\n        },\n      });\n    }\n  } catch (error: unknown) {\n    log.error(\"Failed to roll up subagent transcript artifacts into parent\", {\n      parentWorkspaceId: params.parentWorkspaceId,\n      childWorkspaceId: params.childWorkspaceId,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n}\n\nasync function forEachWithConcurrencyLimit<T>(\n  items: readonly T[],\n  limit: number,\n  fn: (item: T) => Promise<void>\n): Promise<void> {\n  assert(Number.isInteger(limit) && limit > 0, \"Concurrency limit must be a positive integer\");\n\n  let nextIndex = 0;\n  const workerCount = Math.min(limit, items.length);\n\n  const workers = Array.from({ length: workerCount }, async () => {\n    while (true) {\n      const index = nextIndex++;\n      if (index >= items.length) {\n        return;\n      }\n      await fn(items[index]);\n    }\n  });\n\n  await Promise.all(workers);\n}\n\nexport interface WorkspaceServiceEvents {\n  chat: (event: { workspaceId: string; message: WorkspaceChatMessage }) => void;\n  metadata: (event: { workspaceId: string; metadata: FrontendWorkspaceMetadata | null }) => void;\n  activity: (event: { workspaceId: string; activity: WorkspaceActivitySnapshot | null }) => void;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-declaration-merging\nexport declare interface WorkspaceService {\n  on<U extends keyof WorkspaceServiceEvents>(event: U, listener: WorkspaceServiceEvents[U]): this;\n  emit<U extends keyof WorkspaceServiceEvents>(\n    event: U,\n    ...args: Parameters<WorkspaceServiceEvents[U]>\n  ): boolean;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-declaration-merging\nexport class WorkspaceService extends EventEmitter {\n  private readonly sessions = new Map<string, AgentSession>();\n  private readonly sessionSubscriptions = new Map<\n    string,\n    { chat: () => void; metadata: () => void }\n  >();\n\n  // Debounce post-compaction metadata refreshes (file_edit_* can fire rapidly)\n  private readonly postCompactionRefreshTimers = new Map<string, ReturnType<typeof setTimeout>>();\n  // Tracks workspaces currently being renamed to prevent streaming during rename\n  private readonly renamingWorkspaces = new Set<string>();\n\n  // Cache for @file mention autocomplete (git ls-files output).\n  private readonly fileCompletionsCache = new Map<string, FileCompletionsCacheEntry>();\n  // Tracks workspaces currently being removed to prevent new sessions/streams during deletion.\n  private readonly removingWorkspaces = new Set<string>();\n\n  // Tracks workspaces currently being archived to prevent runtime-affecting operations (e.g. SSH)\n  // from waking a dedicated workspace during archive().\n  private readonly archivingWorkspaces = new Set<string>();\n\n  // AbortControllers for in-progress workspace initialization (postCreateSetup + initWorkspace).\n  //\n  // Why this lives here: archive/remove are the user-facing lifecycle operations that should\n  // cancel any fire-and-forget init work to avoid orphaned processes (e.g., SSH sync, .mux/init).\n  private readonly initAbortControllers = new Map<string, AbortController>();\n\n  /** Check if a workspace is currently being removed. */\n  isRemoving(workspaceId: string): boolean {\n    return this.removingWorkspaces.has(workspaceId);\n  }\n\n  constructor(\n    private readonly config: Config,\n    private readonly historyService: HistoryService,\n    private readonly partialService: PartialService,\n    private readonly aiService: AIService,\n    private readonly initStateManager: InitStateManager,\n    private readonly extensionMetadata: ExtensionMetadataService,\n    private readonly backgroundProcessManager: BackgroundProcessManager,\n    private readonly sessionUsageService: SessionUsageService,\n    private readonly costTrackingService: CostTrackingService,\n    private readonly policyService?: PolicyService,\n    telemetryService?: TelemetryService,\n    experimentsService?: ExperimentsService,\n    sessionTimingService?: SessionTimingService\n  ) {\n    super();\n    this.policyService = policyService;\n    this.sessionUsageService = sessionUsageService;\n    this.telemetryService = telemetryService;\n    this.experimentsService = experimentsService;\n    this.sessionTimingService = sessionTimingService;\n    this.setupMetadataListeners();\n    this.setupInitMetadataListeners();\n  }\n\n  private readonly telemetryService?: TelemetryService;\n  private readonly experimentsService?: ExperimentsService;\n  private mcpServerManager?: MCPServerManager;\n  // Optional terminal service for cleanup on workspace removal\n  private terminalService?: TerminalService;\n  private readonly sessionTimingService?: SessionTimingService;\n  private workspaceLifecycleHooks?: WorkspaceLifecycleHooks;\n  private taskService?: TaskService;\n\n  /**\n   * Set the MCP server manager for tool access.\n   * Called after construction due to circular dependency.\n   */\n  setMCPServerManager(manager: MCPServerManager): void {\n    this.mcpServerManager = manager;\n  }\n\n  /**\n   * Set the terminal service for cleanup on workspace removal.\n   */\n  setTerminalService(terminalService: TerminalService): void {\n    this.terminalService = terminalService;\n  }\n\n  setWorkspaceLifecycleHooks(hooks: WorkspaceLifecycleHooks): void {\n    this.workspaceLifecycleHooks = hooks;\n  }\n\n  /**\n   * Set the task service for auto-resume counter resets.\n   * Called after construction due to circular dependency.\n   */\n  setTaskService(taskService: TaskService): void {\n    this.taskService = taskService;\n  }\n\n  /**\n   * DEBUG ONLY: Trigger an artificial stream error for testing.\n   * This is used by integration tests to simulate network errors mid-stream.\n   * @returns true if an active stream was found and error was triggered\n   */\n  debugTriggerStreamError(workspaceId: string, errorMessage?: string): Promise<boolean> {\n    return this.aiService.debugTriggerStreamError(workspaceId, errorMessage);\n  }\n\n  /**\n   * Setup listeners to update metadata store based on AIService events.\n   * This tracks workspace recency and streaming status for VS Code extension integration.\n   */\n  private setupMetadataListeners(): void {\n    const isObj = (v: unknown): v is Record<string, unknown> => typeof v === \"object\" && v !== null;\n    const isWorkspaceEvent = (v: unknown): v is { workspaceId: string } =>\n      isObj(v) && \"workspaceId\" in v && typeof v.workspaceId === \"string\";\n    const isStreamStartEvent = (\n      v: unknown\n    ): v is { workspaceId: string; model: string; agentId?: string } =>\n      isWorkspaceEvent(v) && \"model\" in v && typeof v.model === \"string\";\n    const isStreamEndEvent = (v: unknown): v is StreamEndEvent =>\n      isWorkspaceEvent(v) &&\n      (!(\"metadata\" in (v as Record<string, unknown>)) || isObj((v as StreamEndEvent).metadata));\n    const isStreamAbortEvent = (v: unknown): v is StreamAbortEvent => isWorkspaceEvent(v);\n    const extractTimestamp = (event: StreamEndEvent | { metadata?: { timestamp?: number } }) => {\n      const raw = event.metadata?.timestamp;\n      return typeof raw === \"number\" && Number.isFinite(raw) ? raw : Date.now();\n    };\n\n    // Update streaming status and recency on stream start\n    this.aiService.on(\"stream-start\", (data: unknown) => {\n      if (isStreamStartEvent(data)) {\n        void this.updateStreamingStatus(data.workspaceId, true, data.model, data.agentId);\n      }\n    });\n\n    this.aiService.on(\"stream-end\", (data: unknown) => {\n      if (isStreamEndEvent(data)) {\n        void this.handleStreamCompletion(data.workspaceId, extractTimestamp(data));\n      }\n    });\n\n    this.aiService.on(\"stream-abort\", (data: unknown) => {\n      if (isStreamAbortEvent(data)) {\n        void this.updateStreamingStatus(data.workspaceId, false);\n      }\n    });\n  }\n\n  private setupInitMetadataListeners(): void {\n    const isObj = (v: unknown): v is Record<string, unknown> => typeof v === \"object\" && v !== null;\n    const isWorkspaceEvent = (v: unknown): v is { workspaceId: string } =>\n      isObj(v) && \"workspaceId\" in v && typeof v.workspaceId === \"string\";\n\n    // When init completes, refresh metadata so the UI can clear isInitializing and swap\n    // \"Cancel creation\" back to the normal archive affordance.\n    this.initStateManager.on(\"init-end\", (event: unknown) => {\n      if (!isWorkspaceEvent(event)) {\n        return;\n      }\n      void this.refreshAndEmitMetadata(event.workspaceId);\n    });\n  }\n\n  private emitWorkspaceActivity(\n    workspaceId: string,\n    snapshot: WorkspaceActivitySnapshot | null\n  ): void {\n    this.emit(\"activity\", { workspaceId, activity: snapshot });\n  }\n\n  private async updateRecencyTimestamp(workspaceId: string, timestamp?: number): Promise<void> {\n    try {\n      const snapshot = await this.extensionMetadata.updateRecency(\n        workspaceId,\n        timestamp ?? Date.now()\n      );\n      this.emitWorkspaceActivity(workspaceId, snapshot);\n    } catch (error) {\n      log.error(\"Failed to update workspace recency\", { workspaceId, error });\n    }\n  }\n\n  private async updateStreamingStatus(\n    workspaceId: string,\n    streaming: boolean,\n    model?: string,\n    agentId?: string\n  ): Promise<void> {\n    try {\n      let thinkingLevel: WorkspaceAISettings[\"thinkingLevel\"] | undefined;\n      if (model) {\n        const found = this.config.findWorkspace(workspaceId);\n        if (found) {\n          const config = this.config.loadConfigOrDefault();\n          const project = config.projects.get(found.projectPath);\n          const workspace =\n            project?.workspaces.find((w) => w.id === workspaceId) ??\n            project?.workspaces.find((w) => w.path === found.workspacePath);\n          const normalizedAgentId =\n            typeof agentId === \"string\" && agentId.trim().length > 0\n              ? agentId.trim().toLowerCase()\n              : WORKSPACE_DEFAULTS.agentId;\n          const aiSettings =\n            workspace?.aiSettingsByAgent?.[normalizedAgentId] ?? workspace?.aiSettings;\n          thinkingLevel = aiSettings?.thinkingLevel;\n        }\n      }\n      const snapshot = await this.extensionMetadata.setStreaming(\n        workspaceId,\n        streaming,\n        model,\n        thinkingLevel\n      );\n      this.emitWorkspaceActivity(workspaceId, snapshot);\n    } catch (error) {\n      log.error(\"Failed to update workspace streaming status\", { workspaceId, error });\n    }\n  }\n\n  private async handleStreamCompletion(workspaceId: string, timestamp: number): Promise<void> {\n    await this.updateRecencyTimestamp(workspaceId, timestamp);\n    await this.updateStreamingStatus(workspaceId, false);\n  }\n\n  private createInitLogger(workspaceId: string) {\n    const hasInitState = () => this.initStateManager.getInitState(workspaceId) !== undefined;\n\n    return {\n      logStep: (message: string) => {\n        if (!hasInitState()) {\n          return;\n        }\n        this.initStateManager.appendOutput(workspaceId, message, false);\n      },\n      logStdout: (line: string) => {\n        if (!hasInitState()) {\n          return;\n        }\n        this.initStateManager.appendOutput(workspaceId, line, false);\n      },\n      logStderr: (line: string) => {\n        if (!hasInitState()) {\n          return;\n        }\n        this.initStateManager.appendOutput(workspaceId, line, true);\n      },\n      logComplete: (exitCode: number) => {\n        this.initAbortControllers.delete(workspaceId);\n\n        // WorkspaceService.remove() clears in-memory init state early so waiters/tools can bail out.\n        // If init completes after deletion, avoid noisy logs (endInit() would report missing state).\n        if (!hasInitState()) {\n          return;\n        }\n\n        void this.initStateManager.endInit(workspaceId, exitCode);\n      },\n      enterHookPhase: () => {\n        if (!hasInitState()) {\n          return;\n        }\n        this.initStateManager.enterHookPhase(workspaceId);\n      },\n    };\n  }\n\n  private schedulePostCompactionMetadataRefresh(workspaceId: string): void {\n    assert(typeof workspaceId === \"string\", \"workspaceId must be a string\");\n    const trimmed = workspaceId.trim();\n    assert(trimmed.length > 0, \"workspaceId must not be empty\");\n\n    const existing = this.postCompactionRefreshTimers.get(trimmed);\n    if (existing) {\n      clearTimeout(existing);\n    }\n\n    const timer = setTimeout(() => {\n      this.postCompactionRefreshTimers.delete(trimmed);\n      void this.emitPostCompactionMetadata(trimmed);\n    }, POST_COMPACTION_METADATA_REFRESH_DEBOUNCE_MS);\n\n    this.postCompactionRefreshTimers.set(trimmed, timer);\n  }\n\n  private async emitPostCompactionMetadata(workspaceId: string): Promise<void> {\n    try {\n      const session = this.sessions.get(workspaceId);\n      if (!session) {\n        return;\n      }\n\n      const metadata = await this.getInfo(workspaceId);\n      if (!metadata) {\n        return;\n      }\n\n      const postCompaction = await this.getPostCompactionState(workspaceId);\n      const enrichedMetadata = { ...metadata, postCompaction };\n      session.emitMetadata(enrichedMetadata);\n    } catch (error) {\n      // Workspace runtime unavailable (e.g., SSH unreachable) - skip emitting post-compaction state.\n      log.debug(\"Failed to emit post-compaction metadata\", { workspaceId, error });\n    }\n  }\n\n  public getOrCreateSession(workspaceId: string): AgentSession {\n    assert(typeof workspaceId === \"string\", \"workspaceId must be a string\");\n    const trimmed = workspaceId.trim();\n    assert(trimmed.length > 0, \"workspaceId must not be empty\");\n\n    let session = this.sessions.get(trimmed);\n    if (session) {\n      return session;\n    }\n\n    session = new AgentSession({\n      workspaceId: trimmed,\n      config: this.config,\n      historyService: this.historyService,\n      partialService: this.partialService,\n      aiService: this.aiService,\n      telemetryService: this.telemetryService,\n      initStateManager: this.initStateManager,\n      backgroundProcessManager: this.backgroundProcessManager,\n      costTrackingService: this.costTrackingService,\n      onCompactionComplete: () => {\n        this.schedulePostCompactionMetadataRefresh(trimmed);\n      },\n      onPostCompactionStateChange: () => {\n        this.schedulePostCompactionMetadataRefresh(trimmed);\n      },\n    });\n\n    const chatUnsubscribe = session.onChatEvent((event) => {\n      this.emit(\"chat\", { workspaceId: event.workspaceId, message: event.message });\n    });\n\n    const metadataUnsubscribe = session.onMetadataEvent((event) => {\n      this.emit(\"metadata\", {\n        workspaceId: event.workspaceId,\n        metadata: event.metadata!,\n      });\n    });\n\n    this.sessions.set(trimmed, session);\n    this.sessionSubscriptions.set(trimmed, {\n      chat: chatUnsubscribe,\n      metadata: metadataUnsubscribe,\n    });\n\n    return session;\n  }\n\n  /**\n   * Register an externally-created AgentSession so that WorkspaceService\n   * operations (sendMessage, resumeStream, remove, etc.) reuse it instead of\n   * creating a duplicate. Used by `mux run` CLI to keep a single session\n   * instance for the parent workspace.\n   */\n  public registerSession(workspaceId: string, session: AgentSession): void {\n    workspaceId = workspaceId.trim();\n    assert(workspaceId.length > 0, \"workspaceId must not be empty\");\n    assert(!this.sessions.has(workspaceId), `session already registered for ${workspaceId}`);\n\n    this.sessions.set(workspaceId, session);\n\n    const chatUnsubscribe = session.onChatEvent((event) => {\n      this.emit(\"chat\", { workspaceId: event.workspaceId, message: event.message });\n    });\n\n    const metadataUnsubscribe = session.onMetadataEvent((event) => {\n      this.emit(\"metadata\", {\n        workspaceId: event.workspaceId,\n        metadata: event.metadata!,\n      });\n    });\n\n    this.sessionSubscriptions.set(workspaceId, {\n      chat: chatUnsubscribe,\n      metadata: metadataUnsubscribe,\n    });\n  }\n\n  public disposeSession(workspaceId: string): void {\n    const trimmed = workspaceId.trim();\n    const session = this.sessions.get(trimmed);\n    const refreshTimer = this.postCompactionRefreshTimers.get(trimmed);\n    if (refreshTimer) {\n      clearTimeout(refreshTimer);\n      this.postCompactionRefreshTimers.delete(trimmed);\n    }\n\n    if (!session) {\n      return;\n    }\n\n    const subscriptions = this.sessionSubscriptions.get(trimmed);\n    if (subscriptions) {\n      subscriptions.chat();\n      subscriptions.metadata();\n      this.sessionSubscriptions.delete(trimmed);\n    }\n\n    session.dispose();\n    this.sessions.delete(trimmed);\n  }\n\n  private async getPersistedPostCompactionDiffPaths(workspaceId: string): Promise<string[] | null> {\n    const postCompactionPath = path.join(\n      this.config.getSessionDir(workspaceId),\n      \"post-compaction.json\"\n    );\n\n    try {\n      const raw = await fsPromises.readFile(postCompactionPath, \"utf-8\");\n      const parsed: unknown = JSON.parse(raw);\n      const diffsRaw = (parsed as { diffs?: unknown }).diffs;\n      if (!Array.isArray(diffsRaw)) {\n        return null;\n      }\n\n      const result: string[] = [];\n      for (const diff of diffsRaw) {\n        if (!diff || typeof diff !== \"object\") continue;\n        const p = (diff as { path?: unknown }).path;\n        if (typeof p !== \"string\") continue;\n        const trimmed = p.trim();\n        if (trimmed.length === 0) continue;\n        result.push(trimmed);\n      }\n\n      return result;\n    } catch {\n      return null;\n    }\n  }\n\n  /**\n   * Get post-compaction context state for a workspace.\n   * Returns info about what will be injected after compaction.\n   * Prefers cached paths from pending compaction, falls back to history extraction.\n   */\n  public async getPostCompactionState(workspaceId: string): Promise<{\n    planPath: string | null;\n    trackedFilePaths: string[];\n    excludedItems: string[];\n  }> {\n    // Get workspace metadata to create runtime for plan file check\n    const metadata = await this.getInfo(workspaceId);\n    if (!metadata) {\n      // Can't get metadata, return empty state\n      const exclusions = await this.getPostCompactionExclusions(workspaceId);\n      return { planPath: null, trackedFilePaths: [], excludedItems: exclusions.excludedItems };\n    }\n\n    const runtime = createRuntimeForWorkspace(metadata);\n    const muxHome = runtime.getMuxHome();\n    const planPath = getPlanFilePath(metadata.name, metadata.projectName, muxHome);\n    // For local/SSH: expand tilde for comparison with message history paths\n    // For Docker: paths are already absolute (/var/mux/...), no expansion needed\n    const expandedPlanPath = muxHome.startsWith(\"~\") ? expandTilde(planPath) : planPath;\n    // Legacy plan path (stored by workspace ID) for filtering\n    const legacyPlanPath = getLegacyPlanFilePath(workspaceId);\n    const expandedLegacyPlanPath = expandTilde(legacyPlanPath);\n\n    // Check both new and legacy plan paths, prefer new path\n    const newPlanExists = await fileExists(runtime, planPath);\n    const legacyPlanExists = !newPlanExists && (await fileExists(runtime, legacyPlanPath));\n    // Resolve plan path via runtime to get correct absolute path for deep links.\n    // Local: expands ~ to local home. SSH: expands ~ on remote host.\n    const activePlanPath = newPlanExists\n      ? await runtime.resolvePath(planPath)\n      : legacyPlanExists\n        ? await runtime.resolvePath(legacyPlanPath)\n        : null;\n\n    // Load exclusions\n    const exclusions = await this.getPostCompactionExclusions(workspaceId);\n\n    // Helper to check if a path is a plan file (new or legacy format)\n    const isPlanPath = (p: string) =>\n      p === planPath ||\n      p === expandedPlanPath ||\n      p === legacyPlanPath ||\n      p === expandedLegacyPlanPath;\n\n    // If session has pending compaction attachments, use cached paths\n    // (history is cleared after compaction, but cache survives)\n    const session = this.sessions.get(workspaceId);\n    const pendingPaths = session?.getPendingTrackedFilePaths();\n    if (pendingPaths) {\n      // Filter out both new and legacy plan file paths\n      const trackedFilePaths = pendingPaths.filter((p) => !isPlanPath(p));\n      return {\n        planPath: activePlanPath,\n        trackedFilePaths,\n        excludedItems: exclusions.excludedItems,\n      };\n    }\n\n    // Fallback (crash-safe): if a post-compaction snapshot exists on disk, use it.\n    const persistedPaths = await this.getPersistedPostCompactionDiffPaths(workspaceId);\n    if (persistedPaths !== null) {\n      const trackedFilePaths = persistedPaths.filter((p) => !isPlanPath(p));\n      return {\n        planPath: activePlanPath,\n        trackedFilePaths,\n        excludedItems: exclusions.excludedItems,\n      };\n    }\n\n    // Fallback: compute tracked files from message history (survives reloads).\n    // Only the current compaction epoch matters  post-compaction files are from\n    // the active epoch only.\n    const historyResult = await this.historyService.getHistoryFromLatestBoundary(workspaceId);\n    const messages = historyResult.success ? historyResult.data : [];\n    const allPaths = extractEditedFilePaths(messages);\n\n    // Exclude plan file from tracked files since it has its own section\n    // Filter out both new and legacy plan file paths\n    const trackedFilePaths = allPaths.filter((p) => !isPlanPath(p));\n    return {\n      planPath: activePlanPath,\n      trackedFilePaths,\n      excludedItems: exclusions.excludedItems,\n    };\n  }\n\n  /**\n   * Get post-compaction exclusions for a workspace.\n   * Returns empty exclusions if file doesn't exist.\n   */\n  public async getPostCompactionExclusions(workspaceId: string): Promise<PostCompactionExclusions> {\n    const exclusionsPath = path.join(this.config.getSessionDir(workspaceId), \"exclusions.json\");\n    try {\n      const data = await fsPromises.readFile(exclusionsPath, \"utf-8\");\n      return JSON.parse(data) as PostCompactionExclusions;\n    } catch {\n      return { excludedItems: [] };\n    }\n  }\n\n  /**\n   * Set whether an item is excluded from post-compaction context.\n   * Item IDs: \"plan\" for plan file, \"file:<path>\" for tracked files.\n   */\n  public async setPostCompactionExclusion(\n    workspaceId: string,\n    itemId: string,\n    excluded: boolean\n  ): Promise<Result<void>> {\n    try {\n      const exclusions = await this.getPostCompactionExclusions(workspaceId);\n      const set = new Set(exclusions.excludedItems);\n\n      if (excluded) {\n        set.add(itemId);\n      } else {\n        set.delete(itemId);\n      }\n\n      const sessionDir = this.config.getSessionDir(workspaceId);\n      await fsPromises.mkdir(sessionDir, { recursive: true });\n      const exclusionsPath = path.join(sessionDir, \"exclusions.json\");\n      await fsPromises.writeFile(\n        exclusionsPath,\n        JSON.stringify({ excludedItems: [...set] }, null, 2)\n      );\n      return Ok(undefined);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to set exclusion: ${message}`);\n    }\n  }\n\n  async create(\n    projectPath: string,\n    branchName: string,\n    trunkBranch: string | undefined,\n    title?: string,\n    runtimeConfig?: RuntimeConfig,\n    sectionId?: string\n  ): Promise<Result<{ metadata: FrontendWorkspaceMetadata }>> {\n    // Chat with Mux is a built-in system workspace; it cannot host additional workspaces.\n    if (projectPath === getMuxHelpChatProjectPath(this.config.rootDir)) {\n      return Err(\"Cannot create workspaces in the Chat with Mux system project\");\n    }\n\n    // Validate workspace name\n    const validation = validateWorkspaceName(branchName);\n    if (!validation.valid) {\n      return Err(validation.error ?? \"Invalid workspace name\");\n    }\n\n    // Generate stable workspace ID\n    const workspaceId = this.config.generateStableId();\n\n    // Create runtime for workspace creation\n    // Default to worktree runtime for backward compatibility\n    let finalRuntimeConfig: RuntimeConfig = runtimeConfig ?? {\n      type: \"worktree\",\n      srcBaseDir: this.config.srcDir,\n    };\n\n    if (this.policyService?.isEnforced()) {\n      if (!this.policyService.isRuntimeAllowed(finalRuntimeConfig)) {\n        return Err(\"Selected runtime is not allowed by policy\");\n      }\n    }\n\n    // Local runtime doesn't need a trunk branch; worktree/SSH runtimes require it\n    const isLocalRuntime = finalRuntimeConfig.type === \"local\";\n    const normalizedTrunkBranch = trunkBranch?.trim() ?? \"\";\n    if (!isLocalRuntime && normalizedTrunkBranch.length === 0) {\n      return Err(\"Trunk branch is required for worktree and SSH runtimes\");\n    }\n\n    let runtime;\n    try {\n      runtime = createRuntime(finalRuntimeConfig, { projectPath });\n\n      // Resolve srcBaseDir path if the config has one.\n      // Skip if runtime has deferredRuntimeAccess flag (runtime doesn't exist yet, e.g., Coder).\n      const srcBaseDir = getSrcBaseDir(finalRuntimeConfig);\n      if (srcBaseDir && !runtime.createFlags?.deferredRuntimeAccess) {\n        const resolvedSrcBaseDir = await runtime.resolvePath(srcBaseDir);\n        if (resolvedSrcBaseDir !== srcBaseDir && hasSrcBaseDir(finalRuntimeConfig)) {\n          finalRuntimeConfig = {\n            ...finalRuntimeConfig,\n            srcBaseDir: resolvedSrcBaseDir,\n          };\n          runtime = createRuntime(finalRuntimeConfig, { projectPath });\n        }\n      }\n    } catch (error) {\n      const errorMsg = error instanceof Error ? error.message : String(error);\n      return Err(errorMsg);\n    }\n\n    const session = this.getOrCreateSession(workspaceId);\n    this.initStateManager.startInit(workspaceId, projectPath);\n\n    // Create abort controller immediately so workspace lifecycle operations (e.g., cancel/remove)\n    // can reliably interrupt init even if the UI deletes the workspace during create().\n    const initAbortController = new AbortController();\n    this.initAbortControllers.set(workspaceId, initAbortController);\n\n    const initLogger = this.createInitLogger(workspaceId);\n\n    try {\n      // Create workspace with automatic collision retry\n      let finalBranchName = branchName;\n      let createResult: { success: boolean; workspacePath?: string; error?: string };\n\n      // If runtime uses config-level collision detection (e.g., Coder - can't reach host),\n      // check against existing workspace names before createWorkspace.\n      if (runtime.createFlags?.configLevelCollisionDetection) {\n        const existingNames = new Set(\n          (this.config.loadConfigOrDefault().projects.get(projectPath)?.workspaces ?? []).map(\n            (w) => w.name\n          )\n        );\n        for (\n          let i = 0;\n          i < MAX_WORKSPACE_NAME_COLLISION_RETRIES && existingNames.has(finalBranchName);\n          i++\n        ) {\n          log.debug(`Workspace name collision for \"${finalBranchName}\", adding suffix`);\n          finalBranchName = appendCollisionSuffix(branchName);\n        }\n      }\n\n      for (let attempt = 0; attempt <= MAX_WORKSPACE_NAME_COLLISION_RETRIES; attempt++) {\n        createResult = await runtime.createWorkspace({\n          projectPath,\n          branchName: finalBranchName,\n          trunkBranch: normalizedTrunkBranch,\n          directoryName: finalBranchName,\n          initLogger,\n          abortSignal: initAbortController.signal,\n        });\n\n        if (createResult.success) break;\n\n        // If collision and not last attempt, retry with suffix\n        if (\n          isWorkspaceNameCollision(createResult.error) &&\n          attempt < MAX_WORKSPACE_NAME_COLLISION_RETRIES\n        ) {\n          log.debug(`Workspace name collision for \"${finalBranchName}\", retrying with suffix`);\n          finalBranchName = appendCollisionSuffix(branchName);\n          continue;\n        }\n        break;\n      }\n\n      if (!createResult!.success || !createResult!.workspacePath) {\n        initLogger.logComplete(-1);\n        return Err(createResult!.error ?? \"Failed to create workspace\");\n      }\n\n      // Let runtime finalize config (e.g., derive names, compute host) after collision handling\n      if (runtime.finalizeConfig) {\n        const finalizeResult = await runtime.finalizeConfig(finalBranchName, finalRuntimeConfig);\n        if (!finalizeResult.success) {\n          initLogger.logComplete(-1);\n          return Err(finalizeResult.error);\n        }\n        finalRuntimeConfig = finalizeResult.data;\n        runtime = createRuntime(finalRuntimeConfig, { projectPath });\n      }\n\n      // Let runtime validate before persisting (e.g., external collision checks)\n      if (runtime.validateBeforePersist) {\n        const validateResult = await runtime.validateBeforePersist(\n          finalBranchName,\n          finalRuntimeConfig\n        );\n        if (!validateResult.success) {\n          initLogger.logComplete(-1);\n          return Err(validateResult.error);\n        }\n      }\n\n      const projectName =\n        projectPath.split(\"/\").pop() ?? projectPath.split(\"\\\\\").pop() ?? \"unknown\";\n\n      const metadata = {\n        id: workspaceId,\n        name: finalBranchName,\n        title,\n        projectName,\n        projectPath,\n        createdAt: new Date().toISOString(),\n      };\n\n      await this.config.editConfig((config) => {\n        let projectConfig = config.projects.get(projectPath);\n        if (!projectConfig) {\n          projectConfig = { workspaces: [] };\n          config.projects.set(projectPath, projectConfig);\n        }\n        projectConfig.workspaces.push({\n          path: createResult!.workspacePath!,\n          id: workspaceId,\n          name: finalBranchName,\n          title,\n          createdAt: metadata.createdAt,\n          runtimeConfig: finalRuntimeConfig,\n          sectionId,\n        });\n        return config;\n      });\n\n      const allMetadata = await this.config.getAllWorkspaceMetadata();\n      const completeMetadata = allMetadata.find((m) => m.id === workspaceId);\n      if (!completeMetadata) {\n        initLogger.logComplete(-1);\n        return Err(\"Failed to retrieve workspace metadata\");\n      }\n\n      session.emitMetadata(this.enrichFrontendMetadata(completeMetadata));\n\n      // Background init: run postCreateSetup (if present) then initWorkspace\n      const secrets = secretsToRecord(this.config.getEffectiveSecrets(projectPath));\n      // Background init: postCreateSetup (provisioning) + initWorkspace (sync/checkout/hook)\n      //\n      // If the user cancelled creation while create() was still in flight, avoid spawning\n      // additional background work for a workspace that's already being removed.\n      if (!this.removingWorkspaces.has(workspaceId) && !initAbortController.signal.aborted) {\n        runBackgroundInit(\n          runtime,\n          {\n            projectPath,\n            branchName: finalBranchName,\n            trunkBranch: normalizedTrunkBranch,\n            workspacePath: createResult!.workspacePath,\n            initLogger,\n            env: secrets,\n            abortSignal: initAbortController.signal,\n          },\n          workspaceId,\n          log\n        );\n      } else {\n        initAbortController.abort();\n        this.initAbortControllers.delete(workspaceId);\n\n        // Background init will never run, so init-end wont fire.\n        // Clear init state + re-emit metadata so the sidebar doesnt stay stuck on isInitializing.\n        this.initStateManager.clearInMemoryState(workspaceId);\n        session.emitMetadata(this.enrichFrontendMetadata(completeMetadata));\n      }\n\n      return Ok({ metadata: this.enrichFrontendMetadata(completeMetadata) });\n    } catch (error) {\n      initLogger.logComplete(-1);\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to create workspace: ${message}`);\n    }\n  }\n\n  async remove(workspaceId: string, force = false): Promise<Result<void>> {\n    if (workspaceId === MUX_HELP_CHAT_WORKSPACE_ID) {\n      return Err(\"Cannot remove the Chat with Mux system workspace\");\n    }\n\n    // Idempotent: if already removing, return success to prevent race conditions\n    if (this.removingWorkspaces.has(workspaceId)) {\n      return Ok(undefined);\n    }\n    this.removingWorkspaces.add(workspaceId);\n\n    // If this workspace is mid-init, cancel the fire-and-forget init work (postCreateSetup,\n    // sync/checkout, .mux/init hook, etc.) so removal doesn't leave orphaned background work.\n    const initAbortController = this.initAbortControllers.get(workspaceId);\n    if (initAbortController) {\n      initAbortController.abort();\n      this.initAbortControllers.delete(workspaceId);\n    }\n\n    // Try to remove from runtime (filesystem)\n    try {\n      // Stop any active stream before deleting metadata/config to avoid tool calls racing with removal.\n      //\n      // IMPORTANT: AIService forwards \"stream-abort\" asynchronously after partial cleanup. If we roll up\n      // session timing (or delete session files) immediately after stopStream(), we can race the final\n      // abort timing write.\n      const wasStreaming = this.aiService.isStreaming(workspaceId);\n      const streamStoppedEvent: Promise<\"abort\" | \"end\" | undefined> | undefined = wasStreaming\n        ? new Promise((resolve) => {\n            const aiService = this.aiService;\n            const targetWorkspaceId = workspaceId;\n            const timeoutMs = 5000;\n\n            let settled = false;\n            let timer: ReturnType<typeof setTimeout> | undefined;\n\n            const cleanup = (result: \"abort\" | \"end\" | undefined) => {\n              if (settled) return;\n              settled = true;\n              if (timer) {\n                clearTimeout(timer);\n                timer = undefined;\n              }\n              aiService.off(\"stream-abort\", onAbort);\n              aiService.off(\"stream-end\", onEnd);\n              resolve(result);\n            };\n\n            function onAbort(data: StreamAbortEvent): void {\n              if (data.workspaceId !== targetWorkspaceId) return;\n              cleanup(\"abort\");\n            }\n\n            function onEnd(data: StreamEndEvent): void {\n              if (data.workspaceId !== targetWorkspaceId) return;\n              cleanup(\"end\");\n            }\n\n            aiService.on(\"stream-abort\", onAbort);\n            aiService.on(\"stream-end\", onEnd);\n\n            timer = setTimeout(() => cleanup(undefined), timeoutMs);\n          })\n        : undefined;\n\n      try {\n        const stopResult = await this.aiService.stopStream(workspaceId, { abandonPartial: true });\n        if (!stopResult.success) {\n          log.debug(\"Failed to stop stream during workspace removal\", {\n            workspaceId,\n            error: stopResult.error,\n          });\n        }\n      } catch (error: unknown) {\n        log.debug(\"Failed to stop stream during workspace removal (threw)\", { workspaceId, error });\n      }\n\n      if (streamStoppedEvent) {\n        const stopEvent = await streamStoppedEvent;\n        if (!stopEvent) {\n          log.debug(\"Timed out waiting for stream to stop during workspace removal\", {\n            workspaceId,\n          });\n        }\n\n        // If session timing is enabled, make sure no pending writes can recreate session files after\n        // we delete the session directory.\n        if (this.sessionTimingService) {\n          await this.sessionTimingService.waitForIdle(workspaceId);\n        }\n      }\n\n      let parentWorkspaceId: string | null = null;\n      let childTaskModelString: string | undefined;\n      let childTaskThinkingLevel: ThinkingLevel | undefined;\n\n      const metadataResult = await this.aiService.getWorkspaceMetadata(workspaceId);\n      if (metadataResult.success) {\n        const metadata = metadataResult.data;\n        const projectPath = metadata.projectPath;\n\n        const runtime = createRuntime(metadata.runtimeConfig, {\n          projectPath,\n          workspaceName: metadata.name,\n        });\n\n        // Delete workspace from runtime first - if this fails with force=false, we abort\n        // and keep workspace in config so user can retry. This prevents orphaned directories.\n        const deleteResult = await runtime.deleteWorkspace(\n          projectPath,\n          metadata.name, // use branch name\n          force\n        );\n\n        if (!deleteResult.success) {\n          // If force is true, we continue to remove from config even if fs removal failed\n          if (!force) {\n            return Err(deleteResult.error ?? \"Failed to delete workspace from disk\");\n          }\n          log.error(\n            `Failed to delete workspace from disk, but force=true. Removing from config. Error: ${deleteResult.error}`\n          );\n        }\n\n        // Note: Coder workspace deletion is handled by CoderSSHRuntime.deleteWorkspace()\n\n        parentWorkspaceId = metadata.parentWorkspaceId ?? null;\n        childTaskModelString = metadata.taskModelString;\n        childTaskThinkingLevel = coerceThinkingLevel(metadata.taskThinkingLevel);\n\n        // If this workspace is a sub-agent/task, roll its accumulated timing into the parent BEFORE\n        // deleting ~/.mux/sessions/<workspaceId>/session-timing.json.\n        if (parentWorkspaceId && this.sessionTimingService) {\n          try {\n            // Flush any last timing write (e.g. from stream-abort) before reading.\n            await this.sessionTimingService.waitForIdle(workspaceId);\n            await this.sessionTimingService.rollUpTimingIntoParent(parentWorkspaceId, workspaceId);\n          } catch (error: unknown) {\n            log.error(\"Failed to roll up child session timing into parent\", {\n              workspaceId,\n              parentWorkspaceId,\n              error: error instanceof Error ? error.message : String(error),\n            });\n          }\n        }\n\n        // If this workspace is a sub-agent/task, roll its accumulated usage into the parent BEFORE\n        // deleting ~/.mux/sessions/<workspaceId>/session-usage.json.\n        if (parentWorkspaceId && this.sessionUsageService) {\n          try {\n            const childUsage = await this.sessionUsageService.getSessionUsage(workspaceId);\n            if (childUsage && Object.keys(childUsage.byModel).length > 0) {\n              const rollup = await this.sessionUsageService.rollUpUsageIntoParent(\n                parentWorkspaceId,\n                workspaceId,\n                childUsage.byModel\n              );\n\n              if (rollup.didRollUp) {\n                // Live UI update (best-effort): only emit if the parent session is already active.\n                this.sessions.get(parentWorkspaceId)?.emitChatEvent({\n                  type: \"session-usage-delta\",\n                  workspaceId: parentWorkspaceId,\n                  sourceWorkspaceId: workspaceId,\n                  byModelDelta: childUsage.byModel,\n                  timestamp: Date.now(),\n                });\n              }\n            }\n          } catch (error: unknown) {\n            log.error(\"Failed to roll up child session usage into parent\", {\n              workspaceId,\n              parentWorkspaceId,\n              error: error instanceof Error ? error.message : String(error),\n            });\n          }\n        }\n      } else {\n        log.error(`Could not find metadata for workspace ${workspaceId}, creating phantom cleanup`);\n      }\n\n      // Avoid leaking init waiters/logs after workspace deletion.\n      // Must happen before deleting the session directory so queued init-status writes don't\n      // recreate ~/.mux/sessions/<workspaceId>/ after removal.\n      //\n      // Intentionally deferred until we're committed to removal: if runtime deletion fails with\n      // force=false we return early and keep init state intact so init-end can refresh metadata.\n      this.initStateManager.clearInMemoryState(workspaceId);\n      // Remove session data\n      try {\n        const sessionDir = this.config.getSessionDir(workspaceId);\n\n        if (parentWorkspaceId) {\n          try {\n            const parentSessionDir = this.config.getSessionDir(parentWorkspaceId);\n            await archiveChildSessionArtifactsIntoParentSessionDir({\n              parentWorkspaceId,\n              parentSessionDir,\n              childWorkspaceId: workspaceId,\n              childSessionDir: sessionDir,\n              childTaskModelString,\n              childTaskThinkingLevel,\n            });\n          } catch (error: unknown) {\n            log.error(\"Failed to roll up child session artifacts into parent\", {\n              workspaceId,\n              parentWorkspaceId,\n              error: error instanceof Error ? error.message : String(error),\n            });\n          }\n        }\n\n        await fsPromises.rm(sessionDir, { recursive: true, force: true });\n      } catch (error) {\n        log.error(`Failed to remove session directory for ${workspaceId}:`, error);\n      }\n\n      // Stop MCP servers for this workspace\n      if (this.mcpServerManager) {\n        await this.mcpServerManager.stopServers(workspaceId);\n      }\n\n      // Dispose session\n      this.disposeSession(workspaceId);\n\n      // Close any terminal sessions for this workspace\n      this.terminalService?.closeWorkspaceSessions(workspaceId);\n\n      // Remove from config\n      await this.config.removeWorkspace(workspaceId);\n\n      this.emit(\"metadata\", { workspaceId, metadata: null });\n\n      return Ok(undefined);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to remove workspace: ${message}`);\n    } finally {\n      this.removingWorkspaces.delete(workspaceId);\n    }\n  }\n\n  private enrichFrontendMetadata(metadata: FrontendWorkspaceMetadata): FrontendWorkspaceMetadata {\n    const isInitializing =\n      this.initStateManager.getInitState(metadata.id)?.status === \"running\" || undefined;\n    return {\n      ...metadata,\n      isRemoving: this.removingWorkspaces.has(metadata.id) || undefined,\n      isInitializing,\n    };\n  }\n\n  private enrichMaybeFrontendMetadata(\n    metadata: FrontendWorkspaceMetadata | null\n  ): FrontendWorkspaceMetadata | null {\n    if (!metadata) {\n      return null;\n    }\n    return this.enrichFrontendMetadata(metadata);\n  }\n\n  async list(): Promise<FrontendWorkspaceMetadata[]> {\n    try {\n      const workspaces = await this.config.getAllWorkspaceMetadata();\n      return workspaces.map((w) => this.enrichFrontendMetadata(w));\n    } catch (error) {\n      log.error(\"Failed to list workspaces:\", error);\n      return [];\n    }\n  }\n\n  /**\n   * Get devcontainer info for deep link generation.\n   * Returns null if not a devcontainer workspace or container is not running.\n   *\n   * This queries Docker for the container name (on-demand discovery) and\n   * calls ensureReady to get the container workspace path.\n   */\n  async getDevcontainerInfo(workspaceId: string): Promise<{\n    containerName: string;\n    containerWorkspacePath: string;\n    hostWorkspacePath: string;\n  } | null> {\n    const metadata = await this.getInfo(workspaceId);\n    if (metadata?.runtimeConfig?.type !== \"devcontainer\") {\n      return null;\n    }\n\n    const workspace = this.config.findWorkspace(workspaceId);\n    if (!workspace) {\n      return null;\n    }\n\n    // Get the host workspace path\n    const runtimeConfig = metadata.runtimeConfig;\n    const runtime = createRuntime(runtimeConfig, {\n      projectPath: metadata.projectPath,\n      workspaceName: metadata.name,\n    });\n\n    const hostWorkspacePath = runtime.getWorkspacePath(metadata.projectPath, metadata.name);\n\n    // Query Docker for container name (on-demand discovery)\n    const containerName = await getDevcontainerContainerName(hostWorkspacePath);\n    if (!containerName) {\n      return null; // Container not running\n    }\n\n    // Get container workspace path via ensureReady (idempotent if already running)\n    const readyResult = await runtime.ensureReady();\n    if (!readyResult.ready) {\n      return null;\n    }\n\n    // Access the cached remoteWorkspaceFolder from DevcontainerRuntime\n    const devRuntime = runtime as DevcontainerRuntime;\n    const containerWorkspacePath = devRuntime.getRemoteWorkspaceFolder();\n    if (!containerWorkspacePath) {\n      return null;\n    }\n\n    return { containerName, containerWorkspacePath, hostWorkspacePath };\n  }\n  async getInfo(workspaceId: string): Promise<FrontendWorkspaceMetadata | null> {\n    const allMetadata = await this.config.getAllWorkspaceMetadata();\n    const found = allMetadata.find((m) => m.id === workspaceId) ?? null;\n    return this.enrichMaybeFrontendMetadata(found);\n  }\n\n  /**\n   * Refresh workspace metadata from config and emit to subscribers.\n   * Useful when external changes (like section assignment) modify workspace config.\n   */\n  async refreshAndEmitMetadata(workspaceId: string): Promise<void> {\n    const metadata = await this.getInfo(workspaceId);\n    if (metadata) {\n      this.emit(\"metadata\", { workspaceId, metadata });\n    }\n  }\n\n  async rename(workspaceId: string, newName: string): Promise<Result<{ newWorkspaceId: string }>> {\n    try {\n      if (this.aiService.isStreaming(workspaceId)) {\n        return Err(\n          \"Cannot rename workspace while AI stream is active. Please wait for the stream to complete.\"\n        );\n      }\n\n      const validation = validateWorkspaceName(newName);\n      if (!validation.valid) {\n        return Err(validation.error ?? \"Invalid workspace name\");\n      }\n\n      // Mark workspace as renaming to block new streams during the rename operation\n      this.renamingWorkspaces.add(workspaceId);\n\n      const metadataResult = await this.aiService.getWorkspaceMetadata(workspaceId);\n      if (!metadataResult.success) {\n        return Err(`Failed to get workspace metadata: ${metadataResult.error}`);\n      }\n      const oldMetadata = metadataResult.data;\n      const oldName = oldMetadata.name;\n\n      if (newName === oldName) {\n        return Ok({ newWorkspaceId: workspaceId });\n      }\n\n      const allWorkspaces = await this.config.getAllWorkspaceMetadata();\n      const collision = allWorkspaces.find(\n        (ws) => (ws.name === newName || ws.id === newName) && ws.id !== workspaceId\n      );\n      if (collision) {\n        return Err(`Workspace with name \"${newName}\" already exists`);\n      }\n\n      const workspace = this.config.findWorkspace(workspaceId);\n      if (!workspace) {\n        return Err(\"Failed to find workspace in config\");\n      }\n      const { projectPath } = workspace;\n\n      const runtime = createRuntime(oldMetadata.runtimeConfig, {\n        projectPath,\n        workspaceName: oldName,\n      });\n\n      const renameResult = await runtime.renameWorkspace(projectPath, oldName, newName);\n\n      if (!renameResult.success) {\n        return Err(renameResult.error);\n      }\n\n      const { oldPath, newPath } = renameResult;\n\n      await this.config.editConfig((config) => {\n        const projectConfig = config.projects.get(projectPath);\n        if (projectConfig) {\n          const workspaceEntry =\n            projectConfig.workspaces.find((w) => w.id === workspaceId) ??\n            projectConfig.workspaces.find((w) => w.path === oldPath);\n          if (workspaceEntry) {\n            workspaceEntry.name = newName;\n            workspaceEntry.path = newPath;\n          }\n        }\n        return config;\n      });\n\n      // Rename plan file if it exists (uses workspace name, not ID)\n      await movePlanFile(runtime, oldName, newName, oldMetadata.projectName);\n\n      const allMetadataUpdated = await this.config.getAllWorkspaceMetadata();\n      const updatedMetadata = allMetadataUpdated.find((m) => m.id === workspaceId);\n      if (!updatedMetadata) {\n        return Err(\"Failed to retrieve updated workspace metadata\");\n      }\n\n      const enrichedMetadata = this.enrichFrontendMetadata(updatedMetadata);\n\n      const session = this.sessions.get(workspaceId);\n      if (session) {\n        session.emitMetadata(enrichedMetadata);\n      } else {\n        this.emit(\"metadata\", { workspaceId, metadata: enrichedMetadata });\n      }\n\n      return Ok({ newWorkspaceId: workspaceId });\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to rename workspace: ${message}`);\n    } finally {\n      // Always clear renaming flag, even on error\n      this.renamingWorkspaces.delete(workspaceId);\n    }\n  }\n\n  /**\n   * Update workspace title without affecting the filesystem name.\n   * Unlike rename(), this can be called even while streaming is active.\n   */\n  async updateTitle(workspaceId: string, title: string): Promise<Result<void>> {\n    try {\n      const workspace = this.config.findWorkspace(workspaceId);\n      if (!workspace) {\n        return Err(\"Workspace not found\");\n      }\n      const { projectPath, workspacePath } = workspace;\n\n      await this.config.editConfig((config) => {\n        const projectConfig = config.projects.get(projectPath);\n        if (projectConfig) {\n          const workspaceEntry =\n            projectConfig.workspaces.find((w) => w.id === workspaceId) ??\n            projectConfig.workspaces.find((w) => w.path === workspacePath);\n          if (workspaceEntry) {\n            workspaceEntry.title = title;\n          }\n        }\n        return config;\n      });\n\n      // Emit updated metadata\n      const allMetadata = await this.config.getAllWorkspaceMetadata();\n      const updatedMetadata = allMetadata.find((m) => m.id === workspaceId);\n      if (updatedMetadata) {\n        const enrichedMetadata = this.enrichFrontendMetadata(updatedMetadata);\n        const session = this.sessions.get(workspaceId);\n        if (session) {\n          session.emitMetadata(enrichedMetadata);\n        } else {\n          this.emit(\"metadata\", { workspaceId, metadata: enrichedMetadata });\n        }\n      }\n\n      return Ok(undefined);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to update workspace title: ${message}`);\n    }\n  }\n\n  /**\n   * Archive a workspace. Archived workspaces are hidden from the main sidebar\n   * but can be viewed on the project page.\n   *\n   * If init is still running, we abort it before archiving so we don't leave\n   * orphaned post-create work running in the background.\n   */\n  async archive(workspaceId: string): Promise<Result<void>> {\n    if (workspaceId === MUX_HELP_CHAT_WORKSPACE_ID) {\n      return Err(\"Cannot archive the Chat with Mux system workspace\");\n    }\n\n    this.archivingWorkspaces.add(workspaceId);\n\n    try {\n      const workspace = this.config.findWorkspace(workspaceId);\n      if (!workspace) {\n        return Err(\"Workspace not found\");\n      }\n      const initState = this.initStateManager.getInitState(workspaceId);\n      if (initState?.status === \"running\") {\n        // Archiving should not leave post-create setup running in the background.\n        const initAbortController = this.initAbortControllers.get(workspaceId);\n        if (initAbortController) {\n          initAbortController.abort();\n          this.initAbortControllers.delete(workspaceId);\n        }\n\n        this.initStateManager.clearInMemoryState(workspaceId);\n\n        // Clearing init state prevents init-end from firing (createInitLogger.logComplete() bails when\n        // state is missing). If archiving fails before we persist archivedAt (e.g., beforeArchive hook\n        // error), ensure the sidebar doesn't stay stuck on isInitializing/\"Cancel creation\".\n        try {\n          const allMetadata = await this.config.getAllWorkspaceMetadata();\n          const updatedMetadata = allMetadata.find((m) => m.id === workspaceId);\n          if (updatedMetadata) {\n            const enrichedMetadata = this.enrichFrontendMetadata(updatedMetadata);\n            const session = this.sessions.get(workspaceId);\n            if (session) {\n              session.emitMetadata(enrichedMetadata);\n            } else {\n              this.emit(\"metadata\", { workspaceId, metadata: enrichedMetadata });\n            }\n          }\n        } catch (error) {\n          log.debug(\"Failed to emit metadata after init cancellation during archive\", {\n            workspaceId,\n            error: error instanceof Error ? error.message : String(error),\n          });\n        }\n      }\n\n      const { projectPath, workspacePath } = workspace;\n\n      // Lifecycle hooks run *before* we persist archivedAt.\n      //\n      // NOTE: Archiving is typically a quick UI action, but it can fail if a hook needs to perform\n      // cleanup (e.g., stopping a dedicated mux-created Coder workspace) and that cleanup fails.\n      if (this.workspaceLifecycleHooks) {\n        const metadataResult = await this.aiService.getWorkspaceMetadata(workspaceId);\n        if (!metadataResult.success) {\n          return Err(metadataResult.error);\n        }\n\n        const hookResult = await this.workspaceLifecycleHooks.runBeforeArchive({\n          workspaceId,\n          workspaceMetadata: metadataResult.data,\n        });\n        if (!hookResult.success) {\n          return Err(hookResult.error);\n        }\n      }\n\n      // Archiving removes the workspace from the sidebar; ensure we don't leave a stream running\n      // \"headless\" with no obvious UI affordance to interrupt it.\n      //\n      // NOTE: We only interrupt after beforeArchive hooks succeed, so a hook failure doesn't stop\n      // an active stream.\n      if (this.aiService.isStreaming(workspaceId)) {\n        const stopResult = await this.interruptStream(workspaceId);\n        if (!stopResult.success) {\n          log.debug(\"Failed to stop stream during workspace archive\", {\n            workspaceId,\n            error: stopResult.error,\n          });\n        }\n      }\n\n      await this.config.editConfig((config) => {\n        const projectConfig = config.projects.get(projectPath);\n        if (projectConfig) {\n          const workspaceEntry =\n            projectConfig.workspaces.find((w) => w.id === workspaceId) ??\n            projectConfig.workspaces.find((w) => w.path === workspacePath);\n          if (workspaceEntry) {\n            // Just set archivedAt - archived state is derived from archivedAt > unarchivedAt\n            workspaceEntry.archivedAt = new Date().toISOString();\n          }\n        }\n        return config;\n      });\n\n      // Emit updated metadata\n      const allMetadata = await this.config.getAllWorkspaceMetadata();\n      const updatedMetadata = allMetadata.find((m) => m.id === workspaceId);\n      if (updatedMetadata) {\n        const enrichedMetadata = this.enrichFrontendMetadata(updatedMetadata);\n        const session = this.sessions.get(workspaceId);\n        if (session) {\n          session.emitMetadata(enrichedMetadata);\n        } else {\n          this.emit(\"metadata\", { workspaceId, metadata: enrichedMetadata });\n        }\n      }\n\n      return Ok(undefined);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to archive workspace: ${message}`);\n    } finally {\n      this.archivingWorkspaces.delete(workspaceId);\n    }\n  }\n\n  /**\n   * Unarchive a workspace. Restores it to the main sidebar view.\n   */\n  async unarchive(workspaceId: string): Promise<Result<void>> {\n    if (workspaceId === MUX_HELP_CHAT_WORKSPACE_ID) {\n      return Err(\"Cannot unarchive the Chat with Mux system workspace\");\n    }\n\n    try {\n      const workspace = this.config.findWorkspace(workspaceId);\n      if (!workspace) {\n        return Err(\"Workspace not found\");\n      }\n      const { projectPath, workspacePath } = workspace;\n\n      let didUnarchive = false;\n\n      await this.config.editConfig((config) => {\n        const projectConfig = config.projects.get(projectPath);\n        if (projectConfig) {\n          const workspaceEntry =\n            projectConfig.workspaces.find((w) => w.id === workspaceId) ??\n            projectConfig.workspaces.find((w) => w.path === workspacePath);\n          if (workspaceEntry) {\n            const wasArchived = isWorkspaceArchived(\n              workspaceEntry.archivedAt,\n              workspaceEntry.unarchivedAt\n            );\n            if (wasArchived) {\n              // Just set unarchivedAt - archived state is derived from archivedAt > unarchivedAt.\n              // This also bumps workspace to top of recency.\n              workspaceEntry.unarchivedAt = new Date().toISOString();\n              didUnarchive = true;\n            }\n          }\n        }\n        return config;\n      });\n\n      // Only run hooks when the workspace is transitioning from archived  unarchived.\n      if (!didUnarchive) {\n        return Ok(undefined);\n      }\n\n      // Emit updated metadata\n      const allMetadata = await this.config.getAllWorkspaceMetadata();\n      const updatedMetadata = allMetadata.find((m) => m.id === workspaceId);\n      if (updatedMetadata) {\n        const enrichedMetadata = this.enrichFrontendMetadata(updatedMetadata);\n        const session = this.sessions.get(workspaceId);\n        if (session) {\n          session.emitMetadata(enrichedMetadata);\n        } else {\n          this.emit(\"metadata\", { workspaceId, metadata: enrichedMetadata });\n        }\n      }\n\n      // Lifecycle hooks run *after* we persist unarchivedAt.\n      //\n      // Why best-effort: Unarchive is a quick UI action and should not fail permanently due to a\n      // start error (e.g., Coder workspace start).\n      if (this.workspaceLifecycleHooks) {\n        let hookMetadata: WorkspaceMetadata | undefined = updatedMetadata;\n        if (!hookMetadata) {\n          const metadataResult = await this.aiService.getWorkspaceMetadata(workspaceId);\n          if (metadataResult.success) {\n            hookMetadata = metadataResult.data;\n          } else {\n            log.debug(\"Failed to load workspace metadata for afterUnarchive hooks\", {\n              workspaceId,\n              error: metadataResult.error,\n            });\n          }\n        }\n\n        if (hookMetadata) {\n          await this.workspaceLifecycleHooks.runAfterUnarchive({\n            workspaceId,\n            workspaceMetadata: hookMetadata,\n          });\n        }\n      }\n\n      return Ok(undefined);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to unarchive workspace: ${message}`);\n    }\n  }\n\n  /**\n   * Archive all non-archived workspaces within a project whose GitHub PR is merged.\n   *\n   * This is intended for a single command-palette action (one backend call), to avoid\n   * O(n) frontendbackend loops.\n   */\n  async archiveMergedInProject(projectPath: string): Promise<Result<ArchiveMergedInProjectResult>> {\n    const targetProjectPath = projectPath.trim();\n    if (!targetProjectPath) {\n      return Err(\"projectPath is required\");\n    }\n\n    const archivedWorkspaceIds: string[] = [];\n    const skippedWorkspaceIds: string[] = [];\n    const errors: Array<{ workspaceId: string; error: string }> = [];\n\n    try {\n      const allMetadata = await this.config.getAllWorkspaceMetadata();\n\n      const candidates = allMetadata.filter((metadata) => {\n        if (metadata.id === MUX_HELP_CHAT_WORKSPACE_ID) {\n          return false;\n        }\n        if (metadata.projectPath !== targetProjectPath) {\n          return false;\n        }\n        return !isWorkspaceArchived(metadata.archivedAt, metadata.unarchivedAt);\n      });\n\n      const mergedWorkspaceIds: string[] = [];\n\n      const GH_CONCURRENCY_LIMIT = 4;\n      const GH_TIMEOUT_SECS = 15;\n\n      await forEachWithConcurrencyLimit(candidates, GH_CONCURRENCY_LIMIT, async (metadata) => {\n        const workspaceId = metadata.id;\n\n        try {\n          const result = await this.executeBash(\n            workspaceId,\n            `gh pr view --json state 2>/dev/null || echo '{\"no_pr\":true}'`,\n            { timeout_secs: GH_TIMEOUT_SECS }\n          );\n\n          if (!result.success) {\n            errors.push({ workspaceId, error: result.error });\n            return;\n          }\n\n          if (!result.data.success) {\n            errors.push({ workspaceId, error: result.data.error });\n            return;\n          }\n\n          const output = result.data.output;\n          if (!output || output.trim().length === 0) {\n            errors.push({ workspaceId, error: \"gh pr view returned empty output\" });\n            return;\n          }\n\n          let parsed: unknown;\n          try {\n            parsed = JSON.parse(output);\n          } catch (error) {\n            const message = error instanceof Error ? error.message : String(error);\n            errors.push({ workspaceId, error: `Failed to parse gh output: ${message}` });\n            return;\n          }\n\n          if (typeof parsed !== \"object\" || parsed === null) {\n            errors.push({ workspaceId, error: \"Unexpected gh output: not a JSON object\" });\n            return;\n          }\n\n          const record = parsed as Record<string, unknown>;\n\n          if (\"no_pr\" in record) {\n            skippedWorkspaceIds.push(workspaceId);\n            return;\n          }\n\n          if (record.state === \"MERGED\") {\n            mergedWorkspaceIds.push(workspaceId);\n            return;\n          }\n\n          skippedWorkspaceIds.push(workspaceId);\n        } catch (error) {\n          const message = error instanceof Error ? error.message : String(error);\n          errors.push({ workspaceId, error: message });\n        }\n      });\n\n      // Archive sequentially: config.editConfig is not mutex-protected.\n      for (const workspaceId of mergedWorkspaceIds) {\n        const result = await this.archive(workspaceId);\n        if (!result.success) {\n          errors.push({ workspaceId, error: result.error });\n          continue;\n        }\n        archivedWorkspaceIds.push(workspaceId);\n      }\n\n      archivedWorkspaceIds.sort();\n      skippedWorkspaceIds.sort();\n      errors.sort((a, b) => a.workspaceId.localeCompare(b.workspaceId));\n\n      return Ok({\n        archivedWorkspaceIds,\n        skippedWorkspaceIds,\n        errors,\n      });\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to archive merged workspaces: ${message}`);\n    }\n  }\n\n  private normalizeWorkspaceAISettings(\n    aiSettings: WorkspaceAISettings\n  ): Result<WorkspaceAISettings, string> {\n    const rawModel = aiSettings.model;\n    const model = normalizeGatewayModel(rawModel).trim();\n    if (!model) {\n      return Err(\"Model is required\");\n    }\n    if (!isValidModelFormat(model)) {\n      return Err(`Invalid model format: ${rawModel}`);\n    }\n\n    return Ok({\n      model,\n      thinkingLevel: aiSettings.thinkingLevel,\n    });\n  }\n\n  private normalizeSendMessageAgentId(options: SendMessageOptions): SendMessageOptions {\n    // agentId is required by the schema, so this just normalizes the value.\n    const rawAgentId = options.agentId;\n    const normalizedAgentId =\n      typeof rawAgentId === \"string\" && rawAgentId.trim().length > 0\n        ? rawAgentId.trim().toLowerCase()\n        : WORKSPACE_DEFAULTS.agentId;\n\n    if (normalizedAgentId === options.agentId) {\n      return options;\n    }\n\n    return {\n      ...options,\n      agentId: normalizedAgentId,\n    };\n  }\n\n  private extractWorkspaceAISettingsFromSendOptions(\n    options: SendMessageOptions | undefined\n  ): WorkspaceAISettings | null {\n    const rawModel = options?.model;\n    if (typeof rawModel !== \"string\" || rawModel.trim().length === 0) {\n      return null;\n    }\n\n    const model = normalizeGatewayModel(rawModel).trim();\n    if (!isValidModelFormat(model)) {\n      return null;\n    }\n\n    const requestedThinking = options?.thinkingLevel;\n    // Be defensive: if a (very) old client doesn't send thinkingLevel, don't overwrite\n    // any existing workspace-scoped value.\n    if (requestedThinking === undefined) {\n      return null;\n    }\n\n    const thinkingLevel = requestedThinking;\n\n    return { model, thinkingLevel };\n  }\n\n  /**\n   * Best-effort persist AI settings from send/resume options.\n   * Skips requests explicitly marked to avoid persistence.\n   */\n  private async maybePersistAISettingsFromOptions(\n    workspaceId: string,\n    options: SendMessageOptions | undefined,\n    context: \"send\" | \"resume\"\n  ): Promise<void> {\n    if (options?.skipAiSettingsPersistence) {\n      // One-shot/compaction sends shouldn't overwrite workspace defaults.\n      return;\n    }\n\n    const extractedSettings = this.extractWorkspaceAISettingsFromSendOptions(options);\n    if (!extractedSettings) return;\n\n    const rawAgentId = options?.agentId;\n    const agentId =\n      typeof rawAgentId === \"string\" && rawAgentId.trim().length > 0\n        ? rawAgentId.trim().toLowerCase()\n        : WORKSPACE_DEFAULTS.agentId;\n\n    const persistResult = await this.persistWorkspaceAISettingsForAgent(\n      workspaceId,\n      agentId,\n      extractedSettings,\n      {\n        emitMetadata: false,\n      }\n    );\n    if (!persistResult.success) {\n      log.debug(`Failed to persist workspace AI settings from ${context} options`, {\n        workspaceId,\n        error: persistResult.error,\n      });\n    }\n  }\n\n  private async persistWorkspaceAISettingsForAgent(\n    workspaceId: string,\n    agentId: string,\n    aiSettings: WorkspaceAISettings,\n    options?: { emitMetadata?: boolean }\n  ): Promise<Result<boolean, string>> {\n    const found = this.config.findWorkspace(workspaceId);\n    if (!found) {\n      return Err(\"Workspace not found\");\n    }\n\n    const { projectPath, workspacePath } = found;\n\n    const config = this.config.loadConfigOrDefault();\n    const projectConfig = config.projects.get(projectPath);\n    if (!projectConfig) {\n      return Err(`Project not found: ${projectPath}`);\n    }\n\n    const workspaceEntry = projectConfig.workspaces.find((w) => w.id === workspaceId);\n    const workspaceEntryWithFallback =\n      workspaceEntry ?? projectConfig.workspaces.find((w) => w.path === workspacePath);\n    if (!workspaceEntryWithFallback) {\n      return Err(\"Workspace not found\");\n    }\n\n    const normalizedAgentId = agentId.trim().toLowerCase();\n    if (!normalizedAgentId) {\n      return Err(\"Agent ID is required\");\n    }\n\n    const prev = workspaceEntryWithFallback.aiSettingsByAgent?.[normalizedAgentId];\n    const changed =\n      prev?.model !== aiSettings.model || prev?.thinkingLevel !== aiSettings.thinkingLevel;\n    if (!changed) {\n      return Ok(false);\n    }\n\n    workspaceEntryWithFallback.aiSettingsByAgent = {\n      ...(workspaceEntryWithFallback.aiSettingsByAgent ?? {}),\n      [normalizedAgentId]: aiSettings,\n    };\n\n    await this.config.saveConfig(config);\n\n    if (options?.emitMetadata !== false) {\n      const allMetadata = await this.config.getAllWorkspaceMetadata();\n      const updatedMetadata = allMetadata.find((m) => m.id === workspaceId) ?? null;\n      const enrichedMetadata = this.enrichMaybeFrontendMetadata(updatedMetadata);\n\n      const session = this.sessions.get(workspaceId);\n      if (session) {\n        session.emitMetadata(enrichedMetadata);\n      } else {\n        this.emit(\"metadata\", { workspaceId, metadata: enrichedMetadata });\n      }\n    }\n\n    return Ok(true);\n  }\n\n  async updateModeAISettings(\n    workspaceId: string,\n    mode: UIMode,\n    aiSettings: WorkspaceAISettings\n  ): Promise<Result<void, string>> {\n    // Mode-based updates use mode as the agentId.\n    return this.updateAgentAISettings(workspaceId, mode, aiSettings);\n  }\n\n  async updateAgentAISettings(\n    workspaceId: string,\n    agentId: string,\n    aiSettings: WorkspaceAISettings\n  ): Promise<Result<void, string>> {\n    try {\n      const normalized = this.normalizeWorkspaceAISettings(aiSettings);\n      if (!normalized.success) {\n        return Err(normalized.error);\n      }\n\n      const persistResult = await this.persistWorkspaceAISettingsForAgent(\n        workspaceId,\n        agentId,\n        normalized.data,\n        {\n          emitMetadata: true,\n        }\n      );\n      if (!persistResult.success) {\n        return Err(persistResult.error);\n      }\n\n      return Ok(undefined);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to update workspace AI settings: ${message}`);\n    }\n  }\n\n  async fork(\n    sourceWorkspaceId: string,\n    newName: string\n  ): Promise<Result<{ metadata: FrontendWorkspaceMetadata; projectPath: string }>> {\n    try {\n      if (sourceWorkspaceId === MUX_HELP_CHAT_WORKSPACE_ID) {\n        return Err(\"Cannot fork the Chat with Mux system workspace\");\n      }\n\n      const validation = validateWorkspaceName(newName);\n      if (!validation.valid) {\n        return Err(validation.error ?? \"Invalid workspace name\");\n      }\n\n      if (this.aiService.isStreaming(sourceWorkspaceId)) {\n        await this.partialService.commitToHistory(sourceWorkspaceId);\n      }\n\n      const sourceMetadataResult = await this.aiService.getWorkspaceMetadata(sourceWorkspaceId);\n      if (!sourceMetadataResult.success) {\n        return Err(`Failed to get source workspace metadata: ${sourceMetadataResult.error}`);\n      }\n      const sourceMetadata = sourceMetadataResult.data;\n      const foundProjectPath = sourceMetadata.projectPath;\n      const projectName = sourceMetadata.projectName;\n      const sourceRuntimeConfig = sourceMetadata.runtimeConfig;\n\n      // Policy: do not allow creating new workspaces (including via fork) with a disallowed runtime.\n      if (this.policyService?.isEnforced()) {\n        if (!this.policyService.isRuntimeAllowed(sourceRuntimeConfig)) {\n          return Err(\"Forking this workspace is not allowed by policy (runtime disabled)\");\n        }\n      }\n\n      // Block fork for Docker runtimes - creates broken workspaces.\n      // Sub-agent task spawning uses a different code path (TaskService.create).\n      if (isDockerRuntime(sourceRuntimeConfig)) {\n        return Err(\"Forking Docker workspaces is not supported. Create a new workspace instead.\");\n      }\n\n      const runtime = createRuntime(sourceRuntimeConfig, {\n        projectPath: foundProjectPath,\n        workspaceName: sourceMetadata.name,\n      });\n\n      const newWorkspaceId = this.config.generateStableId();\n\n      const session = this.getOrCreateSession(newWorkspaceId);\n      this.initStateManager.startInit(newWorkspaceId, foundProjectPath);\n      const initLogger = this.createInitLogger(newWorkspaceId);\n\n      const forkResult = await runtime.forkWorkspace({\n        projectPath: foundProjectPath,\n        sourceWorkspaceName: sourceMetadata.name,\n        newWorkspaceName: newName,\n        initLogger,\n      });\n\n      if (!forkResult.success) {\n        initLogger.logComplete(-1);\n        return Err(forkResult.error ?? \"Failed to fork workspace\");\n      }\n\n      // Run init for forked workspace (fire-and-forget like create())\n      // Use sourceBranch as trunk since fork is based on source workspace's branch\n      const secrets = secretsToRecord(this.config.getEffectiveSecrets(foundProjectPath));\n\n      const initAbortController = new AbortController();\n      this.initAbortControllers.set(newWorkspaceId, initAbortController);\n      runBackgroundInit(\n        runtime,\n        {\n          projectPath: foundProjectPath,\n          branchName: newName,\n          trunkBranch: forkResult.sourceBranch ?? \"main\",\n          workspacePath: forkResult.workspacePath!,\n          initLogger,\n          env: secrets,\n          abortSignal: initAbortController.signal,\n        },\n        newWorkspaceId,\n        log\n      );\n\n      const sourceSessionDir = this.config.getSessionDir(sourceWorkspaceId);\n      const newSessionDir = this.config.getSessionDir(newWorkspaceId);\n\n      try {\n        await fsPromises.mkdir(newSessionDir, { recursive: true });\n\n        const sourceChatPath = path.join(sourceSessionDir, \"chat.jsonl\");\n        const newChatPath = path.join(newSessionDir, \"chat.jsonl\");\n        try {\n          await fsPromises.copyFile(sourceChatPath, newChatPath);\n        } catch (error) {\n          if (!(error && typeof error === \"object\" && \"code\" in error && error.code === \"ENOENT\")) {\n            throw error;\n          }\n        }\n\n        const sourcePartialPath = path.join(sourceSessionDir, \"partial.json\");\n        const newPartialPath = path.join(newSessionDir, \"partial.json\");\n        try {\n          await fsPromises.copyFile(sourcePartialPath, newPartialPath);\n        } catch (error) {\n          if (!(error && typeof error === \"object\" && \"code\" in error && error.code === \"ENOENT\")) {\n            throw error;\n          }\n        }\n\n        const sourceTimingPath = path.join(sourceSessionDir, \"session-timing.json\");\n        const newTimingPath = path.join(newSessionDir, \"session-timing.json\");\n        try {\n          await fsPromises.copyFile(sourceTimingPath, newTimingPath);\n        } catch (error) {\n          if (!(error && typeof error === \"object\" && \"code\" in error && error.code === \"ENOENT\")) {\n            throw error;\n          }\n        }\n        const sourceUsagePath = path.join(sourceSessionDir, \"session-usage.json\");\n        const newUsagePath = path.join(newSessionDir, \"session-usage.json\");\n        try {\n          await fsPromises.copyFile(sourceUsagePath, newUsagePath);\n        } catch (error) {\n          if (!(error && typeof error === \"object\" && \"code\" in error && error.code === \"ENOENT\")) {\n            throw error;\n          }\n        }\n      } catch (copyError) {\n        await runtime.deleteWorkspace(foundProjectPath, newName, true);\n        try {\n          await fsPromises.rm(newSessionDir, { recursive: true, force: true });\n        } catch (cleanupError) {\n          log.error(`Failed to clean up session dir ${newSessionDir}:`, cleanupError);\n        }\n        initLogger.logComplete(-1);\n        const message = copyError instanceof Error ? copyError.message : String(copyError);\n        return Err(`Failed to copy chat history: ${message}`);\n      }\n\n      // Copy plan file if it exists (checks both new and legacy paths)\n      await copyPlanFile(runtime, sourceMetadata.name, sourceWorkspaceId, newName, projectName);\n\n      // Apply runtime-provided config updates (e.g., Coder marks shared workspaces)\n      const { forkedRuntimeConfig } = await applyForkRuntimeUpdates(\n        this.config,\n        sourceWorkspaceId,\n        sourceRuntimeConfig,\n        forkResult\n      );\n\n      if (forkResult.sourceRuntimeConfig) {\n        const allMetadataUpdated = await this.config.getAllWorkspaceMetadata();\n        const updatedMetadata = allMetadataUpdated.find((m) => m.id === sourceWorkspaceId) ?? null;\n        const enrichedMetadata = this.enrichMaybeFrontendMetadata(updatedMetadata);\n        const sourceSession = this.sessions.get(sourceWorkspaceId);\n        if (sourceSession) {\n          sourceSession.emitMetadata(enrichedMetadata);\n        } else {\n          this.emit(\"metadata\", { workspaceId: sourceWorkspaceId, metadata: enrichedMetadata });\n        }\n      }\n\n      // Compute namedWorkspacePath for frontend metadata\n      const namedWorkspacePath = runtime.getWorkspacePath(foundProjectPath, newName);\n\n      const metadata: FrontendWorkspaceMetadata = {\n        id: newWorkspaceId,\n        name: newName,\n        projectName,\n        projectPath: foundProjectPath,\n        createdAt: new Date().toISOString(),\n        runtimeConfig: forkedRuntimeConfig,\n        namedWorkspacePath,\n        // Preserve workspace organization when forking via /fork.\n        sectionId: sourceMetadata.sectionId,\n      };\n\n      await this.config.addWorkspace(foundProjectPath, metadata);\n\n      const enrichedMetadata = this.enrichFrontendMetadata(metadata);\n      session.emitMetadata(enrichedMetadata);\n\n      return Ok({ metadata: enrichedMetadata, projectPath: foundProjectPath });\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to fork workspace: ${message}`);\n    }\n  }\n\n  async sendMessage(\n    workspaceId: string,\n    message: string,\n    options: SendMessageOptions & {\n      fileParts?: FilePart[];\n    },\n    internal?: {\n      allowQueuedAgentTask?: boolean;\n      skipAutoResumeReset?: boolean;\n      synthetic?: boolean;\n    }\n  ): Promise<Result<void, SendMessageError>> {\n    log.debug(\"sendMessage handler: Received\", {\n      workspaceId,\n      messagePreview: message.substring(0, 50),\n      agentId: options?.agentId,\n      options,\n    });\n\n    try {\n      // Block streaming while workspace is being renamed to prevent path conflicts\n      if (this.renamingWorkspaces.has(workspaceId)) {\n        log.debug(\"sendMessage blocked: workspace is being renamed\", { workspaceId });\n        return Err({\n          type: \"unknown\",\n          raw: \"Workspace is being renamed. Please wait and try again.\",\n        });\n      }\n\n      // Block streaming while workspace is being removed to prevent races with config/session deletion.\n      if (this.removingWorkspaces.has(workspaceId)) {\n        log.debug(\"sendMessage blocked: workspace is being removed\", { workspaceId });\n        return Err({\n          type: \"unknown\",\n          raw: \"Workspace is being deleted. Please wait and try again.\",\n        });\n      }\n\n      // Guard: avoid creating sessions for workspaces that don't exist anymore.\n      if (!this.config.findWorkspace(workspaceId)) {\n        return Err({\n          type: \"unknown\",\n          raw: \"Workspace not found. It may have been deleted.\",\n        });\n      }\n\n      // Guard: queued agent tasks must not start streaming via generic sendMessage calls.\n      // They should only be started by TaskService once a parallel slot is available.\n      if (!internal?.allowQueuedAgentTask) {\n        const config = this.config.loadConfigOrDefault();\n        for (const [_projectPath, project] of config.projects) {\n          const ws = project.workspaces.find((w) => w.id === workspaceId);\n          if (!ws) continue;\n          if (ws.parentWorkspaceId && ws.taskStatus === \"queued\") {\n            taskQueueDebug(\"WorkspaceService.sendMessage blocked (queued task)\", {\n              workspaceId,\n              stack: new Error(\"sendMessage blocked\").stack,\n            });\n            return Err({\n              type: \"unknown\",\n              raw: \"This agent task is queued and cannot start yet. Wait for a slot to free.\",\n            });\n          }\n          break;\n        }\n      } else {\n        taskQueueDebug(\"WorkspaceService.sendMessage allowed (internal dequeue)\", {\n          workspaceId,\n          stack: new Error(\"sendMessage internal\").stack,\n        });\n      }\n\n      const session = this.getOrCreateSession(workspaceId);\n\n      // Skip recency update for idle compaction - preserve original \"last used\" time\n      const muxMeta = options?.muxMetadata as { type?: string; source?: string } | undefined;\n      const isIdleCompaction =\n        muxMeta?.type === \"compaction-request\" && muxMeta?.source === \"idle-compaction\";\n      // Use current time for recency - this matches the timestamp used on the message\n      // in agentSession.sendMessage(). Keeps ExtensionMetadata in sync with chat.jsonl.\n      const messageTimestamp = Date.now();\n      if (!isIdleCompaction) {\n        void this.updateRecencyTimestamp(workspaceId, messageTimestamp);\n      }\n\n      // Experiments: resolve flags respecting userOverridable setting.\n      // - If userOverridable && frontend provides a value (explicit override)  use frontend value\n      // - Else if remote evaluation enabled  use PostHog assignment\n      // - Else  use frontend value (dev fallback) or default\n      const system1Experiment = EXPERIMENTS[EXPERIMENT_IDS.SYSTEM_1];\n      const system1FrontendValue = options?.experiments?.system1;\n\n      let system1Enabled: boolean | undefined;\n      if (system1Experiment.userOverridable && system1FrontendValue !== undefined) {\n        // User-overridable: trust frontend value (user's explicit choice)\n        system1Enabled = system1FrontendValue;\n      } else if (this.experimentsService?.isRemoteEvaluationEnabled() === true) {\n        // Remote evaluation: use PostHog assignment\n        system1Enabled = this.experimentsService.isExperimentEnabled(EXPERIMENT_IDS.SYSTEM_1);\n      } else {\n        // Fallback to frontend value (dev mode or telemetry disabled)\n        system1Enabled = system1FrontendValue;\n      }\n\n      const resolvedExperiments: Record<string, boolean> = {};\n      if (system1Enabled !== undefined) {\n        resolvedExperiments.system1 = system1Enabled;\n      }\n\n      const resolvedOptions =\n        Object.keys(resolvedExperiments).length === 0\n          ? options\n          : {\n              ...options,\n              experiments: {\n                ...(options.experiments ?? {}),\n                ...resolvedExperiments,\n              },\n            };\n\n      const normalizedOptions = this.normalizeSendMessageAgentId(resolvedOptions);\n\n      // Persist last-used model + thinking level for cross-device consistency.\n      await this.maybePersistAISettingsFromOptions(workspaceId, normalizedOptions, \"send\");\n\n      const shouldQueue =\n        !normalizedOptions?.editMessageId &&\n        (this.aiService.isStreaming(workspaceId) || session.isStreamStarting());\n\n      if (shouldQueue) {\n        const pendingAskUserQuestion = askUserQuestionManager.getLatestPending(workspaceId);\n        if (pendingAskUserQuestion) {\n          try {\n            askUserQuestionManager.cancel(\n              workspaceId,\n              pendingAskUserQuestion.toolCallId,\n              \"User responded in chat; questions canceled\"\n            );\n          } catch (error) {\n            log.debug(\"Failed to cancel pending ask_user_question\", {\n              workspaceId,\n              toolCallId: pendingAskUserQuestion.toolCallId,\n              error: error instanceof Error ? error.message : String(error),\n            });\n          }\n        }\n\n        session.queueMessage(message, normalizedOptions);\n        return Ok(undefined);\n      }\n\n      if (!internal?.skipAutoResumeReset) {\n        this.taskService?.resetAutoResumeCount(workspaceId);\n      }\n      const result = await session.sendMessage(message, normalizedOptions, {\n        synthetic: internal?.synthetic,\n      });\n      if (!result.success) {\n        log.error(\"sendMessage handler: session returned error\", {\n          workspaceId,\n          error: result.error,\n        });\n      }\n      return result;\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : JSON.stringify(error, null, 2);\n      log.error(\"Unexpected error in sendMessage handler:\", error);\n\n      // Handle incompatible workspace errors from downgraded configs\n      if (error instanceof IncompatibleRuntimeError) {\n        const sendError: SendMessageError = {\n          type: \"incompatible_workspace\",\n          message: error.message,\n        };\n        return Err(sendError);\n      }\n\n      const sendError: SendMessageError = {\n        type: \"unknown\",\n        raw: `Failed to send message: ${errorMessage}`,\n      };\n      return Err(sendError);\n    }\n  }\n\n  async resumeStream(\n    workspaceId: string,\n    options: SendMessageOptions,\n    internal?: { allowQueuedAgentTask?: boolean }\n  ): Promise<Result<void, SendMessageError>> {\n    try {\n      // Block streaming while workspace is being renamed to prevent path conflicts\n      if (this.renamingWorkspaces.has(workspaceId)) {\n        log.debug(\"resumeStream blocked: workspace is being renamed\", { workspaceId });\n        return Err({\n          type: \"unknown\",\n          raw: \"Workspace is being renamed. Please wait and try again.\",\n        });\n      }\n\n      // Block streaming while workspace is being removed to prevent races with config/session deletion.\n      if (this.removingWorkspaces.has(workspaceId)) {\n        log.debug(\"resumeStream blocked: workspace is being removed\", { workspaceId });\n        return Err({\n          type: \"unknown\",\n          raw: \"Workspace is being deleted. Please wait and try again.\",\n        });\n      }\n\n      // Guard: avoid creating sessions for workspaces that don't exist anymore.\n      if (!this.config.findWorkspace(workspaceId)) {\n        return Err({\n          type: \"unknown\",\n          raw: \"Workspace not found. It may have been deleted.\",\n        });\n      }\n\n      // Guard: queued agent tasks must not be resumed by generic UI/API calls.\n      // TaskService is responsible for dequeuing and starting them.\n      if (!internal?.allowQueuedAgentTask) {\n        const config = this.config.loadConfigOrDefault();\n        for (const [_projectPath, project] of config.projects) {\n          const ws = project.workspaces.find((w) => w.id === workspaceId);\n          if (!ws) continue;\n          if (ws.parentWorkspaceId && ws.taskStatus === \"queued\") {\n            taskQueueDebug(\"WorkspaceService.resumeStream blocked (queued task)\", {\n              workspaceId,\n              stack: new Error(\"resumeStream blocked\").stack,\n            });\n            return Err({\n              type: \"unknown\",\n              raw: \"This agent task is queued and cannot start yet. Wait for a slot to free.\",\n            });\n          }\n          break;\n        }\n      } else {\n        taskQueueDebug(\"WorkspaceService.resumeStream allowed (internal dequeue)\", {\n          workspaceId,\n          stack: new Error(\"resumeStream internal\").stack,\n        });\n      }\n\n      const session = this.getOrCreateSession(workspaceId);\n\n      const normalizedOptions = this.normalizeSendMessageAgentId(options);\n\n      // Persist last-used model + thinking level for cross-device consistency.\n      await this.maybePersistAISettingsFromOptions(workspaceId, normalizedOptions, \"resume\");\n\n      const result = await session.resumeStream(normalizedOptions);\n      if (!result.success) {\n        log.error(\"resumeStream handler: session returned error\", {\n          workspaceId,\n          error: result.error,\n        });\n      }\n      return result;\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      log.error(\"Unexpected error in resumeStream handler:\", error);\n\n      // Handle incompatible workspace errors from downgraded configs\n      if (error instanceof IncompatibleRuntimeError) {\n        const sendError: SendMessageError = {\n          type: \"incompatible_workspace\",\n          message: error.message,\n        };\n        return Err(sendError);\n      }\n\n      const sendError: SendMessageError = {\n        type: \"unknown\",\n        raw: `Failed to resume stream: ${errorMessage}`,\n      };\n      return Err(sendError);\n    }\n  }\n\n  async interruptStream(\n    workspaceId: string,\n    options?: { soft?: boolean; abandonPartial?: boolean; sendQueuedImmediately?: boolean }\n  ): Promise<Result<void>> {\n    try {\n      this.taskService?.resetAutoResumeCount(workspaceId);\n      const session = this.getOrCreateSession(workspaceId);\n      const stopResult = await session.interruptStream(options);\n      if (!stopResult.success) {\n        log.error(\"Failed to stop stream:\", stopResult.error);\n        return Err(stopResult.error);\n      }\n\n      // For hard interrupts, delete partial immediately. For soft interrupts,\n      // defer to stream-abort handler (stream is still running and may recreate partial).\n      if (options?.abandonPartial && !options?.soft) {\n        log.debug(\"Abandoning partial for workspace:\", workspaceId);\n        await this.partialService.deletePartial(workspaceId);\n      }\n\n      // Handle queued messages based on option\n      if (options?.sendQueuedImmediately) {\n        // Send queued messages immediately instead of restoring to input\n        session.sendQueuedMessages();\n      } else {\n        // Restore queued messages to input box for user-initiated interrupts\n        session.restoreQueueToInput();\n      }\n\n      return Ok(undefined);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      log.error(\"Unexpected error in interruptStream handler:\", error);\n      return Err(`Failed to interrupt stream: ${errorMessage}`);\n    }\n  }\n\n  async answerAskUserQuestion(\n    workspaceId: string,\n    toolCallId: string,\n    answers: Record<string, string>\n  ): Promise<Result<void>> {\n    try {\n      // Fast path: normal in-memory execution (stream still running, tool is awaiting input).\n      askUserQuestionManager.answer(workspaceId, toolCallId, answers);\n      return Ok(undefined);\n    } catch (error) {\n      // Fallback path: app restart (or other process death) means the in-memory\n      // AskUserQuestionManager has no pending entry anymore.\n      //\n      // In that case we persist the tool result into partial.json or chat.jsonl,\n      // then emit a synthetic tool-call-end so the renderer updates immediately.\n      try {\n        // Helper: update a message in-place if it contains this ask_user_question tool call.\n        const tryFinalizeMessage = (\n          msg: MuxMessage\n        ): Result<{ updated: MuxMessage; output: AskUserQuestionToolSuccessResult }> => {\n          let foundToolCall = false;\n          let output: AskUserQuestionToolSuccessResult | null = null;\n          let errorMessage: string | null = null;\n\n          const updatedParts = msg.parts.map((part) => {\n            if (!isDynamicToolPart(part) || part.toolCallId !== toolCallId) {\n              return part;\n            }\n\n            foundToolCall = true;\n\n            if (part.toolName !== \"ask_user_question\") {\n              errorMessage = `toolCallId=${toolCallId} is toolName=${part.toolName}, expected ask_user_question`;\n              return part;\n            }\n\n            // Already answered - treat as idempotent.\n            if (part.state === \"output-available\") {\n              const parsedOutput = AskUserQuestionToolResultSchema.safeParse(part.output);\n              if (!parsedOutput.success) {\n                errorMessage = `ask_user_question output validation failed: ${parsedOutput.error.message}`;\n                return part;\n              }\n              output = parsedOutput.data;\n              return part;\n            }\n\n            const parsedArgs = AskUserQuestionToolArgsSchema.safeParse(part.input);\n            if (!parsedArgs.success) {\n              errorMessage = `ask_user_question input validation failed: ${parsedArgs.error.message}`;\n              return part;\n            }\n\n            const nextOutput: AskUserQuestionToolSuccessResult = {\n              summary: buildAskUserQuestionSummary(answers),\n              ui_only: {\n                ask_user_question: {\n                  questions: parsedArgs.data.questions,\n                  answers,\n                },\n              },\n            };\n            output = nextOutput;\n\n            return {\n              ...part,\n              state: \"output-available\" as const,\n              output: nextOutput,\n            };\n          });\n\n          if (errorMessage) {\n            return Err(errorMessage);\n          }\n          if (!foundToolCall) {\n            return Err(\"ask_user_question toolCallId not found in message\");\n          }\n          if (!output) {\n            return Err(\"ask_user_question output missing after update\");\n          }\n\n          return Ok({ updated: { ...msg, parts: updatedParts }, output });\n        };\n\n        // 1) Prefer partial.json (most common after restart while waiting)\n        const partial = await this.partialService.readPartial(workspaceId);\n        if (partial) {\n          const finalized = tryFinalizeMessage(partial);\n          if (finalized.success) {\n            const writeResult = await this.partialService.writePartial(\n              workspaceId,\n              finalized.data.updated\n            );\n            if (!writeResult.success) {\n              return Err(writeResult.error);\n            }\n\n            const session = this.getOrCreateSession(workspaceId);\n            session.emitChatEvent({\n              type: \"tool-call-end\",\n              workspaceId,\n              messageId: finalized.data.updated.id,\n              toolCallId,\n              toolName: \"ask_user_question\",\n              result: finalized.data.output,\n              timestamp: Date.now(),\n            });\n\n            return Ok(undefined);\n          }\n        }\n\n        // 2) Fall back to chat history (partial may have already been committed).\n        // Only the current compaction epoch matters  pending tool calls don't survive compaction.\n        const historyResult = await this.historyService.getHistoryFromLatestBoundary(workspaceId);\n        if (!historyResult.success) {\n          return Err(historyResult.error);\n        }\n\n        // Find the newest message containing this tool call.\n        let best: MuxMessage | null = null;\n        let bestSeq = -Infinity;\n        for (const msg of historyResult.data) {\n          const seq = msg.metadata?.historySequence;\n          if (seq === undefined) continue;\n\n          const hasTool = msg.parts.some(\n            (p) => isDynamicToolPart(p) && p.toolCallId === toolCallId\n          );\n          if (hasTool && seq > bestSeq) {\n            best = msg;\n            bestSeq = seq;\n          }\n        }\n\n        if (!best) {\n          const errorMessage = error instanceof Error ? error.message : String(error);\n          return Err(`Failed to answer ask_user_question: ${errorMessage}`);\n        }\n\n        // Guard against answering stale tool calls.\n        const maxSeq = Math.max(\n          ...historyResult.data\n            .map((m) => m.metadata?.historySequence)\n            .filter((n): n is number => typeof n === \"number\")\n        );\n        if (bestSeq !== maxSeq) {\n          return Err(\n            `Refusing to answer ask_user_question: tool call is not the latest message (toolSeq=${bestSeq}, latestSeq=${maxSeq})`\n          );\n        }\n\n        const finalized = tryFinalizeMessage(best);\n        if (!finalized.success) {\n          return Err(finalized.error);\n        }\n\n        const updateResult = await this.historyService.updateHistory(\n          workspaceId,\n          finalized.data.updated\n        );\n        if (!updateResult.success) {\n          return Err(updateResult.error);\n        }\n\n        const session = this.getOrCreateSession(workspaceId);\n        session.emitChatEvent({\n          type: \"tool-call-end\",\n          workspaceId,\n          messageId: finalized.data.updated.id,\n          toolCallId,\n          toolName: \"ask_user_question\",\n          result: finalized.data.output,\n          timestamp: Date.now(),\n        });\n\n        return Ok(undefined);\n      } catch (innerError) {\n        const errorMessage = innerError instanceof Error ? innerError.message : String(innerError);\n        return Err(errorMessage);\n      }\n    }\n  }\n\n  clearQueue(workspaceId: string): Result<void> {\n    try {\n      const session = this.getOrCreateSession(workspaceId);\n      session.clearQueue();\n      return Ok(undefined);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      log.error(\"Unexpected error in clearQueue handler:\", error);\n      return Err(`Failed to clear queue: ${errorMessage}`);\n    }\n  }\n\n  /**\n   * Best-effort delete of plan files (new + legacy paths) for a workspace.\n   *\n   * Why best-effort: plan files may not exist yet, or deletion may fail due to permissions.\n   */\n  private async deletePlanFilesForWorkspace(\n    workspaceId: string,\n    metadata: FrontendWorkspaceMetadata\n  ): Promise<void> {\n    // Create runtime to get correct muxHome (Docker uses /var/mux, others use ~/.mux)\n    const runtime = createRuntimeForWorkspace(metadata);\n    const muxHome = runtime.getMuxHome();\n    const planPath = getPlanFilePath(metadata.name, metadata.projectName, muxHome);\n    const legacyPlanPath = getLegacyPlanFilePath(workspaceId);\n\n    const isDocker = isDockerRuntime(metadata.runtimeConfig);\n    const isSSH = isSSHRuntime(metadata.runtimeConfig);\n\n    // For Docker: paths are already absolute (/var/mux/...), just quote\n    // For SSH: use $HOME expansion so the runtime shell resolves to the runtime home directory\n    // For local: expand tilde locally since shellQuote prevents shell expansion\n    const quotedPlanPath = isDocker\n      ? shellQuote(planPath)\n      : isSSH\n        ? expandTildeForSSH(planPath)\n        : shellQuote(expandTilde(planPath));\n    // For legacy path: SSH/Docker use $HOME expansion, local expands tilde\n    const quotedLegacyPlanPath =\n      isDocker || isSSH\n        ? expandTildeForSSH(legacyPlanPath)\n        : shellQuote(expandTilde(legacyPlanPath));\n\n    if (isDocker || isSSH) {\n      try {\n        // Use exec to delete files since runtime doesn't have a deleteFile method.\n        // Use runtime workspace path (not host projectPath) for Docker containers.\n        const workspacePath = runtime.getWorkspacePath(metadata.projectPath, metadata.name);\n        const execStream = await runtime.exec(`rm -f ${quotedPlanPath} ${quotedLegacyPlanPath}`, {\n          cwd: workspacePath,\n          timeout: 10,\n        });\n\n        try {\n          await execStream.stdin.close();\n        } catch {\n          // Ignore stdin-close errors (e.g. already closed).\n        }\n\n        await execStream.exitCode.catch(() => {\n          // Best-effort: ignore failures.\n        });\n      } catch {\n        // Plan files don't exist or can't be deleted - ignore\n      }\n\n      return;\n    }\n\n    // Local runtimes: delete directly on the local filesystem.\n    const planPathAbs = expandTilde(planPath);\n    const legacyPlanPathAbs = expandTilde(legacyPlanPath);\n\n    await Promise.allSettled([\n      fsPromises.rm(planPathAbs, { force: true }),\n      fsPromises.rm(legacyPlanPathAbs, { force: true }),\n    ]);\n  }\n\n  async truncateHistory(workspaceId: string, percentage?: number): Promise<Result<void>> {\n    if (this.aiService.isStreaming(workspaceId)) {\n      return Err(\n        \"Cannot truncate history while stream is active. Press Esc to stop the stream first.\"\n      );\n    }\n\n    const truncateResult = await this.historyService.truncateHistory(\n      workspaceId,\n      percentage ?? 1.0\n    );\n    if (!truncateResult.success) {\n      return Err(truncateResult.error);\n    }\n\n    const deletedSequences = truncateResult.data;\n    if (deletedSequences.length > 0) {\n      const deleteMessage: DeleteMessage = {\n        type: \"delete\",\n        historySequences: deletedSequences,\n      };\n      // Emit through the session so ORPC subscriptions receive the event\n      const session = this.sessions.get(workspaceId);\n      if (session) {\n        session.emitChatEvent(deleteMessage);\n      } else {\n        // Fallback to direct emit (legacy path)\n        this.emit(\"chat\", { workspaceId, message: deleteMessage });\n      }\n    }\n\n    // On full clear, also delete plan file and clear file change tracking\n    if ((percentage ?? 1.0) === 1.0) {\n      const metadata = await this.getInfo(workspaceId);\n      if (metadata) {\n        await this.deletePlanFilesForWorkspace(workspaceId, metadata);\n      }\n      this.sessions.get(workspaceId)?.clearFileState();\n    }\n\n    return Ok(undefined);\n  }\n\n  async replaceHistory(\n    workspaceId: string,\n    summaryMessage: MuxMessage,\n    options?: {\n      mode?: \"destructive\" | \"append-compaction-boundary\" | null;\n      deletePlanFile?: boolean;\n    }\n  ): Promise<Result<void>> {\n    // Support both new enum (\"user\"|\"idle\") and legacy boolean (true)\n    const isCompaction = !!summaryMessage.metadata?.compacted;\n    if (!isCompaction && this.aiService.isStreaming(workspaceId)) {\n      return Err(\n        \"Cannot replace history while stream is active. Press Esc to stop the stream first.\"\n      );\n    }\n\n    const replaceMode = options?.mode ?? \"destructive\";\n\n    try {\n      let messageToAppend = summaryMessage;\n      let deletedSequences: number[] = [];\n\n      if (replaceMode === \"append-compaction-boundary\") {\n        assert(\n          summaryMessage.role === \"assistant\",\n          \"append-compaction-boundary replace mode requires an assistant summary message\"\n        );\n\n        // Only need the current epoch's messages  the latest boundary marker holds\n        // the max compaction epoch, and epochs are monotonically increasing with\n        // append-only compaction. Falls back to full history for uncompacted workspaces.\n        const historyResult = await this.historyService.getHistoryFromLatestBoundary(workspaceId);\n        if (!historyResult.success) {\n          return Err(\n            `Failed to read history for append-compaction-boundary mode: ${historyResult.error}`\n          );\n        }\n\n        const nextCompactionEpoch = getNextCompactionEpochForAppendBoundary(\n          workspaceId,\n          historyResult.data\n        );\n        assert(\n          isPositiveInteger(nextCompactionEpoch),\n          \"append-compaction-boundary replace mode must compute a positive compaction epoch\"\n        );\n\n        const compactedMarker = hasDurableCompactedMarker(summaryMessage.metadata?.compacted)\n          ? summaryMessage.metadata.compacted\n          : \"user\";\n\n        messageToAppend = {\n          ...summaryMessage,\n          metadata: {\n            ...(summaryMessage.metadata ?? {}),\n            compacted: compactedMarker,\n            compactionBoundary: true,\n            compactionEpoch: nextCompactionEpoch,\n          },\n        };\n\n        assert(\n          hasDurableCompactedMarker(messageToAppend.metadata?.compacted),\n          \"append-compaction-boundary replace mode requires a durable compacted marker\"\n        );\n        assert(\n          messageToAppend.metadata?.compactionBoundary === true,\n          \"append-compaction-boundary replace mode must persist compactionBoundary=true\"\n        );\n        assert(\n          isPositiveInteger(messageToAppend.metadata?.compactionEpoch),\n          \"append-compaction-boundary replace mode must persist a positive compactionEpoch\"\n        );\n      } else {\n        assert(\n          replaceMode === \"destructive\",\n          `replaceHistory received unsupported replace mode: ${String(replaceMode)}`\n        );\n\n        const clearResult = await this.historyService.clearHistory(workspaceId);\n        if (!clearResult.success) {\n          return Err(`Failed to clear history: ${clearResult.error}`);\n        }\n        deletedSequences = clearResult.data;\n      }\n\n      const appendResult = await this.historyService.appendToHistory(workspaceId, messageToAppend);\n      if (!appendResult.success) {\n        return Err(`Failed to append summary message: ${appendResult.error}`);\n      }\n\n      // Emit through the session so ORPC subscriptions receive the events\n      const session = this.sessions.get(workspaceId);\n      if (deletedSequences.length > 0) {\n        const deleteMessage: DeleteMessage = {\n          type: \"delete\",\n          historySequences: deletedSequences,\n        };\n        if (session) {\n          session.emitChatEvent(deleteMessage);\n        } else {\n          this.emit(\"chat\", { workspaceId, message: deleteMessage });\n        }\n      }\n\n      // Add type: \"message\" for discriminated union (MuxMessage doesn't have it)\n      const typedSummaryMessage = { ...messageToAppend, type: \"message\" as const };\n      if (session) {\n        session.emitChatEvent(typedSummaryMessage);\n      } else {\n        this.emit(\"chat\", { workspaceId, message: typedSummaryMessage });\n      }\n\n      // Optional cleanup: delete plan file when caller explicitly requests it.\n      // Note: the propose_plan UI keeps the plan file on disk; this flag is reserved for\n      // explicit reset flows and backwards compatibility.\n      if (options?.deletePlanFile === true) {\n        const metadata = await this.getInfo(workspaceId);\n        if (metadata) {\n          await this.deletePlanFilesForWorkspace(workspaceId, metadata);\n        }\n        this.sessions.get(workspaceId)?.clearFileState();\n      }\n\n      return Ok(undefined);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to replace history: ${message}`);\n    }\n  }\n\n  async getActivityList(): Promise<Record<string, WorkspaceActivitySnapshot>> {\n    try {\n      const snapshots = await this.extensionMetadata.getAllSnapshots();\n      return Object.fromEntries(snapshots.entries());\n    } catch (error) {\n      log.error(\"Failed to list activity:\", error);\n      return {};\n    }\n  }\n  async getChatHistory(workspaceId: string): Promise<MuxMessage[]> {\n    try {\n      // Only return messages from the latest compaction boundary onward.\n      // Pre-boundary messages are summarized in the boundary marker.\n      // TODO: allow users to opt in to viewing full pre-boundary history.\n      const history = await this.historyService.getHistoryFromLatestBoundary(workspaceId);\n      return history.success ? history.data : [];\n    } catch (error) {\n      log.error(\"Failed to get chat history:\", error);\n      return [];\n    }\n  }\n\n  async getFileCompletions(\n    workspaceId: string,\n    query: string,\n    limit = 20\n  ): Promise<{ paths: string[] }> {\n    assert(workspaceId, \"workspaceId is required\");\n    assert(typeof query === \"string\", \"query must be a string\");\n\n    const resolvedLimit = Math.min(Math.max(1, Math.trunc(limit)), 50);\n\n    const metadata = await this.getInfo(workspaceId);\n    if (!metadata) {\n      return { paths: [] };\n    }\n\n    const runtime = createRuntimeForWorkspace(metadata);\n    const isInPlace = metadata.projectPath === metadata.name;\n    const workspacePath = isInPlace\n      ? metadata.projectPath\n      : runtime.getWorkspacePath(metadata.projectPath, metadata.name);\n\n    const now = Date.now();\n    const CACHE_TTL_MS = 10_000;\n\n    let cached = this.fileCompletionsCache.get(workspaceId);\n    if (!cached) {\n      cached = { index: EMPTY_FILE_COMPLETIONS_INDEX, fetchedAt: 0 };\n      this.fileCompletionsCache.set(workspaceId, cached);\n    }\n\n    const cacheEntry = cached;\n\n    const isStale = cacheEntry.fetchedAt === 0 || now - cacheEntry.fetchedAt > CACHE_TTL_MS;\n    if (isStale && !cacheEntry.refreshing) {\n      cacheEntry.refreshing = (async () => {\n        const previousIndex = cacheEntry.index;\n\n        try {\n          const result = await execBuffered(runtime, \"git ls-files -co --exclude-standard\", {\n            cwd: workspacePath,\n            timeout: 5,\n          });\n\n          if (result.exitCode !== 0) {\n            cacheEntry.index = previousIndex;\n          } else {\n            const files = result.stdout\n              .split(\"\\n\")\n              .map((line) => line.trim())\n              // File @mentions are whitespace-delimited, so we exclude spaced paths from autocomplete.\n              .filter((filePath) => Boolean(filePath) && !/\\s/.test(filePath));\n            cacheEntry.index = buildFileCompletionsIndex(files);\n          }\n\n          cacheEntry.fetchedAt = Date.now();\n        } catch (error) {\n          log.debug(\"getFileCompletions: failed to list files\", {\n            workspaceId,\n            error: error instanceof Error ? error.message : String(error),\n          });\n\n          // Keep any previously indexed data, but avoid retrying in a tight loop.\n          cacheEntry.index = previousIndex;\n          cacheEntry.fetchedAt = Date.now();\n        }\n      })().finally(() => {\n        cacheEntry.refreshing = undefined;\n      });\n    }\n\n    if (cacheEntry.fetchedAt === 0 && cacheEntry.refreshing) {\n      await cacheEntry.refreshing;\n    }\n\n    return { paths: searchFileCompletions(cacheEntry.index, query, resolvedLimit) };\n  }\n  async getFullReplay(workspaceId: string): Promise<WorkspaceChatMessage[]> {\n    try {\n      const session = this.getOrCreateSession(workspaceId);\n      const events: WorkspaceChatMessage[] = [];\n      await session.replayHistory(({ message }) => {\n        events.push(message);\n      });\n      return events;\n    } catch (error) {\n      log.error(\"Failed to get full replay:\", error);\n      return [];\n    }\n  }\n\n  async executeBash(\n    workspaceId: string,\n    script: string,\n    options?: {\n      timeout_secs?: number;\n    }\n  ): Promise<Result<BashToolResult>> {\n    // Block bash execution while workspace is being removed to prevent races with directory deletion.\n    // A common case: subagent calls agent_report  frontend's GitStatusStore triggers a git status\n    // refresh  executeBash arrives while remove() is deleting the directory  spawn fails with ENOENT.\n    // removingWorkspaces is set for the entire duration of remove(), covering the window between\n    // disk deletion and metadata invalidation.\n    if (this.removingWorkspaces.has(workspaceId)) {\n      return Err(`Workspace ${workspaceId} is being removed`);\n    }\n\n    // NOTE: This guard must run before any init/runtime operations that could wake a stopped SSH\n    // runtime (e.g., Coder workspaces started via `coder ssh --wait=yes`).\n    if (this.archivingWorkspaces.has(workspaceId)) {\n      return Err(`Workspace ${workspaceId} is being archived; cannot execute bash`);\n    }\n\n    const metadataResult = await this.aiService.getWorkspaceMetadata(workspaceId);\n    if (!metadataResult.success) {\n      return Err(`Failed to get workspace metadata: ${metadataResult.error}`);\n    }\n\n    const metadata = metadataResult.data;\n    if (isWorkspaceArchived(metadata.archivedAt, metadata.unarchivedAt)) {\n      return Err(`Workspace ${workspaceId} is archived; cannot execute bash`);\n    }\n\n    // Wait for workspace initialization (container creation, code sync, etc.)\n    // Same behavior as AI tools - 5 min timeout, then proceeds anyway\n    await this.initStateManager.waitForInit(workspaceId);\n\n    try {\n      // Get actual workspace path from config\n      const workspace = this.config.findWorkspace(workspaceId);\n      if (!workspace) {\n        return Err(`Workspace ${workspaceId} not found in config`);\n      }\n\n      // Load project secrets\n      const projectSecrets = this.config.getEffectiveSecrets(metadata.projectPath);\n\n      // Create scoped temp directory for this IPC call\n      using tempDir = new DisposableTempDir(\"mux-ipc-bash\");\n\n      // Create runtime and compute workspace path\n      const runtime = createRuntime(metadata.runtimeConfig, {\n        projectPath: metadata.projectPath,\n        workspaceName: metadata.name,\n      });\n\n      // Ensure runtime is ready (e.g., start Docker container if stopped)\n      const readyResult = await runtime.ensureReady();\n      if (!readyResult.ready) {\n        return Err(readyResult.error ?? \"Runtime not ready\");\n      }\n\n      const workspacePath = runtime.getWorkspacePath(metadata.projectPath, metadata.name);\n\n      // Create bash tool\n      const bashTool = createBashTool({\n        cwd: workspacePath,\n        runtime,\n        secrets: secretsToRecord(projectSecrets),\n        runtimeTempDir: tempDir.path,\n        overflow_policy: \"truncate\",\n      });\n\n      // Execute the script\n      const result = (await bashTool.execute!(\n        {\n          script,\n          timeout_secs: options?.timeout_secs ?? 120,\n        },\n        {\n          toolCallId: `bash-${Date.now()}`,\n          messages: [],\n        }\n      )) as BashToolResult;\n\n      return Ok(result);\n    } catch (error) {\n      // bashTool.execute returns error results instead of throwing, so this only catches\n      // failures from setup code (getWorkspaceMetadata, findWorkspace, createRuntime, etc.)\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to execute bash command: ${message}`);\n    }\n  }\n\n  /**\n   * List background processes for a workspace.\n   * Returns process info suitable for UI display (excludes handle).\n   */\n  async listBackgroundProcesses(workspaceId: string): Promise<\n    Array<{\n      id: string;\n      pid: number;\n      script: string;\n      displayName?: string;\n      startTime: number;\n      status: \"running\" | \"exited\" | \"killed\" | \"failed\";\n      exitCode?: number;\n    }>\n  > {\n    const processes = await this.backgroundProcessManager.list(workspaceId);\n    return processes.map((p) => ({\n      id: p.id,\n      pid: p.pid,\n      script: p.script,\n      displayName: p.displayName,\n      startTime: p.startTime,\n      status: p.status,\n      exitCode: p.exitCode,\n    }));\n  }\n\n  /**\n   * Terminate a background process by ID.\n   * Verifies the process belongs to the specified workspace.\n   */\n  async terminateBackgroundProcess(workspaceId: string, processId: string): Promise<Result<void>> {\n    // Get process to verify workspace ownership\n    const proc = await this.backgroundProcessManager.getProcess(processId);\n    if (!proc) {\n      return Err(`Process not found: ${processId}`);\n    }\n    if (proc.workspaceId !== workspaceId) {\n      return Err(`Process ${processId} does not belong to workspace ${workspaceId}`);\n    }\n\n    const result = await this.backgroundProcessManager.terminate(processId);\n    if (!result.success) {\n      return Err(result.error);\n    }\n    return Ok(undefined);\n  }\n\n  /**\n   * Peek output for a background bash process.\n   *\n   * This must not consume the output cursor used by bash_output/task_await.\n   */\n  async getBackgroundProcessOutput(\n    workspaceId: string,\n    processId: string,\n    options?: { fromOffset?: number; tailBytes?: number }\n  ): Promise<\n    Result<{\n      status: \"running\" | \"exited\" | \"killed\" | \"failed\";\n      output: string;\n      nextOffset: number;\n      truncatedStart: boolean;\n    }>\n  > {\n    const proc = await this.backgroundProcessManager.getProcess(processId);\n    if (!proc) {\n      return Err(`Process not found: ${processId}`);\n    }\n    if (proc.workspaceId !== workspaceId) {\n      return Err(`Process ${processId} does not belong to workspace ${workspaceId}`);\n    }\n\n    const result = await this.backgroundProcessManager.peekOutput(processId, options);\n    if (!result.success) {\n      return Err(result.error);\n    }\n\n    return Ok({\n      status: result.status,\n      output: result.output,\n      nextOffset: result.nextOffset,\n      truncatedStart: result.truncatedStart,\n    });\n  }\n\n  /**\n   * Get the tool call IDs of foreground bash processes for a workspace.\n   * Returns empty array if no foreground bashes are running.\n   */\n  getForegroundToolCallIds(workspaceId: string): string[] {\n    return this.backgroundProcessManager.getForegroundToolCallIds(workspaceId);\n  }\n\n  /**\n   * Send a foreground bash process to background by its tool call ID.\n   * The process continues running but the agent stops waiting for it.\n   */\n  sendToBackground(toolCallId: string): Result<void> {\n    const result = this.backgroundProcessManager.sendToBackground(toolCallId);\n    if (!result.success) {\n      return Err(result.error);\n    }\n    return Ok(undefined);\n  }\n\n  /**\n   * Subscribe to background bash state changes.\n   */\n  onBackgroundBashChange(callback: (workspaceId: string) => void): void {\n    this.backgroundProcessManager.on(\"change\", callback);\n  }\n\n  /**\n   * Unsubscribe from background bash state changes.\n   */\n  offBackgroundBashChange(callback: (workspaceId: string) => void): void {\n    this.backgroundProcessManager.off(\"change\", callback);\n  }\n\n  /**\n   * Emit an idle-compaction-needed event to a workspace's stream.\n   * Called by IdleCompactionService when a workspace becomes eligible while connected.\n   */\n  emitIdleCompactionNeeded(workspaceId: string): void {\n    const session = this.sessions.get(workspaceId);\n    if (session) {\n      session.emitChatEvent({ type: \"idle-compaction-needed\" });\n    }\n  }\n}\n"]}