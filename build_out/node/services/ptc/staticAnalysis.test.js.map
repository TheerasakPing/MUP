{"version":3,"file":"staticAnalysis.test.js","sourceRoot":"","sources":["../../../../src/node/services/ptc/staticAnalysis.test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Tests for PTC Static Analysis\n */\n\nimport { describe, test, expect, afterAll } from \"bun:test\";\nimport { analyzeCode, disposeAnalysisContext } from \"./staticAnalysis\";\n\nafterAll(() => {\n  disposeAnalysisContext();\n});\n\ndescribe(\"staticAnalysis\", () => {\n  describe(\"syntax validation\", () => {\n    test(\"valid code passes\", async () => {\n      const result = await analyzeCode(`\n        const x = 1;\n        const y = 2;\n        return x + y;\n      `);\n      expect(result.valid).toBe(true);\n      expect(result.errors).toHaveLength(0);\n    });\n\n    test(\"syntax error is detected\", async () => {\n      const result = await analyzeCode(`\n        const x = 1\n        const y = 2 +\n      `);\n      expect(result.valid).toBe(false);\n      expect(result.errors).toHaveLength(1);\n      expect(result.errors[0].type).toBe(\"syntax\");\n    });\n\n    test(\"unclosed brace is detected\", async () => {\n      const result = await analyzeCode(`\n        if (true) {\n          const x = 1;\n      `);\n      expect(result.valid).toBe(false);\n      expect(result.errors[0].type).toBe(\"syntax\");\n    });\n\n    test(\"invalid token is detected\", async () => {\n      const result = await analyzeCode(`\n        const x = @invalid;\n      `);\n      expect(result.valid).toBe(false);\n      expect(result.errors[0].type).toBe(\"syntax\");\n    });\n\n    test(\"await expression gives clear error message\", async () => {\n      const result = await analyzeCode(`const x = await mux.bash({ script: \"ls\" })`);\n      expect(result.valid).toBe(false);\n      expect(result.errors).toHaveLength(1);\n      expect(result.errors[0].type).toBe(\"syntax\");\n      // Should give clear message about await, not obtuse \"expecting ';'\"\n      expect(result.errors[0].message).toContain(\"await\");\n      expect(result.errors[0].message).toContain(\"not supported\");\n    });\n\n    test(\"allows return statements (wrapped in function)\", async () => {\n      const result = await analyzeCode(`\n        const x = mux.fileRead(\"test.txt\");\n        return x;\n      `);\n      expect(result.valid).toBe(true);\n    });\n  });\n\n  describe(\"unavailable patterns\", () => {\n    test(\"dynamic import() is unavailable\", async () => {\n      const result = await analyzeCode(`\n        const mod = import(\"./module.js\");\n      `);\n      expect(result.valid).toBe(false);\n      expect(result.errors.some((e) => e.message.includes(\"import()\"))).toBe(true);\n    });\n\n    test(\"require() is unavailable\", async () => {\n      const result = await analyzeCode(`\n        const fs = require(\"fs\");\n      `);\n      expect(result.valid).toBe(false);\n      expect(result.errors.some((e) => e.message.includes(\"require()\"))).toBe(true);\n    });\n  });\n\n  describe(\"unavailable globals\", () => {\n    test(\"process is unavailable\", async () => {\n      const result = await analyzeCode(`\n        const env = process.env;\n      `);\n      expect(result.valid).toBe(false);\n      expect(result.errors.some((e) => e.message.includes(\"process\"))).toBe(true);\n    });\n\n    test(\"window is unavailable\", async () => {\n      const result = await analyzeCode(`\n        window.alert(\"hi\");\n      `);\n      expect(result.valid).toBe(false);\n      expect(result.errors.some((e) => e.message.includes(\"window\"))).toBe(true);\n    });\n\n    test(\"fetch is unavailable\", async () => {\n      const result = await analyzeCode(`\n        fetch(\"https://example.com\");\n      `);\n      expect(result.valid).toBe(false);\n      expect(result.errors.some((e) => e.message.includes(\"fetch\"))).toBe(true);\n    });\n\n    test(\"document is unavailable\", async () => {\n      const result = await analyzeCode(`\n        document.getElementById(\"test\");\n      `);\n      expect(result.valid).toBe(false);\n      expect(result.errors.some((e) => e.message.includes(\"document\"))).toBe(true);\n    });\n\n    test(\"multiple unavailable globals produce one error each\", async () => {\n      const result = await analyzeCode(`\n        const a = process.env;\n        const b = window.location;\n        const c = fetch(\"url\");\n      `);\n      expect(result.valid).toBe(false);\n      expect(result.errors.filter((e) => e.type === \"unavailable_global\")).toHaveLength(3);\n    });\n\n    test(\"same global used twice produces only one error\", async () => {\n      const result = await analyzeCode(`\n        const a = process.env;\n        const b = process.cwd();\n      `);\n      expect(result.valid).toBe(false);\n      expect(result.errors.filter((e) => e.message.includes(\"process\"))).toHaveLength(1);\n    });\n\n    test(\"property access obj.process does not error\", async () => {\n      const result = await analyzeCode(`\n        const obj = { foo: \"bar\" };\n        return obj.process;\n      `);\n      expect(result.valid).toBe(true);\n      expect(result.errors).toHaveLength(0);\n    });\n\n    test(\"object key like { process: ... } does NOT error (AST-based detection)\", async () => {\n      const result = await analyzeCode(`\n        const obj = { process: \"running\" };\n      `);\n      // AST-based detection correctly identifies this as an object key, not a reference\n      expect(result.valid).toBe(true);\n      expect(result.errors).toHaveLength(0);\n    });\n\n    test(\"error includes line number\", async () => {\n      const result = await analyzeCode(`const x = 1;\nconst y = 2;\nconst env = process.env;`);\n      const processError = result.errors.find((e) => e.message.includes(\"process\"));\n      expect(processError?.line).toBe(3);\n    });\n  });\n\n  describe(\"allowed constructs (work in QuickJS)\", () => {\n    test(\"eval() is allowed\", async () => {\n      const result = await analyzeCode(`\n        const x = eval(\"1 + 1\");\n      `);\n      expect(result.valid).toBe(true);\n    });\n\n    test(\"new Function() is allowed\", async () => {\n      const result = await analyzeCode(`\n        const fn = new Function(\"a\", \"b\", \"return a + b\");\n      `);\n      expect(result.valid).toBe(true);\n    });\n\n    test(\"globalThis is allowed\", async () => {\n      const result = await analyzeCode(`\n        const pi = globalThis.Math.PI;\n      `);\n      expect(result.valid).toBe(true);\n    });\n\n    test(\"Proxy is allowed\", async () => {\n      const result = await analyzeCode(`\n        const p = new Proxy({}, {});\n      `);\n      expect(result.valid).toBe(true);\n    });\n\n    test(\"Reflect is allowed\", async () => {\n      const result = await analyzeCode(`\n        const x = Reflect.get({a: 1}, \"a\");\n      `);\n      expect(result.valid).toBe(true);\n    });\n  });\n\n  describe(\"line number reporting\", () => {\n    test(\"reports line number for unavailable pattern\", async () => {\n      const result = await analyzeCode(`const x = 1;\nconst y = 2;\nrequire(\"fs\");\nconst z = 3;`);\n      const requireError = result.errors.find((e) => e.message.includes(\"require\"));\n      expect(requireError?.line).toBe(3);\n    });\n  });\n\n  describe(\"valid code examples\", () => {\n    test(\"file reading and processing\", async () => {\n      const result = await analyzeCode(`\n        const content = mux.fileRead(\"package.json\");\n        const pkg = JSON.parse(content);\n        return pkg.name;\n      `);\n      expect(result.valid).toBe(true);\n      expect(result.errors).toHaveLength(0);\n    });\n\n    test(\"array operations\", async () => {\n      const result = await analyzeCode(`\n        const files = [\"a.txt\", \"b.txt\", \"c.txt\"];\n        const results = [];\n        for (const file of files) {\n          results.push(mux.fileRead(file));\n        }\n        return results;\n      `);\n      expect(result.valid).toBe(true);\n    });\n\n    test(\"using Date and Math\", async () => {\n      const result = await analyzeCode(`\n        const now = new Date();\n        const random = Math.floor(Math.random() * 100);\n        console.log(\"Time:\", now.toISOString());\n        return random;\n      `);\n      expect(result.valid).toBe(true);\n    });\n\n    test(\"object and array manipulation\", async () => {\n      const result = await analyzeCode(`\n        const data = { items: [1, 2, 3] };\n        const doubled = data.items.map(x => x * 2);\n        const sum = doubled.reduce((a, b) => a + b, 0);\n        return { doubled, sum };\n      `);\n      expect(result.valid).toBe(true);\n    });\n\n    test(\"try-catch error handling\", async () => {\n      const result = await analyzeCode(`\n        try {\n          const content = mux.fileRead(\"maybe-missing.txt\");\n          return content;\n        } catch (err) {\n          console.error(\"File not found:\", err.message);\n          return null;\n        }\n      `);\n      expect(result.valid).toBe(true);\n    });\n\n    test(\"regex operations\", async () => {\n      const result = await analyzeCode(`\n        const text = mux.fileRead(\"log.txt\");\n        const pattern = /error:.*/gi;\n        const matches = text.match(pattern);\n        return matches || [];\n      `);\n      expect(result.valid).toBe(true);\n    });\n  });\n\n  describe(\"edge cases\", () => {\n    test(\"empty code is valid\", async () => {\n      const result = await analyzeCode(\"\");\n      expect(result.valid).toBe(true);\n    });\n\n    test(\"whitespace only is valid\", async () => {\n      const result = await analyzeCode(\"   \\n\\n  \\t  \");\n      expect(result.valid).toBe(true);\n    });\n\n    test(\"comment only is valid\", async () => {\n      const result = await analyzeCode(`\n        // This is a comment\n        /* Multi-line\n           comment */\n      `);\n      expect(result.valid).toBe(true);\n    });\n\n    test(\"require in string literal does NOT error (AST-based detection)\", async () => {\n      const result = await analyzeCode(`\n        const msg = \"Use require() to import modules\";\n        console.log(msg);\n      `);\n\n      // We intentionally avoid pattern/substring scanning for require()/import() because those\n      // keywords can appear in user strings.\n      expect(result.valid).toBe(true);\n      expect(result.errors).toHaveLength(0);\n    });\n\n    test(\"process in string literal does NOT error (AST-based detection)\", async () => {\n      const result = await analyzeCode(`\n        const msg = \"The process is complete\";\n        console.log(msg);\n      `);\n      // AST-based detection correctly ignores string literal content\n      expect(result.valid).toBe(true);\n      expect(result.errors).toHaveLength(0);\n    });\n  });\n});\n"]}