{"version":3,"file":"staticAnalysis.test.js","sourceRoot":"","sources":["../../../../src/node/services/ptc/staticAnalysis.test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Tests for PTC Static Analysis\r\n */\r\n\r\nimport { describe, test, expect, afterAll } from \"bun:test\";\r\nimport { analyzeCode, disposeAnalysisContext } from \"./staticAnalysis\";\r\n\r\nafterAll(() => {\r\n  disposeAnalysisContext();\r\n});\r\n\r\ndescribe(\"staticAnalysis\", () => {\r\n  describe(\"syntax validation\", () => {\r\n    test(\"valid code passes\", async () => {\r\n      const result = await analyzeCode(`\r\n        const x = 1;\r\n        const y = 2;\r\n        return x + y;\r\n      `);\r\n      expect(result.valid).toBe(true);\r\n      expect(result.errors).toHaveLength(0);\r\n    });\r\n\r\n    test(\"syntax error is detected\", async () => {\r\n      const result = await analyzeCode(`\r\n        const x = 1\r\n        const y = 2 +\r\n      `);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.errors).toHaveLength(1);\r\n      expect(result.errors[0].type).toBe(\"syntax\");\r\n    });\r\n\r\n    test(\"unclosed brace is detected\", async () => {\r\n      const result = await analyzeCode(`\r\n        if (true) {\r\n          const x = 1;\r\n      `);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.errors[0].type).toBe(\"syntax\");\r\n    });\r\n\r\n    test(\"invalid token is detected\", async () => {\r\n      const result = await analyzeCode(`\r\n        const x = @invalid;\r\n      `);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.errors[0].type).toBe(\"syntax\");\r\n    });\r\n\r\n    test(\"await expression gives clear error message\", async () => {\r\n      const result = await analyzeCode(`const x = await mux.bash({ script: \"ls\" })`);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.errors).toHaveLength(1);\r\n      expect(result.errors[0].type).toBe(\"syntax\");\r\n      // Should give clear message about await, not obtuse \"expecting ';'\"\r\n      expect(result.errors[0].message).toContain(\"await\");\r\n      expect(result.errors[0].message).toContain(\"not supported\");\r\n    });\r\n\r\n    test(\"allows return statements (wrapped in function)\", async () => {\r\n      const result = await analyzeCode(`\r\n        const x = mux.fileRead(\"test.txt\");\r\n        return x;\r\n      `);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe(\"unavailable patterns\", () => {\r\n    test(\"dynamic import() is unavailable\", async () => {\r\n      const result = await analyzeCode(`\r\n        const mod = import(\"./module.js\");\r\n      `);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.errors.some((e) => e.message.includes(\"import()\"))).toBe(true);\r\n    });\r\n\r\n    test(\"require() is unavailable\", async () => {\r\n      const result = await analyzeCode(`\r\n        const fs = require(\"fs\");\r\n      `);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.errors.some((e) => e.message.includes(\"require()\"))).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe(\"unavailable globals\", () => {\r\n    test(\"process is unavailable\", async () => {\r\n      const result = await analyzeCode(`\r\n        const env = process.env;\r\n      `);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.errors.some((e) => e.message.includes(\"process\"))).toBe(true);\r\n    });\r\n\r\n    test(\"window is unavailable\", async () => {\r\n      const result = await analyzeCode(`\r\n        window.alert(\"hi\");\r\n      `);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.errors.some((e) => e.message.includes(\"window\"))).toBe(true);\r\n    });\r\n\r\n    test(\"fetch is unavailable\", async () => {\r\n      const result = await analyzeCode(`\r\n        fetch(\"https://example.com\");\r\n      `);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.errors.some((e) => e.message.includes(\"fetch\"))).toBe(true);\r\n    });\r\n\r\n    test(\"document is unavailable\", async () => {\r\n      const result = await analyzeCode(`\r\n        document.getElementById(\"test\");\r\n      `);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.errors.some((e) => e.message.includes(\"document\"))).toBe(true);\r\n    });\r\n\r\n    test(\"multiple unavailable globals produce one error each\", async () => {\r\n      const result = await analyzeCode(`\r\n        const a = process.env;\r\n        const b = window.location;\r\n        const c = fetch(\"url\");\r\n      `);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.errors.filter((e) => e.type === \"unavailable_global\")).toHaveLength(3);\r\n    });\r\n\r\n    test(\"same global used twice produces only one error\", async () => {\r\n      const result = await analyzeCode(`\r\n        const a = process.env;\r\n        const b = process.cwd();\r\n      `);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.errors.filter((e) => e.message.includes(\"process\"))).toHaveLength(1);\r\n    });\r\n\r\n    test(\"property access obj.process does not error\", async () => {\r\n      const result = await analyzeCode(`\r\n        const obj = { foo: \"bar\" };\r\n        return obj.process;\r\n      `);\r\n      expect(result.valid).toBe(true);\r\n      expect(result.errors).toHaveLength(0);\r\n    });\r\n\r\n    test(\"object key like { process: ... } does NOT error (AST-based detection)\", async () => {\r\n      const result = await analyzeCode(`\r\n        const obj = { process: \"running\" };\r\n      `);\r\n      // AST-based detection correctly identifies this as an object key, not a reference\r\n      expect(result.valid).toBe(true);\r\n      expect(result.errors).toHaveLength(0);\r\n    });\r\n\r\n    test(\"error includes line number\", async () => {\r\n      const result = await analyzeCode(`const x = 1;\r\nconst y = 2;\r\nconst env = process.env;`);\r\n      const processError = result.errors.find((e) => e.message.includes(\"process\"));\r\n      expect(processError?.line).toBe(3);\r\n    });\r\n  });\r\n\r\n  describe(\"allowed constructs (work in QuickJS)\", () => {\r\n    test(\"eval() is allowed\", async () => {\r\n      const result = await analyzeCode(`\r\n        const x = eval(\"1 + 1\");\r\n      `);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n\r\n    test(\"new Function() is allowed\", async () => {\r\n      const result = await analyzeCode(`\r\n        const fn = new Function(\"a\", \"b\", \"return a + b\");\r\n      `);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n\r\n    test(\"globalThis is allowed\", async () => {\r\n      const result = await analyzeCode(`\r\n        const pi = globalThis.Math.PI;\r\n      `);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n\r\n    test(\"Proxy is allowed\", async () => {\r\n      const result = await analyzeCode(`\r\n        const p = new Proxy({}, {});\r\n      `);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n\r\n    test(\"Reflect is allowed\", async () => {\r\n      const result = await analyzeCode(`\r\n        const x = Reflect.get({a: 1}, \"a\");\r\n      `);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe(\"line number reporting\", () => {\r\n    test(\"reports line number for unavailable pattern\", async () => {\r\n      const result = await analyzeCode(`const x = 1;\r\nconst y = 2;\r\nrequire(\"fs\");\r\nconst z = 3;`);\r\n      const requireError = result.errors.find((e) => e.message.includes(\"require\"));\r\n      expect(requireError?.line).toBe(3);\r\n    });\r\n  });\r\n\r\n  describe(\"valid code examples\", () => {\r\n    test(\"file reading and processing\", async () => {\r\n      const result = await analyzeCode(`\r\n        const content = mux.fileRead(\"package.json\");\r\n        const pkg = JSON.parse(content);\r\n        return pkg.name;\r\n      `);\r\n      expect(result.valid).toBe(true);\r\n      expect(result.errors).toHaveLength(0);\r\n    });\r\n\r\n    test(\"array operations\", async () => {\r\n      const result = await analyzeCode(`\r\n        const files = [\"a.txt\", \"b.txt\", \"c.txt\"];\r\n        const results = [];\r\n        for (const file of files) {\r\n          results.push(mux.fileRead(file));\r\n        }\r\n        return results;\r\n      `);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n\r\n    test(\"using Date and Math\", async () => {\r\n      const result = await analyzeCode(`\r\n        const now = new Date();\r\n        const random = Math.floor(Math.random() * 100);\r\n        console.log(\"Time:\", now.toISOString());\r\n        return random;\r\n      `);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n\r\n    test(\"object and array manipulation\", async () => {\r\n      const result = await analyzeCode(`\r\n        const data = { items: [1, 2, 3] };\r\n        const doubled = data.items.map(x => x * 2);\r\n        const sum = doubled.reduce((a, b) => a + b, 0);\r\n        return { doubled, sum };\r\n      `);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n\r\n    test(\"try-catch error handling\", async () => {\r\n      const result = await analyzeCode(`\r\n        try {\r\n          const content = mux.fileRead(\"maybe-missing.txt\");\r\n          return content;\r\n        } catch (err) {\r\n          console.error(\"File not found:\", err.message);\r\n          return null;\r\n        }\r\n      `);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n\r\n    test(\"regex operations\", async () => {\r\n      const result = await analyzeCode(`\r\n        const text = mux.fileRead(\"log.txt\");\r\n        const pattern = /error:.*/gi;\r\n        const matches = text.match(pattern);\r\n        return matches || [];\r\n      `);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe(\"edge cases\", () => {\r\n    test(\"empty code is valid\", async () => {\r\n      const result = await analyzeCode(\"\");\r\n      expect(result.valid).toBe(true);\r\n    });\r\n\r\n    test(\"whitespace only is valid\", async () => {\r\n      const result = await analyzeCode(\"   \\n\\n  \\t  \");\r\n      expect(result.valid).toBe(true);\r\n    });\r\n\r\n    test(\"comment only is valid\", async () => {\r\n      const result = await analyzeCode(`\r\n        // This is a comment\r\n        /* Multi-line\r\n           comment */\r\n      `);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n\r\n    test(\"require in string literal does NOT error (AST-based detection)\", async () => {\r\n      const result = await analyzeCode(`\r\n        const msg = \"Use require() to import modules\";\r\n        console.log(msg);\r\n      `);\r\n\r\n      // We intentionally avoid pattern/substring scanning for require()/import() because those\r\n      // keywords can appear in user strings.\r\n      expect(result.valid).toBe(true);\r\n      expect(result.errors).toHaveLength(0);\r\n    });\r\n\r\n    test(\"process in string literal does NOT error (AST-based detection)\", async () => {\r\n      const result = await analyzeCode(`\r\n        const msg = \"The process is complete\";\r\n        console.log(msg);\r\n      `);\r\n      // AST-based detection correctly ignores string literal content\r\n      expect(result.valid).toBe(true);\r\n      expect(result.errors).toHaveLength(0);\r\n    });\r\n  });\r\n});\r\n"]}