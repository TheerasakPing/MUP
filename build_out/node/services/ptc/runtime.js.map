{"version":3,"file":"runtime.js","sourceRoot":"","sources":["../../../../src/node/services/ptc/runtime.ts"],"names":[],"mappings":";AAAA;;;;;GAKG","sourcesContent":["/**\r\n * Programmatic Tool Calling (PTC) Runtime Interface\r\n *\r\n * Abstract interface for JS sandboxes. Currently implemented by QuickJSRuntime,\r\n * but designed to allow future migration to libbun or other runtimes.\r\n */\r\n\r\nimport type { PTCEvent, PTCExecutionResult } from \"./types\";\r\n\r\n/**\r\n * Resource limits for sandbox execution.\r\n */\r\nexport interface RuntimeLimits {\r\n  /** Maximum memory in bytes (default: 64MB) */\r\n  memoryBytes?: number;\r\n  /** Maximum execution time in milliseconds (default: 5 minutes) */\r\n  timeoutMs?: number;\r\n}\r\n\r\n/**\r\n * Interface for a sandboxed JavaScript runtime.\r\n * Implements Disposable for automatic cleanup with `using` declarations.\r\n */\r\nexport interface IJSRuntime extends Disposable {\r\n  /**\r\n   * Execute JavaScript code in the sandbox.\r\n   * Code is wrapped in an async IIFE to allow top-level await.\r\n   * Returns execution result with partial results on failure.\r\n   */\r\n  eval(code: string): Promise<PTCExecutionResult>;\r\n\r\n  /**\r\n   * Register a host function callable from sandbox.\r\n   * The function will be available as a global in the sandbox.\r\n   */\r\n  registerFunction(name: string, fn: (...args: unknown[]) => Promise<unknown>): void;\r\n\r\n  /**\r\n   * Register an object with methods (for namespaced tools like mux.bash).\r\n   * Each method on the object becomes callable from the sandbox.\r\n   */\r\n  registerObject(name: string, obj: Record<string, (...args: unknown[]) => Promise<unknown>>): void;\r\n\r\n  /**\r\n   * Set memory/CPU limits for the sandbox.\r\n   * Must be called before eval() to take effect.\r\n   */\r\n  setLimits(limits: RuntimeLimits): void;\r\n\r\n  /**\r\n   * Subscribe to events for UI streaming (tool calls, console output).\r\n   * Only one handler can be active at a time.\r\n   */\r\n  onEvent(handler: (event: PTCEvent) => void): void;\r\n\r\n  /**\r\n   * Abort the currently running execution.\r\n   * The sandbox will stop at the next interrupt check point.\r\n   */\r\n  abort(): void;\r\n\r\n  /**\r\n   * Get the abort signal for the current execution.\r\n   * This signal is aborted when the sandbox times out or abort() is called.\r\n   * Used by tool bridge to propagate cancellation to nested tool calls.\r\n   */\r\n  getAbortSignal(): AbortSignal | undefined;\r\n\r\n  /**\r\n   * Clean up resources. Called automatically with `using` declarations.\r\n   */\r\n  dispose(): void;\r\n}\r\n\r\n/**\r\n * Factory for creating JS runtime instances.\r\n */\r\nexport interface IJSRuntimeFactory {\r\n  create(): Promise<IJSRuntime>;\r\n}\r\n"]}