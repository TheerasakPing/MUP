{"version":3,"file":"runtime.js","sourceRoot":"","sources":["../../../../src/node/services/ptc/runtime.ts"],"names":[],"mappings":";AAAA;;;;;GAKG","sourcesContent":["/**\n * Programmatic Tool Calling (PTC) Runtime Interface\n *\n * Abstract interface for JS sandboxes. Currently implemented by QuickJSRuntime,\n * but designed to allow future migration to libbun or other runtimes.\n */\n\nimport type { PTCEvent, PTCExecutionResult } from \"./types\";\n\n/**\n * Resource limits for sandbox execution.\n */\nexport interface RuntimeLimits {\n  /** Maximum memory in bytes (default: 64MB) */\n  memoryBytes?: number;\n  /** Maximum execution time in milliseconds (default: 5 minutes) */\n  timeoutMs?: number;\n}\n\n/**\n * Interface for a sandboxed JavaScript runtime.\n * Implements Disposable for automatic cleanup with `using` declarations.\n */\nexport interface IJSRuntime extends Disposable {\n  /**\n   * Execute JavaScript code in the sandbox.\n   * Code is wrapped in an async IIFE to allow top-level await.\n   * Returns execution result with partial results on failure.\n   */\n  eval(code: string): Promise<PTCExecutionResult>;\n\n  /**\n   * Register a host function callable from sandbox.\n   * The function will be available as a global in the sandbox.\n   */\n  registerFunction(name: string, fn: (...args: unknown[]) => Promise<unknown>): void;\n\n  /**\n   * Register an object with methods (for namespaced tools like mux.bash).\n   * Each method on the object becomes callable from the sandbox.\n   */\n  registerObject(name: string, obj: Record<string, (...args: unknown[]) => Promise<unknown>>): void;\n\n  /**\n   * Set memory/CPU limits for the sandbox.\n   * Must be called before eval() to take effect.\n   */\n  setLimits(limits: RuntimeLimits): void;\n\n  /**\n   * Subscribe to events for UI streaming (tool calls, console output).\n   * Only one handler can be active at a time.\n   */\n  onEvent(handler: (event: PTCEvent) => void): void;\n\n  /**\n   * Abort the currently running execution.\n   * The sandbox will stop at the next interrupt check point.\n   */\n  abort(): void;\n\n  /**\n   * Get the abort signal for the current execution.\n   * This signal is aborted when the sandbox times out or abort() is called.\n   * Used by tool bridge to propagate cancellation to nested tool calls.\n   */\n  getAbortSignal(): AbortSignal | undefined;\n\n  /**\n   * Clean up resources. Called automatically with `using` declarations.\n   */\n  dispose(): void;\n}\n\n/**\n * Factory for creating JS runtime instances.\n */\nexport interface IJSRuntimeFactory {\n  create(): Promise<IJSRuntime>;\n}\n"]}