{"version":3,"file":"typeValidator.js","sourceRoot":"","sources":["../../../../src/node/services/ptc/typeValidator.ts"],"names":[],"mappings":";AAAA;;;;;;;;;GASG;;;;;;;AAEH,mHAAmH;AACnH,4CAAoB;AACpB,gDAAwB;AACxB,4DAA4B;AAE5B;;;;;;GAMG;AACH,MAAM,eAAe,GAAG,cAAI,CAAC,OAAO,CAAC,SAAS,EAAE,yBAAyB,CAAC,CAAC;AAC3E,MAAM,aAAa,GAAG,YAAE,CAAC,UAAU,CAAC,cAAI,CAAC,IAAI,CAAC,eAAe,EAAE,qBAAqB,CAAC,CAAC,CAAC;AACvF,MAAM,OAAO,GAAG,aAAa;IAC3B,CAAC,CAAC,eAAe;IACjB,CAAC,CAAC,cAAI,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,yBAAyB,CAAC,CAAC,CAAC;AAEhD,QAAA,cAAc,GAAG,0BAA0B,CAAC;AACzD,MAAM,cAAc,GAAG,UAAU,CAAC;AAClC,MAAM,eAAe,GAAG,CAAC,UAAU,EAAE,cAAc,CAAC,CAAC;AAErD,6EAA6E;AAC7E,MAAM,kBAAkB,GAAG,IAAI,GAAG,EAAyB,CAAC;AAC5D,MAAM,kBAAkB,GAAG,IAAI,GAAG,EAAyB,CAAC;AAE5D,SAAS,aAAa,CAAC,IAAY,EAAU;IAC3C,OAAO,GAAG,QAAA,cAAc,GAAG,IAAI,OAAO,CAAC;AAAA,CACxC;AAED,MAAM,cAAc,GAAG,CAAC,QAAgB,EAAE,eAAgC,EAAU,EAAE,CACpF,GAAG,eAAe,IAAI,QAAQ,EAAE,CAAC;AAEnC,SAAS,sBAAsB,CAC7B,QAAgB,EAChB,eAAgC,EAChC,QAAkC,EACP;IAC3B,MAAM,GAAG,GAAG,cAAc,CAAC,QAAQ,EAAE,eAAe,CAAC,CAAC;IACtD,MAAM,MAAM,GAAG,kBAAkB,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IAC3C,IAAI,MAAM;QAAE,OAAO,MAAM,CAAC;IAE1B,MAAM,QAAQ,GAAG,QAAQ,EAAE,CAAC;IAC5B,IAAI,CAAC,QAAQ;QAAE,OAAO,SAAS,CAAC;IAEhC,MAAM,UAAU,GAAG,oBAAE,CAAC,gBAAgB,CAAC,QAAQ,EAAE,QAAQ,EAAE,eAAe,EAAE,IAAI,CAAC,CAAC;IAClF,kBAAkB,CAAC,GAAG,CAAC,GAAG,EAAE,UAAU,CAAC,CAAC;IACxC,OAAO,UAAU,CAAC;AAAA,CACnB;AAED,SAAS,sBAAsB,CAAC,QAAgB,EAAE,eAAgC,EAAiB;IACjG,MAAM,GAAG,GAAG,GAAG,eAAe,IAAI,QAAQ,EAAE,CAAC;IAC7C,MAAM,MAAM,GAAG,kBAAkB,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IAC3C,IAAI,MAAM;QAAE,OAAO,MAAM,CAAC;IAE1B,MAAM,UAAU,GAAG,oBAAE,CAAC,gBAAgB,CAAC,cAAc,EAAE,QAAQ,EAAE,eAAe,EAAE,IAAI,CAAC,CAAC;IACxF,kBAAkB,CAAC,GAAG,CAAC,GAAG,EAAE,UAAU,CAAC,CAAC;IACxC,OAAO,UAAU,CAAC;AAAA,CACnB;AACD,uEAAuE;AACvE,MAAM,cAAc,GAAG,CAAC,QAAgB,EAAU,EAAE,CAAC;IACnD,MAAM,WAAW,GAAG,cAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IAC5C,MAAM,UAAU,GAAG,aAAa,CAAC,CAAC,CAAC,mBAAmB,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC;IAClF,OAAO,cAAI,CAAC,IAAI,CAAC,OAAO,EAAE,UAAU,CAAC,CAAC;AAAA,CACvC,CAAC;AAEF,SAAS,oBAAoB,CAC3B,WAAmB,EACnB,QAAgB,EAChB,eAAmC,EAMnC;IACA,MAAM,YAAY,GAAG,eAAe,CAAC,MAAM,IAAI,oBAAE,CAAC,YAAY,CAAC,MAAM,CAAC;IACtE,IAAI,UAAU,GAAG,oBAAE,CAAC,gBAAgB,CAAC,UAAU,EAAE,WAAW,EAAE,YAAY,EAAE,IAAI,CAAC,CAAC;IAClF,MAAM,aAAa,GAAG,sBAAsB,CAAC,QAAQ,EAAE,YAAY,CAAC,CAAC;IACrE,MAAM,aAAa,GAAG,CAAC,cAAsB,EAAE,EAAE,CAAC;QAChD,UAAU,GAAG,oBAAE,CAAC,gBAAgB,CAAC,UAAU,EAAE,cAAc,EAAE,YAAY,EAAE,IAAI,CAAC,CAAC;IAAA,CAClF,CAAC;IACF,MAAM,IAAI,GAAG,oBAAE,CAAC,kBAAkB,CAAC,eAAe,CAAC,CAAC;IAEpD,wDAAwD;IACxD,IAAI,CAAC,qBAAqB,GAAG,GAAG,EAAE,CAAC,OAAO,CAAC;IAC3C,IAAI,CAAC,qBAAqB,GAAG,CAAC,OAAO,EAAE,EAAE,CAAC,cAAI,CAAC,IAAI,CAAC,OAAO,EAAE,oBAAE,CAAC,qBAAqB,CAAC,OAAO,CAAC,CAAC,CAAC;IAEhG,MAAM,qBAAqB,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC5D,MAAM,kBAAkB,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACtD,MAAM,gBAAgB,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAElD,IAAI,CAAC,aAAa,GAAG,CAAC,QAAQ,EAAE,wBAAwB,EAAE,OAAO,EAAE,yBAAyB,EAAE,EAAE,CAAC;QAC/F,0EAA0E;QAC1E,MAAM,MAAM,GACV,OAAO,wBAAwB,KAAK,QAAQ,CAAC,CAAC,CAAC,wBAAwB,CAAC,CAAC,CAAC,YAAY,CAAC;QACzF,IAAI,QAAQ,KAAK,UAAU;YAAE,OAAO,UAAU,CAAC;QAC/C,IAAI,QAAQ,KAAK,cAAc;YAAE,OAAO,aAAa,CAAC;QAEtD,MAAM,SAAS,GAAG,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,QAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;QAC1E,IAAI,SAAS,EAAE,CAAC;YACd,MAAM,MAAM,GAAG,sBAAsB,CAAC,QAAQ,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;gBAC5D,IAAI,aAAa,EAAE,CAAC;oBAClB,MAAM,OAAO,GAAG,cAAc,CAAC,QAAQ,CAAC,CAAC;oBACzC,OAAO,YAAE,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,YAAE,CAAC,YAAY,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;gBAChF,CAAC;gBACD,OAAO,gBAAgB,CAAC,QAAQ,CAAC,IAAI,SAAS,CAAC;YAAA,CAChD,CAAC,CAAC;YACH,IAAI,MAAM;gBAAE,OAAO,MAAM,CAAC;QAC5B,CAAC;QAED,OAAO,qBAAqB,CAC1B,QAAQ,EACR,wBAAwB,EACxB,OAAO,EACP,yBAAyB,CAC1B,CAAC;IAAA,CACH,CAAC;IACF,IAAI,CAAC,UAAU,GAAG,CAAC,QAAQ,EAAE,EAAE,CAAC;QAC9B,IAAI,QAAQ,KAAK,UAAU,IAAI,QAAQ,KAAK,cAAc;YAAE,OAAO,IAAI,CAAC;QACxE,2DAA2D;QAC3D,IAAI,aAAa,IAAI,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,QAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC;YAC7E,OAAO,YAAE,CAAC,UAAU,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC;QACjD,CAAC;QACD,OAAO,kBAAkB,CAAC,QAAQ,CAAC,CAAC;IAAA,CACrC,CAAC;IACF,IAAI,CAAC,QAAQ,GAAG,CAAC,QAAQ,EAAE,EAAE,CAAC;QAC5B,IAAI,QAAQ,KAAK,cAAc;YAAE,OAAO,QAAQ,CAAC;QACjD,uDAAuD;QACvD,IAAI,aAAa,IAAI,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,QAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC;YAC7E,MAAM,OAAO,GAAG,cAAc,CAAC,QAAQ,CAAC,CAAC;YACzC,IAAI,YAAE,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC;gBAC3B,OAAO,YAAE,CAAC,YAAY,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;YAC3C,CAAC;QACH,CAAC;QACD,OAAO,gBAAgB,CAAC,QAAQ,CAAC,CAAC;IAAA,CACnC,CAAC;IAEF,MAAM,OAAO,GAAG,oBAAE,CAAC,aAAa,CAAC,eAAe,EAAE,eAAe,EAAE,IAAI,CAAC,CAAC;IACzE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,aAAa,EAAE,GAAG,EAAE,CAAC,UAAU,EAAE,aAAa,EAAE,CAAC;AAAA,CAC1E;AAED,yEAAuE;AACvE,SAAS,mBAAmB,CAAC,QAAgB,EAAU;IACrD,OAAO,QAAQ,GAAG,MAAM,CAAC;AAAA,CAC1B;AAcD;;;;;;GAMG;AAEH;;;;GAIG;AACH,SAAS,uBAAuB,CAAC,CAAgB,EAAE,UAAyB,EAAW;IACrF,IAAI,CAAC,CAAC,IAAI,KAAK,IAAI,IAAI,CAAC,CAAC,KAAK,KAAK,SAAS;QAAE,OAAO,KAAK,CAAC;IAC3D,MAAM,OAAO,GAAG,oBAAE,CAAC,4BAA4B,CAAC,CAAC,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC;IACnE,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,cAAc,CAAC;QAAE,OAAO,KAAK,CAAC;IAEpD,kEAAkE;IAClE,MAAM,KAAK,GAAG,mBAAmB,CAAC,UAAU,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC;IACvD,IAAI,CAAC,KAAK;QAAE,OAAO,KAAK,CAAC;IAEzB,iEAAiE;IACjE,IAAI,UAAmD,CAAC;IACxD,IAAI,IAAI,GAAY,KAAK,CAAC;IAC1B,OAAO,IAAI,CAAC,MAAM,EAAE,CAAC;QACnB,IAAI,oBAAE,CAAC,0BAA0B,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;YAC/C,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC;YACzB,MAAM;QACR,CAAC;QACD,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC;IACrB,CAAC;IACD,IAAI,CAAC,UAAU;QAAE,OAAO,KAAK,CAAC;IAE9B,8EAA8E;IAC9E,MAAM,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC;IACjC,IACE,oBAAE,CAAC,kBAAkB,CAAC,MAAM,CAAC;QAC7B,MAAM,CAAC,aAAa,CAAC,IAAI,KAAK,oBAAE,CAAC,UAAU,CAAC,WAAW;QACvD,MAAM,CAAC,IAAI,KAAK,UAAU,EAC1B,CAAC;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAED,OAAO,KAAK,CAAC;AAAA,CACd;AAED,gEAAgE;AAChE,SAAS,mBAAmB,CAAC,UAAyB,EAAE,QAAgB,EAAuB;IAC7F,SAAS,IAAI,CAAC,IAAa,EAAuB;QAChD,IAAI,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,QAAQ,IAAI,IAAI,CAAC,MAAM,EAAE,EAAE,CAAC;YACtE,OAAO,SAAS,CAAC;QACnB,CAAC;QACD,oCAAoC;QACpC,MAAM,KAAK,GAAG,oBAAE,CAAC,YAAY,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QAC1C,OAAO,KAAK,IAAI,IAAI,CAAC;IAAA,CACtB;IACD,OAAO,IAAI,CAAC,UAAU,CAAC,CAAC;AAAA,CACzB;AAED,mFAAmF;AACnF,SAAS,gBAAgB,CAAC,IAAa,EAAE,OAAuB,EAAW;IACzE,MAAM,WAAW,GAAG,OAAO,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC;IAErD,IAAI,WAAW,CAAC,OAAO,EAAE,EAAE,CAAC;QAC1B,OAAO,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,gBAAgB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC;IAChF,CAAC;IAED,IAAI,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC,EAAE,CAAC;QACrC,OAAO,KAAK,CAAC;IACf,CAAC;IAED,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC,EAAE,CAAC;QACtC,OAAO,KAAK,CAAC;IACf,CAAC;IAED,MAAM,WAAW,GAAG,OAAO,CAAC,kBAAkB,CAAC,WAAW,EAAE,oBAAE,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IACjF,OAAO,WAAW,KAAK,SAAS,IAAI,CAAC,WAAW,CAAC,KAAK,GAAG,oBAAE,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;AAAA,CACpF;AACD;;;;;;;GAOG;AACH,SAAS,0BAA0B,CAAC,IAA+B,EAAW;IAC5E,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;IAE3B,iEAAiE;IACjE,IAAI,oBAAE,CAAC,qBAAqB,CAAC,MAAM,CAAC;QAAE,OAAO,IAAI,CAAC;IAElD,oEAAoE;IACpE,6EAA6E;IAC7E,IACE,oBAAE,CAAC,kBAAkB,CAAC,MAAM,CAAC;QAC7B,MAAM,CAAC,aAAa,CAAC,IAAI,KAAK,oBAAE,CAAC,UAAU,CAAC,WAAW;QACvD,MAAM,CAAC,IAAI,KAAK,IAAI,EACpB,CAAC;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAED,4EAA4E;IAC5E,0EAA0E;IAC1E,IAAI,CAAC,oBAAE,CAAC,gBAAgB,CAAC,MAAM,CAAC,IAAI,oBAAE,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,IAAI,MAAM,CAAC,WAAW,KAAK,IAAI,EAAE,CAAC;QAChG,OAAO,IAAI,CAAC;IACd,CAAC;IAED,OAAO,KAAK,CAAC;AAAA,CACd;AAED,SAAS,0BAA0B,CACjC,IAAY,EACZ,UAAyB,EACzB,OAAuB,EACV;IACb,MAAM,SAAS,GAAG,QAAA,cAAc,CAAC,MAAM,CAAC;IACxC,MAAM,OAAO,GAAG,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC;IACxC,MAAM,MAAM,GAAG,IAAI,GAAG,EAAU,CAAC;IAEjC,SAAS,KAAK,CAAC,IAAa,EAAE;QAC5B,IAAI,oBAAE,CAAC,wBAAwB,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACpE,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;YACxC,IAAI,KAAK,IAAI,SAAS,IAAI,IAAI,CAAC,GAAG,IAAI,OAAO,EAAE,CAAC;gBAC9C,MAAM,cAAc,GAAG,OAAO,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;gBACvD,MAAM,IAAI,GAAG,cAAc,IAAI,OAAO,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;gBAC/D,IAAI,gBAAgB,CAAC,IAAI,EAAE,OAAO,CAAC,EAAE,CAAC;oBACpC,MAAM,CAAC,GAAG,CAAC,KAAK,GAAG,SAAS,CAAC,CAAC;gBAChC,CAAC;YACH,CAAC;QACH,CAAC;QACD,oBAAE,CAAC,YAAY,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;IAAA,CAC9B;IAED,KAAK,CAAC,UAAU,CAAC,CAAC;IAClB,OAAO,MAAM,CAAC;AAAA,CACf;AAED;;;;;;;;;GASG;AACH,SAAS,qBAAqB,CAAC,IAAY,EAAE,gBAA6B,EAAU;IAClF,IAAI,gBAAgB,CAAC,IAAI,KAAK,CAAC,EAAE,CAAC;QAChC,OAAO,IAAI,CAAC;IACd,CAAC;IAED,MAAM,UAAU,GAAG,oBAAE,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,EAAE,oBAAE,CAAC,YAAY,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;IACtF,MAAM,KAAK,GAAyC,EAAE,CAAC;IAEvD,SAAS,KAAK,CAAC,IAAa,EAAE;QAC5B,IAAI,oBAAE,CAAC,wBAAwB,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACpE,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;YACxC,IAAI,gBAAgB,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,0BAA0B,CAAC,IAAI,CAAC,EAAE,CAAC;gBACrE,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;gBAC3B,wFAAwF;gBACxF,MAAM,WAAW,GACf,oBAAE,CAAC,0BAA0B,CAAC,MAAM,CAAC;oBACrC,oBAAE,CAAC,qBAAqB,CAAC,MAAM,CAAC;oBAChC,oBAAE,CAAC,yBAAyB,CAAC,MAAM,CAAC;oBACpC,oBAAE,CAAC,oBAAoB,CAAC,MAAM,CAAC;oBAC/B,CAAC,oBAAE,CAAC,gBAAgB,CAAC,MAAM,CAAC,IAAI,MAAM,CAAC,UAAU,KAAK,IAAI,CAAC;oBAC3D,CAAC,oBAAE,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,MAAM,CAAC,UAAU,KAAK,IAAI,CAAC;oBACtD,oBAAE,CAAC,uBAAuB,CAAC,MAAM,CAAC;oBAClC,oBAAE,CAAC,wBAAwB,CAAC,MAAM,CAAC;oBACnC,oBAAE,CAAC,kBAAkB,CAAC,MAAM,CAAC;oBAC7B,oBAAE,CAAC,gBAAgB,CAAC,MAAM,CAAC;oBAC3B,oBAAE,CAAC,kBAAkB,CAAC,MAAM,CAAC;oBAC7B,oBAAE,CAAC,iBAAiB,CAAC,MAAM,CAAC;oBAC5B,oBAAE,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC;gBAE/B,IAAI,WAAW,EAAE,CAAC;oBAChB,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC;oBAC1D,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,IAAI,EAAE,YAAY,EAAE,CAAC,CAAC;gBACpD,CAAC;qBAAM,CAAC;oBACN,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,IAAI,EAAE,WAAW,EAAE,CAAC,CAAC;gBACnD,CAAC;YACH,CAAC;QACH,CAAC;QACD,oBAAE,CAAC,YAAY,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;IAAA,CAC9B;IAED,KAAK,CAAC,UAAU,CAAC,CAAC;IAElB,qDAAqD;IACrD,IAAI,MAAM,GAAG,IAAI,CAAC;IAClB,KAAK,MAAM,IAAI,IAAI,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC;QACvD,MAAM,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAC1E,CAAC;IACD,OAAO,MAAM,CAAC;AAAA,CACf;AAED,uBAA8B,IAAY,EAAE,QAAgB,EAAwB;IAClF,MAAM,eAAe,GAAuB;QAC1C,MAAM,EAAE,IAAI;QACZ,MAAM,EAAE,KAAK,EAAE,6CAA6C;QAC5D,gBAAgB,EAAE,IAAI,EAAE,uFAAuF;QAC/G,aAAa,EAAE,KAAK,EAAE,kBAAkB;QACxC,YAAY,EAAE,IAAI;QAClB,MAAM,EAAE,oBAAE,CAAC,YAAY,CAAC,MAAM;QAC9B,MAAM,EAAE,oBAAE,CAAC,UAAU,CAAC,MAAM;QAC5B,6FAA6F;QAC7F,mDAAmD;QACnD,GAAG,EAAE,CAAC,iBAAiB,CAAC;KACzB,CAAC;IAEF,2FAA2F;IAC3F,MAAM,mBAAmB,GAAG,aAAa,CAAC,IAAI,CAAC,CAAC;IAChD,MAAM,EACJ,OAAO,EAAE,eAAe,EACxB,IAAI,EACJ,aAAa,EACb,aAAa,GACd,GAAG,oBAAoB,CAAC,mBAAmB,EAAE,QAAQ,EAAE,eAAe,CAAC,CAAC;IACzE,MAAM,kBAAkB,GAAG,aAAa,EAAE,CAAC;IAC3C,MAAM,gBAAgB,GAAG,0BAA0B,CACjD,IAAI,EACJ,kBAAkB,EAClB,eAAe,CAAC,cAAc,EAAE,CACjC,CAAC;IACF,MAAM,gBAAgB,GAAG,qBAAqB,CAAC,IAAI,EAAE,gBAAgB,CAAC,CAAC;IAEvE,8EAA8E;IAC9E,iFAAiF;IACjF,yFAAyF;IACzF,MAAM,WAAW,GAAG,aAAa,CAAC,gBAAgB,CAAC,CAAC;IAEpD,IAAI,OAAO,GAAG,eAAe,CAAC;IAC9B,IAAI,WAAW,KAAK,mBAAmB,EAAE,CAAC;QACxC,aAAa,CAAC,WAAW,CAAC,CAAC;QAC3B,OAAO,GAAG,oBAAE,CAAC,aAAa,CAAC,eAAe,EAAE,eAAe,EAAE,IAAI,EAAE,eAAe,CAAC,CAAC;IACtF,CAAC;IAED,MAAM,UAAU,GAAG,OAAO,CAAC,aAAa,CAAC,UAAU,CAAC,IAAI,aAAa,EAAE,CAAC;IACxE,MAAM,WAAW,GAAG,oBAAE,CAAC,qBAAqB,CAAC,OAAO,CAAC,CAAC;IAEtD,oDAAoD;IACpD,yFAAyF;IACzF,MAAM,MAAM,GAA0B,WAAW;SAC9C,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,KAAK,oBAAE,CAAC,kBAAkB,CAAC,KAAK,CAAC;SACzD,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,KAAK,UAAU,CAAC;SACxD,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,oBAAE,CAAC,4BAA4B,CAAC,CAAC,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;QACvF,kFAAkF;QAClF,oFAAoF;QACpF,+EAA+E;QAC/E,qDAAqD;SACpD,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,uBAAuB,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC;SACtD,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC;QACV,MAAM,OAAO,GAAG,oBAAE,CAAC,4BAA4B,CAAC,CAAC,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC;QACpE,mCAAmC;QACnC,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,KAAK,KAAK,SAAS,EAAE,CAAC;YACpC,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC,6BAA6B,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;YAC1E,mEAAmE;YACnE,gFAAgF;YAChF,0EAA0E;YAC1E,4EAA4E;YAC5E,MAAM,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC;YAC/C,IAAI,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,cAAc,EAAE,CAAC;gBACxC,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,MAAM,EAAE,SAAS,GAAG,CAAC,EAAE,CAAC;YAClD,CAAC;QACH,CAAC;QACD,OAAO,EAAE,OAAO,EAAE,CAAC;IAAA,CACpB,CAAC,CAAC;IAEL,OAAO,EAAE,KAAK,EAAE,MAAM,CAAC,MAAM,KAAK,CAAC,EAAE,MAAM,EAAE,UAAU,EAAE,kBAAkB,EAAE,CAAC;AAAA,CAC/E","sourcesContent":["/**\r\n * TypeScript Type Validator for PTC\r\n *\r\n * Validates agent-generated JavaScript code against generated type definitions.\r\n * Catches type errors before execution:\r\n * - Wrong property names\r\n * - Missing required arguments\r\n * - Wrong types for arguments\r\n * - Calling non-existent tools\r\n */\r\n\r\n/* eslint-disable local/no-sync-fs-methods -- TypeScript's CompilerHost API requires synchronous file operations */\r\nimport fs from \"fs\";\r\nimport path from \"path\";\r\nimport ts from \"typescript\";\r\n\r\n/**\r\n * In production builds, lib files are copied to dist/typescript-lib/ with .d.ts.txt extension\r\n * because electron-builder ignores .d.ts files by default (hardcoded, cannot override):\r\n * https://github.com/electron-userland/electron-builder/issues/5064\r\n *\r\n * These constants are computed once at module load time.\r\n */\r\nconst BUNDLED_LIB_DIR = path.resolve(__dirname, \"../../../typescript-lib\");\r\nconst IS_PRODUCTION = fs.existsSync(path.join(BUNDLED_LIB_DIR, \"lib.es2023.d.ts.txt\"));\r\nconst LIB_DIR = IS_PRODUCTION\r\n  ? BUNDLED_LIB_DIR\r\n  : path.dirname(require.resolve(\"typescript/lib/lib.d.ts\"));\r\n\r\nexport const WRAPPER_PREFIX = \"function __agent__() {\\n\";\r\nconst MUX_TYPES_FILE = \"mux.d.ts\";\r\nconst ROOT_FILE_NAMES = [\"agent.ts\", MUX_TYPES_FILE];\r\n\r\n// Cache lib and mux type SourceFiles across validations to avoid re-parsing.\r\nconst libSourceFileCache = new Map<string, ts.SourceFile>();\r\nconst muxSourceFileCache = new Map<string, ts.SourceFile>();\r\n\r\nfunction wrapAgentCode(code: string): string {\r\n  return `${WRAPPER_PREFIX}${code}\\n}\\n`;\r\n}\r\n\r\nconst getLibCacheKey = (fileName: string, languageVersion: ts.ScriptTarget): string =>\r\n  `${languageVersion}:${fileName}`;\r\n\r\nfunction getCachedLibSourceFile(\r\n  fileName: string,\r\n  languageVersion: ts.ScriptTarget,\r\n  readFile: () => string | undefined\r\n): ts.SourceFile | undefined {\r\n  const key = getLibCacheKey(fileName, languageVersion);\r\n  const cached = libSourceFileCache.get(key);\r\n  if (cached) return cached;\r\n\r\n  const contents = readFile();\r\n  if (!contents) return undefined;\r\n\r\n  const sourceFile = ts.createSourceFile(fileName, contents, languageVersion, true);\r\n  libSourceFileCache.set(key, sourceFile);\r\n  return sourceFile;\r\n}\r\n\r\nfunction getCachedMuxSourceFile(muxTypes: string, languageVersion: ts.ScriptTarget): ts.SourceFile {\r\n  const key = `${languageVersion}:${muxTypes}`;\r\n  const cached = muxSourceFileCache.get(key);\r\n  if (cached) return cached;\r\n\r\n  const sourceFile = ts.createSourceFile(MUX_TYPES_FILE, muxTypes, languageVersion, true);\r\n  muxSourceFileCache.set(key, sourceFile);\r\n  return sourceFile;\r\n}\r\n/** Resolve lib file path, accounting for .d.ts rename in production */\r\nconst resolveLibPath = (fileName: string): string => {\r\n  const libFileName = path.basename(fileName);\r\n  const actualName = IS_PRODUCTION ? toProductionLibName(libFileName) : libFileName;\r\n  return path.join(LIB_DIR, actualName);\r\n};\r\n\r\nfunction createProgramForCode(\r\n  wrappedCode: string,\r\n  muxTypes: string,\r\n  compilerOptions: ts.CompilerOptions\r\n): {\r\n  program: ts.Program;\r\n  host: ts.CompilerHost;\r\n  getSourceFile: () => ts.SourceFile;\r\n  setSourceFile: (newWrappedCode: string) => void;\r\n} {\r\n  const scriptTarget = compilerOptions.target ?? ts.ScriptTarget.ES2020;\r\n  let sourceFile = ts.createSourceFile(\"agent.ts\", wrappedCode, scriptTarget, true);\r\n  const muxSourceFile = getCachedMuxSourceFile(muxTypes, scriptTarget);\r\n  const setSourceFile = (newWrappedCode: string) => {\r\n    sourceFile = ts.createSourceFile(\"agent.ts\", newWrappedCode, scriptTarget, true);\r\n  };\r\n  const host = ts.createCompilerHost(compilerOptions);\r\n\r\n  // Override to read lib files from our bundled directory\r\n  host.getDefaultLibLocation = () => LIB_DIR;\r\n  host.getDefaultLibFileName = (options) => path.join(LIB_DIR, ts.getDefaultLibFileName(options));\r\n\r\n  const originalGetSourceFile = host.getSourceFile.bind(host);\r\n  const originalFileExists = host.fileExists.bind(host);\r\n  const originalReadFile = host.readFile.bind(host);\r\n\r\n  host.getSourceFile = (fileName, languageVersionOrOptions, onError, shouldCreateNewSourceFile) => {\r\n    // languageVersionOrOptions can be ScriptTarget or CreateSourceFileOptions\r\n    const target =\r\n      typeof languageVersionOrOptions === \"number\" ? languageVersionOrOptions : scriptTarget;\r\n    if (fileName === \"agent.ts\") return sourceFile;\r\n    if (fileName === MUX_TYPES_FILE) return muxSourceFile;\r\n\r\n    const isLibFile = fileName.includes(\"lib.\") && fileName.endsWith(\".d.ts\");\r\n    if (isLibFile) {\r\n      const cached = getCachedLibSourceFile(fileName, target, () => {\r\n        if (IS_PRODUCTION) {\r\n          const libPath = resolveLibPath(fileName);\r\n          return fs.existsSync(libPath) ? fs.readFileSync(libPath, \"utf-8\") : undefined;\r\n        }\r\n        return originalReadFile(fileName) ?? undefined;\r\n      });\r\n      if (cached) return cached;\r\n    }\r\n\r\n    return originalGetSourceFile(\r\n      fileName,\r\n      languageVersionOrOptions,\r\n      onError,\r\n      shouldCreateNewSourceFile\r\n    );\r\n  };\r\n  host.fileExists = (fileName) => {\r\n    if (fileName === \"agent.ts\" || fileName === MUX_TYPES_FILE) return true;\r\n    // In production, check bundled lib directory for lib files\r\n    if (IS_PRODUCTION && fileName.includes(\"lib.\") && fileName.endsWith(\".d.ts\")) {\r\n      return fs.existsSync(resolveLibPath(fileName));\r\n    }\r\n    return originalFileExists(fileName);\r\n  };\r\n  host.readFile = (fileName) => {\r\n    if (fileName === MUX_TYPES_FILE) return muxTypes;\r\n    // In production, read lib files from bundled directory\r\n    if (IS_PRODUCTION && fileName.includes(\"lib.\") && fileName.endsWith(\".d.ts\")) {\r\n      const libPath = resolveLibPath(fileName);\r\n      if (fs.existsSync(libPath)) {\r\n        return fs.readFileSync(libPath, \"utf-8\");\r\n      }\r\n    }\r\n    return originalReadFile(fileName);\r\n  };\r\n\r\n  const program = ts.createProgram(ROOT_FILE_NAMES, compilerOptions, host);\r\n  return { program, host, getSourceFile: () => sourceFile, setSourceFile };\r\n}\r\n\r\n/** Convert lib filename for production: lib.X.d.ts → lib.X.d.ts.txt */\r\nfunction toProductionLibName(fileName: string): string {\r\n  return fileName + \".txt\";\r\n}\r\n\r\nexport interface TypeValidationError {\r\n  message: string;\r\n  line?: number;\r\n  column?: number;\r\n}\r\n\r\nexport interface TypeValidationResult {\r\n  valid: boolean;\r\n  errors: TypeValidationError[];\r\n  sourceFile?: ts.SourceFile;\r\n}\r\n\r\n/**\r\n * Validate JavaScript code against mux type definitions using TypeScript.\r\n *\r\n * @param code - JavaScript code to validate\r\n * @param muxTypes - Generated `.d.ts` content from generateMuxTypes()\r\n * @returns Validation result with errors if any\r\n */\r\n\r\n/**\r\n * Check if a TS2339 diagnostic is for a property WRITE on an empty object literal.\r\n * Returns true only for patterns like `results.foo = x` where `results` is typed as `{}`.\r\n * Returns false for reads like `return results.foo` or `fn(results.foo)`.\r\n */\r\nfunction isEmptyObjectWriteError(d: ts.Diagnostic, sourceFile: ts.SourceFile): boolean {\r\n  if (d.code !== 2339 || d.start === undefined) return false;\r\n  const message = ts.flattenDiagnosticMessageText(d.messageText, \"\");\r\n  if (!message.includes(\"on type '{}'\")) return false;\r\n\r\n  // Find the node at the error position and walk up to find context\r\n  const token = findTokenAtPosition(sourceFile, d.start);\r\n  if (!token) return false;\r\n\r\n  // Walk up to find PropertyAccessExpression containing this token\r\n  let propAccess: ts.PropertyAccessExpression | undefined;\r\n  let node: ts.Node = token;\r\n  while (node.parent) {\r\n    if (ts.isPropertyAccessExpression(node.parent)) {\r\n      propAccess = node.parent;\r\n      break;\r\n    }\r\n    node = node.parent;\r\n  }\r\n  if (!propAccess) return false;\r\n\r\n  // Check if this PropertyAccessExpression is on the left side of an assignment\r\n  const parent = propAccess.parent;\r\n  if (\r\n    ts.isBinaryExpression(parent) &&\r\n    parent.operatorToken.kind === ts.SyntaxKind.EqualsToken &&\r\n    parent.left === propAccess\r\n  ) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/** Find the innermost token at a position in the source file */\r\nfunction findTokenAtPosition(sourceFile: ts.SourceFile, position: number): ts.Node | undefined {\r\n  function find(node: ts.Node): ts.Node | undefined {\r\n    if (position < node.getStart(sourceFile) || position >= node.getEnd()) {\r\n      return undefined;\r\n    }\r\n    // Try to find a more specific child\r\n    const child = ts.forEachChild(node, find);\r\n    return child ?? node;\r\n  }\r\n  return find(sourceFile);\r\n}\r\n\r\n/** Returns true if the type resolves to a non-tuple never[] (including unions). */\r\nfunction isNeverArrayType(type: ts.Type, checker: ts.TypeChecker): boolean {\r\n  const nonNullable = checker.getNonNullableType(type);\r\n\r\n  if (nonNullable.isUnion()) {\r\n    return nonNullable.types.every((member) => isNeverArrayType(member, checker));\r\n  }\r\n\r\n  if (checker.isTupleType(nonNullable)) {\r\n    return false;\r\n  }\r\n\r\n  if (!checker.isArrayType(nonNullable)) {\r\n    return false;\r\n  }\r\n\r\n  const elementType = checker.getIndexTypeOfType(nonNullable, ts.IndexKind.Number);\r\n  return elementType !== undefined && (elementType.flags & ts.TypeFlags.Never) !== 0;\r\n}\r\n/**\r\n * Check if an empty array literal is in a position where adding `as any[]` would be invalid.\r\n * If true, we should NOT add `as any[]`.\r\n *\r\n * Note: We only check valid JavaScript patterns here. TypeScript-specific syntax\r\n * (type annotations, `as` expressions, etc.) cannot reach QuickJS execution, so\r\n * handling them here would be dead code.\r\n */\r\nfunction hasInvalidAssertionContext(node: ts.ArrayLiteralExpression): boolean {\r\n  const parent = node.parent;\r\n\r\n  // Skip: `const [] = x` (destructuring pattern - array is on LHS)\r\n  if (ts.isArrayBindingPattern(parent)) return true;\r\n\r\n  // Skip: `([] = foo)` (destructuring assignment - array on LHS of =)\r\n  // Adding `as any[]` here would produce invalid syntax: `([] as any[] = foo)`\r\n  if (\r\n    ts.isBinaryExpression(parent) &&\r\n    parent.operatorToken.kind === ts.SyntaxKind.EqualsToken &&\r\n    parent.left === node\r\n  ) {\r\n    return true;\r\n  }\r\n\r\n  // Skip: `for ([] of items)` / `for ([] in obj)` (array literal as loop LHS)\r\n  // Adding `as any[]` here would produce invalid syntax in the loop header.\r\n  if ((ts.isForOfStatement(parent) || ts.isForInStatement(parent)) && parent.initializer === node) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction getNeverArrayLiteralStarts(\r\n  code: string,\r\n  sourceFile: ts.SourceFile,\r\n  checker: ts.TypeChecker\r\n): Set<number> {\r\n  const codeStart = WRAPPER_PREFIX.length;\r\n  const codeEnd = codeStart + code.length;\r\n  const starts = new Set<number>();\r\n\r\n  function visit(node: ts.Node) {\r\n    if (ts.isArrayLiteralExpression(node) && node.elements.length === 0) {\r\n      const start = node.getStart(sourceFile);\r\n      if (start >= codeStart && node.end <= codeEnd) {\r\n        const contextualType = checker.getContextualType(node);\r\n        const type = contextualType ?? checker.getTypeAtLocation(node);\r\n        if (isNeverArrayType(type, checker)) {\r\n          starts.add(start - codeStart);\r\n        }\r\n      }\r\n    }\r\n    ts.forEachChild(node, visit);\r\n  }\r\n\r\n  visit(sourceFile);\r\n  return starts;\r\n}\r\n\r\n/**\r\n * Preprocess agent code to add type assertions to empty array literals.\r\n *\r\n * TypeScript infers `[]` as `never[]` when `strictNullChecks: true` and `noImplicitAny: false`.\r\n * This is documented behavior (GitHub issues #36987, #13140, #50505, #51979).\r\n * The TypeScript team recommends using type assertions: `[] as any[]`.\r\n *\r\n * This function transforms `[]` → `[] as any[]` for untyped empty arrays, enabling\r\n * all array operations (push, map, forEach, etc.) to work without type errors.\r\n */\r\nfunction preprocessEmptyArrays(code: string, neverArrayStarts: Set<number>): string {\r\n  if (neverArrayStarts.size === 0) {\r\n    return code;\r\n  }\r\n\r\n  const sourceFile = ts.createSourceFile(\"temp.ts\", code, ts.ScriptTarget.Latest, true);\r\n  const edits: Array<{ pos: number; text: string }> = [];\r\n\r\n  function visit(node: ts.Node) {\r\n    if (ts.isArrayLiteralExpression(node) && node.elements.length === 0) {\r\n      const start = node.getStart(sourceFile);\r\n      if (neverArrayStarts.has(start) && !hasInvalidAssertionContext(node)) {\r\n        const parent = node.parent;\r\n        // `as` binds looser than unary operators, so wrap to keep the assertion on the literal.\r\n        const needsParens =\r\n          ts.isPropertyAccessExpression(parent) ||\r\n          ts.isPropertyAccessChain(parent) ||\r\n          ts.isElementAccessExpression(parent) ||\r\n          ts.isElementAccessChain(parent) ||\r\n          (ts.isCallExpression(parent) && parent.expression === node) ||\r\n          (ts.isCallChain(parent) && parent.expression === node) ||\r\n          ts.isPrefixUnaryExpression(parent) ||\r\n          ts.isPostfixUnaryExpression(parent) ||\r\n          ts.isTypeOfExpression(parent) ||\r\n          ts.isVoidExpression(parent) ||\r\n          ts.isDeleteExpression(parent) ||\r\n          ts.isAwaitExpression(parent) ||\r\n          ts.isYieldExpression(parent);\r\n\r\n        if (needsParens) {\r\n          edits.push({ pos: node.getStart(sourceFile), text: \"(\" });\r\n          edits.push({ pos: node.end, text: \" as any[])\" });\r\n        } else {\r\n          edits.push({ pos: node.end, text: \" as any[]\" });\r\n        }\r\n      }\r\n    }\r\n    ts.forEachChild(node, visit);\r\n  }\r\n\r\n  visit(sourceFile);\r\n\r\n  // Apply edits in reverse order to preserve positions\r\n  let result = code;\r\n  for (const edit of edits.sort((a, b) => b.pos - a.pos)) {\r\n    result = result.slice(0, edit.pos) + edit.text + result.slice(edit.pos);\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function validateTypes(code: string, muxTypes: string): TypeValidationResult {\r\n  const compilerOptions: ts.CompilerOptions = {\r\n    noEmit: true,\r\n    strict: false, // Don't require explicit types on everything\r\n    strictNullChecks: true, // Enable discriminated union narrowing (e.g., `if (!result.success) { result.error }`)\r\n    noImplicitAny: false, // Allow any types\r\n    skipLibCheck: true,\r\n    target: ts.ScriptTarget.ES2020,\r\n    module: ts.ModuleKind.ESNext,\r\n    // ES2023 needed for Array.at(), findLast(), toSorted(), Object.hasOwn(), String.replaceAll()\r\n    // QuickJS 0.31+ supports these features at runtime\r\n    lib: [\"lib.es2023.d.ts\"],\r\n  };\r\n\r\n  // Preprocess empty arrays to avoid never[] inference without overriding contextual typing.\r\n  const originalWrappedCode = wrapAgentCode(code);\r\n  const {\r\n    program: originalProgram,\r\n    host,\r\n    getSourceFile,\r\n    setSourceFile,\r\n  } = createProgramForCode(originalWrappedCode, muxTypes, compilerOptions);\r\n  const originalSourceFile = getSourceFile();\r\n  const neverArrayStarts = getNeverArrayLiteralStarts(\r\n    code,\r\n    originalSourceFile,\r\n    originalProgram.getTypeChecker()\r\n  );\r\n  const preprocessedCode = preprocessEmptyArrays(code, neverArrayStarts);\r\n\r\n  // Wrap code in function to allow return statements (matches runtime behavior)\r\n  // Note: We don't use async because Asyncify makes mux.* calls appear synchronous\r\n  // Types live in a separate virtual file so error line numbers match agent code directly.\r\n  const wrappedCode = wrapAgentCode(preprocessedCode);\r\n\r\n  let program = originalProgram;\r\n  if (wrappedCode !== originalWrappedCode) {\r\n    setSourceFile(wrappedCode);\r\n    program = ts.createProgram(ROOT_FILE_NAMES, compilerOptions, host, originalProgram);\r\n  }\r\n\r\n  const sourceFile = program.getSourceFile(\"agent.ts\") ?? getSourceFile();\r\n  const diagnostics = ts.getPreEmitDiagnostics(program);\r\n\r\n  // Filter to errors in our code only (not lib files)\r\n  // Also filter console redeclaration warning (our minimal console conflicts with lib.dom)\r\n  const errors: TypeValidationError[] = diagnostics\r\n    .filter((d) => d.category === ts.DiagnosticCategory.Error)\r\n    .filter((d) => !d.file || d.file.fileName === \"agent.ts\")\r\n    .filter((d) => !ts.flattenDiagnosticMessageText(d.messageText, \"\").includes(\"console\"))\r\n    // Allow dynamic property WRITES on empty object literals - Claude frequently uses\r\n    // `const results = {}; results.foo = mux.file_read(...)` to collate parallel reads.\r\n    // Only suppress when the property access is on the LEFT side of an assignment.\r\n    // Reads like `return results.typo` must still error.\r\n    .filter((d) => !isEmptyObjectWriteError(d, sourceFile))\r\n    .map((d) => {\r\n      const message = ts.flattenDiagnosticMessageText(d.messageText, \" \");\r\n      // Extract line number if available\r\n      if (d.file && d.start !== undefined) {\r\n        const { line, character } = d.file.getLineAndCharacterOfPosition(d.start);\r\n        // TS line is 0-indexed. Wrapper adds 1 line before agent code, so:\r\n        // TS line 0 = wrapper, TS line 1 = agent line 1, TS line 2 = agent line 2, etc.\r\n        // This means TS 0-indexed line number equals agent 1-indexed line number.\r\n        // Only report if within agent code bounds (filter out wrapper and muxTypes)\r\n        const agentCodeLines = code.split(\"\\n\").length;\r\n        if (line >= 1 && line <= agentCodeLines) {\r\n          return { message, line, column: character + 1 };\r\n        }\r\n      }\r\n      return { message };\r\n    });\r\n\r\n  return { valid: errors.length === 0, errors, sourceFile: originalSourceFile };\r\n}\r\n"]}