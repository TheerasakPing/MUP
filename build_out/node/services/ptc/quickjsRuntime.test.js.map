{"version":3,"file":"quickjsRuntime.test.js","sourceRoot":"","sources":["../../../../src/node/services/ptc/quickjsRuntime.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, it, beforeEach, afterEach } from \"bun:test\";\nimport { QuickJSRuntime, QuickJSRuntimeFactory } from \"./quickjsRuntime\";\nimport type { PTCEvent } from \"./types\";\n\ndescribe(\"QuickJSRuntime\", () => {\n  let runtime: QuickJSRuntime;\n\n  beforeEach(async () => {\n    runtime = await QuickJSRuntime.create();\n  });\n\n  afterEach(() => {\n    runtime.dispose();\n  });\n\n  describe(\"basic evaluation\", () => {\n    it(\"executes basic JS and returns result\", async () => {\n      const result = await runtime.eval(\"return 1 + 1;\");\n      expect(result.success).toBe(true);\n      expect(result.result).toBe(2);\n      expect(result.duration_ms).toBeGreaterThanOrEqual(0);\n    });\n\n    it(\"handles string results\", async () => {\n      const result = await runtime.eval('return \"hello world\";');\n      expect(result.success).toBe(true);\n      expect(result.result).toBe(\"hello world\");\n    });\n\n    it(\"handles object results\", async () => {\n      const result = await runtime.eval('return { foo: \"bar\", num: 42 };');\n      expect(result.success).toBe(true);\n      expect(result.result).toEqual({ foo: \"bar\", num: 42 });\n    });\n\n    it(\"handles array results\", async () => {\n      const result = await runtime.eval(\"return [1, 2, 3];\");\n      expect(result.success).toBe(true);\n      expect(result.result).toEqual([1, 2, 3]);\n    });\n\n    it(\"handles undefined return (no explicit return)\", async () => {\n      const result = await runtime.eval(\"const x = 1;\");\n      expect(result.success).toBe(true);\n      expect(result.result).toBeUndefined();\n    });\n\n    it(\"handles null return\", async () => {\n      const result = await runtime.eval(\"return null;\");\n      expect(result.success).toBe(true);\n      expect(result.result).toBeNull();\n    });\n\n    it(\"handles syntax errors\", async () => {\n      const result = await runtime.eval(\"return {{{;\");\n      expect(result.success).toBe(false);\n      expect(result.error).toContain(\"SyntaxError\");\n    });\n\n    it(\"handles runtime errors\", async () => {\n      const result = await runtime.eval(\"throw new Error('boom');\");\n      expect(result.success).toBe(false);\n      expect(result.error).toContain(\"boom\");\n    });\n\n    // Note: With asyncify, async host functions appear SYNC to QuickJS.\n    // Native JS await/Promise is not supported - use sync calls to host functions.\n    it(\"handles multiple statements\", async () => {\n      const result = await runtime.eval(`\n        const x = 10;\n        const y = 20;\n        return x + y;\n      `);\n      expect(result.success).toBe(true);\n      expect(result.result).toBe(30);\n    });\n  });\n\n  describe(\"registered functions\", () => {\n    // With asyncify, async host functions appear SYNCHRONOUS to QuickJS.\n    // No 'await' needed in QuickJS code - evalCodeAsync suspends the WASM module.\n    it(\"calls registered async functions (sync from QuickJS perspective)\", async () => {\n      runtime.registerFunction(\"fetchData\", () => Promise.resolve({ value: 42 }));\n\n      // Note: NO await in the QuickJS code - the function appears sync\n      const result = await runtime.eval(\"return fetchData();\");\n      expect(result.success).toBe(true);\n      expect(result.result).toEqual({ value: 42 });\n    });\n\n    it(\"passes arguments to registered functions\", async () => {\n      runtime.registerFunction(\"add\", (...args: unknown[]) => {\n        const [a, b] = args as [number, number];\n        return Promise.resolve(a + b);\n      });\n\n      const result = await runtime.eval(\"return add(10, 20);\");\n      expect(result.success).toBe(true);\n      expect(result.result).toBe(30);\n    });\n\n    it(\"handles function errors\", async () => {\n      runtime.registerFunction(\"failFunc\", () => {\n        return Promise.reject(new Error(\"function failed\"));\n      });\n\n      const result = await runtime.eval(\"return failFunc();\");\n      expect(result.success).toBe(false);\n      expect(result.error).toContain(\"function failed\");\n    });\n\n    it(\"records tool calls on success\", async () => {\n      runtime.registerFunction(\"myTool\", (arg: unknown) => Promise.resolve({ received: arg }));\n\n      const result = await runtime.eval('return myTool({ input: \"test\" });');\n      expect(result.success).toBe(true);\n      expect(result.toolCalls).toHaveLength(1);\n      expect(result.toolCalls[0].toolName).toBe(\"myTool\");\n      expect(result.toolCalls[0].args).toEqual({ input: \"test\" });\n      expect(result.toolCalls[0].result).toEqual({ received: { input: \"test\" } });\n      expect(result.toolCalls[0].duration_ms).toBeGreaterThanOrEqual(0);\n    });\n\n    it(\"records tool calls on failure\", async () => {\n      runtime.registerFunction(\"failTool\", () => {\n        return Promise.reject(new Error(\"tool error\"));\n      });\n\n      const result = await runtime.eval(\"try { failTool(); } catch(e) { return 'caught'; }\");\n      expect(result.success).toBe(true);\n      expect(result.result).toBe(\"caught\");\n      expect(result.toolCalls).toHaveLength(1);\n      expect(result.toolCalls[0].toolName).toBe(\"failTool\");\n      expect(result.toolCalls[0].error).toContain(\"tool error\");\n    });\n  });\n\n  describe(\"registered objects\", () => {\n    it(\"calls methods on registered objects\", async () => {\n      runtime.registerObject(\"mux\", {\n        fileRead: (...args: unknown[]) => Promise.resolve({ content: `File: ${String(args[0])}` }),\n        bash: (...args: unknown[]) => Promise.resolve({ output: `Ran: ${String(args[0])}` }),\n      });\n\n      // No await needed - asyncified methods appear sync\n      const result = await runtime.eval(`\n        const file = mux.fileRead(\"test.txt\");\n        const bash = mux.bash(\"ls\");\n        return { file, bash };\n      `);\n\n      expect(result.success).toBe(true);\n      expect(result.result).toEqual({\n        file: { content: \"File: test.txt\" },\n        bash: { output: \"Ran: ls\" },\n      });\n    });\n\n    it(\"records tool calls with full name\", async () => {\n      runtime.registerObject(\"mux\", {\n        fileRead: () => Promise.resolve(\"content\"),\n      });\n\n      const result = await runtime.eval('mux.fileRead(\"test.txt\");');\n      expect(result.toolCalls).toHaveLength(1);\n      expect(result.toolCalls[0].toolName).toBe(\"fileRead\");\n    });\n  });\n\n  describe(\"console capture\", () => {\n    it(\"captures console.log output\", async () => {\n      const result = await runtime.eval(`\n        console.log(\"hello\", 123);\n        return \"done\";\n      `);\n\n      expect(result.success).toBe(true);\n      expect(result.consoleOutput).toHaveLength(1);\n      expect(result.consoleOutput[0].level).toBe(\"log\");\n      expect(result.consoleOutput[0].args).toEqual([\"hello\", 123]);\n      expect(result.consoleOutput[0].timestamp).toBeGreaterThan(0);\n    });\n\n    it(\"captures console.warn and console.error\", async () => {\n      const result = await runtime.eval(`\n        console.log(\"info\");\n        console.warn(\"warning\");\n        console.error(\"error\");\n        return;\n      `);\n\n      expect(result.consoleOutput).toHaveLength(3);\n      expect(result.consoleOutput[0].level).toBe(\"log\");\n      expect(result.consoleOutput[1].level).toBe(\"warn\");\n      expect(result.consoleOutput[2].level).toBe(\"error\");\n    });\n  });\n\n  describe(\"event streaming\", () => {\n    it(\"emits tool-call-start and tool-call-end events\", async () => {\n      const events: PTCEvent[] = [];\n      runtime.onEvent((e) => events.push(e));\n\n      runtime.registerFunction(\"myTool\", () => Promise.resolve(\"result\"));\n      await runtime.eval(\"myTool()\");\n\n      const toolEvents = events.filter(\n        (e) => e.type === \"tool-call-start\" || e.type === \"tool-call-end\"\n      );\n      expect(toolEvents).toHaveLength(2);\n\n      expect(toolEvents[0].type).toBe(\"tool-call-start\");\n      expect(toolEvents[0].toolName).toBe(\"myTool\");\n\n      expect(toolEvents[1].type).toBe(\"tool-call-end\");\n      expect(toolEvents[1].toolName).toBe(\"myTool\");\n      if (toolEvents[1].type === \"tool-call-end\") {\n        expect(toolEvents[1].result).toBe(\"result\");\n      }\n    });\n\n    it(\"emits console events\", async () => {\n      const events: PTCEvent[] = [];\n      runtime.onEvent((e) => events.push(e));\n\n      await runtime.eval('console.log(\"test\", 42)');\n\n      const consoleEvents = events.filter((e) => e.type === \"console\");\n      expect(consoleEvents).toHaveLength(1);\n      expect(consoleEvents[0].type).toBe(\"console\");\n      if (consoleEvents[0].type === \"console\") {\n        expect(consoleEvents[0].level).toBe(\"log\");\n        expect(consoleEvents[0].args).toEqual([\"test\", 42]);\n      }\n    });\n  });\n\n  describe(\"partial results on failure\", () => {\n    it(\"returns partial results when error occurs after tool calls\", async () => {\n      runtime.registerFunction(\"succeed\", () => Promise.resolve(\"ok\"));\n      runtime.registerFunction(\"fail\", () => {\n        return Promise.reject(new Error(\"boom\"));\n      });\n\n      const result = await runtime.eval(`\n        succeed();\n        fail();\n      `);\n\n      expect(result.success).toBe(false);\n      expect(result.error).toContain(\"boom\");\n      expect(result.toolCalls).toHaveLength(2);\n      expect(result.toolCalls[0].result).toBe(\"ok\");\n      expect(result.toolCalls[1].error).toContain(\"boom\");\n    });\n\n    it(\"preserves console output on failure\", async () => {\n      const result = await runtime.eval(`\n        console.log(\"before error\");\n        throw new Error(\"fail\");\n      `);\n\n      expect(result.success).toBe(false);\n      expect(result.consoleOutput).toHaveLength(1);\n      expect(result.consoleOutput[0].args).toEqual([\"before error\"]);\n    });\n  });\n\n  describe(\"limits\", () => {\n    it(\"applies memory limits\", async () => {\n      runtime.setLimits({ memoryBytes: 1024 * 1024 }); // 1MB\n\n      // Try to allocate a large array - should fail\n      const result = await runtime.eval(`\n        const arr = new Array(10 * 1024 * 1024).fill(1);\n        return arr.length;\n      `);\n\n      // Should either fail or succeed with limited allocation\n      // QuickJS may throw or return partial result\n      expect(result.success).toBe(false);\n    });\n\n    it(\"applies timeout limits\", async () => {\n      runtime.setLimits({ timeoutMs: 100 }); // 100ms timeout\n\n      const result = await runtime.eval(`\n        while(true) {} // Infinite loop\n      `);\n\n      expect(result.success).toBe(false);\n      expect(result.error).toContain(\"timeout\");\n    });\n\n    it(\"aborts signal when timeout fires during async host function\", async () => {\n      // This tests the setTimeout-based timeout's effect on the abort signal.\n      // The interrupt handler only fires during QuickJS execution, but when\n      // waiting for an async host function, the setTimeout aborts the signal.\n      //\n      // Important: The host function itself won't be cancelled mid-flight\n      // (JavaScript can't interrupt Promises), but the signal will be aborted\n      // so subsequent tool calls will see it and fail fast.\n      let firstCallCompleted = false;\n\n      runtime.registerFunction(\"slowOp\", async () => {\n        // Sleep for 200ms\n        await new Promise((resolve) => setTimeout(resolve, 200));\n        firstCallCompleted = true;\n        return \"done\";\n      });\n\n      // Check the abort signal state from QuickJS (sync is fine, made async for type)\n      runtime.registerFunction(\"checkAbortState\", () => {\n        return Promise.resolve({ aborted: runtime.getAbortSignal()?.aborted ?? false });\n      });\n\n      runtime.setLimits({ timeoutMs: 100 }); // 100ms timeout\n\n      const result = await runtime.eval(`\n        slowOp();           // Takes 200ms, timeout fires at 100ms\n        checkAbortState();  // Should show aborted = true\n        slowOp();           // This would start after abort\n        return \"finished\";\n      `);\n\n      // The first call completes (can't be interrupted mid-Promise)\n      expect(firstCallCompleted).toBe(true);\n      // But the overall execution fails due to timeout\n      expect(result.success).toBe(false);\n      expect(result.error).toContain(\"timeout\");\n    });\n  });\n\n  describe(\"abort\", () => {\n    it(\"can abort during async host function\", async () => {\n      // Abort is checked at the start of each async host function call\n      let callCount = 0;\n      runtime.registerFunction(\"slowOp\", async () => {\n        callCount++;\n        // Simulate slow async work\n        await new Promise((resolve) => setTimeout(resolve, 200));\n        return \"done\";\n      });\n\n      // Queue multiple calls, abort after first starts\n      const evalPromise = runtime.eval(`\n        slowOp();\n        slowOp(); // Should be aborted before running\n        return \"finished\";\n      `);\n\n      // Abort after first function starts but before it completes\n      setTimeout(() => runtime.abort(), 100);\n\n      await evalPromise;\n      // First call may complete, but second should be aborted\n      // (timing dependent, but abort should eventually take effect)\n      expect(callCount).toBeLessThanOrEqual(2);\n    });\n\n    it(\"abort method exists and can be called\", () => {\n      // Basic sanity test that abort() is callable\n      expect(() => runtime.abort()).not.toThrow();\n    });\n  });\n\n  describe(\"dispose\", () => {\n    it(\"throws on eval after dispose\", async () => {\n      runtime.dispose();\n\n      try {\n        await runtime.eval(\"return 1\");\n        expect.unreachable(\"Should have thrown\");\n      } catch (e) {\n        expect(String(e)).toContain(\"disposed\");\n      }\n    });\n\n    it(\"can be disposed multiple times safely\", () => {\n      runtime.dispose();\n      runtime.dispose(); // Should not throw\n    });\n\n    it(\"supports Symbol.dispose\", () => {\n      expect(typeof runtime[Symbol.dispose]).toBe(\"function\");\n      runtime[Symbol.dispose]();\n    });\n  });\n\n  describe(\"friendly error messages for unavailable globals\", () => {\n    it(\"provides friendly error for process\", async () => {\n      const result = await runtime.eval(\"const env = process.env;\");\n      expect(result.success).toBe(false);\n      expect(result.error).toContain(\"'process' is not available in the sandbox\");\n      expect(result.error).toContain(\"mux.*\");\n    });\n\n    it(\"provides friendly error for window\", async () => {\n      const result = await runtime.eval(\"window.alert('hi');\");\n      expect(result.success).toBe(false);\n      expect(result.error).toContain(\"'window' is not available in the sandbox\");\n    });\n\n    it(\"provides friendly error for fetch\", async () => {\n      const result = await runtime.eval(\"fetch('https://example.com');\");\n      expect(result.success).toBe(false);\n      expect(result.error).toContain(\"'fetch' is not available in the sandbox\");\n    });\n\n    it(\"provides friendly error for require\", async () => {\n      const result = await runtime.eval(\"const fs = require('fs');\");\n      expect(result.success).toBe(false);\n      expect(result.error).toContain(\"'require' is not available in the sandbox\");\n    });\n\n    it(\"provides friendly error for document\", async () => {\n      const result = await runtime.eval(\"document.getElementById('test');\");\n      expect(result.success).toBe(false);\n      expect(result.error).toContain(\"'document' is not available in the sandbox\");\n    });\n\n    it(\"keeps standard ReferenceError for user-defined undefined vars\", async () => {\n      const result = await runtime.eval(\"const x = myUndefinedVar;\");\n      expect(result.success).toBe(false);\n      // Should NOT get the friendly message since it's not a known unavailable global\n      expect(result.error).not.toContain(\"mux.*\");\n      expect(result.error).toContain(\"not defined\");\n    });\n  });\n});\n\ndescribe(\"QuickJSRuntimeFactory\", () => {\n  it(\"creates new runtime instances\", async () => {\n    const factory = new QuickJSRuntimeFactory();\n    const runtime = await factory.create();\n\n    expect(runtime).toBeInstanceOf(QuickJSRuntime);\n\n    const result = await runtime.eval(\"return 42\");\n    expect(result.success).toBe(true);\n    expect(result.result).toBe(42);\n\n    runtime.dispose();\n  });\n});\n\ndescribe(\"sequential execution\", () => {\n  it(\"executes async host functions sequentially even in loops\", async () => {\n    // This test proves that Asyncify causes async host functions to execute\n    // sequentially, not in parallel. Even constructs that would normally\n    // run concurrently (like Promise.all) execute one-at-a-time.\n    const runtime = await QuickJSRuntime.create();\n    const callOrder: number[] = [];\n\n    runtime.registerObject(\"test\", {\n      trackOrder: async (args: unknown) => {\n        const id = (args as { id: number }).id;\n        callOrder.push(id);\n        // Small delay - if parallel, calls would interleave\n        await new Promise((r) => setTimeout(r, 10));\n        return { id };\n      },\n    });\n\n    const result = await runtime.eval(`\n      // Due to Asyncify, these calls appear synchronous and execute in order\n      const r1 = test.trackOrder({ id: 1 });\n      const r2 = test.trackOrder({ id: 2 });\n      const r3 = test.trackOrder({ id: 3 });\n      return [r1.id, r2.id, r3.id];\n    `);\n\n    runtime.dispose();\n\n    expect(result.success).toBe(true);\n    expect(result.result).toEqual([1, 2, 3]);\n    // Call order is deterministically sequential\n    expect(callOrder).toEqual([1, 2, 3]);\n  });\n});\n\ndescribe(\"marshal edge cases\", () => {\n  let runtime: QuickJSRuntime;\n\n  beforeEach(async () => {\n    runtime = await QuickJSRuntime.create();\n  });\n\n  afterEach(() => {\n    runtime.dispose();\n  });\n\n  it(\"handles BigInt values natively\", async () => {\n    runtime.registerFunction(\"getBigInt\", () => Promise.resolve(BigInt(\"9007199254740993\")));\n\n    const result = await runtime.eval(\"return getBigInt();\");\n    expect(result.success).toBe(true);\n    // QuickJS returns bigints as numbers if they fit, or as BigInt\n    expect(result.result).toBe(9007199254740993n);\n  });\n\n  it(\"preserves undefined in objects\", async () => {\n    runtime.registerFunction(\"getObjWithUndefined\", () =>\n      Promise.resolve({ a: 1, b: undefined, c: 3 })\n    );\n\n    const result = await runtime.eval(`\n      const obj = getObjWithUndefined();\n      return { hasB: 'b' in obj, bValue: obj.b, a: obj.a, c: obj.c };\n    `);\n    expect(result.success).toBe(true);\n    expect(result.result).toEqual({ hasB: true, bValue: undefined, a: 1, c: 3 });\n  });\n\n  it(\"preserves undefined in arrays (not converted to null)\", async () => {\n    runtime.registerFunction(\"getArrayWithUndefined\", () => Promise.resolve([1, undefined, 3]));\n\n    const result = await runtime.eval(`\n      const arr = getArrayWithUndefined();\n      return { len: arr.length, first: arr[0], second: arr[1], third: arr[2] };\n    `);\n    expect(result.success).toBe(true);\n    expect(result.result).toEqual({ len: 3, first: 1, second: undefined, third: 3 });\n  });\n\n  it(\"handles circular references with [Circular] placeholder\", async () => {\n    const circular: Record<string, unknown> = { a: 1 };\n    circular.self = circular;\n    runtime.registerFunction(\"getCircular\", () => Promise.resolve(circular));\n\n    const result = await runtime.eval(`\n      const obj = getCircular();\n      return { a: obj.a, selfType: typeof obj.self, selfValue: obj.self };\n    `);\n    expect(result.success).toBe(true);\n    expect(result.result).toEqual({ a: 1, selfType: \"string\", selfValue: \"[Circular]\" });\n  });\n\n  it(\"marks functions as unserializable\", async () => {\n    runtime.registerFunction(\"getFunction\", () =>\n      Promise.resolve({ fn: () => \"hello\", value: 42 })\n    );\n\n    const result = await runtime.eval(`\n      const obj = getFunction();\n      return { fnType: obj.fn.__unserializable__, value: obj.value };\n    `);\n    expect(result.success).toBe(true);\n    expect(result.result).toEqual({ fnType: \"function\", value: 42 });\n  });\n\n  it(\"marks symbols as unserializable\", async () => {\n    runtime.registerFunction(\"getSymbol\", () =>\n      Promise.resolve({ sym: Symbol(\"test\"), value: 42 })\n    );\n\n    const result = await runtime.eval(`\n      const obj = getSymbol();\n      return { symType: obj.sym.__unserializable__, value: obj.value };\n    `);\n    expect(result.success).toBe(true);\n    expect(result.result).toEqual({ symType: \"symbol\", value: 42 });\n  });\n\n  it(\"handles deeply nested objects\", async () => {\n    runtime.registerFunction(\"getDeep\", () =>\n      Promise.resolve({ a: { b: { c: { d: { e: \"deep\" } } } } })\n    );\n\n    const result = await runtime.eval(\"return getDeep().a.b.c.d.e;\");\n    expect(result.success).toBe(true);\n    expect(result.result).toBe(\"deep\");\n  });\n\n  it(\"handles arrays with mixed types\", async () => {\n    runtime.registerFunction(\"getMixed\", () =>\n      Promise.resolve([1, \"two\", { three: 3 }, [4, 5], null, true])\n    );\n\n    const result = await runtime.eval(\"return getMixed();\");\n    expect(result.success).toBe(true);\n    expect(result.result).toEqual([1, \"two\", { three: 3 }, [4, 5], null, true]);\n  });\n\n  it(\"handles empty objects and arrays\", async () => {\n    runtime.registerFunction(\"getEmpty\", () => Promise.resolve({ obj: {}, arr: [] }));\n\n    const result = await runtime.eval(\"return getEmpty();\");\n    expect(result.success).toBe(true);\n    expect(result.result).toEqual({ obj: {}, arr: [] });\n  });\n\n  it(\"converts Date to ISO string (matches JSON.stringify)\", async () => {\n    const testDate = new Date(\"2024-06-15T12:30:00.000Z\");\n    runtime.registerFunction(\"getDate\", () =>\n      Promise.resolve({ created: testDate, nested: { date: testDate } })\n    );\n\n    const result = await runtime.eval(\"return getDate();\");\n    expect(result.success).toBe(true);\n    expect(result.result).toEqual({\n      created: \"2024-06-15T12:30:00.000Z\",\n      nested: { date: \"2024-06-15T12:30:00.000Z\" },\n    });\n  });\n\n  it(\"handles shared references (same object in multiple places) without marking as circular\", async () => {\n    // Shared reference is NOT circular - same object appears twice but no cycle\n    const shared = { id: 42, name: \"shared\" };\n    const obj = { a: shared, b: shared, c: { nested: shared } };\n    runtime.registerFunction(\"getShared\", () => Promise.resolve(obj));\n\n    const result = await runtime.eval(`\n      const obj = getShared();\n      return {\n        aId: obj.a.id,\n        bId: obj.b.id,\n        cNestedId: obj.c.nested.id,\n        // Verify none are \"[Circular]\" strings\n        aType: typeof obj.a,\n        bType: typeof obj.b\n      };\n    `);\n    expect(result.success).toBe(true);\n    expect(result.result).toEqual({\n      aId: 42,\n      bId: 42,\n      cNestedId: 42,\n      aType: \"object\",\n      bType: \"object\",\n    });\n  });\n\n  it(\"still detects true circular references\", async () => {\n    // True cycle: a -> b -> a\n    const a: Record<string, unknown> = { name: \"a\" };\n    const b: Record<string, unknown> = { name: \"b\" };\n    a.ref = b;\n    b.ref = a; // Creates cycle\n    runtime.registerFunction(\"getCycle\", () => Promise.resolve(a));\n\n    const result = await runtime.eval(`\n      const obj = getCycle();\n      return {\n        name: obj.name,\n        refName: obj.ref.name,\n        refRefValue: obj.ref.ref  // This points back to 'a' - should be \"[Circular]\"\n      };\n    `);\n    expect(result.success).toBe(true);\n    expect(result.result).toEqual({\n      name: \"a\",\n      refName: \"b\",\n      refRefValue: \"[Circular]\",\n    });\n  });\n});\n"]}