{"version":3,"file":"quickjsRuntime.test.js","sourceRoot":"","sources":["../../../../src/node/services/ptc/quickjsRuntime.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, it, beforeEach, afterEach } from \"bun:test\";\r\nimport { QuickJSRuntime, QuickJSRuntimeFactory } from \"./quickjsRuntime\";\r\nimport type { PTCEvent } from \"./types\";\r\n\r\ndescribe(\"QuickJSRuntime\", () => {\r\n  let runtime: QuickJSRuntime;\r\n\r\n  beforeEach(async () => {\r\n    runtime = await QuickJSRuntime.create();\r\n  });\r\n\r\n  afterEach(() => {\r\n    runtime.dispose();\r\n  });\r\n\r\n  describe(\"basic evaluation\", () => {\r\n    it(\"executes basic JS and returns result\", async () => {\r\n      const result = await runtime.eval(\"return 1 + 1;\");\r\n      expect(result.success).toBe(true);\r\n      expect(result.result).toBe(2);\r\n      expect(result.duration_ms).toBeGreaterThanOrEqual(0);\r\n    });\r\n\r\n    it(\"handles string results\", async () => {\r\n      const result = await runtime.eval('return \"hello world\";');\r\n      expect(result.success).toBe(true);\r\n      expect(result.result).toBe(\"hello world\");\r\n    });\r\n\r\n    it(\"handles object results\", async () => {\r\n      const result = await runtime.eval('return { foo: \"bar\", num: 42 };');\r\n      expect(result.success).toBe(true);\r\n      expect(result.result).toEqual({ foo: \"bar\", num: 42 });\r\n    });\r\n\r\n    it(\"handles array results\", async () => {\r\n      const result = await runtime.eval(\"return [1, 2, 3];\");\r\n      expect(result.success).toBe(true);\r\n      expect(result.result).toEqual([1, 2, 3]);\r\n    });\r\n\r\n    it(\"handles undefined return (no explicit return)\", async () => {\r\n      const result = await runtime.eval(\"const x = 1;\");\r\n      expect(result.success).toBe(true);\r\n      expect(result.result).toBeUndefined();\r\n    });\r\n\r\n    it(\"handles null return\", async () => {\r\n      const result = await runtime.eval(\"return null;\");\r\n      expect(result.success).toBe(true);\r\n      expect(result.result).toBeNull();\r\n    });\r\n\r\n    it(\"handles syntax errors\", async () => {\r\n      const result = await runtime.eval(\"return {{{;\");\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toContain(\"SyntaxError\");\r\n    });\r\n\r\n    it(\"handles runtime errors\", async () => {\r\n      const result = await runtime.eval(\"throw new Error('boom');\");\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toContain(\"boom\");\r\n    });\r\n\r\n    // Note: With asyncify, async host functions appear SYNC to QuickJS.\r\n    // Native JS await/Promise is not supported - use sync calls to host functions.\r\n    it(\"handles multiple statements\", async () => {\r\n      const result = await runtime.eval(`\r\n        const x = 10;\r\n        const y = 20;\r\n        return x + y;\r\n      `);\r\n      expect(result.success).toBe(true);\r\n      expect(result.result).toBe(30);\r\n    });\r\n  });\r\n\r\n  describe(\"registered functions\", () => {\r\n    // With asyncify, async host functions appear SYNCHRONOUS to QuickJS.\r\n    // No 'await' needed in QuickJS code - evalCodeAsync suspends the WASM module.\r\n    it(\"calls registered async functions (sync from QuickJS perspective)\", async () => {\r\n      runtime.registerFunction(\"fetchData\", () => Promise.resolve({ value: 42 }));\r\n\r\n      // Note: NO await in the QuickJS code - the function appears sync\r\n      const result = await runtime.eval(\"return fetchData();\");\r\n      expect(result.success).toBe(true);\r\n      expect(result.result).toEqual({ value: 42 });\r\n    });\r\n\r\n    it(\"passes arguments to registered functions\", async () => {\r\n      runtime.registerFunction(\"add\", (...args: unknown[]) => {\r\n        const [a, b] = args as [number, number];\r\n        return Promise.resolve(a + b);\r\n      });\r\n\r\n      const result = await runtime.eval(\"return add(10, 20);\");\r\n      expect(result.success).toBe(true);\r\n      expect(result.result).toBe(30);\r\n    });\r\n\r\n    it(\"handles function errors\", async () => {\r\n      runtime.registerFunction(\"failFunc\", () => {\r\n        return Promise.reject(new Error(\"function failed\"));\r\n      });\r\n\r\n      const result = await runtime.eval(\"return failFunc();\");\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toContain(\"function failed\");\r\n    });\r\n\r\n    it(\"records tool calls on success\", async () => {\r\n      runtime.registerFunction(\"myTool\", (arg: unknown) => Promise.resolve({ received: arg }));\r\n\r\n      const result = await runtime.eval('return myTool({ input: \"test\" });');\r\n      expect(result.success).toBe(true);\r\n      expect(result.toolCalls).toHaveLength(1);\r\n      expect(result.toolCalls[0].toolName).toBe(\"myTool\");\r\n      expect(result.toolCalls[0].args).toEqual({ input: \"test\" });\r\n      expect(result.toolCalls[0].result).toEqual({ received: { input: \"test\" } });\r\n      expect(result.toolCalls[0].duration_ms).toBeGreaterThanOrEqual(0);\r\n    });\r\n\r\n    it(\"records tool calls on failure\", async () => {\r\n      runtime.registerFunction(\"failTool\", () => {\r\n        return Promise.reject(new Error(\"tool error\"));\r\n      });\r\n\r\n      const result = await runtime.eval(\"try { failTool(); } catch(e) { return 'caught'; }\");\r\n      expect(result.success).toBe(true);\r\n      expect(result.result).toBe(\"caught\");\r\n      expect(result.toolCalls).toHaveLength(1);\r\n      expect(result.toolCalls[0].toolName).toBe(\"failTool\");\r\n      expect(result.toolCalls[0].error).toContain(\"tool error\");\r\n    });\r\n  });\r\n\r\n  describe(\"registered objects\", () => {\r\n    it(\"calls methods on registered objects\", async () => {\r\n      runtime.registerObject(\"mux\", {\r\n        fileRead: (...args: unknown[]) => Promise.resolve({ content: `File: ${String(args[0])}` }),\r\n        bash: (...args: unknown[]) => Promise.resolve({ output: `Ran: ${String(args[0])}` }),\r\n      });\r\n\r\n      // No await needed - asyncified methods appear sync\r\n      const result = await runtime.eval(`\r\n        const file = mux.fileRead(\"test.txt\");\r\n        const bash = mux.bash(\"ls\");\r\n        return { file, bash };\r\n      `);\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.result).toEqual({\r\n        file: { content: \"File: test.txt\" },\r\n        bash: { output: \"Ran: ls\" },\r\n      });\r\n    });\r\n\r\n    it(\"records tool calls with full name\", async () => {\r\n      runtime.registerObject(\"mux\", {\r\n        fileRead: () => Promise.resolve(\"content\"),\r\n      });\r\n\r\n      const result = await runtime.eval('mux.fileRead(\"test.txt\");');\r\n      expect(result.toolCalls).toHaveLength(1);\r\n      expect(result.toolCalls[0].toolName).toBe(\"fileRead\");\r\n    });\r\n  });\r\n\r\n  describe(\"console capture\", () => {\r\n    it(\"captures console.log output\", async () => {\r\n      const result = await runtime.eval(`\r\n        console.log(\"hello\", 123);\r\n        return \"done\";\r\n      `);\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.consoleOutput).toHaveLength(1);\r\n      expect(result.consoleOutput[0].level).toBe(\"log\");\r\n      expect(result.consoleOutput[0].args).toEqual([\"hello\", 123]);\r\n      expect(result.consoleOutput[0].timestamp).toBeGreaterThan(0);\r\n    });\r\n\r\n    it(\"captures console.warn and console.error\", async () => {\r\n      const result = await runtime.eval(`\r\n        console.log(\"info\");\r\n        console.warn(\"warning\");\r\n        console.error(\"error\");\r\n        return;\r\n      `);\r\n\r\n      expect(result.consoleOutput).toHaveLength(3);\r\n      expect(result.consoleOutput[0].level).toBe(\"log\");\r\n      expect(result.consoleOutput[1].level).toBe(\"warn\");\r\n      expect(result.consoleOutput[2].level).toBe(\"error\");\r\n    });\r\n  });\r\n\r\n  describe(\"event streaming\", () => {\r\n    it(\"emits tool-call-start and tool-call-end events\", async () => {\r\n      const events: PTCEvent[] = [];\r\n      runtime.onEvent((e) => events.push(e));\r\n\r\n      runtime.registerFunction(\"myTool\", () => Promise.resolve(\"result\"));\r\n      await runtime.eval(\"myTool()\");\r\n\r\n      const toolEvents = events.filter(\r\n        (e) => e.type === \"tool-call-start\" || e.type === \"tool-call-end\"\r\n      );\r\n      expect(toolEvents).toHaveLength(2);\r\n\r\n      expect(toolEvents[0].type).toBe(\"tool-call-start\");\r\n      expect(toolEvents[0].toolName).toBe(\"myTool\");\r\n\r\n      expect(toolEvents[1].type).toBe(\"tool-call-end\");\r\n      expect(toolEvents[1].toolName).toBe(\"myTool\");\r\n      if (toolEvents[1].type === \"tool-call-end\") {\r\n        expect(toolEvents[1].result).toBe(\"result\");\r\n      }\r\n    });\r\n\r\n    it(\"emits console events\", async () => {\r\n      const events: PTCEvent[] = [];\r\n      runtime.onEvent((e) => events.push(e));\r\n\r\n      await runtime.eval('console.log(\"test\", 42)');\r\n\r\n      const consoleEvents = events.filter((e) => e.type === \"console\");\r\n      expect(consoleEvents).toHaveLength(1);\r\n      expect(consoleEvents[0].type).toBe(\"console\");\r\n      if (consoleEvents[0].type === \"console\") {\r\n        expect(consoleEvents[0].level).toBe(\"log\");\r\n        expect(consoleEvents[0].args).toEqual([\"test\", 42]);\r\n      }\r\n    });\r\n  });\r\n\r\n  describe(\"partial results on failure\", () => {\r\n    it(\"returns partial results when error occurs after tool calls\", async () => {\r\n      runtime.registerFunction(\"succeed\", () => Promise.resolve(\"ok\"));\r\n      runtime.registerFunction(\"fail\", () => {\r\n        return Promise.reject(new Error(\"boom\"));\r\n      });\r\n\r\n      const result = await runtime.eval(`\r\n        succeed();\r\n        fail();\r\n      `);\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toContain(\"boom\");\r\n      expect(result.toolCalls).toHaveLength(2);\r\n      expect(result.toolCalls[0].result).toBe(\"ok\");\r\n      expect(result.toolCalls[1].error).toContain(\"boom\");\r\n    });\r\n\r\n    it(\"preserves console output on failure\", async () => {\r\n      const result = await runtime.eval(`\r\n        console.log(\"before error\");\r\n        throw new Error(\"fail\");\r\n      `);\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.consoleOutput).toHaveLength(1);\r\n      expect(result.consoleOutput[0].args).toEqual([\"before error\"]);\r\n    });\r\n  });\r\n\r\n  describe(\"limits\", () => {\r\n    it(\"applies memory limits\", async () => {\r\n      runtime.setLimits({ memoryBytes: 1024 * 1024 }); // 1MB\r\n\r\n      // Try to allocate a large array - should fail\r\n      const result = await runtime.eval(`\r\n        const arr = new Array(10 * 1024 * 1024).fill(1);\r\n        return arr.length;\r\n      `);\r\n\r\n      // Should either fail or succeed with limited allocation\r\n      // QuickJS may throw or return partial result\r\n      expect(result.success).toBe(false);\r\n    });\r\n\r\n    it(\"applies timeout limits\", async () => {\r\n      runtime.setLimits({ timeoutMs: 100 }); // 100ms timeout\r\n\r\n      const result = await runtime.eval(`\r\n        while(true) {} // Infinite loop\r\n      `);\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toContain(\"timeout\");\r\n    });\r\n\r\n    it(\"aborts signal when timeout fires during async host function\", async () => {\r\n      // This tests the setTimeout-based timeout's effect on the abort signal.\r\n      // The interrupt handler only fires during QuickJS execution, but when\r\n      // waiting for an async host function, the setTimeout aborts the signal.\r\n      //\r\n      // Important: The host function itself won't be cancelled mid-flight\r\n      // (JavaScript can't interrupt Promises), but the signal will be aborted\r\n      // so subsequent tool calls will see it and fail fast.\r\n      let firstCallCompleted = false;\r\n\r\n      runtime.registerFunction(\"slowOp\", async () => {\r\n        // Sleep for 200ms\r\n        await new Promise((resolve) => setTimeout(resolve, 200));\r\n        firstCallCompleted = true;\r\n        return \"done\";\r\n      });\r\n\r\n      // Check the abort signal state from QuickJS (sync is fine, made async for type)\r\n      runtime.registerFunction(\"checkAbortState\", () => {\r\n        return Promise.resolve({ aborted: runtime.getAbortSignal()?.aborted ?? false });\r\n      });\r\n\r\n      runtime.setLimits({ timeoutMs: 100 }); // 100ms timeout\r\n\r\n      const result = await runtime.eval(`\r\n        slowOp();           // Takes 200ms, timeout fires at 100ms\r\n        checkAbortState();  // Should show aborted = true\r\n        slowOp();           // This would start after abort\r\n        return \"finished\";\r\n      `);\r\n\r\n      // The first call completes (can't be interrupted mid-Promise)\r\n      expect(firstCallCompleted).toBe(true);\r\n      // But the overall execution fails due to timeout\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toContain(\"timeout\");\r\n    });\r\n  });\r\n\r\n  describe(\"abort\", () => {\r\n    it(\"can abort during async host function\", async () => {\r\n      // Abort is checked at the start of each async host function call\r\n      let callCount = 0;\r\n      runtime.registerFunction(\"slowOp\", async () => {\r\n        callCount++;\r\n        // Simulate slow async work\r\n        await new Promise((resolve) => setTimeout(resolve, 200));\r\n        return \"done\";\r\n      });\r\n\r\n      // Queue multiple calls, abort after first starts\r\n      const evalPromise = runtime.eval(`\r\n        slowOp();\r\n        slowOp(); // Should be aborted before running\r\n        return \"finished\";\r\n      `);\r\n\r\n      // Abort after first function starts but before it completes\r\n      setTimeout(() => runtime.abort(), 100);\r\n\r\n      await evalPromise;\r\n      // First call may complete, but second should be aborted\r\n      // (timing dependent, but abort should eventually take effect)\r\n      expect(callCount).toBeLessThanOrEqual(2);\r\n    });\r\n\r\n    it(\"abort method exists and can be called\", () => {\r\n      // Basic sanity test that abort() is callable\r\n      expect(() => runtime.abort()).not.toThrow();\r\n    });\r\n  });\r\n\r\n  describe(\"dispose\", () => {\r\n    it(\"throws on eval after dispose\", async () => {\r\n      runtime.dispose();\r\n\r\n      try {\r\n        await runtime.eval(\"return 1\");\r\n        expect.unreachable(\"Should have thrown\");\r\n      } catch (e) {\r\n        expect(String(e)).toContain(\"disposed\");\r\n      }\r\n    });\r\n\r\n    it(\"can be disposed multiple times safely\", () => {\r\n      runtime.dispose();\r\n      runtime.dispose(); // Should not throw\r\n    });\r\n\r\n    it(\"supports Symbol.dispose\", () => {\r\n      expect(typeof runtime[Symbol.dispose]).toBe(\"function\");\r\n      runtime[Symbol.dispose]();\r\n    });\r\n  });\r\n\r\n  describe(\"friendly error messages for unavailable globals\", () => {\r\n    it(\"provides friendly error for process\", async () => {\r\n      const result = await runtime.eval(\"const env = process.env;\");\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toContain(\"'process' is not available in the sandbox\");\r\n      expect(result.error).toContain(\"mux.*\");\r\n    });\r\n\r\n    it(\"provides friendly error for window\", async () => {\r\n      const result = await runtime.eval(\"window.alert('hi');\");\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toContain(\"'window' is not available in the sandbox\");\r\n    });\r\n\r\n    it(\"provides friendly error for fetch\", async () => {\r\n      const result = await runtime.eval(\"fetch('https://example.com');\");\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toContain(\"'fetch' is not available in the sandbox\");\r\n    });\r\n\r\n    it(\"provides friendly error for require\", async () => {\r\n      const result = await runtime.eval(\"const fs = require('fs');\");\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toContain(\"'require' is not available in the sandbox\");\r\n    });\r\n\r\n    it(\"provides friendly error for document\", async () => {\r\n      const result = await runtime.eval(\"document.getElementById('test');\");\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toContain(\"'document' is not available in the sandbox\");\r\n    });\r\n\r\n    it(\"keeps standard ReferenceError for user-defined undefined vars\", async () => {\r\n      const result = await runtime.eval(\"const x = myUndefinedVar;\");\r\n      expect(result.success).toBe(false);\r\n      // Should NOT get the friendly message since it's not a known unavailable global\r\n      expect(result.error).not.toContain(\"mux.*\");\r\n      expect(result.error).toContain(\"not defined\");\r\n    });\r\n  });\r\n});\r\n\r\ndescribe(\"QuickJSRuntimeFactory\", () => {\r\n  it(\"creates new runtime instances\", async () => {\r\n    const factory = new QuickJSRuntimeFactory();\r\n    const runtime = await factory.create();\r\n\r\n    expect(runtime).toBeInstanceOf(QuickJSRuntime);\r\n\r\n    const result = await runtime.eval(\"return 42\");\r\n    expect(result.success).toBe(true);\r\n    expect(result.result).toBe(42);\r\n\r\n    runtime.dispose();\r\n  });\r\n});\r\n\r\ndescribe(\"sequential execution\", () => {\r\n  it(\"executes async host functions sequentially even in loops\", async () => {\r\n    // This test proves that Asyncify causes async host functions to execute\r\n    // sequentially, not in parallel. Even constructs that would normally\r\n    // run concurrently (like Promise.all) execute one-at-a-time.\r\n    const runtime = await QuickJSRuntime.create();\r\n    const callOrder: number[] = [];\r\n\r\n    runtime.registerObject(\"test\", {\r\n      trackOrder: async (args: unknown) => {\r\n        const id = (args as { id: number }).id;\r\n        callOrder.push(id);\r\n        // Small delay - if parallel, calls would interleave\r\n        await new Promise((r) => setTimeout(r, 10));\r\n        return { id };\r\n      },\r\n    });\r\n\r\n    const result = await runtime.eval(`\r\n      // Due to Asyncify, these calls appear synchronous and execute in order\r\n      const r1 = test.trackOrder({ id: 1 });\r\n      const r2 = test.trackOrder({ id: 2 });\r\n      const r3 = test.trackOrder({ id: 3 });\r\n      return [r1.id, r2.id, r3.id];\r\n    `);\r\n\r\n    runtime.dispose();\r\n\r\n    expect(result.success).toBe(true);\r\n    expect(result.result).toEqual([1, 2, 3]);\r\n    // Call order is deterministically sequential\r\n    expect(callOrder).toEqual([1, 2, 3]);\r\n  });\r\n});\r\n\r\ndescribe(\"marshal edge cases\", () => {\r\n  let runtime: QuickJSRuntime;\r\n\r\n  beforeEach(async () => {\r\n    runtime = await QuickJSRuntime.create();\r\n  });\r\n\r\n  afterEach(() => {\r\n    runtime.dispose();\r\n  });\r\n\r\n  it(\"handles BigInt values natively\", async () => {\r\n    runtime.registerFunction(\"getBigInt\", () => Promise.resolve(BigInt(\"9007199254740993\")));\r\n\r\n    const result = await runtime.eval(\"return getBigInt();\");\r\n    expect(result.success).toBe(true);\r\n    // QuickJS returns bigints as numbers if they fit, or as BigInt\r\n    expect(result.result).toBe(9007199254740993n);\r\n  });\r\n\r\n  it(\"preserves undefined in objects\", async () => {\r\n    runtime.registerFunction(\"getObjWithUndefined\", () =>\r\n      Promise.resolve({ a: 1, b: undefined, c: 3 })\r\n    );\r\n\r\n    const result = await runtime.eval(`\r\n      const obj = getObjWithUndefined();\r\n      return { hasB: 'b' in obj, bValue: obj.b, a: obj.a, c: obj.c };\r\n    `);\r\n    expect(result.success).toBe(true);\r\n    expect(result.result).toEqual({ hasB: true, bValue: undefined, a: 1, c: 3 });\r\n  });\r\n\r\n  it(\"preserves undefined in arrays (not converted to null)\", async () => {\r\n    runtime.registerFunction(\"getArrayWithUndefined\", () => Promise.resolve([1, undefined, 3]));\r\n\r\n    const result = await runtime.eval(`\r\n      const arr = getArrayWithUndefined();\r\n      return { len: arr.length, first: arr[0], second: arr[1], third: arr[2] };\r\n    `);\r\n    expect(result.success).toBe(true);\r\n    expect(result.result).toEqual({ len: 3, first: 1, second: undefined, third: 3 });\r\n  });\r\n\r\n  it(\"handles circular references with [Circular] placeholder\", async () => {\r\n    const circular: Record<string, unknown> = { a: 1 };\r\n    circular.self = circular;\r\n    runtime.registerFunction(\"getCircular\", () => Promise.resolve(circular));\r\n\r\n    const result = await runtime.eval(`\r\n      const obj = getCircular();\r\n      return { a: obj.a, selfType: typeof obj.self, selfValue: obj.self };\r\n    `);\r\n    expect(result.success).toBe(true);\r\n    expect(result.result).toEqual({ a: 1, selfType: \"string\", selfValue: \"[Circular]\" });\r\n  });\r\n\r\n  it(\"marks functions as unserializable\", async () => {\r\n    runtime.registerFunction(\"getFunction\", () =>\r\n      Promise.resolve({ fn: () => \"hello\", value: 42 })\r\n    );\r\n\r\n    const result = await runtime.eval(`\r\n      const obj = getFunction();\r\n      return { fnType: obj.fn.__unserializable__, value: obj.value };\r\n    `);\r\n    expect(result.success).toBe(true);\r\n    expect(result.result).toEqual({ fnType: \"function\", value: 42 });\r\n  });\r\n\r\n  it(\"marks symbols as unserializable\", async () => {\r\n    runtime.registerFunction(\"getSymbol\", () =>\r\n      Promise.resolve({ sym: Symbol(\"test\"), value: 42 })\r\n    );\r\n\r\n    const result = await runtime.eval(`\r\n      const obj = getSymbol();\r\n      return { symType: obj.sym.__unserializable__, value: obj.value };\r\n    `);\r\n    expect(result.success).toBe(true);\r\n    expect(result.result).toEqual({ symType: \"symbol\", value: 42 });\r\n  });\r\n\r\n  it(\"handles deeply nested objects\", async () => {\r\n    runtime.registerFunction(\"getDeep\", () =>\r\n      Promise.resolve({ a: { b: { c: { d: { e: \"deep\" } } } } })\r\n    );\r\n\r\n    const result = await runtime.eval(\"return getDeep().a.b.c.d.e;\");\r\n    expect(result.success).toBe(true);\r\n    expect(result.result).toBe(\"deep\");\r\n  });\r\n\r\n  it(\"handles arrays with mixed types\", async () => {\r\n    runtime.registerFunction(\"getMixed\", () =>\r\n      Promise.resolve([1, \"two\", { three: 3 }, [4, 5], null, true])\r\n    );\r\n\r\n    const result = await runtime.eval(\"return getMixed();\");\r\n    expect(result.success).toBe(true);\r\n    expect(result.result).toEqual([1, \"two\", { three: 3 }, [4, 5], null, true]);\r\n  });\r\n\r\n  it(\"handles empty objects and arrays\", async () => {\r\n    runtime.registerFunction(\"getEmpty\", () => Promise.resolve({ obj: {}, arr: [] }));\r\n\r\n    const result = await runtime.eval(\"return getEmpty();\");\r\n    expect(result.success).toBe(true);\r\n    expect(result.result).toEqual({ obj: {}, arr: [] });\r\n  });\r\n\r\n  it(\"converts Date to ISO string (matches JSON.stringify)\", async () => {\r\n    const testDate = new Date(\"2024-06-15T12:30:00.000Z\");\r\n    runtime.registerFunction(\"getDate\", () =>\r\n      Promise.resolve({ created: testDate, nested: { date: testDate } })\r\n    );\r\n\r\n    const result = await runtime.eval(\"return getDate();\");\r\n    expect(result.success).toBe(true);\r\n    expect(result.result).toEqual({\r\n      created: \"2024-06-15T12:30:00.000Z\",\r\n      nested: { date: \"2024-06-15T12:30:00.000Z\" },\r\n    });\r\n  });\r\n\r\n  it(\"handles shared references (same object in multiple places) without marking as circular\", async () => {\r\n    // Shared reference is NOT circular - same object appears twice but no cycle\r\n    const shared = { id: 42, name: \"shared\" };\r\n    const obj = { a: shared, b: shared, c: { nested: shared } };\r\n    runtime.registerFunction(\"getShared\", () => Promise.resolve(obj));\r\n\r\n    const result = await runtime.eval(`\r\n      const obj = getShared();\r\n      return {\r\n        aId: obj.a.id,\r\n        bId: obj.b.id,\r\n        cNestedId: obj.c.nested.id,\r\n        // Verify none are \"[Circular]\" strings\r\n        aType: typeof obj.a,\r\n        bType: typeof obj.b\r\n      };\r\n    `);\r\n    expect(result.success).toBe(true);\r\n    expect(result.result).toEqual({\r\n      aId: 42,\r\n      bId: 42,\r\n      cNestedId: 42,\r\n      aType: \"object\",\r\n      bType: \"object\",\r\n    });\r\n  });\r\n\r\n  it(\"still detects true circular references\", async () => {\r\n    // True cycle: a -> b -> a\r\n    const a: Record<string, unknown> = { name: \"a\" };\r\n    const b: Record<string, unknown> = { name: \"b\" };\r\n    a.ref = b;\r\n    b.ref = a; // Creates cycle\r\n    runtime.registerFunction(\"getCycle\", () => Promise.resolve(a));\r\n\r\n    const result = await runtime.eval(`\r\n      const obj = getCycle();\r\n      return {\r\n        name: obj.name,\r\n        refName: obj.ref.name,\r\n        refRefValue: obj.ref.ref  // This points back to 'a' - should be \"[Circular]\"\r\n      };\r\n    `);\r\n    expect(result.success).toBe(true);\r\n    expect(result.result).toEqual({\r\n      name: \"a\",\r\n      refName: \"b\",\r\n      refRefValue: \"[Circular]\",\r\n    });\r\n  });\r\n});\r\n"]}