{"version":3,"file":"gitPatchArtifactService.js","sourceRoot":"","sources":["../../../src/node/services/gitPatchArtifactService.ts"],"names":[],"mappings":"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","sourcesContent":["import * as path from \"node:path\";\nimport assert from \"node:assert/strict\";\nimport * as fsPromises from \"fs/promises\";\n\nimport type { Config } from \"@/node/config\";\nimport {\n  coerceNonEmptyString,\n  tryReadGitHeadCommitSha,\n  findWorkspaceEntry,\n} from \"@/node/services/taskUtils\";\nimport { log } from \"@/node/services/log\";\nimport { readAgentDefinition } from \"@/node/services/agentDefinitions/agentDefinitionsService\";\nimport { resolveAgentInheritanceChain } from \"@/node/services/agentDefinitions/resolveAgentInheritanceChain\";\nimport { isExecLikeEditingCapableInResolvedChain } from \"@/common/utils/agentTools\";\nimport { createRuntimeForWorkspace } from \"@/node/runtime/runtimeHelpers\";\nimport { execBuffered } from \"@/node/utils/runtime/helpers\";\nimport { AgentIdSchema } from \"@/common/orpc/schemas\";\nimport {\n  getSubagentGitPatchMboxPath,\n  upsertSubagentGitPatchArtifact,\n} from \"@/node/services/subagentGitPatchArtifacts\";\nimport { shellQuote } from \"@/common/utils/shell\";\nimport { streamToString } from \"@/node/runtime/streamUtils\";\n\n/** Callback invoked after patch generation completes (success or failure). */\nexport type OnPatchGenerationComplete = (childWorkspaceId: string) => Promise<void>;\n\nasync function writeReadableStreamToLocalFile(\n  stream: ReadableStream<Uint8Array>,\n  filePath: string\n): Promise<void> {\n  assert(filePath.length > 0, \"writeReadableStreamToLocalFile: filePath must be non-empty\");\n\n  await fsPromises.mkdir(path.dirname(filePath), { recursive: true });\n\n  const fileHandle = await fsPromises.open(filePath, \"w\");\n  try {\n    const reader = stream.getReader();\n    try {\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n        if (value) {\n          await fileHandle.write(value);\n        }\n      }\n    } finally {\n      reader.releaseLock();\n    }\n  } finally {\n    await fileHandle.close();\n  }\n}\n\n// ---------------------------------------------------------------------------\n// GitPatchArtifactService\n// ---------------------------------------------------------------------------\n\n/**\n * Handles git-format-patch artifact generation for subagent tasks.\n *\n * Extracted from TaskService to keep patch-specific logic self-contained.\n */\nexport class GitPatchArtifactService {\n  private readonly pendingJobsByTaskId = new Map<string, Promise<void>>();\n\n  constructor(private readonly config: Config) {}\n\n  /**\n   * If the child workspace is an exec-like agent, write a pending patch artifact\n   * marker and kick off background `git format-patch` generation.\n   *\n   * @param onComplete - called after generation finishes (success *or* failure),\n   *   typically used to trigger reported-leaf-task cleanup.\n   */\n  async maybeStartGeneration(\n    parentWorkspaceId: string,\n    childWorkspaceId: string,\n    onComplete: OnPatchGenerationComplete\n  ): Promise<void> {\n    assert(\n      parentWorkspaceId.length > 0,\n      \"maybeStartGeneration: parentWorkspaceId must be non-empty\"\n    );\n    assert(childWorkspaceId.length > 0, \"maybeStartGeneration: childWorkspaceId must be non-empty\");\n\n    const parentSessionDir = this.config.getSessionDir(parentWorkspaceId);\n\n    // Write a pending marker before we attempt cleanup, so the reported task workspace isn't deleted\n    // while we're still reading commits from it.\n    const nowMs = Date.now();\n    const cfg = this.config.loadConfigOrDefault();\n    const childEntry = findWorkspaceEntry(cfg, childWorkspaceId);\n\n    // Only exec-like subagents are expected to make commits that should be handed back to the parent.\n    // NOTE: Custom agents can inherit from exec (base: exec). Those should also generate patches,\n    // but read-only subagents (e.g. explore) should not.\n    const childAgentIdRaw = coerceNonEmptyString(\n      childEntry?.workspace.agentId ?? childEntry?.workspace.agentType\n    );\n    const childAgentId = childAgentIdRaw?.toLowerCase();\n    if (!childAgentId) {\n      return;\n    }\n\n    let shouldGeneratePatch = childAgentId === \"exec\";\n\n    if (!shouldGeneratePatch) {\n      const parsedChildAgentId = AgentIdSchema.safeParse(childAgentId);\n      if (parsedChildAgentId.success) {\n        const agentId = parsedChildAgentId.data;\n\n        // Prefer resolving agent inheritance from the parent workspace: project agents may be untracked\n        // (and therefore absent from child worktrees), but they are always present in the parent that\n        // spawned the task.\n        const agentDiscoveryEntry = findWorkspaceEntry(cfg, parentWorkspaceId) ?? childEntry;\n        const agentDiscoveryWs = agentDiscoveryEntry?.workspace;\n\n        const agentWorkspacePath = coerceNonEmptyString(agentDiscoveryWs?.path);\n        const runtimeConfig = agentDiscoveryWs?.runtimeConfig;\n\n        if (agentDiscoveryEntry && agentWorkspacePath && runtimeConfig) {\n          const fallbackName =\n            agentWorkspacePath.split(\"/\").pop() ?? agentWorkspacePath.split(\"\\\\\").pop() ?? \"\";\n          const workspaceName =\n            coerceNonEmptyString(agentDiscoveryWs?.name) ?? coerceNonEmptyString(fallbackName);\n\n          if (workspaceName) {\n            const runtime = createRuntimeForWorkspace({\n              runtimeConfig,\n              projectPath: agentDiscoveryEntry.projectPath,\n              name: workspaceName,\n            });\n\n            try {\n              const agentDefinition = await readAgentDefinition(\n                runtime,\n                agentWorkspacePath,\n                agentId\n              );\n              const chain = await resolveAgentInheritanceChain({\n                runtime,\n                workspacePath: agentWorkspacePath,\n                agentId,\n                agentDefinition,\n                workspaceId: childWorkspaceId,\n              });\n\n              shouldGeneratePatch = isExecLikeEditingCapableInResolvedChain(chain);\n            } catch {\n              // ignore - treat as non-exec-like\n            }\n          }\n        }\n      }\n    }\n\n    if (!shouldGeneratePatch) {\n      return;\n    }\n\n    const baseCommitSha =\n      coerceNonEmptyString(childEntry?.workspace.taskBaseCommitSha) ?? undefined;\n\n    const artifact = await upsertSubagentGitPatchArtifact({\n      workspaceId: parentWorkspaceId,\n      workspaceSessionDir: parentSessionDir,\n      childTaskId: childWorkspaceId,\n      updater: (existing) => {\n        if (existing && existing.status !== \"pending\") {\n          return existing;\n        }\n\n        return {\n          ...(existing ?? {}),\n          childTaskId: childWorkspaceId,\n          parentWorkspaceId,\n          createdAtMs: existing?.createdAtMs ?? nowMs,\n          updatedAtMs: nowMs,\n          status: \"pending\",\n          baseCommitSha: baseCommitSha ?? existing?.baseCommitSha,\n        };\n      },\n    });\n\n    if (artifact.status !== \"pending\") {\n      return;\n    }\n\n    if (this.pendingJobsByTaskId.has(childWorkspaceId)) {\n      return;\n    }\n\n    let job: Promise<void>;\n    try {\n      job = this.generate(parentWorkspaceId, childWorkspaceId, onComplete)\n        .catch(async (error: unknown) => {\n          log.error(\"Subagent git patch generation failed\", {\n            parentWorkspaceId,\n            childWorkspaceId,\n            error,\n          });\n\n          // Best-effort: if generation failed before it could update the artifact status,\n          // mark it failed so the parent isn't blocked forever by a pending marker.\n          try {\n            await upsertSubagentGitPatchArtifact({\n              workspaceId: parentWorkspaceId,\n              workspaceSessionDir: parentSessionDir,\n              childTaskId: childWorkspaceId,\n              updater: (existing) => {\n                if (existing && existing.status !== \"pending\") {\n                  return existing;\n                }\n\n                const failedAtMs = Date.now();\n                return {\n                  ...(existing ?? {}),\n                  childTaskId: childWorkspaceId,\n                  parentWorkspaceId,\n                  createdAtMs: existing?.createdAtMs ?? failedAtMs,\n                  updatedAtMs: failedAtMs,\n                  status: \"failed\",\n                  error: error instanceof Error ? error.message : String(error),\n                };\n              },\n            });\n          } catch (updateError: unknown) {\n            log.error(\"Failed to mark subagent git patch artifact as failed\", {\n              parentWorkspaceId,\n              childWorkspaceId,\n              error: updateError,\n            });\n          }\n        })\n        .finally(() => {\n          this.pendingJobsByTaskId.delete(childWorkspaceId);\n        });\n    } catch (error: unknown) {\n      // If scheduling fails synchronously, don't leave the artifact stuck in `pending`.\n      await upsertSubagentGitPatchArtifact({\n        workspaceId: parentWorkspaceId,\n        workspaceSessionDir: parentSessionDir,\n        childTaskId: childWorkspaceId,\n        updater: (existing) => {\n          if (existing && existing.status !== \"pending\") {\n            return existing;\n          }\n\n          const failedAtMs = Date.now();\n          return {\n            ...(existing ?? {}),\n            childTaskId: childWorkspaceId,\n            parentWorkspaceId,\n            createdAtMs: existing?.createdAtMs ?? failedAtMs,\n            updatedAtMs: failedAtMs,\n            status: \"failed\",\n            error: error instanceof Error ? error.message : String(error),\n          };\n        },\n      });\n      return;\n    }\n\n    this.pendingJobsByTaskId.set(childWorkspaceId, job);\n  }\n\n  private async generate(\n    parentWorkspaceId: string,\n    childWorkspaceId: string,\n    onComplete: OnPatchGenerationComplete\n  ): Promise<void> {\n    assert(parentWorkspaceId.length > 0, \"generate: parentWorkspaceId must be non-empty\");\n    assert(childWorkspaceId.length > 0, \"generate: childWorkspaceId must be non-empty\");\n\n    const parentSessionDir = this.config.getSessionDir(parentWorkspaceId);\n\n    const updateArtifact = async (\n      updater: Parameters<typeof upsertSubagentGitPatchArtifact>[0][\"updater\"]\n    ): Promise<void> => {\n      await upsertSubagentGitPatchArtifact({\n        workspaceId: parentWorkspaceId,\n        workspaceSessionDir: parentSessionDir,\n        childTaskId: childWorkspaceId,\n        updater,\n      });\n    };\n\n    const nowMs = Date.now();\n\n    try {\n      const cfg = this.config.loadConfigOrDefault();\n      const entry = findWorkspaceEntry(cfg, childWorkspaceId);\n\n      if (!entry) {\n        await updateArtifact((existing) => ({\n          ...(existing ?? {}),\n          childTaskId: childWorkspaceId,\n          parentWorkspaceId,\n          createdAtMs: existing?.createdAtMs ?? nowMs,\n          updatedAtMs: nowMs,\n          status: \"failed\",\n          error: \"Task workspace not found in config.\",\n        }));\n        return;\n      }\n\n      const ws = entry.workspace;\n\n      const workspacePath = coerceNonEmptyString(ws.path);\n      if (!workspacePath) {\n        await updateArtifact((existing) => ({\n          ...(existing ?? {}),\n          childTaskId: childWorkspaceId,\n          parentWorkspaceId,\n          createdAtMs: existing?.createdAtMs ?? nowMs,\n          updatedAtMs: nowMs,\n          status: \"failed\",\n          error: \"Task workspace path missing.\",\n        }));\n        return;\n      }\n\n      if (!ws.runtimeConfig) {\n        await updateArtifact((existing) => ({\n          ...(existing ?? {}),\n          childTaskId: childWorkspaceId,\n          parentWorkspaceId,\n          createdAtMs: existing?.createdAtMs ?? nowMs,\n          updatedAtMs: nowMs,\n          status: \"failed\",\n          error: \"Task runtimeConfig missing.\",\n        }));\n        return;\n      }\n\n      const fallbackName = workspacePath.split(\"/\").pop() ?? workspacePath.split(\"\\\\\").pop() ?? \"\";\n      const workspaceName = coerceNonEmptyString(ws.name) ?? coerceNonEmptyString(fallbackName);\n      if (!workspaceName) {\n        await updateArtifact((existing) => ({\n          ...(existing ?? {}),\n          childTaskId: childWorkspaceId,\n          parentWorkspaceId,\n          createdAtMs: existing?.createdAtMs ?? nowMs,\n          updatedAtMs: nowMs,\n          status: \"failed\",\n          error: \"Task workspace name missing.\",\n        }));\n        return;\n      }\n\n      const runtime = createRuntimeForWorkspace({\n        runtimeConfig: ws.runtimeConfig,\n        projectPath: entry.projectPath,\n        name: workspaceName,\n      });\n\n      let baseCommitSha = coerceNonEmptyString(ws.taskBaseCommitSha);\n      if (!baseCommitSha) {\n        const trunkBranch =\n          coerceNonEmptyString(ws.taskTrunkBranch) ??\n          coerceNonEmptyString(findWorkspaceEntry(cfg, parentWorkspaceId)?.workspace.name);\n\n        if (!trunkBranch) {\n          await updateArtifact((existing) => ({\n            ...(existing ?? {}),\n            childTaskId: childWorkspaceId,\n            parentWorkspaceId,\n            createdAtMs: existing?.createdAtMs ?? nowMs,\n            updatedAtMs: nowMs,\n            status: \"failed\",\n            error:\n              \"taskBaseCommitSha missing and could not determine trunk branch for merge-base fallback.\",\n          }));\n          return;\n        }\n\n        const mergeBaseResult = await execBuffered(\n          runtime,\n          `git merge-base ${shellQuote(trunkBranch)} HEAD`,\n          { cwd: workspacePath, timeout: 30 }\n        );\n        if (mergeBaseResult.exitCode !== 0) {\n          await updateArtifact((existing) => ({\n            ...(existing ?? {}),\n            childTaskId: childWorkspaceId,\n            parentWorkspaceId,\n            createdAtMs: existing?.createdAtMs ?? nowMs,\n            updatedAtMs: nowMs,\n            status: \"failed\",\n            error: `git merge-base failed: ${mergeBaseResult.stderr.trim() || \"unknown error\"}`,\n          }));\n          return;\n        }\n\n        baseCommitSha = mergeBaseResult.stdout.trim();\n      }\n\n      const headCommitSha = await tryReadGitHeadCommitSha(runtime, workspacePath);\n      if (!headCommitSha) {\n        await updateArtifact((existing) => ({\n          ...(existing ?? {}),\n          childTaskId: childWorkspaceId,\n          parentWorkspaceId,\n          createdAtMs: existing?.createdAtMs ?? nowMs,\n          updatedAtMs: nowMs,\n          status: \"failed\",\n          error: \"git rev-parse HEAD failed.\",\n        }));\n        return;\n      }\n\n      const countResult = await execBuffered(\n        runtime,\n        `git rev-list --count ${baseCommitSha}..${headCommitSha}`,\n        { cwd: workspacePath, timeout: 30 }\n      );\n      if (countResult.exitCode !== 0) {\n        await updateArtifact((existing) => ({\n          ...(existing ?? {}),\n          childTaskId: childWorkspaceId,\n          parentWorkspaceId,\n          createdAtMs: existing?.createdAtMs ?? nowMs,\n          updatedAtMs: nowMs,\n          status: \"failed\",\n          baseCommitSha,\n          headCommitSha,\n          error: `git rev-list failed: ${countResult.stderr.trim() || \"unknown error\"}`,\n        }));\n        return;\n      }\n\n      const commitCount = Number.parseInt(countResult.stdout.trim(), 10);\n      if (!Number.isFinite(commitCount) || commitCount < 0) {\n        await updateArtifact((existing) => ({\n          ...(existing ?? {}),\n          childTaskId: childWorkspaceId,\n          parentWorkspaceId,\n          createdAtMs: existing?.createdAtMs ?? nowMs,\n          updatedAtMs: nowMs,\n          status: \"failed\",\n          baseCommitSha,\n          headCommitSha,\n          error: `Invalid commit count: ${countResult.stdout.trim()}`,\n        }));\n        return;\n      }\n\n      if (commitCount === 0) {\n        await updateArtifact((existing) => ({\n          ...(existing ?? {}),\n          childTaskId: childWorkspaceId,\n          parentWorkspaceId,\n          createdAtMs: existing?.createdAtMs ?? nowMs,\n          updatedAtMs: nowMs,\n          status: \"skipped\",\n          baseCommitSha,\n          headCommitSha,\n          commitCount,\n          error: undefined,\n        }));\n        return;\n      }\n\n      const patchPath = getSubagentGitPatchMboxPath(parentSessionDir, childWorkspaceId);\n\n      const formatPatchStream = await runtime.exec(\n        `git format-patch --stdout --binary ${baseCommitSha}..${headCommitSha}`,\n        { cwd: workspacePath, timeout: 120 }\n      );\n      await formatPatchStream.stdin.close();\n\n      const stderrPromise = streamToString(formatPatchStream.stderr);\n      const writePromise = writeReadableStreamToLocalFile(formatPatchStream.stdout, patchPath);\n\n      const [exitCode, stderr] = await Promise.all([\n        formatPatchStream.exitCode,\n        stderrPromise,\n        writePromise,\n      ]);\n\n      if (exitCode !== 0) {\n        // Leave no half-written patches around.\n        await fsPromises.rm(patchPath, { force: true });\n\n        await updateArtifact((existing) => ({\n          ...(existing ?? {}),\n          childTaskId: childWorkspaceId,\n          parentWorkspaceId,\n          createdAtMs: existing?.createdAtMs ?? nowMs,\n          updatedAtMs: Date.now(),\n          status: \"failed\",\n          baseCommitSha,\n          headCommitSha,\n          commitCount,\n          error: `git format-patch failed (exitCode=${exitCode}): ${stderr.trim() || \"unknown error\"}`,\n        }));\n        return;\n      }\n\n      await updateArtifact((existing) => ({\n        ...(existing ?? {}),\n        childTaskId: childWorkspaceId,\n        parentWorkspaceId,\n        createdAtMs: existing?.createdAtMs ?? nowMs,\n        updatedAtMs: Date.now(),\n        status: \"ready\",\n        baseCommitSha,\n        headCommitSha,\n        commitCount,\n        mboxPath: patchPath,\n        error: undefined,\n      }));\n    } catch (error: unknown) {\n      await updateArtifact((existing) => ({\n        ...(existing ?? {}),\n        childTaskId: childWorkspaceId,\n        parentWorkspaceId,\n        createdAtMs: existing?.createdAtMs ?? nowMs,\n        updatedAtMs: Date.now(),\n        status: \"failed\",\n        error: error instanceof Error ? error.message : String(error),\n      }));\n    } finally {\n      // Unblock auto-cleanup once the patch generation attempt has finished.\n      await onComplete(childWorkspaceId);\n    }\n  }\n}\n"]}