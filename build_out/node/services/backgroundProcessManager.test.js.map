{"version":3,"file":"backgroundProcessManager.test.js","sourceRoot":"","sources":["../../../src/node/services/backgroundProcessManager.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, it, expect, beforeEach, afterEach } from \"bun:test\";\r\nimport {\r\n  BackgroundProcessManager,\r\n  computeTailStartOffset,\r\n  type BackgroundProcessMeta,\r\n} from \"./backgroundProcessManager\";\r\nimport { LocalRuntime } from \"@/node/runtime/LocalRuntime\";\r\nimport type { Runtime } from \"@/node/runtime/Runtime\";\r\nimport * as fs from \"fs/promises\";\r\nimport * as path from \"path\";\r\nimport * as os from \"os\";\r\nimport { createBashTool } from \"@/node/services/tools/bash\";\r\nimport { createBashOutputTool } from \"@/node/services/tools/bash_output\";\r\nimport { TestTempDir, createTestToolConfig } from \"@/node/services/tools/testHelpers\";\r\nimport type { BashToolResult, BashOutputToolResult } from \"@/common/types/tools\";\r\n\r\ndescribe(\"BackgroundProcessManager\", () => {\r\n  let manager: BackgroundProcessManager;\r\n  let runtime: Runtime;\r\n  let bgOutputDir: string;\r\n  // Use unique workspace IDs per test run to avoid collisions\r\n  const testRunId = Date.now().toString(36);\r\n  const testWorkspaceId = `test-ws1-${testRunId}`;\r\n  const testWorkspaceId2 = `test-ws2-${testRunId}`;\r\n\r\n  beforeEach(async () => {\r\n    // Create isolated temp directory for each test to avoid cross-test pollution\r\n    bgOutputDir = await fs.mkdtemp(path.join(os.tmpdir(), \"bg-proc-test-\"));\r\n    manager = new BackgroundProcessManager(bgOutputDir);\r\n    runtime = new LocalRuntime(process.cwd());\r\n  });\r\n\r\n  afterEach(async () => {\r\n    // Cleanup: terminate all processes\r\n    await manager.cleanup(testWorkspaceId);\r\n    await manager.cleanup(testWorkspaceId2);\r\n    // Remove temp sessions directory (legacy)\r\n    await fs.rm(bgOutputDir, { recursive: true, force: true }).catch(() => undefined);\r\n    // Remove actual output directories from /tmp/mux-bashes (where executor writes)\r\n    await fs\r\n      .rm(`/tmp/mux-bashes/${testWorkspaceId}`, { recursive: true, force: true })\r\n      .catch(() => undefined);\r\n    await fs\r\n      .rm(`/tmp/mux-bashes/${testWorkspaceId2}`, { recursive: true, force: true })\r\n      .catch(() => undefined);\r\n  });\r\n\r\n  describe(\"computeTailStartOffset\", () => {\r\n    it(\"should return 0 when tailBytes exceeds file size\", () => {\r\n      expect(computeTailStartOffset(10, 64_000)).toBe(0);\r\n    });\r\n\r\n    it(\"should return fileSize - tailBytes when fileSize is larger\", () => {\r\n      expect(computeTailStartOffset(100, 10)).toBe(90);\r\n    });\r\n\r\n    it(\"should throw on invalid inputs\", () => {\r\n      expect(() => computeTailStartOffset(-1, 10)).toThrow();\r\n      expect(() => computeTailStartOffset(10, 0)).toThrow();\r\n    });\r\n  });\r\n\r\n  describe(\"spawn\", () => {\r\n    it(\"should spawn a background process and return process ID and outputDir\", async () => {\r\n      const displayName = `test-${Date.now()}`;\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"echo hello\", {\r\n        cwd: process.cwd(),\r\n        displayName,\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (result.success) {\r\n        // Process ID is now the display name directly\r\n        expect(result.processId).toBe(displayName);\r\n        // outputDir is now under runtime.tempDir()/mux-bashes/<workspaceId>/<processId>\r\n        expect(result.outputDir).toContain(\"mux-bashes\");\r\n        expect(result.outputDir).toContain(testWorkspaceId);\r\n        expect(result.outputDir).toContain(result.processId);\r\n      }\r\n    });\r\n\r\n    it(\"should return error on spawn failure\", async () => {\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"echo test\", {\r\n        cwd: \"/nonexistent/path/that/does/not/exist\",\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(false);\r\n    });\r\n\r\n    it(\"should write stdout and stderr to unified output file\", async () => {\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"echo hello; echo world >&2\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (result.success) {\r\n        // Wait a moment for output to be written\r\n        await new Promise((resolve) => setTimeout(resolve, 100));\r\n\r\n        const outputPath = path.join(result.outputDir, \"output.log\");\r\n        const output = await fs.readFile(outputPath, \"utf-8\");\r\n\r\n        // Both stdout and stderr go to the same file\r\n        expect(output).toContain(\"hello\");\r\n        expect(output).toContain(\"world\");\r\n      }\r\n    });\r\n\r\n    it(\"should write meta.json with process info\", async () => {\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"echo test\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (result.success) {\r\n        const metaPath = path.join(result.outputDir, \"meta.json\");\r\n        const metaContent = await fs.readFile(metaPath, \"utf-8\");\r\n        const meta = JSON.parse(metaContent) as BackgroundProcessMeta;\r\n\r\n        expect(meta.id).toBe(result.processId);\r\n        expect(meta.pid).toBeGreaterThan(0);\r\n        expect(meta.script).toBe(\"echo test\");\r\n        expect(meta.status).toBe(\"running\");\r\n        expect(meta.startTime).toBeGreaterThan(0);\r\n      }\r\n    });\r\n  });\r\n\r\n  describe(\"getProcess\", () => {\r\n    it(\"should return process by ID\", async () => {\r\n      const spawnResult = await manager.spawn(runtime, testWorkspaceId, \"sleep 1\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      if (spawnResult.success) {\r\n        const proc = await manager.getProcess(spawnResult.processId);\r\n        expect(proc).not.toBeNull();\r\n        expect(proc?.id).toBe(spawnResult.processId);\r\n        expect(proc?.status).toBe(\"running\");\r\n      }\r\n    });\r\n\r\n    it(\"should return null for non-existent process\", async () => {\r\n      const proc = await manager.getProcess(\"bg-nonexistent\");\r\n      expect(proc).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe(\"list\", () => {\r\n    it(\"should list all processes\", async () => {\r\n      // Use unique display names since they're now used as process IDs\r\n      await manager.spawn(runtime, testWorkspaceId, \"sleep 1\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test-list-1\",\r\n      });\r\n      await manager.spawn(runtime, testWorkspaceId, \"sleep 1\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test-list-2\",\r\n      });\r\n\r\n      const processes = await manager.list();\r\n      expect(processes.length).toBeGreaterThanOrEqual(2);\r\n    });\r\n\r\n    it(\"should filter by workspace ID\", async () => {\r\n      // Use unique display names since they're now used as process IDs\r\n      await manager.spawn(runtime, testWorkspaceId, \"sleep 1\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test-filter-ws1\",\r\n      });\r\n      await manager.spawn(runtime, testWorkspaceId2, \"sleep 1\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test-filter-ws2\",\r\n      });\r\n\r\n      const ws1Processes = await manager.list(testWorkspaceId);\r\n      const ws2Processes = await manager.list(testWorkspaceId2);\r\n\r\n      expect(ws1Processes.length).toBeGreaterThanOrEqual(1);\r\n      expect(ws2Processes.length).toBeGreaterThanOrEqual(1);\r\n      expect(ws1Processes.every((p) => p.workspaceId === testWorkspaceId)).toBe(true);\r\n      expect(ws2Processes.every((p) => p.workspaceId === testWorkspaceId2)).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe(\"terminate\", () => {\r\n    it(\"should terminate a running process\", async () => {\r\n      const spawnResult = await manager.spawn(runtime, testWorkspaceId, \"sleep 10\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      if (spawnResult.success) {\r\n        const terminateResult = await manager.terminate(spawnResult.processId);\r\n        expect(terminateResult.success).toBe(true);\r\n\r\n        const proc = await manager.getProcess(spawnResult.processId);\r\n        expect(proc?.status).toMatch(/killed|exited/);\r\n      }\r\n    });\r\n\r\n    it(\"should return error for non-existent process\", async () => {\r\n      const result = await manager.terminate(\"bg-nonexistent\");\r\n      expect(result.success).toBe(false);\r\n    });\r\n\r\n    it(\"should be idempotent (double-terminate succeeds)\", async () => {\r\n      const spawnResult = await manager.spawn(runtime, testWorkspaceId, \"sleep 10\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      if (spawnResult.success) {\r\n        const result1 = await manager.terminate(spawnResult.processId);\r\n        expect(result1.success).toBe(true);\r\n\r\n        const result2 = await manager.terminate(spawnResult.processId);\r\n        expect(result2.success).toBe(true);\r\n      }\r\n    });\r\n\r\n    it(\"should deliver SIGTERM to the bash process (TERM trap executes)\", async () => {\r\n      const sentinelPath = path.join(bgOutputDir, `term-sentinel-${Date.now()}`);\r\n      const displayName = `test-term-trap-${Date.now()}`;\r\n\r\n      const spawnResult = await manager.spawn(\r\n        runtime,\r\n        testWorkspaceId,\r\n        `trap \"echo term > '${sentinelPath}'; exit 0\" TERM; sleep 60`,\r\n        {\r\n          cwd: process.cwd(),\r\n          displayName,\r\n        }\r\n      );\r\n\r\n      expect(spawnResult.success).toBe(true);\r\n      if (!spawnResult.success) return;\r\n\r\n      const terminateResult = await manager.terminate(spawnResult.processId);\r\n      expect(terminateResult.success).toBe(true);\r\n\r\n      // Wait briefly for the trap to write the sentinel file.\r\n      let sentinel: string | null = null;\r\n      for (let attempt = 0; attempt < 20; attempt++) {\r\n        try {\r\n          sentinel = await fs.readFile(sentinelPath, \"utf-8\");\r\n          break;\r\n        } catch {\r\n          await new Promise((resolve) => setTimeout(resolve, 50));\r\n        }\r\n      }\r\n\r\n      expect(sentinel).not.toBeNull();\r\n      expect(sentinel!).toContain(\"term\");\r\n    });\r\n  });\r\n\r\n  describe(\"cleanup\", () => {\r\n    it(\"should kill all processes for a workspace and remove from memory\", async () => {\r\n      await manager.spawn(runtime, testWorkspaceId, \"sleep 10\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n      await manager.spawn(runtime, testWorkspaceId, \"sleep 10\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n      await manager.spawn(runtime, testWorkspaceId2, \"sleep 10\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      await manager.cleanup(testWorkspaceId);\r\n\r\n      const ws1Processes = await manager.list(testWorkspaceId);\r\n      const ws2Processes = await manager.list(testWorkspaceId2);\r\n      // All testWorkspaceId processes should be removed from memory\r\n      expect(ws1Processes.length).toBe(0);\r\n      // workspace-2 processes should still exist and be running\r\n      expect(ws2Processes.length).toBeGreaterThanOrEqual(1);\r\n      expect(ws2Processes.some((p) => p.status === \"running\")).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe(\"terminateAll\", () => {\r\n    it(\r\n      \"should kill all processes across all workspaces\",\r\n      async () => {\r\n        // Spawn processes in multiple workspaces (unique display names since they're process IDs)\r\n        await manager.spawn(runtime, testWorkspaceId, \"sleep 10\", {\r\n          cwd: process.cwd(),\r\n          displayName: \"test-termall-ws1\",\r\n        });\r\n        await manager.spawn(runtime, testWorkspaceId2, \"sleep 10\", {\r\n          cwd: process.cwd(),\r\n          displayName: \"test-termall-ws2\",\r\n        });\r\n\r\n        // Verify both workspaces have running processes\r\n        const beforeWs1 = await manager.list(testWorkspaceId);\r\n        const beforeWs2 = await manager.list(testWorkspaceId2);\r\n        expect(beforeWs1.length).toBe(1);\r\n        expect(beforeWs2.length).toBe(1);\r\n\r\n        // Terminate all\r\n        await manager.terminateAll();\r\n\r\n        // Both workspaces should have no processes\r\n        const afterWs1 = await manager.list(testWorkspaceId);\r\n        const afterWs2 = await manager.list(testWorkspaceId2);\r\n        expect(afterWs1.length).toBe(0);\r\n        expect(afterWs2.length).toBe(0);\r\n\r\n        // Total list should also be empty\r\n        const allProcesses = await manager.list();\r\n        expect(allProcesses.length).toBe(0);\r\n      },\r\n      { timeout: 20_000 }\r\n    );\r\n\r\n    it(\"should handle empty process list gracefully\", async () => {\r\n      // No processes spawned - terminateAll should not throw\r\n      await manager.terminateAll();\r\n      const allProcesses = await manager.list();\r\n      expect(allProcesses.length).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe(\"process state tracking\", () => {\r\n    it(\"should track process exit and update meta.json\", async () => {\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"exit 42\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      if (result.success) {\r\n        // Wait for process to exit\r\n        await new Promise((resolve) => setTimeout(resolve, 200));\r\n\r\n        const proc = await manager.getProcess(result.processId);\r\n        expect(proc?.status).toBe(\"exited\");\r\n        expect(proc?.exitCode).toBe(42);\r\n        expect(proc?.exitTime).not.toBeNull();\r\n\r\n        // Verify meta.json was updated\r\n        const metaPath = path.join(result.outputDir, \"meta.json\");\r\n        const metaContent = await fs.readFile(metaPath, \"utf-8\");\r\n        const meta = JSON.parse(metaContent) as BackgroundProcessMeta;\r\n        expect(meta.status).toBe(\"exited\");\r\n        expect(meta.exitCode).toBe(42);\r\n      }\r\n    });\r\n\r\n    it(\"should keep output files after process exits\", async () => {\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"echo test; exit 0\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      if (result.success) {\r\n        await new Promise((resolve) => setTimeout(resolve, 200));\r\n\r\n        const proc = await manager.getProcess(result.processId);\r\n        expect(proc?.status).toBe(\"exited\");\r\n\r\n        // Verify output file still contains output\r\n        const outputPath = path.join(result.outputDir, \"output.log\");\r\n        const output = await fs.readFile(outputPath, \"utf-8\");\r\n        expect(output).toContain(\"test\");\r\n      }\r\n    });\r\n\r\n    it(\"should preserve killed status after terminate\", async () => {\r\n      // Spawn a long-running process\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"sleep 60\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      if (result.success) {\r\n        // Terminate it\r\n        await manager.terminate(result.processId);\r\n\r\n        // Status should be \"killed\", not \"exited\"\r\n        const proc = await manager.getProcess(result.processId);\r\n        expect(proc?.status).toBe(\"killed\");\r\n      }\r\n    });\r\n\r\n    it(\"should report non-zero exit code for signal-terminated processes\", async () => {\r\n      // Spawn a long-running process\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"sleep 60\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      if (result.success) {\r\n        // Terminate it (sends SIGTERM, then SIGKILL after 2s)\r\n        await manager.terminate(result.processId);\r\n\r\n        const proc = await manager.getProcess(result.processId);\r\n        expect(proc).not.toBeNull();\r\n        // Exit code should be 128 + signal number (SIGTERM=15  143, SIGKILL=9  137)\r\n        // Either is acceptable depending on timing\r\n        expect(proc!.exitCode).toBeGreaterThanOrEqual(128);\r\n      }\r\n    });\r\n  });\r\n\r\n  describe(\"process group termination\", () => {\r\n    it(\"should terminate child processes when parent is killed\", async () => {\r\n      // This test validates that set -m creates a process group where PID === PGID,\r\n      // allowing kill -PID to terminate the entire process tree.\r\n\r\n      // Spawn a parent that creates a child process\r\n      // The parent runs: (sleep 60 &); wait\r\n      // This creates: parent bash -> child sleep\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"bash -c 'sleep 60 & wait'\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Give the child process time to start\r\n      await new Promise((resolve) => setTimeout(resolve, 100));\r\n\r\n      // Verify process is running\r\n      const procBefore = await manager.getProcess(result.processId);\r\n      expect(procBefore?.status).toBe(\"running\");\r\n\r\n      // Terminate - this should kill both parent and child via process group\r\n      await manager.terminate(result.processId);\r\n\r\n      // Verify parent is killed\r\n      const procAfter = await manager.getProcess(result.processId);\r\n      expect(procAfter?.status).toBe(\"killed\");\r\n\r\n      // Wait a moment for any orphaned processes to show up\r\n      await new Promise((resolve) => setTimeout(resolve, 500));\r\n\r\n      // Verify no orphaned sleep processes from our test\r\n      // (checking via ps would be flaky, so we rely on the exit code being set,\r\n      // which only happens after the entire process group is dead)\r\n      const exitCode = procAfter?.exitCode;\r\n      expect(exitCode).not.toBeNull();\r\n      expect(exitCode).toBeGreaterThanOrEqual(128); // Signal exit code\r\n    });\r\n  });\r\n\r\n  describe(\"getOutput\", () => {\r\n    it(\"should return stdout from a running process\", async () => {\r\n      // Spawn a process that writes output in two phases.\r\n      // Use a file-gated barrier rather than timing sleeps to avoid CI flakiness.\r\n      const triggerFile = path.join(bgOutputDir, `trigger-${Date.now()}`);\r\n\r\n      const result = await manager.spawn(\r\n        runtime,\r\n        testWorkspaceId,\r\n        `echo 'line 1'; while [ ! -f ${triggerFile} ]; do sleep 0.05; done; echo 'line 2'`,\r\n        { cwd: process.cwd(), displayName: \"test\" }\r\n      );\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Get output - wait up to 1s for the first line\r\n      const output1 = await manager.getOutput(result.processId, undefined, undefined, 1);\r\n      expect(output1.success).toBe(true);\r\n      if (!output1.success) return;\r\n\r\n      expect(output1.output).toContain(\"line 1\");\r\n      expect(output1.output).not.toContain(\"line 2\");\r\n\r\n      // Unblock the process so it can emit the second line\r\n      await fs.writeFile(triggerFile, \"go\", \"utf-8\");\r\n\r\n      // Get output again - wait up to 1s for incremental output (line 2)\r\n      const output2 = await manager.getOutput(result.processId, undefined, undefined, 1);\r\n      expect(output2.success).toBe(true);\r\n      if (!output2.success) return;\r\n\r\n      // Second call should only return new content (line 2)\r\n      expect(output2.output).toContain(\"line 2\");\r\n      // And should NOT contain line 1 again (incremental reads)\r\n      expect(output2.output).not.toContain(\"line 1\");\r\n    });\r\n\r\n    it(\"should return stderr from a running process\", async () => {\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"echo 'error message' >&2\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      await new Promise((resolve) => setTimeout(resolve, 100));\r\n\r\n      const output = await manager.getOutput(result.processId);\r\n      expect(output.success).toBe(true);\r\n      if (!output.success) return;\r\n\r\n      expect(output.output).toContain(\"error message\");\r\n    });\r\n\r\n    it(\"should include elapsed_ms in response\", async () => {\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"sleep 0.2; echo done\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Wait with timeout to ensure blocking\r\n      const output = await manager.getOutput(result.processId, undefined, undefined, 1);\r\n      expect(output.success).toBe(true);\r\n      if (!output.success) return;\r\n\r\n      // elapsed_ms should be present and reflect the wait time\r\n      expect(typeof output.elapsed_ms).toBe(\"number\");\r\n      expect(output.elapsed_ms).toBeGreaterThanOrEqual(0);\r\n    });\r\n\r\n    it(\"should return error for non-existent process\", async () => {\r\n      const output = await manager.getOutput(\"bash_nonexistent\");\r\n      expect(output.success).toBe(false);\r\n      if (output.success) return;\r\n      expect(output.error).toContain(\"not found\");\r\n    });\r\n\r\n    it(\"should return correct status for running vs exited process\", async () => {\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"echo done; exit 0\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Immediately should be running\r\n      const output1 = await manager.getOutput(result.processId);\r\n      expect(output1.success).toBe(true);\r\n      if (!output1.success) return;\r\n      // Status could be running or already exited depending on timing\r\n\r\n      // Wait for exit\r\n      await new Promise((resolve) => setTimeout(resolve, 200));\r\n\r\n      const output2 = await manager.getOutput(result.processId);\r\n      expect(output2.success).toBe(true);\r\n      if (!output2.success) return;\r\n      expect(output2.status).toBe(\"exited\");\r\n      expect(output2.exitCode).toBe(0);\r\n    });\r\n\r\n    it(\"should filter output with regex when provided\", async () => {\r\n      const result = await manager.spawn(\r\n        runtime,\r\n        testWorkspaceId,\r\n        \"echo 'INFO: message'; echo 'DEBUG: noise'; echo 'INFO: another'\",\r\n        { cwd: process.cwd(), displayName: \"test\" }\r\n      );\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      await new Promise((resolve) => setTimeout(resolve, 100));\r\n\r\n      // Filter for INFO lines only\r\n      const output = await manager.getOutput(result.processId, \"INFO\");\r\n      expect(output.success).toBe(true);\r\n      if (!output.success) return;\r\n\r\n      expect(output.output).toContain(\"INFO: message\");\r\n      expect(output.output).toContain(\"INFO: another\");\r\n      expect(output.output).not.toContain(\"DEBUG\");\r\n    });\r\n\r\n    it(\"should exclude matching lines when filter_exclude is true\", async () => {\r\n      const result = await manager.spawn(\r\n        runtime,\r\n        testWorkspaceId,\r\n        \"echo 'INFO: message'; echo 'DEBUG: noise'; echo 'INFO: another'\",\r\n        { cwd: process.cwd(), displayName: \"test\" }\r\n      );\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      await new Promise((resolve) => setTimeout(resolve, 100));\r\n\r\n      // Exclude DEBUG lines (invert filter)\r\n      const output = await manager.getOutput(result.processId, \"DEBUG\", true);\r\n      expect(output.success).toBe(true);\r\n      if (!output.success) return;\r\n\r\n      expect(output.output).toContain(\"INFO: message\");\r\n      expect(output.output).toContain(\"INFO: another\");\r\n      expect(output.output).not.toContain(\"DEBUG\");\r\n    });\r\n\r\n    it(\"should return error when filter_exclude is true but no filter provided\", async () => {\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"echo hello\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // filter_exclude without filter should error\r\n      const output = await manager.getOutput(result.processId, undefined, true);\r\n      expect(output.success).toBe(false);\r\n      if (output.success) return;\r\n      expect(output.error).toContain(\"filter_exclude requires filter\");\r\n    });\r\n\r\n    it(\"should keep waiting when only excluded lines arrive\", async () => {\r\n      const signalPath = path.join(bgOutputDir, `signal-${Date.now()}`);\r\n\r\n      // Spawn a process that spams excluded output until we create a signal file.\r\n      // This avoids flakiness from the spawn itself taking long enough that \"DONE\"\r\n      // is already present by the time we call getOutput.\r\n      const result = await manager.spawn(\r\n        runtime,\r\n        testWorkspaceId,\r\n        `while [ ! -f \"${signalPath}\" ]; do echo 'PROGRESS'; sleep 0.1; done; echo 'DONE'`,\r\n        { cwd: process.cwd(), displayName: \"test\", timeoutSecs: 5 }\r\n      );\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      const outputPromise = manager.getOutput(result.processId, \"PROGRESS\", true, 2);\r\n\r\n      // Ensure getOutput is waiting before we allow the process to produce\r\n      // meaningful output.\r\n      await new Promise((resolve) => setTimeout(resolve, 300));\r\n      await fs.writeFile(signalPath, \"go\");\r\n\r\n      const output = await outputPromise;\r\n      expect(output.success).toBe(true);\r\n      if (!output.success) return;\r\n\r\n      // Should only see DONE, not PROGRESS lines\r\n      expect(output.output).toContain(\"DONE\");\r\n      expect(output.output).not.toContain(\"PROGRESS\");\r\n      expect(output.elapsed_ms).toBeGreaterThanOrEqual(250);\r\n    });\r\n\r\n    it(\"should return when process exits even if only excluded lines\", async () => {\r\n      // Script outputs ONLY excluded lines then exits\r\n      const result = await manager.spawn(\r\n        runtime,\r\n        testWorkspaceId,\r\n        \"echo 'PROGRESS'; echo 'PROGRESS'; exit 0\",\r\n        { cwd: process.cwd(), displayName: \"test\" }\r\n      );\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Wait for process to exit\r\n      await new Promise((resolve) => setTimeout(resolve, 150));\r\n\r\n      // Should return (not hang) even though all output is excluded\r\n      const output = await manager.getOutput(result.processId, \"PROGRESS\", true, 2);\r\n      expect(output.success).toBe(true);\r\n      if (!output.success) return;\r\n\r\n      // Output should be empty (all lines excluded), but we should have status\r\n      expect(output.output.trim()).toBe(\"\");\r\n      expect(output.status).toBe(\"exited\");\r\n    });\r\n\r\n    it(\"should timeout and return even if only excluded lines arrived\", async () => {\r\n      // Script outputs progress indefinitely\r\n      const result = await manager.spawn(\r\n        runtime,\r\n        testWorkspaceId,\r\n        \"while true; do echo 'PROGRESS'; sleep 0.1; done\",\r\n        { cwd: process.cwd(), displayName: \"test\", timeoutSecs: 10 }\r\n      );\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Short timeout - should return with empty output, not hang\r\n      const output = await manager.getOutput(result.processId, \"PROGRESS\", true, 0.3);\r\n      expect(output.success).toBe(true);\r\n      if (!output.success) return;\r\n\r\n      // Should have returned due to timeout, output empty (all excluded)\r\n      expect(output.output.trim()).toBe(\"\");\r\n      expect(output.status).toBe(\"running\");\r\n      expect(output.elapsed_ms).toBeGreaterThanOrEqual(250);\r\n      expect(output.elapsed_ms).toBeLessThan(1000); // Didn't hang\r\n    });\r\n\r\n    it(\"should serialize concurrent getOutput calls to prevent duplicate output\", async () => {\r\n      // This test verifies the fix for the race condition where parallel bash_output\r\n      // calls could both read from the same offset before either updates the position.\r\n      // Without serialization, both calls would return the same output.\r\n      const result = await manager.spawn(\r\n        runtime,\r\n        testWorkspaceId,\r\n        \"echo 'line1'; echo 'line2'; echo 'line3'\",\r\n        { cwd: process.cwd(), displayName: \"test\" }\r\n      );\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Wait for all output to be written\r\n      await new Promise((resolve) => setTimeout(resolve, 200));\r\n\r\n      // Call getOutput twice in parallel - without serialization, both would\r\n      // read from offset 0 and return duplicate \"line1\\nline2\\nline3\"\r\n      const [output1, output2] = await Promise.all([\r\n        manager.getOutput(result.processId),\r\n        manager.getOutput(result.processId),\r\n      ]);\r\n\r\n      expect(output1.success).toBe(true);\r\n      expect(output2.success).toBe(true);\r\n      if (!output1.success || !output2.success) return;\r\n\r\n      // Combine outputs - should contain all lines exactly once\r\n      const combinedOutput = output1.output + output2.output;\r\n      const line1Count = (combinedOutput.match(/line1/g) ?? []).length;\r\n      const line2Count = (combinedOutput.match(/line2/g) ?? []).length;\r\n      const line3Count = (combinedOutput.match(/line3/g) ?? []).length;\r\n\r\n      // Each line should appear exactly once across both outputs (no duplicates)\r\n      expect(line1Count).toBe(1);\r\n      expect(line2Count).toBe(1);\r\n      expect(line3Count).toBe(1);\r\n\r\n      // One call should get the content, the other should get empty (already read)\r\n      const hasContent = output1.output.trim().length > 0 || output2.output.trim().length > 0;\r\n      expect(hasContent).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe(\"peekOutput\", () => {\r\n    it(\"should not advance the output cursor used by getOutput\", async () => {\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"echo hello; sleep 0.2\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Wait for output to be written\r\n      await new Promise((resolve) => setTimeout(resolve, 100));\r\n\r\n      const peek = await manager.peekOutput(result.processId, { fromOffset: 0 });\r\n      expect(peek.success).toBe(true);\r\n      if (!peek.success) return;\r\n      expect(peek.output).toContain(\"hello\");\r\n\r\n      // peekOutput should not affect getOutput's cursor\r\n      const output = await manager.getOutput(result.processId, undefined, undefined, 1);\r\n      expect(output.success).toBe(true);\r\n      if (!output.success) return;\r\n      expect(output.output).toContain(\"hello\");\r\n    });\r\n  });\r\n\r\n  describe(\"integration: spawn and getOutput\", () => {\r\n    it(\"should retrieve output after spawn using same manager instance\", async () => {\r\n      // This test verifies the core workflow: spawn -> getOutput\r\n      // Both must use the SAME manager instance\r\n\r\n      // Spawn process that produces output\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"echo 'hello from bg'\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Wait for output using the SAME manager (avoid sleep-based flakiness)\r\n      const output = await manager.getOutput(result.processId, undefined, undefined, 2);\r\n      expect(output.success).toBe(true);\r\n      if (!output.success) return;\r\n\r\n      expect(output.output).toContain(\"hello from bg\");\r\n    });\r\n\r\n    it(\"should read from offset 0 on first call even if file already has content\", async () => {\r\n      // Spawn a process that writes output immediately\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"echo 'initial output'\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Wait longer to ensure output is definitely written\r\n      await new Promise((resolve) => setTimeout(resolve, 500));\r\n\r\n      // Verify the file has content\r\n      const outputPath = path.join(result.outputDir, \"output.log\");\r\n      const fileContent = await fs.readFile(outputPath, \"utf-8\");\r\n      expect(fileContent).toContain(\"initial output\");\r\n\r\n      // Now call getOutput - first call should read from offset 0\r\n      const output = await manager.getOutput(result.processId);\r\n      expect(output.success).toBe(true);\r\n      if (!output.success) return;\r\n\r\n      // Should have the output even though some time has passed\r\n      expect(output.output).toContain(\"initial output\");\r\n    });\r\n\r\n    it(\"DEBUG: verifies outputDir from spawn matches getProcess\", async () => {\r\n      // Verify that outputDir returned from spawn is the same as what getProcess returns\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"echo 'verify test'\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      const proc = await manager.getProcess(result.processId);\r\n      expect(proc).not.toBeNull();\r\n\r\n      // CRITICAL: outputDir from spawn MUST match outputDir from getProcess\r\n      expect(proc!.outputDir).toBe(result.outputDir);\r\n\r\n      // Wait for output to be written\r\n      await new Promise((resolve) => setTimeout(resolve, 100));\r\n\r\n      // Verify file exists at the expected path\r\n      const outputPath = path.join(result.outputDir, \"output.log\");\r\n      const content = await fs.readFile(outputPath, \"utf-8\");\r\n      expect(content).toContain(\"verify test\");\r\n\r\n      // Now getOutput should return the content\r\n      const output = await manager.getOutput(result.processId);\r\n      expect(output.success).toBe(true);\r\n      if (output.success) {\r\n        expect(output.output).toContain(\"verify test\");\r\n      }\r\n    });\r\n\r\n    it(\"should work when spawned via bash tool and read via bash_output tool\", async () => {\r\n      // This simulates the exact flow in the real system:\r\n      // 1. bash tool with run_in_background=true spawns process\r\n      // 2. bash_output tool reads output\r\n\r\n      const tempDir = new TestTempDir(\"test-bg-integration\");\r\n\r\n      // Create shared config with the SAME manager instance\r\n      const config = createTestToolConfig(tempDir.path, {\r\n        workspaceId: testWorkspaceId,\r\n        sessionsDir: tempDir.path,\r\n      });\r\n      config.backgroundProcessManager = manager;\r\n      config.runtime = runtime;\r\n\r\n      // Create bash tool and spawn background process\r\n      const bashTool = createBashTool(config);\r\n      const spawnResult = (await bashTool.execute!(\r\n        { script: \"echo 'hello from integration test'\", run_in_background: true },\r\n        { toolCallId: \"test\", messages: [] }\r\n      )) as BashToolResult;\r\n\r\n      expect(spawnResult).toBeDefined();\r\n      expect(spawnResult.success).toBe(true);\r\n      expect(\"backgroundProcessId\" in spawnResult).toBe(true);\r\n\r\n      // Type narrowing for background process result\r\n      if (!(\"backgroundProcessId\" in spawnResult)) {\r\n        throw new Error(\"Expected background process result\");\r\n      }\r\n      const processId: string = spawnResult.backgroundProcessId;\r\n\r\n      // Wait for output\r\n      await new Promise((resolve) => setTimeout(resolve, 200));\r\n\r\n      // Create bash_output tool and read output\r\n      const outputTool = createBashOutputTool(config);\r\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\r\n      const rawOutputResult = await outputTool.execute!(\r\n        { process_id: processId },\r\n        { toolCallId: \"test2\", messages: [] }\r\n      );\r\n\r\n      const outputResult = rawOutputResult as BashOutputToolResult;\r\n\r\n      expect(outputResult).toBeDefined();\r\n\r\n      // This is the key assertion - should succeed AND have content\r\n      expect(outputResult.success).toBe(true);\r\n      if (outputResult.success) {\r\n        expect(outputResult.output).toContain(\"hello from integration test\");\r\n      } else {\r\n        throw new Error(`bash_output failed: ${outputResult.error}`);\r\n      }\r\n\r\n      tempDir[Symbol.dispose]();\r\n    });\r\n\r\n    it(\"should fail to get output if using different manager instance\", async () => {\r\n      // This test documents what happens if manager instances differ\r\n      // (which would be a bug in the real system)\r\n\r\n      // Spawn with first manager\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"echo 'test'\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Create a DIFFERENT manager instance\r\n      const otherManager = new BackgroundProcessManager(bgOutputDir);\r\n\r\n      // Trying to get output from different manager should fail\r\n      // because the process isn't in its internal map\r\n      const output = await otherManager.getOutput(result.processId);\r\n      expect(output.success).toBe(false);\r\n      if (!output.success) {\r\n        expect(output.error).toContain(\"Process not found\");\r\n      }\r\n    });\r\n  });\r\n\r\n  describe(\"exit_code file\", () => {\r\n    it(\"should write exit_code file when process exits\", async () => {\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"exit 42\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Wait for process to exit and exit_code to be written\r\n      await new Promise((resolve) => setTimeout(resolve, 200));\r\n\r\n      // Check exit_code file exists and contains correct value\r\n      const exitCodePath = path.join(result.outputDir, \"exit_code\");\r\n      const exitCodeContent = await fs.readFile(exitCodePath, \"utf-8\");\r\n      expect(exitCodeContent.trim()).toBe(\"42\");\r\n    });\r\n  });\r\n\r\n  describe(\"line-buffered filtering\", () => {\r\n    it(\"should only filter complete lines, not fragments\", async () => {\r\n      // Process that outputs lines that should be filtered and one that shouldn't\r\n      const result = await manager.spawn(\r\n        runtime,\r\n        testWorkspaceId,\r\n        // Output lines: some with 'progress', one without\r\n        \"echo 'progress 1'; echo 'progress 2'; echo 'FINAL RESULT'\",\r\n        { cwd: process.cwd(), displayName: \"test\" }\r\n      );\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Wait for process to complete\r\n      await new Promise((resolve) => setTimeout(resolve, 300));\r\n\r\n      // Filter out lines containing 'progress', should only get 'FINAL RESULT'\r\n      const output = await manager.getOutput(result.processId, \"progress\", true, 0.5);\r\n      expect(output.success).toBe(true);\r\n      if (!output.success) return;\r\n      expect(output.output).toContain(\"FINAL RESULT\");\r\n      expect(output.output).not.toContain(\"progress\");\r\n    });\r\n\r\n    it(\"should buffer incomplete lines across calls\", async () => {\r\n      // Process that outputs progress lines\r\n      const result = await manager.spawn(\r\n        runtime,\r\n        testWorkspaceId,\r\n        \"echo 'progress: 50%'; sleep 0.1; echo 'progress: 100%'; echo 'DONE'\",\r\n        { cwd: process.cwd(), displayName: \"test\" }\r\n      );\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Wait for process to complete\r\n      await new Promise((resolve) => setTimeout(resolve, 500));\r\n\r\n      // Filter out progress lines, should only get 'DONE'\r\n      const output = await manager.getOutput(result.processId, \"progress\", true, 0.5);\r\n      expect(output.success).toBe(true);\r\n      if (!output.success) return;\r\n      expect(output.output).toContain(\"DONE\");\r\n      expect(output.output).not.toContain(\"progress\");\r\n    });\r\n\r\n    it(\"should include incomplete line on process exit\", async () => {\r\n      // Process that exits without final newline\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"printf 'no newline at end'\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Wait for process to exit\r\n      await new Promise((resolve) => setTimeout(resolve, 300));\r\n\r\n      const output = await manager.getOutput(result.processId, undefined, undefined, 0.5);\r\n      expect(output.success).toBe(true);\r\n      if (!output.success) return;\r\n      expect(output.output).toContain(\"no newline at end\");\r\n      expect(output.status).not.toBe(\"running\");\r\n    });\r\n  });\r\n\r\n  describe(\"polling detection\", () => {\r\n    it(\"should return note after 3+ calls without filter_exclude on running process\", async () => {\r\n      // Long-running process\r\n      const result = await manager.spawn(\r\n        runtime,\r\n        testWorkspaceId,\r\n        \"while true; do echo 'tick'; sleep 0.5; done\",\r\n        { cwd: process.cwd(), displayName: \"test\", timeoutSecs: 30 }\r\n      );\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // First two calls should not have a note\r\n      const output1 = await manager.getOutput(result.processId, undefined, undefined, 0.1);\r\n      expect(output1.success).toBe(true);\r\n      if (!output1.success) return;\r\n      expect(output1.note).toBeUndefined();\r\n\r\n      const output2 = await manager.getOutput(result.processId, undefined, undefined, 0.1);\r\n      expect(output2.success).toBe(true);\r\n      if (!output2.success) return;\r\n      expect(output2.note).toBeUndefined();\r\n\r\n      // Third call should have the suggestion note\r\n      const output3 = await manager.getOutput(result.processId, undefined, undefined, 0.1);\r\n      expect(output3.success).toBe(true);\r\n      if (!output3.success) return;\r\n      expect(output3.note).toContain(\"filter_exclude\");\r\n      expect(output3.note).toContain(\"3+ times\");\r\n    });\r\n\r\n    it(\"should return better pattern note when filter_exclude is used but still polling\", async () => {\r\n      const result = await manager.spawn(\r\n        runtime,\r\n        testWorkspaceId,\r\n        \"while true; do echo 'tick'; sleep 0.5; done\",\r\n        { cwd: process.cwd(), displayName: \"test\", timeoutSecs: 30 }\r\n      );\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Make 3+ calls with filter_exclude - should get \"better pattern\" note\r\n      let lastNote: string | undefined;\r\n      for (let i = 0; i < 4; i++) {\r\n        const output = await manager.getOutput(result.processId, \"nomatch\", true, 0.1);\r\n        expect(output.success).toBe(true);\r\n        if (!output.success) return;\r\n        lastNote = output.note;\r\n      }\r\n      // Should get the \"better pattern\" note since we're using filter_exclude but still polling\r\n      expect(lastNote).toContain(\"filter_exclude but still polling\");\r\n      expect(lastNote).toContain(\"broader pattern\");\r\n    });\r\n\r\n    it(\"should NOT return note when process has exited\", async () => {\r\n      const result = await manager.spawn(runtime, testWorkspaceId, \"echo done; exit 0\", {\r\n        cwd: process.cwd(),\r\n        displayName: \"test\",\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      if (!result.success) return;\r\n\r\n      // Wait for process to exit\r\n      await new Promise((resolve) => setTimeout(resolve, 200));\r\n\r\n      // Make 3+ calls on exited process\r\n      for (let i = 0; i < 4; i++) {\r\n        const output = await manager.getOutput(result.processId, undefined, undefined, 0.1);\r\n        expect(output.success).toBe(true);\r\n        if (!output.success) return;\r\n        // Should not get note since process is not running\r\n        expect(output.note).toBeUndefined();\r\n      }\r\n    });\r\n  });\r\n});\r\n"]}