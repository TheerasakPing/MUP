{"version":3,"file":"workspaceService.test.js","sourceRoot":"","sources":["../../../src/node/services/workspaceService.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, test, mock, beforeEach, afterEach, spyOn } from \"bun:test\";\nimport { WorkspaceService } from \"./workspaceService\";\nimport type { AgentSession } from \"./agentSession\";\nimport { WorkspaceLifecycleHooks } from \"./workspaceLifecycleHooks\";\nimport { EventEmitter } from \"events\";\nimport * as fsPromises from \"fs/promises\";\nimport { tmpdir } from \"os\";\nimport path from \"path\";\nimport { Err, Ok, type Result } from \"@/common/types/result\";\nimport type { ProjectsConfig } from \"@/common/types/project\";\nimport type { Config } from \"@/node/config\";\nimport type { HistoryService } from \"./historyService\";\nimport { createTestHistoryService } from \"./testHistoryService\";\nimport type { PartialService } from \"./partialService\";\nimport type { SessionUsageService } from \"./sessionUsageService\";\nimport type { CostTrackingService } from \"./costTrackingService\";\nimport type { SessionTimingService } from \"./sessionTimingService\";\nimport type { AIService } from \"./aiService\";\nimport type { InitStateManager, InitStatus } from \"./initStateManager\";\nimport type { ExtensionMetadataService } from \"./ExtensionMetadataService\";\nimport type { FrontendWorkspaceMetadata, WorkspaceMetadata } from \"@/common/types/workspace\";\nimport type { BackgroundProcessManager } from \"./backgroundProcessManager\";\nimport type { BashToolResult } from \"@/common/types/tools\";\nimport { MUX_HELP_CHAT_WORKSPACE_ID } from \"@/common/constants/muxChat\";\nimport * as runtimeFactory from \"@/node/runtime/runtimeFactory\";\n\n// Helper to access private renamingWorkspaces set\nfunction addToRenamingWorkspaces(service: WorkspaceService, workspaceId: string): void {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-call\n  (service as any).renamingWorkspaces.add(workspaceId);\n}\n\n// Helper to access private archivingWorkspaces set\nfunction addToArchivingWorkspaces(service: WorkspaceService, workspaceId: string): void {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-call\n  (service as any).archivingWorkspaces.add(workspaceId);\n}\n\nasync function withTempMuxRoot<T>(fn: (root: string) => Promise<T>): Promise<T> {\n  const originalMuxRoot = process.env.MUX_ROOT;\n  const tempRoot = await fsPromises.mkdtemp(path.join(tmpdir(), \"mux-plan-\"));\n  process.env.MUX_ROOT = tempRoot;\n\n  try {\n    return await fn(tempRoot);\n  } finally {\n    if (originalMuxRoot === undefined) {\n      delete process.env.MUX_ROOT;\n    } else {\n      process.env.MUX_ROOT = originalMuxRoot;\n    }\n    await fsPromises.rm(tempRoot, { recursive: true, force: true });\n  }\n}\n\nasync function writePlanFile(\n  root: string,\n  projectName: string,\n  workspaceName: string\n): Promise<string> {\n  const planDir = path.join(root, \"plans\", projectName);\n  await fsPromises.mkdir(planDir, { recursive: true });\n  const planFile = path.join(planDir, `${workspaceName}.md`);\n  await fsPromises.writeFile(planFile, \"# Plan\\n\");\n  return planFile;\n}\n\n// NOTE: This test file uses bun:test mocks (not Jest).\n\ndescribe(\"WorkspaceService rename lock\", () => {\n  let workspaceService: WorkspaceService;\n  let mockAIService: AIService;\n  let historyService: HistoryService;\n  let cleanupHistory: () => Promise<void>;\n\n  beforeEach(async () => {\n    // Create minimal mocks for the services\n    mockAIService = {\n      isStreaming: mock(() => false),\n      getWorkspaceMetadata: mock(() => Promise.resolve({ success: false, error: \"not found\" })),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      on: mock(() => { }),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      off: mock(() => { }),\n    } as unknown as AIService;\n\n    ({ historyService, cleanup: cleanupHistory } = await createTestHistoryService());\n\n    const mockConfig: Partial<Config> = {\n      srcDir: \"/tmp/test\",\n      getSessionDir: mock(() => \"/tmp/test/sessions\"),\n      generateStableId: mock(() => \"test-id\"),\n      findWorkspace: mock(() => null),\n    };\n\n    const mockPartialService: Partial<PartialService> = {\n      commitToHistory: mock(() => Promise.resolve({ success: true as const, data: undefined })),\n    };\n\n    const mockInitStateManager: Partial<InitStateManager> = {\n      on: mock(() => undefined as unknown as InitStateManager),\n      getInitState: mock(() => undefined),\n    };\n    const mockExtensionMetadataService: Partial<ExtensionMetadataService> = {};\n    const mockBackgroundProcessManager: Partial<BackgroundProcessManager> = {\n      cleanup: mock(() => Promise.resolve()),\n    };\n\n    workspaceService = new WorkspaceService(\n      mockConfig as Config,\n      historyService,\n      mockPartialService as PartialService,\n      mockAIService,\n      mockInitStateManager as InitStateManager,\n      mockExtensionMetadataService as ExtensionMetadataService,\n      mockBackgroundProcessManager as BackgroundProcessManager,\n      {} as SessionUsageService,\n      {} as CostTrackingService\n    );\n  });\n\n  afterEach(async () => {\n    await cleanupHistory();\n  });\n\n  test(\"sendMessage returns error when workspace is being renamed\", async () => {\n    const workspaceId = \"test-workspace\";\n\n    addToRenamingWorkspaces(workspaceService, workspaceId);\n\n    const result = await workspaceService.sendMessage(workspaceId, \"test message\", {\n      model: \"test-model\",\n      agentId: \"exec\",\n    });\n\n    expect(result.success).toBe(false);\n    if (!result.success) {\n      const error = result.error;\n      // Error is SendMessageError which has a discriminated union\n      expect(typeof error === \"object\" && error.type === \"unknown\").toBe(true);\n      if (typeof error === \"object\" && error.type === \"unknown\") {\n        expect(error.raw).toContain(\"being renamed\");\n      }\n    }\n  });\n\n  test(\"resumeStream returns error when workspace is being renamed\", async () => {\n    const workspaceId = \"test-workspace\";\n\n    addToRenamingWorkspaces(workspaceService, workspaceId);\n\n    const result = await workspaceService.resumeStream(workspaceId, {\n      model: \"test-model\",\n      agentId: \"exec\",\n    });\n\n    expect(result.success).toBe(false);\n    if (!result.success) {\n      const error = result.error;\n      // Error is SendMessageError which has a discriminated union\n      expect(typeof error === \"object\" && error.type === \"unknown\").toBe(true);\n      if (typeof error === \"object\" && error.type === \"unknown\") {\n        expect(error.raw).toContain(\"being renamed\");\n      }\n    }\n  });\n\n  test(\"rename returns error when workspace is streaming\", async () => {\n    const workspaceId = \"test-workspace\";\n\n    // Mock isStreaming to return true\n    (mockAIService.isStreaming as ReturnType<typeof mock>).mockReturnValue(true);\n\n    const result = await workspaceService.rename(workspaceId, \"new-name\");\n\n    expect(result.success).toBe(false);\n    if (!result.success) {\n      expect(result.error).toContain(\"stream is active\");\n    }\n  });\n});\n\ndescribe(\"WorkspaceService executeBash archive guards\", () => {\n  let workspaceService: WorkspaceService;\n  let waitForInitMock: ReturnType<typeof mock>;\n  let getWorkspaceMetadataMock: ReturnType<typeof mock>;\n  let historyService: HistoryService;\n  let cleanupHistory: () => Promise<void>;\n\n  beforeEach(async () => {\n    waitForInitMock = mock(() => Promise.resolve());\n\n    getWorkspaceMetadataMock = mock(() =>\n      Promise.resolve({ success: false as const, error: \"not found\" })\n    );\n\n    const aiService: AIService = {\n      isStreaming: mock(() => false),\n      getWorkspaceMetadata: getWorkspaceMetadataMock,\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      on: mock(() => { }),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      off: mock(() => { }),\n    } as unknown as AIService;\n\n    ({ historyService, cleanup: cleanupHistory } = await createTestHistoryService());\n\n    const mockConfig: Partial<Config> = {\n      srcDir: \"/tmp/test\",\n      getSessionDir: mock(() => \"/tmp/test/sessions\"),\n      generateStableId: mock(() => \"test-id\"),\n      findWorkspace: mock(() => null),\n      getProjectSecrets: mock(() => []),\n    };\n\n    const mockPartialService: Partial<PartialService> = {\n      commitToHistory: mock(() => Promise.resolve({ success: true as const, data: undefined })),\n    };\n\n    const mockInitStateManager: Partial<InitStateManager> = {\n      on: mock(() => undefined as unknown as InitStateManager),\n      getInitState: mock(() => undefined),\n      waitForInit: waitForInitMock,\n    };\n\n    const mockExtensionMetadataService: Partial<ExtensionMetadataService> = {};\n    const mockBackgroundProcessManager: Partial<BackgroundProcessManager> = {\n      cleanup: mock(() => Promise.resolve()),\n    };\n\n    workspaceService = new WorkspaceService(\n      mockConfig as Config,\n      historyService,\n      mockPartialService as PartialService,\n      aiService,\n      mockInitStateManager as InitStateManager,\n      mockExtensionMetadataService as ExtensionMetadataService,\n      mockBackgroundProcessManager as BackgroundProcessManager,\n      {} as SessionUsageService,\n      {} as CostTrackingService\n    );\n  });\n\n  afterEach(async () => {\n    await cleanupHistory();\n  });\n\n  test(\"archived workspace => executeBash returns error mentioning archived\", async () => {\n    const workspaceId = \"ws-archived\";\n\n    const archivedMetadata: WorkspaceMetadata = {\n      id: workspaceId,\n      name: \"ws\",\n      projectName: \"proj\",\n      projectPath: \"/tmp/proj\",\n      runtimeConfig: { type: \"local\", srcBaseDir: \"/tmp\" },\n      archivedAt: \"2026-01-01T00:00:00.000Z\",\n    };\n\n    getWorkspaceMetadataMock.mockReturnValue(Promise.resolve(Ok(archivedMetadata)));\n\n    const result = await workspaceService.executeBash(workspaceId, \"echo hello\");\n\n    expect(result.success).toBe(false);\n    if (!result.success) {\n      expect(result.error).toContain(\"archived\");\n    }\n\n    // This must happen before init/runtime operations.\n    expect(waitForInitMock).toHaveBeenCalledTimes(0);\n  });\n\n  test(\"archiving workspace => executeBash returns error mentioning being archived\", async () => {\n    const workspaceId = \"ws-archiving\";\n\n    addToArchivingWorkspaces(workspaceService, workspaceId);\n\n    const result = await workspaceService.executeBash(workspaceId, \"echo hello\");\n\n    expect(result.success).toBe(false);\n    if (!result.success) {\n      expect(result.error).toContain(\"being archived\");\n    }\n\n    expect(waitForInitMock).toHaveBeenCalledTimes(0);\n    expect(getWorkspaceMetadataMock).toHaveBeenCalledTimes(0);\n  });\n});\n\ndescribe(\"WorkspaceService post-compaction metadata refresh\", () => {\n  let workspaceService: WorkspaceService;\n  let historyService: HistoryService;\n  let cleanupHistory: () => Promise<void>;\n\n  beforeEach(async () => {\n    const aiService: AIService = {\n      isStreaming: mock(() => false),\n      getWorkspaceMetadata: mock(() =>\n        Promise.resolve({ success: false as const, error: \"not found\" })\n      ),\n      on(_eventName: string | symbol, _listener: (...args: unknown[]) => void) {\n        return this;\n      },\n      off(_eventName: string | symbol, _listener: (...args: unknown[]) => void) {\n        return this;\n      },\n    } as unknown as AIService;\n\n    ({ historyService, cleanup: cleanupHistory } = await createTestHistoryService());\n\n    const mockConfig: Partial<Config> = {\n      srcDir: \"/tmp/test\",\n      getSessionDir: mock(() => \"/tmp/test/sessions\"),\n      generateStableId: mock(() => \"test-id\"),\n      findWorkspace: mock(() => null),\n    };\n\n    const mockPartialService: Partial<PartialService> = {\n      commitToHistory: mock(() => Promise.resolve({ success: true as const, data: undefined })),\n    };\n\n    const mockInitStateManager: Partial<InitStateManager> = {\n      on: mock(() => undefined as unknown as InitStateManager),\n      getInitState: mock(() => undefined),\n    };\n    const mockExtensionMetadataService: Partial<ExtensionMetadataService> = {};\n    const mockBackgroundProcessManager: Partial<BackgroundProcessManager> = {\n      cleanup: mock(() => Promise.resolve()),\n    };\n\n    workspaceService = new WorkspaceService(\n      mockConfig as Config,\n      historyService,\n      mockPartialService as PartialService,\n      aiService,\n      mockInitStateManager as InitStateManager,\n      mockExtensionMetadataService as ExtensionMetadataService,\n      mockBackgroundProcessManager as BackgroundProcessManager,\n      {} as SessionUsageService,\n      {} as CostTrackingService\n    );\n  });\n\n  afterEach(async () => {\n    await cleanupHistory();\n  });\n\n  test(\"returns expanded plan path for local runtimes\", async () => {\n    await withTempMuxRoot(async (muxRoot) => {\n      const workspaceId = \"ws-plan-path\";\n      const workspaceName = \"plan-workspace\";\n      const projectName = \"cmux\";\n      const planFile = await writePlanFile(muxRoot, projectName, workspaceName);\n\n      interface WorkspaceServiceTestAccess {\n        getInfo: (workspaceId: string) => Promise<FrontendWorkspaceMetadata | null>;\n      }\n\n      const fakeMetadata: FrontendWorkspaceMetadata = {\n        id: workspaceId,\n        name: workspaceName,\n        projectName,\n        projectPath: \"/tmp/proj\",\n        namedWorkspacePath: \"/tmp/proj/plan-workspace\",\n        runtimeConfig: { type: \"local\", srcBaseDir: \"/tmp\" },\n      };\n\n      const svc = workspaceService as unknown as WorkspaceServiceTestAccess;\n      svc.getInfo = mock(() => Promise.resolve(fakeMetadata));\n\n      const result = await workspaceService.getPostCompactionState(workspaceId);\n\n      expect(result.planPath).toBe(planFile);\n      expect(result.planPath?.startsWith(\"~\")).toBe(false);\n    });\n  });\n\n  test(\"debounces multiple refresh requests into a single metadata emit\", async () => {\n    const workspaceId = \"ws-post-compaction\";\n\n    const emitMetadata = mock(() => undefined);\n\n    interface WorkspaceServiceTestAccess {\n      sessions: Map<string, { emitMetadata: (metadata: unknown) => void }>;\n      getInfo: (workspaceId: string) => Promise<FrontendWorkspaceMetadata | null>;\n      getPostCompactionState: (workspaceId: string) => Promise<{\n        planPath: string | null;\n        trackedFilePaths: string[];\n        excludedItems: string[];\n      }>;\n      schedulePostCompactionMetadataRefresh: (workspaceId: string) => void;\n    }\n\n    const svc = workspaceService as unknown as WorkspaceServiceTestAccess;\n    svc.sessions.set(workspaceId, { emitMetadata });\n\n    const fakeMetadata: FrontendWorkspaceMetadata = {\n      id: workspaceId,\n      name: \"ws\",\n      projectName: \"proj\",\n      projectPath: \"/tmp/proj\",\n      namedWorkspacePath: \"/tmp/proj/ws\",\n      runtimeConfig: { type: \"local\", srcBaseDir: \"/tmp\" },\n    };\n\n    const getInfoMock: WorkspaceServiceTestAccess[\"getInfo\"] = mock(() =>\n      Promise.resolve(fakeMetadata)\n    );\n\n    const postCompactionState = {\n      planPath: \"~/.mux/plans/cmux/plan.md\",\n      trackedFilePaths: [\"/tmp/proj/file.ts\"],\n      excludedItems: [],\n    };\n\n    const getPostCompactionStateMock: WorkspaceServiceTestAccess[\"getPostCompactionState\"] = mock(\n      () => Promise.resolve(postCompactionState)\n    );\n\n    svc.getInfo = getInfoMock;\n    svc.getPostCompactionState = getPostCompactionStateMock;\n\n    svc.schedulePostCompactionMetadataRefresh(workspaceId);\n    svc.schedulePostCompactionMetadataRefresh(workspaceId);\n    svc.schedulePostCompactionMetadataRefresh(workspaceId);\n\n    // Debounce is short, but use a safe buffer.\n    await new Promise((resolve) => setTimeout(resolve, 150));\n\n    expect(getInfoMock).toHaveBeenCalledTimes(1);\n    expect(getPostCompactionStateMock).toHaveBeenCalledTimes(1);\n    expect(emitMetadata).toHaveBeenCalledTimes(1);\n\n    const enriched = (emitMetadata as ReturnType<typeof mock>).mock.calls[0][0] as {\n      postCompaction?: { planPath: string | null };\n    };\n    expect(enriched.postCompaction?.planPath).toBe(postCompactionState.planPath);\n  });\n});\n\ndescribe(\"WorkspaceService maybePersistAISettingsFromOptions\", () => {\n  let workspaceService: WorkspaceService;\n  let historyService: HistoryService;\n  let cleanupHistory: () => Promise<void>;\n\n  beforeEach(async () => {\n    const aiService: AIService = {\n      isStreaming: mock(() => false),\n      getWorkspaceMetadata: mock(() => Promise.resolve({ success: false as const, error: \"nope\" })),\n      on(_eventName: string | symbol, _listener: (...args: unknown[]) => void) {\n        return this;\n      },\n      off(_eventName: string | symbol, _listener: (...args: unknown[]) => void) {\n        return this;\n      },\n    } as unknown as AIService;\n\n    ({ historyService, cleanup: cleanupHistory } = await createTestHistoryService());\n\n    const mockConfig: Partial<Config> = {\n      srcDir: \"/tmp/test\",\n      getSessionDir: mock(() => \"/tmp/test/sessions\"),\n      generateStableId: mock(() => \"test-id\"),\n      findWorkspace: mock(() => null),\n    };\n\n    const mockPartialService: Partial<PartialService> = {\n      commitToHistory: mock(() => Promise.resolve({ success: true as const, data: undefined })),\n    };\n\n    const mockInitStateManager: Partial<InitStateManager> = {\n      on: mock(() => undefined as unknown as InitStateManager),\n      getInitState: mock(() => undefined),\n    };\n    const mockExtensionMetadataService: Partial<ExtensionMetadataService> = {};\n    const mockBackgroundProcessManager: Partial<BackgroundProcessManager> = {\n      cleanup: mock(() => Promise.resolve()),\n    };\n\n    workspaceService = new WorkspaceService(\n      mockConfig as Config,\n      historyService,\n      mockPartialService as PartialService,\n      aiService,\n      mockInitStateManager as InitStateManager,\n      mockExtensionMetadataService as ExtensionMetadataService,\n      mockBackgroundProcessManager as BackgroundProcessManager,\n      {} as SessionUsageService,\n      {} as CostTrackingService\n    );\n  });\n\n  afterEach(async () => {\n    await cleanupHistory();\n  });\n\n  test(\"persists agent AI settings for custom agent\", async () => {\n    const persistSpy = mock(() => Promise.resolve({ success: true as const, data: true }));\n\n    interface WorkspaceServiceTestAccess {\n      maybePersistAISettingsFromOptions: (\n        workspaceId: string,\n        options: unknown,\n        context: \"send\" | \"resume\"\n      ) => Promise<void>;\n      persistWorkspaceAISettingsForAgent: (...args: unknown[]) => unknown;\n    }\n\n    const svc = workspaceService as unknown as WorkspaceServiceTestAccess;\n    svc.persistWorkspaceAISettingsForAgent = persistSpy;\n\n    await svc.maybePersistAISettingsFromOptions(\n      \"ws\",\n      {\n        agentId: \"reviewer\",\n        model: \"openai:gpt-4o-mini\",\n        thinkingLevel: \"off\",\n      },\n      \"send\"\n    );\n\n    expect(persistSpy).toHaveBeenCalledTimes(1);\n  });\n\n  test(\"persists agent AI settings when agentId matches\", async () => {\n    const persistSpy = mock(() => Promise.resolve({ success: true as const, data: true }));\n\n    interface WorkspaceServiceTestAccess {\n      maybePersistAISettingsFromOptions: (\n        workspaceId: string,\n        options: unknown,\n        context: \"send\" | \"resume\"\n      ) => Promise<void>;\n      persistWorkspaceAISettingsForAgent: (...args: unknown[]) => unknown;\n    }\n\n    const svc = workspaceService as unknown as WorkspaceServiceTestAccess;\n    svc.persistWorkspaceAISettingsForAgent = persistSpy;\n\n    await svc.maybePersistAISettingsFromOptions(\n      \"ws\",\n      {\n        agentId: \"exec\",\n        model: \"openai:gpt-4o-mini\",\n        thinkingLevel: \"off\",\n      },\n      \"send\"\n    );\n\n    expect(persistSpy).toHaveBeenCalledTimes(1);\n  });\n});\ndescribe(\"WorkspaceService remove timing rollup\", () => {\n  let historyService: HistoryService;\n  let cleanupHistory: () => Promise<void>;\n\n  beforeEach(async () => {\n    ({ historyService, cleanup: cleanupHistory } = await createTestHistoryService());\n  });\n\n  afterEach(async () => {\n    await cleanupHistory();\n  });\n\n  test(\"waits for stream-abort before rolling up session timing\", async () => {\n    const workspaceId = \"child-ws\";\n    const parentWorkspaceId = \"parent-ws\";\n\n    const tempRoot = await fsPromises.mkdtemp(path.join(tmpdir(), \"mux-remove-\"));\n    try {\n      const sessionRoot = path.join(tempRoot, \"sessions\");\n      await fsPromises.mkdir(path.join(sessionRoot, workspaceId), { recursive: true });\n\n      let abortEmitted = false;\n      let rollUpSawAbort = false;\n\n      class FakeAIService extends EventEmitter {\n        isStreaming = mock(() => true);\n\n        stopStream = mock(() => {\n          setTimeout(() => {\n            abortEmitted = true;\n            this.emit(\"stream-abort\", {\n              type: \"stream-abort\",\n              workspaceId,\n              messageId: \"msg\",\n              abortReason: \"system\",\n              metadata: { duration: 123 },\n              abandonPartial: true,\n            });\n          }, 0);\n\n          return Promise.resolve({ success: true as const, data: undefined });\n        });\n\n        getWorkspaceMetadata = mock(() =>\n          Promise.resolve({\n            success: true as const,\n            data: {\n              id: workspaceId,\n              name: \"child\",\n              projectPath: \"/tmp/proj\",\n              runtimeConfig: { type: \"local\" },\n              parentWorkspaceId,\n            },\n          })\n        );\n      }\n\n      const aiService = new FakeAIService() as unknown as AIService;\n\n      const mockPartialService: Partial<PartialService> = {};\n      const mockInitStateManager: Partial<InitStateManager> = {\n        on: mock(() => undefined as unknown as InitStateManager),\n        getInitState: mock(() => undefined),\n        clearInMemoryState: mock(() => undefined),\n      };\n      const mockExtensionMetadataService: Partial<ExtensionMetadataService> = {\n        setStreaming: mock((_workspaceId: string, streaming: boolean) =>\n          Promise.resolve({\n            recency: Date.now(),\n            streaming,\n            lastModel: null,\n            lastThinkingLevel: null,\n          })\n        ),\n        updateRecency: mock((_workspaceId: string, timestamp?: number) =>\n          Promise.resolve({\n            recency: timestamp ?? Date.now(),\n            streaming: false,\n            lastModel: null,\n            lastThinkingLevel: null,\n          })\n        ),\n      };\n      const mockBackgroundProcessManager: Partial<BackgroundProcessManager> = {\n        cleanup: mock(() => Promise.resolve()),\n      };\n\n      const mockConfig: Partial<Config> = {\n        srcDir: \"/tmp/src\",\n        getSessionDir: mock((id: string) => path.join(sessionRoot, id)),\n        removeWorkspace: mock(() => Promise.resolve()),\n        findWorkspace: mock(() => null),\n      };\n\n      const timingService: Partial<SessionTimingService> = {\n        waitForIdle: mock(() => Promise.resolve()),\n        rollUpTimingIntoParent: mock(() => {\n          rollUpSawAbort = abortEmitted;\n          return Promise.resolve({ didRollUp: true });\n        }),\n      };\n\n      const workspaceService = new WorkspaceService(\n        mockConfig as Config,\n        historyService,\n        mockPartialService as PartialService,\n        aiService,\n        mockInitStateManager as InitStateManager,\n        mockExtensionMetadataService as ExtensionMetadataService,\n        mockBackgroundProcessManager as BackgroundProcessManager,\n        {} as SessionUsageService,\n        {} as CostTrackingService,\n        undefined, // policyService\n        undefined, // telemetryService\n        undefined, // experimentsService\n        timingService as SessionTimingService\n      );\n\n      const removeResult = await workspaceService.remove(workspaceId, true);\n      expect(removeResult.success).toBe(true);\n      expect(mockInitStateManager.clearInMemoryState).toHaveBeenCalledWith(workspaceId);\n      expect(rollUpSawAbort).toBe(true);\n    } finally {\n      await fsPromises.rm(tempRoot, { recursive: true, force: true });\n    }\n  });\n});\n\ndescribe(\"WorkspaceService archive lifecycle hooks\", () => {\n  const workspaceId = \"ws-archive\";\n  const projectPath = \"/tmp/project\";\n  const workspacePath = \"/tmp/project/ws-archive\";\n\n  let workspaceService: WorkspaceService;\n  let mockAIService: AIService;\n  let configState: ProjectsConfig;\n  let editConfigSpy: ReturnType<typeof mock>;\n  let historyService: HistoryService;\n  let cleanupHistory: () => Promise<void>;\n\n  const workspaceMetadata: WorkspaceMetadata = {\n    id: workspaceId,\n    name: \"ws-archive\",\n    projectName: \"proj\",\n    projectPath,\n    runtimeConfig: { type: \"local\", srcBaseDir: \"/tmp\" },\n  };\n\n  beforeEach(async () => {\n    configState = {\n      projects: new Map([\n        [\n          projectPath,\n          {\n            workspaces: [\n              {\n                path: workspacePath,\n                id: workspaceId,\n              },\n            ],\n          },\n        ],\n      ]),\n    };\n\n    editConfigSpy = mock((fn: (config: ProjectsConfig) => ProjectsConfig) => {\n      configState = fn(configState);\n      return Promise.resolve();\n    });\n\n    ({ historyService, cleanup: cleanupHistory } = await createTestHistoryService());\n\n    const mockConfig: Partial<Config> = {\n      srcDir: \"/tmp/src\",\n      getSessionDir: mock(() => \"/tmp/test/sessions\"),\n      generateStableId: mock(() => \"test-id\"),\n      findWorkspace: mock((id: string) => {\n        if (id !== workspaceId) {\n          return null;\n        }\n\n        return { projectPath, workspacePath };\n      }),\n      editConfig: editConfigSpy,\n      getAllWorkspaceMetadata: mock(() => Promise.resolve([])),\n    };\n\n    const mockPartialService: Partial<PartialService> = {};\n    const mockInitStateManager: Partial<InitStateManager> = {\n      on: mock(() => undefined as unknown as InitStateManager),\n      getInitState: mock(() => undefined),\n    };\n    const mockExtensionMetadataService: Partial<ExtensionMetadataService> = {};\n    const mockBackgroundProcessManager: Partial<BackgroundProcessManager> = {\n      cleanup: mock(() => Promise.resolve()),\n    };\n\n    mockAIService = {\n      isStreaming: mock(() => false),\n      getWorkspaceMetadata: mock(() => Promise.resolve(Ok(workspaceMetadata))),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      on: mock(() => { }),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      off: mock(() => { }),\n    } as unknown as AIService;\n\n    workspaceService = new WorkspaceService(\n      mockConfig as Config,\n      historyService,\n      mockPartialService as PartialService,\n      mockAIService,\n      mockInitStateManager as InitStateManager,\n      mockExtensionMetadataService as ExtensionMetadataService,\n      mockBackgroundProcessManager as BackgroundProcessManager,\n      {} as SessionUsageService,\n      {} as CostTrackingService\n    );\n  });\n\n  afterEach(async () => {\n    await cleanupHistory();\n  });\n\n  test(\"returns Err and does not persist archivedAt when beforeArchive hook fails\", async () => {\n    const hooks = new WorkspaceLifecycleHooks();\n    hooks.registerBeforeArchive(() => Promise.resolve(Err(\"hook failed\")));\n    workspaceService.setWorkspaceLifecycleHooks(hooks);\n\n    const result = await workspaceService.archive(workspaceId);\n\n    expect(result.success).toBe(false);\n    if (!result.success) {\n      expect(result.error).toBe(\"hook failed\");\n    }\n\n    expect(editConfigSpy).toHaveBeenCalledTimes(0);\n\n    const entry = configState.projects.get(projectPath)?.workspaces[0];\n    expect(entry?.archivedAt).toBeUndefined();\n  });\n\n  test(\"does not interrupt an active stream when beforeArchive hook fails\", async () => {\n    const hooks = new WorkspaceLifecycleHooks();\n    hooks.registerBeforeArchive(() => Promise.resolve(Err(\"hook failed\")));\n    workspaceService.setWorkspaceLifecycleHooks(hooks);\n\n    (mockAIService.isStreaming as ReturnType<typeof mock>).mockReturnValue(true);\n\n    const interruptStreamSpy = mock(() => Promise.resolve(Ok(undefined)));\n    workspaceService.interruptStream =\n      interruptStreamSpy as unknown as typeof workspaceService.interruptStream;\n\n    const result = await workspaceService.archive(workspaceId);\n\n    expect(result.success).toBe(false);\n    expect(interruptStreamSpy).toHaveBeenCalledTimes(0);\n  });\n\n  test(\"persists archivedAt when beforeArchive hooks succeed\", async () => {\n    const hooks = new WorkspaceLifecycleHooks();\n    hooks.registerBeforeArchive(() => Promise.resolve(Ok(undefined)));\n    workspaceService.setWorkspaceLifecycleHooks(hooks);\n\n    const result = await workspaceService.archive(workspaceId);\n\n    expect(result.success).toBe(true);\n    expect(editConfigSpy).toHaveBeenCalledTimes(1);\n\n    const entry = configState.projects.get(projectPath)?.workspaces[0];\n    expect(entry?.archivedAt).toBeTruthy();\n    expect(entry?.archivedAt).toMatch(/^\\d{4}-\\d{2}-\\d{2}T/);\n  });\n});\n\ndescribe(\"WorkspaceService archive init cancellation\", () => {\n  let historyService: HistoryService;\n  let cleanupHistory: () => Promise<void>;\n\n  beforeEach(async () => {\n    ({ historyService, cleanup: cleanupHistory } = await createTestHistoryService());\n  });\n\n  afterEach(async () => {\n    await cleanupHistory();\n  });\n\n  test(\"emits metadata when it cancels init but beforeArchive hook fails\", async () => {\n    const workspaceId = \"ws-archive-init-cancel\";\n    const projectPath = \"/tmp/project\";\n    const workspacePath = \"/tmp/project/ws-archive-init-cancel\";\n\n    const initStates = new Map<string, InitStatus>([\n      [\n        workspaceId,\n        {\n          status: \"running\",\n          hookPath: projectPath,\n          startTime: 0,\n          lines: [],\n          exitCode: null,\n          endTime: null,\n        },\n      ],\n    ]);\n\n    const clearInMemoryStateMock = mock((id: string) => {\n      initStates.delete(id);\n    });\n\n    const mockInitStateManager: Partial<InitStateManager> = {\n      on: mock(() => undefined as unknown as InitStateManager),\n      getInitState: mock((id: string) => initStates.get(id)),\n      clearInMemoryState: clearInMemoryStateMock,\n    };\n\n    let configState: ProjectsConfig = {\n      projects: new Map([\n        [\n          projectPath,\n          {\n            workspaces: [\n              {\n                path: workspacePath,\n                id: workspaceId,\n              },\n            ],\n          },\n        ],\n      ]),\n    };\n\n    const editConfigSpy = mock((fn: (config: ProjectsConfig) => ProjectsConfig) => {\n      configState = fn(configState);\n      return Promise.resolve();\n    });\n\n    const frontendMetadata: FrontendWorkspaceMetadata = {\n      id: workspaceId,\n      name: \"ws-archive-init-cancel\",\n      projectName: \"proj\",\n      projectPath,\n      runtimeConfig: { type: \"local\", srcBaseDir: \"/tmp\" },\n      namedWorkspacePath: workspacePath,\n    };\n\n    const workspaceMetadata: WorkspaceMetadata = {\n      id: workspaceId,\n      name: \"ws-archive-init-cancel\",\n      projectName: \"proj\",\n      projectPath,\n      runtimeConfig: { type: \"local\", srcBaseDir: \"/tmp\" },\n    };\n\n    const mockConfig: Partial<Config> = {\n      srcDir: \"/tmp/src\",\n      getSessionDir: mock(() => \"/tmp/test/sessions\"),\n      generateStableId: mock(() => \"test-id\"),\n      findWorkspace: mock((id: string) => {\n        if (id !== workspaceId) {\n          return null;\n        }\n\n        return { projectPath, workspacePath };\n      }),\n      editConfig: editConfigSpy,\n      getAllWorkspaceMetadata: mock(() => Promise.resolve([frontendMetadata])),\n    };\n\n    const mockAIService: AIService = {\n      isStreaming: mock(() => false),\n      getWorkspaceMetadata: mock(() => Promise.resolve(Ok(workspaceMetadata))),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      on: mock(() => { }),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      off: mock(() => { }),\n    } as unknown as AIService;\n\n    const workspaceService = new WorkspaceService(\n      mockConfig as Config,\n      historyService,\n      {} as PartialService,\n      mockAIService,\n      mockInitStateManager as InitStateManager,\n      {} as ExtensionMetadataService,\n      { cleanup: mock(() => Promise.resolve()) } as unknown as BackgroundProcessManager,\n      {} as SessionUsageService,\n      {} as CostTrackingService\n    );\n\n    // Seed abort controller so archive() can cancel init.\n    const abortController = new AbortController();\n    const initAbortControllers = (\n      workspaceService as unknown as { initAbortControllers: Map<string, AbortController> }\n    ).initAbortControllers;\n    initAbortControllers.set(workspaceId, abortController);\n\n    const metadataEvents: Array<FrontendWorkspaceMetadata | null> = [];\n    workspaceService.on(\"metadata\", (event: unknown) => {\n      if (!event || typeof event !== \"object\") {\n        return;\n      }\n      const parsed = event as { workspaceId: string; metadata: FrontendWorkspaceMetadata | null };\n      if (parsed.workspaceId === workspaceId) {\n        metadataEvents.push(parsed.metadata);\n      }\n    });\n\n    const hooks = new WorkspaceLifecycleHooks();\n    hooks.registerBeforeArchive(() => Promise.resolve(Err(\"hook failed\")));\n    workspaceService.setWorkspaceLifecycleHooks(hooks);\n\n    const result = await workspaceService.archive(workspaceId);\n\n    expect(result.success).toBe(false);\n    if (!result.success) {\n      expect(result.error).toBe(\"hook failed\");\n    }\n\n    // Ensure we didn't persist archivedAt on hook failure.\n    expect(editConfigSpy).toHaveBeenCalledTimes(0);\n    const entry = configState.projects.get(projectPath)?.workspaces[0];\n    expect(entry?.archivedAt).toBeUndefined();\n\n    expect(abortController.signal.aborted).toBe(true);\n    expect(clearInMemoryStateMock).toHaveBeenCalledWith(workspaceId);\n\n    expect(metadataEvents.length).toBeGreaterThanOrEqual(1);\n    expect(metadataEvents.at(-1)?.isInitializing).toBe(undefined);\n  });\n});\n\ndescribe(\"WorkspaceService unarchive lifecycle hooks\", () => {\n  const workspaceId = \"ws-unarchive\";\n  const projectPath = \"/tmp/project\";\n  const workspacePath = \"/tmp/project/ws-unarchive\";\n\n  let workspaceService: WorkspaceService;\n  let configState: ProjectsConfig;\n  let editConfigSpy: ReturnType<typeof mock>;\n  let historyService: HistoryService;\n  let cleanupHistory: () => Promise<void>;\n\n  const workspaceMetadata: FrontendWorkspaceMetadata = {\n    id: workspaceId,\n    name: \"ws-unarchive\",\n    projectName: \"proj\",\n    projectPath,\n    runtimeConfig: { type: \"local\", srcBaseDir: \"/tmp\" },\n    archivedAt: \"2020-01-01T00:00:00.000Z\",\n    namedWorkspacePath: workspacePath,\n  };\n\n  beforeEach(async () => {\n    ({ historyService, cleanup: cleanupHistory } = await createTestHistoryService());\n\n    configState = {\n      projects: new Map([\n        [\n          projectPath,\n          {\n            workspaces: [\n              {\n                path: workspacePath,\n                id: workspaceId,\n                archivedAt: \"2020-01-01T00:00:00.000Z\",\n              },\n            ],\n          },\n        ],\n      ]),\n    };\n\n    editConfigSpy = mock((fn: (config: ProjectsConfig) => ProjectsConfig) => {\n      configState = fn(configState);\n      return Promise.resolve();\n    });\n\n    const mockConfig: Partial<Config> = {\n      srcDir: \"/tmp/src\",\n      getSessionDir: mock(() => \"/tmp/test/sessions\"),\n      generateStableId: mock(() => \"test-id\"),\n      findWorkspace: mock((id: string) => {\n        if (id !== workspaceId) {\n          return null;\n        }\n\n        return { projectPath, workspacePath };\n      }),\n      editConfig: editConfigSpy,\n      getAllWorkspaceMetadata: mock(() => Promise.resolve([workspaceMetadata])),\n    };\n\n    const mockPartialService: Partial<PartialService> = {};\n    const mockInitStateManager: Partial<InitStateManager> = {\n      on: mock(() => undefined as unknown as InitStateManager),\n      getInitState: mock(() => undefined),\n    };\n    const mockExtensionMetadataService: Partial<ExtensionMetadataService> = {};\n    const mockBackgroundProcessManager: Partial<BackgroundProcessManager> = {\n      cleanup: mock(() => Promise.resolve()),\n    };\n\n    const aiService: AIService = {\n      isStreaming: mock(() => false),\n      getWorkspaceMetadata: mock(() => Promise.resolve(Ok(workspaceMetadata))),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      on: mock(() => { }),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      off: mock(() => { }),\n    } as unknown as AIService;\n\n    workspaceService = new WorkspaceService(\n      mockConfig as Config,\n      historyService,\n      mockPartialService as PartialService,\n      aiService,\n      mockInitStateManager as InitStateManager,\n      mockExtensionMetadataService as ExtensionMetadataService,\n      mockBackgroundProcessManager as BackgroundProcessManager,\n      {} as SessionUsageService,\n      {} as CostTrackingService\n    );\n  });\n\n  afterEach(async () => {\n    await cleanupHistory();\n  });\n\n  test(\"persists unarchivedAt and runs afterUnarchive hooks (best-effort)\", async () => {\n    const hooks = new WorkspaceLifecycleHooks();\n\n    const afterHook = mock(() => {\n      const entry = configState.projects.get(projectPath)?.workspaces[0];\n      expect(entry?.unarchivedAt).toBeTruthy();\n      return Promise.resolve(Err(\"hook failed\"));\n    });\n    hooks.registerAfterUnarchive(afterHook);\n\n    workspaceService.setWorkspaceLifecycleHooks(hooks);\n\n    const result = await workspaceService.unarchive(workspaceId);\n\n    expect(result.success).toBe(true);\n    expect(afterHook).toHaveBeenCalledTimes(1);\n\n    const entry = configState.projects.get(projectPath)?.workspaces[0];\n    expect(entry?.unarchivedAt).toBeTruthy();\n    expect(entry?.unarchivedAt).toMatch(/^\\d{4}-\\d{2}-\\d{2}T/);\n  });\n\n  test(\"does not run afterUnarchive hooks when workspace is not archived\", async () => {\n    const entry = configState.projects.get(projectPath)?.workspaces[0];\n    if (!entry) {\n      throw new Error(\"Missing workspace entry\");\n    }\n    entry.archivedAt = undefined;\n\n    const hooks = new WorkspaceLifecycleHooks();\n    const afterHook = mock(() => Promise.resolve(Ok(undefined)));\n    hooks.registerAfterUnarchive(afterHook);\n    workspaceService.setWorkspaceLifecycleHooks(hooks);\n\n    const result = await workspaceService.unarchive(workspaceId);\n\n    expect(result.success).toBe(true);\n    expect(afterHook).toHaveBeenCalledTimes(0);\n  });\n});\n\ndescribe(\"WorkspaceService archiveMergedInProject\", () => {\n  const TARGET_PROJECT_PATH = \"/tmp/project\";\n\n  let historyService: HistoryService;\n  let cleanupHistory: () => Promise<void>;\n\n  beforeEach(async () => {\n    ({ historyService, cleanup: cleanupHistory } = await createTestHistoryService());\n  });\n\n  afterEach(async () => {\n    await cleanupHistory();\n  });\n\n  function createMetadata(\n    id: string,\n    options?: { projectPath?: string; archivedAt?: string; unarchivedAt?: string }\n  ): FrontendWorkspaceMetadata {\n    const projectPath = options?.projectPath ?? TARGET_PROJECT_PATH;\n\n    return {\n      id,\n      name: id,\n      projectName: \"test-project\",\n      projectPath,\n      runtimeConfig: { type: \"local\" },\n      namedWorkspacePath: path.join(projectPath, id),\n      archivedAt: options?.archivedAt,\n      unarchivedAt: options?.unarchivedAt,\n    };\n  }\n\n  function bashOk(output: string): Result<BashToolResult> {\n    return {\n      success: true,\n      data: {\n        success: true,\n        output,\n        exitCode: 0,\n        wall_duration_ms: 0,\n      },\n    };\n  }\n\n  function bashToolFailure(error: string): Result<BashToolResult> {\n    return {\n      success: true,\n      data: {\n        success: false,\n        error,\n        exitCode: 1,\n        wall_duration_ms: 0,\n      },\n    };\n  }\n\n  function executeBashFailure(error: string): Result<BashToolResult> {\n    return { success: false, error };\n  }\n\n  type ExecuteBashFn = (\n    workspaceId: string,\n    script: string,\n    options?: { timeout_secs?: number }\n  ) => Promise<Result<BashToolResult>>;\n\n  type ArchiveFn = (workspaceId: string) => Promise<Result<void>>;\n\n  function createServiceHarness(\n    allMetadata: FrontendWorkspaceMetadata[],\n    executeBashImpl: ExecuteBashFn,\n    archiveImpl: ArchiveFn\n  ): {\n    workspaceService: WorkspaceService;\n    executeBashMock: ReturnType<typeof mock>;\n    archiveMock: ReturnType<typeof mock>;\n  } {\n    const mockConfig: Partial<Config> = {\n      srcDir: \"/tmp/test\",\n      getSessionDir: mock(() => \"/tmp/test/sessions\"),\n      generateStableId: mock(() => \"test-id\"),\n      findWorkspace: mock(() => null),\n      getAllWorkspaceMetadata: mock(() => Promise.resolve(allMetadata)),\n    };\n\n    const aiService: AIService = {\n      on(_eventName: string | symbol, _listener: (...args: unknown[]) => void) {\n        return this;\n      },\n      off(_eventName: string | symbol, _listener: (...args: unknown[]) => void) {\n        return this;\n      },\n    } as unknown as AIService;\n\n    const mockPartialService: Partial<PartialService> = {};\n    const mockInitStateManager: Partial<InitStateManager> = {\n      on: mock(() => undefined as unknown as InitStateManager),\n      getInitState: mock(() => undefined),\n    };\n    const mockExtensionMetadataService: Partial<ExtensionMetadataService> = {};\n    const mockBackgroundProcessManager: Partial<BackgroundProcessManager> = {\n      cleanup: mock(() => Promise.resolve()),\n    };\n\n    const workspaceService = new WorkspaceService(\n      mockConfig as Config,\n      historyService,\n      mockPartialService as PartialService,\n      aiService,\n      mockInitStateManager as InitStateManager,\n      mockExtensionMetadataService as ExtensionMetadataService,\n      mockBackgroundProcessManager as BackgroundProcessManager,\n      {} as SessionUsageService,\n      {} as CostTrackingService\n    );\n\n    const executeBashMock = mock(executeBashImpl);\n    const archiveMock = mock(archiveImpl);\n\n    interface WorkspaceServiceTestAccess {\n      executeBash: typeof executeBashMock;\n      archive: typeof archiveMock;\n    }\n\n    const svc = workspaceService as unknown as WorkspaceServiceTestAccess;\n    svc.executeBash = executeBashMock;\n    svc.archive = archiveMock;\n\n    return { workspaceService, executeBashMock, archiveMock };\n  }\n\n  test(\"excludes MUX_HELP_CHAT_WORKSPACE_ID workspaces\", async () => {\n    const allMetadata: FrontendWorkspaceMetadata[] = [\n      createMetadata(MUX_HELP_CHAT_WORKSPACE_ID),\n      createMetadata(\"ws-merged\"),\n    ];\n\n    const ghResultsByWorkspaceId: Record<string, Result<BashToolResult>> = {\n      \"ws-merged\": bashOk('{\"state\":\"MERGED\"}'),\n    };\n\n    const { workspaceService, executeBashMock, archiveMock } = createServiceHarness(\n      allMetadata,\n      (workspaceId) => {\n        const result = ghResultsByWorkspaceId[workspaceId];\n        if (!result) {\n          throw new Error(`Unexpected executeBash call for workspaceId: ${workspaceId}`);\n        }\n        return Promise.resolve(result);\n      },\n      () => Promise.resolve({ success: true, data: undefined })\n    );\n\n    const result = await workspaceService.archiveMergedInProject(TARGET_PROJECT_PATH);\n\n    expect(result.success).toBe(true);\n    if (!result.success) {\n      return;\n    }\n\n    expect(result.data.archivedWorkspaceIds).toEqual([\"ws-merged\"]);\n    expect(result.data.skippedWorkspaceIds).toEqual([]);\n    expect(result.data.errors).toEqual([]);\n\n    expect(archiveMock).toHaveBeenCalledTimes(1);\n    expect(archiveMock).toHaveBeenCalledWith(\"ws-merged\");\n\n    // Should only query GitHub for the eligible non-mux-chat workspace.\n    expect(executeBashMock).toHaveBeenCalledTimes(1);\n  });\n\n  test(\"treats workspaces with later unarchivedAt as eligible\", async () => {\n    const allMetadata: FrontendWorkspaceMetadata[] = [\n      createMetadata(\"ws-merged-unarchived\", {\n        archivedAt: \"2025-01-01T00:00:00.000Z\",\n        unarchivedAt: \"2025-02-01T00:00:00.000Z\",\n      }),\n      createMetadata(\"ws-still-archived\", {\n        archivedAt: \"2025-03-01T00:00:00.000Z\",\n        unarchivedAt: \"2025-02-01T00:00:00.000Z\",\n      }),\n    ];\n\n    const ghResultsByWorkspaceId: Record<string, Result<BashToolResult>> = {\n      \"ws-merged-unarchived\": bashOk('{\"state\":\"MERGED\"}'),\n    };\n\n    const { workspaceService, executeBashMock, archiveMock } = createServiceHarness(\n      allMetadata,\n      (workspaceId) => {\n        const result = ghResultsByWorkspaceId[workspaceId];\n        if (!result) {\n          throw new Error(`Unexpected executeBash call for workspaceId: ${workspaceId}`);\n        }\n        return Promise.resolve(result);\n      },\n      () => Promise.resolve({ success: true, data: undefined })\n    );\n\n    const result = await workspaceService.archiveMergedInProject(TARGET_PROJECT_PATH);\n\n    expect(result.success).toBe(true);\n    if (!result.success) {\n      return;\n    }\n\n    expect(result.data.archivedWorkspaceIds).toEqual([\"ws-merged-unarchived\"]);\n    expect(result.data.skippedWorkspaceIds).toEqual([]);\n    expect(result.data.errors).toEqual([]);\n\n    expect(archiveMock).toHaveBeenCalledTimes(1);\n    expect(archiveMock).toHaveBeenCalledWith(\"ws-merged-unarchived\");\n\n    // Should only query GitHub for the workspace that is considered unarchived.\n    expect(executeBashMock).toHaveBeenCalledTimes(1);\n  });\n  test(\"archives only MERGED workspaces\", async () => {\n    const allMetadata: FrontendWorkspaceMetadata[] = [\n      createMetadata(\"ws-open\"),\n      createMetadata(\"ws-merged\"),\n      createMetadata(\"ws-no-pr\"),\n      createMetadata(\"ws-other-project\", { projectPath: \"/tmp/other\" }),\n      createMetadata(\"ws-already-archived\", { archivedAt: \"2025-01-01T00:00:00.000Z\" }),\n    ];\n\n    const ghResultsByWorkspaceId: Record<string, Result<BashToolResult>> = {\n      \"ws-open\": bashOk('{\"state\":\"OPEN\"}'),\n      \"ws-merged\": bashOk('{\"state\":\"MERGED\"}'),\n      \"ws-no-pr\": bashOk('{\"no_pr\":true}'),\n    };\n\n    const { workspaceService, executeBashMock, archiveMock } = createServiceHarness(\n      allMetadata,\n      (workspaceId, script, options) => {\n        expect(script).toContain(\"gh pr view --json state\");\n        expect(options?.timeout_secs).toBe(15);\n\n        const result = ghResultsByWorkspaceId[workspaceId];\n        if (!result) {\n          throw new Error(`Unexpected executeBash call for workspaceId: ${workspaceId}`);\n        }\n        return Promise.resolve(result);\n      },\n      () => Promise.resolve({ success: true, data: undefined })\n    );\n\n    const result = await workspaceService.archiveMergedInProject(TARGET_PROJECT_PATH);\n\n    expect(result.success).toBe(true);\n    if (!result.success) {\n      return;\n    }\n\n    expect(result.data.archivedWorkspaceIds).toEqual([\"ws-merged\"]);\n    expect(result.data.skippedWorkspaceIds).toEqual([\"ws-no-pr\", \"ws-open\"]);\n    expect(result.data.errors).toEqual([]);\n\n    expect(archiveMock).toHaveBeenCalledTimes(1);\n    expect(archiveMock).toHaveBeenCalledWith(\"ws-merged\");\n\n    expect(executeBashMock).toHaveBeenCalledTimes(3);\n  });\n\n  test(\"skips no_pr and non-merged states\", async () => {\n    const allMetadata: FrontendWorkspaceMetadata[] = [\n      createMetadata(\"ws-open\"),\n      createMetadata(\"ws-closed\"),\n      createMetadata(\"ws-no-pr\"),\n    ];\n\n    const ghResultsByWorkspaceId: Record<string, Result<BashToolResult>> = {\n      \"ws-open\": bashOk('{\"state\":\"OPEN\"}'),\n      \"ws-closed\": bashOk('{\"state\":\"CLOSED\"}'),\n      \"ws-no-pr\": bashOk('{\"no_pr\":true}'),\n    };\n\n    const { workspaceService, archiveMock } = createServiceHarness(\n      allMetadata,\n      (workspaceId) => {\n        const result = ghResultsByWorkspaceId[workspaceId];\n        if (!result) {\n          throw new Error(`Unexpected executeBash call for workspaceId: ${workspaceId}`);\n        }\n        return Promise.resolve(result);\n      },\n      () => Promise.resolve({ success: true, data: undefined })\n    );\n\n    const result = await workspaceService.archiveMergedInProject(TARGET_PROJECT_PATH);\n\n    expect(result.success).toBe(true);\n    if (!result.success) {\n      return;\n    }\n\n    expect(result.data.archivedWorkspaceIds).toEqual([]);\n    expect(result.data.skippedWorkspaceIds).toEqual([\"ws-closed\", \"ws-no-pr\", \"ws-open\"]);\n    expect(result.data.errors).toEqual([]);\n\n    expect(archiveMock).toHaveBeenCalledTimes(0);\n  });\n\n  test(\"records errors for malformed JSON and executeBash failures\", async () => {\n    const allMetadata: FrontendWorkspaceMetadata[] = [\n      createMetadata(\"ws-bad-json\"),\n      createMetadata(\"ws-exec-failed\"),\n      createMetadata(\"ws-bash-failed\"),\n    ];\n\n    const ghResultsByWorkspaceId: Record<string, Result<BashToolResult>> = {\n      \"ws-bad-json\": bashOk(\"not-json\"),\n      \"ws-exec-failed\": executeBashFailure(\"executeBash failed\"),\n      \"ws-bash-failed\": bashToolFailure(\"gh failed\"),\n    };\n\n    const { workspaceService, archiveMock } = createServiceHarness(\n      allMetadata,\n      (workspaceId) => {\n        const result = ghResultsByWorkspaceId[workspaceId];\n        if (!result) {\n          throw new Error(`Unexpected executeBash call for workspaceId: ${workspaceId}`);\n        }\n        return Promise.resolve(result);\n      },\n      () => Promise.resolve({ success: true, data: undefined })\n    );\n\n    const result = await workspaceService.archiveMergedInProject(TARGET_PROJECT_PATH);\n\n    expect(result.success).toBe(true);\n    if (!result.success) {\n      return;\n    }\n\n    expect(result.data.archivedWorkspaceIds).toEqual([]);\n    expect(result.data.skippedWorkspaceIds).toEqual([]);\n    expect(result.data.errors).toHaveLength(3);\n\n    const badJsonError = result.data.errors.find((e) => e.workspaceId === \"ws-bad-json\");\n    expect(badJsonError).toBeDefined();\n    expect(badJsonError?.error).toContain(\"Failed to parse gh output\");\n\n    const execFailedError = result.data.errors.find((e) => e.workspaceId === \"ws-exec-failed\");\n    expect(execFailedError).toBeDefined();\n    expect(execFailedError?.error).toBe(\"executeBash failed\");\n\n    const bashFailedError = result.data.errors.find((e) => e.workspaceId === \"ws-bash-failed\");\n    expect(bashFailedError).toBeDefined();\n    expect(bashFailedError?.error).toBe(\"gh failed\");\n\n    expect(archiveMock).toHaveBeenCalledTimes(0);\n  });\n});\n\ndescribe(\"WorkspaceService init cancellation\", () => {\n  let historyService: HistoryService;\n  let cleanupHistory: () => Promise<void>;\n\n  beforeEach(async () => {\n    ({ historyService, cleanup: cleanupHistory } = await createTestHistoryService());\n  });\n\n  afterEach(async () => {\n    await cleanupHistory();\n  });\n\n  test(\"archive() aborts init and still archives when init is running\", async () => {\n    const workspaceId = \"ws-init-running\";\n\n    const removeMock = mock(() => Promise.resolve({ success: true as const, data: undefined }));\n    const editConfigMock = mock(() => Promise.resolve());\n    const clearInMemoryStateMock = mock((_workspaceId: string) => undefined);\n\n    const mockAIService = {\n      isStreaming: mock(() => false),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      on: mock(() => { }),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      off: mock(() => { }),\n    } as unknown as AIService;\n\n    const mockConfig: Partial<Config> = {\n      srcDir: \"/tmp/test\",\n      findWorkspace: mock(() => ({ projectPath: \"/tmp/proj\", workspacePath: \"/tmp/proj/ws\" })),\n      editConfig: editConfigMock,\n      getAllWorkspaceMetadata: mock(() => Promise.resolve([])),\n      getSessionDir: mock(() => \"/tmp/test/sessions\"),\n      generateStableId: mock(() => \"test-id\"),\n    };\n\n    const mockInitStateManager: Partial<InitStateManager> = {\n      // WorkspaceService subscribes to init-end events on construction.\n      on: mock(() => undefined as unknown as InitStateManager),\n      getInitState: mock(\n        (): InitStatus => ({\n          status: \"running\",\n          hookPath: \"/tmp/proj\",\n          startTime: 0,\n          lines: [],\n          exitCode: null,\n          endTime: null,\n        })\n      ),\n      clearInMemoryState: clearInMemoryStateMock,\n    };\n\n    const mockPartialService: Partial<PartialService> = {};\n    const mockExtensionMetadataService: Partial<ExtensionMetadataService> = {};\n    const mockBackgroundProcessManager: Partial<BackgroundProcessManager> = {\n      cleanup: mock(() => Promise.resolve()),\n    };\n\n    const workspaceService = new WorkspaceService(\n      mockConfig as Config,\n      historyService,\n      mockPartialService as PartialService,\n      mockAIService,\n      mockInitStateManager as InitStateManager,\n      mockExtensionMetadataService as ExtensionMetadataService,\n      mockBackgroundProcessManager as BackgroundProcessManager,\n      {} as SessionUsageService,\n      {} as CostTrackingService\n    );\n\n    // Make it obvious if archive() incorrectly chooses deletion.\n    workspaceService.remove = removeMock as unknown as typeof workspaceService.remove;\n\n    const result = await workspaceService.archive(workspaceId);\n    expect(result.success).toBe(true);\n    expect(editConfigMock).toHaveBeenCalled();\n    expect(removeMock).not.toHaveBeenCalled();\n    expect(clearInMemoryStateMock).toHaveBeenCalledWith(workspaceId);\n  });\n\n  test(\"archive() uses normal archive flow when init is complete\", async () => {\n    const workspaceId = \"ws-init-complete\";\n\n    const removeMock = mock(() => Promise.resolve({ success: true as const, data: undefined }));\n    const editConfigMock = mock(() => Promise.resolve());\n\n    const mockAIService = {\n      isStreaming: mock(() => false),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      on: mock(() => { }),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      off: mock(() => { }),\n    } as unknown as AIService;\n\n    const mockConfig: Partial<Config> = {\n      srcDir: \"/tmp/test\",\n      findWorkspace: mock(() => ({ projectPath: \"/tmp/proj\", workspacePath: \"/tmp/proj/ws\" })),\n      editConfig: editConfigMock,\n      getAllWorkspaceMetadata: mock(() => Promise.resolve([])),\n      getSessionDir: mock(() => \"/tmp/test/sessions\"),\n      generateStableId: mock(() => \"test-id\"),\n    };\n\n    const mockInitStateManager: Partial<InitStateManager> = {\n      // WorkspaceService subscribes to init-end events on construction.\n      on: mock(() => undefined as unknown as InitStateManager),\n      getInitState: mock(\n        (): InitStatus => ({\n          status: \"success\",\n          hookPath: \"/tmp/proj\",\n          startTime: 0,\n          lines: [],\n          exitCode: 0,\n          endTime: 1,\n        })\n      ),\n      clearInMemoryState: mock((_workspaceId: string) => undefined),\n    };\n\n    const mockPartialService: Partial<PartialService> = {};\n    const mockExtensionMetadataService: Partial<ExtensionMetadataService> = {};\n    const mockBackgroundProcessManager: Partial<BackgroundProcessManager> = {\n      cleanup: mock(() => Promise.resolve()),\n    };\n\n    const workspaceService = new WorkspaceService(\n      mockConfig as Config,\n      historyService,\n      mockPartialService as PartialService,\n      mockAIService,\n      mockInitStateManager as InitStateManager,\n      mockExtensionMetadataService as ExtensionMetadataService,\n      mockBackgroundProcessManager as BackgroundProcessManager,\n      {} as SessionUsageService,\n      {} as CostTrackingService\n    );\n\n    // Make it obvious if archive() incorrectly chooses deletion.\n    workspaceService.remove = removeMock as unknown as typeof workspaceService.remove;\n\n    const result = await workspaceService.archive(workspaceId);\n    expect(result.success).toBe(true);\n    expect(editConfigMock).toHaveBeenCalled();\n    expect(removeMock).not.toHaveBeenCalled();\n  });\n\n  test(\"list() includes isInitializing when init state is running\", async () => {\n    const workspaceId = \"ws-list-initializing\";\n\n    const mockAIService = {\n      isStreaming: mock(() => false),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      on: mock(() => { }),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      off: mock(() => { }),\n    } as unknown as AIService;\n\n    const mockMetadata: FrontendWorkspaceMetadata = {\n      id: workspaceId,\n      name: \"ws\",\n      projectName: \"proj\",\n      projectPath: \"/tmp/proj\",\n      createdAt: \"2026-01-01T00:00:00.000Z\",\n      namedWorkspacePath: \"/tmp/proj/ws\",\n      runtimeConfig: { type: \"local\" },\n    };\n\n    const mockConfig: Partial<Config> = {\n      srcDir: \"/tmp/test\",\n      getAllWorkspaceMetadata: mock(() => Promise.resolve([mockMetadata])),\n      getSessionDir: mock(() => \"/tmp/test/sessions\"),\n      generateStableId: mock(() => \"test-id\"),\n      findWorkspace: mock(() => null),\n    };\n\n    const mockInitStateManager: Partial<InitStateManager> = {\n      // WorkspaceService subscribes to init-end events on construction.\n      on: mock(() => undefined as unknown as InitStateManager),\n      getInitState: mock((id: string): InitStatus | undefined =>\n        id === workspaceId\n          ? {\n            status: \"running\",\n            hookPath: \"/tmp/proj\",\n            startTime: 0,\n            lines: [],\n            exitCode: null,\n            endTime: null,\n          }\n          : undefined\n      ),\n    };\n\n    const mockPartialService: Partial<PartialService> = {};\n    const mockExtensionMetadataService: Partial<ExtensionMetadataService> = {};\n    const mockBackgroundProcessManager: Partial<BackgroundProcessManager> = {\n      cleanup: mock(() => Promise.resolve()),\n    };\n\n    const workspaceService = new WorkspaceService(\n      mockConfig as Config,\n      historyService,\n      mockPartialService as PartialService,\n      mockAIService,\n      mockInitStateManager as InitStateManager,\n      mockExtensionMetadataService as ExtensionMetadataService,\n      mockBackgroundProcessManager as BackgroundProcessManager,\n      {} as SessionUsageService,\n      {} as CostTrackingService\n    );\n\n    const list = await workspaceService.list();\n    expect(list).toHaveLength(1);\n    expect(list[0]?.isInitializing).toBe(true);\n  });\n\n  test(\"create() clears init state + emits updated metadata when skipping background init\", async () => {\n    const workspaceId = \"ws-skip-init\";\n    const projectPath = \"/tmp/proj\";\n    const branchName = \"ws_branch\";\n    const workspacePath = \"/tmp/proj/ws_branch\";\n\n    const initStates = new Map<string, InitStatus>();\n    const clearInMemoryStateMock = mock((id: string) => {\n      initStates.delete(id);\n    });\n\n    const mockInitStateManager: Partial<InitStateManager> = {\n      on: mock(() => undefined as unknown as InitStateManager),\n      startInit: mock((id: string) => {\n        initStates.set(id, {\n          status: \"running\",\n          hookPath: projectPath,\n          startTime: 0,\n          lines: [],\n          exitCode: null,\n          endTime: null,\n        });\n      }),\n      getInitState: mock((id: string) => initStates.get(id)),\n      clearInMemoryState: clearInMemoryStateMock,\n    };\n\n    const configState: ProjectsConfig = { projects: new Map() };\n\n    const mockMetadata: FrontendWorkspaceMetadata = {\n      id: workspaceId,\n      name: branchName,\n      title: \"title\",\n      projectName: \"proj\",\n      projectPath,\n      createdAt: \"2026-01-01T00:00:00.000Z\",\n      namedWorkspacePath: workspacePath,\n      runtimeConfig: { type: \"local\" },\n    };\n\n    const mockConfig: Partial<Config> = {\n      rootDir: \"/tmp/mux-root\",\n      srcDir: \"/tmp/src\",\n      generateStableId: mock(() => workspaceId),\n      editConfig: mock((editFn: (config: ProjectsConfig) => ProjectsConfig) => {\n        editFn(configState);\n        return Promise.resolve();\n      }),\n      getAllWorkspaceMetadata: mock(() => Promise.resolve([mockMetadata])),\n      getEffectiveSecrets: mock(() => []),\n      getSessionDir: mock(() => \"/tmp/test/sessions\"),\n      findWorkspace: mock(() => null),\n    };\n\n    const mockAIService = {\n      isStreaming: mock(() => false),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      on: mock(() => { }),\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      off: mock(() => { }),\n    } as unknown as AIService;\n\n    const mockPartialService: Partial<PartialService> = {};\n    const mockExtensionMetadataService: Partial<ExtensionMetadataService> = {};\n    const mockBackgroundProcessManager: Partial<BackgroundProcessManager> = {\n      cleanup: mock(() => Promise.resolve()),\n    };\n\n    const createWorkspaceMock = mock(() =>\n      Promise.resolve({ success: true as const, workspacePath })\n    );\n\n    const createRuntimeSpy = spyOn(runtimeFactory, \"createRuntime\").mockReturnValue({\n      createWorkspace: createWorkspaceMock,\n    } as unknown as ReturnType<typeof runtimeFactory.createRuntime>);\n\n    const sessionEmitter = new EventEmitter();\n    const fakeSession = {\n      onChatEvent: (listener: (event: unknown) => void) => {\n        sessionEmitter.on(\"chat-event\", listener);\n        return () => sessionEmitter.off(\"chat-event\", listener);\n      },\n      onMetadataEvent: (listener: (event: unknown) => void) => {\n        sessionEmitter.on(\"metadata-event\", listener);\n        return () => sessionEmitter.off(\"metadata-event\", listener);\n      },\n      emitMetadata: (metadata: FrontendWorkspaceMetadata | null) => {\n        sessionEmitter.emit(\"metadata-event\", { workspaceId, metadata });\n      },\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      dispose: () => { },\n    } as unknown as AgentSession;\n\n    try {\n      const workspaceService = new WorkspaceService(\n        mockConfig as Config,\n        historyService,\n        mockPartialService as PartialService,\n        mockAIService,\n        mockInitStateManager as InitStateManager,\n        mockExtensionMetadataService as ExtensionMetadataService,\n        mockBackgroundProcessManager as BackgroundProcessManager,\n        {} as SessionUsageService,\n        {} as CostTrackingService\n      );\n\n      const metadataEvents: Array<FrontendWorkspaceMetadata | null> = [];\n      workspaceService.on(\"metadata\", (event: unknown) => {\n        if (!event || typeof event !== \"object\") {\n          return;\n        }\n        const parsed = event as { workspaceId: string; metadata: FrontendWorkspaceMetadata | null };\n        if (parsed.workspaceId === workspaceId) {\n          metadataEvents.push(parsed.metadata);\n        }\n      });\n\n      workspaceService.registerSession(workspaceId, fakeSession);\n\n      const removingWorkspaces = (\n        workspaceService as unknown as { removingWorkspaces: Set<string> }\n      ).removingWorkspaces;\n      removingWorkspaces.add(workspaceId);\n\n      const result = await workspaceService.create(projectPath, branchName, undefined, \"title\", {\n        type: \"local\",\n      });\n\n      expect(result.success).toBe(true);\n      if (!result.success) {\n        return;\n      }\n\n      expect(result.data.metadata.isInitializing).toBe(undefined);\n      expect(clearInMemoryStateMock).toHaveBeenCalledWith(workspaceId);\n\n      expect(metadataEvents).toHaveLength(2);\n      expect(metadataEvents[0]?.isInitializing).toBe(true);\n      expect(metadataEvents[1]?.isInitializing).toBe(undefined);\n    } finally {\n      createRuntimeSpy.mockRestore();\n    }\n  });\n  test(\"remove() aborts init and clears state before teardown\", async () => {\n    const workspaceId = \"ws-remove-aborts\";\n\n    const tempRoot = await fsPromises.mkdtemp(path.join(tmpdir(), \"mux-ws-remove-\"));\n    try {\n      const abortController = new AbortController();\n      const clearInMemoryStateMock = mock((_workspaceId: string) => undefined);\n\n      const mockAIService = {\n        isStreaming: mock(() => false),\n        stopStream: mock(() => Promise.resolve({ success: true as const, data: undefined })),\n        getWorkspaceMetadata: mock(() => Promise.resolve({ success: false as const, error: \"na\" })),\n        // eslint-disable-next-line @typescript-eslint/no-empty-function\n        on: mock(() => { }),\n        // eslint-disable-next-line @typescript-eslint/no-empty-function\n        off: mock(() => { }),\n      } as unknown as AIService;\n\n      const mockConfig: Partial<Config> = {\n        srcDir: \"/tmp/src\",\n        getSessionDir: mock((id: string) => path.join(tempRoot, id)),\n        removeWorkspace: mock(() => Promise.resolve()),\n        findWorkspace: mock(() => null),\n      };\n\n      const mockPartialService: Partial<PartialService> = {};\n      const mockInitStateManager: Partial<InitStateManager> = {\n        on: mock(() => undefined as unknown as InitStateManager),\n        getInitState: mock(() => undefined),\n        clearInMemoryState: clearInMemoryStateMock,\n      };\n      const mockExtensionMetadataService: Partial<ExtensionMetadataService> = {};\n      const mockBackgroundProcessManager: Partial<BackgroundProcessManager> = {\n        cleanup: mock(() => Promise.resolve()),\n      };\n\n      const workspaceService = new WorkspaceService(\n        mockConfig as Config,\n        historyService,\n        mockPartialService as PartialService,\n        mockAIService,\n        mockInitStateManager as InitStateManager,\n        mockExtensionMetadataService as ExtensionMetadataService,\n        mockBackgroundProcessManager as BackgroundProcessManager,\n        {} as SessionUsageService,\n        {} as CostTrackingService\n      );\n\n      // Inject an in-progress init AbortController.\n      const initAbortControllers = (\n        workspaceService as unknown as { initAbortControllers: Map<string, AbortController> }\n      ).initAbortControllers;\n      initAbortControllers.set(workspaceId, abortController);\n\n      const result = await workspaceService.remove(workspaceId, true);\n      expect(result.success).toBe(true);\n      expect(abortController.signal.aborted).toBe(true);\n      expect(clearInMemoryStateMock).toHaveBeenCalledWith(workspaceId);\n\n      expect(initAbortControllers.has(workspaceId)).toBe(false);\n    } finally {\n      await fsPromises.rm(tempRoot, { recursive: true, force: true });\n    }\n  });\n\n  test(\"remove() does not clear init state when runtime deletion fails with force=false\", async () => {\n    const workspaceId = \"ws-remove-runtime-delete-fails\";\n    const projectPath = \"/tmp/proj\";\n\n    const abortController = new AbortController();\n    const clearInMemoryStateMock = mock((_workspaceId: string) => undefined);\n    const removeWorkspaceMock = mock(() => Promise.resolve());\n\n    const deleteWorkspaceMock = mock(() =>\n      Promise.resolve({ success: false as const, error: \"dirty\" })\n    );\n\n    const createRuntimeSpy = spyOn(runtimeFactory, \"createRuntime\").mockReturnValue({\n      deleteWorkspace: deleteWorkspaceMock,\n    } as unknown as ReturnType<typeof runtimeFactory.createRuntime>);\n\n    const tempRoot = await fsPromises.mkdtemp(path.join(tmpdir(), \"mux-ws-remove-fail-\"));\n    try {\n      const mockAIService = {\n        isStreaming: mock(() => false),\n        stopStream: mock(() => Promise.resolve({ success: true as const, data: undefined })),\n        getWorkspaceMetadata: mock(() =>\n          Promise.resolve(\n            Ok({\n              id: workspaceId,\n              name: \"ws\",\n              projectPath,\n              projectName: \"proj\",\n              runtimeConfig: { type: \"local\" },\n            })\n          )\n        ),\n        // eslint-disable-next-line @typescript-eslint/no-empty-function\n        on: mock(() => { }),\n        // eslint-disable-next-line @typescript-eslint/no-empty-function\n        off: mock(() => { }),\n      } as unknown as AIService;\n\n      const mockConfig: Partial<Config> = {\n        srcDir: \"/tmp/src\",\n        getSessionDir: mock((id: string) => path.join(tempRoot, id)),\n        removeWorkspace: removeWorkspaceMock,\n        findWorkspace: mock(() => null),\n      };\n\n      const mockPartialService: Partial<PartialService> = {};\n      const mockInitStateManager: Partial<InitStateManager> = {\n        on: mock(() => undefined as unknown as InitStateManager),\n        getInitState: mock(() => undefined),\n        clearInMemoryState: clearInMemoryStateMock,\n      };\n      const mockExtensionMetadataService: Partial<ExtensionMetadataService> = {};\n      const mockBackgroundProcessManager: Partial<BackgroundProcessManager> = {\n        cleanup: mock(() => Promise.resolve()),\n      };\n\n      const workspaceService = new WorkspaceService(\n        mockConfig as Config,\n        historyService,\n        mockPartialService as PartialService,\n        mockAIService,\n        mockInitStateManager as InitStateManager,\n        mockExtensionMetadataService as ExtensionMetadataService,\n        mockBackgroundProcessManager as BackgroundProcessManager,\n        {} as SessionUsageService,\n        {} as CostTrackingService\n      );\n\n      // Inject an in-progress init AbortController.\n      const initAbortControllers = (\n        workspaceService as unknown as { initAbortControllers: Map<string, AbortController> }\n      ).initAbortControllers;\n      initAbortControllers.set(workspaceId, abortController);\n\n      const result = await workspaceService.remove(workspaceId, false);\n      expect(result.success).toBe(false);\n      expect(abortController.signal.aborted).toBe(true);\n\n      // If runtime deletion fails with force=false, removal returns early and the workspace remains.\n      // Keep init state intact so init-end can refresh metadata and clear isInitializing.\n      expect(clearInMemoryStateMock).not.toHaveBeenCalled();\n      expect(removeWorkspaceMock).not.toHaveBeenCalled();\n    } finally {\n      createRuntimeSpy.mockRestore();\n      await fsPromises.rm(tempRoot, { recursive: true, force: true });\n    }\n  });\n  test(\"remove() calls runtime.deleteWorkspace when force=true\", async () => {\n    const workspaceId = \"ws-remove-runtime-delete\";\n    const projectPath = \"/tmp/proj\";\n\n    const deleteWorkspaceMock = mock(() =>\n      Promise.resolve({ success: true as const, deletedPath: \"/tmp/deleted\" })\n    );\n\n    const createRuntimeSpy = spyOn(runtimeFactory, \"createRuntime\").mockReturnValue({\n      deleteWorkspace: deleteWorkspaceMock,\n    } as unknown as ReturnType<typeof runtimeFactory.createRuntime>);\n\n    const tempRoot = await fsPromises.mkdtemp(path.join(tmpdir(), \"mux-ws-remove-runtime-\"));\n    try {\n      const mockAIService = {\n        isStreaming: mock(() => false),\n        stopStream: mock(() => Promise.resolve({ success: true as const, data: undefined })),\n        getWorkspaceMetadata: mock(() =>\n          Promise.resolve(\n            Ok({\n              id: workspaceId,\n              name: \"ws\",\n              projectPath,\n              projectName: \"proj\",\n              runtimeConfig: { type: \"local\" },\n            })\n          )\n        ),\n        // eslint-disable-next-line @typescript-eslint/no-empty-function\n        on: mock(() => { }),\n        // eslint-disable-next-line @typescript-eslint/no-empty-function\n        off: mock(() => { }),\n      } as unknown as AIService;\n\n      const mockConfig: Partial<Config> = {\n        srcDir: \"/tmp/src\",\n        getSessionDir: mock((id: string) => path.join(tempRoot, id)),\n        removeWorkspace: mock(() => Promise.resolve()),\n        findWorkspace: mock(() => ({ projectPath, workspacePath: \"/tmp/proj/ws\" })),\n      };\n\n      const mockPartialService: Partial<PartialService> = {};\n      const mockInitStateManager: Partial<InitStateManager> = {\n        on: mock(() => undefined as unknown as InitStateManager),\n        getInitState: mock(() => undefined),\n        clearInMemoryState: mock((_workspaceId: string) => undefined),\n      };\n      const mockExtensionMetadataService: Partial<ExtensionMetadataService> = {};\n      const mockBackgroundProcessManager: Partial<BackgroundProcessManager> = {\n        cleanup: mock(() => Promise.resolve()),\n      };\n\n      const workspaceService = new WorkspaceService(\n        mockConfig as Config,\n        historyService,\n        mockPartialService as PartialService,\n        mockAIService,\n        mockInitStateManager as InitStateManager,\n        mockExtensionMetadataService as ExtensionMetadataService,\n        mockBackgroundProcessManager as BackgroundProcessManager,\n        {} as SessionUsageService,\n        {} as CostTrackingService\n      );\n\n      const result = await workspaceService.remove(workspaceId, true);\n      expect(result.success).toBe(true);\n      expect(deleteWorkspaceMock).toHaveBeenCalledWith(projectPath, \"ws\", true);\n    } finally {\n      createRuntimeSpy.mockRestore();\n      await fsPromises.rm(tempRoot, { recursive: true, force: true });\n    }\n  });\n});\n"]}