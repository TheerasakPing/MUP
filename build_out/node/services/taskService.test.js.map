{"version":3,"file":"taskService.test.js","sourceRoot":"","sources":["../../../src/node/services/taskService.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, test, expect, beforeEach, afterEach, mock, spyOn } from \"bun:test\";\r\nimport * as fsPromises from \"fs/promises\";\r\nimport * as path from \"path\";\r\nimport * as os from \"os\";\r\nimport { execSync } from \"node:child_process\";\r\n\r\nimport { Config } from \"@/node/config\";\r\nimport { HistoryService } from \"@/node/services/historyService\";\r\nimport { PartialService } from \"@/node/services/partialService\";\r\nimport {\r\n  getSubagentGitPatchMboxPath,\r\n  readSubagentGitPatchArtifact,\r\n} from \"@/node/services/subagentGitPatchArtifacts\";\r\nimport { upsertSubagentReportArtifact } from \"@/node/services/subagentReportArtifacts\";\r\nimport { TaskService } from \"@/node/services/taskService\";\r\nimport type { WorkspaceForkParams } from \"@/node/runtime/Runtime\";\r\nimport { WorktreeRuntime } from \"@/node/runtime/WorktreeRuntime\";\r\nimport { createRuntime } from \"@/node/runtime/runtimeFactory\";\r\nimport { Ok, Err, type Result } from \"@/common/types/result\";\r\nimport type { StreamEndEvent } from \"@/common/types/stream\";\r\nimport { createMuxMessage, type MuxMessage } from \"@/common/types/message\";\r\nimport type { WorkspaceMetadata } from \"@/common/types/workspace\";\r\nimport type { AIService } from \"@/node/services/aiService\";\r\nimport type { WorkspaceService } from \"@/node/services/workspaceService\";\r\nimport type { InitStateManager } from \"@/node/services/initStateManager\";\r\nimport { InitStateManager as RealInitStateManager } from \"@/node/services/initStateManager\";\r\nimport assert from \"node:assert\";\r\n\r\nfunction initGitRepo(projectPath: string): void {\r\n  execSync(\"git init -b main\", { cwd: projectPath, stdio: \"ignore\" });\r\n  execSync('git config user.email \"test@example.com\"', { cwd: projectPath, stdio: \"ignore\" });\r\n  execSync('git config user.name \"test\"', { cwd: projectPath, stdio: \"ignore\" });\r\n  // Ensure tests don't hang when developers have global commit signing enabled.\r\n  execSync(\"git config commit.gpgsign false\", { cwd: projectPath, stdio: \"ignore\" });\r\n  execSync(\"bash -lc 'echo \\\"hello\\\" > README.md'\", { cwd: projectPath, stdio: \"ignore\" });\r\n  execSync(\"git add README.md\", { cwd: projectPath, stdio: \"ignore\" });\r\n  execSync('git commit -m \"init\"', { cwd: projectPath, stdio: \"ignore\" });\r\n}\r\n\r\nasync function collectFullHistory(service: HistoryService, workspaceId: string) {\r\n  const messages: MuxMessage[] = [];\r\n  const result = await service.iterateFullHistory(workspaceId, \"forward\", (chunk) => {\r\n    messages.push(...chunk);\r\n  });\r\n  assert(result.success, `collectFullHistory failed: ${result.success ? \"\" : result.error}`);\r\n  return messages;\r\n}\r\n\r\nfunction createNullInitLogger() {\r\n  return {\r\n    logStep: (_message: string) => undefined,\r\n    logStdout: (_line: string) => undefined,\r\n    logStderr: (_line: string) => undefined,\r\n    logComplete: (_exitCode: number) => undefined,\r\n    enterHookPhase: () => undefined,\r\n  };\r\n}\r\n\r\nfunction createMockInitStateManager(): InitStateManager {\r\n  return {\r\n    startInit: mock(() => undefined),\r\n    enterHookPhase: mock(() => undefined),\r\n    appendOutput: mock(() => undefined),\r\n    endInit: mock(() => Promise.resolve()),\r\n    getInitState: mock(() => undefined),\r\n    readInitStatus: mock(() => Promise.resolve(null)),\r\n  } as unknown as InitStateManager;\r\n}\r\n\r\nasync function createTestConfig(rootDir: string): Promise<Config> {\r\n  const config = new Config(rootDir);\r\n  await fsPromises.mkdir(config.srcDir, { recursive: true });\r\n  return config;\r\n}\r\n\r\nasync function createTestProject(\r\n  rootDir: string,\r\n  name = \"repo\",\r\n  options?: { initGit?: boolean }\r\n): Promise<string> {\r\n  const projectPath = path.join(rootDir, name);\r\n  await fsPromises.mkdir(projectPath, { recursive: true });\r\n  if (options?.initGit ?? true) {\r\n    initGitRepo(projectPath);\r\n  }\r\n  return projectPath;\r\n}\r\n\r\nfunction stubStableIds(config: Config, ids: string[], fallbackId = \"fffffffff0\"): void {\r\n  let nextIdIndex = 0;\r\n  const configWithStableId = config as unknown as { generateStableId: () => string };\r\n  configWithStableId.generateStableId = () => ids[nextIdIndex++] ?? fallbackId;\r\n}\r\n\r\nfunction createAIServiceMocks(\r\n  config: Config,\r\n  overrides?: Partial<{\r\n    isStreaming: ReturnType<typeof mock>;\r\n    getWorkspaceMetadata: ReturnType<typeof mock>;\r\n    stopStream: ReturnType<typeof mock>;\r\n    on: ReturnType<typeof mock>;\r\n    off: ReturnType<typeof mock>;\r\n  }>\r\n): {\r\n  aiService: AIService;\r\n  isStreaming: ReturnType<typeof mock>;\r\n  getWorkspaceMetadata: ReturnType<typeof mock>;\r\n  stopStream: ReturnType<typeof mock>;\r\n  on: ReturnType<typeof mock>;\r\n  off: ReturnType<typeof mock>;\r\n} {\r\n  const isStreaming = overrides?.isStreaming ?? mock(() => false);\r\n  const getWorkspaceMetadata =\r\n    overrides?.getWorkspaceMetadata ??\r\n    mock(async (workspaceId: string): Promise<Result<WorkspaceMetadata>> => {\r\n      const all = await config.getAllWorkspaceMetadata();\r\n      const found = all.find((m) => m.id === workspaceId);\r\n      return found ? Ok(found) : Err(\"not found\");\r\n    });\r\n\r\n  const stopStream =\r\n    overrides?.stopStream ?? mock((): Promise<Result<void>> => Promise.resolve(Ok(undefined)));\r\n\r\n  const on = overrides?.on ?? mock(() => undefined);\r\n  const off = overrides?.off ?? mock(() => undefined);\r\n\r\n  return {\r\n    aiService: { isStreaming, getWorkspaceMetadata, stopStream, on, off } as unknown as AIService,\r\n    isStreaming,\r\n    getWorkspaceMetadata,\r\n    stopStream,\r\n    on,\r\n    off,\r\n  };\r\n}\r\n\r\nfunction createWorkspaceServiceMocks(\r\n  overrides?: Partial<{\r\n    sendMessage: ReturnType<typeof mock>;\r\n    resumeStream: ReturnType<typeof mock>;\r\n    remove: ReturnType<typeof mock>;\r\n    emit: ReturnType<typeof mock>;\r\n  }>\r\n): {\r\n  workspaceService: WorkspaceService;\r\n  sendMessage: ReturnType<typeof mock>;\r\n  resumeStream: ReturnType<typeof mock>;\r\n  remove: ReturnType<typeof mock>;\r\n  emit: ReturnType<typeof mock>;\r\n} {\r\n  const sendMessage =\r\n    overrides?.sendMessage ?? mock((): Promise<Result<void>> => Promise.resolve(Ok(undefined)));\r\n  const resumeStream =\r\n    overrides?.resumeStream ?? mock((): Promise<Result<void>> => Promise.resolve(Ok(undefined)));\r\n  const remove =\r\n    overrides?.remove ?? mock((): Promise<Result<void>> => Promise.resolve(Ok(undefined)));\r\n  const emit = overrides?.emit ?? mock(() => true);\r\n\r\n  return {\r\n    workspaceService: {\r\n      sendMessage,\r\n      resumeStream,\r\n      remove,\r\n      emit,\r\n    } as unknown as WorkspaceService,\r\n    sendMessage,\r\n    resumeStream,\r\n    remove,\r\n    emit,\r\n  };\r\n}\r\n\r\nfunction createTaskServiceHarness(\r\n  config: Config,\r\n  overrides?: {\r\n    aiService?: AIService;\r\n    workspaceService?: WorkspaceService;\r\n    initStateManager?: InitStateManager;\r\n  }\r\n): {\r\n  historyService: HistoryService;\r\n  partialService: PartialService;\r\n  taskService: TaskService;\r\n  aiService: AIService;\r\n  workspaceService: WorkspaceService;\r\n  initStateManager: InitStateManager;\r\n} {\r\n  const historyService = new HistoryService(config);\r\n  const partialService = new PartialService(config, historyService);\r\n\r\n  const aiService = overrides?.aiService ?? createAIServiceMocks(config).aiService;\r\n  const workspaceService =\r\n    overrides?.workspaceService ?? createWorkspaceServiceMocks().workspaceService;\r\n  const initStateManager = overrides?.initStateManager ?? createMockInitStateManager();\r\n\r\n  const taskService = new TaskService(\r\n    config,\r\n    historyService,\r\n    partialService,\r\n    aiService,\r\n    workspaceService,\r\n    initStateManager\r\n  );\r\n\r\n  return {\r\n    historyService,\r\n    partialService,\r\n    taskService,\r\n    aiService,\r\n    workspaceService,\r\n    initStateManager,\r\n  };\r\n}\r\n\r\ndescribe(\"TaskService\", () => {\r\n  let rootDir: string;\r\n\r\n  beforeEach(async () => {\r\n    rootDir = await fsPromises.mkdtemp(path.join(os.tmpdir(), \"mux-taskService-\"));\r\n  });\r\n\r\n  afterEach(async () => {\r\n    await fsPromises.rm(rootDir, { recursive: true, force: true });\r\n  });\r\n\r\n  test(\"enforces maxTaskNestingDepth\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n    stubStableIds(config, [\"aaaaaaaaaa\", \"bbbbbbbbbb\", \"cccccccccc\"], \"dddddddddd\");\r\n\r\n    const projectPath = await createTestProject(rootDir);\r\n\r\n    const runtimeConfig = { type: \"worktree\" as const, srcBaseDir: config.srcDir };\r\n    const runtime = createRuntime(runtimeConfig, { projectPath });\r\n\r\n    const initLogger = createNullInitLogger();\r\n\r\n    const parentName = \"parent\";\r\n    const parentCreate = await runtime.createWorkspace({\r\n      projectPath,\r\n      branchName: parentName,\r\n      trunkBranch: \"main\",\r\n      directoryName: parentName,\r\n      initLogger,\r\n    });\r\n    expect(parentCreate.success).toBe(true);\r\n\r\n    const parentId = \"1111111111\";\r\n    const parentPath = runtime.getWorkspacePath(projectPath, parentName);\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: parentPath,\r\n                id: parentId,\r\n                name: parentName,\r\n                createdAt: new Date().toISOString(),\r\n                runtimeConfig,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 2 },\r\n    });\r\n    const { taskService } = createTaskServiceHarness(config);\r\n\r\n    const first = await taskService.create({\r\n      parentWorkspaceId: parentId,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"explore this repo\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(first.success).toBe(true);\r\n    if (!first.success) return;\r\n\r\n    const second = await taskService.create({\r\n      parentWorkspaceId: first.data.taskId,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"nested explore\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(second.success).toBe(true);\r\n    if (!second.success) return;\r\n\r\n    const third = await taskService.create({\r\n      parentWorkspaceId: second.data.taskId,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"nested explore again\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(third.success).toBe(false);\r\n    if (!third.success) {\r\n      expect(third.error).toContain(\"maxTaskNestingDepth\");\r\n    }\r\n  }, 20_000);\r\n\r\n  test(\"queues tasks when maxParallelAgentTasks is reached and starts them when a slot frees\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n    stubStableIds(config, [\"aaaaaaaaaa\", \"bbbbbbbbbb\", \"cccccccccc\", \"dddddddddd\"], \"eeeeeeeeee\");\r\n\r\n    const projectPath = await createTestProject(rootDir);\r\n\r\n    const runtimeConfig = { type: \"worktree\" as const, srcBaseDir: config.srcDir };\r\n    const runtime = createRuntime(runtimeConfig, { projectPath });\r\n    const initLogger = createNullInitLogger();\r\n\r\n    const parent1Name = \"parent1\";\r\n    const parent2Name = \"parent2\";\r\n    await runtime.createWorkspace({\r\n      projectPath,\r\n      branchName: parent1Name,\r\n      trunkBranch: \"main\",\r\n      directoryName: parent1Name,\r\n      initLogger,\r\n    });\r\n    await runtime.createWorkspace({\r\n      projectPath,\r\n      branchName: parent2Name,\r\n      trunkBranch: \"main\",\r\n      directoryName: parent2Name,\r\n      initLogger,\r\n    });\r\n\r\n    const parent1Id = \"1111111111\";\r\n    const parent2Id = \"2222222222\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: runtime.getWorkspacePath(projectPath, parent1Name),\r\n                id: parent1Id,\r\n                name: parent1Name,\r\n                createdAt: new Date().toISOString(),\r\n                runtimeConfig,\r\n              },\r\n              {\r\n                path: runtime.getWorkspacePath(projectPath, parent2Name),\r\n                id: parent2Id,\r\n                name: parent2Name,\r\n                createdAt: new Date().toISOString(),\r\n                runtimeConfig,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 1, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { workspaceService, sendMessage } = createWorkspaceServiceMocks();\r\n    const { taskService } = createTaskServiceHarness(config, { workspaceService });\r\n\r\n    const running = await taskService.create({\r\n      parentWorkspaceId: parent1Id,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"task 1\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(running.success).toBe(true);\r\n    if (!running.success) return;\r\n\r\n    const queued = await taskService.create({\r\n      parentWorkspaceId: parent2Id,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"task 2\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(queued.success).toBe(true);\r\n    if (!queued.success) return;\r\n    expect(queued.data.status).toBe(\"queued\");\r\n\r\n    // Free the slot by marking the first task as reported.\r\n    await config.editConfig((cfg) => {\r\n      for (const [_project, project] of cfg.projects) {\r\n        const ws = project.workspaces.find((w) => w.id === running.data.taskId);\r\n        if (ws) {\r\n          ws.taskStatus = \"reported\";\r\n        }\r\n      }\r\n      return cfg;\r\n    });\r\n\r\n    await taskService.initialize();\r\n\r\n    expect(sendMessage).toHaveBeenCalledWith(\r\n      queued.data.taskId,\r\n      \"task 2\",\r\n      expect.anything(),\r\n      expect.objectContaining({ allowQueuedAgentTask: true })\r\n    );\r\n\r\n    const cfg = config.loadConfigOrDefault();\r\n    const started = Array.from(cfg.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === queued.data.taskId);\r\n    expect(started?.taskStatus).toBe(\"running\");\r\n  }, 20_000);\r\n\r\n  test(\"does not count foreground-awaiting tasks towards maxParallelAgentTasks\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n    stubStableIds(config, [\"aaaaaaaaaa\", \"bbbbbbbbbb\", \"cccccccccc\"], \"dddddddddd\");\r\n\r\n    const projectPath = await createTestProject(rootDir);\r\n\r\n    let streamingWorkspaceId: string | null = null;\r\n    const { aiService } = createAIServiceMocks(config, {\r\n      isStreaming: mock((workspaceId: string) => workspaceId === streamingWorkspaceId),\r\n    });\r\n\r\n    const runtimeConfig = { type: \"worktree\" as const, srcBaseDir: config.srcDir };\r\n    const runtime = createRuntime(runtimeConfig, { projectPath });\r\n    const initLogger = createNullInitLogger();\r\n\r\n    const rootName = \"root\";\r\n    await runtime.createWorkspace({\r\n      projectPath,\r\n      branchName: rootName,\r\n      trunkBranch: \"main\",\r\n      directoryName: rootName,\r\n      initLogger,\r\n    });\r\n\r\n    const rootWorkspaceId = \"root-111\";\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: runtime.getWorkspacePath(projectPath, rootName),\r\n                id: rootWorkspaceId,\r\n                name: rootName,\r\n                createdAt: new Date().toISOString(),\r\n                runtimeConfig,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 1, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { workspaceService, sendMessage } = createWorkspaceServiceMocks();\r\n    const { taskService } = createTaskServiceHarness(config, { aiService, workspaceService });\r\n\r\n    const parentTask = await taskService.create({\r\n      parentWorkspaceId: rootWorkspaceId,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"parent task\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(parentTask.success).toBe(true);\r\n    if (!parentTask.success) return;\r\n    streamingWorkspaceId = parentTask.data.taskId;\r\n\r\n    // With maxParallelAgentTasks=1, nested tasks will be created as queued.\r\n    const childTask = await taskService.create({\r\n      parentWorkspaceId: parentTask.data.taskId,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"child task\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(childTask.success).toBe(true);\r\n    if (!childTask.success) return;\r\n    expect(childTask.data.status).toBe(\"queued\");\r\n\r\n    // Simulate a foreground await from the parent task workspace. This should allow the queued child\r\n    // to start despite maxParallelAgentTasks=1, avoiding a scheduler deadlock.\r\n    const waiter = taskService.waitForAgentReport(childTask.data.taskId, {\r\n      timeoutMs: 10_000,\r\n      requestingWorkspaceId: parentTask.data.taskId,\r\n    });\r\n\r\n    const internal = taskService as unknown as {\r\n      maybeStartQueuedTasks: () => Promise<void>;\r\n      resolveWaiters: (taskId: string, report: { reportMarkdown: string; title?: string }) => void;\r\n    };\r\n\r\n    await internal.maybeStartQueuedTasks();\r\n\r\n    expect(sendMessage).toHaveBeenCalledWith(\r\n      childTask.data.taskId,\r\n      \"child task\",\r\n      expect.anything(),\r\n      expect.objectContaining({ allowQueuedAgentTask: true })\r\n    );\r\n\r\n    const cfgAfterStart = config.loadConfigOrDefault();\r\n    const startedEntry = Array.from(cfgAfterStart.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === childTask.data.taskId);\r\n    expect(startedEntry?.taskStatus).toBe(\"running\");\r\n\r\n    internal.resolveWaiters(childTask.data.taskId, { reportMarkdown: \"ok\" });\r\n    const report = await waiter;\r\n    expect(report.reportMarkdown).toBe(\"ok\");\r\n  }, 20_000);\r\n\r\n  test(\"persists forked runtime config updates when dequeuing tasks\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n    stubStableIds(config, [\"aaaaaaaaaa\", \"bbbbbbbbbb\"], \"cccccccccc\");\r\n\r\n    const projectPath = await createTestProject(rootDir);\r\n\r\n    const runtimeConfig = { type: \"worktree\" as const, srcBaseDir: config.srcDir };\r\n    const runtime = createRuntime(runtimeConfig, { projectPath });\r\n    const initLogger = createNullInitLogger();\r\n\r\n    const parentName = \"parent\";\r\n    await runtime.createWorkspace({\r\n      projectPath,\r\n      branchName: parentName,\r\n      trunkBranch: \"main\",\r\n      directoryName: parentName,\r\n      initLogger,\r\n    });\r\n\r\n    const parentId = \"1111111111\";\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: runtime.getWorkspacePath(projectPath, parentName),\r\n                id: parentId,\r\n                name: parentName,\r\n                createdAt: new Date().toISOString(),\r\n                runtimeConfig,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 1, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const forkedSrcBaseDir = path.join(config.srcDir, \"forked-runtime\");\r\n    const sourceSrcBaseDir = path.join(config.srcDir, \"source-runtime\");\r\n    // eslint-disable-next-line @typescript-eslint/unbound-method -- intentionally capturing prototype method for spy\r\n    const originalFork = WorktreeRuntime.prototype.forkWorkspace;\r\n    let forkCallCount = 0;\r\n    const forkSpy = spyOn(WorktreeRuntime.prototype, \"forkWorkspace\").mockImplementation(\r\n      async function (this: WorktreeRuntime, params: WorkspaceForkParams) {\r\n        const result = await originalFork.call(this, params);\r\n        if (!result.success) return result;\r\n        forkCallCount += 1;\r\n        if (forkCallCount === 2) {\r\n          return {\r\n            ...result,\r\n            forkedRuntimeConfig: { ...runtimeConfig, srcBaseDir: forkedSrcBaseDir },\r\n            sourceRuntimeConfig: { ...runtimeConfig, srcBaseDir: sourceSrcBaseDir },\r\n          };\r\n        }\r\n        return result;\r\n      }\r\n    );\r\n\r\n    try {\r\n      const { taskService } = createTaskServiceHarness(config);\r\n\r\n      const running = await taskService.create({\r\n        parentWorkspaceId: parentId,\r\n        kind: \"agent\",\r\n        agentType: \"explore\",\r\n        prompt: \"task 1\",\r\n        title: \"Test task\",\r\n      });\r\n      expect(running.success).toBe(true);\r\n      if (!running.success) return;\r\n\r\n      const queued = await taskService.create({\r\n        parentWorkspaceId: parentId,\r\n        kind: \"agent\",\r\n        agentType: \"explore\",\r\n        prompt: \"task 2\",\r\n        title: \"Test task\",\r\n      });\r\n      expect(queued.success).toBe(true);\r\n      if (!queued.success) return;\r\n      expect(queued.data.status).toBe(\"queued\");\r\n\r\n      await config.editConfig((cfg) => {\r\n        for (const [_project, project] of cfg.projects) {\r\n          const ws = project.workspaces.find((w) => w.id === running.data.taskId);\r\n          if (ws) {\r\n            ws.taskStatus = \"reported\";\r\n          }\r\n        }\r\n        return cfg;\r\n      });\r\n\r\n      await taskService.initialize();\r\n\r\n      const postCfg = config.loadConfigOrDefault();\r\n      const workspaces = Array.from(postCfg.projects.values()).flatMap((p) => p.workspaces);\r\n      const parentEntry = workspaces.find((w) => w.id === parentId);\r\n      const childEntry = workspaces.find((w) => w.id === queued.data.taskId);\r\n      expect(parentEntry?.runtimeConfig).toMatchObject({\r\n        type: \"worktree\",\r\n        srcBaseDir: sourceSrcBaseDir,\r\n      });\r\n      expect(childEntry?.runtimeConfig).toMatchObject({\r\n        type: \"worktree\",\r\n        srcBaseDir: forkedSrcBaseDir,\r\n      });\r\n    } finally {\r\n      forkSpy.mockRestore();\r\n    }\r\n  }, 20_000);\r\n\r\n  test(\"does not run init hooks for queued tasks until they start\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n    stubStableIds(config, [\"aaaaaaaaaa\", \"bbbbbbbbbb\", \"cccccccccc\"], \"dddddddddd\");\r\n\r\n    const projectPath = await createTestProject(rootDir);\r\n\r\n    const runtimeConfig = { type: \"worktree\" as const, srcBaseDir: config.srcDir };\r\n    const runtime = createRuntime(runtimeConfig, { projectPath });\r\n    const initLogger = createNullInitLogger();\r\n\r\n    const parentName = \"parent\";\r\n    await runtime.createWorkspace({\r\n      projectPath,\r\n      branchName: parentName,\r\n      trunkBranch: \"main\",\r\n      directoryName: parentName,\r\n      initLogger,\r\n    });\r\n\r\n    const parentId = \"1111111111\";\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: runtime.getWorkspacePath(projectPath, parentName),\r\n                id: parentId,\r\n                name: parentName,\r\n                createdAt: new Date().toISOString(),\r\n                runtimeConfig,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 1, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const initStateManager = new RealInitStateManager(config);\r\n    const { workspaceService, sendMessage } = createWorkspaceServiceMocks();\r\n    const { taskService } = createTaskServiceHarness(config, {\r\n      workspaceService,\r\n      initStateManager: initStateManager as unknown as InitStateManager,\r\n    });\r\n\r\n    const running = await taskService.create({\r\n      parentWorkspaceId: parentId,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"task 1\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(running.success).toBe(true);\r\n    if (!running.success) return;\r\n\r\n    // Wait for running task init (fire-and-forget) so the init-status file exists.\r\n    await initStateManager.waitForInit(running.data.taskId);\r\n\r\n    const queued = await taskService.create({\r\n      parentWorkspaceId: parentId,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"task 2\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(queued.success).toBe(true);\r\n    if (!queued.success) return;\r\n    expect(queued.data.status).toBe(\"queued\");\r\n\r\n    // Queued tasks should not create a worktree directory until they're dequeued.\r\n    const cfgBeforeStart = config.loadConfigOrDefault();\r\n    const queuedEntryBeforeStart = Array.from(cfgBeforeStart.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === queued.data.taskId);\r\n    expect(queuedEntryBeforeStart).toBeTruthy();\r\n    await fsPromises.stat(queuedEntryBeforeStart!.path).then(\r\n      () => {\r\n        throw new Error(\"Expected queued task workspace path to not exist before start\");\r\n      },\r\n      () => undefined\r\n    );\r\n\r\n    const queuedInitStatusPath = path.join(\r\n      config.getSessionDir(queued.data.taskId),\r\n      \"init-status.json\"\r\n    );\r\n    await fsPromises.stat(queuedInitStatusPath).then(\r\n      () => {\r\n        throw new Error(\"Expected queued task init-status to not exist before start\");\r\n      },\r\n      () => undefined\r\n    );\r\n\r\n    // Free slot and start queued tasks.\r\n    await config.editConfig((cfg) => {\r\n      for (const [_project, project] of cfg.projects) {\r\n        const ws = project.workspaces.find((w) => w.id === running.data.taskId);\r\n        if (ws) {\r\n          ws.taskStatus = \"reported\";\r\n        }\r\n      }\r\n      return cfg;\r\n    });\r\n\r\n    await taskService.initialize();\r\n\r\n    expect(sendMessage).toHaveBeenCalledWith(\r\n      queued.data.taskId,\r\n      \"task 2\",\r\n      expect.anything(),\r\n      expect.objectContaining({ allowQueuedAgentTask: true })\r\n    );\r\n\r\n    // Init should start only once the task is dequeued.\r\n    await initStateManager.waitForInit(queued.data.taskId);\r\n    expect(await fsPromises.stat(queuedInitStatusPath)).toBeTruthy();\r\n\r\n    const cfgAfterStart = config.loadConfigOrDefault();\r\n    const queuedEntryAfterStart = Array.from(cfgAfterStart.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === queued.data.taskId);\r\n    expect(queuedEntryAfterStart).toBeTruthy();\r\n    expect(await fsPromises.stat(queuedEntryAfterStart!.path)).toBeTruthy();\r\n  }, 20_000);\r\n\r\n  test(\"does not start queued tasks while a reported task is still streaming\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const rootWorkspaceId = \"root-111\";\r\n    const reportedTaskId = \"task-reported\";\r\n    const queuedTaskId = \"task-queued\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              { path: path.join(projectPath, \"root\"), id: rootWorkspaceId, name: \"root\" },\r\n              {\r\n                path: path.join(projectPath, \"reported\"),\r\n                id: reportedTaskId,\r\n                name: \"agent_explore_reported\",\r\n                parentWorkspaceId: rootWorkspaceId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"reported\",\r\n              },\r\n              {\r\n                path: path.join(projectPath, \"queued\"),\r\n                id: queuedTaskId,\r\n                name: \"agent_explore_queued\",\r\n                parentWorkspaceId: rootWorkspaceId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"queued\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 1, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { aiService } = createAIServiceMocks(config, {\r\n      isStreaming: mock((workspaceId: string) => workspaceId === reportedTaskId),\r\n    });\r\n    const { workspaceService, sendMessage } = createWorkspaceServiceMocks();\r\n    const { taskService } = createTaskServiceHarness(config, { aiService, workspaceService });\r\n\r\n    await taskService.initialize();\r\n\r\n    expect(sendMessage).not.toHaveBeenCalled();\r\n\r\n    const cfg = config.loadConfigOrDefault();\r\n    const queued = Array.from(cfg.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === queuedTaskId);\r\n    expect(queued?.taskStatus).toBe(\"queued\");\r\n  });\r\n\r\n  test(\"allows multiple agent tasks under the same parent up to maxParallelAgentTasks\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n    stubStableIds(config, [\"aaaaaaaaaa\", \"bbbbbbbbbb\", \"cccccccccc\"], \"dddddddddd\");\r\n\r\n    const projectPath = await createTestProject(rootDir);\r\n\r\n    const runtimeConfig = { type: \"worktree\" as const, srcBaseDir: config.srcDir };\r\n    const runtime = createRuntime(runtimeConfig, { projectPath });\r\n\r\n    const initLogger = createNullInitLogger();\r\n\r\n    const parentName = \"parent\";\r\n    const parentCreate = await runtime.createWorkspace({\r\n      projectPath,\r\n      branchName: parentName,\r\n      trunkBranch: \"main\",\r\n      directoryName: parentName,\r\n      initLogger,\r\n    });\r\n    expect(parentCreate.success).toBe(true);\r\n\r\n    const parentId = \"1111111111\";\r\n    const parentPath = runtime.getWorkspacePath(projectPath, parentName);\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: parentPath,\r\n                id: parentId,\r\n                name: parentName,\r\n                createdAt: new Date().toISOString(),\r\n                runtimeConfig,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 2, maxTaskNestingDepth: 3 },\r\n    });\r\n    const { taskService } = createTaskServiceHarness(config);\r\n\r\n    const first = await taskService.create({\r\n      parentWorkspaceId: parentId,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"task 1\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(first.success).toBe(true);\r\n    if (!first.success) return;\r\n    expect(first.data.status).toBe(\"running\");\r\n\r\n    const second = await taskService.create({\r\n      parentWorkspaceId: parentId,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"task 2\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(second.success).toBe(true);\r\n    if (!second.success) return;\r\n    expect(second.data.status).toBe(\"running\");\r\n\r\n    const third = await taskService.create({\r\n      parentWorkspaceId: parentId,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"task 3\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(third.success).toBe(true);\r\n    if (!third.success) return;\r\n    expect(third.data.status).toBe(\"queued\");\r\n  }, 20_000);\r\n\r\n  test(\"supports creating agent tasks from local (project-dir) workspaces without requiring git\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n    stubStableIds(config, [\"aaaaaaaaaa\"], \"bbbbbbbbbb\");\r\n\r\n    const projectPath = await createTestProject(rootDir, \"repo\", { initGit: false });\r\n\r\n    const parentId = \"1111111111\";\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: projectPath,\r\n                id: parentId,\r\n                name: \"parent\",\r\n                createdAt: new Date().toISOString(),\r\n                runtimeConfig: { type: \"local\" },\r\n                aiSettings: { model: \"openai:gpt-5.2\", thinkingLevel: \"medium\" },\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n    });\r\n    const { taskService } = createTaskServiceHarness(config);\r\n\r\n    const created = await taskService.create({\r\n      parentWorkspaceId: parentId,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"run task from local workspace\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(created.success).toBe(true);\r\n    if (!created.success) return;\r\n\r\n    const postCfg = config.loadConfigOrDefault();\r\n    const childEntry = Array.from(postCfg.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === created.data.taskId);\r\n    expect(childEntry).toBeTruthy();\r\n    expect(childEntry?.path).toBe(projectPath);\r\n    expect(childEntry?.runtimeConfig?.type).toBe(\"local\");\r\n    expect(childEntry?.aiSettings).toEqual({ model: \"openai:gpt-5.2\", thinkingLevel: \"medium\" });\r\n    expect(childEntry?.taskModelString).toBe(\"openai:gpt-5.2\");\r\n    expect(childEntry?.taskThinkingLevel).toBe(\"medium\");\r\n  }, 20_000);\r\n\r\n  test(\"applies subagentAiDefaults model + thinking overrides on task create\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n    stubStableIds(config, [\"aaaaaaaaaa\"], \"bbbbbbbbbb\");\r\n\r\n    const projectPath = await createTestProject(rootDir, \"repo\", { initGit: false });\r\n\r\n    const parentId = \"1111111111\";\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: projectPath,\r\n                id: parentId,\r\n                name: \"parent\",\r\n                createdAt: new Date().toISOString(),\r\n                runtimeConfig: { type: \"local\" },\r\n                aiSettings: { model: \"openai:gpt-5.2\", thinkingLevel: \"high\" },\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n      subagentAiDefaults: {\r\n        explore: { modelString: \"anthropic:claude-haiku-4-5\", thinkingLevel: \"off\" },\r\n      },\r\n    });\r\n    const { workspaceService, sendMessage } = createWorkspaceServiceMocks();\r\n    const { taskService } = createTaskServiceHarness(config, { workspaceService });\r\n\r\n    const created = await taskService.create({\r\n      parentWorkspaceId: parentId,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"run task with overrides\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(created.success).toBe(true);\r\n    if (!created.success) return;\r\n\r\n    expect(sendMessage).toHaveBeenCalledWith(created.data.taskId, \"run task with overrides\", {\r\n      model: \"anthropic:claude-haiku-4-5\",\r\n      agentId: \"explore\",\r\n      thinkingLevel: \"off\",\r\n      experiments: undefined,\r\n    });\r\n\r\n    const postCfg = config.loadConfigOrDefault();\r\n    const childEntry = Array.from(postCfg.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === created.data.taskId);\r\n    expect(childEntry).toBeTruthy();\r\n    expect(childEntry?.aiSettings).toEqual({\r\n      model: \"anthropic:claude-haiku-4-5\",\r\n      thinkingLevel: \"off\",\r\n    });\r\n    expect(childEntry?.taskModelString).toBe(\"anthropic:claude-haiku-4-5\");\r\n    expect(childEntry?.taskThinkingLevel).toBe(\"off\");\r\n  }, 20_000);\r\n\r\n  test(\"agentAiDefaults outrank workspace aiSettingsByAgent for same agent\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n    stubStableIds(config, [\"aaaaaaaaaa\"], \"bbbbbbbbbb\");\r\n\r\n    const projectPath = await createTestProject(rootDir, \"repo\", { initGit: false });\r\n\r\n    const parentId = \"1111111111\";\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: projectPath,\r\n                id: parentId,\r\n                name: \"parent\",\r\n                createdAt: new Date().toISOString(),\r\n                runtimeConfig: { type: \"local\" },\r\n                aiSettings: { model: \"openai:gpt-5.2\", thinkingLevel: \"high\" },\r\n                aiSettingsByAgent: {\r\n                  explore: { model: \"openai:gpt-5.2-pro\", thinkingLevel: \"medium\" },\r\n                },\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n      agentAiDefaults: {\r\n        explore: { modelString: \"anthropic:claude-haiku-4-5\", thinkingLevel: \"off\" },\r\n      },\r\n    });\r\n\r\n    const { workspaceService, sendMessage } = createWorkspaceServiceMocks();\r\n    const { taskService } = createTaskServiceHarness(config, { workspaceService });\r\n\r\n    const created = await taskService.create({\r\n      parentWorkspaceId: parentId,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"run task with same-agent conflicts\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(created.success).toBe(true);\r\n    if (!created.success) return;\r\n\r\n    expect(sendMessage).toHaveBeenCalledWith(\r\n      created.data.taskId,\r\n      \"run task with same-agent conflicts\",\r\n      {\r\n        model: \"anthropic:claude-haiku-4-5\",\r\n        agentId: \"explore\",\r\n        thinkingLevel: \"off\",\r\n        experiments: undefined,\r\n      }\r\n    );\r\n\r\n    const postCfg = config.loadConfigOrDefault();\r\n    const childEntry = Array.from(postCfg.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === created.data.taskId);\r\n    expect(childEntry).toBeTruthy();\r\n    expect(childEntry?.aiSettings).toEqual({\r\n      model: \"anthropic:claude-haiku-4-5\",\r\n      thinkingLevel: \"off\",\r\n    });\r\n    expect(childEntry?.taskModelString).toBe(\"anthropic:claude-haiku-4-5\");\r\n    expect(childEntry?.taskThinkingLevel).toBe(\"off\");\r\n  }, 20_000);\r\n\r\n  test(\"inherits agentAiDefaults from base chain on task create\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n    stubStableIds(config, [\"aaaaaaaaaa\"], \"bbbbbbbbbb\");\r\n\r\n    const projectPath = await createTestProject(rootDir, \"repo\", { initGit: false });\r\n\r\n    // Custom agent definition stored in the project workspace (.mux/agents).\r\n    const agentsDir = path.join(projectPath, \".mux\", \"agents\");\r\n    await fsPromises.mkdir(agentsDir, { recursive: true });\r\n    await fsPromises.writeFile(\r\n      path.join(agentsDir, \"custom.md\"),\r\n      `---\\nname: Custom\\ndescription: Exec-derived custom agent for tests\\nbase: exec\\nsubagent:\\n  runnable: true\\n---\\n\\nTest agent body.\\n`,\r\n      \"utf-8\"\r\n    );\r\n\r\n    const parentId = \"1111111111\";\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: projectPath,\r\n                id: parentId,\r\n                name: \"parent\",\r\n                createdAt: new Date().toISOString(),\r\n                runtimeConfig: { type: \"local\" },\r\n                aiSettings: { model: \"openai:gpt-5.2\", thinkingLevel: \"high\" },\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n      agentAiDefaults: {\r\n        exec: { modelString: \"anthropic:claude-haiku-4-5\", thinkingLevel: \"off\" },\r\n      },\r\n    });\r\n\r\n    const { workspaceService, sendMessage } = createWorkspaceServiceMocks();\r\n    const { taskService } = createTaskServiceHarness(config, { workspaceService });\r\n\r\n    const created = await taskService.create({\r\n      parentWorkspaceId: parentId,\r\n      kind: \"agent\",\r\n      agentType: \"custom\",\r\n      prompt: \"run task with custom agent\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(created.success).toBe(true);\r\n    if (!created.success) return;\r\n\r\n    expect(sendMessage).toHaveBeenCalledWith(created.data.taskId, \"run task with custom agent\", {\r\n      model: \"anthropic:claude-haiku-4-5\",\r\n      agentId: \"custom\",\r\n      thinkingLevel: \"off\",\r\n      experiments: undefined,\r\n    });\r\n\r\n    const postCfg = config.loadConfigOrDefault();\r\n    const childEntry = Array.from(postCfg.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === created.data.taskId);\r\n    expect(childEntry).toBeTruthy();\r\n    expect(childEntry?.aiSettings).toEqual({\r\n      model: \"anthropic:claude-haiku-4-5\",\r\n      thinkingLevel: \"off\",\r\n    });\r\n    expect(childEntry?.taskModelString).toBe(\"anthropic:claude-haiku-4-5\");\r\n    expect(childEntry?.taskThinkingLevel).toBe(\"off\");\r\n  }, 20_000);\r\n\r\n  test(\"does not apply agentAiDefaults base fallback when workspace overrides exist\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n    stubStableIds(config, [\"aaaaaaaaaa\"], \"bbbbbbbbbb\");\r\n\r\n    const projectPath = await createTestProject(rootDir, \"repo\", { initGit: false });\r\n\r\n    // Custom agent definition stored in the project workspace (.mux/agents).\r\n    const agentsDir = path.join(projectPath, \".mux\", \"agents\");\r\n    await fsPromises.mkdir(agentsDir, { recursive: true });\r\n    await fsPromises.writeFile(\r\n      path.join(agentsDir, \"custom.md\"),\r\n      `---\\nname: Custom\\ndescription: Exec-derived custom agent for tests\\nbase: exec\\nsubagent:\\n  runnable: true\\n---\\n\\nTest agent body.\\n`,\r\n      \"utf-8\"\r\n    );\r\n\r\n    const parentId = \"1111111111\";\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: projectPath,\r\n                id: parentId,\r\n                name: \"parent\",\r\n                createdAt: new Date().toISOString(),\r\n                runtimeConfig: { type: \"local\" },\r\n                aiSettings: { model: \"openai:gpt-5.2\", thinkingLevel: \"high\" },\r\n                aiSettingsByAgent: {\r\n                  custom: { model: \"openai:gpt-5.2-pro\", thinkingLevel: \"medium\" },\r\n                },\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n      agentAiDefaults: {\r\n        exec: { modelString: \"anthropic:claude-haiku-4-5\", thinkingLevel: \"off\" },\r\n      },\r\n    });\r\n\r\n    const { workspaceService, sendMessage } = createWorkspaceServiceMocks();\r\n    const { taskService } = createTaskServiceHarness(config, { workspaceService });\r\n\r\n    const created = await taskService.create({\r\n      parentWorkspaceId: parentId,\r\n      kind: \"agent\",\r\n      agentType: \"custom\",\r\n      prompt: \"run task with custom agent\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(created.success).toBe(true);\r\n    if (!created.success) return;\r\n\r\n    expect(sendMessage).toHaveBeenCalledWith(created.data.taskId, \"run task with custom agent\", {\r\n      model: \"openai:gpt-5.2-pro\",\r\n      agentId: \"custom\",\r\n      thinkingLevel: \"medium\",\r\n      experiments: undefined,\r\n    });\r\n  }, 20_000);\r\n  test(\"auto-resumes a parent workspace until background tasks finish\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const rootWorkspaceId = \"root-111\";\r\n    const childTaskId = \"task-222\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: path.join(projectPath, \"root\"),\r\n                id: rootWorkspaceId,\r\n                name: \"root\",\r\n                aiSettings: { model: \"openai:gpt-5.2\", thinkingLevel: \"medium\" },\r\n              },\r\n              {\r\n                path: path.join(projectPath, \"child-task\"),\r\n                id: childTaskId,\r\n                name: \"agent_explore_child\",\r\n                parentWorkspaceId: rootWorkspaceId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"running\",\r\n                taskModelString: \"openai:gpt-5.2\",\r\n                taskThinkingLevel: \"medium\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { aiService } = createAIServiceMocks(config);\r\n    const { workspaceService, sendMessage } = createWorkspaceServiceMocks();\r\n    const { taskService } = createTaskServiceHarness(config, { aiService, workspaceService });\r\n\r\n    const internal = taskService as unknown as {\r\n      handleStreamEnd: (event: StreamEndEvent) => Promise<void>;\r\n    };\r\n\r\n    await internal.handleStreamEnd({\r\n      type: \"stream-end\",\r\n      workspaceId: rootWorkspaceId,\r\n      messageId: \"assistant-root\",\r\n      metadata: { model: \"openai:gpt-5.2\" },\r\n      parts: [],\r\n    });\r\n\r\n    expect(sendMessage).toHaveBeenCalledTimes(1);\r\n    expect(sendMessage).toHaveBeenCalledWith(\r\n      rootWorkspaceId,\r\n      expect.stringContaining(childTaskId),\r\n      expect.objectContaining({\r\n        model: \"openai:gpt-5.2\",\r\n        thinkingLevel: \"medium\",\r\n      }),\r\n      // Auto-resume skips counter reset\r\n      expect.objectContaining({ skipAutoResumeReset: true, synthetic: true })\r\n    );\r\n  });\r\n\r\n  test(\"terminateDescendantAgentTask stops stream, removes workspace, and rejects waiters\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const rootWorkspaceId = \"root-111\";\r\n    const taskId = \"task-222\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              { path: path.join(projectPath, \"root\"), id: rootWorkspaceId, name: \"root\" },\r\n              {\r\n                path: path.join(projectPath, \"task\"),\r\n                id: taskId,\r\n                name: \"agent_exec_task\",\r\n                parentWorkspaceId: rootWorkspaceId,\r\n                agentType: \"exec\",\r\n                taskStatus: \"running\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { aiService, stopStream } = createAIServiceMocks(config);\r\n    const { workspaceService, remove } = createWorkspaceServiceMocks();\r\n    const { taskService } = createTaskServiceHarness(config, { aiService, workspaceService });\r\n\r\n    const waiter = taskService.waitForAgentReport(taskId, { timeoutMs: 10_000 });\r\n\r\n    const terminateResult = await taskService.terminateDescendantAgentTask(rootWorkspaceId, taskId);\r\n    expect(terminateResult.success).toBe(true);\r\n\r\n    let caught: unknown = null;\r\n    try {\r\n      await waiter;\r\n    } catch (error: unknown) {\r\n      caught = error;\r\n    }\r\n    expect(caught).toBeInstanceOf(Error);\r\n    if (caught instanceof Error) {\r\n      expect(caught.message).toMatch(/terminated/i);\r\n    }\r\n    expect(stopStream).toHaveBeenCalledWith(\r\n      taskId,\r\n      expect.objectContaining({ abandonPartial: true })\r\n    );\r\n    expect(remove).toHaveBeenCalledWith(taskId, true);\r\n  });\r\n\r\n  test(\"terminateDescendantAgentTask terminates descendant tasks leaf-first\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const rootWorkspaceId = \"root-111\";\r\n    const parentTaskId = \"task-parent\";\r\n    const childTaskId = \"task-child\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              { path: path.join(projectPath, \"root\"), id: rootWorkspaceId, name: \"root\" },\r\n              {\r\n                path: path.join(projectPath, \"parent-task\"),\r\n                id: parentTaskId,\r\n                name: \"agent_exec_parent\",\r\n                parentWorkspaceId: rootWorkspaceId,\r\n                agentType: \"exec\",\r\n                taskStatus: \"running\",\r\n              },\r\n              {\r\n                path: path.join(projectPath, \"child-task\"),\r\n                id: childTaskId,\r\n                name: \"agent_explore_child\",\r\n                parentWorkspaceId: parentTaskId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"running\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { aiService } = createAIServiceMocks(config);\r\n    const { workspaceService, remove } = createWorkspaceServiceMocks();\r\n    const { taskService } = createTaskServiceHarness(config, { aiService, workspaceService });\r\n\r\n    const terminateResult = await taskService.terminateDescendantAgentTask(\r\n      rootWorkspaceId,\r\n      parentTaskId\r\n    );\r\n    expect(terminateResult.success).toBe(true);\r\n    if (!terminateResult.success) return;\r\n    expect(terminateResult.data.terminatedTaskIds).toEqual([childTaskId, parentTaskId]);\r\n\r\n    expect(remove).toHaveBeenNthCalledWith(1, childTaskId, true);\r\n    expect(remove).toHaveBeenNthCalledWith(2, parentTaskId, true);\r\n  });\r\n\r\n  test(\"initialize resumes awaiting_report tasks after restart\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const parentId = \"parent-111\";\r\n    const childId = \"child-222\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              { path: path.join(projectPath, \"parent\"), id: parentId, name: \"parent\" },\r\n              {\r\n                path: path.join(projectPath, \"child\"),\r\n                id: childId,\r\n                name: \"agent_explore_child\",\r\n                parentWorkspaceId: parentId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"awaiting_report\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 1, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { aiService } = createAIServiceMocks(config);\r\n    const { workspaceService, sendMessage } = createWorkspaceServiceMocks();\r\n    const { taskService } = createTaskServiceHarness(config, { aiService, workspaceService });\r\n\r\n    await taskService.initialize();\r\n\r\n    expect(sendMessage).toHaveBeenCalledWith(\r\n      childId,\r\n      expect.stringContaining(\"awaiting its final agent_report\"),\r\n      expect.objectContaining({\r\n        toolPolicy: [{ regex_match: \"^agent_report$\", action: \"require\" }],\r\n      }),\r\n      expect.objectContaining({ synthetic: true })\r\n    );\r\n  });\r\n\r\n  test(\"waitForAgentReport does not time out while task is queued\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const parentId = \"parent-111\";\r\n    const childId = \"child-222\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              { path: path.join(projectPath, \"parent\"), id: parentId, name: \"parent\" },\r\n              {\r\n                path: path.join(projectPath, \"child\"),\r\n                id: childId,\r\n                name: \"agent_explore_child\",\r\n                parentWorkspaceId: parentId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"queued\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 1, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { taskService } = createTaskServiceHarness(config);\r\n\r\n    // Timeout is short so the test would fail if the timer started while queued.\r\n    const reportPromise = taskService.waitForAgentReport(childId, { timeoutMs: 50 });\r\n\r\n    // Wait longer than timeout while task is still queued.\r\n    await new Promise((r) => setTimeout(r, 100));\r\n\r\n    const internal = taskService as unknown as {\r\n      setTaskStatus: (workspaceId: string, status: \"queued\" | \"running\") => Promise<void>;\r\n      resolveWaiters: (taskId: string, report: { reportMarkdown: string; title?: string }) => void;\r\n    };\r\n\r\n    await internal.setTaskStatus(childId, \"running\");\r\n    internal.resolveWaiters(childId, { reportMarkdown: \"ok\" });\r\n\r\n    const report = await reportPromise;\r\n    expect(report.reportMarkdown).toBe(\"ok\");\r\n  });\r\n\r\n  test(\"waitForAgentReport returns persisted report after workspace is removed\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const parentId = \"parent-111\";\r\n    const childId = \"child-222\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              { path: path.join(projectPath, \"parent\"), id: parentId, name: \"parent\" },\r\n              {\r\n                path: path.join(projectPath, \"child\"),\r\n                id: childId,\r\n                name: \"agent_explore_child\",\r\n                parentWorkspaceId: parentId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"running\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 1, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { taskService } = createTaskServiceHarness(config);\r\n\r\n    await upsertSubagentReportArtifact({\r\n      workspaceId: parentId,\r\n      workspaceSessionDir: config.getSessionDir(parentId),\r\n      childTaskId: childId,\r\n      parentWorkspaceId: parentId,\r\n      ancestorWorkspaceIds: [parentId],\r\n      reportMarkdown: \"ok\",\r\n      title: \"t\",\r\n      nowMs: Date.now(),\r\n    });\r\n\r\n    await config.removeWorkspace(childId);\r\n\r\n    const report = await taskService.waitForAgentReport(childId, {\r\n      timeoutMs: 10,\r\n      requestingWorkspaceId: parentId,\r\n    });\r\n    expect(report.reportMarkdown).toBe(\"ok\");\r\n    expect(report.title).toBe(\"t\");\r\n  });\r\n\r\n  test(\"isDescendantAgentTask consults persisted ancestry after workspace is removed\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const parentId = \"parent-111\";\r\n    const childId = \"child-222\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              { path: path.join(projectPath, \"parent\"), id: parentId, name: \"parent\" },\r\n              {\r\n                path: path.join(projectPath, \"child\"),\r\n                id: childId,\r\n                name: \"agent_explore_child\",\r\n                parentWorkspaceId: parentId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"running\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 1, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { taskService } = createTaskServiceHarness(config);\r\n\r\n    await upsertSubagentReportArtifact({\r\n      workspaceId: parentId,\r\n      workspaceSessionDir: config.getSessionDir(parentId),\r\n      childTaskId: childId,\r\n      parentWorkspaceId: parentId,\r\n      ancestorWorkspaceIds: [parentId],\r\n      reportMarkdown: \"ok\",\r\n      title: \"t\",\r\n      nowMs: Date.now(),\r\n    });\r\n\r\n    await config.removeWorkspace(childId);\r\n\r\n    expect(await taskService.isDescendantAgentTask(parentId, childId)).toBe(true);\r\n    expect(await taskService.isDescendantAgentTask(\"other-parent\", childId)).toBe(false);\r\n  });\r\n\r\n  test(\"filterDescendantAgentTaskIds consults persisted ancestry after cleanup\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const parentId = \"parent-111\";\r\n    const childId = \"child-222\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              { path: path.join(projectPath, \"parent\"), id: parentId, name: \"parent\" },\r\n              {\r\n                path: path.join(projectPath, \"child\"),\r\n                id: childId,\r\n                name: \"agent_explore_child\",\r\n                parentWorkspaceId: parentId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"running\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 1, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { taskService } = createTaskServiceHarness(config);\r\n\r\n    await upsertSubagentReportArtifact({\r\n      workspaceId: parentId,\r\n      workspaceSessionDir: config.getSessionDir(parentId),\r\n      childTaskId: childId,\r\n      parentWorkspaceId: parentId,\r\n      ancestorWorkspaceIds: [parentId],\r\n      reportMarkdown: \"ok\",\r\n      title: \"t\",\r\n      nowMs: Date.now(),\r\n    });\r\n\r\n    await config.removeWorkspace(childId);\r\n\r\n    expect(await taskService.filterDescendantAgentTaskIds(parentId, [childId])).toEqual([childId]);\r\n    expect(await taskService.filterDescendantAgentTaskIds(\"other-parent\", [childId])).toEqual([]);\r\n  });\r\n\r\n  test(\"waitForAgentReport falls back to persisted report after cache is cleared\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const parentId = \"parent-111\";\r\n    const childId = \"child-222\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              { path: path.join(projectPath, \"parent\"), id: parentId, name: \"parent\" },\r\n              {\r\n                path: path.join(projectPath, \"child\"),\r\n                id: childId,\r\n                name: \"agent_explore_child\",\r\n                parentWorkspaceId: parentId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"running\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 1, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { taskService } = createTaskServiceHarness(config);\r\n\r\n    await upsertSubagentReportArtifact({\r\n      workspaceId: parentId,\r\n      workspaceSessionDir: config.getSessionDir(parentId),\r\n      childTaskId: childId,\r\n      parentWorkspaceId: parentId,\r\n      ancestorWorkspaceIds: [parentId],\r\n      reportMarkdown: \"ok\",\r\n      title: \"t\",\r\n      nowMs: Date.now(),\r\n    });\r\n\r\n    await config.removeWorkspace(childId);\r\n\r\n    // Simulate process restart / eviction.\r\n    (\r\n      taskService as unknown as { completedReportsByTaskId: Map<string, unknown> }\r\n    ).completedReportsByTaskId.clear();\r\n\r\n    const report = await taskService.waitForAgentReport(childId, {\r\n      timeoutMs: 10,\r\n      requestingWorkspaceId: parentId,\r\n    });\r\n    expect(report.reportMarkdown).toBe(\"ok\");\r\n    expect(report.title).toBe(\"t\");\r\n  });\r\n\r\n  test(\"does not request agent_report on stream end while task has active descendants\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const rootWorkspaceId = \"root-111\";\r\n    const parentTaskId = \"task-222\";\r\n    const descendantTaskId = \"task-333\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              { path: path.join(projectPath, \"root\"), id: rootWorkspaceId, name: \"root\" },\r\n              {\r\n                path: path.join(projectPath, \"parent-task\"),\r\n                id: parentTaskId,\r\n                name: \"agent_exec_parent\",\r\n                parentWorkspaceId: rootWorkspaceId,\r\n                agentType: \"exec\",\r\n                taskStatus: \"running\",\r\n              },\r\n              {\r\n                path: path.join(projectPath, \"child-task\"),\r\n                id: descendantTaskId,\r\n                name: \"agent_explore_child\",\r\n                parentWorkspaceId: parentTaskId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"running\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { workspaceService, sendMessage } = createWorkspaceServiceMocks();\r\n    const { taskService } = createTaskServiceHarness(config, { workspaceService });\r\n\r\n    const internal = taskService as unknown as {\r\n      handleStreamEnd: (event: StreamEndEvent) => Promise<void>;\r\n    };\r\n    await internal.handleStreamEnd({\r\n      type: \"stream-end\",\r\n      workspaceId: parentTaskId,\r\n      messageId: \"assistant-parent-task\",\r\n      metadata: { model: \"openai:gpt-4o-mini\" },\r\n      parts: [],\r\n    });\r\n\r\n    expect(sendMessage).not.toHaveBeenCalled();\r\n\r\n    const postCfg = config.loadConfigOrDefault();\r\n    const ws = Array.from(postCfg.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === parentTaskId);\r\n    expect(ws?.taskStatus).toBe(\"running\");\r\n  });\r\n\r\n  test(\"reverts awaiting_report to running on stream end while task has active descendants\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const rootWorkspaceId = \"root-111\";\r\n    const parentTaskId = \"task-222\";\r\n    const descendantTaskId = \"task-333\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              { path: path.join(projectPath, \"root\"), id: rootWorkspaceId, name: \"root\" },\r\n              {\r\n                path: path.join(projectPath, \"parent-task\"),\r\n                id: parentTaskId,\r\n                name: \"agent_exec_parent\",\r\n                parentWorkspaceId: rootWorkspaceId,\r\n                agentType: \"exec\",\r\n                taskStatus: \"awaiting_report\",\r\n              },\r\n              {\r\n                path: path.join(projectPath, \"child-task\"),\r\n                id: descendantTaskId,\r\n                name: \"agent_explore_child\",\r\n                parentWorkspaceId: parentTaskId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"running\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { workspaceService, sendMessage } = createWorkspaceServiceMocks();\r\n    const { taskService } = createTaskServiceHarness(config, { workspaceService });\r\n\r\n    const internal = taskService as unknown as {\r\n      handleStreamEnd: (event: StreamEndEvent) => Promise<void>;\r\n    };\r\n    await internal.handleStreamEnd({\r\n      type: \"stream-end\",\r\n      workspaceId: parentTaskId,\r\n      messageId: \"assistant-parent-task\",\r\n      metadata: { model: \"openai:gpt-4o-mini\" },\r\n      parts: [],\r\n    });\r\n\r\n    expect(sendMessage).not.toHaveBeenCalled();\r\n\r\n    const postCfg = config.loadConfigOrDefault();\r\n    const ws = Array.from(postCfg.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === parentTaskId);\r\n    expect(ws?.taskStatus).toBe(\"running\");\r\n  });\r\n\r\n  test(\"rolls back created workspace when initial sendMessage fails\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n    stubStableIds(config, [\"aaaaaaaaaa\"], \"aaaaaaaaaa\");\r\n\r\n    const projectPath = await createTestProject(rootDir);\r\n\r\n    const runtimeConfig = { type: \"worktree\" as const, srcBaseDir: config.srcDir };\r\n    const runtime = createRuntime(runtimeConfig, { projectPath });\r\n    const initLogger = createNullInitLogger();\r\n\r\n    const parentName = \"parent\";\r\n    const parentCreate = await runtime.createWorkspace({\r\n      projectPath,\r\n      branchName: parentName,\r\n      trunkBranch: \"main\",\r\n      directoryName: parentName,\r\n      initLogger,\r\n    });\r\n    expect(parentCreate.success).toBe(true);\r\n\r\n    const parentId = \"1111111111\";\r\n    const parentPath = runtime.getWorkspacePath(projectPath, parentName);\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: parentPath,\r\n                id: parentId,\r\n                name: parentName,\r\n                createdAt: new Date().toISOString(),\r\n                runtimeConfig,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n    });\r\n    const { aiService } = createAIServiceMocks(config);\r\n    const failingSendMessage = mock(() => Promise.resolve(Err(\"send failed\")));\r\n    const { workspaceService } = createWorkspaceServiceMocks({ sendMessage: failingSendMessage });\r\n    const { taskService } = createTaskServiceHarness(config, { aiService, workspaceService });\r\n\r\n    const created = await taskService.create({\r\n      parentWorkspaceId: parentId,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"do the thing\",\r\n      title: \"Test task\",\r\n    });\r\n\r\n    expect(created.success).toBe(false);\r\n\r\n    const postCfg = config.loadConfigOrDefault();\r\n    const stillExists = Array.from(postCfg.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .some((w) => w.id === \"aaaaaaaaaa\");\r\n    expect(stillExists).toBe(false);\r\n\r\n    const workspaceName = \"agent_explore_aaaaaaaaaa\";\r\n    const workspacePath = runtime.getWorkspacePath(projectPath, workspaceName);\r\n    let workspacePathExists = true;\r\n    try {\r\n      await fsPromises.access(workspacePath);\r\n    } catch {\r\n      workspacePathExists = false;\r\n    }\r\n    expect(workspacePathExists).toBe(false);\r\n  }, 20_000);\r\n\r\n  test(\"agent_report posts report to parent, finalizes pending task tool output, and triggers cleanup\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const parentId = \"parent-111\";\r\n    const childId = \"child-222\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              { path: path.join(projectPath, \"parent\"), id: parentId, name: \"parent\" },\r\n              {\r\n                path: path.join(projectPath, \"child\"),\r\n                id: childId,\r\n                name: \"agent_explore_child\",\r\n                parentWorkspaceId: parentId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"running\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { aiService, stopStream } = createAIServiceMocks(config);\r\n    const { workspaceService, sendMessage, remove, emit } = createWorkspaceServiceMocks();\r\n    const { historyService, partialService, taskService } = createTaskServiceHarness(config, {\r\n      aiService,\r\n      workspaceService,\r\n    });\r\n\r\n    const parentPartial = createMuxMessage(\r\n      \"assistant-parent-partial\",\r\n      \"assistant\",\r\n      \"Waiting on subagent\",\r\n      { timestamp: Date.now() },\r\n      [\r\n        {\r\n          type: \"dynamic-tool\",\r\n          toolCallId: \"task-call-1\",\r\n          toolName: \"task\",\r\n          input: { subagent_type: \"explore\", prompt: \"do the thing\", title: \"Test task\" },\r\n          state: \"input-available\",\r\n        },\r\n      ]\r\n    );\r\n    const writeParentPartial = await partialService.writePartial(parentId, parentPartial);\r\n    expect(writeParentPartial.success).toBe(true);\r\n\r\n    // Seed child history with the initial prompt + assistant placeholder so committing the final\r\n    // partial updates the existing assistant message (matching real streaming behavior).\r\n    const childPrompt = createMuxMessage(\"user-child-prompt\", \"user\", \"do the thing\", {\r\n      timestamp: Date.now(),\r\n    });\r\n    const appendChildPrompt = await historyService.appendToHistory(childId, childPrompt);\r\n    expect(appendChildPrompt.success).toBe(true);\r\n\r\n    const childAssistantPlaceholder = createMuxMessage(\"assistant-child-partial\", \"assistant\", \"\", {\r\n      timestamp: Date.now(),\r\n    });\r\n    const appendChildPlaceholder = await historyService.appendToHistory(\r\n      childId,\r\n      childAssistantPlaceholder\r\n    );\r\n    expect(appendChildPlaceholder.success).toBe(true);\r\n\r\n    const childHistorySequence = childAssistantPlaceholder.metadata?.historySequence;\r\n    if (typeof childHistorySequence !== \"number\") {\r\n      throw new Error(\"Expected child historySequence to be a number\");\r\n    }\r\n\r\n    const childPartial = createMuxMessage(\r\n      \"assistant-child-partial\",\r\n      \"assistant\",\r\n      \"\",\r\n      { timestamp: Date.now(), historySequence: childHistorySequence },\r\n      [\r\n        {\r\n          type: \"dynamic-tool\",\r\n          toolCallId: \"agent-report-call-1\",\r\n          toolName: \"agent_report\",\r\n          input: { reportMarkdown: \"Hello from child\", title: \"Result\" },\r\n          state: \"output-available\",\r\n          output: { success: true },\r\n        },\r\n      ]\r\n    );\r\n    const writeChildPartial = await partialService.writePartial(childId, childPartial);\r\n    expect(writeChildPartial.success).toBe(true);\r\n\r\n    const internal = taskService as unknown as {\r\n      handleAgentReport: (event: {\r\n        type: \"tool-call-end\";\r\n        workspaceId: string;\r\n        messageId: string;\r\n        toolCallId: string;\r\n        toolName: string;\r\n        result: unknown;\r\n        timestamp: number;\r\n      }) => Promise<void>;\r\n    };\r\n    await internal.handleAgentReport({\r\n      type: \"tool-call-end\",\r\n      workspaceId: childId,\r\n      messageId: \"assistant-child-partial\",\r\n      toolCallId: \"agent-report-call-1\",\r\n      toolName: \"agent_report\",\r\n      result: { success: true },\r\n      timestamp: Date.now(),\r\n    });\r\n\r\n    expect(stopStream).toHaveBeenCalledWith(\r\n      childId,\r\n      expect.objectContaining({ abandonPartial: false })\r\n    );\r\n\r\n    const childMessages = await collectFullHistory(historyService, childId);\r\n    // Ensure the in-flight assistant message (tool calls + agent_report) was committed to history\r\n    // before workspace cleanup archives the transcript.\r\n    expect(childMessages.length).toBeGreaterThan(1);\r\n\r\n    const assistantMsg = childMessages.find((m) => m.id === \"assistant-child-partial\") ?? null;\r\n    expect(assistantMsg).not.toBeNull();\r\n    if (assistantMsg) {\r\n      const toolPart = assistantMsg.parts.find(\r\n        (p) =>\r\n          p &&\r\n          typeof p === \"object\" &&\r\n          \"type\" in p &&\r\n          (p as { type?: unknown }).type === \"dynamic-tool\" &&\r\n          \"toolName\" in p &&\r\n          (p as { toolName?: unknown }).toolName === \"agent_report\"\r\n      ) as unknown as\r\n        | {\r\n            toolName: string;\r\n            state: string;\r\n            input?: unknown;\r\n          }\r\n        | undefined;\r\n\r\n      expect(toolPart?.toolName).toBe(\"agent_report\");\r\n      expect(toolPart?.state).toBe(\"output-available\");\r\n      expect(JSON.stringify(toolPart?.input)).toContain(\"Hello from child\");\r\n    }\r\n\r\n    const updatedChildPartial = await partialService.readPartial(childId);\r\n    expect(updatedChildPartial).toBeNull();\r\n\r\n    await collectFullHistory(historyService, parentId);\r\n\r\n    const updatedParentPartial = await partialService.readPartial(parentId);\r\n    expect(updatedParentPartial).not.toBeNull();\r\n    if (updatedParentPartial) {\r\n      const toolPart = updatedParentPartial.parts.find(\r\n        (p) =>\r\n          p &&\r\n          typeof p === \"object\" &&\r\n          \"type\" in p &&\r\n          (p as { type?: unknown }).type === \"dynamic-tool\"\r\n      ) as unknown as\r\n        | {\r\n            toolName: string;\r\n            state: string;\r\n            output?: unknown;\r\n          }\r\n        | undefined;\r\n      expect(toolPart?.toolName).toBe(\"task\");\r\n      expect(toolPart?.state).toBe(\"output-available\");\r\n      expect(toolPart?.output && typeof toolPart.output === \"object\").toBe(true);\r\n      expect(JSON.stringify(toolPart?.output)).toContain(\"Hello from child\");\r\n    }\r\n\r\n    const postCfg = config.loadConfigOrDefault();\r\n    const ws = Array.from(postCfg.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === childId);\r\n    expect(ws?.taskStatus).toBe(\"reported\");\r\n    expect(ws?.reportedAt).toBeTruthy();\r\n\r\n    expect(emit).toHaveBeenCalledWith(\r\n      \"metadata\",\r\n      expect.objectContaining({ workspaceId: childId })\r\n    );\r\n\r\n    expect(remove).toHaveBeenCalled();\r\n    expect(sendMessage).toHaveBeenCalledWith(\r\n      parentId,\r\n      expect.stringContaining(\"sub-agent task(s) have completed\"),\r\n      expect.any(Object),\r\n      expect.objectContaining({ skipAutoResumeReset: true, synthetic: true })\r\n    );\r\n    expect(emit).toHaveBeenCalled();\r\n  });\r\n\r\n  test(\"agent_report generates git format-patch artifact for exec tasks and defers cleanup\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const parentId = \"parent-111\";\r\n    const childId = \"child-222\";\r\n\r\n    const parentPath = path.join(projectPath, \"parent\");\r\n    const childPath = path.join(projectPath, \"child\");\r\n    await fsPromises.mkdir(parentPath, { recursive: true });\r\n    await fsPromises.mkdir(childPath, { recursive: true });\r\n\r\n    initGitRepo(childPath);\r\n    const baseCommitSha = execSync(\"git rev-parse HEAD\", {\r\n      cwd: childPath,\r\n      encoding: \"utf-8\",\r\n    }).trim();\r\n\r\n    execSync(\"bash -lc 'echo \\\"world\\\" >> README.md'\", { cwd: childPath, stdio: \"ignore\" });\r\n    execSync(\"git add README.md\", { cwd: childPath, stdio: \"ignore\" });\r\n    execSync('git commit -m \"child change\"', { cwd: childPath, stdio: \"ignore\" });\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: parentPath,\r\n                id: parentId,\r\n                name: \"parent\",\r\n                runtimeConfig: { type: \"local\" },\r\n              },\r\n              {\r\n                path: childPath,\r\n                id: childId,\r\n                name: \"agent_exec_child\",\r\n                parentWorkspaceId: parentId,\r\n                agentType: \"exec\",\r\n                agentId: \"exec\",\r\n                taskStatus: \"running\",\r\n                runtimeConfig: { type: \"local\" },\r\n                taskBaseCommitSha: baseCommitSha,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { aiService } = createAIServiceMocks(config);\r\n    const { workspaceService, remove } = createWorkspaceServiceMocks();\r\n    const { partialService, taskService } = createTaskServiceHarness(config, {\r\n      aiService,\r\n      workspaceService,\r\n    });\r\n\r\n    const parentPartial = createMuxMessage(\r\n      \"assistant-parent-partial\",\r\n      \"assistant\",\r\n      \"Waiting on subagent\",\r\n      { timestamp: Date.now() },\r\n      [\r\n        {\r\n          type: \"dynamic-tool\",\r\n          toolCallId: \"task-call-1\",\r\n          toolName: \"task\",\r\n          input: { subagent_type: \"exec\", prompt: \"do the thing\", title: \"Test task\" },\r\n          state: \"input-available\",\r\n        },\r\n      ]\r\n    );\r\n    const writeParentPartial = await partialService.writePartial(parentId, parentPartial);\r\n    expect(writeParentPartial.success).toBe(true);\r\n\r\n    const childPartial = createMuxMessage(\r\n      \"assistant-child-partial\",\r\n      \"assistant\",\r\n      \"\",\r\n      { timestamp: Date.now(), historySequence: 0 },\r\n      [\r\n        {\r\n          type: \"dynamic-tool\",\r\n          toolCallId: \"agent-report-call-1\",\r\n          toolName: \"agent_report\",\r\n          input: { reportMarkdown: \"Hello from child\", title: \"Result\" },\r\n          state: \"output-available\",\r\n          output: { success: true },\r\n        },\r\n      ]\r\n    );\r\n    const writeChildPartial = await partialService.writePartial(childId, childPartial);\r\n    expect(writeChildPartial.success).toBe(true);\r\n\r\n    const internal = taskService as unknown as {\r\n      handleAgentReport: (event: {\r\n        type: \"tool-call-end\";\r\n        workspaceId: string;\r\n        messageId: string;\r\n        toolCallId: string;\r\n        toolName: string;\r\n        result: unknown;\r\n        timestamp: number;\r\n      }) => Promise<void>;\r\n    };\r\n\r\n    const parentSessionDir = config.getSessionDir(parentId);\r\n    const patchPath = getSubagentGitPatchMboxPath(parentSessionDir, childId);\r\n\r\n    const waiter = taskService.waitForAgentReport(childId, {\r\n      timeoutMs: 10_000,\r\n      requestingWorkspaceId: parentId,\r\n    });\r\n\r\n    const handleReportPromise = internal.handleAgentReport({\r\n      type: \"tool-call-end\",\r\n      workspaceId: childId,\r\n      messageId: \"assistant-child-partial\",\r\n      toolCallId: \"agent-report-call-1\",\r\n      toolName: \"agent_report\",\r\n      result: { success: true },\r\n      timestamp: Date.now(),\r\n    });\r\n\r\n    const report = await waiter;\r\n    expect(report).toEqual({ reportMarkdown: \"Hello from child\", title: \"Result\" });\r\n\r\n    const artifactAfterWait = await readSubagentGitPatchArtifact(parentSessionDir, childId);\r\n    expect(artifactAfterWait).not.toBeNull();\r\n    expect([\"pending\", \"ready\"]).toContain(artifactAfterWait!.status);\r\n\r\n    await handleReportPromise;\r\n\r\n    // Cleanup should be deferred until git-format-patch generation completes.\r\n    expect(remove).not.toHaveBeenCalled();\r\n\r\n    const start = Date.now();\r\n    let lastArtifact: unknown = null;\r\n    while (true) {\r\n      const artifact = await readSubagentGitPatchArtifact(parentSessionDir, childId);\r\n      lastArtifact = artifact;\r\n\r\n      if (artifact?.status === \"ready\") {\r\n        try {\r\n          await fsPromises.stat(patchPath);\r\n          if (remove.mock.calls.length > 0) {\r\n            break;\r\n          }\r\n        } catch {\r\n          // Keep polling until the patch file exists.\r\n        }\r\n      } else if (artifact?.status === \"failed\" || artifact?.status === \"skipped\") {\r\n        throw new Error(\r\n          `Patch artifact generation failed with status=${artifact.status}: ${artifact.error ?? \"unknown error\"}`\r\n        );\r\n      }\r\n\r\n      if (Date.now() - start > 10_000) {\r\n        throw new Error(\r\n          `Timed out waiting for patch artifact generation (removeCalled=${remove.mock.calls.length > 0}, lastArtifact=${JSON.stringify(lastArtifact)})`\r\n        );\r\n      }\r\n\r\n      await new Promise((r) => setTimeout(r, 50));\r\n    }\r\n\r\n    const artifact = await readSubagentGitPatchArtifact(parentSessionDir, childId);\r\n    expect(artifact?.status).toBe(\"ready\");\r\n\r\n    await fsPromises.stat(patchPath);\r\n    expect(remove).toHaveBeenCalled();\r\n  }, 20_000);\r\n\r\n  test(\"agent_report generates git format-patch artifact for exec-derived custom tasks\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const parentId = \"parent-111\";\r\n    const childId = \"child-222\";\r\n\r\n    const parentPath = path.join(projectPath, \"parent\");\r\n    const childPath = path.join(projectPath, \"child\");\r\n    await fsPromises.mkdir(parentPath, { recursive: true });\r\n    await fsPromises.mkdir(childPath, { recursive: true });\r\n\r\n    // Custom agent definition stored in the parent workspace (.mux/agents).\r\n    const agentsDir = path.join(parentPath, \".mux\", \"agents\");\r\n    await fsPromises.mkdir(agentsDir, { recursive: true });\r\n    await fsPromises.writeFile(\r\n      path.join(agentsDir, \"test-file.md\"),\r\n      `---\\nname: Test File\\ndescription: Exec-derived custom agent for tests\\nbase: exec\\nsubagent:\\n  runnable: true\\n---\\n\\nTest agent body.\\n`,\r\n      \"utf-8\"\r\n    );\r\n\r\n    initGitRepo(childPath);\r\n    const baseCommitSha = execSync(\"git rev-parse HEAD\", {\r\n      cwd: childPath,\r\n      encoding: \"utf-8\",\r\n    }).trim();\r\n\r\n    execSync(\"bash -lc 'echo \\\\\\\"world\\\\\\\" >> README.md'\", { cwd: childPath, stdio: \"ignore\" });\r\n    execSync(\"git add README.md\", { cwd: childPath, stdio: \"ignore\" });\r\n    execSync('git commit -m \"child change\"', { cwd: childPath, stdio: \"ignore\" });\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: parentPath,\r\n                id: parentId,\r\n                name: \"parent\",\r\n                runtimeConfig: { type: \"local\" },\r\n              },\r\n              {\r\n                path: childPath,\r\n                id: childId,\r\n                name: \"agent_test_file_child\",\r\n                parentWorkspaceId: parentId,\r\n                agentType: \"test-file\",\r\n                agentId: \"test-file\",\r\n                taskStatus: \"running\",\r\n                runtimeConfig: { type: \"local\" },\r\n                taskBaseCommitSha: baseCommitSha,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { aiService } = createAIServiceMocks(config);\r\n    const { workspaceService, remove } = createWorkspaceServiceMocks();\r\n    const { partialService, taskService } = createTaskServiceHarness(config, {\r\n      aiService,\r\n      workspaceService,\r\n    });\r\n\r\n    const parentPartial = createMuxMessage(\r\n      \"assistant-parent-partial\",\r\n      \"assistant\",\r\n      \"Waiting on subagent\",\r\n      { timestamp: Date.now() },\r\n      [\r\n        {\r\n          type: \"dynamic-tool\",\r\n          toolCallId: \"task-call-1\",\r\n          toolName: \"task\",\r\n          input: { subagent_type: \"test-file\", prompt: \"do the thing\", title: \"Test task\" },\r\n          state: \"input-available\",\r\n        },\r\n      ]\r\n    );\r\n    const writeParentPartial = await partialService.writePartial(parentId, parentPartial);\r\n    expect(writeParentPartial.success).toBe(true);\r\n\r\n    const childPartial = createMuxMessage(\r\n      \"assistant-child-partial\",\r\n      \"assistant\",\r\n      \"\",\r\n      { timestamp: Date.now(), historySequence: 0 },\r\n      [\r\n        {\r\n          type: \"dynamic-tool\",\r\n          toolCallId: \"agent-report-call-1\",\r\n          toolName: \"agent_report\",\r\n          input: { reportMarkdown: \"Hello from child\", title: \"Result\" },\r\n          state: \"output-available\",\r\n          output: { success: true },\r\n        },\r\n      ]\r\n    );\r\n    const writeChildPartial = await partialService.writePartial(childId, childPartial);\r\n    expect(writeChildPartial.success).toBe(true);\r\n\r\n    const internal = taskService as unknown as {\r\n      handleAgentReport: (event: {\r\n        type: \"tool-call-end\";\r\n        workspaceId: string;\r\n        messageId: string;\r\n        toolCallId: string;\r\n        toolName: string;\r\n        result: unknown;\r\n        timestamp: number;\r\n      }) => Promise<void>;\r\n    };\r\n\r\n    const parentSessionDir = config.getSessionDir(parentId);\r\n    const patchPath = getSubagentGitPatchMboxPath(parentSessionDir, childId);\r\n\r\n    const waiter = taskService.waitForAgentReport(childId, {\r\n      timeoutMs: 10_000,\r\n      requestingWorkspaceId: parentId,\r\n    });\r\n\r\n    const handleReportPromise = internal.handleAgentReport({\r\n      type: \"tool-call-end\",\r\n      workspaceId: childId,\r\n      messageId: \"assistant-child-partial\",\r\n      toolCallId: \"agent-report-call-1\",\r\n      toolName: \"agent_report\",\r\n      result: { success: true },\r\n      timestamp: Date.now(),\r\n    });\r\n\r\n    const report = await waiter;\r\n    expect(report).toEqual({ reportMarkdown: \"Hello from child\", title: \"Result\" });\r\n\r\n    const artifactAfterWait = await readSubagentGitPatchArtifact(parentSessionDir, childId);\r\n    expect(artifactAfterWait).not.toBeNull();\r\n    expect([\"pending\", \"ready\"]).toContain(artifactAfterWait!.status);\r\n\r\n    await handleReportPromise;\r\n\r\n    // Cleanup should be deferred until git-format-patch generation completes.\r\n    expect(remove).not.toHaveBeenCalled();\r\n\r\n    const start = Date.now();\r\n    let lastArtifact: unknown = null;\r\n    while (true) {\r\n      const artifact = await readSubagentGitPatchArtifact(parentSessionDir, childId);\r\n      lastArtifact = artifact;\r\n\r\n      if (artifact?.status === \"ready\") {\r\n        try {\r\n          await fsPromises.stat(patchPath);\r\n          if (remove.mock.calls.length > 0) {\r\n            break;\r\n          }\r\n        } catch {\r\n          // Keep polling until the patch file exists.\r\n        }\r\n      } else if (artifact?.status === \"failed\" || artifact?.status === \"skipped\") {\r\n        throw new Error(\r\n          `Patch artifact generation failed with status=${artifact.status}: ${artifact.error ?? \"unknown error\"}`\r\n        );\r\n      }\r\n\r\n      if (Date.now() - start > 10_000) {\r\n        throw new Error(\r\n          `Timed out waiting for patch artifact generation (removeCalled=${remove.mock.calls.length > 0}, lastArtifact=${JSON.stringify(lastArtifact)})`\r\n        );\r\n      }\r\n\r\n      await new Promise((r) => setTimeout(r, 50));\r\n    }\r\n\r\n    const artifact = await readSubagentGitPatchArtifact(parentSessionDir, childId);\r\n    expect(artifact?.status).toBe(\"ready\");\r\n\r\n    await fsPromises.stat(patchPath);\r\n    expect(remove).toHaveBeenCalled();\r\n  }, 20_000);\r\n  test(\"agent_report updates queued/running task tool output in parent history\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const parentId = \"parent-111\";\r\n    const childId = \"child-222\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              { path: path.join(projectPath, \"parent\"), id: parentId, name: \"parent\" },\r\n              {\r\n                path: path.join(projectPath, \"child\"),\r\n                id: childId,\r\n                name: \"agent_explore_child\",\r\n                parentWorkspaceId: parentId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"running\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { aiService } = createAIServiceMocks(config);\r\n    const {\r\n      workspaceService,\r\n      sendMessage: sendMessageMock,\r\n      remove,\r\n    } = createWorkspaceServiceMocks();\r\n    const { historyService, partialService, taskService } = createTaskServiceHarness(config, {\r\n      aiService,\r\n      workspaceService,\r\n    });\r\n\r\n    const parentHistoryMessage = createMuxMessage(\r\n      \"assistant-parent-history\",\r\n      \"assistant\",\r\n      \"Spawned subagent\",\r\n      { timestamp: Date.now() },\r\n      [\r\n        {\r\n          type: \"dynamic-tool\",\r\n          toolCallId: \"task-call-1\",\r\n          toolName: \"task\",\r\n          input: { subagent_type: \"explore\", prompt: \"do the thing\", run_in_background: true },\r\n          state: \"output-available\",\r\n          output: { status: \"running\", taskId: childId },\r\n        },\r\n      ]\r\n    );\r\n    const appendParentHistory = await historyService.appendToHistory(\r\n      parentId,\r\n      parentHistoryMessage\r\n    );\r\n    expect(appendParentHistory.success).toBe(true);\r\n\r\n    const childPartial = createMuxMessage(\r\n      \"assistant-child-partial\",\r\n      \"assistant\",\r\n      \"\",\r\n      { timestamp: Date.now(), historySequence: 0 },\r\n      [\r\n        {\r\n          type: \"dynamic-tool\",\r\n          toolCallId: \"agent-report-call-1\",\r\n          toolName: \"agent_report\",\r\n          input: { reportMarkdown: \"Hello from child\", title: \"Result\" },\r\n          state: \"output-available\",\r\n          output: { success: true },\r\n        },\r\n      ]\r\n    );\r\n    const writeChildPartial = await partialService.writePartial(childId, childPartial);\r\n    expect(writeChildPartial.success).toBe(true);\r\n\r\n    const internal = taskService as unknown as {\r\n      handleAgentReport: (event: {\r\n        type: \"tool-call-end\";\r\n        workspaceId: string;\r\n        messageId: string;\r\n        toolCallId: string;\r\n        toolName: string;\r\n        result: unknown;\r\n        timestamp: number;\r\n      }) => Promise<void>;\r\n    };\r\n    await internal.handleAgentReport({\r\n      type: \"tool-call-end\",\r\n      workspaceId: childId,\r\n      messageId: \"assistant-child-partial\",\r\n      toolCallId: \"agent-report-call-1\",\r\n      toolName: \"agent_report\",\r\n      result: { success: true },\r\n      timestamp: Date.now(),\r\n    });\r\n\r\n    const parentMessages = await collectFullHistory(historyService, parentId);\r\n    // Original task tool call remains immutable (\"running\"), and a synthetic report message is appended.\r\n    expect(parentMessages.length).toBeGreaterThanOrEqual(2);\r\n\r\n    const taskCallMessage = parentMessages.find((m) => m.id === \"assistant-parent-history\") ?? null;\r\n    expect(taskCallMessage).not.toBeNull();\r\n    if (taskCallMessage) {\r\n      const toolPart = taskCallMessage.parts.find(\r\n        (p) =>\r\n          p &&\r\n          typeof p === \"object\" &&\r\n          \"type\" in p &&\r\n          (p as { type?: unknown }).type === \"dynamic-tool\"\r\n      ) as unknown as { output?: unknown } | undefined;\r\n      expect(JSON.stringify(toolPart?.output)).toContain('\"status\":\"running\"');\r\n      expect(JSON.stringify(toolPart?.output)).toContain(childId);\r\n    }\r\n\r\n    const syntheticReport = parentMessages.find((m) => m.metadata?.synthetic) ?? null;\r\n    expect(syntheticReport).not.toBeNull();\r\n    if (syntheticReport) {\r\n      expect(syntheticReport.role).toBe(\"user\");\r\n      const text = syntheticReport.parts\r\n        .filter((p) => p.type === \"text\")\r\n        .map((p) => p.text)\r\n        .join(\"\");\r\n      expect(text).toContain(\"Hello from child\");\r\n      expect(text).toContain(childId);\r\n    }\r\n\r\n    expect(remove).toHaveBeenCalled();\r\n    expect(sendMessageMock).toHaveBeenCalledWith(\r\n      parentId,\r\n      expect.stringContaining(\"sub-agent task(s) have completed\"),\r\n      expect.any(Object),\r\n      expect.objectContaining({ skipAutoResumeReset: true, synthetic: true })\r\n    );\r\n  });\r\n\r\n  test(\"uses agent_report from stream-end parts instead of fallback\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const parentId = \"parent-111\";\r\n    const childId = \"child-222\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              { path: path.join(projectPath, \"parent\"), id: parentId, name: \"parent\" },\r\n              {\r\n                path: path.join(projectPath, \"child\"),\r\n                id: childId,\r\n                name: \"agent_explore_child\",\r\n                parentWorkspaceId: parentId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"awaiting_report\",\r\n                taskModelString: \"openai:gpt-4o-mini\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { aiService } = createAIServiceMocks(config);\r\n    const { workspaceService, sendMessage, remove } = createWorkspaceServiceMocks();\r\n    const { partialService, taskService } = createTaskServiceHarness(config, {\r\n      aiService,\r\n      workspaceService,\r\n    });\r\n\r\n    // Simulate the \"second attempt\" state (the task was already reminded).\r\n    (taskService as unknown as { remindedAwaitingReport: Set<string> }).remindedAwaitingReport.add(\r\n      childId\r\n    );\r\n\r\n    const parentPartial = createMuxMessage(\r\n      \"assistant-parent-partial\",\r\n      \"assistant\",\r\n      \"Waiting on subagent\",\r\n      { timestamp: Date.now() },\r\n      [\r\n        {\r\n          type: \"dynamic-tool\",\r\n          toolCallId: \"task-call-1\",\r\n          toolName: \"task\",\r\n          input: { subagent_type: \"explore\", prompt: \"do the thing\", title: \"Test task\" },\r\n          state: \"input-available\",\r\n        },\r\n      ]\r\n    );\r\n    const writeParentPartial = await partialService.writePartial(parentId, parentPartial);\r\n    expect(writeParentPartial.success).toBe(true);\r\n\r\n    const internal = taskService as unknown as {\r\n      handleStreamEnd: (event: unknown) => Promise<void>;\r\n    };\r\n\r\n    await internal.handleStreamEnd({\r\n      type: \"stream-end\",\r\n      workspaceId: childId,\r\n      messageId: \"assistant-child-output\",\r\n      metadata: { model: \"openai:gpt-4o-mini\" },\r\n      parts: [\r\n        {\r\n          type: \"dynamic-tool\",\r\n          toolCallId: \"agent-report-call-1\",\r\n          toolName: \"agent_report\",\r\n          input: { reportMarkdown: \"Hello from child\", title: \"Result\" },\r\n          state: \"output-available\",\r\n          output: { success: true },\r\n        },\r\n      ],\r\n    });\r\n\r\n    // No \"agent_report reminder\" sendMessage should fire (the report was in stream-end parts).\r\n    // The only sendMessage call should be the parent auto-resume after the child reports.\r\n    const sendCalls = (sendMessage as unknown as { mock: { calls: unknown[][] } }).mock.calls;\r\n    for (const call of sendCalls) {\r\n      const msg = call[1] as string;\r\n      expect(msg).not.toContain(\"agent_report\");\r\n    }\r\n\r\n    const updatedParentPartial = await partialService.readPartial(parentId);\r\n    expect(updatedParentPartial).not.toBeNull();\r\n    if (updatedParentPartial) {\r\n      const toolPart = updatedParentPartial.parts.find(\r\n        (p) =>\r\n          p &&\r\n          typeof p === \"object\" &&\r\n          \"type\" in p &&\r\n          (p as { type?: unknown }).type === \"dynamic-tool\"\r\n      ) as unknown as\r\n        | {\r\n            toolName: string;\r\n            state: string;\r\n            output?: unknown;\r\n          }\r\n        | undefined;\r\n      expect(toolPart?.toolName).toBe(\"task\");\r\n      expect(toolPart?.state).toBe(\"output-available\");\r\n      const outputJson = JSON.stringify(toolPart?.output);\r\n      expect(outputJson).toContain(\"Hello from child\");\r\n      expect(outputJson).toContain(\"Result\");\r\n      expect(outputJson).not.toContain(\"fallback\");\r\n    }\r\n\r\n    const postCfg = config.loadConfigOrDefault();\r\n    const ws = Array.from(postCfg.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === childId);\r\n    expect(ws?.taskStatus).toBe(\"reported\");\r\n\r\n    expect(remove).toHaveBeenCalled();\r\n    // sendMessage is called once for the \"ended without agent_report\" reminder\r\n    // and NOT for resumeStream (since \"second attempt\" was already simulated).\r\n    // The parent auto-resume sendMessage also fires since no active descendants remain.\r\n    expect(sendMessage).toHaveBeenCalled();\r\n  });\r\n\r\n  test(\"missing agent_report triggers one reminder, then posts fallback output and cleans up\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n\r\n    const projectPath = path.join(rootDir, \"repo\");\r\n    const parentId = \"parent-111\";\r\n    const childId = \"child-222\";\r\n\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              { path: path.join(projectPath, \"parent\"), id: parentId, name: \"parent\" },\r\n              {\r\n                path: path.join(projectPath, \"child\"),\r\n                id: childId,\r\n                name: \"agent_explore_child\",\r\n                parentWorkspaceId: parentId,\r\n                agentType: \"explore\",\r\n                taskStatus: \"running\",\r\n                taskModelString: \"openai:gpt-4o-mini\",\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n    });\r\n\r\n    const { aiService } = createAIServiceMocks(config);\r\n    const { workspaceService, sendMessage, remove, emit } = createWorkspaceServiceMocks();\r\n    const { historyService, partialService, taskService } = createTaskServiceHarness(config, {\r\n      aiService,\r\n      workspaceService,\r\n    });\r\n\r\n    const parentPartial = createMuxMessage(\r\n      \"assistant-parent-partial\",\r\n      \"assistant\",\r\n      \"Waiting on subagent\",\r\n      { timestamp: Date.now() },\r\n      [\r\n        {\r\n          type: \"dynamic-tool\",\r\n          toolCallId: \"task-call-1\",\r\n          toolName: \"task\",\r\n          input: { subagent_type: \"explore\", prompt: \"do the thing\", title: \"Test task\" },\r\n          state: \"input-available\",\r\n        },\r\n      ]\r\n    );\r\n    const writeParentPartial = await partialService.writePartial(parentId, parentPartial);\r\n    expect(writeParentPartial.success).toBe(true);\r\n\r\n    const assistantOutput = createMuxMessage(\r\n      \"assistant-child-output\",\r\n      \"assistant\",\r\n      \"Final output without agent_report\",\r\n      { timestamp: Date.now() }\r\n    );\r\n    const appendChildHistory = await historyService.appendToHistory(childId, assistantOutput);\r\n    expect(appendChildHistory.success).toBe(true);\r\n\r\n    const internal = taskService as unknown as {\r\n      handleStreamEnd: (event: StreamEndEvent) => Promise<void>;\r\n    };\r\n\r\n    await internal.handleStreamEnd({\r\n      type: \"stream-end\",\r\n      workspaceId: childId,\r\n      messageId: \"assistant-child-output\",\r\n      metadata: { model: \"openai:gpt-4o-mini\" },\r\n      parts: [],\r\n    });\r\n    expect(sendMessage).toHaveBeenCalled();\r\n\r\n    const midCfg = config.loadConfigOrDefault();\r\n    const midWs = Array.from(midCfg.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === childId);\r\n    expect(midWs?.taskStatus).toBe(\"awaiting_report\");\r\n\r\n    await internal.handleStreamEnd({\r\n      type: \"stream-end\",\r\n      workspaceId: childId,\r\n      messageId: \"assistant-child-output\",\r\n      metadata: { model: \"openai:gpt-4o-mini\" },\r\n      parts: [],\r\n    });\r\n\r\n    const emitCalls = (emit as unknown as { mock: { calls: Array<[string, unknown]> } }).mock.calls;\r\n    const metadataEmitsForChild = emitCalls.filter((call) => {\r\n      const [eventName, payload] = call;\r\n      if (eventName !== \"metadata\") return false;\r\n      if (!payload || typeof payload !== \"object\") return false;\r\n      const maybePayload = payload as { workspaceId?: unknown };\r\n      return maybePayload.workspaceId === childId;\r\n    });\r\n    expect(metadataEmitsForChild).toHaveLength(2);\r\n\r\n    await collectFullHistory(historyService, parentId);\r\n\r\n    const updatedParentPartial = await partialService.readPartial(parentId);\r\n    expect(updatedParentPartial).not.toBeNull();\r\n    if (updatedParentPartial) {\r\n      const toolPart = updatedParentPartial.parts.find(\r\n        (p) =>\r\n          p &&\r\n          typeof p === \"object\" &&\r\n          \"type\" in p &&\r\n          (p as { type?: unknown }).type === \"dynamic-tool\"\r\n      ) as unknown as\r\n        | {\r\n            toolName: string;\r\n            state: string;\r\n            output?: unknown;\r\n          }\r\n        | undefined;\r\n      expect(toolPart?.toolName).toBe(\"task\");\r\n      expect(toolPart?.state).toBe(\"output-available\");\r\n      expect(JSON.stringify(toolPart?.output)).toContain(\"Final output without agent_report\");\r\n      expect(JSON.stringify(toolPart?.output)).toContain(\"fallback\");\r\n    }\r\n\r\n    const postCfg = config.loadConfigOrDefault();\r\n    const ws = Array.from(postCfg.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === childId);\r\n    expect(ws?.taskStatus).toBe(\"reported\");\r\n\r\n    expect(remove).toHaveBeenCalled();\r\n    // Parent auto-resume now uses sendMessage instead of resumeStream\r\n    expect(sendMessage).toHaveBeenCalledWith(\r\n      parentId,\r\n      expect.stringContaining(\"sub-agent task(s) have completed\"),\r\n      expect.any(Object),\r\n      expect.objectContaining({ skipAutoResumeReset: true, synthetic: true })\r\n    );\r\n  });\r\n\r\n  test(\"falls back to default trunk when parent branch does not exist locally\", async () => {\r\n    const config = await createTestConfig(rootDir);\r\n    stubStableIds(config, [\"aaaaaaaaaa\"], \"bbbbbbbbbb\");\r\n\r\n    const projectPath = await createTestProject(rootDir);\r\n\r\n    const runtimeConfig = { type: \"worktree\" as const, srcBaseDir: config.srcDir };\r\n    const runtime = createRuntime(runtimeConfig, { projectPath });\r\n\r\n    const initLogger = createNullInitLogger();\r\n\r\n    // Create a worktree for the parent on main\r\n    const parentName = \"parent\";\r\n    const parentCreate = await runtime.createWorkspace({\r\n      projectPath,\r\n      branchName: parentName,\r\n      trunkBranch: \"main\",\r\n      directoryName: parentName,\r\n      initLogger,\r\n    });\r\n    expect(parentCreate.success).toBe(true);\r\n\r\n    const parentId = \"1111111111\";\r\n    const parentPath = runtime.getWorkspacePath(projectPath, parentName);\r\n\r\n    // Register parent with a name that does NOT exist as a local branch.\r\n    // This simulates the case where parent workspace name (e.g., from SSH)\r\n    // doesn't correspond to a local branch in the project repository.\r\n    const nonExistentBranchName = \"non-existent-branch-xyz\";\r\n    await config.saveConfig({\r\n      projects: new Map([\r\n        [\r\n          projectPath,\r\n          {\r\n            workspaces: [\r\n              {\r\n                path: parentPath,\r\n                id: parentId,\r\n                name: nonExistentBranchName, // This branch doesn't exist locally\r\n                createdAt: new Date().toISOString(),\r\n                runtimeConfig,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      ]),\r\n      taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n    });\r\n    const { taskService } = createTaskServiceHarness(config);\r\n\r\n    // Creating a task should succeed by falling back to \"main\" as trunkBranch\r\n    // instead of failing with \"fatal: 'non-existent-branch-xyz' is not a commit\"\r\n    const created = await taskService.create({\r\n      parentWorkspaceId: parentId,\r\n      kind: \"agent\",\r\n      agentType: \"explore\",\r\n      prompt: \"explore this repo\",\r\n      title: \"Test task\",\r\n    });\r\n    expect(created.success).toBe(true);\r\n    if (!created.success) return;\r\n\r\n    // Verify the child workspace was created\r\n    const postCfg = config.loadConfigOrDefault();\r\n    const childEntry = Array.from(postCfg.projects.values())\r\n      .flatMap((p) => p.workspaces)\r\n      .find((w) => w.id === created.data.taskId);\r\n    expect(childEntry).toBeTruthy();\r\n    expect(childEntry?.runtimeConfig?.type).toBe(\"worktree\");\r\n  }, 20_000);\r\n\r\n  describe(\"parent auto-resume flood protection\", () => {\r\n    async function setupParentWithActiveChild(rootDirPath: string) {\r\n      const config = await createTestConfig(rootDirPath);\r\n      const projectPath = path.join(rootDirPath, \"repo\");\r\n      await fsPromises.mkdir(projectPath, { recursive: true });\r\n\r\n      const rootWorkspaceId = \"root-resume-111\";\r\n      const childTaskId = \"child-resume-222\";\r\n\r\n      await config.saveConfig({\r\n        projects: new Map([\r\n          [\r\n            projectPath,\r\n            {\r\n              workspaces: [\r\n                {\r\n                  path: path.join(projectPath, \"root\"),\r\n                  id: rootWorkspaceId,\r\n                  name: \"root\",\r\n                  aiSettings: { model: \"openai:gpt-5.2\", thinkingLevel: \"medium\" as const },\r\n                },\r\n                {\r\n                  path: path.join(projectPath, \"child-task\"),\r\n                  id: childTaskId,\r\n                  name: \"child-task\",\r\n                  parentWorkspaceId: rootWorkspaceId,\r\n                  agentType: \"explore\",\r\n                  taskStatus: \"running\" as const,\r\n                  taskModelString: \"openai:gpt-5.2\",\r\n                },\r\n              ],\r\n            },\r\n          ],\r\n        ]),\r\n        taskSettings: { maxParallelAgentTasks: 3, maxTaskNestingDepth: 3 },\r\n      });\r\n\r\n      const { aiService } = createAIServiceMocks(config);\r\n      const { workspaceService, sendMessage } = createWorkspaceServiceMocks();\r\n      const { taskService } = createTaskServiceHarness(config, {\r\n        aiService,\r\n        workspaceService,\r\n      });\r\n\r\n      const internal = taskService as unknown as {\r\n        handleStreamEnd: (event: StreamEndEvent) => Promise<void>;\r\n      };\r\n\r\n      const makeStreamEndEvent = (): StreamEndEvent => ({\r\n        type: \"stream-end\",\r\n        workspaceId: rootWorkspaceId,\r\n        messageId: `assistant-${Date.now()}`,\r\n        metadata: { model: \"openai:gpt-5.2\" },\r\n        parts: [],\r\n      });\r\n\r\n      return {\r\n        config,\r\n        taskService,\r\n        internal,\r\n        sendMessage,\r\n        rootWorkspaceId,\r\n        childTaskId,\r\n        projectPath,\r\n        makeStreamEndEvent,\r\n      };\r\n    }\r\n\r\n    test(\"stops auto-resuming after MAX_CONSECUTIVE_PARENT_AUTO_RESUMES (3)\", async () => {\r\n      const { internal, sendMessage, makeStreamEndEvent } =\r\n        await setupParentWithActiveChild(rootDir);\r\n\r\n      // First 3 calls should trigger sendMessage (limit is 3)\r\n      for (let i = 0; i < 3; i++) {\r\n        await internal.handleStreamEnd(makeStreamEndEvent());\r\n      }\r\n      expect(sendMessage).toHaveBeenCalledTimes(3);\r\n\r\n      // 4th call should NOT trigger sendMessage (limit exceeded)\r\n      await internal.handleStreamEnd(makeStreamEndEvent());\r\n      expect(sendMessage).toHaveBeenCalledTimes(3); // still 3\r\n    });\r\n\r\n    test(\"resetAutoResumeCount allows more resumes after limit\", async () => {\r\n      const { internal, sendMessage, taskService, rootWorkspaceId, makeStreamEndEvent } =\r\n        await setupParentWithActiveChild(rootDir);\r\n\r\n      // Exhaust the auto-resume limit\r\n      for (let i = 0; i < 3; i++) {\r\n        await internal.handleStreamEnd(makeStreamEndEvent());\r\n      }\r\n      expect(sendMessage).toHaveBeenCalledTimes(3);\r\n\r\n      // Blocked (limit reached)\r\n      await internal.handleStreamEnd(makeStreamEndEvent());\r\n      expect(sendMessage).toHaveBeenCalledTimes(3);\r\n\r\n      // User sends a message  resets the counter\r\n      taskService.resetAutoResumeCount(rootWorkspaceId);\r\n\r\n      // Now auto-resume should work again\r\n      await internal.handleStreamEnd(makeStreamEndEvent());\r\n      expect(sendMessage).toHaveBeenCalledTimes(4);\r\n    });\r\n\r\n    test(\"counter is per-workspace (different workspaces are independent)\", async () => {\r\n      const config = await createTestConfig(rootDir);\r\n      const projectPath = path.join(rootDir, \"repo\");\r\n      await fsPromises.mkdir(projectPath, { recursive: true });\r\n\r\n      const rootA = \"root-A\";\r\n      const rootB = \"root-B\";\r\n      const childA = \"child-A\";\r\n      const childB = \"child-B\";\r\n\r\n      await config.saveConfig({\r\n        projects: new Map([\r\n          [\r\n            projectPath,\r\n            {\r\n              workspaces: [\r\n                {\r\n                  path: path.join(projectPath, \"root-a\"),\r\n                  id: rootA,\r\n                  name: \"root-a\",\r\n                  aiSettings: { model: \"openai:gpt-5.2\", thinkingLevel: \"medium\" as const },\r\n                },\r\n                {\r\n                  path: path.join(projectPath, \"child-a\"),\r\n                  id: childA,\r\n                  name: \"child-a\",\r\n                  parentWorkspaceId: rootA,\r\n                  taskStatus: \"running\" as const,\r\n                  taskModelString: \"openai:gpt-5.2\",\r\n                },\r\n                {\r\n                  path: path.join(projectPath, \"root-b\"),\r\n                  id: rootB,\r\n                  name: \"root-b\",\r\n                  aiSettings: { model: \"openai:gpt-5.2\", thinkingLevel: \"medium\" as const },\r\n                },\r\n                {\r\n                  path: path.join(projectPath, \"child-b\"),\r\n                  id: childB,\r\n                  name: \"child-b\",\r\n                  parentWorkspaceId: rootB,\r\n                  taskStatus: \"running\" as const,\r\n                  taskModelString: \"openai:gpt-5.2\",\r\n                },\r\n              ],\r\n            },\r\n          ],\r\n        ]),\r\n        taskSettings: { maxParallelAgentTasks: 5, maxTaskNestingDepth: 3 },\r\n      });\r\n\r\n      const { aiService } = createAIServiceMocks(config);\r\n      const { workspaceService, sendMessage } = createWorkspaceServiceMocks();\r\n      const { taskService } = createTaskServiceHarness(config, {\r\n        aiService,\r\n        workspaceService,\r\n      });\r\n\r\n      const internal = taskService as unknown as {\r\n        handleStreamEnd: (event: StreamEndEvent) => Promise<void>;\r\n      };\r\n\r\n      // Exhaust limit on workspace A\r\n      for (let i = 0; i < 3; i++) {\r\n        await internal.handleStreamEnd({\r\n          type: \"stream-end\",\r\n          workspaceId: rootA,\r\n          messageId: `a-${i}`,\r\n          metadata: { model: \"openai:gpt-5.2\" },\r\n          parts: [],\r\n        });\r\n      }\r\n      expect(sendMessage).toHaveBeenCalledTimes(3);\r\n\r\n      // Workspace A is now blocked\r\n      await internal.handleStreamEnd({\r\n        type: \"stream-end\",\r\n        workspaceId: rootA,\r\n        messageId: \"a-blocked\",\r\n        metadata: { model: \"openai:gpt-5.2\" },\r\n        parts: [],\r\n      });\r\n      expect(sendMessage).toHaveBeenCalledTimes(3); // still 3\r\n\r\n      // Workspace B should still work (independent counter)\r\n      await internal.handleStreamEnd({\r\n        type: \"stream-end\",\r\n        workspaceId: rootB,\r\n        messageId: \"b-0\",\r\n        metadata: { model: \"openai:gpt-5.2\" },\r\n        parts: [],\r\n      });\r\n      expect(sendMessage).toHaveBeenCalledTimes(4); // B worked\r\n    });\r\n  });\r\n});\r\n"]}