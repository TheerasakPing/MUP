{"version":3,"file":"ExtensionMetadataService.test.js","sourceRoot":"","sources":["../../../src/node/services/ExtensionMetadataService.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, test, beforeEach, afterEach } from \"bun:test\";\nimport { mkdtemp, rm } from \"fs/promises\";\nimport { tmpdir } from \"os\";\nimport * as path from \"path\";\nimport { ExtensionMetadataService } from \"./ExtensionMetadataService\";\n\nconst PREFIX = \"mux-extension-metadata-test-\";\n\ndescribe(\"ExtensionMetadataService\", () => {\n  let tempDir: string;\n  let filePath: string;\n  let service: ExtensionMetadataService;\n\n  beforeEach(async () => {\n    tempDir = await mkdtemp(path.join(tmpdir(), PREFIX));\n    filePath = path.join(tempDir, \"extensionMetadata.json\");\n    service = new ExtensionMetadataService(filePath);\n    await service.initialize();\n  });\n\n  afterEach(async () => {\n    await rm(tempDir, { recursive: true, force: true });\n  });\n\n  test(\"updateRecency persists timestamp and getAllSnapshots mirrors it\", async () => {\n    const snapshot = await service.updateRecency(\"workspace-1\", 123);\n    expect(snapshot.recency).toBe(123);\n    expect(snapshot.streaming).toBe(false);\n    expect(snapshot.lastModel).toBeNull();\n    expect(snapshot.lastThinkingLevel).toBeNull();\n\n    const snapshots = await service.getAllSnapshots();\n    expect(snapshots.get(\"workspace-1\")).toEqual(snapshot);\n  });\n\n  test(\"setStreaming toggles status and remembers last model\", async () => {\n    await service.updateRecency(\"workspace-2\", 200);\n    const streaming = await service.setStreaming(\"workspace-2\", true, \"anthropic/sonnet\", \"high\");\n    expect(streaming.streaming).toBe(true);\n    expect(streaming.lastModel).toBe(\"anthropic/sonnet\");\n    expect(streaming.lastThinkingLevel).toBe(\"high\");\n\n    const cleared = await service.setStreaming(\"workspace-2\", false);\n    expect(cleared.streaming).toBe(false);\n    expect(cleared.lastModel).toBe(\"anthropic/sonnet\");\n    expect(cleared.lastThinkingLevel).toBe(\"high\");\n\n    const snapshots = await service.getAllSnapshots();\n    expect(snapshots.get(\"workspace-2\")).toEqual(cleared);\n  });\n});\n"]}