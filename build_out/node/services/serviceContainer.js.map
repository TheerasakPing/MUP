{"version":3,"file":"serviceContainer.js","sourceRoot":"","sources":["../../../src/node/services/serviceContainer.ts"],"names":[],"mappings":"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","sourcesContent":["import * as path from \"path\";\nimport * as fsPromises from \"fs/promises\";\nimport {\n  MUX_HELP_CHAT_AGENT_ID,\n  MUX_HELP_CHAT_WORKSPACE_ID,\n  MUX_HELP_CHAT_WORKSPACE_NAME,\n  MUX_HELP_CHAT_WORKSPACE_TITLE,\n} from \"@/common/constants/muxChat\";\nimport { getMuxHelpChatProjectPath } from \"@/node/constants/muxChat\";\nimport { createMuxMessage } from \"@/common/types/message\";\nimport { log } from \"@/node/services/log\";\nimport type { Config } from \"@/node/config\";\nimport { createCoreServices, type CoreServices } from \"@/node/services/coreServices\";\nimport { PTYService } from \"@/node/services/ptyService\";\nimport type { TerminalWindowManager } from \"@/desktop/terminalWindowManager\";\nimport { ProjectService } from \"@/node/services/projectService\";\nimport { MuxGatewayOauthService } from \"@/node/services/muxGatewayOauthService\";\nimport { MuxGovernorOauthService } from \"@/node/services/muxGovernorOauthService\";\nimport { CodexOauthService } from \"@/node/services/codexOauthService\";\nimport { CopilotOauthService } from \"@/node/services/copilotOauthService\";\nimport { TerminalService } from \"@/node/services/terminalService\";\nimport { EditorService } from \"@/node/services/editorService\";\nimport { WindowService } from \"@/node/services/windowService\";\nimport { UpdateService } from \"@/node/services/updateService\";\nimport { TokenizerService } from \"@/node/services/tokenizerService\";\nimport { ServerService } from \"@/node/services/serverService\";\nimport { MenuEventService } from \"@/node/services/menuEventService\";\nimport { VoiceService } from \"@/node/services/voiceService\";\nimport { TelemetryService } from \"@/node/services/telemetryService\";\nimport type {\n  ReasoningDeltaEvent,\n  StreamAbortEvent,\n  StreamDeltaEvent,\n  StreamEndEvent,\n  StreamStartEvent,\n  ToolCallDeltaEvent,\n  ToolCallEndEvent,\n  ToolCallStartEvent,\n} from \"@/common/types/stream\";\nimport { FeatureFlagService } from \"@/node/services/featureFlagService\";\nimport { SessionTimingService } from \"@/node/services/sessionTimingService\";\nimport { ExperimentsService } from \"@/node/services/experimentsService\";\nimport { WorkspaceMcpOverridesService } from \"@/node/services/workspaceMcpOverridesService\";\nimport { McpOauthService } from \"@/node/services/mcpOauthService\";\nimport { IdleCompactionService } from \"@/node/services/idleCompactionService\";\nimport { getSigningService, type SigningService } from \"@/node/services/signingService\";\nimport { coderService, type CoderService } from \"@/node/services/coderService\";\nimport { WorkspaceLifecycleHooks } from \"@/node/services/workspaceLifecycleHooks\";\nimport {\n  createStartCoderOnUnarchiveHook,\n  createStopCoderOnArchiveHook,\n} from \"@/node/runtime/coderLifecycleHooks\";\nimport { setGlobalCoderService } from \"@/node/runtime/runtimeFactory\";\nimport { PolicyService } from \"@/node/services/policyService\";\nimport { ModelPresetsService } from \"@/node/services/modelPresetsService\";\nimport { ModelHealthService } from \"@/node/services/modelHealthService\";\nimport { IconThemeService } from \"@/node/services/iconThemeService\";\nimport type { ORPCContext } from \"@/node/orpc/context\";\n\nconst MUX_HELP_CHAT_WELCOME_MESSAGE_ID = \"mux-chat-welcome\";\nconst MUX_HELP_CHAT_WELCOME_MESSAGE = `Hi, I'm Mux.\n\nThis is your built-in **Chat with Mux** workspace — a safe place to ask questions about Mux itself.\n\nI can help you:\n- Configure global agent behavior by editing **~/.mux/AGENTS.md** (I'll show a diff and ask before writing).\n- Pick models/providers and explain Mux modes + tool policies.\n- Troubleshoot common setup issues (keys, runtimes, workspaces, etc.).\n\nTry asking:\n- \"What does AGENTS.md do?\"\n- \"Help me write global instructions for code reviews\"\n- \"How do I set up an OpenAI / Anthropic key in Mux?\"\n`;\n\n/**\n * ServiceContainer - Central dependency container for all backend services.\n *\n * This class instantiates and wires together all services needed by the ORPC router.\n * Services are accessed via the ORPC context object.\n */\nexport class ServiceContainer {\n  public readonly config: Config;\n  // Core services — instantiated by createCoreServices (shared with `mux run` CLI)\n  private readonly historyService: CoreServices[\"historyService\"];\n  public readonly aiService: CoreServices[\"aiService\"];\n  public readonly workspaceService: CoreServices[\"workspaceService\"];\n  public readonly taskService: CoreServices[\"taskService\"];\n  public readonly providerService: CoreServices[\"providerService\"];\n  public readonly mcpConfigService: CoreServices[\"mcpConfigService\"];\n  public readonly mcpServerManager: CoreServices[\"mcpServerManager\"];\n  public readonly sessionUsageService: CoreServices[\"sessionUsageService\"];\n  public readonly costTrackingService: CoreServices[\"costTrackingService\"];\n  private readonly extensionMetadata: CoreServices[\"extensionMetadata\"];\n  private readonly backgroundProcessManager: CoreServices[\"backgroundProcessManager\"];\n  // Desktop-only services\n  public readonly projectService: ProjectService;\n  public readonly muxGatewayOauthService: MuxGatewayOauthService;\n  public readonly muxGovernorOauthService: MuxGovernorOauthService;\n  public readonly codexOauthService: CodexOauthService;\n  public readonly copilotOauthService: CopilotOauthService;\n  public readonly terminalService: TerminalService;\n  public readonly editorService: EditorService;\n  public readonly windowService: WindowService;\n  public readonly updateService: UpdateService;\n  public readonly tokenizerService: TokenizerService;\n  public readonly serverService: ServerService;\n  public readonly menuEventService: MenuEventService;\n  public readonly voiceService: VoiceService;\n  public readonly mcpOauthService: McpOauthService;\n  public readonly workspaceMcpOverridesService: WorkspaceMcpOverridesService;\n  public readonly telemetryService: TelemetryService;\n  public readonly featureFlagService: FeatureFlagService;\n  public readonly sessionTimingService: SessionTimingService;\n  public readonly experimentsService: ExperimentsService;\n  public readonly signingService: SigningService;\n  public readonly policyService: PolicyService;\n  public readonly coderService: CoderService;\n  private readonly ptyService: PTYService;\n  public readonly idleCompactionService: IdleCompactionService;\n  public readonly modelPresetsService: ModelPresetsService;\n  public readonly modelHealthService: ModelHealthService;\n  public readonly iconThemeService: IconThemeService;\n\n  constructor(config: Config) {\n    this.config = config;\n\n    // Cross-cutting services: created first so they can be passed to core\n    // services via constructor params (no setter injection needed).\n    this.policyService = new PolicyService(config);\n    this.telemetryService = new TelemetryService(config.rootDir);\n    this.experimentsService = new ExperimentsService({\n      telemetryService: this.telemetryService,\n      muxHome: config.rootDir,\n    });\n    this.sessionTimingService = new SessionTimingService(config, this.telemetryService);\n\n    // Desktop passes WorkspaceMcpOverridesService explicitly so AIService uses\n    // the persistent config rather than creating a default with an ephemeral one.\n    this.workspaceMcpOverridesService = new WorkspaceMcpOverridesService(config);\n\n    const core = createCoreServices({\n      config,\n      extensionMetadataPath: path.join(config.rootDir, \"extensionMetadata.json\"),\n      workspaceMcpOverridesService: this.workspaceMcpOverridesService,\n      policyService: this.policyService,\n      telemetryService: this.telemetryService,\n      experimentsService: this.experimentsService,\n      sessionTimingService: this.sessionTimingService,\n    });\n\n    // Spread core services into class fields\n    this.historyService = core.historyService;\n    this.aiService = core.aiService;\n    this.workspaceService = core.workspaceService;\n    this.taskService = core.taskService;\n    this.providerService = core.providerService;\n    this.mcpConfigService = core.mcpConfigService;\n    this.mcpServerManager = core.mcpServerManager;\n    this.sessionUsageService = core.sessionUsageService;\n    this.costTrackingService = core.costTrackingService;\n    this.extensionMetadata = core.extensionMetadata;\n    this.backgroundProcessManager = core.backgroundProcessManager;\n\n    this.projectService = new ProjectService(config);\n    this.modelPresetsService = new ModelPresetsService(config);\n    this.modelHealthService = new ModelHealthService(config);\n    this.iconThemeService = new IconThemeService(config);\n\n    // Idle compaction service - auto-compacts workspaces after configured idle period\n    this.idleCompactionService = new IdleCompactionService(\n      config,\n      this.historyService,\n      this.extensionMetadata,\n      (workspaceId) => this.workspaceService.emitIdleCompactionNeeded(workspaceId)\n    );\n    this.windowService = new WindowService();\n    this.mcpOauthService = new McpOauthService(\n      config,\n      this.mcpConfigService,\n      this.windowService,\n      this.telemetryService\n    );\n    this.mcpServerManager.setMcpOauthService(this.mcpOauthService);\n\n    this.muxGatewayOauthService = new MuxGatewayOauthService(\n      this.providerService,\n      this.windowService\n    );\n    this.muxGovernorOauthService = new MuxGovernorOauthService(\n      config,\n      this.windowService,\n      this.policyService\n    );\n    this.codexOauthService = new CodexOauthService(\n      config,\n      this.providerService,\n      this.windowService\n    );\n    this.aiService.setCodexOauthService(this.codexOauthService);\n    this.copilotOauthService = new CopilotOauthService(this.providerService, this.windowService);\n    // Terminal services - PTYService is cross-platform\n    this.ptyService = new PTYService();\n    this.terminalService = new TerminalService(config, this.ptyService);\n    // Wire terminal service to workspace service for cleanup on removal\n    this.workspaceService.setTerminalService(this.terminalService);\n    // Editor service for opening workspaces in code editors\n    this.editorService = new EditorService(config);\n    this.updateService = new UpdateService();\n    this.tokenizerService = new TokenizerService(this.sessionUsageService);\n    this.serverService = new ServerService();\n    this.menuEventService = new MenuEventService();\n    this.voiceService = new VoiceService(config);\n    this.featureFlagService = new FeatureFlagService(config, this.telemetryService);\n    this.signingService = getSigningService();\n    this.coderService = coderService;\n\n    const workspaceLifecycleHooks = new WorkspaceLifecycleHooks();\n    workspaceLifecycleHooks.registerBeforeArchive(\n      createStopCoderOnArchiveHook({\n        coderService: this.coderService,\n        shouldStopOnArchive: () =>\n          this.config.loadConfigOrDefault().stopCoderWorkspaceOnArchive !== false,\n      })\n    );\n    workspaceLifecycleHooks.registerAfterUnarchive(\n      createStartCoderOnUnarchiveHook({\n        coderService: this.coderService,\n        shouldStopOnArchive: () =>\n          this.config.loadConfigOrDefault().stopCoderWorkspaceOnArchive !== false,\n      })\n    );\n    this.workspaceService.setWorkspaceLifecycleHooks(workspaceLifecycleHooks);\n\n    // Register globally so all createRuntime calls can create CoderSSHRuntime\n    setGlobalCoderService(this.coderService);\n\n    // Backend timing stats (behind feature flag).\n    this.aiService.on(\"stream-start\", (data: StreamStartEvent) =>\n      this.sessionTimingService.handleStreamStart(data)\n    );\n    this.aiService.on(\"stream-delta\", (data: StreamDeltaEvent) =>\n      this.sessionTimingService.handleStreamDelta(data)\n    );\n    this.aiService.on(\"reasoning-delta\", (data: ReasoningDeltaEvent) =>\n      this.sessionTimingService.handleReasoningDelta(data)\n    );\n    this.aiService.on(\"tool-call-start\", (data: ToolCallStartEvent) =>\n      this.sessionTimingService.handleToolCallStart(data)\n    );\n    this.aiService.on(\"tool-call-delta\", (data: ToolCallDeltaEvent) =>\n      this.sessionTimingService.handleToolCallDelta(data)\n    );\n    this.aiService.on(\"tool-call-end\", (data: ToolCallEndEvent) =>\n      this.sessionTimingService.handleToolCallEnd(data)\n    );\n    this.aiService.on(\"stream-end\", (data: StreamEndEvent) =>\n      this.sessionTimingService.handleStreamEnd(data)\n    );\n    this.aiService.on(\"stream-abort\", (data: StreamAbortEvent) =>\n      this.sessionTimingService.handleStreamAbort(data)\n    );\n  }\n\n  async initialize(): Promise<void> {\n    await this.extensionMetadata.initialize();\n    // Initialize telemetry service\n    await this.telemetryService.initialize();\n\n    // Initialize policy service (startup gating)\n    await this.policyService.initialize();\n\n    // Initialize feature flag state (don't block startup on network).\n    this.featureFlagService\n      .getStatsTabState()\n      .then((state) => this.sessionTimingService.setStatsTabState(state))\n      .catch(() => {\n        // Ignore feature flag failures.\n      });\n    await this.experimentsService.initialize();\n    await this.taskService.initialize();\n    // Start idle compaction checker\n    this.idleCompactionService.start();\n\n    // Refresh Coder SSH config in background (handles binary path changes on restart)\n    // Skip getCoderInfo() to avoid caching \"unavailable\" if coder isn't installed yet\n    void this.coderService.ensureSSHConfig().catch(() => {\n      // Ignore errors - coder may not be installed\n    });\n\n    // Ensure the built-in Chat with Mux system workspace exists.\n    // Defensive: startup-time initialization must never crash the app.\n    try {\n      await this.ensureMuxChatWorkspace();\n    } catch (error) {\n      log.warn(\"[ServiceContainer] Failed to ensure Chat with Mux workspace\", { error });\n    }\n  }\n\n  private async ensureMuxChatWorkspace(): Promise<void> {\n    const projectPath = getMuxHelpChatProjectPath(this.config.rootDir);\n\n    // Ensure the directory exists (LocalRuntime uses project dir directly).\n    await fsPromises.mkdir(projectPath, { recursive: true });\n\n    await this.config.editConfig((config) => {\n      let projectConfig = config.projects.get(projectPath);\n      if (!projectConfig) {\n        projectConfig = { workspaces: [] };\n        config.projects.set(projectPath, projectConfig);\n      }\n\n      const existing = projectConfig.workspaces.find((w) => w.id === MUX_HELP_CHAT_WORKSPACE_ID);\n      if (!existing) {\n        projectConfig.workspaces.push({\n          path: projectPath,\n          id: MUX_HELP_CHAT_WORKSPACE_ID,\n          name: MUX_HELP_CHAT_WORKSPACE_NAME,\n          title: MUX_HELP_CHAT_WORKSPACE_TITLE,\n          agentId: MUX_HELP_CHAT_AGENT_ID,\n          createdAt: new Date().toISOString(),\n          runtimeConfig: { type: \"local\" },\n        });\n        return config;\n      }\n\n      // Self-heal: enforce invariants for the system workspace.\n      existing.path = projectPath;\n      existing.name = MUX_HELP_CHAT_WORKSPACE_NAME;\n      existing.title = MUX_HELP_CHAT_WORKSPACE_TITLE;\n      existing.agentId = MUX_HELP_CHAT_AGENT_ID;\n      existing.createdAt ??= new Date().toISOString();\n      existing.runtimeConfig = { type: \"local\" };\n      existing.archivedAt = undefined;\n\n      return config;\n    });\n\n    await this.ensureMuxChatWelcomeMessage();\n  }\n\n  private async ensureMuxChatWelcomeMessage(): Promise<void> {\n    // Only need to check if any history exists — avoid parsing the entire file\n    if (await this.historyService.hasHistory(MUX_HELP_CHAT_WORKSPACE_ID)) {\n      return;\n    }\n\n    const message = createMuxMessage(\n      MUX_HELP_CHAT_WELCOME_MESSAGE_ID,\n      \"assistant\",\n      MUX_HELP_CHAT_WELCOME_MESSAGE,\n      // Note: This message should be visible in the UI, so it must NOT be marked synthetic.\n      { timestamp: Date.now() }\n    );\n\n    const appendResult = await this.historyService.appendToHistory(\n      MUX_HELP_CHAT_WORKSPACE_ID,\n      message\n    );\n    if (!appendResult.success) {\n      log.warn(\"[ServiceContainer] Failed to seed mux-chat welcome message\", {\n        error: appendResult.error,\n      });\n    }\n  }\n\n  /**\n   * Build the ORPCContext from this container's services.\n   * Centralizes the ServiceContainer → ORPCContext mapping so callers\n   * (desktop/main.ts, cli/server.ts) don't duplicate a 30-field spread.\n   */\n  toORPCContext(): Omit<ORPCContext, \"headers\"> {\n    return {\n      config: this.config,\n      aiService: this.aiService,\n      projectService: this.projectService,\n      workspaceService: this.workspaceService,\n      taskService: this.taskService,\n      providerService: this.providerService,\n      muxGatewayOauthService: this.muxGatewayOauthService,\n      muxGovernorOauthService: this.muxGovernorOauthService,\n      codexOauthService: this.codexOauthService,\n      copilotOauthService: this.copilotOauthService,\n      terminalService: this.terminalService,\n      editorService: this.editorService,\n      windowService: this.windowService,\n      updateService: this.updateService,\n      tokenizerService: this.tokenizerService,\n      serverService: this.serverService,\n      menuEventService: this.menuEventService,\n      voiceService: this.voiceService,\n      mcpConfigService: this.mcpConfigService,\n      mcpOauthService: this.mcpOauthService,\n      workspaceMcpOverridesService: this.workspaceMcpOverridesService,\n      mcpServerManager: this.mcpServerManager,\n      featureFlagService: this.featureFlagService,\n      sessionTimingService: this.sessionTimingService,\n      telemetryService: this.telemetryService,\n      experimentsService: this.experimentsService,\n      sessionUsageService: this.sessionUsageService,\n      policyService: this.policyService,\n      signingService: this.signingService,\n      coderService: this.coderService,\n      modelPresetsService: this.modelPresetsService,\n      modelHealthService: this.modelHealthService,\n      iconThemeService: this.iconThemeService,\n    };\n  }\n\n  /**\n   * Shutdown services that need cleanup\n   */\n  async shutdown(): Promise<void> {\n    this.idleCompactionService.stop();\n    await this.telemetryService.shutdown();\n  }\n\n  setProjectDirectoryPicker(picker: () => Promise<string | null>): void {\n    this.projectService.setDirectoryPicker(picker);\n  }\n\n  setTerminalWindowManager(manager: TerminalWindowManager): void {\n    this.terminalService.setTerminalWindowManager(manager);\n  }\n\n  /**\n   * Dispose all services. Called on app quit to clean up resources.\n   * Terminates all background processes to prevent orphans.\n   */\n  async dispose(): Promise<void> {\n    this.policyService.dispose();\n    this.mcpServerManager.dispose();\n    await this.mcpOauthService.dispose();\n    await this.muxGatewayOauthService.dispose();\n    await this.muxGovernorOauthService.dispose();\n    await this.codexOauthService.dispose();\n\n    this.copilotOauthService.dispose();\n    await this.backgroundProcessManager.terminateAll();\n  }\n}\n"]}