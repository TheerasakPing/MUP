{"version":3,"file":"serviceContainer.js","sourceRoot":"","sources":["../../../src/node/services/serviceContainer.ts"],"names":[],"mappings":"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","sourcesContent":["import * as path from \"path\";\r\nimport * as fsPromises from \"fs/promises\";\r\nimport {\r\n  MUX_HELP_CHAT_AGENT_ID,\r\n  MUX_HELP_CHAT_WORKSPACE_ID,\r\n  MUX_HELP_CHAT_WORKSPACE_NAME,\r\n  MUX_HELP_CHAT_WORKSPACE_TITLE,\r\n} from \"@/common/constants/muxChat\";\r\nimport { getMuxHelpChatProjectPath } from \"@/node/constants/muxChat\";\r\nimport { createMuxMessage } from \"@/common/types/message\";\r\nimport { log } from \"@/node/services/log\";\r\nimport type { Config } from \"@/node/config\";\r\nimport { createCoreServices, type CoreServices } from \"@/node/services/coreServices\";\r\nimport { PTYService } from \"@/node/services/ptyService\";\r\nimport type { TerminalWindowManager } from \"@/desktop/terminalWindowManager\";\r\nimport { ProjectService } from \"@/node/services/projectService\";\r\nimport { MuxGatewayOauthService } from \"@/node/services/muxGatewayOauthService\";\r\nimport { MuxGovernorOauthService } from \"@/node/services/muxGovernorOauthService\";\r\nimport { CodexOauthService } from \"@/node/services/codexOauthService\";\r\nimport { CopilotOauthService } from \"@/node/services/copilotOauthService\";\r\nimport { TerminalService } from \"@/node/services/terminalService\";\r\nimport { EditorService } from \"@/node/services/editorService\";\r\nimport { WindowService } from \"@/node/services/windowService\";\r\nimport { UpdateService } from \"@/node/services/updateService\";\r\nimport { TokenizerService } from \"@/node/services/tokenizerService\";\r\nimport { ServerService } from \"@/node/services/serverService\";\r\nimport { MenuEventService } from \"@/node/services/menuEventService\";\r\nimport { VoiceService } from \"@/node/services/voiceService\";\r\nimport { TelemetryService } from \"@/node/services/telemetryService\";\r\nimport type {\r\n  ReasoningDeltaEvent,\r\n  StreamAbortEvent,\r\n  StreamDeltaEvent,\r\n  StreamEndEvent,\r\n  StreamStartEvent,\r\n  ToolCallDeltaEvent,\r\n  ToolCallEndEvent,\r\n  ToolCallStartEvent,\r\n} from \"@/common/types/stream\";\r\nimport { FeatureFlagService } from \"@/node/services/featureFlagService\";\r\nimport { SessionTimingService } from \"@/node/services/sessionTimingService\";\r\nimport { ExperimentsService } from \"@/node/services/experimentsService\";\r\nimport { WorkspaceMcpOverridesService } from \"@/node/services/workspaceMcpOverridesService\";\r\nimport { McpOauthService } from \"@/node/services/mcpOauthService\";\r\nimport { IdleCompactionService } from \"@/node/services/idleCompactionService\";\r\nimport { getSigningService, type SigningService } from \"@/node/services/signingService\";\r\nimport { coderService, type CoderService } from \"@/node/services/coderService\";\r\nimport { WorkspaceLifecycleHooks } from \"@/node/services/workspaceLifecycleHooks\";\r\nimport {\r\n  createStartCoderOnUnarchiveHook,\r\n  createStopCoderOnArchiveHook,\r\n} from \"@/node/runtime/coderLifecycleHooks\";\r\nimport { setGlobalCoderService } from \"@/node/runtime/runtimeFactory\";\r\nimport { PolicyService } from \"@/node/services/policyService\";\r\nimport { ModelPresetsService } from \"@/node/services/modelPresetsService\";\r\nimport { ModelHealthService } from \"@/node/services/modelHealthService\";\r\nimport { IconThemeService } from \"@/node/services/iconThemeService\";\r\nimport type { ORPCContext } from \"@/node/orpc/context\";\r\n\r\nconst MUX_HELP_CHAT_WELCOME_MESSAGE_ID = \"mux-chat-welcome\";\r\nconst MUX_HELP_CHAT_WELCOME_MESSAGE = `Hi, I'm Mux.\r\n\r\nThis is your built-in **Chat with Mux** workspace — a safe place to ask questions about Mux itself.\r\n\r\nI can help you:\r\n- Configure global agent behavior by editing **~/.mux/AGENTS.md** (I'll show a diff and ask before writing).\r\n- Pick models/providers and explain Mux modes + tool policies.\r\n- Troubleshoot common setup issues (keys, runtimes, workspaces, etc.).\r\n\r\nTry asking:\r\n- \"What does AGENTS.md do?\"\r\n- \"Help me write global instructions for code reviews\"\r\n- \"How do I set up an OpenAI / Anthropic key in Mux?\"\r\n`;\r\n\r\n/**\r\n * ServiceContainer - Central dependency container for all backend services.\r\n *\r\n * This class instantiates and wires together all services needed by the ORPC router.\r\n * Services are accessed via the ORPC context object.\r\n */\r\nexport class ServiceContainer {\r\n  public readonly config: Config;\r\n  // Core services — instantiated by createCoreServices (shared with `mux run` CLI)\r\n  private readonly historyService: CoreServices[\"historyService\"];\r\n  public readonly aiService: CoreServices[\"aiService\"];\r\n  public readonly workspaceService: CoreServices[\"workspaceService\"];\r\n  public readonly taskService: CoreServices[\"taskService\"];\r\n  public readonly providerService: CoreServices[\"providerService\"];\r\n  public readonly mcpConfigService: CoreServices[\"mcpConfigService\"];\r\n  public readonly mcpServerManager: CoreServices[\"mcpServerManager\"];\r\n  public readonly sessionUsageService: CoreServices[\"sessionUsageService\"];\r\n  public readonly costTrackingService: CoreServices[\"costTrackingService\"];\r\n  private readonly extensionMetadata: CoreServices[\"extensionMetadata\"];\r\n  private readonly backgroundProcessManager: CoreServices[\"backgroundProcessManager\"];\r\n  // Desktop-only services\r\n  public readonly projectService: ProjectService;\r\n  public readonly muxGatewayOauthService: MuxGatewayOauthService;\r\n  public readonly muxGovernorOauthService: MuxGovernorOauthService;\r\n  public readonly codexOauthService: CodexOauthService;\r\n  public readonly copilotOauthService: CopilotOauthService;\r\n  public readonly terminalService: TerminalService;\r\n  public readonly editorService: EditorService;\r\n  public readonly windowService: WindowService;\r\n  public readonly updateService: UpdateService;\r\n  public readonly tokenizerService: TokenizerService;\r\n  public readonly serverService: ServerService;\r\n  public readonly menuEventService: MenuEventService;\r\n  public readonly voiceService: VoiceService;\r\n  public readonly mcpOauthService: McpOauthService;\r\n  public readonly workspaceMcpOverridesService: WorkspaceMcpOverridesService;\r\n  public readonly telemetryService: TelemetryService;\r\n  public readonly featureFlagService: FeatureFlagService;\r\n  public readonly sessionTimingService: SessionTimingService;\r\n  public readonly experimentsService: ExperimentsService;\r\n  public readonly signingService: SigningService;\r\n  public readonly policyService: PolicyService;\r\n  public readonly coderService: CoderService;\r\n  private readonly ptyService: PTYService;\r\n  public readonly idleCompactionService: IdleCompactionService;\r\n  public readonly modelPresetsService: ModelPresetsService;\r\n  public readonly modelHealthService: ModelHealthService;\r\n  public readonly iconThemeService: IconThemeService;\r\n\r\n  constructor(config: Config) {\r\n    this.config = config;\r\n\r\n    // Cross-cutting services: created first so they can be passed to core\r\n    // services via constructor params (no setter injection needed).\r\n    this.policyService = new PolicyService(config);\r\n    this.telemetryService = new TelemetryService(config.rootDir);\r\n    this.experimentsService = new ExperimentsService({\r\n      telemetryService: this.telemetryService,\r\n      muxHome: config.rootDir,\r\n    });\r\n    this.sessionTimingService = new SessionTimingService(config, this.telemetryService);\r\n\r\n    // Desktop passes WorkspaceMcpOverridesService explicitly so AIService uses\r\n    // the persistent config rather than creating a default with an ephemeral one.\r\n    this.workspaceMcpOverridesService = new WorkspaceMcpOverridesService(config);\r\n\r\n    const core = createCoreServices({\r\n      config,\r\n      extensionMetadataPath: path.join(config.rootDir, \"extensionMetadata.json\"),\r\n      workspaceMcpOverridesService: this.workspaceMcpOverridesService,\r\n      policyService: this.policyService,\r\n      telemetryService: this.telemetryService,\r\n      experimentsService: this.experimentsService,\r\n      sessionTimingService: this.sessionTimingService,\r\n    });\r\n\r\n    // Spread core services into class fields\r\n    this.historyService = core.historyService;\r\n    this.aiService = core.aiService;\r\n    this.workspaceService = core.workspaceService;\r\n    this.taskService = core.taskService;\r\n    this.providerService = core.providerService;\r\n    this.mcpConfigService = core.mcpConfigService;\r\n    this.mcpServerManager = core.mcpServerManager;\r\n    this.sessionUsageService = core.sessionUsageService;\r\n    this.costTrackingService = core.costTrackingService;\r\n    this.extensionMetadata = core.extensionMetadata;\r\n    this.backgroundProcessManager = core.backgroundProcessManager;\r\n\r\n    this.projectService = new ProjectService(config);\r\n    this.modelPresetsService = new ModelPresetsService(config);\r\n    this.modelHealthService = new ModelHealthService(config);\r\n    this.iconThemeService = new IconThemeService(config);\r\n\r\n    // Idle compaction service - auto-compacts workspaces after configured idle period\r\n    this.idleCompactionService = new IdleCompactionService(\r\n      config,\r\n      this.historyService,\r\n      this.extensionMetadata,\r\n      (workspaceId) => this.workspaceService.emitIdleCompactionNeeded(workspaceId)\r\n    );\r\n    this.windowService = new WindowService();\r\n    this.mcpOauthService = new McpOauthService(\r\n      config,\r\n      this.mcpConfigService,\r\n      this.windowService,\r\n      this.telemetryService\r\n    );\r\n    this.mcpServerManager.setMcpOauthService(this.mcpOauthService);\r\n\r\n    this.muxGatewayOauthService = new MuxGatewayOauthService(\r\n      this.providerService,\r\n      this.windowService\r\n    );\r\n    this.muxGovernorOauthService = new MuxGovernorOauthService(\r\n      config,\r\n      this.windowService,\r\n      this.policyService\r\n    );\r\n    this.codexOauthService = new CodexOauthService(\r\n      config,\r\n      this.providerService,\r\n      this.windowService\r\n    );\r\n    this.aiService.setCodexOauthService(this.codexOauthService);\r\n    this.copilotOauthService = new CopilotOauthService(this.providerService, this.windowService);\r\n    // Terminal services - PTYService is cross-platform\r\n    this.ptyService = new PTYService();\r\n    this.terminalService = new TerminalService(config, this.ptyService);\r\n    // Wire terminal service to workspace service for cleanup on removal\r\n    this.workspaceService.setTerminalService(this.terminalService);\r\n    // Editor service for opening workspaces in code editors\r\n    this.editorService = new EditorService(config);\r\n    this.updateService = new UpdateService();\r\n    this.tokenizerService = new TokenizerService(this.sessionUsageService);\r\n    this.serverService = new ServerService();\r\n    this.menuEventService = new MenuEventService();\r\n    this.voiceService = new VoiceService(config);\r\n    this.featureFlagService = new FeatureFlagService(config, this.telemetryService);\r\n    this.signingService = getSigningService();\r\n    this.coderService = coderService;\r\n\r\n    const workspaceLifecycleHooks = new WorkspaceLifecycleHooks();\r\n    workspaceLifecycleHooks.registerBeforeArchive(\r\n      createStopCoderOnArchiveHook({\r\n        coderService: this.coderService,\r\n        shouldStopOnArchive: () =>\r\n          this.config.loadConfigOrDefault().stopCoderWorkspaceOnArchive !== false,\r\n      })\r\n    );\r\n    workspaceLifecycleHooks.registerAfterUnarchive(\r\n      createStartCoderOnUnarchiveHook({\r\n        coderService: this.coderService,\r\n        shouldStopOnArchive: () =>\r\n          this.config.loadConfigOrDefault().stopCoderWorkspaceOnArchive !== false,\r\n      })\r\n    );\r\n    this.workspaceService.setWorkspaceLifecycleHooks(workspaceLifecycleHooks);\r\n\r\n    // Register globally so all createRuntime calls can create CoderSSHRuntime\r\n    setGlobalCoderService(this.coderService);\r\n\r\n    // Backend timing stats (behind feature flag).\r\n    this.aiService.on(\"stream-start\", (data: StreamStartEvent) =>\r\n      this.sessionTimingService.handleStreamStart(data)\r\n    );\r\n    this.aiService.on(\"stream-delta\", (data: StreamDeltaEvent) =>\r\n      this.sessionTimingService.handleStreamDelta(data)\r\n    );\r\n    this.aiService.on(\"reasoning-delta\", (data: ReasoningDeltaEvent) =>\r\n      this.sessionTimingService.handleReasoningDelta(data)\r\n    );\r\n    this.aiService.on(\"tool-call-start\", (data: ToolCallStartEvent) =>\r\n      this.sessionTimingService.handleToolCallStart(data)\r\n    );\r\n    this.aiService.on(\"tool-call-delta\", (data: ToolCallDeltaEvent) =>\r\n      this.sessionTimingService.handleToolCallDelta(data)\r\n    );\r\n    this.aiService.on(\"tool-call-end\", (data: ToolCallEndEvent) =>\r\n      this.sessionTimingService.handleToolCallEnd(data)\r\n    );\r\n    this.aiService.on(\"stream-end\", (data: StreamEndEvent) =>\r\n      this.sessionTimingService.handleStreamEnd(data)\r\n    );\r\n    this.aiService.on(\"stream-abort\", (data: StreamAbortEvent) =>\r\n      this.sessionTimingService.handleStreamAbort(data)\r\n    );\r\n  }\r\n\r\n  async initialize(): Promise<void> {\r\n    await this.extensionMetadata.initialize();\r\n    // Initialize telemetry service\r\n    await this.telemetryService.initialize();\r\n\r\n    // Initialize policy service (startup gating)\r\n    await this.policyService.initialize();\r\n\r\n    // Initialize feature flag state (don't block startup on network).\r\n    this.featureFlagService\r\n      .getStatsTabState()\r\n      .then((state) => this.sessionTimingService.setStatsTabState(state))\r\n      .catch(() => {\r\n        // Ignore feature flag failures.\r\n      });\r\n    await this.experimentsService.initialize();\r\n    await this.taskService.initialize();\r\n    // Start idle compaction checker\r\n    this.idleCompactionService.start();\r\n\r\n    // Refresh Coder SSH config in background (handles binary path changes on restart)\r\n    // Skip getCoderInfo() to avoid caching \"unavailable\" if coder isn't installed yet\r\n    void this.coderService.ensureSSHConfig().catch(() => {\r\n      // Ignore errors - coder may not be installed\r\n    });\r\n\r\n    // Ensure the built-in Chat with Mux system workspace exists.\r\n    // Defensive: startup-time initialization must never crash the app.\r\n    try {\r\n      await this.ensureMuxChatWorkspace();\r\n    } catch (error) {\r\n      log.warn(\"[ServiceContainer] Failed to ensure Chat with Mux workspace\", { error });\r\n    }\r\n  }\r\n\r\n  private async ensureMuxChatWorkspace(): Promise<void> {\r\n    const projectPath = getMuxHelpChatProjectPath(this.config.rootDir);\r\n\r\n    // Ensure the directory exists (LocalRuntime uses project dir directly).\r\n    await fsPromises.mkdir(projectPath, { recursive: true });\r\n\r\n    await this.config.editConfig((config) => {\r\n      let projectConfig = config.projects.get(projectPath);\r\n      if (!projectConfig) {\r\n        projectConfig = { workspaces: [] };\r\n        config.projects.set(projectPath, projectConfig);\r\n      }\r\n\r\n      const existing = projectConfig.workspaces.find((w) => w.id === MUX_HELP_CHAT_WORKSPACE_ID);\r\n      if (!existing) {\r\n        projectConfig.workspaces.push({\r\n          path: projectPath,\r\n          id: MUX_HELP_CHAT_WORKSPACE_ID,\r\n          name: MUX_HELP_CHAT_WORKSPACE_NAME,\r\n          title: MUX_HELP_CHAT_WORKSPACE_TITLE,\r\n          agentId: MUX_HELP_CHAT_AGENT_ID,\r\n          createdAt: new Date().toISOString(),\r\n          runtimeConfig: { type: \"local\" },\r\n        });\r\n        return config;\r\n      }\r\n\r\n      // Self-heal: enforce invariants for the system workspace.\r\n      existing.path = projectPath;\r\n      existing.name = MUX_HELP_CHAT_WORKSPACE_NAME;\r\n      existing.title = MUX_HELP_CHAT_WORKSPACE_TITLE;\r\n      existing.agentId = MUX_HELP_CHAT_AGENT_ID;\r\n      existing.createdAt ??= new Date().toISOString();\r\n      existing.runtimeConfig = { type: \"local\" };\r\n      existing.archivedAt = undefined;\r\n\r\n      return config;\r\n    });\r\n\r\n    await this.ensureMuxChatWelcomeMessage();\r\n  }\r\n\r\n  private async ensureMuxChatWelcomeMessage(): Promise<void> {\r\n    // Only need to check if any history exists — avoid parsing the entire file\r\n    if (await this.historyService.hasHistory(MUX_HELP_CHAT_WORKSPACE_ID)) {\r\n      return;\r\n    }\r\n\r\n    const message = createMuxMessage(\r\n      MUX_HELP_CHAT_WELCOME_MESSAGE_ID,\r\n      \"assistant\",\r\n      MUX_HELP_CHAT_WELCOME_MESSAGE,\r\n      // Note: This message should be visible in the UI, so it must NOT be marked synthetic.\r\n      { timestamp: Date.now() }\r\n    );\r\n\r\n    const appendResult = await this.historyService.appendToHistory(\r\n      MUX_HELP_CHAT_WORKSPACE_ID,\r\n      message\r\n    );\r\n    if (!appendResult.success) {\r\n      log.warn(\"[ServiceContainer] Failed to seed mux-chat welcome message\", {\r\n        error: appendResult.error,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Build the ORPCContext from this container's services.\r\n   * Centralizes the ServiceContainer → ORPCContext mapping so callers\r\n   * (desktop/main.ts, cli/server.ts) don't duplicate a 30-field spread.\r\n   */\r\n  toORPCContext(): Omit<ORPCContext, \"headers\"> {\r\n    return {\r\n      config: this.config,\r\n      aiService: this.aiService,\r\n      projectService: this.projectService,\r\n      workspaceService: this.workspaceService,\r\n      taskService: this.taskService,\r\n      providerService: this.providerService,\r\n      muxGatewayOauthService: this.muxGatewayOauthService,\r\n      muxGovernorOauthService: this.muxGovernorOauthService,\r\n      codexOauthService: this.codexOauthService,\r\n      copilotOauthService: this.copilotOauthService,\r\n      terminalService: this.terminalService,\r\n      editorService: this.editorService,\r\n      windowService: this.windowService,\r\n      updateService: this.updateService,\r\n      tokenizerService: this.tokenizerService,\r\n      serverService: this.serverService,\r\n      menuEventService: this.menuEventService,\r\n      voiceService: this.voiceService,\r\n      mcpConfigService: this.mcpConfigService,\r\n      mcpOauthService: this.mcpOauthService,\r\n      workspaceMcpOverridesService: this.workspaceMcpOverridesService,\r\n      mcpServerManager: this.mcpServerManager,\r\n      featureFlagService: this.featureFlagService,\r\n      sessionTimingService: this.sessionTimingService,\r\n      telemetryService: this.telemetryService,\r\n      experimentsService: this.experimentsService,\r\n      sessionUsageService: this.sessionUsageService,\r\n      policyService: this.policyService,\r\n      signingService: this.signingService,\r\n      coderService: this.coderService,\r\n      modelPresetsService: this.modelPresetsService,\r\n      modelHealthService: this.modelHealthService,\r\n      iconThemeService: this.iconThemeService,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Shutdown services that need cleanup\r\n   */\r\n  async shutdown(): Promise<void> {\r\n    this.idleCompactionService.stop();\r\n    await this.telemetryService.shutdown();\r\n  }\r\n\r\n  setProjectDirectoryPicker(picker: () => Promise<string | null>): void {\r\n    this.projectService.setDirectoryPicker(picker);\r\n  }\r\n\r\n  setTerminalWindowManager(manager: TerminalWindowManager): void {\r\n    this.terminalService.setTerminalWindowManager(manager);\r\n  }\r\n\r\n  /**\r\n   * Dispose all services. Called on app quit to clean up resources.\r\n   * Terminates all background processes to prevent orphans.\r\n   */\r\n  async dispose(): Promise<void> {\r\n    this.policyService.dispose();\r\n    this.mcpServerManager.dispose();\r\n    await this.mcpOauthService.dispose();\r\n    await this.muxGatewayOauthService.dispose();\r\n    await this.muxGovernorOauthService.dispose();\r\n    await this.codexOauthService.dispose();\r\n\r\n    this.copilotOauthService.dispose();\r\n    await this.backgroundProcessManager.terminateAll();\r\n  }\r\n}\r\n"]}