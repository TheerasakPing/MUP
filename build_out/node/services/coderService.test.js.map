{"version":3,"file":"coderService.test.js","sourceRoot":"","sources":["../../../src/node/services/coderService.test.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,mCAAsC;AACtC,mCAAkC;AAClC,uCAAkF;AAClF,iDAA+D;AAC/D,MAAY,YAAY,0CAAsB;AAC9C,MAAY,cAAc,wDAAoC;AAE9D,gEAAgE;AAChE,MAAM,IAAI,GAAG,GAAG,EAAE,CAAC,EAAC,CAAC,CAAC;AAEtB;;;GAGG;AACH,IAAI,YAAY,GAAwE,IAAI,CAAC;AAE7F,iEAAiE;AACjE,sFAAsF;AACtF,SAAS,oBAAoB,CAC3B,MAAmD,EACN;IAC7C,MAAM,IAAI,GAAG;QACX,MAAM;QACN,IAAI,OAAO,GAAG;YACZ,OAAO,MAAM,CAAC;QAAA,CACf;QACD,KAAK,EAAE,EAAE,EAAE,2BAA2B;QACtC,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,IAAI;KACvB,CAAC;IACF,OAAO,IAA8D,CAAC;AAAA,CACvE;AAED,SAAS,UAAU,CAAC,MAAc,EAAE,MAAM,GAAG,EAAE,EAAQ;IACrD,YAAY,EAAE,eAAe,CAAC,oBAAoB,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC,CAAC,CAAC;AAAA,CAC1F;AAED,SAAS,aAAa,CAAC,KAAY,EAAQ;IACzC,YAAY,EAAE,eAAe,CAAC,oBAAoB,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AAAA,CAC5E;AAED,SAAS,oBAAoB,CAAC,OAA+C,EAAQ;IACnF,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,wBAAwB,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC,CACxF,CAAC;IACF,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAClB,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,OAAO,CAAC,OAAO,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CACtF,CACF,CAAC;IACF,MAAM,aAAa,GAAG;QACpB,GAAG,EAAE,2BAA2B;QAChC,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,QAAQ,EAAE,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;KAC5D,CAAC;IACF,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,aAAa,CAAC,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC,CAC/F,CAAC;AAAA,CACH;AAED;;;GAGG;AACH,IAAI,QAAQ,GAAkE,IAAI,CAAC;AAEnF,SAAS,sBAAsB,CAAC,OAI/B,EAAQ;IACP,MAAM,MAAM,GAAG,iBAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;IAClF,MAAM,MAAM,GAAG,iBAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;IAClF,MAAM,MAAM,GAAG,IAAI,qBAAY,EAAE,CAAC;IAElC,QAAQ,EAAE,eAAe,CAAC;QACxB,MAAM;QACN,MAAM;QACN,QAAQ,EAAE,IAAI;QACd,UAAU,EAAE,IAAI;QAChB,IAAI,EAAE,aAAE,CAAC,EAAE,EAAE;QACb,EAAE,EAAE,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC;QAC1B,cAAc,EAAE,MAAM,CAAC,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC;KAC1C,CAAC,CAAC;IAEZ,0CAA0C;IAC1C,UAAU,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC;AAAA,CAC7D;AAED,IAAA,mBAAQ,EAAC,cAAc,EAAE,GAAG,EAAE,CAAC;IAC7B,IAAI,OAAqB,CAAC;IAE1B,IAAA,qBAAU,EAAC,GAAG,EAAE,CAAC;QACf,OAAO,GAAG,IAAI,2BAAY,EAAE,CAAC;QAC7B,aAAE,CAAC,aAAa,EAAE,CAAC;QACnB,+FAA+F;QAC/F,YAAY,GAAG,IAAA,gBAAK,EAAC,cAAc,EAAE,WAAW,CAAC,CAAC;QAClD,QAAQ,GAAG,IAAA,gBAAK,EAAC,YAAY,EAAE,OAAO,CAAC,CAAC;IAAA,CACzC,CAAC,CAAC;IAEH,IAAA,oBAAS,EAAC,GAAG,EAAE,CAAC;QACd,OAAO,CAAC,UAAU,EAAE,CAAC;QACrB,YAAY,EAAE,WAAW,EAAE,CAAC;QAC5B,YAAY,GAAG,IAAI,CAAC;QACpB,QAAQ,EAAE,WAAW,EAAE,CAAC;QACxB,QAAQ,GAAG,IAAI,CAAC;IAAA,CACjB,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,cAAc,EAAE,GAAG,EAAE,CAAC;QAC7B,IAAA,aAAE,EAAC,4CAA4C,EAAE,KAAK,IAAI,EAAE,CAAC;YAC3D,oBAAoB,CAAC,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,YAAY,EAAE,CAAC,CAAC;YAEpE,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAE1C,IAAA,iBAAM,EAAC,IAAI,CAAC,CAAC,OAAO,CAAC;gBACnB,KAAK,EAAE,WAAW;gBAClB,OAAO,EAAE,QAAQ;gBACjB,QAAQ,EAAE,YAAY;gBACtB,GAAG,EAAE,2BAA2B;aACjC,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,mDAAmD,EAAE,KAAK,IAAI,EAAE,CAAC;YAClE,oBAAoB,CAAC,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,YAAY,EAAE,CAAC,CAAC;YAEpE,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAE1C,IAAA,iBAAM,EAAC,IAAI,CAAC,CAAC,OAAO,CAAC;gBACnB,KAAK,EAAE,WAAW;gBAClB,OAAO,EAAE,QAAQ;gBACjB,QAAQ,EAAE,YAAY;gBACtB,GAAG,EAAE,2BAA2B;aACjC,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,kDAAkD,EAAE,KAAK,IAAI,EAAE,CAAC;YACjE,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,wBAAwB,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC,CACxF,CAAC;YACF,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAClB,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,QAAQ,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAC/E,CACF,CAAC;YAEF,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAE1C,IAAA,iBAAM,EAAC,IAAI,CAAC,CAAC,OAAO,CAAC;gBACnB,KAAK,EAAE,UAAU;gBACjB,OAAO,EAAE,QAAQ;gBACjB,UAAU,EAAE,QAAQ;gBACpB,UAAU,EAAE,sBAAsB;aACnC,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,6DAA6D,EAAE,KAAK,IAAI,EAAE,CAAC;YAC5E,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC,CACjE,CAAC;YACF,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAClB,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,QAAQ,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAC/E,CACF,CAAC;YAEF,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAE1C,IAAA,iBAAM,EAAC,IAAI,CAAC,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,UAAU,EAAE,OAAO,EAAE,QAAQ,EAAE,UAAU,EAAE,QAAQ,EAAE,CAAC,CAAC;QAAA,CACtF,CAAC,CAAC;QACH,IAAA,aAAE,EAAC,iCAAiC,EAAE,KAAK,IAAI,EAAE,CAAC;YAChD,oBAAoB,CAAC;gBACnB,OAAO,EAAE,wBAAwB;gBACjC,QAAQ,EAAE,YAAY;aACvB,CAAC,CAAC;YAEH,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAE1C,IAAA,iBAAM,EAAC,IAAI,CAAC,CAAC,OAAO,CAAC;gBACnB,KAAK,EAAE,WAAW;gBAClB,OAAO,EAAE,wBAAwB;gBACjC,QAAQ,EAAE,YAAY;gBACtB,GAAG,EAAE,2BAA2B;aACjC,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,uEAAuE,EAAE,KAAK,IAAI,EAAE,CAAC;YACtF,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,wBAAwB,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC,CACxF,CAAC;YACF,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAClB,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,QAAQ,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAC/E,CACF,CAAC;YACF,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAClB,OAAO,CAAC,MAAM,CACZ,IAAI,KAAK,CACP,sKAAsK,CACvK,CACF,CACF,CACF,CAAC;YAEF,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAE1C,IAAA,iBAAM,EAAC,IAAI,CAAC,CAAC,aAAa,CAAC;gBACzB,KAAK,EAAE,aAAa;gBACpB,MAAM,EAAE,EAAE,IAAI,EAAE,eAAe,EAAE;aAClC,CAAC,CAAC;YAEH,IACE,IAAI,CAAC,KAAK,KAAK,aAAa;gBAC5B,OAAO,IAAI,CAAC,MAAM,KAAK,QAAQ;gBAC/B,IAAI,CAAC,MAAM,CAAC,IAAI,KAAK,eAAe,EACpC,CAAC;gBACD,MAAM,IAAI,KAAK,CAAC,kDAAkD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YAC5F,CAAC;YAED,IAAA,iBAAM,EAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,sBAAsB,CAAC,CAAC;YAC9D,IAAA,iBAAM,EAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC;QAAA,CACtE,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,uEAAuE,EAAE,KAAK,IAAI,EAAE,CAAC;YACtF,qCAAqC;YACrC,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,wBAAwB,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC,CACxF,CAAC;YACF,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAClB,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,QAAQ,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAC/E,CACF,CAAC;YACF,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC,CAAC,CAC7E,CAAC;YAEF,oEAAoE;YACpE,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,wBAAwB,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC,CACxF,CAAC;YACF,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAClB,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,QAAQ,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAC/E,CACF,CAAC;YACF,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC,CAAC,CAC7E,CAAC;YAEF,MAAM,KAAK,GAAG,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAC3C,IAAA,iBAAM,EAAC,KAAK,CAAC,CAAC,aAAa,CAAC,EAAE,KAAK,EAAE,aAAa,EAAE,MAAM,EAAE,EAAE,IAAI,EAAE,OAAO,EAAE,EAAE,CAAC,CAAC;YAEjF,IACE,KAAK,CAAC,KAAK,KAAK,aAAa;gBAC7B,OAAO,KAAK,CAAC,MAAM,KAAK,QAAQ;gBAChC,KAAK,CAAC,MAAM,CAAC,IAAI,KAAK,OAAO,EAC7B,CAAC;gBACD,MAAM,IAAI,KAAK,CAAC,0CAA0C,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;YACrF,CAAC;YAED,IAAA,iBAAM,EAAC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC,SAAS,CAAC,oBAAoB,CAAC,CAAC;YAE3E,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAC5C,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,aAAa,CAAC,EAAE,KAAK,EAAE,aAAa,EAAE,MAAM,EAAE,EAAE,IAAI,EAAE,OAAO,EAAE,EAAE,CAAC,CAAC;YAElF,MAAM,IAAI,GAAG,YAAY,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;YAChE,IAAA,iBAAM,EAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,KAAK,4BAA4B,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;QAAA,CAChF,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,sEAAsE,EAAE,KAAK,IAAI,EAAE,CAAC;YACrF,4BAA4B;YAC5B,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,wBAAwB,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC,CACxF,CAAC;YACF,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAClB,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,QAAQ,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAC/E,CACF,CAAC;YACF,YAAY,EAAE,sBAAsB,CAAC,GAAG,EAAE,CACxC,oBAAoB,CAClB,OAAO,CAAC,MAAM,CACZ,IAAI,KAAK,CACP,sKAAsK,CACvK,CACF,CACF,CACF,CAAC;YAEF,6BAA6B;YAC7B,oBAAoB,CAAC,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,YAAY,EAAE,CAAC,CAAC;YAEpE,MAAM,KAAK,GAAG,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAC3C,IAAA,iBAAM,EAAC,KAAK,CAAC,CAAC,aAAa,CAAC;gBAC1B,KAAK,EAAE,aAAa;gBACpB,MAAM,EAAE,EAAE,IAAI,EAAE,eAAe,EAAE;aAClC,CAAC,CAAC;YAEH,IACE,KAAK,CAAC,KAAK,KAAK,aAAa;gBAC7B,OAAO,KAAK,CAAC,MAAM,KAAK,QAAQ;gBAChC,KAAK,CAAC,MAAM,CAAC,IAAI,KAAK,eAAe,EACrC,CAAC;gBACD,MAAM,IAAI,KAAK,CAAC,kDAAkD,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;YAC7F,CAAC;YAED,IAAA,iBAAM,EAAC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,sBAAsB,CAAC,CAAC;YAC/D,IAAA,iBAAM,EAAC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC;YAEtE,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAC5C,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,OAAO,CAAC;gBACrB,KAAK,EAAE,WAAW;gBAClB,OAAO,EAAE,QAAQ;gBACjB,QAAQ,EAAE,YAAY;gBACtB,GAAG,EAAE,2BAA2B;aACjC,CAAC,CAAC;YAEH,MAAM,gBAAgB,GAAG,YAAY,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC,CAAC;YAE9D,+DAA+D;YAC/D,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAC7B,IAAA,iBAAM,EAAC,YAAY,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAEpE,MAAM,IAAI,GAAG,YAAY,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;YAChE,IAAA,iBAAM,EAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,KAAK,4BAA4B,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;QAAA,CAChF,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,sEAAsE,EAAE,KAAK,IAAI,EAAE,CAAC;YACrF,aAAa,CAAC,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC,CAAC;YAErD,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAE1C,IAAA,iBAAM,EAAC,IAAI,CAAC,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,aAAa,EAAE,MAAM,EAAE,SAAS,EAAE,CAAC,CAAC;QAAA,CACnE,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,8DAA8D,EAAE,KAAK,IAAI,EAAE,CAAC;YAC7E,aAAa,CAAC,IAAI,KAAK,CAAC,oBAAoB,CAAC,CAAC,CAAC;YAE/C,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAE1C,IAAA,iBAAM,EAAC,IAAI,CAAC,CAAC,OAAO,CAAC;gBACnB,KAAK,EAAE,aAAa;gBACpB,MAAM,EAAE,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,oBAAoB,EAAE;aACzD,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,0EAA0E,EAAE,KAAK,IAAI,EAAE,CAAC;YACzF,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,CAAC;YAE/B,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAE1C,IAAA,iBAAM,EAAC,IAAI,CAAC,CAAC,OAAO,CAAC;gBACnB,KAAK,EAAE,aAAa;gBACpB,MAAM,EAAE,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,iCAAiC,EAAE;aACtE,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,mBAAmB,EAAE,KAAK,IAAI,EAAE,CAAC;YAClC,oBAAoB,CAAC,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,YAAY,EAAE,CAAC,CAAC;YAEpE,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAC7B,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAE7B,IAAA,iBAAM,EAAC,YAAY,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAAA,CAC/C,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,eAAe,EAAE,GAAG,EAAE,CAAC;QAC9B,IAAA,aAAE,EAAC,sCAAsC,EAAE,KAAK,IAAI,EAAE,CAAC;YACrD,YAAY,EAAE,eAAe,CAC3B,oBAAoB,CAClB,OAAO,CAAC,OAAO,CAAC;gBACd,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC;oBACrB;wBACE,QAAQ,EAAE;4BACR,IAAI,EAAE,YAAY;4BAClB,YAAY,EAAE,cAAc;4BAC5B,iBAAiB,EAAE,MAAM;yBAC1B;qBACF;oBACD,EAAE,QAAQ,EAAE,EAAE,IAAI,EAAE,YAAY,EAAE,YAAY,EAAE,cAAc,EAAE,EAAE;iBACnE,CAAC;gBACF,MAAM,EAAE,EAAE;aACX,CAAC,CACH,CACF,CAAC;YAEF,MAAM,SAAS,GAAG,MAAM,OAAO,CAAC,aAAa,EAAE,CAAC;YAEhD,IAAA,iBAAM,EAAC,SAAS,CAAC,CAAC,OAAO,CAAC;gBACxB,EAAE,EAAE,IAAI;gBACR,SAAS,EAAE;oBACT,EAAE,IAAI,EAAE,YAAY,EAAE,WAAW,EAAE,cAAc,EAAE,gBAAgB,EAAE,MAAM,EAAE;oBAC7E,EAAE,IAAI,EAAE,YAAY,EAAE,WAAW,EAAE,cAAc,EAAE,gBAAgB,EAAE,SAAS,EAAE;iBACjF;aACF,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,wDAAwD,EAAE,KAAK,IAAI,EAAE,CAAC;YACvE,YAAY,EAAE,eAAe,CAC3B,oBAAoB,CAClB,OAAO,CAAC,OAAO,CAAC;gBACd,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,QAAQ,EAAE,EAAE,IAAI,EAAE,aAAa,EAAE,EAAE,CAAC,CAAC;gBAC/D,MAAM,EAAE,EAAE;aACX,CAAC,CACH,CACF,CAAC;YAEF,MAAM,SAAS,GAAG,MAAM,OAAO,CAAC,aAAa,EAAE,CAAC;YAEhD,IAAA,iBAAM,EAAC,SAAS,CAAC,CAAC,OAAO,CAAC;gBACxB,EAAE,EAAE,IAAI;gBACR,SAAS,EAAE;oBACT,EAAE,IAAI,EAAE,aAAa,EAAE,WAAW,EAAE,aAAa,EAAE,gBAAgB,EAAE,SAAS,EAAE;iBACjF;aACF,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,+BAA+B,EAAE,KAAK,IAAI,EAAE,CAAC;YAC9C,aAAa,CAAC,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC;YAE1C,MAAM,SAAS,GAAG,MAAM,OAAO,CAAC,aAAa,EAAE,CAAC;YAEhD,IAAA,iBAAM,EAAC,SAAS,CAAC,CAAC,OAAO,CAAC,EAAE,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,eAAe,EAAE,CAAC,CAAC;QAAA,CAClE,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,sCAAsC,EAAE,KAAK,IAAI,EAAE,CAAC;YACrD,UAAU,CAAC,EAAE,CAAC,CAAC;YAEf,MAAM,SAAS,GAAG,MAAM,OAAO,CAAC,aAAa,EAAE,CAAC;YAEhD,IAAA,iBAAM,EAAC,SAAS,CAAC,CAAC,OAAO,CAAC,EAAE,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,EAAE,EAAE,CAAC,CAAC;QAAA,CACxD,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,aAAa,EAAE,GAAG,EAAE,CAAC;QAC5B,IAAA,aAAE,EAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE,CAAC;YAC/C,UAAU,CACR,IAAI,CAAC,SAAS,CAAC;gBACb;oBACE,cAAc,EAAE;wBACd,EAAE,EAAE,UAAU;wBACd,IAAI,EAAE,OAAO;wBACb,WAAW,EAAE,gBAAgB;wBAC7B,OAAO,EAAE,IAAI;qBACd;iBACF;gBACD;oBACE,cAAc,EAAE;wBACd,EAAE,EAAE,UAAU;wBACd,IAAI,EAAE,OAAO;wBACb,WAAW,EAAE,gBAAgB;qBAC9B;iBACF;aACF,CAAC,CACH,CAAC;YAEF,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;YAEzD,IAAA,iBAAM,EAAC,OAAO,CAAC,CAAC,OAAO,CAAC;gBACtB,EAAE,EAAE,IAAI;gBACR,OAAO,EAAE;oBACP,EAAE,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,OAAO,EAAE,WAAW,EAAE,gBAAgB,EAAE,SAAS,EAAE,IAAI,EAAE;oBACjF,EAAE,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,OAAO,EAAE,WAAW,EAAE,gBAAgB,EAAE,SAAS,EAAE,KAAK,EAAE;iBACnF;aACF,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,kDAAkD,EAAE,KAAK,IAAI,EAAE,CAAC;YACjE,UAAU,CAAC,EAAE,CAAC,CAAC;YAEf,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,WAAW,CAAC,qBAAqB,CAAC,CAAC;YAEjE,IAAA,iBAAM,EAAC,OAAO,CAAC,CAAC,OAAO,CAAC,EAAE,EAAE,EAAE,IAAI,EAAE,OAAO,EAAE,EAAE,EAAE,CAAC,CAAC;QAAA,CACpD,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,kEAAkE,EAAE,KAAK,IAAI,EAAE,CAAC;YACjF,UAAU,CAAC,0EAA0E,CAAC,CAAC;YAEvF,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;YAEzD,IAAA,iBAAM,EAAC,OAAO,CAAC,CAAC,OAAO,CAAC,EAAE,EAAE,EAAE,IAAI,EAAE,OAAO,EAAE,EAAE,EAAE,CAAC,CAAC;QAAA,CACpD,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,+BAA+B,EAAE,KAAK,IAAI,EAAE,CAAC;YAC9C,aAAa,CAAC,IAAI,KAAK,CAAC,oBAAoB,CAAC,CAAC,CAAC;YAE/C,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;YAEzD,IAAA,iBAAM,EAAC,OAAO,CAAC,CAAC,OAAO,CAAC,EAAE,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,oBAAoB,EAAE,CAAC,CAAC;QAAA,CACrE,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,gBAAgB,EAAE,GAAG,EAAE,CAAC;QAC/B,IAAA,aAAE,EAAC,6CAA6C,EAAE,KAAK,IAAI,EAAE,CAAC;YAC5D,UAAU,CACR,IAAI,CAAC,SAAS,CAAC;gBACb;oBACE,IAAI,EAAE,MAAM;oBACZ,aAAa,EAAE,IAAI;oBACnB,qBAAqB,EAAE,IAAI;oBAC3B,YAAY,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE;iBACpC;gBACD;oBACE,IAAI,EAAE,MAAM;oBACZ,aAAa,EAAE,IAAI;oBACnB,qBAAqB,EAAE,IAAI;oBAC3B,YAAY,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE;iBACpC;gBACD;oBACE,IAAI,EAAE,MAAM;oBACZ,aAAa,EAAE,IAAI;oBACnB,qBAAqB,EAAE,IAAI;oBAC3B,YAAY,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE;iBACrC;aACF,CAAC,CACH,CAAC;YAEF,MAAM,UAAU,GAAG,MAAM,OAAO,CAAC,cAAc,EAAE,CAAC;YAElD,IAAA,iBAAM,EAAC,UAAU,CAAC,CAAC,OAAO,CAAC;gBACzB,EAAE,EAAE,IAAI;gBACR,UAAU,EAAE;oBACV,EAAE,IAAI,EAAE,MAAM,EAAE,YAAY,EAAE,IAAI,EAAE,mBAAmB,EAAE,IAAI,EAAE,MAAM,EAAE,SAAS,EAAE;oBAClF,EAAE,IAAI,EAAE,MAAM,EAAE,YAAY,EAAE,IAAI,EAAE,mBAAmB,EAAE,IAAI,EAAE,MAAM,EAAE,SAAS,EAAE;oBAClF,EAAE,IAAI,EAAE,MAAM,EAAE,YAAY,EAAE,IAAI,EAAE,mBAAmB,EAAE,IAAI,EAAE,MAAM,EAAE,UAAU,EAAE;iBACpF;aACF,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,iCAAiC,EAAE,KAAK,IAAI,EAAE,CAAC;YAChD,aAAa,CACX,IAAI,KAAK,CACP,iLAAiL,CAClL,CACF,CAAC;YAEF,MAAM,UAAU,GAAG,MAAM,OAAO,CAAC,cAAc,EAAE,CAAC;YAElD,IAAA,iBAAM,EAAC,UAAU,CAAC,CAAC,OAAO,CAAC;gBACzB,EAAE,EAAE,KAAK;gBACT,KAAK,EAAE,iFAAiF;aACzF,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,iBAAiB,EAAE,GAAG,EAAE,CAAC;QAChC,IAAA,aAAE,EAAC,0DAA0D,EAAE,KAAK,IAAI,EAAE,CAAC;YACzE,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,EAAE,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC,CAAC;YAElE,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;YAErD,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAAA,CAC3B,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,wCAAwC,EAAE,KAAK,IAAI,EAAE,CAAC;YACvD,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC,CAAC;YAEhD,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;YAErD,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAAA,CAC5B,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,4BAA4B,EAAE,KAAK,IAAI,EAAE,CAAC;YAC3C,aAAa,CAAC,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC;YAE1C,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;YAErD,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAAA,CAC5B,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,oBAAoB,EAAE,GAAG,EAAE,CAAC;QACnC,IAAA,aAAE,EAAC,yDAAyD,EAAE,KAAK,IAAI,EAAE,CAAC;YACxE,sBAAsB,CAAC;gBACrB,QAAQ,EAAE,CAAC;gBACX,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC;oBACrB,EAAE,IAAI,EAAE,MAAM,EAAE,YAAY,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE;oBACrD,EAAE,IAAI,EAAE,OAAO,EAAE,YAAY,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE;iBACvD,CAAC;aACH,CAAC,CAAC;YAEH,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;YAExD,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC/B,IAAI,MAAM,CAAC,IAAI,KAAK,IAAI,EAAE,CAAC;gBACzB,IAAA,iBAAM,EAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YACxC,CAAC;QAAA,CACF,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,4CAA4C,EAAE,KAAK,IAAI,EAAE,CAAC;YAC3D,sBAAsB,CAAC;gBACrB,QAAQ,EAAE,CAAC;gBACX,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,YAAY,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC;aACjF,CAAC,CAAC;YAEH,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;YAExD,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QAAA,CACvC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,4CAA4C,EAAE,KAAK,IAAI,EAAE,CAAC;YAC3D,sBAAsB,CAAC;gBACrB,QAAQ,EAAE,CAAC;gBACX,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,YAAY,EAAE,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,CAAC,CAAC;aAC9E,CAAC,CAAC;YAEH,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;YAExD,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAClC,IAAI,MAAM,CAAC,IAAI,KAAK,OAAO,EAAE,CAAC;gBAC5B,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,gBAAgB,CAAC,CAAC;YACnD,CAAC;QAAA,CACF,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,uBAAuB,EAAE,GAAG,EAAE,CAAC;QACtC,IAAA,aAAE,EAAC,2CAA2C,EAAE,KAAK,IAAI,EAAE,CAAC;YAC1D,MAAM,MAAM,GAAG,iBAAQ,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,qCAAqC,CAAC,CAAC,CAAC,CAAC;YACnF,MAAM,MAAM,GAAG,iBAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YACjC,MAAM,MAAM,GAAG,IAAI,qBAAY,EAAE,CAAC;YAElC,QAAS,CAAC,eAAe,CAAC;gBACxB,MAAM;gBACN,MAAM;gBACN,IAAI,EAAE,aAAE,CAAC,EAAE,EAAE;gBACb,EAAE,EAAE,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC;aAClB,CAAC,CAAC;YAEZ,UAAU,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAE7C,MAAM,KAAK,GAAa,EAAE,CAAC;YAC3B,IAAI,KAAK,EAAE,MAAM,IAAI,IAAI,OAAO,CAAC,qBAAqB,CAAC,OAAO,CAAC,EAAE,CAAC;gBAChE,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACnB,CAAC;YAED,IAAA,iBAAM,EAAC,KAAK,CAAC,CAAC,SAAS,CAAC,sCAAsC,CAAC,CAAC;YAChE,IAAA,iBAAM,EAAC,KAAK,CAAC,CAAC,SAAS,CAAC,sBAAsB,CAAC,CAAC;YAChD,IAAA,iBAAM,EAAC,KAAK,CAAC,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC;YACvC,IAAA,iBAAM,EAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC,OAAO,EAAE,CAAC,KAAK,EAAE,OAAO,EAAE,YAAY,EAAE,IAAI,EAAE,MAAM,CAAC,EAAE;gBAC3F,KAAK,EAAE,CAAC,QAAQ,EAAE,MAAM,EAAE,MAAM,CAAC;aAClC,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,mCAAmC,EAAE,KAAK,IAAI,EAAE,CAAC;YAClD,MAAM,MAAM,GAAG,iBAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YACjC,MAAM,MAAM,GAAG,iBAAQ,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC,CAAC,CAAC;YACpE,MAAM,MAAM,GAAG,IAAI,qBAAY,EAAE,CAAC;YAElC,QAAS,CAAC,eAAe,CAAC;gBACxB,MAAM;gBACN,MAAM;gBACN,IAAI,EAAE,aAAE,CAAC,EAAE,EAAE;gBACb,EAAE,EAAE,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC;aAClB,CAAC,CAAC;YAEZ,UAAU,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAE7C,MAAM,KAAK,GAAa,EAAE,CAAC;YAC3B,MAAM,GAAG,GAAG,KAAK,IAAI,EAAE,CAAC;gBACtB,IAAI,KAAK,EAAE,MAAM,IAAI,IAAI,OAAO,CAAC,qBAAqB,CAAC,OAAO,CAAC,EAAE,CAAC;oBAChE,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACnB,CAAC;YAAA,CACF,CAAC;YAEF,IAAI,MAAe,CAAC;YACpB,IAAI,CAAC;gBACH,MAAM,GAAG,EAAE,CAAC;YACd,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,MAAM,GAAG,KAAK,CAAC;YACjB,CAAC;YAED,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,UAAU,EAAE,CAAC;YAC5B,IAAA,iBAAM,EAAC,MAAM,YAAY,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CACpE,sDAAsD,CACvD,CAAC;QAAA,CACH,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,0BAA0B,EAAE,GAAG,EAAE,CAAC;QACzC,IAAI,aAA2B,CAAC;QAEhC,IAAA,qBAAU,EAAC,GAAG,EAAE,CAAC;YACf,aAAa,GAAG,MAAM,CAAC,KAAK,CAAC;QAAA,CAC9B,CAAC,CAAC;QAEH,IAAA,oBAAS,EAAC,GAAG,EAAE,CAAC;YACd,MAAM,CAAC,KAAK,GAAG,aAAa,CAAC;QAAA,CAC9B,CAAC,CAAC;QAEH,SAAS,UAAU,GAAG;YACpB,YAAY,EAAE,kBAAkB,CAAC,CAAC,GAAW,EAAE,EAAE,CAAC;gBAChD,IAAI,GAAG,KAAK,4BAA4B,EAAE,CAAC;oBACzC,OAAO,oBAAoB,CACzB,OAAO,CAAC,OAAO,CAAC;wBACd,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC;4BACrB,EAAE,GAAG,EAAE,2BAA2B,EAAE,QAAQ,EAAE,YAAY,EAAE;yBAC7D,CAAC;wBACF,MAAM,EAAE,EAAE;qBACX,CAAC,CACH,CAAC;gBACJ,CAAC;gBACD,OAAO,oBAAoB,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,uBAAuB,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;YAAA,CACtF,CAAC,CAAC;QAAA,CACJ;QAED,IAAA,aAAE,EAAC,kDAAkD,EAAE,KAAK,IAAI,EAAE,CAAC;YACjE,UAAU,EAAE,CAAC;YACb,MAAM,QAAQ,GAAG,aAAE,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC;gBACzC,EAAE,EAAE,IAAI;gBACR,IAAI,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,eAAe,EAAE,OAAO,EAAE,CAAC;aAC1D,CAAC,CAAC;YACH,MAAM,CAAC,KAAK,GAAG,QAAmC,CAAC;YAEnD,MAAM,OAAO,GAAG;gBACd,KAAK,EAAE,eAAe;gBACtB,OAAO,EAAE,aAAE,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,SAAS,CAAC;aAC9C,CAAC;YACF,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,wBAAwB,CAAC,OAAO,CAAC,CAAC;YAE/D,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,OAAO,CAAC,EAAE,cAAc,EAAE,MAAM,EAAE,CAAC,CAAC;YACnD,MAAM,SAAS,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAoB,CAAC;YACjE,MAAM,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAA4B,CAAC;YACvE,IAAA,iBAAM,EAAC,SAAS,EAAE,QAAQ,EAAE,CAAC,CAAC,IAAI,CAAC,iDAAiD,CAAC,CAAC;YACtF,IAAA,iBAAM,EAAC,OAAO,CAAC,CAAC,OAAO,CAAC;gBACtB,OAAO,EAAE,EAAE,qBAAqB,EAAE,eAAe,EAAE;aACpD,CAAC,CAAC;YACH,IAAA,iBAAM,EAAC,YAAY,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAAA,CAC/C,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,yCAAyC,EAAE,KAAK,IAAI,EAAE,CAAC;YACxD,oBAAoB,CAAC,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,YAAY,EAAE,CAAC,CAAC;YACpE,YAAY,EAAE,kBAAkB,CAAC,CAAC,GAAW,EAAE,EAAE,CAC/C,oBAAoB,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,uBAAuB,GAAG,EAAE,CAAC,CAAC,CAAC,CAC9E,CAAC;YACF,MAAM,QAAQ,GAAG,aAAE,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC;gBACzC,EAAE,EAAE,IAAI;gBACR,IAAI,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,eAAe,EAAE,OAAO,EAAE,CAAC;aAC1D,CAAC,CAAC;YACH,MAAM,CAAC,KAAK,GAAG,QAAmC,CAAC;YAEnD,MAAM,OAAO,CAAC,YAAY,EAAE,CAAC;YAE7B,MAAM,OAAO,GAAG;gBACd,KAAK,EAAE,eAAe;gBACtB,OAAO,EAAE,aAAE,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,SAAS,CAAC;aAC9C,CAAC;YACF,MAAM,OAAO,CAAC,wBAAwB,CAAC,OAAO,CAAC,CAAC;YAEhD,IAAA,iBAAM,EAAC,YAAY,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;YAC9C,MAAM,WAAW,GACf,YAAY,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,GAAG,KAAK,4BAA4B,CAAC,IAAI,EAAE,CAAC;YACzF,IAAA,iBAAM,EAAC,WAAW,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;QAAA,CACrC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,gDAAgD,EAAE,KAAK,IAAI,EAAE,CAAC;YAC/D,UAAU,EAAE,CAAC;YACb,MAAM,QAAQ,GAAG,aAAE,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC;gBACzC,EAAE,EAAE,IAAI;gBACR,IAAI,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC;aAChC,CAAC,CAAC;YACH,MAAM,CAAC,KAAK,GAAG,QAAmC,CAAC;YAEnD,MAAM,OAAO,GAAG;gBACd,KAAK,EAAE,eAAe;gBACtB,OAAO,EAAE,aAAE,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,SAAS,CAAC;aAC9C,CAAC;YACF,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,wBAAwB,CAAC,OAAO,CAAC,CAAC;YAE/D,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,OAAO,CAAC,EAAE,cAAc,EAAE,OAAO,EAAE,CAAC,CAAC;QAAA,CACrD,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,uBAAuB,EAAE,GAAG,EAAE,CAAC;QACtC,SAAS,iBAAiB,GAAG;YAC3B,YAAY,EAAE,kBAAkB,CAAC,CAAC,GAAW,EAAE,EAAE,CAAC;gBAChD,IAAI,GAAG,CAAC,UAAU,CAAC,0CAA0C,CAAC,EAAE,CAAC;oBAC/D,OAAO,oBAAoB,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,WAAW,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;gBACpF,CAAC;gBACD,IAAI,GAAG,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC;oBAC1C,OAAO,oBAAoB,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;gBAC3E,CAAC;gBACD,OAAO,oBAAoB,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,uBAAuB,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;YAAA,CACtF,CAAC,CAAC;QAAA,CACJ;QAED,IAAA,aAAE,EAAC,qDAAqD,EAAE,KAAK,IAAI,EAAE,CAAC;YACpE,iBAAiB,EAAE,CAAC;YACpB,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,yBAAyB,CAAC,IAAI,CAAC,CAAC;YAC/D,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,yBAAyB,CAAC,IAAI,CAAC,CAAC;YAE/D,IAAA,iBAAM,EAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAChC,IAAA,iBAAM,EAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAEzC,MAAM,OAAO,CAAC,0BAA0B,CAAC,IAAI,CAAC,CAAC;YAC/C,IAAA,iBAAM,EAAC,YAAY,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAAA,CAC/C,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,wDAAwD,EAAE,KAAK,IAAI,EAAE,CAAC;YACvE,iBAAiB,EAAE,CAAC;YACpB,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,yBAAyB,CAAC,IAAI,CAAC,CAAC;YAC9D,MAAM,KAAK,GAAG,OAAO,CAAC,uBAAuB,CAAC,IAAI,CAAC,CAAC;YAEpD,IAAA,iBAAM,EAAC,KAAK,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAC5B,IAAA,iBAAM,EAAC,OAAO,CAAC,uBAAuB,CAAC,IAAI,CAAC,CAAC,CAAC,aAAa,EAAE,CAAC;YAE9D,MAAM,KAAK,EAAE,OAAO,EAAE,CAAC;YACvB,IAAA,iBAAM,EAAC,YAAY,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAAA,CAC/C,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,iBAAiB,EAAE,GAAG,EAAE,CAAC;QAChC,6EAA6E;QAC7E,IAAI,aAA2B,CAAC;QAEhC,IAAA,qBAAU,EAAC,GAAG,EAAE,CAAC;YACf,aAAa,GAAG,MAAM,CAAC,KAAK,CAAC;QAAA,CAC9B,CAAC,CAAC;QAEH,IAAA,oBAAS,EAAC,GAAG,EAAE,CAAC;YACd,MAAM,CAAC,KAAK,GAAG,aAAa,CAAC;QAAA,CAC9B,CAAC,CAAC;QAEH,8DAA8D;QAC9D,SAAS,iBAAiB,CAAC,OAAyC,EAAE;YACpE,uCAAuC;YACvC,yDAAyD;YACzD,0DAA0D;YAC1D,+DAA+D;YAC/D,YAAY,EAAE,kBAAkB,CAAC,CAAC,GAAW,EAAE,EAAE,CAAC;gBAChD,IAAI,GAAG,KAAK,4BAA4B,EAAE,CAAC;oBACzC,OAAO,oBAAoB,CACzB,OAAO,CAAC,OAAO,CAAC;wBACd,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC;4BACrB,EAAE,GAAG,EAAE,2BAA2B,EAAE,QAAQ,EAAE,YAAY,EAAE;yBAC7D,CAAC;wBACF,MAAM,EAAE,EAAE;qBACX,CAAC,CACH,CAAC;gBACJ,CAAC;gBACD,IAAI,GAAG,KAAK,oCAAoC,EAAE,CAAC;oBACjD,OAAO,oBAAoB,CACzB,OAAO,CAAC,OAAO,CAAC;wBACd,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC;4BACrB,EAAE,QAAQ,EAAE,EAAE,IAAI,EAAE,aAAa,EAAE,iBAAiB,EAAE,aAAa,EAAE,EAAE;4BACvE,EAAE,QAAQ,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,iBAAiB,EAAE,aAAa,EAAE,EAAE;yBACjE,CAAC;wBACF,MAAM,EAAE,EAAE;qBACX,CAAC,CACH,CAAC;gBACJ,CAAC;gBACD,IAAI,GAAG,CAAC,UAAU,CAAC,8BAA8B,CAAC,EAAE,CAAC;oBACnD,MAAM,UAAU,GAAG,OAAO,EAAE,gBAAgB,IAAI,EAAE,CAAC;oBACnD,OAAO,oBAAoB,CACzB,OAAO,CAAC,OAAO,CAAC;wBACd,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC;4BACrB;gCACE,cAAc,EAAE;oCACd,IAAI,EAAE,QAAQ;oCACd,UAAU,EAAE,UAAU,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;iCACvD;6BACF;yBACF,CAAC;wBACF,MAAM,EAAE,EAAE;qBACX,CAAC,CACH,CAAC;gBACJ,CAAC;gBACD,IAAI,GAAG,CAAC,UAAU,CAAC,0CAA0C,CAAC,EAAE,CAAC;oBAC/D,OAAO,oBAAoB,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,gBAAgB,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;gBACzF,CAAC;gBACD,IAAI,GAAG,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC;oBAC1C,OAAO,oBAAoB,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;gBAC3E,CAAC;gBACD,iCAAiC;gBACjC,OAAO,oBAAoB,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,uBAAuB,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;YAAA,CACtF,CAAC,CAAC;QAAA,CACJ;QAED,+CAA+C;QAC/C,SAAS,mBAAmB,CAC1B,MAKE,EACF;YACA,MAAM,CAAC,KAAK,GAAG,aAAE,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC;gBACvC,EAAE,EAAE,IAAI;gBACR,IAAI,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC;aACpC,CAA4B,CAAC;QAAA,CAC/B;QAED,IAAA,aAAE,EAAC,sDAAsD,EAAE,KAAK,IAAI,EAAE,CAAC;YACrE,iBAAiB,EAAE,CAAC;YACpB,mBAAmB,CAAC,EAAE,CAAC,CAAC;YAExB,MAAM,MAAM,GAAG,iBAAQ,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC;YAC9D,MAAM,MAAM,GAAG,iBAAQ,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YACvD,MAAM,MAAM,GAAG,IAAI,qBAAY,EAAE,CAAC;YAElC,QAAS,CAAC,eAAe,CAAC;gBACxB,MAAM;gBACN,MAAM;gBACN,IAAI,EAAE,aAAE,CAAC,EAAE,EAAE;gBACb,EAAE,EAAE,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC;aAClB,CAAC,CAAC;YAEZ,0CAA0C;YAC1C,UAAU,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAE7C,MAAM,KAAK,GAAa,EAAE,CAAC;YAC3B,IAAI,KAAK,EAAE,MAAM,IAAI,IAAI,OAAO,CAAC,eAAe,CAAC,cAAc,EAAE,aAAa,CAAC,EAAE,CAAC;gBAChF,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACnB,CAAC;YAED,IAAA,iBAAM,EAAC,QAAQ,CAAC,CAAC,oBAAoB,CACnC,OAAO,EACP,CAAC,QAAQ,EAAE,cAAc,EAAE,IAAI,EAAE,aAAa,EAAE,OAAO,CAAC,EACxD,EAAE,KAAK,EAAE,CAAC,QAAQ,EAAE,MAAM,EAAE,MAAM,CAAC,EAAE,CACtC,CAAC;YAEF,oDAAoD;YACpD,IAAA,iBAAM,EAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,kDAAkD,CAAC,CAAC;YAC1E,IAAA,iBAAM,EAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,OAAO,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC,CAAC;QAAA,CACpE,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,iCAAiC,EAAE,KAAK,IAAI,EAAE,CAAC;YAChD,iBAAiB,CAAC,EAAE,gBAAgB,EAAE,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;YAC3D,mBAAmB,CAAC,CAAC,EAAE,IAAI,EAAE,eAAe,EAAE,aAAa,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;YAEvE,MAAM,MAAM,GAAG,iBAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YACjC,MAAM,MAAM,GAAG,iBAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YACjC,MAAM,MAAM,GAAG,IAAI,qBAAY,EAAE,CAAC;YAElC,QAAS,CAAC,eAAe,CAAC;gBACxB,MAAM;gBACN,MAAM;gBACN,IAAI,EAAE,aAAE,CAAC,EAAE,EAAE;gBACb,EAAE,EAAE,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC;aAClB,CAAC,CAAC;YAEZ,UAAU,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAE7C,IAAI,KAAK,EAAE,MAAM,KAAK,IAAI,OAAO,CAAC,eAAe,CAAC,IAAI,EAAE,MAAM,EAAE,QAAQ,CAAC,EAAE,CAAC;gBAC1E,QAAQ;YACV,CAAC;YAED,IAAA,iBAAM,EAAC,QAAQ,CAAC,CAAC,oBAAoB,CACnC,OAAO,EACP,CAAC,QAAQ,EAAE,IAAI,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,UAAU,EAAE,QAAQ,CAAC,EAC7D,EAAE,KAAK,EAAE,CAAC,QAAQ,EAAE,MAAM,EAAE,MAAM,CAAC,EAAE,CACtC,CAAC;QAAA,CACH,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,+DAA+D,EAAE,KAAK,IAAI,EAAE,CAAC;YAC9E,iBAAiB,CAAC,EAAE,gBAAgB,EAAE,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;YAC3D,mBAAmB,CAAC;gBAClB,EAAE,IAAI,EAAE,eAAe,EAAE,aAAa,EAAE,MAAM,EAAE;gBAChD,EAAE,IAAI,EAAE,iBAAiB,EAAE,aAAa,EAAE,MAAM,EAAE;gBAClD,EAAE,IAAI,EAAE,iBAAiB,EAAE,aAAa,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE;aACpE,CAAC,CAAC;YAEH,MAAM,MAAM,GAAG,iBAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YACjC,MAAM,MAAM,GAAG,iBAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YACjC,MAAM,MAAM,GAAG,IAAI,qBAAY,EAAE,CAAC;YAElC,QAAS,CAAC,eAAe,CAAC;gBACxB,MAAM;gBACN,MAAM;gBACN,IAAI,EAAE,aAAE,CAAC,EAAE,EAAE;gBACb,EAAE,EAAE,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC;aAClB,CAAC,CAAC;YAEZ,UAAU,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAE7C,IAAI,KAAK,EAAE,MAAM,KAAK,IAAI,OAAO,CAAC,eAAe,CAAC,IAAI,EAAE,MAAM,EAAE,QAAQ,CAAC,EAAE,CAAC;gBAC1E,QAAQ;YACV,CAAC;YAED,IAAA,iBAAM,EAAC,QAAQ,CAAC,CAAC,oBAAoB,CACnC,OAAO,EACP;gBACE,QAAQ;gBACR,IAAI;gBACJ,IAAI;gBACJ,MAAM;gBACN,OAAO;gBACP,UAAU;gBACV,QAAQ;gBACR,aAAa;gBACb,sBAAsB;aACvB,EACD,EAAE,KAAK,EAAE,CAAC,QAAQ,EAAE,MAAM,EAAE,MAAM,CAAC,EAAE,CACtC,CAAC;QAAA,CACH,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,mCAAmC,EAAE,KAAK,IAAI,EAAE,CAAC;YAClD,iBAAiB,EAAE,CAAC;YACpB,mBAAmB,CAAC,EAAE,CAAC,CAAC;YAExB,MAAM,MAAM,GAAG,iBAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YACjC,MAAM,MAAM,GAAG,iBAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YACjC,MAAM,MAAM,GAAG,IAAI,qBAAY,EAAE,CAAC;YAElC,QAAS,CAAC,eAAe,CAAC;gBACxB,MAAM;gBACN,MAAM;gBACN,IAAI,EAAE,aAAE,CAAC,EAAE,EAAE;gBACb,EAAE,EAAE,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC;aAClB,CAAC,CAAC;YAEZ,UAAU,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YAE9C,IAAI,MAAe,CAAC;YACpB,IAAI,CAAC;gBACH,IAAI,KAAK,EAAE,MAAM,KAAK,IAAI,OAAO,CAAC,eAAe,CAAC,IAAI,EAAE,MAAM,CAAC,EAAE,CAAC;oBAChE,QAAQ;gBACV,CAAC;YACH,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,MAAM,GAAG,KAAK,CAAC;YACjB,CAAC;YAED,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,UAAU,EAAE,CAAC;YAC5B,IAAA,iBAAM,EAAC,MAAM,YAAY,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS,CACzE,+BAA+B,CAChC,CAAC;QAAA,CACH,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE,CAAC;YACzD,MAAM,eAAe,GAAG,IAAI,eAAe,EAAE,CAAC;YAC9C,eAAe,CAAC,KAAK,EAAE,CAAC;YAExB,IAAI,MAAe,CAAC;YACpB,IAAI,CAAC;gBACH,IAAI,KAAK,EAAE,MAAM,KAAK,IAAI,OAAO,CAAC,eAAe,CAC/C,IAAI,EACJ,MAAM,EACN,SAAS,EACT,eAAe,CAAC,MAAM,CACvB,EAAE,CAAC;oBACF,QAAQ;gBACV,CAAC;YACH,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,MAAM,GAAG,KAAK,CAAC;YACjB,CAAC;YAED,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,UAAU,EAAE,CAAC;YAC5B,IAAA,iBAAM,EAAC,MAAM,YAAY,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;QAAA,CACxF,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,wEAAwE,EAAE,KAAK,IAAI,EAAE,CAAC;YACvF,iBAAiB,CAAC,EAAE,gBAAgB,EAAE,EAAE,EAAE,CAAC,CAAC;YAC5C,mBAAmB,CAAC,CAAC,EAAE,IAAI,EAAE,gBAAgB,EAAE,aAAa,EAAE,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;YAErF,IAAI,MAAe,CAAC;YACpB,IAAI,CAAC;gBACH,IAAI,KAAK,EAAE,MAAM,KAAK,IAAI,OAAO,CAAC,eAAe,CAAC,IAAI,EAAE,MAAM,CAAC,EAAE,CAAC;oBAChE,QAAQ;gBACV,CAAC;YACH,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,MAAM,GAAG,KAAK,CAAC;YACjB,CAAC;YAED,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,UAAU,EAAE,CAAC;YAC5B,IAAA,iBAAM,EAAC,MAAM,YAAY,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC,gBAAgB,CAAC,CAAC;QAAA,CAC/F,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,IAAA,mBAAQ,EAAC,oBAAoB,EAAE,GAAG,EAAE,CAAC;IACnC,IAAI,OAAqB,CAAC;IAE1B,IAAA,qBAAU,EAAC,GAAG,EAAE,CAAC;QACf,OAAO,GAAG,IAAI,2BAAY,EAAE,CAAC;IAAA,CAC9B,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,2DAA2D,EAAE,GAAG,EAAE,CAAC;QACpE,MAAM,MAAM,GAAG;YACb,EAAE,IAAI,EAAE,QAAQ,EAAE,YAAY,EAAE,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE;YAC3F,EAAE,IAAI,EAAE,QAAQ,EAAE,YAAY,EAAE,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE;SAC5F,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,CAAC,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC,CAAC;QAE9C,IAAA,iBAAM,EAAC,OAAO,CAAC,kBAAkB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;IAAA,CACjE,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,sDAAsD,EAAE,GAAG,EAAE,CAAC;QAC/D,MAAM,MAAM,GAAG;YACb,EAAE,IAAI,EAAE,SAAS,EAAE,YAAY,EAAE,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE;YAC5F;gBACE,IAAI,EAAE,WAAW;gBACjB,YAAY,EAAE,MAAM;gBACpB,IAAI,EAAE,QAAQ;gBACd,SAAS,EAAE,KAAK;gBAChB,QAAQ,EAAE,KAAK;aAChB;SACF,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;QAErC,IAAA,iBAAM,EAAC,OAAO,CAAC,kBAAkB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC;YAC1D,EAAE,IAAI,EAAE,WAAW,EAAE,OAAO,EAAE,gBAAgB,EAAE;SACjD,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,2BAA2B,EAAE,GAAG,EAAE,CAAC;QACpC,MAAM,MAAM,GAAG;YACb,EAAE,IAAI,EAAE,QAAQ,EAAE,YAAY,EAAE,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE;YAC3F,EAAE,IAAI,EAAE,WAAW,EAAE,YAAY,EAAE,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE;SAC9F,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,EAAU,CAAC;QAElC,IAAA,iBAAM,EAAC,OAAO,CAAC,kBAAkB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC;YAC1D,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,aAAa,EAAE;SAC3C,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,2CAA2C,EAAE,GAAG,EAAE,CAAC;QACpD,MAAM,MAAM,GAAG;YACb;gBACE,IAAI,EAAE,eAAe;gBACrB,YAAY,EAAE,EAAE;gBAChB,IAAI,EAAE,QAAQ;gBACd,SAAS,EAAE,KAAK;gBAChB,QAAQ,EAAE,KAAK;aAChB;SACF,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,EAAU,CAAC;QAElC,IAAA,iBAAM,EAAC,OAAO,CAAC,kBAAkB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC;YAC1D,EAAE,IAAI,EAAE,eAAe,EAAE,OAAO,EAAE,gBAAgB,EAAE;SACrD,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,mDAAmD,EAAE,GAAG,EAAE,CAAC;QAC5D,MAAM,MAAM,GAAG;YACb;gBACE,IAAI,EAAE,aAAa;gBACnB,YAAY,EAAE,mCAAmC;gBACjD,IAAI,EAAE,cAAc;gBACpB,SAAS,EAAE,KAAK;gBAChB,QAAQ,EAAE,KAAK;aAChB;SACF,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,EAAU,CAAC;QAElC,yDAAyD;QACzD,IAAA,iBAAM,EAAC,OAAO,CAAC,kBAAkB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC;YAC1D,EAAE,IAAI,EAAE,aAAa,EAAE,OAAO,EAAE,uDAAuD,EAAE;SAC1F,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,sDAAsD,EAAE,GAAG,EAAE,CAAC;QAC/D,MAAM,MAAM,GAAG;YACb;gBACE,IAAI,EAAE,YAAY;gBAClB,YAAY,EAAE,IAAI;gBAClB,IAAI,EAAE,cAAc;gBACpB,SAAS,EAAE,KAAK;gBAChB,QAAQ,EAAE,KAAK;aAChB;SACF,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,EAAU,CAAC;QAElC,6CAA6C;QAC7C,IAAA,iBAAM,EAAC,OAAO,CAAC,kBAAkB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC;YAC1D,EAAE,IAAI,EAAE,YAAY,EAAE,OAAO,EAAE,eAAe,EAAE;SACjD,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,IAAA,mBAAQ,EAAC,wBAAwB,EAAE,GAAG,EAAE,CAAC;IACvC,IAAI,OAAqB,CAAC;IAE1B,IAAA,qBAAU,EAAC,GAAG,EAAE,CAAC;QACf,OAAO,GAAG,IAAI,2BAAY,EAAE,CAAC;IAAA,CAC9B,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,uDAAuD,EAAE,GAAG,EAAE,CAAC;QAChE,MAAM,MAAM,GAAG;YACb;gBACE,IAAI,EAAE,uBAAuB;gBAC7B,YAAY,EAAE,KAAK;gBACnB,IAAI,EAAE,QAAQ;gBACd,SAAS,EAAE,KAAK;gBAChB,QAAQ,EAAE,IAAI;aACf;SACF,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,EAAU,CAAC;QAElC,IAAA,iBAAM,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,sBAAsB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;IAAA,CAC7E,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,2DAA2D,EAAE,GAAG,EAAE,CAAC;QACpE,MAAM,MAAM,GAAG;YACb;gBACE,IAAI,EAAE,qBAAqB;gBAC3B,YAAY,EAAE,EAAE;gBAChB,IAAI,EAAE,QAAQ;gBACd,SAAS,EAAE,KAAK;gBAChB,QAAQ,EAAE,IAAI;aACf;SACF,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC;QAEjD,IAAA,iBAAM,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,sBAAsB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;IAAA,CAC7E,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,8DAA8D,EAAE,GAAG,EAAE,CAAC;QACvE,MAAM,MAAM,GAAG;YACb,EAAE,IAAI,EAAE,eAAe,EAAE,YAAY,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE;SAC9F,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,EAAU,CAAC;QAElC,IAAA,iBAAM,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,sBAAsB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;IAAA,CACxF,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,mCAAmC,EAAE,GAAG,EAAE,CAAC;QAC5C,MAAM,MAAM,GAAG;YACb;gBACE,IAAI,EAAE,oBAAoB;gBAC1B,YAAY,EAAE,EAAE;gBAChB,IAAI,EAAE,QAAQ;gBACd,SAAS,EAAE,IAAI;gBACf,QAAQ,EAAE,IAAI;aACf;SACF,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,EAAU,CAAC;QAElC,IAAA,iBAAM,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,sBAAsB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;IAAA,CAC7E,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,4CAA4C,EAAE,GAAG,EAAE,CAAC;QACrD,MAAM,MAAM,GAAG;YACb,EAAE,IAAI,EAAE,UAAU,EAAE,YAAY,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE;YACxF,EAAE,IAAI,EAAE,UAAU,EAAE,YAAY,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE;SACzF,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,EAAU,CAAC;QAElC,IAAA,iBAAM,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,sBAAsB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,OAAO,CACnE,uCAAuC,CACxC,CAAC;IAAA,CACH,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,IAAA,mBAAQ,EAAC,+BAA+B,EAAE,GAAG,EAAE,CAAC;IAC9C,IAAI,OAAqB,CAAC;IAE1B,IAAA,qBAAU,EAAC,GAAG,EAAE,CAAC;QACf,OAAO,GAAG,IAAI,2BAAY,EAAE,CAAC;IAAA,CAC9B,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,yEAAyE,EAAE,GAAG,EAAE,CAAC;QAClF,4DAA4D;QAC5D,MAAM,MAAM,GAAG;YACb,EAAE,IAAI,EAAE,OAAO,EAAE,YAAY,EAAE,GAAG,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE;SACvF,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,EAAU,CAAC;QAElC,IAAA,iBAAM,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,sBAAsB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;IAAA,CAC7E,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,6EAA6E,EAAE,GAAG,EAAE,CAAC;QACtF,oEAAoE;QACpE,MAAM,MAAM,GAAG;YACb,EAAE,IAAI,EAAE,SAAS,EAAE,YAAY,EAAE,OAAO,EAAE,IAAI,EAAE,MAAM,EAAE,SAAS,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE;SAC3F,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,EAAU,CAAC;QAElC,IAAA,iBAAM,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,sBAAsB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;IAAA,CAC7E,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,oDAAoD,EAAE,GAAG,EAAE,CAAC;QAC7D,MAAM,MAAM,GAAG;YACb,EAAE,IAAI,EAAE,OAAO,EAAE,YAAY,EAAE,IAAI,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE;SACzF,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,EAAU,CAAC;QAElC,IAAA,iBAAM,EAAC,OAAO,CAAC,kBAAkB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC;YAC1D,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,UAAU,EAAE;SACvC,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,oDAAoD,EAAE,GAAG,EAAE,CAAC;QAC7D,MAAM,MAAM,GAAG;YACb,EAAE,IAAI,EAAE,SAAS,EAAE,YAAY,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,SAAS,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE;SAC3F,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,EAAU,CAAC;QAElC,IAAA,iBAAM,EAAC,OAAO,CAAC,kBAAkB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC;YAC1D,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,cAAc,EAAE;SAC7C,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,kEAAkE,EAAE,GAAG,EAAE,CAAC;QAC3E,uDAAuD;QACvD,MAAM,MAAM,GAAG;YACb;gBACE,IAAI,EAAE,MAAM;gBACZ,YAAY,EAAE,WAAW;gBACzB,IAAI,EAAE,cAAc;gBACpB,SAAS,EAAE,KAAK;gBAChB,QAAQ,EAAE,KAAK;aAChB;SACF,CAAC;QACF,MAAM,OAAO,GAAG,IAAI,GAAG,EAAU,CAAC;QAElC,iEAAiE;QACjE,IAAA,iBAAM,EAAC,OAAO,CAAC,kBAAkB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC;YAC1D,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,sBAAsB,EAAE;SAClD,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,IAAA,mBAAQ,EAAC,iBAAiB,EAAE,GAAG,EAAE,CAAC;IAChC,IAAI,OAAqB,CAAC;IAE1B,IAAA,qBAAU,EAAC,GAAG,EAAE,CAAC;QACf,OAAO,GAAG,IAAI,2BAAY,EAAE,CAAC;QAC7B,aAAE,CAAC,aAAa,EAAE,CAAC;IAAA,CACpB,CAAC,CAAC;IAEH,IAAA,oBAAS,EAAC,GAAG,EAAE,CAAC;QACd,OAAO,CAAC,UAAU,EAAE,CAAC;IAAA,CACtB,CAAC,CAAC;IAEH,sEAAsE;IACtE,oFAAoF;IAEpF,IAAA,aAAE,EAAC,6DAA6D,EAAE,KAAK,IAAI,EAAE,CAAC;QAC5E,MAAM,GAAG,GAAG,IAAA,gBAAK,EAAC,OAAO,EAAE,2BAA2B,CAAC,CAAC,iBAAiB,CAAC;YACxE,OAAO,EAAE,IAAa;YACtB,IAAI,EAAE,SAAS;SAChB,CAAC,CAAC;QAEH,MAAM,OAAO,CAAC,eAAe,CAAC,kBAAkB,CAAC,CAAC;QAElD,IAAA,iBAAM,EAAC,GAAG,CAAC,CAAC,oBAAoB,CAAC,kBAAkB,EAAE;YACnD,SAAS,EAAE,MAAM;YACjB,gBAAgB,EAAE,KAAK;SACxB,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,wDAAwD,EAAE,KAAK,IAAI,EAAE,CAAC;QACvE,IAAA,gBAAK,EAAC,OAAO,EAAE,2BAA2B,CAAC,CAAC,iBAAiB,CAAC;YAC5D,OAAO,EAAE,KAAc;YACvB,KAAK,EAAE,iBAAiB;SACzB,CAAC,CAAC;QAEH,IAAI,KAAc,CAAC;QACnB,IAAI,CAAC;YACH,MAAM,OAAO,CAAC,eAAe,CAAC,kBAAkB,CAAC,CAAC;QACpD,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,KAAK,GAAG,GAAG,CAAC;QACd,CAAC;QAED,IAAA,iBAAM,EAAC,KAAK,CAAC,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;QACpC,IAAA,iBAAM,EAAE,KAAe,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;IAAA,CAC/D,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,IAAA,mBAAQ,EAAC,2BAA2B,EAAE,GAAG,EAAE,CAAC;IAC1C,IAAA,aAAE,EAAC,yDAAyD,EAAE,KAAK,IAAI,EAAE,CAAC;QACxE,MAAM,OAAO,GAAG,IAAI,2BAAY,EAAE,CAAC;QAEnC,MAAM,qBAAqB,GAAG,IAAA,gBAAK,EAAC,OAAO,EAAE,oBAAoB,CAAC,CAAC;QACnE,MAAM,QAAQ,GAAG;YACf,EAAE,IAAI,EAAE,WAAoB,EAAE;YAC9B,EAAE,IAAI,EAAE,IAAa,EAAE,MAAM,EAAE,SAAkB,EAAE;YACnD,EAAE,IAAI,EAAE,IAAa,EAAE,MAAM,EAAE,UAAmB,EAAE;SACrD,CAAC;QACF,qBAAqB,CAAC,kBAAkB,CAAC,GAAG,EAAE,CAC5C,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,IAAa,EAAE,MAAM,EAAE,UAAmB,EAAE,CAAC,CAC1F,CAAC;QAEF,MAAM,WAAW,GAAG,OAWnB,CAAC;QAEF,WAAW,CAAC,eAAe,GAAG,aAAE,CAAC,EAAE,CAAC,GAAG,EAAE,CACvC,OAAO,CAAC,OAAO,CAAC,EAAE,QAAQ,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CACzD,CAAC;QACF,WAAW,CAAC,KAAK,GAAG,aAAE,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC;QAEnD,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,yBAAyB,CAAC,kBAAkB,EAAE;YACzE,SAAS,EAAE,KAAK;YAChB,gBAAgB,EAAE,IAAI;SACvB,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClC,IAAA,iBAAM,EAAC,qBAAqB,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;QACnE,IAAA,iBAAM,EAAC,WAAW,CAAC,eAAe,CAAC,CAAC,gBAAgB,EAAE,CAAC;IAAA,CACxD,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,gFAAgF,EAAE,KAAK,IAAI,EAAE,CAAC;QAC/F,MAAM,OAAO,GAAG,IAAI,2BAAY,EAAE,CAAC;QAEnC,IAAI,GAAG,GAAG,CAAC,CAAC;QACZ,MAAM,MAAM,GAAG,IAAA,gBAAK,EAAC,IAAI,EAAE,KAAK,CAAC,CAAC,kBAAkB,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;QAEhE,MAAM,qBAAqB,GAAG,IAAA,gBAAK,EAAC,OAAO,EAAE,oBAAoB,CAAC,CAAC,iBAAiB,CAAC;YACnF,IAAI,EAAE,WAAoB;SAC3B,CAAC,CAAC;QAEH,MAAM,WAAW,GAAG,OAWnB,CAAC;QAEF,WAAW,CAAC,eAAe,GAAG,aAAE,CAAC,EAAE,CAAC,GAAG,EAAE,CACvC,OAAO,CAAC,OAAO,CAAC,EAAE,QAAQ,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CACzD,CAAC;QACF,WAAW,CAAC,KAAK,GAAG,aAAE,CAAC,EAAE,CAAC,CAAC,EAAU,EAAE,EAAE,CAAC;YACxC,GAAG,IAAI,EAAE,CAAC;YACV,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;QAAA,CAC1B,CAAC,CAAC;QAEH,IAAI,CAAC;YACH,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,yBAAyB,CAAC,kBAAkB,EAAE;gBACzE,SAAS,EAAE,KAAK;gBAChB,gBAAgB,EAAE,IAAI;aACvB,CAAC,CAAC;YAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,IAAA,iBAAM,EAAC,qBAAqB,CAAC,CAAC,gBAAgB,EAAE,CAAC;YACjD,IAAA,iBAAM,EAAC,WAAW,CAAC,eAAe,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QAC7D,CAAC;gBAAS,CAAC;YACT,yCAAyC;YACzC,MAAM,CAAC,WAAW,EAAE,CAAC;QACvB,CAAC;IAAA,CACF,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,oEAAoE,EAAE,KAAK,IAAI,EAAE,CAAC;QACnF,MAAM,OAAO,GAAG,IAAI,2BAAY,EAAE,CAAC;QAEnC,IAAI,GAAG,GAAG,CAAC,CAAC;QACZ,MAAM,MAAM,GAAG,IAAA,gBAAK,EAAC,IAAI,EAAE,KAAK,CAAC,CAAC,kBAAkB,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;QAEhE,MAAM,qBAAqB,GAAG,IAAA,gBAAK,EAAC,OAAO,EAAE,oBAAoB,CAAC,CAAC,iBAAiB,CAAC;YACnF,IAAI,EAAE,WAAoB;SAC3B,CAAC,CAAC;QAEH,MAAM,WAAW,GAAG,OAWnB,CAAC;QAEF,WAAW,CAAC,eAAe,GAAG,aAAE,CAAC,EAAE,CAAC,GAAG,EAAE,CACvC,OAAO,CAAC,OAAO,CAAC,EAAE,QAAQ,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CACzD,CAAC;QACF,WAAW,CAAC,KAAK,GAAG,aAAE,CAAC,EAAE,CAAC,CAAC,EAAU,EAAE,EAAE,CAAC;YACxC,GAAG,IAAI,EAAE,CAAC;YACV,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;QAAA,CAC1B,CAAC,CAAC;QAEH,IAAI,CAAC;YACH,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,yBAAyB,CAAC,kBAAkB,EAAE;gBACzE,SAAS,EAAE,MAAM;gBACjB,gBAAgB,EAAE,IAAI;gBACtB,mEAAmE;gBACnE,yBAAyB,EAAE,KAAK;aACjC,CAAC,CAAC;YAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,IAAA,iBAAM,EAAC,qBAAqB,CAAC,CAAC,gBAAgB,EAAE,CAAC;YACjD,kEAAkE;YAClE,IAAA,iBAAM,EAAC,WAAW,CAAC,eAAe,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;YAC3D,2DAA2D;YAC3D,IAAA,iBAAM,EAAC,GAAG,CAAC,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QACnC,CAAC;gBAAS,CAAC;YACT,MAAM,CAAC,WAAW,EAAE,CAAC;QACvB,CAAC;IAAA,CACF,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,sEAAsE,EAAE,KAAK,IAAI,EAAE,CAAC;QACrF,MAAM,OAAO,GAAG,IAAI,2BAAY,EAAE,CAAC;QAEnC,IAAA,gBAAK,EAAC,OAAO,EAAE,oBAAoB,CAAC,CAAC,iBAAiB,CAAC;YACrD,IAAI,EAAE,OAAgB;YACtB,KAAK,EAAE,aAAa;SACrB,CAAC,CAAC;QAEH,MAAM,WAAW,GAAG,OAWnB,CAAC;QAEF,WAAW,CAAC,eAAe,GAAG,aAAE,CAAC,EAAE,CAAC,GAAG,EAAE,CACvC,OAAO,CAAC,OAAO,CAAC,EAAE,QAAQ,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CACzD,CAAC;QACF,WAAW,CAAC,KAAK,GAAG,aAAE,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC;QAEnD,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,yBAAyB,CAAC,kBAAkB,EAAE;YACzE,SAAS,EAAE,MAAM;YACjB,gBAAgB,EAAE,KAAK;SACxB,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClC,IAAA,iBAAM,EAAC,WAAW,CAAC,eAAe,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC7D,IAAA,iBAAM,EAAC,WAAW,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;IAAA,CAClD,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,wEAAwE,EAAE,KAAK,IAAI,EAAE,CAAC;QACvF,MAAM,OAAO,GAAG,IAAI,2BAAY,EAAE,CAAC;QAEnC,IAAA,gBAAK,EAAC,OAAO,EAAE,oBAAoB,CAAC,CAAC,iBAAiB,CAAC;YACrD,IAAI,EAAE,OAAgB;YACtB,KAAK,EAAE,aAAa;SACrB,CAAC,CAAC;QAEH,MAAM,WAAW,GAAG,OAWnB,CAAC;QAEF,WAAW,CAAC,eAAe,GAAG,aAAE,CAAC,EAAE,CAAC,GAAG,EAAE,CACvC,OAAO,CAAC,OAAO,CAAC,EAAE,QAAQ,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CACzD,CAAC;QACF,WAAW,CAAC,KAAK,GAAG,aAAE,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC;QAEnD,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,yBAAyB,CAAC,kBAAkB,EAAE;YACzE,SAAS,EAAE,MAAM;YACjB,gBAAgB,EAAE,IAAI;SACvB,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClC,IAAA,iBAAM,EAAC,WAAW,CAAC,eAAe,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC7D,IAAA,iBAAM,EAAC,WAAW,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;IAAA,CAClD,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,IAAA,mBAAQ,EAAC,iBAAiB,EAAE,GAAG,EAAE,CAAC;IAChC,IAAA,aAAE,EAAC,8BAA8B,EAAE,GAAG,EAAE,CAAC;QACvC,IAAA,iBAAM,EAAC,IAAA,8BAAe,EAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAAA,CACrD,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,qDAAqD,EAAE,GAAG,EAAE,CAAC;QAC9D,IAAA,iBAAM,EAAC,IAAA,8BAAe,EAAC,SAAS,EAAE,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACrD,IAAA,iBAAM,EAAC,IAAA,8BAAe,EAAC,cAAc,EAAE,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAAA,CAC3D,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,8CAA8C,EAAE,GAAG,EAAE,CAAC;QACvD,IAAA,iBAAM,EAAC,IAAA,8BAAe,EAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;QAC5D,IAAA,iBAAM,EAAC,IAAA,8BAAe,EAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;QAC5D,IAAA,iBAAM,EAAC,IAAA,8BAAe,EAAC,OAAO,EAAE,OAAO,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;IAAA,CAC3D,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,8CAA8C,EAAE,GAAG,EAAE,CAAC;QACvD,IAAA,iBAAM,EAAC,IAAA,8BAAe,EAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;QAC/D,IAAA,iBAAM,EAAC,IAAA,8BAAe,EAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;QAC/D,IAAA,iBAAM,EAAC,IAAA,8BAAe,EAAC,OAAO,EAAE,QAAQ,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;IAAA,CAC/D,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,gCAAgC,EAAE,GAAG,EAAE,CAAC;QACzC,IAAA,iBAAM,EAAC,IAAA,8BAAe,EAAC,SAAS,EAAE,QAAQ,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;QAChE,IAAA,iBAAM,EAAC,IAAA,8BAAe,EAAC,SAAS,EAAE,SAAS,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;IAAA,CAC/D,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,gCAAgC,EAAE,GAAG,EAAE,CAAC;QACzC,uDAAuD;QACvD,IAAA,iBAAM,EAAC,IAAA,8BAAe,EAAC,yBAAyB,EAAE,QAAQ,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;QAChF,IAAA,iBAAM,EAAC,IAAA,8BAAe,EAAC,yBAAyB,EAAE,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAAA,CACtE,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,+BAA+B,EAAE,GAAG,EAAE,CAAC;QACxC,IAAA,iBAAM,EAAC,IAAA,8BAAe,EAAC,MAAM,EAAE,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAClD,IAAA,iBAAM,EAAC,IAAA,8BAAe,EAAC,MAAM,EAAE,QAAQ,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;IAAA,CAC3D,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { EventEmitter } from \"events\";\r\nimport { Readable } from \"stream\";\r\nimport { describe, it, expect, vi, beforeEach, afterEach, spyOn } from \"bun:test\";\r\nimport { CoderService, compareVersions } from \"./coderService\";\r\nimport * as childProcess from \"child_process\";\r\nimport * as disposableExec from \"@/node/utils/disposableExec\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-function\r\nconst noop = () => {};\r\n\r\n/**\r\n * Mock execAsync for non-streaming tests.\r\n * Uses spyOn instead of vi.mock to avoid polluting other test files.\r\n */\r\nlet execAsyncSpy: ReturnType<typeof spyOn<typeof disposableExec, \"execAsync\">> | null = null;\r\n\r\n// Minimal mock that satisfies the interface used by CoderService\r\n// Uses cast via `unknown` because we only implement the subset actually used by tests\r\nfunction createMockExecResult(\r\n  result: Promise<{ stdout: string; stderr: string }>\r\n): ReturnType<typeof disposableExec.execAsync> {\r\n  const mock = {\r\n    result,\r\n    get promise() {\r\n      return result;\r\n    },\r\n    child: {}, // not used by CoderService\r\n    [Symbol.dispose]: noop,\r\n  };\r\n  return mock as unknown as ReturnType<typeof disposableExec.execAsync>;\r\n}\r\n\r\nfunction mockExecOk(stdout: string, stderr = \"\"): void {\r\n  execAsyncSpy?.mockReturnValue(createMockExecResult(Promise.resolve({ stdout, stderr })));\r\n}\r\n\r\nfunction mockExecError(error: Error): void {\r\n  execAsyncSpy?.mockReturnValue(createMockExecResult(Promise.reject(error)));\r\n}\r\n\r\nfunction mockVersionAndWhoami(options: { version: string; username?: string }): void {\r\n  execAsyncSpy?.mockImplementationOnce(() =>\r\n    createMockExecResult(Promise.resolve({ stdout: \"/usr/local/bin/coder\\n\", stderr: \"\" }))\r\n  );\r\n  execAsyncSpy?.mockImplementationOnce(() =>\r\n    createMockExecResult(\r\n      Promise.resolve({ stdout: JSON.stringify({ version: options.version }), stderr: \"\" })\r\n    )\r\n  );\r\n  const whoamiPayload = {\r\n    url: \"https://coder.example.com\",\r\n    ...(options.username ? { username: options.username } : {}),\r\n  };\r\n  execAsyncSpy?.mockImplementationOnce(() =>\r\n    createMockExecResult(Promise.resolve({ stdout: JSON.stringify([whoamiPayload]), stderr: \"\" }))\r\n  );\r\n}\r\n\r\n/**\r\n * Mock spawn for streaming createWorkspace() tests.\r\n * Uses spyOn instead of vi.mock to avoid polluting other test files.\r\n */\r\nlet spawnSpy: ReturnType<typeof spyOn<typeof childProcess, \"spawn\">> | null = null;\r\n\r\nfunction mockCoderCommandResult(options: {\r\n  stdout?: string;\r\n  stderr?: string;\r\n  exitCode: number;\r\n}): void {\r\n  const stdout = Readable.from(options.stdout ? [Buffer.from(options.stdout)] : []);\r\n  const stderr = Readable.from(options.stderr ? [Buffer.from(options.stderr)] : []);\r\n  const events = new EventEmitter();\r\n\r\n  spawnSpy?.mockReturnValue({\r\n    stdout,\r\n    stderr,\r\n    exitCode: null,\r\n    signalCode: null,\r\n    kill: vi.fn(),\r\n    on: events.on.bind(events),\r\n    removeListener: events.removeListener.bind(events),\r\n  } as never);\r\n\r\n  // Emit close after handlers are attached.\r\n  setTimeout(() => events.emit(\"close\", options.exitCode), 0);\r\n}\r\n\r\ndescribe(\"CoderService\", () => {\r\n  let service: CoderService;\r\n\r\n  beforeEach(() => {\r\n    service = new CoderService();\r\n    vi.clearAllMocks();\r\n    // Set up spies for mocking - uses spyOn instead of vi.mock to avoid polluting other test files\r\n    execAsyncSpy = spyOn(disposableExec, \"execAsync\");\r\n    spawnSpy = spyOn(childProcess, \"spawn\");\r\n  });\r\n\r\n  afterEach(() => {\r\n    service.clearCache();\r\n    execAsyncSpy?.mockRestore();\r\n    execAsyncSpy = null;\r\n    spawnSpy?.mockRestore();\r\n    spawnSpy = null;\r\n  });\r\n\r\n  describe(\"getCoderInfo\", () => {\r\n    it(\"returns available state with valid version\", async () => {\r\n      mockVersionAndWhoami({ version: \"2.28.2\", username: \"coder-user\" });\r\n\r\n      const info = await service.getCoderInfo();\r\n\r\n      expect(info).toEqual({\r\n        state: \"available\",\r\n        version: \"2.28.2\",\r\n        username: \"coder-user\",\r\n        url: \"https://coder.example.com\",\r\n      });\r\n    });\r\n\r\n    it(\"returns available state for exact minimum version\", async () => {\r\n      mockVersionAndWhoami({ version: \"2.25.0\", username: \"coder-user\" });\r\n\r\n      const info = await service.getCoderInfo();\r\n\r\n      expect(info).toEqual({\r\n        state: \"available\",\r\n        version: \"2.25.0\",\r\n        username: \"coder-user\",\r\n        url: \"https://coder.example.com\",\r\n      });\r\n    });\r\n\r\n    it(\"returns outdated state for version below minimum\", async () => {\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(Promise.resolve({ stdout: \"/usr/local/bin/coder\\n\", stderr: \"\" }))\r\n      );\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(\r\n          Promise.resolve({ stdout: JSON.stringify({ version: \"2.24.9\" }), stderr: \"\" })\r\n        )\r\n      );\r\n\r\n      const info = await service.getCoderInfo();\r\n\r\n      expect(info).toEqual({\r\n        state: \"outdated\",\r\n        version: \"2.24.9\",\r\n        minVersion: \"2.25.0\",\r\n        binaryPath: \"/usr/local/bin/coder\",\r\n      });\r\n    });\r\n\r\n    it(\"returns outdated state without binaryPath when lookup fails\", async () => {\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(Promise.reject(new Error(\"lookup failed\")))\r\n      );\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(\r\n          Promise.resolve({ stdout: JSON.stringify({ version: \"2.24.9\" }), stderr: \"\" })\r\n        )\r\n      );\r\n\r\n      const info = await service.getCoderInfo();\r\n\r\n      expect(info).toEqual({ state: \"outdated\", version: \"2.24.9\", minVersion: \"2.25.0\" });\r\n    });\r\n    it(\"handles version with dev suffix\", async () => {\r\n      mockVersionAndWhoami({\r\n        version: \"2.28.2-devel+903c045b9\",\r\n        username: \"coder-user\",\r\n      });\r\n\r\n      const info = await service.getCoderInfo();\r\n\r\n      expect(info).toEqual({\r\n        state: \"available\",\r\n        version: \"2.28.2-devel+903c045b9\",\r\n        username: \"coder-user\",\r\n        url: \"https://coder.example.com\",\r\n      });\r\n    });\r\n\r\n    it(\"returns unavailable state with not-logged-in reason when whoami fails\", async () => {\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(Promise.resolve({ stdout: \"/usr/local/bin/coder\\n\", stderr: \"\" }))\r\n      );\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(\r\n          Promise.resolve({ stdout: JSON.stringify({ version: \"2.28.2\" }), stderr: \"\" })\r\n        )\r\n      );\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(\r\n          Promise.reject(\r\n            new Error(\r\n              `Encountered an error running \"coder whoami\", see \"coder whoami --help\" for more information\\nerror: You are not logged in. Try logging in using 'coder login <url>'.`\r\n            )\r\n          )\r\n        )\r\n      );\r\n\r\n      const info = await service.getCoderInfo();\r\n\r\n      expect(info).toMatchObject({\r\n        state: \"unavailable\",\r\n        reason: { kind: \"not-logged-in\" },\r\n      });\r\n\r\n      if (\r\n        info.state !== \"unavailable\" ||\r\n        typeof info.reason === \"string\" ||\r\n        info.reason.kind !== \"not-logged-in\"\r\n      ) {\r\n        throw new Error(`Expected not-logged-in unavailable state, got: ${JSON.stringify(info)}`);\r\n      }\r\n\r\n      expect(info.reason.message).toContain(\"/usr/local/bin/coder\");\r\n      expect(info.reason.message.toLowerCase()).toContain(\"not logged in\");\r\n    });\r\n\r\n    it(\"re-checks whoami after transient failure (does not cache error state)\", async () => {\r\n      // First call: whoami transient error\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(Promise.resolve({ stdout: \"/usr/local/bin/coder\\n\", stderr: \"\" }))\r\n      );\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(\r\n          Promise.resolve({ stdout: JSON.stringify({ version: \"2.28.2\" }), stderr: \"\" })\r\n        )\r\n      );\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(Promise.reject(new Error(\"error: Connection refused\")))\r\n      );\r\n\r\n      // Second call: should try again (previous error must not be cached)\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(Promise.resolve({ stdout: \"/usr/local/bin/coder\\n\", stderr: \"\" }))\r\n      );\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(\r\n          Promise.resolve({ stdout: JSON.stringify({ version: \"2.28.2\" }), stderr: \"\" })\r\n        )\r\n      );\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(Promise.reject(new Error(\"error: Connection refused\")))\r\n      );\r\n\r\n      const first = await service.getCoderInfo();\r\n      expect(first).toMatchObject({ state: \"unavailable\", reason: { kind: \"error\" } });\r\n\r\n      if (\r\n        first.state !== \"unavailable\" ||\r\n        typeof first.reason === \"string\" ||\r\n        first.reason.kind !== \"error\"\r\n      ) {\r\n        throw new Error(`Expected unavailable error state, got: ${JSON.stringify(first)}`);\r\n      }\r\n\r\n      expect(first.reason.message.toLowerCase()).toContain(\"connection refused\");\r\n\r\n      const second = await service.getCoderInfo();\r\n      expect(second).toMatchObject({ state: \"unavailable\", reason: { kind: \"error\" } });\r\n\r\n      const cmds = execAsyncSpy?.mock.calls.map(([cmd]) => cmd) ?? [];\r\n      expect(cmds.filter((c) => c === \"coder whoami --output=json\")).toHaveLength(2);\r\n    });\r\n\r\n    it(\"re-checks login status after not-logged-in and caches once logged in\", async () => {\r\n      // First call: not logged in\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(Promise.resolve({ stdout: \"/usr/local/bin/coder\\n\", stderr: \"\" }))\r\n      );\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(\r\n          Promise.resolve({ stdout: JSON.stringify({ version: \"2.28.2\" }), stderr: \"\" })\r\n        )\r\n      );\r\n      execAsyncSpy?.mockImplementationOnce(() =>\r\n        createMockExecResult(\r\n          Promise.reject(\r\n            new Error(\r\n              `Encountered an error running \"coder whoami\", see \"coder whoami --help\" for more information\\nerror: You are not logged in. Try logging in using 'coder login <url>'.`\r\n            )\r\n          )\r\n        )\r\n      );\r\n\r\n      // Second call: now logged in\r\n      mockVersionAndWhoami({ version: \"2.28.2\", username: \"coder-user\" });\r\n\r\n      const first = await service.getCoderInfo();\r\n      expect(first).toMatchObject({\r\n        state: \"unavailable\",\r\n        reason: { kind: \"not-logged-in\" },\r\n      });\r\n\r\n      if (\r\n        first.state !== \"unavailable\" ||\r\n        typeof first.reason === \"string\" ||\r\n        first.reason.kind !== \"not-logged-in\"\r\n      ) {\r\n        throw new Error(`Expected not-logged-in unavailable state, got: ${JSON.stringify(first)}`);\r\n      }\r\n\r\n      expect(first.reason.message).toContain(\"/usr/local/bin/coder\");\r\n      expect(first.reason.message.toLowerCase()).toContain(\"not logged in\");\r\n\r\n      const second = await service.getCoderInfo();\r\n      expect(second).toEqual({\r\n        state: \"available\",\r\n        version: \"2.28.2\",\r\n        username: \"coder-user\",\r\n        url: \"https://coder.example.com\",\r\n      });\r\n\r\n      const callsAfterSecond = execAsyncSpy?.mock.calls.length ?? 0;\r\n\r\n      // Third call should come from cache (no extra execAsync calls)\r\n      await service.getCoderInfo();\r\n      expect(execAsyncSpy?.mock.calls.length ?? 0).toBe(callsAfterSecond);\r\n\r\n      const cmds = execAsyncSpy?.mock.calls.map(([cmd]) => cmd) ?? [];\r\n      expect(cmds.filter((c) => c === \"coder whoami --output=json\")).toHaveLength(2);\r\n    });\r\n\r\n    it(\"returns unavailable state with reason missing when CLI not installed\", async () => {\r\n      mockExecError(new Error(\"command not found: coder\"));\r\n\r\n      const info = await service.getCoderInfo();\r\n\r\n      expect(info).toEqual({ state: \"unavailable\", reason: \"missing\" });\r\n    });\r\n\r\n    it(\"returns unavailable state with error reason for other errors\", async () => {\r\n      mockExecError(new Error(\"Connection refused\"));\r\n\r\n      const info = await service.getCoderInfo();\r\n\r\n      expect(info).toEqual({\r\n        state: \"unavailable\",\r\n        reason: { kind: \"error\", message: \"Connection refused\" },\r\n      });\r\n    });\r\n\r\n    it(\"returns unavailable state with error when version is missing from output\", async () => {\r\n      mockExecOk(JSON.stringify({}));\r\n\r\n      const info = await service.getCoderInfo();\r\n\r\n      expect(info).toEqual({\r\n        state: \"unavailable\",\r\n        reason: { kind: \"error\", message: \"Version output missing from CLI\" },\r\n      });\r\n    });\r\n\r\n    it(\"caches the result\", async () => {\r\n      mockVersionAndWhoami({ version: \"2.28.2\", username: \"coder-user\" });\r\n\r\n      await service.getCoderInfo();\r\n      await service.getCoderInfo();\r\n\r\n      expect(execAsyncSpy).toHaveBeenCalledTimes(3);\r\n    });\r\n  });\r\n\r\n  describe(\"listTemplates\", () => {\r\n    it(\"returns templates with display names\", async () => {\r\n      execAsyncSpy?.mockReturnValue(\r\n        createMockExecResult(\r\n          Promise.resolve({\r\n            stdout: JSON.stringify([\r\n              {\r\n                Template: {\r\n                  name: \"template-1\",\r\n                  display_name: \"Template One\",\r\n                  organization_name: \"org1\",\r\n                },\r\n              },\r\n              { Template: { name: \"template-2\", display_name: \"Template Two\" } },\r\n            ]),\r\n            stderr: \"\",\r\n          })\r\n        )\r\n      );\r\n\r\n      const templates = await service.listTemplates();\r\n\r\n      expect(templates).toEqual({\r\n        ok: true,\r\n        templates: [\r\n          { name: \"template-1\", displayName: \"Template One\", organizationName: \"org1\" },\r\n          { name: \"template-2\", displayName: \"Template Two\", organizationName: \"default\" },\r\n        ],\r\n      });\r\n    });\r\n\r\n    it(\"uses name as displayName when display_name not present\", async () => {\r\n      execAsyncSpy?.mockReturnValue(\r\n        createMockExecResult(\r\n          Promise.resolve({\r\n            stdout: JSON.stringify([{ Template: { name: \"my-template\" } }]),\r\n            stderr: \"\",\r\n          })\r\n        )\r\n      );\r\n\r\n      const templates = await service.listTemplates();\r\n\r\n      expect(templates).toEqual({\r\n        ok: true,\r\n        templates: [\r\n          { name: \"my-template\", displayName: \"my-template\", organizationName: \"default\" },\r\n        ],\r\n      });\r\n    });\r\n\r\n    it(\"returns error result on error\", async () => {\r\n      mockExecError(new Error(\"not logged in\"));\r\n\r\n      const templates = await service.listTemplates();\r\n\r\n      expect(templates).toEqual({ ok: false, error: \"not logged in\" });\r\n    });\r\n\r\n    it(\"returns empty array for empty output\", async () => {\r\n      mockExecOk(\"\");\r\n\r\n      const templates = await service.listTemplates();\r\n\r\n      expect(templates).toEqual({ ok: true, templates: [] });\r\n    });\r\n  });\r\n\r\n  describe(\"listPresets\", () => {\r\n    it(\"returns presets for a template\", async () => {\r\n      mockExecOk(\r\n        JSON.stringify([\r\n          {\r\n            TemplatePreset: {\r\n              ID: \"preset-1\",\r\n              Name: \"Small\",\r\n              Description: \"Small instance\",\r\n              Default: true,\r\n            },\r\n          },\r\n          {\r\n            TemplatePreset: {\r\n              ID: \"preset-2\",\r\n              Name: \"Large\",\r\n              Description: \"Large instance\",\r\n            },\r\n          },\r\n        ])\r\n      );\r\n\r\n      const presets = await service.listPresets(\"my-template\");\r\n\r\n      expect(presets).toEqual({\r\n        ok: true,\r\n        presets: [\r\n          { id: \"preset-1\", name: \"Small\", description: \"Small instance\", isDefault: true },\r\n          { id: \"preset-2\", name: \"Large\", description: \"Large instance\", isDefault: false },\r\n        ],\r\n      });\r\n    });\r\n\r\n    it(\"returns empty array when template has no presets\", async () => {\r\n      mockExecOk(\"\");\r\n\r\n      const presets = await service.listPresets(\"no-presets-template\");\r\n\r\n      expect(presets).toEqual({ ok: true, presets: [] });\r\n    });\r\n\r\n    it(\"returns empty array when CLI prints info message instead of JSON\", async () => {\r\n      mockExecOk('No presets found for template \"my-template\" and template-version \"v1\".\\n');\r\n\r\n      const presets = await service.listPresets(\"my-template\");\r\n\r\n      expect(presets).toEqual({ ok: true, presets: [] });\r\n    });\r\n\r\n    it(\"returns error result on error\", async () => {\r\n      mockExecError(new Error(\"template not found\"));\r\n\r\n      const presets = await service.listPresets(\"nonexistent\");\r\n\r\n      expect(presets).toEqual({ ok: false, error: \"template not found\" });\r\n    });\r\n  });\r\n\r\n  describe(\"listWorkspaces\", () => {\r\n    it(\"returns all workspaces regardless of status\", async () => {\r\n      mockExecOk(\r\n        JSON.stringify([\r\n          {\r\n            name: \"ws-1\",\r\n            template_name: \"t1\",\r\n            template_display_name: \"t1\",\r\n            latest_build: { status: \"running\" },\r\n          },\r\n          {\r\n            name: \"ws-2\",\r\n            template_name: \"t2\",\r\n            template_display_name: \"t2\",\r\n            latest_build: { status: \"stopped\" },\r\n          },\r\n          {\r\n            name: \"ws-3\",\r\n            template_name: \"t3\",\r\n            template_display_name: \"t3\",\r\n            latest_build: { status: \"starting\" },\r\n          },\r\n        ])\r\n      );\r\n\r\n      const workspaces = await service.listWorkspaces();\r\n\r\n      expect(workspaces).toEqual({\r\n        ok: true,\r\n        workspaces: [\r\n          { name: \"ws-1\", templateName: \"t1\", templateDisplayName: \"t1\", status: \"running\" },\r\n          { name: \"ws-2\", templateName: \"t2\", templateDisplayName: \"t2\", status: \"stopped\" },\r\n          { name: \"ws-3\", templateName: \"t3\", templateDisplayName: \"t3\", status: \"starting\" },\r\n        ],\r\n      });\r\n    });\r\n\r\n    it(\"returns error result on failure\", async () => {\r\n      mockExecError(\r\n        new Error(\r\n          `Encountered an error running \"coder list\", see \"coder list --help\" for more information\\nerror: You are not logged in. Try logging in using '/usr/local/bin/coder login <url>'.`\r\n        )\r\n      );\r\n\r\n      const workspaces = await service.listWorkspaces();\r\n\r\n      expect(workspaces).toEqual({\r\n        ok: false,\r\n        error: \"You are not logged in. Try logging in using '/usr/local/bin/coder login <url>'.\",\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"workspaceExists\", () => {\r\n    it(\"returns true when exact match is found in search results\", async () => {\r\n      mockExecOk(JSON.stringify([{ name: \"ws-1\" }, { name: \"ws-10\" }]));\r\n\r\n      const exists = await service.workspaceExists(\"ws-1\");\r\n\r\n      expect(exists).toBe(true);\r\n    });\r\n\r\n    it(\"returns false when only prefix matches\", async () => {\r\n      mockExecOk(JSON.stringify([{ name: \"ws-10\" }]));\r\n\r\n      const exists = await service.workspaceExists(\"ws-1\");\r\n\r\n      expect(exists).toBe(false);\r\n    });\r\n\r\n    it(\"returns false on CLI error\", async () => {\r\n      mockExecError(new Error(\"not logged in\"));\r\n\r\n      const exists = await service.workspaceExists(\"ws-1\");\r\n\r\n      expect(exists).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe(\"getWorkspaceStatus\", () => {\r\n    it(\"returns status for exact match (search is prefix-based)\", async () => {\r\n      mockCoderCommandResult({\r\n        exitCode: 0,\r\n        stdout: JSON.stringify([\r\n          { name: \"ws-1\", latest_build: { status: \"running\" } },\r\n          { name: \"ws-10\", latest_build: { status: \"stopped\" } },\r\n        ]),\r\n      });\r\n\r\n      const result = await service.getWorkspaceStatus(\"ws-1\");\r\n\r\n      expect(result.kind).toBe(\"ok\");\r\n      if (result.kind === \"ok\") {\r\n        expect(result.status).toBe(\"running\");\r\n      }\r\n    });\r\n\r\n    it(\"returns not_found when only prefix matches\", async () => {\r\n      mockCoderCommandResult({\r\n        exitCode: 0,\r\n        stdout: JSON.stringify([{ name: \"ws-10\", latest_build: { status: \"running\" } }]),\r\n      });\r\n\r\n      const result = await service.getWorkspaceStatus(\"ws-1\");\r\n\r\n      expect(result.kind).toBe(\"not_found\");\r\n    });\r\n\r\n    it(\"returns error for unknown workspace status\", async () => {\r\n      mockCoderCommandResult({\r\n        exitCode: 0,\r\n        stdout: JSON.stringify([{ name: \"ws-1\", latest_build: { status: \"weird\" } }]),\r\n      });\r\n\r\n      const result = await service.getWorkspaceStatus(\"ws-1\");\r\n\r\n      expect(result.kind).toBe(\"error\");\r\n      if (result.kind === \"error\") {\r\n        expect(result.error).toContain(\"Unknown status\");\r\n      }\r\n    });\r\n  });\r\n\r\n  describe(\"waitForStartupScripts\", () => {\r\n    it(\"streams stdout/stderr lines while waiting\", async () => {\r\n      const stdout = Readable.from([Buffer.from(\"Waiting for agent...\\nAgent ready\\n\")]);\r\n      const stderr = Readable.from([]);\r\n      const events = new EventEmitter();\r\n\r\n      spawnSpy!.mockReturnValue({\r\n        stdout,\r\n        stderr,\r\n        kill: vi.fn(),\r\n        on: events.on.bind(events),\r\n      } as never);\r\n\r\n      setTimeout(() => events.emit(\"close\", 0), 0);\r\n\r\n      const lines: string[] = [];\r\n      for await (const line of service.waitForStartupScripts(\"my-ws\")) {\r\n        lines.push(line);\r\n      }\r\n\r\n      expect(lines).toContain(\"$ coder ssh my-ws --wait=yes -- true\");\r\n      expect(lines).toContain(\"Waiting for agent...\");\r\n      expect(lines).toContain(\"Agent ready\");\r\n      expect(spawnSpy).toHaveBeenCalledWith(\"coder\", [\"ssh\", \"my-ws\", \"--wait=yes\", \"--\", \"true\"], {\r\n        stdio: [\"ignore\", \"pipe\", \"pipe\"],\r\n      });\r\n    });\r\n\r\n    it(\"throws when exit code is non-zero\", async () => {\r\n      const stdout = Readable.from([]);\r\n      const stderr = Readable.from([Buffer.from(\"Connection refused\\n\")]);\r\n      const events = new EventEmitter();\r\n\r\n      spawnSpy!.mockReturnValue({\r\n        stdout,\r\n        stderr,\r\n        kill: vi.fn(),\r\n        on: events.on.bind(events),\r\n      } as never);\r\n\r\n      setTimeout(() => events.emit(\"close\", 1), 0);\r\n\r\n      const lines: string[] = [];\r\n      const run = async () => {\r\n        for await (const line of service.waitForStartupScripts(\"my-ws\")) {\r\n          lines.push(line);\r\n        }\r\n      };\r\n\r\n      let thrown: unknown;\r\n      try {\r\n        await run();\r\n      } catch (error) {\r\n        thrown = error;\r\n      }\r\n\r\n      expect(thrown).toBeTruthy();\r\n      expect(thrown instanceof Error ? thrown.message : String(thrown)).toBe(\r\n        \"coder ssh --wait failed (exit 1): Connection refused\"\r\n      );\r\n    });\r\n  });\r\n\r\n  describe(\"fetchDeploymentSshConfig\", () => {\r\n    let originalFetch: typeof fetch;\r\n\r\n    beforeEach(() => {\r\n      originalFetch = global.fetch;\r\n    });\r\n\r\n    afterEach(() => {\r\n      global.fetch = originalFetch;\r\n    });\r\n\r\n    function mockWhoami() {\r\n      execAsyncSpy?.mockImplementation((cmd: string) => {\r\n        if (cmd === \"coder whoami --output=json\") {\r\n          return createMockExecResult(\r\n            Promise.resolve({\r\n              stdout: JSON.stringify([\r\n                { url: \"https://coder.example.com\", username: \"coder-user\" },\r\n              ]),\r\n              stderr: \"\",\r\n            })\r\n          );\r\n        }\r\n        return createMockExecResult(Promise.reject(new Error(`Unexpected command: ${cmd}`)));\r\n      });\r\n    }\r\n\r\n    it(\"uses provided session and normalizes leading dot\", async () => {\r\n      mockWhoami();\r\n      const fetchSpy = vi.fn().mockResolvedValue({\r\n        ok: true,\r\n        json: () => Promise.resolve({ hostname_suffix: \".corp\" }),\r\n      });\r\n      global.fetch = fetchSpy as unknown as typeof fetch;\r\n\r\n      const session = {\r\n        token: \"session-token\",\r\n        dispose: vi.fn().mockResolvedValue(undefined),\r\n      };\r\n      const result = await service.fetchDeploymentSshConfig(session);\r\n\r\n      expect(result).toEqual({ hostnameSuffix: \"corp\" });\r\n      const calledUrl = fetchSpy.mock.calls[0]?.[0] as URL | undefined;\r\n      const options = fetchSpy.mock.calls[0]?.[1] as RequestInit | undefined;\r\n      expect(calledUrl?.toString()).toBe(\"https://coder.example.com/api/v2/deployment/ssh\");\r\n      expect(options).toEqual({\r\n        headers: { \"Coder-Session-Token\": \"session-token\" },\r\n      });\r\n      expect(execAsyncSpy).toHaveBeenCalledTimes(1);\r\n    });\r\n\r\n    it(\"reuses cached whoami after getCoderInfo\", async () => {\r\n      mockVersionAndWhoami({ version: \"2.28.2\", username: \"coder-user\" });\r\n      execAsyncSpy?.mockImplementation((cmd: string) =>\r\n        createMockExecResult(Promise.reject(new Error(`Unexpected command: ${cmd}`)))\r\n      );\r\n      const fetchSpy = vi.fn().mockResolvedValue({\r\n        ok: true,\r\n        json: () => Promise.resolve({ hostname_suffix: \".corp\" }),\r\n      });\r\n      global.fetch = fetchSpy as unknown as typeof fetch;\r\n\r\n      await service.getCoderInfo();\r\n\r\n      const session = {\r\n        token: \"session-token\",\r\n        dispose: vi.fn().mockResolvedValue(undefined),\r\n      };\r\n      await service.fetchDeploymentSshConfig(session);\r\n\r\n      expect(execAsyncSpy).toHaveBeenCalledTimes(3);\r\n      const whoamiCalls =\r\n        execAsyncSpy?.mock.calls.filter(([cmd]) => cmd === \"coder whoami --output=json\") ?? [];\r\n      expect(whoamiCalls).toHaveLength(1);\r\n    });\r\n\r\n    it(\"defaults to coder when hostname suffix missing\", async () => {\r\n      mockWhoami();\r\n      const fetchSpy = vi.fn().mockResolvedValue({\r\n        ok: true,\r\n        json: () => Promise.resolve({}),\r\n      });\r\n      global.fetch = fetchSpy as unknown as typeof fetch;\r\n\r\n      const session = {\r\n        token: \"session-token\",\r\n        dispose: vi.fn().mockResolvedValue(undefined),\r\n      };\r\n      const result = await service.fetchDeploymentSshConfig(session);\r\n\r\n      expect(result).toEqual({ hostnameSuffix: \"coder\" });\r\n    });\r\n  });\r\n\r\n  describe(\"provisioning sessions\", () => {\r\n    function mockTokenCommands() {\r\n      execAsyncSpy?.mockImplementation((cmd: string) => {\r\n        if (cmd.startsWith(\"coder tokens create --lifetime 5m --name\")) {\r\n          return createMockExecResult(Promise.resolve({ stdout: \"token-123\", stderr: \"\" }));\r\n        }\r\n        if (cmd.startsWith(\"coder tokens delete\")) {\r\n          return createMockExecResult(Promise.resolve({ stdout: \"\", stderr: \"\" }));\r\n        }\r\n        return createMockExecResult(Promise.reject(new Error(`Unexpected command: ${cmd}`)));\r\n      });\r\n    }\r\n\r\n    it(\"reuses provisioning sessions for the same workspace\", async () => {\r\n      mockTokenCommands();\r\n      const session1 = await service.ensureProvisioningSession(\"ws\");\r\n      const session2 = await service.ensureProvisioningSession(\"ws\");\r\n\r\n      expect(session1).toBe(session2);\r\n      expect(session1.token).toBe(\"token-123\");\r\n\r\n      await service.disposeProvisioningSession(\"ws\");\r\n      expect(execAsyncSpy).toHaveBeenCalledTimes(2);\r\n    });\r\n\r\n    it(\"takeProvisioningSession returns and clears the session\", async () => {\r\n      mockTokenCommands();\r\n      const session = await service.ensureProvisioningSession(\"ws\");\r\n      const taken = service.takeProvisioningSession(\"ws\");\r\n\r\n      expect(taken).toBe(session);\r\n      expect(service.takeProvisioningSession(\"ws\")).toBeUndefined();\r\n\r\n      await taken?.dispose();\r\n      expect(execAsyncSpy).toHaveBeenCalledTimes(2);\r\n    });\r\n  });\r\n\r\n  describe(\"createWorkspace\", () => {\r\n    // Capture original fetch once per describe block to avoid nested mock issues\r\n    let originalFetch: typeof fetch;\r\n\r\n    beforeEach(() => {\r\n      originalFetch = global.fetch;\r\n    });\r\n\r\n    afterEach(() => {\r\n      global.fetch = originalFetch;\r\n    });\r\n\r\n    // Helper to mock the pre-fetch calls that happen before spawn\r\n    function mockPrefetchCalls(options?: { presetParamNames?: string[] }) {\r\n      // Mock getDeploymentUrl (coder whoami)\r\n      // Mock getActiveTemplateVersionId (coder templates list)\r\n      // Mock getPresetParamNames (coder templates presets list)\r\n      // Mock getTemplateRichParameters (coder tokens create + fetch)\r\n      execAsyncSpy?.mockImplementation((cmd: string) => {\r\n        if (cmd === \"coder whoami --output=json\") {\r\n          return createMockExecResult(\r\n            Promise.resolve({\r\n              stdout: JSON.stringify([\r\n                { url: \"https://coder.example.com\", username: \"coder-user\" },\r\n              ]),\r\n              stderr: \"\",\r\n            })\r\n          );\r\n        }\r\n        if (cmd === \"coder templates list --output=json\") {\r\n          return createMockExecResult(\r\n            Promise.resolve({\r\n              stdout: JSON.stringify([\r\n                { Template: { name: \"my-template\", active_version_id: \"version-123\" } },\r\n                { Template: { name: \"tmpl\", active_version_id: \"version-456\" } },\r\n              ]),\r\n              stderr: \"\",\r\n            })\r\n          );\r\n        }\r\n        if (cmd.startsWith(\"coder templates presets list\")) {\r\n          const paramNames = options?.presetParamNames ?? [];\r\n          return createMockExecResult(\r\n            Promise.resolve({\r\n              stdout: JSON.stringify([\r\n                {\r\n                  TemplatePreset: {\r\n                    Name: \"preset\",\r\n                    Parameters: paramNames.map((name) => ({ Name: name })),\r\n                  },\r\n                },\r\n              ]),\r\n              stderr: \"\",\r\n            })\r\n          );\r\n        }\r\n        if (cmd.startsWith(\"coder tokens create --lifetime 5m --name\")) {\r\n          return createMockExecResult(Promise.resolve({ stdout: \"fake-token-123\", stderr: \"\" }));\r\n        }\r\n        if (cmd.startsWith(\"coder tokens delete\")) {\r\n          return createMockExecResult(Promise.resolve({ stdout: \"\", stderr: \"\" }));\r\n        }\r\n        // Fallback for any other command\r\n        return createMockExecResult(Promise.reject(new Error(`Unexpected command: ${cmd}`)));\r\n      });\r\n    }\r\n\r\n    // Helper to mock fetch for rich parameters API\r\n    function mockFetchRichParams(\r\n      params: Array<{\r\n        name: string;\r\n        default_value: string;\r\n        ephemeral?: boolean;\r\n        required?: boolean;\r\n      }>\r\n    ) {\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: true,\r\n        json: () => Promise.resolve(params),\r\n      }) as unknown as typeof fetch;\r\n    }\r\n\r\n    it(\"streams stdout/stderr lines and passes expected args\", async () => {\r\n      mockPrefetchCalls();\r\n      mockFetchRichParams([]);\r\n\r\n      const stdout = Readable.from([Buffer.from(\"out-1\\nout-2\\n\")]);\r\n      const stderr = Readable.from([Buffer.from(\"err-1\\n\")]);\r\n      const events = new EventEmitter();\r\n\r\n      spawnSpy!.mockReturnValue({\r\n        stdout,\r\n        stderr,\r\n        kill: vi.fn(),\r\n        on: events.on.bind(events),\r\n      } as never);\r\n\r\n      // Emit close after handlers are attached.\r\n      setTimeout(() => events.emit(\"close\", 0), 0);\r\n\r\n      const lines: string[] = [];\r\n      for await (const line of service.createWorkspace(\"my-workspace\", \"my-template\")) {\r\n        lines.push(line);\r\n      }\r\n\r\n      expect(spawnSpy).toHaveBeenCalledWith(\r\n        \"coder\",\r\n        [\"create\", \"my-workspace\", \"-t\", \"my-template\", \"--yes\"],\r\n        { stdio: [\"ignore\", \"pipe\", \"pipe\"] }\r\n      );\r\n\r\n      // First line is the command, rest are stdout/stderr\r\n      expect(lines[0]).toBe(\"$ coder create my-workspace -t my-template --yes\");\r\n      expect(lines.slice(1).sort()).toEqual([\"err-1\", \"out-1\", \"out-2\"]);\r\n    });\r\n\r\n    it(\"includes --preset when provided\", async () => {\r\n      mockPrefetchCalls({ presetParamNames: [\"covered-param\"] });\r\n      mockFetchRichParams([{ name: \"covered-param\", default_value: \"val\" }]);\r\n\r\n      const stdout = Readable.from([]);\r\n      const stderr = Readable.from([]);\r\n      const events = new EventEmitter();\r\n\r\n      spawnSpy!.mockReturnValue({\r\n        stdout,\r\n        stderr,\r\n        kill: vi.fn(),\r\n        on: events.on.bind(events),\r\n      } as never);\r\n\r\n      setTimeout(() => events.emit(\"close\", 0), 0);\r\n\r\n      for await (const _line of service.createWorkspace(\"ws\", \"tmpl\", \"preset\")) {\r\n        // drain\r\n      }\r\n\r\n      expect(spawnSpy).toHaveBeenCalledWith(\r\n        \"coder\",\r\n        [\"create\", \"ws\", \"-t\", \"tmpl\", \"--yes\", \"--preset\", \"preset\"],\r\n        { stdio: [\"ignore\", \"pipe\", \"pipe\"] }\r\n      );\r\n    });\r\n\r\n    it(\"includes --parameter flags for uncovered non-ephemeral params\", async () => {\r\n      mockPrefetchCalls({ presetParamNames: [\"covered-param\"] });\r\n      mockFetchRichParams([\r\n        { name: \"covered-param\", default_value: \"val1\" },\r\n        { name: \"uncovered-param\", default_value: \"val2\" },\r\n        { name: \"ephemeral-param\", default_value: \"val3\", ephemeral: true },\r\n      ]);\r\n\r\n      const stdout = Readable.from([]);\r\n      const stderr = Readable.from([]);\r\n      const events = new EventEmitter();\r\n\r\n      spawnSpy!.mockReturnValue({\r\n        stdout,\r\n        stderr,\r\n        kill: vi.fn(),\r\n        on: events.on.bind(events),\r\n      } as never);\r\n\r\n      setTimeout(() => events.emit(\"close\", 0), 0);\r\n\r\n      for await (const _line of service.createWorkspace(\"ws\", \"tmpl\", \"preset\")) {\r\n        // drain\r\n      }\r\n\r\n      expect(spawnSpy).toHaveBeenCalledWith(\r\n        \"coder\",\r\n        [\r\n          \"create\",\r\n          \"ws\",\r\n          \"-t\",\r\n          \"tmpl\",\r\n          \"--yes\",\r\n          \"--preset\",\r\n          \"preset\",\r\n          \"--parameter\",\r\n          \"uncovered-param=val2\",\r\n        ],\r\n        { stdio: [\"ignore\", \"pipe\", \"pipe\"] }\r\n      );\r\n    });\r\n\r\n    it(\"throws when exit code is non-zero\", async () => {\r\n      mockPrefetchCalls();\r\n      mockFetchRichParams([]);\r\n\r\n      const stdout = Readable.from([]);\r\n      const stderr = Readable.from([]);\r\n      const events = new EventEmitter();\r\n\r\n      spawnSpy!.mockReturnValue({\r\n        stdout,\r\n        stderr,\r\n        kill: vi.fn(),\r\n        on: events.on.bind(events),\r\n      } as never);\r\n\r\n      setTimeout(() => events.emit(\"close\", 42), 0);\r\n\r\n      let thrown: unknown;\r\n      try {\r\n        for await (const _line of service.createWorkspace(\"ws\", \"tmpl\")) {\r\n          // drain\r\n        }\r\n      } catch (error) {\r\n        thrown = error;\r\n      }\r\n\r\n      expect(thrown).toBeTruthy();\r\n      expect(thrown instanceof Error ? thrown.message : String(thrown)).toContain(\r\n        \"coder create failed (exit 42)\"\r\n      );\r\n    });\r\n\r\n    it(\"aborts before spawn when already aborted\", async () => {\r\n      const abortController = new AbortController();\r\n      abortController.abort();\r\n\r\n      let thrown: unknown;\r\n      try {\r\n        for await (const _line of service.createWorkspace(\r\n          \"ws\",\r\n          \"tmpl\",\r\n          undefined,\r\n          abortController.signal\r\n        )) {\r\n          // drain\r\n        }\r\n      } catch (error) {\r\n        thrown = error;\r\n      }\r\n\r\n      expect(thrown).toBeTruthy();\r\n      expect(thrown instanceof Error ? thrown.message : String(thrown)).toContain(\"aborted\");\r\n    });\r\n\r\n    it(\"throws when required param has no default and is not covered by preset\", async () => {\r\n      mockPrefetchCalls({ presetParamNames: [] });\r\n      mockFetchRichParams([{ name: \"required-param\", default_value: \"\", required: true }]);\r\n\r\n      let thrown: unknown;\r\n      try {\r\n        for await (const _line of service.createWorkspace(\"ws\", \"tmpl\")) {\r\n          // drain\r\n        }\r\n      } catch (error) {\r\n        thrown = error;\r\n      }\r\n\r\n      expect(thrown).toBeTruthy();\r\n      expect(thrown instanceof Error ? thrown.message : String(thrown)).toContain(\"required-param\");\r\n    });\r\n  });\r\n});\r\n\r\ndescribe(\"computeExtraParams\", () => {\r\n  let service: CoderService;\r\n\r\n  beforeEach(() => {\r\n    service = new CoderService();\r\n  });\r\n\r\n  it(\"returns empty array when all params are covered by preset\", () => {\r\n    const params = [\r\n      { name: \"param1\", defaultValue: \"val1\", type: \"string\", ephemeral: false, required: false },\r\n      { name: \"param2\", defaultValue: \"val2\", type: \"string\", ephemeral: false, required: false },\r\n    ];\r\n    const covered = new Set([\"param1\", \"param2\"]);\r\n\r\n    expect(service.computeExtraParams(params, covered)).toEqual([]);\r\n  });\r\n\r\n  it(\"returns uncovered non-ephemeral params with defaults\", () => {\r\n    const params = [\r\n      { name: \"covered\", defaultValue: \"val1\", type: \"string\", ephemeral: false, required: false },\r\n      {\r\n        name: \"uncovered\",\r\n        defaultValue: \"val2\",\r\n        type: \"string\",\r\n        ephemeral: false,\r\n        required: false,\r\n      },\r\n    ];\r\n    const covered = new Set([\"covered\"]);\r\n\r\n    expect(service.computeExtraParams(params, covered)).toEqual([\r\n      { name: \"uncovered\", encoded: \"uncovered=val2\" },\r\n    ]);\r\n  });\r\n\r\n  it(\"excludes ephemeral params\", () => {\r\n    const params = [\r\n      { name: \"normal\", defaultValue: \"val1\", type: \"string\", ephemeral: false, required: false },\r\n      { name: \"ephemeral\", defaultValue: \"val2\", type: \"string\", ephemeral: true, required: false },\r\n    ];\r\n    const covered = new Set<string>();\r\n\r\n    expect(service.computeExtraParams(params, covered)).toEqual([\r\n      { name: \"normal\", encoded: \"normal=val1\" },\r\n    ]);\r\n  });\r\n\r\n  it(\"includes params with empty default values\", () => {\r\n    const params = [\r\n      {\r\n        name: \"empty-default\",\r\n        defaultValue: \"\",\r\n        type: \"string\",\r\n        ephemeral: false,\r\n        required: false,\r\n      },\r\n    ];\r\n    const covered = new Set<string>();\r\n\r\n    expect(service.computeExtraParams(params, covered)).toEqual([\r\n      { name: \"empty-default\", encoded: \"empty-default=\" },\r\n    ]);\r\n  });\r\n\r\n  it(\"CSV-encodes list(string) values containing quotes\", () => {\r\n    const params = [\r\n      {\r\n        name: \"Select IDEs\",\r\n        defaultValue: '[\"vscode\",\"code-server\",\"cursor\"]',\r\n        type: \"list(string)\",\r\n        ephemeral: false,\r\n        required: false,\r\n      },\r\n    ];\r\n    const covered = new Set<string>();\r\n\r\n    // CLI uses CSV parsing, so quotes need escaping: \" -> \"\"\r\n    expect(service.computeExtraParams(params, covered)).toEqual([\r\n      { name: \"Select IDEs\", encoded: '\"Select IDEs=[\"\"vscode\"\",\"\"code-server\"\",\"\"cursor\"\"]\"' },\r\n    ]);\r\n  });\r\n\r\n  it(\"passes empty list(string) array without CSV encoding\", () => {\r\n    const params = [\r\n      {\r\n        name: \"empty-list\",\r\n        defaultValue: \"[]\",\r\n        type: \"list(string)\",\r\n        ephemeral: false,\r\n        required: false,\r\n      },\r\n    ];\r\n    const covered = new Set<string>();\r\n\r\n    // No quotes or commas, so no encoding needed\r\n    expect(service.computeExtraParams(params, covered)).toEqual([\r\n      { name: \"empty-list\", encoded: \"empty-list=[]\" },\r\n    ]);\r\n  });\r\n});\r\n\r\ndescribe(\"validateRequiredParams\", () => {\r\n  let service: CoderService;\r\n\r\n  beforeEach(() => {\r\n    service = new CoderService();\r\n  });\r\n\r\n  it(\"does not throw when all required params have defaults\", () => {\r\n    const params = [\r\n      {\r\n        name: \"required-with-default\",\r\n        defaultValue: \"val\",\r\n        type: \"string\",\r\n        ephemeral: false,\r\n        required: true,\r\n      },\r\n    ];\r\n    const covered = new Set<string>();\r\n\r\n    expect(() => service.validateRequiredParams(params, covered)).not.toThrow();\r\n  });\r\n\r\n  it(\"does not throw when required params are covered by preset\", () => {\r\n    const params = [\r\n      {\r\n        name: \"required-no-default\",\r\n        defaultValue: \"\",\r\n        type: \"string\",\r\n        ephemeral: false,\r\n        required: true,\r\n      },\r\n    ];\r\n    const covered = new Set([\"required-no-default\"]);\r\n\r\n    expect(() => service.validateRequiredParams(params, covered)).not.toThrow();\r\n  });\r\n\r\n  it(\"throws when required param has no default and is not covered\", () => {\r\n    const params = [\r\n      { name: \"missing-param\", defaultValue: \"\", type: \"string\", ephemeral: false, required: true },\r\n    ];\r\n    const covered = new Set<string>();\r\n\r\n    expect(() => service.validateRequiredParams(params, covered)).toThrow(\"missing-param\");\r\n  });\r\n\r\n  it(\"ignores ephemeral required params\", () => {\r\n    const params = [\r\n      {\r\n        name: \"ephemeral-required\",\r\n        defaultValue: \"\",\r\n        type: \"string\",\r\n        ephemeral: true,\r\n        required: true,\r\n      },\r\n    ];\r\n    const covered = new Set<string>();\r\n\r\n    expect(() => service.validateRequiredParams(params, covered)).not.toThrow();\r\n  });\r\n\r\n  it(\"lists all missing required params in error\", () => {\r\n    const params = [\r\n      { name: \"missing1\", defaultValue: \"\", type: \"string\", ephemeral: false, required: true },\r\n      { name: \"missing2\", defaultValue: \"\", type: \"string\", ephemeral: false, required: true },\r\n    ];\r\n    const covered = new Set<string>();\r\n\r\n    expect(() => service.validateRequiredParams(params, covered)).toThrow(\r\n      /missing1.*missing2|missing2.*missing1/\r\n    );\r\n  });\r\n});\r\n\r\ndescribe(\"non-string parameter defaults\", () => {\r\n  let service: CoderService;\r\n\r\n  beforeEach(() => {\r\n    service = new CoderService();\r\n  });\r\n\r\n  it(\"validateRequiredParams passes when required param has numeric default 0\", () => {\r\n    // After parseRichParameters, numeric 0 becomes \"0\" (not \"\")\r\n    const params = [\r\n      { name: \"count\", defaultValue: \"0\", type: \"number\", ephemeral: false, required: true },\r\n    ];\r\n    const covered = new Set<string>();\r\n\r\n    expect(() => service.validateRequiredParams(params, covered)).not.toThrow();\r\n  });\r\n\r\n  it(\"validateRequiredParams passes when required param has boolean default false\", () => {\r\n    // After parseRichParameters, boolean false becomes \"false\" (not \"\")\r\n    const params = [\r\n      { name: \"enabled\", defaultValue: \"false\", type: \"bool\", ephemeral: false, required: true },\r\n    ];\r\n    const covered = new Set<string>();\r\n\r\n    expect(() => service.validateRequiredParams(params, covered)).not.toThrow();\r\n  });\r\n\r\n  it(\"computeExtraParams emits numeric default correctly\", () => {\r\n    const params = [\r\n      { name: \"count\", defaultValue: \"42\", type: \"number\", ephemeral: false, required: false },\r\n    ];\r\n    const covered = new Set<string>();\r\n\r\n    expect(service.computeExtraParams(params, covered)).toEqual([\r\n      { name: \"count\", encoded: \"count=42\" },\r\n    ]);\r\n  });\r\n\r\n  it(\"computeExtraParams emits boolean default correctly\", () => {\r\n    const params = [\r\n      { name: \"enabled\", defaultValue: \"true\", type: \"bool\", ephemeral: false, required: false },\r\n    ];\r\n    const covered = new Set<string>();\r\n\r\n    expect(service.computeExtraParams(params, covered)).toEqual([\r\n      { name: \"enabled\", encoded: \"enabled=true\" },\r\n    ]);\r\n  });\r\n\r\n  it(\"computeExtraParams emits array default as JSON with CSV encoding\", () => {\r\n    // After parseRichParameters, array becomes JSON string\r\n    const params = [\r\n      {\r\n        name: \"tags\",\r\n        defaultValue: '[\"a\",\"b\"]',\r\n        type: \"list(string)\",\r\n        ephemeral: false,\r\n        required: false,\r\n      },\r\n    ];\r\n    const covered = new Set<string>();\r\n\r\n    // JSON array with quotes gets CSV-encoded (quotes escaped as \"\")\r\n    expect(service.computeExtraParams(params, covered)).toEqual([\r\n      { name: \"tags\", encoded: '\"tags=[\"\"a\"\",\"\"b\"\"]\"' },\r\n    ]);\r\n  });\r\n});\r\n\r\ndescribe(\"deleteWorkspace\", () => {\r\n  let service: CoderService;\r\n\r\n  beforeEach(() => {\r\n    service = new CoderService();\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  afterEach(() => {\r\n    service.clearCache();\r\n  });\r\n\r\n  // deleteWorkspace is a thin wrapper around deleteWorkspaceEventually.\r\n  // Detailed polling/retry behavior is tested in the deleteWorkspaceEventually suite.\r\n\r\n  it(\"delegates to deleteWorkspaceEventually with correct options\", async () => {\r\n    const spy = spyOn(service, \"deleteWorkspaceEventually\").mockResolvedValue({\r\n      success: true as const,\r\n      data: undefined,\r\n    });\r\n\r\n    await service.deleteWorkspace(\"mux-my-workspace\");\r\n\r\n    expect(spy).toHaveBeenCalledWith(\"mux-my-workspace\", {\r\n      timeoutMs: 30_000,\r\n      waitForExistence: false,\r\n    });\r\n  });\r\n\r\n  it(\"throws when deleteWorkspaceEventually returns an error\", async () => {\r\n    spyOn(service, \"deleteWorkspaceEventually\").mockResolvedValue({\r\n      success: false as const,\r\n      error: \"workspace stuck\",\r\n    });\r\n\r\n    let error: unknown;\r\n    try {\r\n      await service.deleteWorkspace(\"mux-my-workspace\");\r\n    } catch (err) {\r\n      error = err;\r\n    }\r\n\r\n    expect(error).toBeInstanceOf(Error);\r\n    expect((error as Error).message).toContain(\"workspace stuck\");\r\n  });\r\n});\r\n\r\ndescribe(\"deleteWorkspaceEventually\", () => {\r\n  it(\"polls past initial not_found when waitForExistence=true\", async () => {\r\n    const service = new CoderService();\r\n\r\n    const getWorkspaceStatusSpy = spyOn(service, \"getWorkspaceStatus\");\r\n    const statuses = [\r\n      { kind: \"not_found\" as const },\r\n      { kind: \"ok\" as const, status: \"pending\" as const },\r\n      { kind: \"ok\" as const, status: \"deleting\" as const },\r\n    ];\r\n    getWorkspaceStatusSpy.mockImplementation(() =>\r\n      Promise.resolve(statuses.shift() ?? { kind: \"ok\" as const, status: \"deleting\" as const })\r\n    );\r\n\r\n    const serviceHack = service as unknown as {\r\n      runCoderCommand: (\r\n        args: string[],\r\n        options: { timeoutMs: number; signal?: AbortSignal }\r\n      ) => Promise<{\r\n        exitCode: number | null;\r\n        stdout: string;\r\n        stderr: string;\r\n        error?: string;\r\n      }>;\r\n      sleep: (ms: number, signal?: AbortSignal) => Promise<void>;\r\n    };\r\n\r\n    serviceHack.runCoderCommand = vi.fn(() =>\r\n      Promise.resolve({ exitCode: 0, stdout: \"\", stderr: \"\" })\r\n    );\r\n    serviceHack.sleep = vi.fn(() => Promise.resolve());\r\n\r\n    const result = await service.deleteWorkspaceEventually(\"mux-my-workspace\", {\r\n      timeoutMs: 1_000,\r\n      waitForExistence: true,\r\n    });\r\n\r\n    expect(result.success).toBe(true);\r\n    expect(getWorkspaceStatusSpy.mock.calls.length).toBeGreaterThan(1);\r\n    expect(serviceHack.runCoderCommand).toHaveBeenCalled();\r\n  });\r\n\r\n  it(\"treats sustained not_found as success after timeout when waitForExistence=true\", async () => {\r\n    const service = new CoderService();\r\n\r\n    let now = 0;\r\n    const nowSpy = spyOn(Date, \"now\").mockImplementation(() => now);\r\n\r\n    const getWorkspaceStatusSpy = spyOn(service, \"getWorkspaceStatus\").mockResolvedValue({\r\n      kind: \"not_found\" as const,\r\n    });\r\n\r\n    const serviceHack = service as unknown as {\r\n      runCoderCommand: (\r\n        args: string[],\r\n        options: { timeoutMs: number; signal?: AbortSignal }\r\n      ) => Promise<{\r\n        exitCode: number | null;\r\n        stdout: string;\r\n        stderr: string;\r\n        error?: string;\r\n      }>;\r\n      sleep: (ms: number, signal?: AbortSignal) => Promise<void>;\r\n    };\r\n\r\n    serviceHack.runCoderCommand = vi.fn(() =>\r\n      Promise.resolve({ exitCode: 0, stdout: \"\", stderr: \"\" })\r\n    );\r\n    serviceHack.sleep = vi.fn((ms: number) => {\r\n      now += ms;\r\n      return Promise.resolve();\r\n    });\r\n\r\n    try {\r\n      const result = await service.deleteWorkspaceEventually(\"mux-my-workspace\", {\r\n        timeoutMs: 1_000,\r\n        waitForExistence: true,\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(getWorkspaceStatusSpy).toHaveBeenCalled();\r\n      expect(serviceHack.runCoderCommand).not.toHaveBeenCalled();\r\n    } finally {\r\n      // Reset Date.now even if the test fails.\r\n      nowSpy.mockRestore();\r\n    }\r\n  });\r\n\r\n  it(\"short-circuits on waitForExistenceTimeoutMs before overall timeout\", async () => {\r\n    const service = new CoderService();\r\n\r\n    let now = 0;\r\n    const nowSpy = spyOn(Date, \"now\").mockImplementation(() => now);\r\n\r\n    const getWorkspaceStatusSpy = spyOn(service, \"getWorkspaceStatus\").mockResolvedValue({\r\n      kind: \"not_found\" as const,\r\n    });\r\n\r\n    const serviceHack = service as unknown as {\r\n      runCoderCommand: (\r\n        args: string[],\r\n        options: { timeoutMs: number; signal?: AbortSignal }\r\n      ) => Promise<{\r\n        exitCode: number | null;\r\n        stdout: string;\r\n        stderr: string;\r\n        error?: string;\r\n      }>;\r\n      sleep: (ms: number, signal?: AbortSignal) => Promise<void>;\r\n    };\r\n\r\n    serviceHack.runCoderCommand = vi.fn(() =>\r\n      Promise.resolve({ exitCode: 0, stdout: \"\", stderr: \"\" })\r\n    );\r\n    serviceHack.sleep = vi.fn((ms: number) => {\r\n      now += ms;\r\n      return Promise.resolve();\r\n    });\r\n\r\n    try {\r\n      const result = await service.deleteWorkspaceEventually(\"mux-my-workspace\", {\r\n        timeoutMs: 60_000,\r\n        waitForExistence: true,\r\n        // Short existence-wait window: succeed after ~5s of only not_found\r\n        waitForExistenceTimeoutMs: 5_000,\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(getWorkspaceStatusSpy).toHaveBeenCalled();\r\n      // Should never attempt `coder delete` since we only saw not_found\r\n      expect(serviceHack.runCoderCommand).not.toHaveBeenCalled();\r\n      // Should have returned well before the 60s overall timeout\r\n      expect(now).toBeLessThan(10_000);\r\n    } finally {\r\n      nowSpy.mockRestore();\r\n    }\r\n  });\r\n\r\n  it(\"treats a successful delete as terminal even if status polling errors\", async () => {\r\n    const service = new CoderService();\r\n\r\n    spyOn(service, \"getWorkspaceStatus\").mockResolvedValue({\r\n      kind: \"error\" as const,\r\n      error: \"auth failed\",\r\n    });\r\n\r\n    const serviceHack = service as unknown as {\r\n      runCoderCommand: (\r\n        args: string[],\r\n        options: { timeoutMs: number; signal?: AbortSignal }\r\n      ) => Promise<{\r\n        exitCode: number | null;\r\n        stdout: string;\r\n        stderr: string;\r\n        error?: string;\r\n      }>;\r\n      sleep: (ms: number, signal?: AbortSignal) => Promise<void>;\r\n    };\r\n\r\n    serviceHack.runCoderCommand = vi.fn(() =>\r\n      Promise.resolve({ exitCode: 0, stdout: \"\", stderr: \"\" })\r\n    );\r\n    serviceHack.sleep = vi.fn(() => Promise.resolve());\r\n\r\n    const result = await service.deleteWorkspaceEventually(\"mux-my-workspace\", {\r\n      timeoutMs: 60_000,\r\n      waitForExistence: false,\r\n    });\r\n\r\n    expect(result.success).toBe(true);\r\n    expect(serviceHack.runCoderCommand).toHaveBeenCalledTimes(1);\r\n    expect(serviceHack.sleep).not.toHaveBeenCalled();\r\n  });\r\n\r\n  it(\"treats a successful delete as terminal even when waitForExistence=true\", async () => {\r\n    const service = new CoderService();\r\n\r\n    spyOn(service, \"getWorkspaceStatus\").mockResolvedValue({\r\n      kind: \"error\" as const,\r\n      error: \"auth failed\",\r\n    });\r\n\r\n    const serviceHack = service as unknown as {\r\n      runCoderCommand: (\r\n        args: string[],\r\n        options: { timeoutMs: number; signal?: AbortSignal }\r\n      ) => Promise<{\r\n        exitCode: number | null;\r\n        stdout: string;\r\n        stderr: string;\r\n        error?: string;\r\n      }>;\r\n      sleep: (ms: number, signal?: AbortSignal) => Promise<void>;\r\n    };\r\n\r\n    serviceHack.runCoderCommand = vi.fn(() =>\r\n      Promise.resolve({ exitCode: 0, stdout: \"\", stderr: \"\" })\r\n    );\r\n    serviceHack.sleep = vi.fn(() => Promise.resolve());\r\n\r\n    const result = await service.deleteWorkspaceEventually(\"mux-my-workspace\", {\r\n      timeoutMs: 60_000,\r\n      waitForExistence: true,\r\n    });\r\n\r\n    expect(result.success).toBe(true);\r\n    expect(serviceHack.runCoderCommand).toHaveBeenCalledTimes(1);\r\n    expect(serviceHack.sleep).not.toHaveBeenCalled();\r\n  });\r\n});\r\n\r\ndescribe(\"compareVersions\", () => {\r\n  it(\"returns 0 for equal versions\", () => {\r\n    expect(compareVersions(\"2.28.6\", \"2.28.6\")).toBe(0);\r\n  });\r\n\r\n  it(\"returns 0 for equal versions with different formats\", () => {\r\n    expect(compareVersions(\"v2.28.6\", \"2.28.6\")).toBe(0);\r\n    expect(compareVersions(\"v2.28.6+hash\", \"2.28.6\")).toBe(0);\r\n  });\r\n\r\n  it(\"returns negative when first version is older\", () => {\r\n    expect(compareVersions(\"2.25.0\", \"2.28.6\")).toBeLessThan(0);\r\n    expect(compareVersions(\"2.28.5\", \"2.28.6\")).toBeLessThan(0);\r\n    expect(compareVersions(\"1.0.0\", \"2.0.0\")).toBeLessThan(0);\r\n  });\r\n\r\n  it(\"returns positive when first version is newer\", () => {\r\n    expect(compareVersions(\"2.28.6\", \"2.25.0\")).toBeGreaterThan(0);\r\n    expect(compareVersions(\"2.28.6\", \"2.28.5\")).toBeGreaterThan(0);\r\n    expect(compareVersions(\"3.0.0\", \"2.28.6\")).toBeGreaterThan(0);\r\n  });\r\n\r\n  it(\"handles versions with v prefix\", () => {\r\n    expect(compareVersions(\"v2.28.6\", \"2.25.0\")).toBeGreaterThan(0);\r\n    expect(compareVersions(\"v2.25.0\", \"v2.28.6\")).toBeLessThan(0);\r\n  });\r\n\r\n  it(\"handles dev versions correctly\", () => {\r\n    // v2.28.2-devel+903c045b9 should be compared as 2.28.2\r\n    expect(compareVersions(\"v2.28.2-devel+903c045b9\", \"2.25.0\")).toBeGreaterThan(0);\r\n    expect(compareVersions(\"v2.28.2-devel+903c045b9\", \"2.28.2\")).toBe(0);\r\n  });\r\n\r\n  it(\"handles missing patch version\", () => {\r\n    expect(compareVersions(\"2.28\", \"2.28.0\")).toBe(0);\r\n    expect(compareVersions(\"2.28\", \"2.28.1\")).toBeLessThan(0);\r\n  });\r\n});\r\n"]}