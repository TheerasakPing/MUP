{"version":3,"file":"workspaceMcpOverridesService.js","sourceRoot":"","sources":["../../../src/node/services/workspaceMcpOverridesService.ts"],"names":[],"mappings":"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","sourcesContent":["import * as path from \"path\";\nimport * as jsonc from \"jsonc-parser\";\nimport assert from \"@/common/utils/assert\";\nimport type { WorkspaceMCPOverrides } from \"@/common/types/mcp\";\nimport type { RuntimeConfig } from \"@/common/types/runtime\";\nimport type { FrontendWorkspaceMetadata } from \"@/common/types/workspace\";\nimport type { Config } from \"@/node/config\";\nimport { type createRuntime } from \"@/node/runtime/runtimeFactory\";\nimport { createRuntimeForWorkspace } from \"@/node/runtime/runtimeHelpers\";\nimport { execBuffered, readFileString, writeFileString } from \"@/node/utils/runtime/helpers\";\nimport { log } from \"@/node/services/log\";\n\nconst MCP_OVERRIDES_DIR = \".mux\";\nconst MCP_OVERRIDES_JSONC = \"mcp.local.jsonc\";\nconst MCP_OVERRIDES_JSON = \"mcp.local.json\";\n\nconst MCP_OVERRIDES_GITIGNORE_PATTERNS = [\n  `${MCP_OVERRIDES_DIR}/${MCP_OVERRIDES_JSONC}`,\n  `${MCP_OVERRIDES_DIR}/${MCP_OVERRIDES_JSON}`,\n];\n\nfunction joinForRuntime(runtimeConfig: RuntimeConfig | undefined, ...parts: string[]): string {\n  assert(parts.length > 0, \"joinForRuntime requires at least one path segment\");\n\n  // Remote runtimes run inside a POSIX shell (SSH host, Docker container), even if the user is\n  // running mux on Windows. Use POSIX joins so we don't accidentally introduce backslashes.\n  const usePosix = runtimeConfig?.type === \"ssh\" || runtimeConfig?.type === \"docker\";\n  return usePosix ? path.posix.join(...parts) : path.join(...parts);\n}\n\nfunction isAbsoluteForRuntime(runtimeConfig: RuntimeConfig | undefined, filePath: string): boolean {\n  const usePosix = runtimeConfig?.type === \"ssh\" || runtimeConfig?.type === \"docker\";\n  return usePosix ? path.posix.isAbsolute(filePath) : path.isAbsolute(filePath);\n}\n\nfunction isStringArray(value: unknown): value is string[] {\n  return Array.isArray(value) && value.every((v) => typeof v === \"string\");\n}\n\nfunction normalizeWorkspaceMcpOverrides(raw: unknown): WorkspaceMCPOverrides {\n  if (!raw || typeof raw !== \"object\") {\n    return {};\n  }\n\n  const obj = raw as {\n    disabledServers?: unknown;\n    enabledServers?: unknown;\n    toolAllowlist?: unknown;\n  };\n\n  const disabledServers = isStringArray(obj.disabledServers)\n    ? [...new Set(obj.disabledServers.map((s) => s.trim()).filter(Boolean))]\n    : undefined;\n\n  const enabledServers = isStringArray(obj.enabledServers)\n    ? [...new Set(obj.enabledServers.map((s) => s.trim()).filter(Boolean))]\n    : undefined;\n\n  let toolAllowlist: Record<string, string[]> | undefined;\n  if (\n    obj.toolAllowlist &&\n    typeof obj.toolAllowlist === \"object\" &&\n    !Array.isArray(obj.toolAllowlist)\n  ) {\n    const next: Record<string, string[]> = {};\n    for (const [serverName, value] of Object.entries(\n      obj.toolAllowlist as Record<string, unknown>\n    )) {\n      if (!serverName || typeof serverName !== \"string\") continue;\n      if (!isStringArray(value)) continue;\n\n      // Empty array is meaningful (\"expose no tools\"), so keep it.\n      next[serverName] = [...new Set(value.map((t) => t.trim()).filter((t) => t.length > 0))];\n    }\n\n    if (Object.keys(next).length > 0) {\n      toolAllowlist = next;\n    }\n  }\n\n  const normalized: WorkspaceMCPOverrides = {\n    disabledServers: disabledServers && disabledServers.length > 0 ? disabledServers : undefined,\n    enabledServers: enabledServers && enabledServers.length > 0 ? enabledServers : undefined,\n    toolAllowlist,\n  };\n\n  // Drop empty object to keep persistence clean.\n  if (!normalized.disabledServers && !normalized.enabledServers && !normalized.toolAllowlist) {\n    return {};\n  }\n\n  return normalized;\n}\n\nfunction isEmptyOverrides(overrides: WorkspaceMCPOverrides): boolean {\n  return (\n    (!overrides.disabledServers || overrides.disabledServers.length === 0) &&\n    (!overrides.enabledServers || overrides.enabledServers.length === 0) &&\n    (!overrides.toolAllowlist || Object.keys(overrides.toolAllowlist).length === 0)\n  );\n}\n\nasync function statIsFile(\n  runtime: ReturnType<typeof createRuntime>,\n  filePath: string\n): Promise<boolean> {\n  try {\n    const stat = await runtime.stat(filePath);\n    return !stat.isDirectory;\n  } catch {\n    return false;\n  }\n}\n\nexport class WorkspaceMcpOverridesService {\n  constructor(private readonly config: Config) {\n    assert(config, \"WorkspaceMcpOverridesService requires a Config instance\");\n  }\n\n  private async getWorkspaceMetadata(workspaceId: string): Promise<FrontendWorkspaceMetadata> {\n    assert(typeof workspaceId === \"string\", \"workspaceId must be a string\");\n    const trimmed = workspaceId.trim();\n    assert(trimmed.length > 0, \"workspaceId must not be empty\");\n\n    const all = await this.config.getAllWorkspaceMetadata();\n    const metadata = all.find((m) => m.id === trimmed);\n    if (!metadata) {\n      throw new Error(`Workspace metadata not found for ${trimmed}`);\n    }\n\n    return metadata;\n  }\n\n  private getLegacyOverridesFromConfig(workspaceId: string): WorkspaceMCPOverrides | undefined {\n    const config = this.config.loadConfigOrDefault();\n\n    for (const [_projectPath, projectConfig] of config.projects) {\n      const workspace = projectConfig.workspaces.find((w) => w.id === workspaceId);\n      if (workspace) {\n        // NOTE: Legacy storage (PR #1180) wrote overrides into ~/.mux/config.json.\n        // We keep reading it here only to migrate into the workspace-local file.\n        return workspace.mcp;\n      }\n    }\n\n    return undefined;\n  }\n\n  private async clearLegacyOverridesInConfig(workspaceId: string): Promise<void> {\n    await this.config.editConfig((config) => {\n      for (const [_projectPath, projectConfig] of config.projects) {\n        const workspace = projectConfig.workspaces.find((w) => w.id === workspaceId);\n        if (workspace) {\n          delete workspace.mcp;\n          return config;\n        }\n      }\n      return config;\n    });\n  }\n\n  private async getRuntimeAndWorkspacePath(workspaceId: string): Promise<{\n    metadata: FrontendWorkspaceMetadata;\n    runtime: ReturnType<typeof createRuntime>;\n    workspacePath: string;\n  }> {\n    const metadata = await this.getWorkspaceMetadata(workspaceId);\n\n    const runtime = createRuntimeForWorkspace(metadata);\n\n    // In-place workspaces (CLI/benchmarks) store the workspace path directly by setting\n    // metadata.projectPath === metadata.name.\n    const isInPlace = metadata.projectPath === metadata.name;\n    const workspacePath = isInPlace\n      ? metadata.projectPath\n      : runtime.getWorkspacePath(metadata.projectPath, metadata.name);\n\n    assert(\n      typeof workspacePath === \"string\" && workspacePath.length > 0,\n      \"workspacePath is required\"\n    );\n\n    return { metadata, runtime, workspacePath };\n  }\n\n  private getOverridesFilePaths(\n    workspacePath: string,\n    runtimeConfig: RuntimeConfig | undefined\n  ): {\n    jsoncPath: string;\n    jsonPath: string;\n  } {\n    assert(typeof workspacePath === \"string\", \"workspacePath must be a string\");\n\n    return {\n      jsoncPath: joinForRuntime(\n        runtimeConfig,\n        workspacePath,\n        MCP_OVERRIDES_DIR,\n        MCP_OVERRIDES_JSONC\n      ),\n      jsonPath: joinForRuntime(runtimeConfig, workspacePath, MCP_OVERRIDES_DIR, MCP_OVERRIDES_JSON),\n    };\n  }\n\n  private async readOverridesFile(\n    runtime: ReturnType<typeof createRuntime>,\n    filePath: string\n  ): Promise<unknown> {\n    try {\n      const raw = await readFileString(runtime, filePath);\n      const errors: jsonc.ParseError[] = [];\n      const parsed: unknown = jsonc.parse(raw, errors) as unknown;\n      if (errors.length > 0) {\n        log.warn(\"[MCP] Failed to parse workspace MCP overrides (JSONC parse errors)\", {\n          filePath,\n          errorCount: errors.length,\n        });\n        return {};\n      }\n      return parsed;\n    } catch (error) {\n      // Treat any read failure as \"no overrides\".\n      log.debug(\"[MCP] Failed to read workspace MCP overrides file\", { filePath, error });\n      return {};\n    }\n  }\n\n  private async ensureOverridesDir(\n    runtime: ReturnType<typeof createRuntime>,\n    workspacePath: string,\n    runtimeConfig: RuntimeConfig | undefined\n  ): Promise<void> {\n    const overridesDirPath = joinForRuntime(runtimeConfig, workspacePath, MCP_OVERRIDES_DIR);\n\n    try {\n      await runtime.ensureDir(overridesDirPath);\n    } catch (err) {\n      const msg = err instanceof Error ? err.message : String(err);\n      throw new Error(`Failed to create ${MCP_OVERRIDES_DIR} directory: ${msg}`);\n    }\n  }\n\n  private async ensureOverridesGitignored(\n    runtime: ReturnType<typeof createRuntime>,\n    workspacePath: string,\n    runtimeConfig: RuntimeConfig | undefined\n  ): Promise<void> {\n    try {\n      const isInsideGitResult = await execBuffered(runtime, \"git rev-parse --is-inside-work-tree\", {\n        cwd: workspacePath,\n        timeout: 10,\n      });\n      if (isInsideGitResult.exitCode !== 0 || isInsideGitResult.stdout.trim() !== \"true\") {\n        return;\n      }\n\n      const excludePathResult = await execBuffered(\n        runtime,\n        \"git rev-parse --git-path info/exclude\",\n        {\n          cwd: workspacePath,\n          timeout: 10,\n        }\n      );\n      if (excludePathResult.exitCode !== 0) {\n        return;\n      }\n\n      const excludeFilePathRaw = excludePathResult.stdout.trim();\n      if (excludeFilePathRaw.length === 0) {\n        return;\n      }\n\n      const excludeFilePath = isAbsoluteForRuntime(runtimeConfig, excludeFilePathRaw)\n        ? excludeFilePathRaw\n        : joinForRuntime(runtimeConfig, workspacePath, excludeFilePathRaw);\n\n      let existing = \"\";\n      try {\n        existing = await readFileString(runtime, excludeFilePath);\n      } catch {\n        // Missing exclude file is OK.\n      }\n\n      const existingPatterns = new Set(\n        existing\n          .split(/\\r?\\n/)\n          .map((line) => line.trim())\n          .filter((line) => line.length > 0)\n      );\n      const missingPatterns = MCP_OVERRIDES_GITIGNORE_PATTERNS.filter(\n        (pattern) => !existingPatterns.has(pattern)\n      );\n      if (missingPatterns.length === 0) {\n        return;\n      }\n\n      const needsNewline = existing.length > 0 && !existing.endsWith(\"\\n\");\n      const updated = existing + (needsNewline ? \"\\n\" : \"\") + missingPatterns.join(\"\\n\") + \"\\n\";\n\n      await writeFileString(runtime, excludeFilePath, updated);\n    } catch (error) {\n      // Best-effort only; never fail a workspace operation because git ignore couldn't be updated.\n      log.debug(\"[MCP] Failed to add workspace MCP overrides file to git exclude\", {\n        workspacePath,\n        error,\n      });\n    }\n  }\n\n  private async removeOverridesFile(\n    runtime: ReturnType<typeof createRuntime>,\n    workspacePath: string\n  ): Promise<void> {\n    // Best-effort: remove both file names so we never leave conflicting sources behind.\n    await execBuffered(\n      runtime,\n      `rm -f \"${MCP_OVERRIDES_DIR}/${MCP_OVERRIDES_JSONC}\" \"${MCP_OVERRIDES_DIR}/${MCP_OVERRIDES_JSON}\"`,\n      {\n        cwd: workspacePath,\n        timeout: 10,\n      }\n    );\n  }\n\n  /**\n   * Read workspace MCP overrides from <workspace>/.mux/mcp.local.jsonc.\n   *\n   * If the file doesn't exist, we fall back to legacy overrides stored in ~/.mux/config.json\n   * and migrate them into the workspace-local file.\n   */\n  async getOverridesForWorkspace(workspaceId: string): Promise<WorkspaceMCPOverrides> {\n    const { metadata, runtime, workspacePath } = await this.getRuntimeAndWorkspacePath(workspaceId);\n    const { jsoncPath, jsonPath } = this.getOverridesFilePaths(\n      workspacePath,\n      metadata.runtimeConfig\n    );\n\n    // Prefer JSONC, then JSON.\n    const jsoncExists = await statIsFile(runtime, jsoncPath);\n    if (jsoncExists) {\n      const parsed = await this.readOverridesFile(runtime, jsoncPath);\n      return normalizeWorkspaceMcpOverrides(parsed);\n    }\n\n    const jsonExists = await statIsFile(runtime, jsonPath);\n    if (jsonExists) {\n      const parsed = await this.readOverridesFile(runtime, jsonPath);\n      return normalizeWorkspaceMcpOverrides(parsed);\n    }\n\n    // No workspace-local file => try migrating legacy config.json storage.\n    const legacy = this.getLegacyOverridesFromConfig(workspaceId);\n    if (!legacy || isEmptyOverrides(legacy)) {\n      return {};\n    }\n\n    const normalizedLegacy = normalizeWorkspaceMcpOverrides(legacy);\n    if (isEmptyOverrides(normalizedLegacy)) {\n      return {};\n    }\n\n    try {\n      await this.ensureOverridesDir(runtime, workspacePath, metadata.runtimeConfig);\n      await writeFileString(runtime, jsoncPath, JSON.stringify(normalizedLegacy, null, 2) + \"\\n\");\n      await this.ensureOverridesGitignored(runtime, workspacePath, metadata.runtimeConfig);\n      await this.clearLegacyOverridesInConfig(workspaceId);\n      log.info(\"[MCP] Migrated workspace MCP overrides from config.json\", {\n        workspaceId,\n        filePath: jsoncPath,\n      });\n    } catch (error) {\n      // Migration is best-effort; if it fails, still honor legacy overrides.\n      log.warn(\"[MCP] Failed to migrate workspace MCP overrides; using legacy config.json values\", {\n        workspaceId,\n        error,\n      });\n    }\n\n    return normalizedLegacy;\n  }\n\n  /**\n   * Persist workspace MCP overrides to <workspace>/.mux/mcp.local.jsonc.\n   *\n   * Empty overrides remove the workspace-local file.\n   */\n  async setOverridesForWorkspace(\n    workspaceId: string,\n    overrides: WorkspaceMCPOverrides\n  ): Promise<void> {\n    assert(overrides && typeof overrides === \"object\", \"overrides must be an object\");\n\n    const { metadata, runtime, workspacePath } = await this.getRuntimeAndWorkspacePath(workspaceId);\n    const { jsoncPath } = this.getOverridesFilePaths(workspacePath, metadata.runtimeConfig);\n\n    const normalized = normalizeWorkspaceMcpOverrides(overrides);\n\n    // Always clear any legacy storage so we converge on the workspace-local file.\n    await this.clearLegacyOverridesInConfig(workspaceId);\n\n    if (isEmptyOverrides(normalized)) {\n      await this.removeOverridesFile(runtime, workspacePath);\n      return;\n    }\n\n    await this.ensureOverridesDir(runtime, workspacePath, metadata.runtimeConfig);\n    await writeFileString(runtime, jsoncPath, JSON.stringify(normalized, null, 2) + \"\\n\");\n    await this.ensureOverridesGitignored(runtime, workspacePath, metadata.runtimeConfig);\n  }\n}\n"]}