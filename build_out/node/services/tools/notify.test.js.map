{"version":3,"file":"notify.test.js","sourceRoot":"","sources":["../../../../src/node/services/tools/notify.test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Tests for notify tool - system notification integration\r\n *\r\n * The notify tool allows AI agents to send system notifications to the user.\r\n * Notifications appear as OS-native notifications (macOS Notification Center, Windows Toast, etc.)\r\n *\r\n * These tests verify the tool's behavior in non-Electron environments (bun test).\r\n * Full integration testing with actual system notifications requires running in Electron.\r\n */\r\n\r\nimport { describe, it, expect, beforeEach } from \"bun:test\";\r\nimport { createNotifyTool } from \"./notify\";\r\nimport { createTestToolConfig, TestTempDir } from \"./testHelpers\";\r\nimport type { ToolConfiguration } from \"@/common/utils/tools/tools\";\r\nimport type { NotifyToolResult } from \"@/common/types/tools\";\r\n\r\ndescribe(\"notify tool\", () => {\r\n  let config: ToolConfiguration;\r\n  let tempDir: TestTempDir;\r\n\r\n  beforeEach(() => {\r\n    tempDir = new TestTempDir(\"notify-test\");\r\n    config = createTestToolConfig(tempDir.path);\r\n  });\r\n\r\n  it(\"should create a tool with correct schema\", () => {\r\n    const tool = createNotifyTool(config);\r\n    expect(tool).toBeDefined();\r\n    expect(tool.description).toContain(\"notification\");\r\n  });\r\n\r\n  it(\"should reject empty title\", async () => {\r\n    const tool = createNotifyTool(config);\r\n    const execute = tool.execute as (args: {\r\n      title: string;\r\n      message?: string;\r\n    }) => Promise<NotifyToolResult>;\r\n\r\n    const result = await execute({\r\n      title: \"\",\r\n      message: \"Some message\",\r\n    });\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"title\");\r\n    }\r\n  });\r\n\r\n  it(\"should reject whitespace-only title\", async () => {\r\n    const tool = createNotifyTool(config);\r\n    const execute = tool.execute as (args: {\r\n      title: string;\r\n      message?: string;\r\n    }) => Promise<NotifyToolResult>;\r\n\r\n    const result = await execute({\r\n      title: \"   \",\r\n      message: \"Some message\",\r\n    });\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"title\");\r\n    }\r\n  });\r\n\r\n  it(\"should return browser fallback in non-Electron environment\", async () => {\r\n    // When running in bun:test (not Electron), tool returns success with browser fallback\r\n    const tool = createNotifyTool(config);\r\n    const execute = tool.execute as (args: {\r\n      title: string;\r\n      message?: string;\r\n    }) => Promise<NotifyToolResult>;\r\n\r\n    const result = await execute({\r\n      title: \"Test Notification\",\r\n      message: \"This is a test\",\r\n    });\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.ui_only?.notify?.notifiedVia).toBe(\"browser\");\r\n      expect(result.title).toBe(\"Test Notification\");\r\n      expect(result.message).toBe(\"This is a test\");\r\n    }\r\n  });\r\n\r\n  it(\"should handle title-only notification (no message)\", async () => {\r\n    const tool = createNotifyTool(config);\r\n    const execute = tool.execute as (args: {\r\n      title: string;\r\n      message?: string;\r\n    }) => Promise<NotifyToolResult>;\r\n\r\n    const result = await execute({\r\n      title: \"Test Notification\",\r\n    });\r\n\r\n    // In non-Electron, returns success with browser fallback\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.ui_only?.notify?.notifiedVia).toBe(\"browser\");\r\n      expect(result.title).toBe(\"Test Notification\");\r\n      expect(result.message).toBeUndefined();\r\n    }\r\n  });\r\n\r\n  it(\"should include workspaceId in result when provided in config\", async () => {\r\n    const configWithWorkspace = {\r\n      ...config,\r\n      workspaceId: \"test-workspace-123\",\r\n    };\r\n    const tool = createNotifyTool(configWithWorkspace);\r\n    const execute = tool.execute as (args: {\r\n      title: string;\r\n      message?: string;\r\n    }) => Promise<NotifyToolResult>;\r\n\r\n    const result = await execute({\r\n      title: \"Test Notification\",\r\n    });\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.ui_only?.notify?.workspaceId).toBe(\"test-workspace-123\");\r\n    }\r\n  });\r\n});\r\n"]}