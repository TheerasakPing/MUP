{"version":3,"file":"notify.test.js","sourceRoot":"","sources":["../../../../src/node/services/tools/notify.test.ts"],"names":[],"mappings":";AAAA;;;;;;;;GAQG;;AAEH,uCAA4D;AAC5D,qCAA4C;AAC5C,+CAAkE;AAIlE,IAAA,mBAAQ,EAAC,aAAa,EAAE,GAAG,EAAE,CAAC;IAC5B,IAAI,MAAyB,CAAC;IAC9B,IAAI,OAAoB,CAAC;IAEzB,IAAA,qBAAU,EAAC,GAAG,EAAE,CAAC;QACf,OAAO,GAAG,IAAI,yBAAW,CAAC,aAAa,CAAC,CAAC;QACzC,MAAM,GAAG,IAAA,kCAAoB,EAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IAAA,CAC7C,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,0CAA0C,EAAE,GAAG,EAAE,CAAC;QACnD,MAAM,IAAI,GAAG,IAAA,yBAAgB,EAAC,MAAM,CAAC,CAAC;QACtC,IAAA,iBAAM,EAAC,IAAI,CAAC,CAAC,WAAW,EAAE,CAAC;QAC3B,IAAA,iBAAM,EAAC,IAAI,CAAC,WAAW,CAAC,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC;IAAA,CACpD,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,2BAA2B,EAAE,KAAK,IAAI,EAAE,CAAC;QAC1C,MAAM,IAAI,GAAG,IAAA,yBAAgB,EAAC,MAAM,CAAC,CAAC;QACtC,MAAM,OAAO,GAAG,IAAI,CAAC,OAGU,CAAC;QAEhC,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC;YAC3B,KAAK,EAAE,EAAE;YACT,OAAO,EAAE,cAAc;SACxB,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACnC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;YACpB,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;QAC1C,CAAC;IAAA,CACF,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,qCAAqC,EAAE,KAAK,IAAI,EAAE,CAAC;QACpD,MAAM,IAAI,GAAG,IAAA,yBAAgB,EAAC,MAAM,CAAC,CAAC;QACtC,MAAM,OAAO,GAAG,IAAI,CAAC,OAGU,CAAC;QAEhC,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC;YAC3B,KAAK,EAAE,KAAK;YACZ,OAAO,EAAE,cAAc;SACxB,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACnC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;YACpB,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;QAC1C,CAAC;IAAA,CACF,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,4DAA4D,EAAE,KAAK,IAAI,EAAE,CAAC;QAC3E,sFAAsF;QACtF,MAAM,IAAI,GAAG,IAAA,yBAAgB,EAAC,MAAM,CAAC,CAAC;QACtC,MAAM,OAAO,GAAG,IAAI,CAAC,OAGU,CAAC;QAEhC,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC;YAC3B,KAAK,EAAE,mBAAmB;YAC1B,OAAO,EAAE,gBAAgB;SAC1B,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClC,IAAI,MAAM,CAAC,OAAO,EAAE,CAAC;YACnB,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,EAAE,MAAM,EAAE,WAAW,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAC5D,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;YAC/C,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAChD,CAAC;IAAA,CACF,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,oDAAoD,EAAE,KAAK,IAAI,EAAE,CAAC;QACnE,MAAM,IAAI,GAAG,IAAA,yBAAgB,EAAC,MAAM,CAAC,CAAC;QACtC,MAAM,OAAO,GAAG,IAAI,CAAC,OAGU,CAAC;QAEhC,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC;YAC3B,KAAK,EAAE,mBAAmB;SAC3B,CAAC,CAAC;QAEH,yDAAyD;QACzD,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClC,IAAI,MAAM,CAAC,OAAO,EAAE,CAAC;YACnB,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,EAAE,MAAM,EAAE,WAAW,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAC5D,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;YAC/C,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,aAAa,EAAE,CAAC;QACzC,CAAC;IAAA,CACF,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,8DAA8D,EAAE,KAAK,IAAI,EAAE,CAAC;QAC7E,MAAM,mBAAmB,GAAG;YAC1B,GAAG,MAAM;YACT,WAAW,EAAE,oBAAoB;SAClC,CAAC;QACF,MAAM,IAAI,GAAG,IAAA,yBAAgB,EAAC,mBAAmB,CAAC,CAAC;QACnD,MAAM,OAAO,GAAG,IAAI,CAAC,OAGU,CAAC;QAEhC,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC;YAC3B,KAAK,EAAE,mBAAmB;SAC3B,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClC,IAAI,MAAM,CAAC,OAAO,EAAE,CAAC;YACnB,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,EAAE,MAAM,EAAE,WAAW,CAAC,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;QACzE,CAAC;IAAA,CACF,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["/**\n * Tests for notify tool - system notification integration\n *\n * The notify tool allows AI agents to send system notifications to the user.\n * Notifications appear as OS-native notifications (macOS Notification Center, Windows Toast, etc.)\n *\n * These tests verify the tool's behavior in non-Electron environments (bun test).\n * Full integration testing with actual system notifications requires running in Electron.\n */\n\nimport { describe, it, expect, beforeEach } from \"bun:test\";\nimport { createNotifyTool } from \"./notify\";\nimport { createTestToolConfig, TestTempDir } from \"./testHelpers\";\nimport type { ToolConfiguration } from \"@/common/utils/tools/tools\";\nimport type { NotifyToolResult } from \"@/common/types/tools\";\n\ndescribe(\"notify tool\", () => {\n  let config: ToolConfiguration;\n  let tempDir: TestTempDir;\n\n  beforeEach(() => {\n    tempDir = new TestTempDir(\"notify-test\");\n    config = createTestToolConfig(tempDir.path);\n  });\n\n  it(\"should create a tool with correct schema\", () => {\n    const tool = createNotifyTool(config);\n    expect(tool).toBeDefined();\n    expect(tool.description).toContain(\"notification\");\n  });\n\n  it(\"should reject empty title\", async () => {\n    const tool = createNotifyTool(config);\n    const execute = tool.execute as (args: {\n      title: string;\n      message?: string;\n    }) => Promise<NotifyToolResult>;\n\n    const result = await execute({\n      title: \"\",\n      message: \"Some message\",\n    });\n\n    expect(result.success).toBe(false);\n    if (!result.success) {\n      expect(result.error).toContain(\"title\");\n    }\n  });\n\n  it(\"should reject whitespace-only title\", async () => {\n    const tool = createNotifyTool(config);\n    const execute = tool.execute as (args: {\n      title: string;\n      message?: string;\n    }) => Promise<NotifyToolResult>;\n\n    const result = await execute({\n      title: \"   \",\n      message: \"Some message\",\n    });\n\n    expect(result.success).toBe(false);\n    if (!result.success) {\n      expect(result.error).toContain(\"title\");\n    }\n  });\n\n  it(\"should return browser fallback in non-Electron environment\", async () => {\n    // When running in bun:test (not Electron), tool returns success with browser fallback\n    const tool = createNotifyTool(config);\n    const execute = tool.execute as (args: {\n      title: string;\n      message?: string;\n    }) => Promise<NotifyToolResult>;\n\n    const result = await execute({\n      title: \"Test Notification\",\n      message: \"This is a test\",\n    });\n\n    expect(result.success).toBe(true);\n    if (result.success) {\n      expect(result.ui_only?.notify?.notifiedVia).toBe(\"browser\");\n      expect(result.title).toBe(\"Test Notification\");\n      expect(result.message).toBe(\"This is a test\");\n    }\n  });\n\n  it(\"should handle title-only notification (no message)\", async () => {\n    const tool = createNotifyTool(config);\n    const execute = tool.execute as (args: {\n      title: string;\n      message?: string;\n    }) => Promise<NotifyToolResult>;\n\n    const result = await execute({\n      title: \"Test Notification\",\n    });\n\n    // In non-Electron, returns success with browser fallback\n    expect(result.success).toBe(true);\n    if (result.success) {\n      expect(result.ui_only?.notify?.notifiedVia).toBe(\"browser\");\n      expect(result.title).toBe(\"Test Notification\");\n      expect(result.message).toBeUndefined();\n    }\n  });\n\n  it(\"should include workspaceId in result when provided in config\", async () => {\n    const configWithWorkspace = {\n      ...config,\n      workspaceId: \"test-workspace-123\",\n    };\n    const tool = createNotifyTool(configWithWorkspace);\n    const execute = tool.execute as (args: {\n      title: string;\n      message?: string;\n    }) => Promise<NotifyToolResult>;\n\n    const result = await execute({\n      title: \"Test Notification\",\n    });\n\n    expect(result.success).toBe(true);\n    if (result.success) {\n      expect(result.ui_only?.notify?.workspaceId).toBe(\"test-workspace-123\");\n    }\n  });\n});\n"]}