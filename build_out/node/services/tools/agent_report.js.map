{"version":3,"file":"agent_report.js","sourceRoot":"","sources":["../../../../src/node/services/tools/agent_report.ts"],"names":[],"mappings":";;;AAAA,2BAA0B;AAG1B,0EAAwE;AAExE,2CAAqE;AAE9D,MAAM,qBAAqB,GAAgB,CAAC,MAAyB,EAAE,EAAE,CAAC;IAC/E,OAAO,IAAA,SAAI,EAAC;QACV,WAAW,EAAE,kCAAgB,CAAC,YAAY,CAAC,WAAW;QACtD,WAAW,EAAE,kCAAgB,CAAC,YAAY,CAAC,MAAM;QACjD,OAAO,EAAE,GAAsB,EAAE,CAAC;YAChC,MAAM,WAAW,GAAG,IAAA,8BAAkB,EAAC,MAAM,EAAE,cAAc,CAAC,CAAC;YAC/D,MAAM,WAAW,GAAG,IAAA,8BAAkB,EAAC,MAAM,EAAE,cAAc,CAAC,CAAC;YAE/D,IAAI,WAAW,CAAC,yCAAyC,CAAC,WAAW,CAAC,EAAE,CAAC;gBACvE,MAAM,IAAI,KAAK,CACb,8EAA8E;oBAC5E,iEAAiE,CACpE,CAAC;YACJ,CAAC;YAED,sFAAsF;YACtF,iFAAiF;YACjF,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;QAAA,CAC1B;KACF,CAAC,CAAC;AAAA,CACJ,CAAC;AApBW,QAAA,qBAAqB,GAArB,qBAAqB,CAoBhC","sourcesContent":["import { tool } from \"ai\";\n\nimport type { ToolConfiguration, ToolFactory } from \"@/common/utils/tools/tools\";\nimport { TOOL_DEFINITIONS } from \"@/common/utils/tools/toolDefinitions\";\n\nimport { requireTaskService, requireWorkspaceId } from \"./toolUtils\";\n\nexport const createAgentReportTool: ToolFactory = (config: ToolConfiguration) => {\n  return tool({\n    description: TOOL_DEFINITIONS.agent_report.description,\n    inputSchema: TOOL_DEFINITIONS.agent_report.schema,\n    execute: (): { success: true } => {\n      const workspaceId = requireWorkspaceId(config, \"agent_report\");\n      const taskService = requireTaskService(config, \"agent_report\");\n\n      if (taskService.hasActiveDescendantAgentTasksForWorkspace(workspaceId)) {\n        throw new Error(\n          \"agent_report rejected: this task still has running/queued descendant tasks. \" +\n            \"Call task_await (or wait for tasks to finish) before reporting.\"\n        );\n      }\n\n      // Intentionally no side-effects. The backend orchestrator consumes the tool-call args\n      // via persisted history/partial state once the tool call completes successfully.\n      return { success: true };\n    },\n  });\n};\n"]}