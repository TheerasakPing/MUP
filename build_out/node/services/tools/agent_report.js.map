{"version":3,"file":"agent_report.js","sourceRoot":"","sources":["../../../../src/node/services/tools/agent_report.ts"],"names":[],"mappings":";;;AAAA,2BAA0B;AAG1B,0EAAwE;AAExE,2CAAqE;AAE9D,MAAM,qBAAqB,GAAgB,CAAC,MAAyB,EAAE,EAAE,CAAC;IAC/E,OAAO,IAAA,SAAI,EAAC;QACV,WAAW,EAAE,kCAAgB,CAAC,YAAY,CAAC,WAAW;QACtD,WAAW,EAAE,kCAAgB,CAAC,YAAY,CAAC,MAAM;QACjD,OAAO,EAAE,GAAsB,EAAE,CAAC;YAChC,MAAM,WAAW,GAAG,IAAA,8BAAkB,EAAC,MAAM,EAAE,cAAc,CAAC,CAAC;YAC/D,MAAM,WAAW,GAAG,IAAA,8BAAkB,EAAC,MAAM,EAAE,cAAc,CAAC,CAAC;YAE/D,IAAI,WAAW,CAAC,yCAAyC,CAAC,WAAW,CAAC,EAAE,CAAC;gBACvE,MAAM,IAAI,KAAK,CACb,8EAA8E;oBAC5E,iEAAiE,CACpE,CAAC;YACJ,CAAC;YAED,sFAAsF;YACtF,iFAAiF;YACjF,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;QAAA,CAC1B;KACF,CAAC,CAAC;AAAA,CACJ,CAAC;AApBW,QAAA,qBAAqB,GAArB,qBAAqB,CAoBhC","sourcesContent":["import { tool } from \"ai\";\r\n\r\nimport type { ToolConfiguration, ToolFactory } from \"@/common/utils/tools/tools\";\r\nimport { TOOL_DEFINITIONS } from \"@/common/utils/tools/toolDefinitions\";\r\n\r\nimport { requireTaskService, requireWorkspaceId } from \"./toolUtils\";\r\n\r\nexport const createAgentReportTool: ToolFactory = (config: ToolConfiguration) => {\r\n  return tool({\r\n    description: TOOL_DEFINITIONS.agent_report.description,\r\n    inputSchema: TOOL_DEFINITIONS.agent_report.schema,\r\n    execute: (): { success: true } => {\r\n      const workspaceId = requireWorkspaceId(config, \"agent_report\");\r\n      const taskService = requireTaskService(config, \"agent_report\");\r\n\r\n      if (taskService.hasActiveDescendantAgentTasksForWorkspace(workspaceId)) {\r\n        throw new Error(\r\n          \"agent_report rejected: this task still has running/queued descendant tasks. \" +\r\n            \"Call task_await (or wait for tasks to finish) before reporting.\"\r\n        );\r\n      }\r\n\r\n      // Intentionally no side-effects. The backend orchestrator consumes the tool-call args\r\n      // via persisted history/partial state once the tool call completes successfully.\r\n      return { success: true };\r\n    },\r\n  });\r\n};\r\n"]}