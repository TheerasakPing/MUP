{"version":3,"file":"todo.test.js","sourceRoot":"","sources":["../../../../src/node/services/tools/todo.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, it, expect, beforeEach, afterEach } from \"@jest/globals\";\nimport * as fs from \"fs/promises\";\nimport * as os from \"os\";\nimport * as path from \"path\";\nimport { clearTodosForSessionDir, getTodosForSessionDir, setTodosForSessionDir } from \"./todo\";\nimport type { TodoItem } from \"@/common/types/tools\";\n\ndescribe(\"Todo Storage\", () => {\n  const workspaceId = \"test-workspace\";\n  let workspaceSessionDir: string;\n\n  beforeEach(async () => {\n    workspaceSessionDir = await fs.mkdtemp(path.join(os.tmpdir(), \"todo-session-test-\"));\n  });\n\n  afterEach(async () => {\n    await fs.rm(workspaceSessionDir, { recursive: true, force: true });\n  });\n\n  describe(\"setTodosForSessionDir\", () => {\n    it(\"should store todo list in temp directory\", async () => {\n      const todos: TodoItem[] = [\n        {\n          content: \"Installed dependencies\",\n          status: \"completed\",\n        },\n        {\n          content: \"Writing tests\",\n          status: \"in_progress\",\n        },\n        {\n          content: \"Update documentation\",\n          status: \"pending\",\n        },\n      ];\n\n      await setTodosForSessionDir(workspaceId, workspaceSessionDir, todos);\n\n      const storedTodos = await getTodosForSessionDir(workspaceSessionDir);\n      expect(storedTodos).toEqual(todos);\n    });\n\n    it(\"should replace entire todo list on update\", async () => {\n      // Create initial list\n      const initialTodos: TodoItem[] = [\n        {\n          content: \"Task 1\",\n          status: \"pending\",\n        },\n        {\n          content: \"Task 2\",\n          status: \"pending\",\n        },\n      ];\n\n      await setTodosForSessionDir(workspaceId, workspaceSessionDir, initialTodos);\n\n      // Replace with updated list\n      const updatedTodos: TodoItem[] = [\n        {\n          content: \"Task 1\",\n          status: \"completed\",\n        },\n        {\n          content: \"Task 2\",\n          status: \"in_progress\",\n        },\n        {\n          content: \"Task 3\",\n          status: \"pending\",\n        },\n      ];\n\n      await setTodosForSessionDir(workspaceId, workspaceSessionDir, updatedTodos);\n\n      // Verify list was replaced, not merged\n      const storedTodos = await getTodosForSessionDir(workspaceSessionDir);\n      expect(storedTodos).toEqual(updatedTodos);\n    });\n\n    it(\"should handle empty todo list\", async () => {\n      // Create initial list\n      await setTodosForSessionDir(workspaceId, workspaceSessionDir, [\n        {\n          content: \"Task 1\",\n          status: \"pending\",\n        },\n      ]);\n\n      // Clear list\n      await setTodosForSessionDir(workspaceId, workspaceSessionDir, []);\n\n      const storedTodos = await getTodosForSessionDir(workspaceSessionDir);\n      expect(storedTodos).toEqual([]);\n    });\n\n    it(\"should reject when exceeding MAX_TODOS limit\", async () => {\n      // Create a list with 8 items (exceeds MAX_TODOS = 7)\n      const tooManyTodos: TodoItem[] = [\n        { content: \"Task 1\", status: \"completed\" },\n        { content: \"Task 2\", status: \"completed\" },\n        { content: \"Task 3\", status: \"completed\" },\n        { content: \"Task 4\", status: \"completed\" },\n        { content: \"Task 5\", status: \"in_progress\" },\n        { content: \"Task 6\", status: \"pending\" },\n        { content: \"Task 7\", status: \"pending\" },\n        { content: \"Task 8\", status: \"pending\" },\n      ];\n\n      await expect(\n        setTodosForSessionDir(workspaceId, workspaceSessionDir, tooManyTodos)\n      ).rejects.toThrow(/Too many TODOs \\(8\\/7\\)/i);\n      await expect(\n        setTodosForSessionDir(workspaceId, workspaceSessionDir, tooManyTodos)\n      ).rejects.toThrow(/Keep high precision at the center/i);\n    });\n\n    it(\"should accept exactly MAX_TODOS items\", async () => {\n      const maxTodos: TodoItem[] = [\n        { content: \"Old work (2 tasks)\", status: \"completed\" },\n        { content: \"Recent task\", status: \"completed\" },\n        { content: \"Current work\", status: \"in_progress\" },\n        { content: \"Next step 1\", status: \"pending\" },\n        { content: \"Next step 2\", status: \"pending\" },\n        { content: \"Next step 3\", status: \"pending\" },\n        { content: \"Future work (5 items)\", status: \"pending\" },\n      ];\n\n      await setTodosForSessionDir(workspaceId, workspaceSessionDir, maxTodos);\n      expect(await getTodosForSessionDir(workspaceSessionDir)).toEqual(maxTodos);\n    });\n\n    it(\"should reject multiple in_progress tasks\", async () => {\n      const validTodos: TodoItem[] = [\n        {\n          content: \"Step 1\",\n          status: \"pending\",\n        },\n      ];\n\n      await setTodosForSessionDir(workspaceId, workspaceSessionDir, validTodos);\n\n      const invalidTodos: TodoItem[] = [\n        {\n          content: \"Step 1\",\n          status: \"in_progress\",\n        },\n        {\n          content: \"Step 2\",\n          status: \"in_progress\",\n        },\n      ];\n\n      await expect(\n        setTodosForSessionDir(workspaceId, workspaceSessionDir, invalidTodos)\n      ).rejects.toThrow(/only one task can be marked as in_progress/i);\n\n      // Original todos should remain unchanged on failure\n      expect(await getTodosForSessionDir(workspaceSessionDir)).toEqual(validTodos);\n    });\n\n    it(\"should reject when in_progress tasks appear after pending\", async () => {\n      const invalidTodos: TodoItem[] = [\n        {\n          content: \"Step 1\",\n          status: \"pending\",\n        },\n        {\n          content: \"Step 2\",\n          status: \"in_progress\",\n        },\n      ];\n\n      await expect(\n        setTodosForSessionDir(workspaceId, workspaceSessionDir, invalidTodos)\n      ).rejects.toThrow(/in-progress tasks must appear before pending tasks/i);\n    });\n\n    it(\"should reject when completed tasks appear after in_progress\", async () => {\n      const invalidTodos: TodoItem[] = [\n        {\n          content: \"Step 1\",\n          status: \"in_progress\",\n        },\n        {\n          content: \"Step 2\",\n          status: \"completed\",\n        },\n      ];\n\n      await expect(\n        setTodosForSessionDir(workspaceId, workspaceSessionDir, invalidTodos)\n      ).rejects.toThrow(/completed tasks must appear before in-progress or pending tasks/i);\n    });\n\n    it(\"should allow all completed tasks without in_progress\", async () => {\n      const todos: TodoItem[] = [\n        {\n          content: \"Step 1\",\n          status: \"completed\",\n        },\n        {\n          content: \"Step 2\",\n          status: \"completed\",\n        },\n      ];\n\n      await setTodosForSessionDir(workspaceId, workspaceSessionDir, todos);\n      expect(await getTodosForSessionDir(workspaceSessionDir)).toEqual(todos);\n    });\n\n    it(\"should create directory if it doesn't exist\", async () => {\n      // Use a non-existent nested directory path\n      const nonExistentDir = path.join(os.tmpdir(), \"todo-nonexistent-test\", \"nested\", \"path\");\n\n      try {\n        const todos: TodoItem[] = [\n          {\n            content: \"Test task\",\n            status: \"pending\",\n          },\n        ];\n\n        // Should not throw even though directory doesn't exist\n        await setTodosForSessionDir(workspaceId, nonExistentDir, todos);\n\n        // Verify the file was created and is readable\n        const retrievedTodos = await getTodosForSessionDir(nonExistentDir);\n        expect(retrievedTodos).toEqual(todos);\n\n        // Verify the directory was actually created\n        const dirStats = await fs.stat(nonExistentDir);\n        expect(dirStats.isDirectory()).toBe(true);\n      } finally {\n        // Clean up the created directory\n        await fs.rm(path.join(os.tmpdir(), \"todo-nonexistent-test\"), {\n          recursive: true,\n          force: true,\n        });\n      }\n    });\n  });\n\n  describe(\"getTodosForSessionDir\", () => {\n    it(\"should return empty array when no todos exist\", async () => {\n      const todos = await getTodosForSessionDir(workspaceSessionDir);\n      expect(todos).toEqual([]);\n    });\n\n    it(\"should return current todo list\", async () => {\n      const todos: TodoItem[] = [\n        {\n          content: \"Task 1\",\n          status: \"completed\",\n        },\n        {\n          content: \"Task 2\",\n          status: \"in_progress\",\n        },\n      ];\n\n      await setTodosForSessionDir(workspaceId, workspaceSessionDir, todos);\n\n      const retrievedTodos = await getTodosForSessionDir(workspaceSessionDir);\n      expect(retrievedTodos).toEqual(todos);\n    });\n  });\n\n  describe(\"workspace isolation\", () => {\n    it(\"should isolate todos between different session directories\", async () => {\n      const tempDir1 = await fs.mkdtemp(path.join(os.tmpdir(), \"todo-test-1-\"));\n      const tempDir2 = await fs.mkdtemp(path.join(os.tmpdir(), \"todo-test-2-\"));\n\n      try {\n        // Create different todos in each temp directory\n        const todos1: TodoItem[] = [\n          {\n            content: \"Stream 1 task\",\n            status: \"pending\",\n          },\n        ];\n\n        const todos2: TodoItem[] = [\n          {\n            content: \"Stream 2 task\",\n            status: \"pending\",\n          },\n        ];\n\n        await setTodosForSessionDir(\"ws-1\", tempDir1, todos1);\n        await setTodosForSessionDir(\"ws-2\", tempDir2, todos2);\n\n        // Verify each session directory has its own todos\n        const retrievedTodos1 = await getTodosForSessionDir(tempDir1);\n        const retrievedTodos2 = await getTodosForSessionDir(tempDir2);\n\n        expect(retrievedTodos1).toEqual(todos1);\n        expect(retrievedTodos2).toEqual(todos2);\n      } finally {\n        // Clean up\n        await fs.rm(tempDir1, { recursive: true, force: true });\n        await fs.rm(tempDir2, { recursive: true, force: true });\n      }\n    });\n  });\n\n  describe(\"clearTodosForSessionDir\", () => {\n    it(\"should clear todos for specific temp directory\", async () => {\n      const todos: TodoItem[] = [\n        {\n          content: \"Task 1\",\n          status: \"pending\",\n        },\n      ];\n\n      await setTodosForSessionDir(workspaceId, workspaceSessionDir, todos);\n      expect(await getTodosForSessionDir(workspaceSessionDir)).toEqual(todos);\n\n      await clearTodosForSessionDir(workspaceId, workspaceSessionDir);\n      expect(await getTodosForSessionDir(workspaceSessionDir)).toEqual([]);\n    });\n  });\n});\n"]}