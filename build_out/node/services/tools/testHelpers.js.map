{"version":3,"file":"testHelpers.js","sourceRoot":"","sources":["../../../../src/node/services/tools/testHelpers.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAY,EAAE,+BAAW;AACzB,MAAY,IAAI,iCAAa;AAC7B,MAAY,EAAE,+BAAW;AACzB,8DAA2D;AAC3D,uEAAoE;AACpE,0CAAuC;AAEvC,6CAA0C;AAE1C;;;GAGG;AACH;IACkB,IAAI,CAAS;IAE7B,YAAY,MAAM,GAAG,WAAW,EAAE;QAChC,MAAM,EAAE,GAAG,GAAG,IAAI,CAAC,GAAG,EAAE,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC;QACtE,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,EAAE,GAAG,MAAM,IAAI,EAAE,EAAE,CAAC,CAAC;QACtD,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;IAAA,CAC9C;IAED,CAAC,MAAM,CAAC,OAAO,CAAC,GAAS;QACvB,IAAI,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;YAC7B,IAAI,CAAC;gBACH,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;YACzD,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,SAAG,CAAC,IAAI,CAAC,mCAAmC,IAAI,CAAC,IAAI,GAAG,EAAE,KAAK,CAAC,CAAC;YACnE,CAAC;QACH,CAAC;IAAA,CACF;CACF;;AAED,mFAAmF;AACnF,IAAI,UAAU,GAAkB,IAAI,CAAC;AACrC,IAAI,oBAAoB,GAA4B,IAAI,CAAC;AAEzD,SAAS,aAAa,GAAW;IAC/B,UAAU,KAAV,UAAU,GAAK,IAAI,eAAM,EAAE,EAAC;IAC5B,OAAO,UAAU,CAAC;AAAA,CACnB;AAED,SAAS,uBAAuB,GAAqB;IACnD,oBAAoB,KAApB,oBAAoB,GAAK,IAAI,mCAAgB,CAAC,aAAa,EAAE,CAAC,EAAC;IAC/D,OAAO,oBAAoB,CAAC;AAAA,CAC7B;AAED;;;;GAIG;AACH,8BACE,OAAe,EACf,OAAwD,EACrC;IACnB,OAAO;QACL,GAAG,EAAE,OAAO;QACZ,mBAAmB,EAAE,OAAO,EAAE,WAAW,IAAI,OAAO;QACpD,OAAO,EAAE,IAAI,2BAAY,CAAC,OAAO,CAAC;QAClC,cAAc,EAAE,OAAO;QACvB,WAAW,EAAE,OAAO,EAAE,WAAW,IAAI,gBAAgB;KACtD,CAAC;AAAA,CACH;AAED;;;GAGG;AACH,uBAA8B;IAC5B,OAAO;QACL,WAAW,EAAE,gBAAyB;QACtC,gBAAgB,EAAE,uBAAuB,EAAE;KAC5C,CAAC;AAAA,CACH","sourcesContent":["import * as fs from \"fs\";\nimport * as path from \"path\";\nimport * as os from \"os\";\nimport { LocalRuntime } from \"@/node/runtime/LocalRuntime\";\nimport { InitStateManager } from \"@/node/services/initStateManager\";\nimport { Config } from \"@/node/config\";\nimport type { ToolConfiguration } from \"@/common/utils/tools/tools\";\nimport { log } from \"@/node/services/log\";\n\n/**\n * Disposable test temp directory that auto-cleans when disposed\n * Use with `using` statement for automatic cleanup in tests\n */\nexport class TestTempDir implements Disposable {\n  public readonly path: string;\n\n  constructor(prefix = \"test-tool\") {\n    const id = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n    this.path = path.join(os.tmpdir(), `${prefix}-${id}`);\n    fs.mkdirSync(this.path, { recursive: true });\n  }\n\n  [Symbol.dispose](): void {\n    if (fs.existsSync(this.path)) {\n      try {\n        fs.rmSync(this.path, { recursive: true, force: true });\n      } catch (error) {\n        log.warn(`Failed to cleanup test temp dir ${this.path}:`, error);\n      }\n    }\n  }\n}\n\n// Singleton instances for test configuration (shared across all test tool configs)\nlet testConfig: Config | null = null;\nlet testInitStateManager: InitStateManager | null = null;\n\nfunction getTestConfig(): Config {\n  testConfig ??= new Config();\n  return testConfig;\n}\n\nfunction getTestInitStateManager(): InitStateManager {\n  testInitStateManager ??= new InitStateManager(getTestConfig());\n  return testInitStateManager;\n}\n\n/**\n * Create basic tool configuration for testing.\n * Returns a config object with default values that can be overridden.\n * Uses tempDir for both cwd and sessionsDir to isolate tests.\n */\nexport function createTestToolConfig(\n  tempDir: string,\n  options?: { workspaceId?: string; sessionsDir?: string }\n): ToolConfiguration {\n  return {\n    cwd: tempDir,\n    workspaceSessionDir: options?.sessionsDir ?? tempDir,\n    runtime: new LocalRuntime(tempDir),\n    runtimeTempDir: tempDir,\n    workspaceId: options?.workspaceId ?? \"test-workspace\",\n  };\n}\n\n/**\n * Get shared test config and initStateManager for inline tool configs in tests.\n * Use this when creating tool configs inline in tests.\n */\nexport function getTestDeps() {\n  return {\n    workspaceId: \"test-workspace\" as const,\n    initStateManager: getTestInitStateManager(),\n  };\n}\n"]}