{"version":3,"file":"file_edit_replace_lines.js","sourceRoot":"","sources":["../../../../src/node/services/tools/file_edit_replace_lines.ts"],"names":[],"mappings":";;;AAAA,2BAA0B;AAG1B,0EAAwE;AACxE,+DAAiE;AACjE,yEAAqF;AAkBrF;;GAEG;AACI,MAAM,8BAA8B,GAAgB,CAAC,MAAyB,EAAE,EAAE,CAAC;IACxF,OAAO,IAAA,SAAI,EAAC;QACV,WAAW,EAAE,kCAAgB,CAAC,uBAAuB,CAAC,WAAW;QACjE,WAAW,EAAE,kCAAgB,CAAC,uBAAuB,CAAC,MAAM;QAC5D,OAAO,EAAE,KAAK,EACZ,IAAqB,EACrB,EAAE,WAAW,EAAE,EAC0B,EAAE,CAAC;YAC5C,MAAM,MAAM,GAAG,MAAM,IAAA,8CAAwB,EAAC;gBAC5C,MAAM;gBACN,QAAQ,EAAE,IAAI,CAAC,SAAS;gBACxB,SAAS,EAAE,CAAC,eAAe,EAAE,EAAE,CAAC,IAAA,4CAAiB,EAAC,IAAI,EAAE,eAAe,CAAC;gBACxE,WAAW;aACZ,CAAC,CAAC;YAEH,kEAAkE;YAClE,oEAAoE;YACpE,IAAI,MAAM,CAAC,OAAO,EAAE,CAAC;gBACnB,OAAO;oBACL,OAAO,EAAE,IAAI;oBACb,IAAI,EAAE,MAAM,CAAC,IAAI;oBACjB,OAAO,EAAE,MAAM,CAAC,OAAO;oBACvB,OAAO,EAAE,MAAM,CAAC,OAAO;oBACvB,aAAa,EAAE,MAAM,CAAC,aAAa;oBACnC,cAAc,EAAE,MAAM,CAAC,cAAe;oBACtC,UAAU,EAAE,MAAM,CAAC,UAAW;iBAC/B,CAAC;YACJ,CAAC;YAED,OAAO,MAAM,CAAC;QAAA,CACf;KACF,CAAC,CAAC;AAAA,CACJ,CAAC;AAhCW,QAAA,8BAA8B,GAA9B,8BAA8B,CAgCzC","sourcesContent":["import { tool } from \"ai\";\r\nimport type { ToolOutputUiOnlyFields } from \"@/common/types/tools\";\r\nimport type { ToolConfiguration, ToolFactory } from \"@/common/utils/tools/tools\";\r\nimport { TOOL_DEFINITIONS } from \"@/common/utils/tools/toolDefinitions\";\r\nimport { executeFileEditOperation } from \"./file_edit_operation\";\r\nimport { handleLineReplace, type LineReplaceArgs } from \"./file_edit_replace_shared\";\r\n\r\nexport interface FileEditReplaceLinesResult extends ToolOutputUiOnlyFields {\r\n  success: true;\r\n  diff: string;\r\n  edits_applied: number;\r\n  lines_replaced: number;\r\n  line_delta: number;\r\n  warning?: string;\r\n}\r\n\r\nexport interface FileEditReplaceLinesError extends ToolOutputUiOnlyFields {\r\n  success: false;\r\n  error: string;\r\n}\r\n\r\nexport type FileEditReplaceLinesToolResult = FileEditReplaceLinesResult | FileEditReplaceLinesError;\r\n\r\n/**\r\n * Line-based file edit replace tool factory\r\n */\r\nexport const createFileEditReplaceLinesTool: ToolFactory = (config: ToolConfiguration) => {\r\n  return tool({\r\n    description: TOOL_DEFINITIONS.file_edit_replace_lines.description,\r\n    inputSchema: TOOL_DEFINITIONS.file_edit_replace_lines.schema,\r\n    execute: async (\r\n      args: LineReplaceArgs,\r\n      { abortSignal }\r\n    ): Promise<FileEditReplaceLinesToolResult> => {\r\n      const result = await executeFileEditOperation({\r\n        config,\r\n        filePath: args.file_path,\r\n        operation: (originalContent) => handleLineReplace(args, originalContent),\r\n        abortSignal,\r\n      });\r\n\r\n      // handleLineReplace always returns lines_replaced and line_delta,\r\n      // so we can safely assert this meets FileEditReplaceLinesToolResult\r\n      if (result.success) {\r\n        return {\r\n          success: true,\r\n          diff: result.diff,\r\n          ui_only: result.ui_only,\r\n          warning: result.warning,\r\n          edits_applied: result.edits_applied,\r\n          lines_replaced: result.lines_replaced!,\r\n          line_delta: result.line_delta!,\r\n        };\r\n      }\r\n\r\n      return result;\r\n    },\r\n  });\r\n};\r\n"]}