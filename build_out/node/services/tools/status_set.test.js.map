{"version":3,"file":"status_set.test.js","sourceRoot":"","sources":["../../../../src/node/services/tools/status_set.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, it, expect } from \"bun:test\";\r\nimport { createStatusSetTool } from \"./status_set\";\r\nimport type { ToolConfiguration } from \"@/common/utils/tools/tools\";\r\nimport { createRuntime } from \"@/node/runtime/runtimeFactory\";\r\nimport type { ToolExecutionOptions } from \"ai\";\r\nimport { STATUS_MESSAGE_MAX_LENGTH } from \"@/common/constants/toolLimits\";\r\n\r\ndescribe(\"status_set tool validation\", () => {\r\n  const mockConfig: ToolConfiguration = {\r\n    cwd: \"/test\",\r\n    runtime: createRuntime({ type: \"local\", srcBaseDir: \"/tmp\" }),\r\n    runtimeTempDir: \"/tmp\",\r\n    workspaceId: \"test-workspace\",\r\n  };\r\n\r\n  const mockToolCallOptions: ToolExecutionOptions = {\r\n    toolCallId: \"test-call-id\",\r\n    messages: [],\r\n  };\r\n\r\n  describe(\"emoji validation\", () => {\r\n    it(\"should accept single emoji characters\", async () => {\r\n      const tool = createStatusSetTool(mockConfig);\r\n\r\n      const emojis = [\"ðŸ”\", \"ðŸ“\", \"âœ…\", \"ðŸš€\", \"â³\"];\r\n      for (const emoji of emojis) {\r\n        const result = (await tool.execute!({ emoji, message: \"Test\" }, mockToolCallOptions)) as {\r\n          success: boolean;\r\n          emoji: string;\r\n          message: string;\r\n        };\r\n        expect(result).toEqual({ success: true, emoji, message: \"Test\" });\r\n      }\r\n    });\r\n\r\n    it(\"should accept emojis with variation selectors\", async () => {\r\n      const tool = createStatusSetTool(mockConfig);\r\n\r\n      // Emojis with variation selectors (U+FE0F)\r\n      const emojis = [\"âœï¸\", \"âœ…\", \"âž¡ï¸\", \"â˜€ï¸\"];\r\n      for (const emoji of emojis) {\r\n        const result = (await tool.execute!({ emoji, message: \"Test\" }, mockToolCallOptions)) as {\r\n          success: boolean;\r\n          emoji: string;\r\n          message: string;\r\n        };\r\n        expect(result).toEqual({ success: true, emoji, message: \"Test\" });\r\n      }\r\n    });\r\n\r\n    it(\"should accept emojis with skin tone modifiers\", async () => {\r\n      const tool = createStatusSetTool(mockConfig);\r\n\r\n      const emojis = [\"ðŸ‘‹ðŸ»\", \"ðŸ‘‹ðŸ½\", \"ðŸ‘‹ðŸ¿\"];\r\n      for (const emoji of emojis) {\r\n        const result = (await tool.execute!({ emoji, message: \"Test\" }, mockToolCallOptions)) as {\r\n          success: boolean;\r\n          emoji: string;\r\n          message: string;\r\n        };\r\n        expect(result).toEqual({ success: true, emoji, message: \"Test\" });\r\n      }\r\n    });\r\n\r\n    it(\"should reject multiple emojis\", async () => {\r\n      const tool = createStatusSetTool(mockConfig);\r\n\r\n      const result1 = (await tool.execute!(\r\n        { emoji: \"ðŸ”ðŸ“\", message: \"Test\" },\r\n        mockToolCallOptions\r\n      )) as { success: boolean; error: string };\r\n      expect(result1.success).toBe(false);\r\n      expect(result1.error).toBe(\"emoji must be a single emoji character\");\r\n\r\n      const result2 = (await tool.execute!(\r\n        { emoji: \"âœ…âœ…\", message: \"Test\" },\r\n        mockToolCallOptions\r\n      )) as { success: boolean; error: string };\r\n      expect(result2.success).toBe(false);\r\n      expect(result2.error).toBe(\"emoji must be a single emoji character\");\r\n    });\r\n\r\n    it(\"should reject text (non-emoji)\", async () => {\r\n      const tool = createStatusSetTool(mockConfig);\r\n\r\n      const result1 = (await tool.execute!(\r\n        { emoji: \"a\", message: \"Test\" },\r\n        mockToolCallOptions\r\n      )) as {\r\n        success: boolean;\r\n        error: string;\r\n      };\r\n      expect(result1.success).toBe(false);\r\n      expect(result1.error).toBe(\"emoji must be a single emoji character\");\r\n\r\n      const result2 = (await tool.execute!(\r\n        { emoji: \"abc\", message: \"Test\" },\r\n        mockToolCallOptions\r\n      )) as { success: boolean; error: string };\r\n      expect(result2.success).toBe(false);\r\n      expect(result2.error).toBe(\"emoji must be a single emoji character\");\r\n\r\n      const result3 = (await tool.execute!(\r\n        { emoji: \"!\", message: \"Test\" },\r\n        mockToolCallOptions\r\n      )) as {\r\n        success: boolean;\r\n        error: string;\r\n      };\r\n      expect(result3.success).toBe(false);\r\n      expect(result3.error).toBe(\"emoji must be a single emoji character\");\r\n    });\r\n\r\n    it(\"should reject empty emoji\", async () => {\r\n      const tool = createStatusSetTool(mockConfig);\r\n\r\n      const result = (await tool.execute!({ emoji: \"\", message: \"Test\" }, mockToolCallOptions)) as {\r\n        success: boolean;\r\n        error: string;\r\n      };\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toBe(\"emoji must be a single emoji character\");\r\n    });\r\n\r\n    it(\"should reject emoji with text\", async () => {\r\n      const tool = createStatusSetTool(mockConfig);\r\n\r\n      const result1 = (await tool.execute!(\r\n        { emoji: \"ðŸ”a\", message: \"Test\" },\r\n        mockToolCallOptions\r\n      )) as { success: boolean; error: string };\r\n      expect(result1.success).toBe(false);\r\n      expect(result1.error).toBe(\"emoji must be a single emoji character\");\r\n\r\n      const result2 = (await tool.execute!(\r\n        { emoji: \"xðŸ”\", message: \"Test\" },\r\n        mockToolCallOptions\r\n      )) as { success: boolean; error: string };\r\n      expect(result2.success).toBe(false);\r\n      expect(result2.error).toBe(\"emoji must be a single emoji character\");\r\n    });\r\n  });\r\n\r\n  describe(\"message validation\", () => {\r\n    it(`should accept messages up to ${STATUS_MESSAGE_MAX_LENGTH} characters`, async () => {\r\n      const tool = createStatusSetTool(mockConfig);\r\n\r\n      const result1 = (await tool.execute!(\r\n        { emoji: \"âœ…\", message: \"a\".repeat(STATUS_MESSAGE_MAX_LENGTH) },\r\n        mockToolCallOptions\r\n      )) as { success: boolean; message: string };\r\n      expect(result1.success).toBe(true);\r\n      expect(result1.message).toBe(\"a\".repeat(STATUS_MESSAGE_MAX_LENGTH));\r\n\r\n      const result2 = (await tool.execute!(\r\n        { emoji: \"âœ…\", message: \"Analyzing code structure\" },\r\n        mockToolCallOptions\r\n      )) as { success: boolean };\r\n      expect(result2.success).toBe(true);\r\n    });\r\n\r\n    it(`should truncate messages longer than ${STATUS_MESSAGE_MAX_LENGTH} characters with ellipsis`, async () => {\r\n      const tool = createStatusSetTool(mockConfig);\r\n\r\n      // Test with MAX_LENGTH + 1 characters\r\n      const result1 = (await tool.execute!(\r\n        { emoji: \"âœ…\", message: \"a\".repeat(STATUS_MESSAGE_MAX_LENGTH + 1) },\r\n        mockToolCallOptions\r\n      )) as { success: boolean; message: string };\r\n      expect(result1.success).toBe(true);\r\n      expect(result1.message).toBe(\"a\".repeat(STATUS_MESSAGE_MAX_LENGTH - 1) + \"â€¦\");\r\n      expect(result1.message.length).toBe(STATUS_MESSAGE_MAX_LENGTH);\r\n\r\n      // Test with longer message\r\n      const longMessage =\r\n        \"This is a very long message that exceeds the 60 character limit and should be truncated\";\r\n      const result2 = (await tool.execute!(\r\n        { emoji: \"âœ…\", message: longMessage },\r\n        mockToolCallOptions\r\n      )) as { success: boolean; message: string };\r\n      expect(result2.success).toBe(true);\r\n      expect(result2.message).toBe(longMessage.slice(0, STATUS_MESSAGE_MAX_LENGTH - 1) + \"â€¦\");\r\n      expect(result2.message.length).toBe(STATUS_MESSAGE_MAX_LENGTH);\r\n    });\r\n\r\n    it(\"should accept empty message\", async () => {\r\n      const tool = createStatusSetTool(mockConfig);\r\n\r\n      const result = (await tool.execute!({ emoji: \"âœ…\", message: \"\" }, mockToolCallOptions)) as {\r\n        success: boolean;\r\n      };\r\n      expect(result.success).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe(\"url parameter\", () => {\r\n    it(\"should accept valid URLs\", async () => {\r\n      const tool = createStatusSetTool(mockConfig);\r\n\r\n      const validUrls = [\r\n        \"https://github.com/owner/repo/pull/123\",\r\n        \"http://example.com\",\r\n        \"https://example.com/path/to/resource?query=param\",\r\n      ];\r\n\r\n      for (const url of validUrls) {\r\n        const result = (await tool.execute!(\r\n          { emoji: \"ðŸ”\", message: \"Test\", url },\r\n          mockToolCallOptions\r\n        )) as {\r\n          success: boolean;\r\n          url: string;\r\n        };\r\n        expect(result.success).toBe(true);\r\n        expect(result.url).toBe(url);\r\n      }\r\n    });\r\n\r\n    it(\"should work without URL parameter\", async () => {\r\n      const tool = createStatusSetTool(mockConfig);\r\n\r\n      const result = (await tool.execute!(\r\n        { emoji: \"âœ…\", message: \"Test\" },\r\n        mockToolCallOptions\r\n      )) as {\r\n        success: boolean;\r\n        url?: string;\r\n      };\r\n      expect(result.success).toBe(true);\r\n      expect(result.url).toBeUndefined();\r\n    });\r\n\r\n    it(\"should omit URL from result when undefined\", async () => {\r\n      const tool = createStatusSetTool(mockConfig);\r\n\r\n      const result = (await tool.execute!(\r\n        { emoji: \"âœ…\", message: \"Test\", url: undefined },\r\n        mockToolCallOptions\r\n      )) as {\r\n        success: boolean;\r\n      };\r\n      expect(result.success).toBe(true);\r\n      expect(\"url\" in result).toBe(false);\r\n    });\r\n  });\r\n});\r\n"]}