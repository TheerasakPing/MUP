{"version":3,"file":"bashTaskReport.test.js","sourceRoot":"","sources":["../../../../src/node/services/tools/bashTaskReport.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, it } from \"bun:test\";\r\n\r\nimport { formatBashOutputReport, tryParseBashOutputReport } from \"./bashTaskReport\";\r\n\r\ndescribe(\"bashTaskReport\", () => {\r\n  it(\"roundtrips a bash output report with output\", () => {\r\n    const report = formatBashOutputReport({\r\n      processId: \"proc_123\",\r\n      status: \"exited\",\r\n      exitCode: 0,\r\n      output: \"line1\\nline2\\n\",\r\n    });\r\n\r\n    expect(report).toContain(\"### Bash task: proc_123\");\r\n    expect(report).toContain(\"status: exited\");\r\n    expect(report).toContain(\"exitCode: 0\");\r\n    expect(report).toContain(\"```text\");\r\n\r\n    const parsed = tryParseBashOutputReport(report);\r\n    expect(parsed).toEqual({\r\n      processId: \"proc_123\",\r\n      status: \"exited\",\r\n      exitCode: 0,\r\n      output: \"line1\\nline2\",\r\n    });\r\n  });\r\n\r\n  it(\"does not parse status/exitCode from the output block\", () => {\r\n    const report = formatBashOutputReport({\r\n      processId: \"proc_123\",\r\n      status: \"exited\",\r\n      exitCode: 0,\r\n      output: \"status: ok\\nexitCode: 1\\n\",\r\n    });\r\n\r\n    expect(tryParseBashOutputReport(report)).toEqual({\r\n      processId: \"proc_123\",\r\n      status: \"exited\",\r\n      exitCode: 0,\r\n      output: \"status: ok\\nexitCode: 1\",\r\n    });\r\n  });\r\n\r\n  it(\"roundtrips output that contains a literal ``` fence line\", () => {\r\n    const report = formatBashOutputReport({\r\n      processId: \"proc_123\",\r\n      status: \"exited\",\r\n      exitCode: 0,\r\n      output: \"before\\n```\\nafter\\n\",\r\n    });\r\n\r\n    // Ensure we picked a fence that can't be terminated by a literal ``` output line.\r\n    expect(report).toContain(\"````text\");\r\n\r\n    const parsed = tryParseBashOutputReport(report);\r\n    expect(parsed?.output).toBe(\"before\\n```\\nafter\");\r\n  });\r\n\r\n  it(\"parses legacy reports where output contains a literal ``` fence line\", () => {\r\n    const legacy = [\r\n      \"### Bash task: proc_123\",\r\n      \"\",\r\n      \"status: exited\",\r\n      \"exitCode: 0\",\r\n      \"\",\r\n      \"```text\",\r\n      \"before\",\r\n      \"```\",\r\n      \"after\",\r\n      \"```\",\r\n    ].join(\"\\n\");\r\n\r\n    expect(tryParseBashOutputReport(legacy)).toEqual({\r\n      processId: \"proc_123\",\r\n      status: \"exited\",\r\n      exitCode: 0,\r\n      output: \"before\\n```\\nafter\",\r\n    });\r\n  });\r\n\r\n  it(\"roundtrips a bash output report with no output\", () => {\r\n    const report = formatBashOutputReport({\r\n      processId: \"proc_123\",\r\n      status: \"exited\",\r\n      exitCode: 0,\r\n      output: \"\",\r\n    });\r\n\r\n    expect(report).toContain(\"### Bash task: proc_123\");\r\n    expect(report).toContain(\"status: exited\");\r\n    expect(report).toContain(\"exitCode: 0\");\r\n    expect(report).not.toContain(\"```text\");\r\n\r\n    const parsed = tryParseBashOutputReport(report);\r\n    expect(parsed).toEqual({\r\n      processId: \"proc_123\",\r\n      status: \"exited\",\r\n      exitCode: 0,\r\n      output: \"\",\r\n    });\r\n  });\r\n\r\n  it(\"returns undefined for non-bash markdown\", () => {\r\n    expect(tryParseBashOutputReport(\"### Not bash\\nstatus: exited\")).toBeUndefined();\r\n  });\r\n});\r\n"]}