{"version":3,"file":"bash.test.js","sourceRoot":"","sources":["../../../../src/node/services/tools/bash.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, it, expect } from \"bun:test\";\r\nimport { LocalRuntime } from \"@/node/runtime/LocalRuntime\";\r\nimport { createBashTool } from \"./bash\";\r\nimport type { BashOutputEvent } from \"@/common/types/stream\";\r\nimport type { BashToolArgs, BashToolResult } from \"@/common/types/tools\";\r\nimport { BASH_MAX_TOTAL_BYTES } from \"@/common/constants/toolLimits\";\r\nimport * as path from \"path\";\r\nimport * as fs from \"fs\";\r\nimport { TestTempDir, createTestToolConfig, getTestDeps } from \"./testHelpers\";\r\nimport { createRuntime } from \"@/node/runtime/runtimeFactory\";\r\nimport { sshConnectionPool } from \"@/node/runtime/sshConnectionPool\";\r\nimport type { ToolExecutionOptions } from \"ai\";\r\n\r\n// Type guard to narrow foreground success result (has note, no backgroundProcessId)\r\nfunction isForegroundSuccess(\r\n  result: BashToolResult\r\n): result is BashToolResult & { success: true; note?: string } {\r\n  return result.success && !(\"backgroundProcessId\" in result);\r\n}\r\n\r\nimport { BackgroundProcessManager } from \"@/node/services/backgroundProcessManager\";\r\n\r\n// Mock ToolCallOptions for testing\r\nconst mockToolCallOptions: ToolExecutionOptions = {\r\n  toolCallId: \"test-call-id\",\r\n  messages: [],\r\n};\r\n\r\n// Helper to create bash tool with test configuration\r\n// Returns both tool and disposable temp directory\r\n// Use with: using testEnv = createTestBashTool();\r\nfunction createTestBashTool() {\r\n  const tempDir = new TestTempDir(\"test-bash\");\r\n  const config = createTestToolConfig(process.cwd());\r\n  config.runtimeTempDir = tempDir.path; // Override runtimeTempDir to use test's disposable temp dir\r\n  const tool = createBashTool(config);\r\n\r\n  return {\r\n    tool,\r\n    [Symbol.dispose]() {\r\n      tempDir[Symbol.dispose]();\r\n    },\r\n  };\r\n}\r\n\r\ndescribe(\"bash tool\", () => {\r\n  it(\"should execute a simple command successfully\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args: BashToolArgs = {\r\n      script: \"echo hello\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toBe(\"hello\");\r\n      expect(result.exitCode).toBe(0);\r\n    }\r\n  });\r\n\r\n  it(\"should emit bash-output events when emitChatEvent is provided\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-live-output\");\r\n    const events: BashOutputEvent[] = [];\r\n\r\n    const config = createTestToolConfig(process.cwd());\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.emitChatEvent = (event) => {\r\n      if (event.type === \"bash-output\") {\r\n        events.push(event);\r\n      }\r\n    };\r\n\r\n    const tool = createBashTool(config);\r\n\r\n    const args: BashToolArgs = {\r\n      script: \"echo out && echo err 1>&2\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n    expect(result.success).toBe(true);\r\n\r\n    expect(events.length).toBeGreaterThan(0);\r\n    expect(events.every((e) => e.workspaceId === config.workspaceId)).toBe(true);\r\n    expect(events.every((e) => e.toolCallId === mockToolCallOptions.toolCallId)).toBe(true);\r\n\r\n    const stdoutText = events\r\n      .filter((e) => !e.isError)\r\n      .map((e) => e.text)\r\n      .join(\"\");\r\n    const stderrText = events\r\n      .filter((e) => e.isError)\r\n      .map((e) => e.text)\r\n      .join(\"\");\r\n\r\n    expect(stdoutText).toContain(\"out\");\r\n    expect(stderrText).toContain(\"err\");\r\n\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should handle multi-line output\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args: BashToolArgs = {\r\n      script: \"echo line1 && echo line2 && echo line3\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toBe(\"line1\\nline2\\nline3\");\r\n    }\r\n  });\r\n\r\n  it(\"should warn when using cat to read a file\", async () => {\r\n    using tempDir = new TestTempDir(\"test-bash-cat-read\");\r\n\r\n    const filePath = path.join(tempDir.path, \"input.txt\");\r\n    fs.writeFileSync(filePath, \"hello\\nworld\", \"utf-8\");\r\n\r\n    const config = createTestToolConfig(tempDir.path);\r\n    config.runtimeTempDir = tempDir.path;\r\n    const tool = createBashTool(config);\r\n\r\n    const args: BashToolArgs = {\r\n      script: `cat ${filePath}`,\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      expect(result.output).toBe(\"hello\\nworld\");\r\n      expect(result.note).toContain(\"DO NOT use `cat`\");\r\n      expect(result.note).toContain(\"file_read\");\r\n    }\r\n  });\r\n\r\n  it(\"should not warn on cat heredoc\", async () => {\r\n    using tempDir = new TestTempDir(\"test-bash-cat-heredoc\");\r\n\r\n    const config = createTestToolConfig(tempDir.path);\r\n    config.runtimeTempDir = tempDir.path;\r\n    const tool = createBashTool(config);\r\n\r\n    const args: BashToolArgs = {\r\n      script: \"cat <<'EOF'\\nhello\\nEOF\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      expect(result.output).toBe(\"hello\");\r\n      expect(result.note).toBeUndefined();\r\n    }\r\n  });\r\n\r\n  it(\"should warn when using grep to dump a file\", async () => {\r\n    using tempDir = new TestTempDir(\"test-bash-grep-read\");\r\n\r\n    const filePath = path.join(tempDir.path, \"input.txt\");\r\n    fs.writeFileSync(filePath, \"hello\\nworld\", \"utf-8\");\r\n\r\n    const config = createTestToolConfig(tempDir.path);\r\n    config.runtimeTempDir = tempDir.path;\r\n    const tool = createBashTool(config);\r\n\r\n    const args: BashToolArgs = {\r\n      script: `grep '' ${filePath}`,\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      expect(result.output).toBe(\"hello\\nworld\");\r\n      expect(result.note).toContain(\"file_read\");\r\n      expect(result.note).toContain(\"`grep`\");\r\n    }\r\n  });\r\n\r\n  it(\"should not warn on grep search\", async () => {\r\n    using tempDir = new TestTempDir(\"test-bash-grep-search\");\r\n\r\n    const filePath = path.join(tempDir.path, \"input.txt\");\r\n    fs.writeFileSync(filePath, \"hello\\nworld\", \"utf-8\");\r\n\r\n    const config = createTestToolConfig(tempDir.path);\r\n    config.runtimeTempDir = tempDir.path;\r\n    const tool = createBashTool(config);\r\n\r\n    const args: BashToolArgs = {\r\n      script: `grep 'hello' ${filePath}`,\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      expect(result.output).toBe(\"hello\");\r\n      expect(result.note).toBeUndefined();\r\n    }\r\n  });\r\n\r\n  it(\"should warn when using rg to dump a file\", async () => {\r\n    using tempDir = new TestTempDir(\"test-bash-rg-read\");\r\n\r\n    const filePath = path.join(tempDir.path, \"input.txt\");\r\n    fs.writeFileSync(filePath, \"hello\\nworld\", \"utf-8\");\r\n\r\n    const config = createTestToolConfig(tempDir.path);\r\n    config.runtimeTempDir = tempDir.path;\r\n    const tool = createBashTool(config);\r\n\r\n    // CI images dont guarantee ripgrep is installed; shim `rg` so we can exercise the\r\n    // bash-tool warning heuristics without depending on the real binary.\r\n    const args: BashToolArgs = {\r\n      script: `rg() { grep -E \"$1\" \"$2\"; }\\nrg '' \"${filePath}\"`,\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      expect(result.output).toBe(\"hello\\nworld\");\r\n      expect(result.note).toContain(\"file_read\");\r\n      expect(result.note).toContain(\"`rg`\");\r\n    }\r\n  });\r\n\r\n  it(\"should not warn on rg search\", async () => {\r\n    using tempDir = new TestTempDir(\"test-bash-rg-search\");\r\n\r\n    const filePath = path.join(tempDir.path, \"input.txt\");\r\n    fs.writeFileSync(filePath, \"hello\\nworld\", \"utf-8\");\r\n\r\n    const config = createTestToolConfig(tempDir.path);\r\n    config.runtimeTempDir = tempDir.path;\r\n    const tool = createBashTool(config);\r\n\r\n    // CI images dont guarantee ripgrep is installed; shim `rg` so we can exercise the\r\n    // bash-tool warning heuristics without depending on the real binary.\r\n    const args: BashToolArgs = {\r\n      script: `rg() { grep -E \"$1\" \"$2\"; }\\nrg 'hello' \"${filePath}\"`,\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      expect(result.output).toBe(\"hello\");\r\n      expect(result.note).toBeUndefined();\r\n    }\r\n  });\r\n  it(\"should warn on cat file reads even when output overflows\", async () => {\r\n    using tempDir = new TestTempDir(\"test-bash-cat-overflow\");\r\n\r\n    const filePath = path.join(tempDir.path, \"large.txt\");\r\n    fs.writeFileSync(\r\n      filePath,\r\n      Array.from({ length: 400 }, (_, i) => `line${i + 1}`).join(\"\\n\"),\r\n      \"utf-8\"\r\n    );\r\n\r\n    const config = createTestToolConfig(tempDir.path);\r\n    config.runtimeTempDir = tempDir.path;\r\n    const tool = createBashTool(config);\r\n\r\n    const args: BashToolArgs = {\r\n      script: `cat ${filePath}`,\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      expect(result.output).toBe(\"\");\r\n      expect(result.note).toContain(\"DO NOT use `cat`\");\r\n      expect(result.note).toContain(\"[OUTPUT OVERFLOW\");\r\n\r\n      const match = /saved to (\\/.*?\\.txt)/.exec(result.note ?? \"\");\r\n      expect(match).toBeDefined();\r\n      if (match) {\r\n        const overflowPath = match[1];\r\n        expect(fs.existsSync(overflowPath)).toBe(true);\r\n        fs.unlinkSync(overflowPath);\r\n      }\r\n    }\r\n  });\r\n\r\n  it(\"should report overflow when hard cap (300 lines) is exceeded\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args: BashToolArgs = {\r\n      run_in_background: false,\r\n      script: \"for i in {1..400}; do echo line$i; done\", // Exceeds 300 line hard cap\r\n      timeout_secs: 5,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      expect(result.output).toBe(\"\");\r\n      expect(result.note).toContain(\"[OUTPUT OVERFLOW\");\r\n      expect(result.note).toContain(\"Line count exceeded\");\r\n      expect(result.note).toContain(\"300 lines\");\r\n      expect(result.exitCode).toBe(0);\r\n    }\r\n  });\r\n\r\n  it(\"should save overflow output to temp file with short ID\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args: BashToolArgs = {\r\n      run_in_background: false,\r\n      script: \"for i in {1..400}; do echo line$i; done\", // Exceeds 300 line hard cap\r\n      timeout_secs: 5,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      expect(result.output).toBe(\"\");\r\n      expect(result.note).toContain(\"[OUTPUT OVERFLOW\");\r\n      // Should contain specific overflow reason (one of the three types)\r\n      expect(result.note).toMatch(\r\n        /Line count exceeded|Total output exceeded|exceeded per-line limit/\r\n      );\r\n      expect(result.note).toContain(\"Full output\");\r\n      expect(result.note).toContain(\"lines) saved to\");\r\n      expect(result.note).toContain(\"bash-\");\r\n      expect(result.note).toContain(\".txt\");\r\n      expect(result.note).toContain(\"File will be automatically cleaned up when stream ends\");\r\n      expect(result.exitCode).toBe(0);\r\n\r\n      // Extract file path from output message (handles both \"lines saved to\" and \"lines) saved to\")\r\n      const match = /saved to (\\/.+?\\.txt)/.exec(result.note ?? \"\");\r\n      expect(match).toBeDefined();\r\n      if (match) {\r\n        const overflowPath = match[1];\r\n\r\n        // Verify file has short ID format (bash-<8 hex chars>.txt)\r\n        const filename = overflowPath.split(\"/\").pop();\r\n        expect(filename).toMatch(/^bash-[0-9a-f]{8}\\.txt$/);\r\n\r\n        // Verify file exists and read contents\r\n        expect(fs.existsSync(overflowPath)).toBe(true);\r\n\r\n        // Verify file contains collected lines (at least 300, may be slightly more)\r\n        const fileContent = fs.readFileSync(overflowPath, \"utf-8\");\r\n        const fileLines = fileContent.split(\"\\n\").filter((l: string) => l.length > 0);\r\n        expect(fileLines.length).toBeGreaterThanOrEqual(300);\r\n        expect(fileContent).toContain(\"line1\");\r\n        expect(fileContent).toContain(\"line300\");\r\n\r\n        // Clean up temp file\r\n        fs.unlinkSync(overflowPath);\r\n      }\r\n    }\r\n  });\r\n\r\n  it(\"should report overflow quickly when hard cap is reached\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const startTime = performance.now();\r\n\r\n    const args: BashToolArgs = {\r\n      // This will generate 500 lines quickly - should report overflow at 300\r\n      run_in_background: false,\r\n      script: \"for i in {1..500}; do echo line$i; done\",\r\n      timeout_secs: 5,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n    const duration = performance.now() - startTime;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      // Should complete quickly since we stop at 300 lines\r\n      expect(duration).toBeLessThan(4000);\r\n      expect(result.output).toBe(\"\");\r\n      expect(result.note).toContain(\"[OUTPUT OVERFLOW\");\r\n      expect(result.note).toContain(\"Line count exceeded\");\r\n      expect(result.note).toContain(\"300 lines\");\r\n      expect(result.exitCode).toBe(0);\r\n    }\r\n  });\r\n\r\n  it(\"should truncate overflow output when overflow_policy is 'truncate'\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-truncate\");\r\n    const config = createTestToolConfig(process.cwd());\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.overflow_policy = \"truncate\";\r\n    const tool = createBashTool(config);\r\n\r\n    const args: BashToolArgs = {\r\n      // Generate ~1.5MB of output (1700 lines * 900 bytes) to exceed 1MB byte limit\r\n      script: 'perl -e \\'for (1..1700) { print \"A\" x 900 . \"\\\\n\" }\\'',\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    // With truncate policy and overflow, should succeed with truncated field\r\n    expect(result.success).toBe(true);\r\n    if (result.success && \"truncated\" in result) {\r\n      expect(result.truncated).toBeDefined();\r\n      if (result.truncated) {\r\n        expect(result.truncated.reason).toContain(\"exceed\");\r\n        // Should collect lines up to ~1MB (around 1150-1170 lines with 900 bytes each)\r\n        expect(result.truncated.totalLines).toBeGreaterThan(1000);\r\n        expect(result.truncated.totalLines).toBeLessThan(1300);\r\n      }\r\n    }\r\n\r\n    // Should contain output that's around 1MB\r\n    expect(result.output?.length).toBeGreaterThan(1000000);\r\n    expect(result.output?.length).toBeLessThan(1100000);\r\n\r\n    // Should NOT create temp file with truncate policy\r\n    const files = fs.readdirSync(tempDir.path);\r\n    const bashFiles = files.filter((f) => f.startsWith(\"bash-\"));\r\n    expect(bashFiles.length).toBe(0);\r\n\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should reject single overlong line before storing it (IPC mode)\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-overlong-line\");\r\n    const tool = createBashTool({\r\n      ...getTestDeps(),\r\n      cwd: process.cwd(),\r\n      runtime: new LocalRuntime(process.cwd()),\r\n      runtimeTempDir: tempDir.path,\r\n      overflow_policy: \"truncate\",\r\n    });\r\n\r\n    const args: BashToolArgs = {\r\n      // Generate a single 2MB line (exceeds 1MB total limit)\r\n      script: 'perl -e \\'print \"A\" x 2000000 . \"\\\\n\"\\'',\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    // Should succeed but with truncation before storing the overlong line\r\n    expect(result.success).toBe(true);\r\n    if (result.success && \"truncated\" in result) {\r\n      expect(result.truncated).toBeDefined();\r\n      if (result.truncated) {\r\n        expect(result.truncated.reason).toContain(\"would exceed file preservation limit\");\r\n        // Should have 0 lines collected since the first line was too long\r\n        expect(result.truncated.totalLines).toBe(0);\r\n      }\r\n    }\r\n\r\n    // CRITICAL: Output must NOT contain the 2MB line - should be empty or nearly empty\r\n    expect(result.output?.length ?? 0).toBeLessThan(100);\r\n\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should reject overlong line at boundary (IPC mode)\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-boundary\");\r\n    const tool = createBashTool({\r\n      ...getTestDeps(),\r\n      cwd: process.cwd(),\r\n      runtime: new LocalRuntime(process.cwd()),\r\n      runtimeTempDir: tempDir.path,\r\n      overflow_policy: \"truncate\",\r\n    });\r\n\r\n    const args: BashToolArgs = {\r\n      // First line: 500KB (within limit)\r\n      // Second line: 600KB (would exceed 1MB when added)\r\n      script: 'perl -e \\'print \"A\" x 500000 . \"\\\\n\"; print \"B\" x 600000 . \"\\\\n\"\\'',\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success && \"truncated\" in result) {\r\n      expect(result.truncated).toBeDefined();\r\n      if (result.truncated) {\r\n        expect(result.truncated.reason).toContain(\"would exceed\");\r\n        // Should have collected exactly 1 line (the 500KB line)\r\n        expect(result.truncated.totalLines).toBe(1);\r\n      }\r\n    }\r\n\r\n    // Output should contain only the first line (~500KB), not the second line\r\n    expect(result.output?.length).toBeGreaterThanOrEqual(500000);\r\n    expect(result.output?.length).toBeLessThan(600000);\r\n    // Verify content is only 'A's, not 'B's\r\n    expect(result.output).toContain(\"AAAA\");\r\n    expect(result.output).not.toContain(\"BBBB\");\r\n\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should use tmpfile policy by default when overflow_policy not specified\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-default\");\r\n    const tool = createBashTool({\r\n      ...getTestDeps(),\r\n      cwd: process.cwd(),\r\n      runtime: new LocalRuntime(process.cwd()),\r\n      runtimeTempDir: tempDir.path,\r\n      // overflow_policy not specified - should default to tmpfile\r\n    });\r\n\r\n    const args: BashToolArgs = {\r\n      run_in_background: false,\r\n      script: \"for i in {1..400}; do echo line$i; done\",\r\n      timeout_secs: 5,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      // Should use tmpfile behavior\r\n      expect(result.output).toBe(\"\");\r\n      expect(result.note).toContain(\"[OUTPUT OVERFLOW\");\r\n      expect(result.note).toContain(\"saved to\");\r\n      expect(result.note).not.toContain(\"[OUTPUT TRUNCATED\");\r\n      expect(result.exitCode).toBe(0);\r\n\r\n      // Verify temp file was created in runtimeTempDir\r\n      expect(fs.existsSync(tempDir.path)).toBe(true);\r\n      const files = fs.readdirSync(tempDir.path);\r\n      const bashFiles = files.filter((f) => f.startsWith(\"bash-\"));\r\n      expect(bashFiles.length).toBe(1);\r\n    }\r\n\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should preserve up to 100KB in temp file even after 16KB display limit\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-100kb\");\r\n    const tool = createBashTool({\r\n      ...getTestDeps(),\r\n      cwd: process.cwd(),\r\n      runtime: new LocalRuntime(process.cwd()),\r\n      runtimeTempDir: tempDir.path,\r\n    });\r\n\r\n    // Generate ~50KB of output (well over 16KB display limit, under 100KB file limit)\r\n    // Each line is ~40 bytes: \"line\" + number (1-5 digits) + padding = ~40 bytes\r\n    // 50KB / 40 bytes = ~1250 lines\r\n    const args: BashToolArgs = {\r\n      run_in_background: false,\r\n      script: \"for i in {1..1300}; do printf 'line%04d with some padding text here\\\\n' $i; done\",\r\n      timeout_secs: 5,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      // Should hit display limit and save to temp file\r\n      expect(result.output).toBe(\"\");\r\n      expect(result.note).toContain(\"[OUTPUT OVERFLOW\");\r\n      expect(result.note).toContain(\"saved to\");\r\n      expect(result.exitCode).toBe(0);\r\n\r\n      // Extract and verify temp file\r\n      const match = /saved to (\\/.*?\\.txt)/.exec(result.note ?? \"\");\r\n      expect(match).toBeDefined();\r\n      if (match) {\r\n        const overflowPath = match[1];\r\n        expect(fs.existsSync(overflowPath)).toBe(true);\r\n\r\n        // Verify file contains ALL lines collected (should be ~1300 lines, ~50KB)\r\n        const fileContent = fs.readFileSync(overflowPath, \"utf-8\");\r\n        const fileLines = fileContent.split(\"\\n\").filter((l: string) => l.length > 0);\r\n\r\n        // Should have collected all 1300 lines (not stopped at display limit)\r\n        expect(fileLines.length).toBeGreaterThanOrEqual(1250);\r\n        expect(fileLines.length).toBeLessThanOrEqual(1350);\r\n\r\n        // Verify file size is between 45KB and 55KB\r\n        const fileStats = fs.statSync(overflowPath);\r\n        expect(fileStats.size).toBeGreaterThan(45 * 1024);\r\n        expect(fileStats.size).toBeLessThan(55 * 1024);\r\n\r\n        // Clean up\r\n        fs.unlinkSync(overflowPath);\r\n      }\r\n    }\r\n\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should stop collection at 100KB file limit\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-100kb-limit\");\r\n    const tool = createBashTool({\r\n      ...getTestDeps(),\r\n      cwd: process.cwd(),\r\n      runtime: new LocalRuntime(process.cwd()),\r\n      runtimeTempDir: tempDir.path,\r\n    });\r\n\r\n    // Generate ~150KB of output (exceeds 100KB file limit)\r\n    // Each line is ~100 bytes\r\n    // 150KB / 100 bytes = ~1500 lines\r\n    const args: BashToolArgs = {\r\n      run_in_background: false,\r\n      script: \"for i in {1..1600}; do printf 'line%04d: '; printf 'x%.0s' {1..80}; echo; done\",\r\n      timeout_secs: 10,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      // Should hit file limit\r\n      expect(result.output).toBe(\"\");\r\n      expect(result.note).toContain(\"file preservation limit\");\r\n      expect(result.exitCode).toBe(0);\r\n\r\n      // Extract and verify temp file\r\n      const match = /saved to (\\/.*?\\.txt)/.exec(result.note ?? \"\");\r\n      expect(match).toBeDefined();\r\n      if (match) {\r\n        const overflowPath = match[1];\r\n        expect(fs.existsSync(overflowPath)).toBe(true);\r\n\r\n        // Verify file is capped around 100KB (not 150KB)\r\n        const fileStats = fs.statSync(overflowPath);\r\n        expect(fileStats.size).toBeLessThanOrEqual(105 * 1024); // Allow 5KB buffer\r\n        expect(fileStats.size).toBeGreaterThan(95 * 1024);\r\n\r\n        // Clean up\r\n        fs.unlinkSync(overflowPath);\r\n      }\r\n    }\r\n\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should NOT kill process at display limit (16KB) - verify command completes naturally\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-no-kill-display\");\r\n    const tool = createBashTool({\r\n      ...getTestDeps(),\r\n      cwd: process.cwd(),\r\n      runtime: new LocalRuntime(process.cwd()),\r\n      runtimeTempDir: tempDir.path,\r\n    });\r\n\r\n    // Generate output that exceeds display limit but not file limit\r\n    // Also includes a delay at the END to verify process wasn't killed early\r\n    const args: BashToolArgs = {\r\n      script:\r\n        \"for i in {1..500}; do printf 'line%04d with padding text\\\\n' $i; done; echo 'COMPLETION_MARKER'\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      // Should hit display limit\r\n      expect(result.note).toContain(\"display limit\");\r\n      expect(result.exitCode).toBe(0);\r\n\r\n      // Extract and verify temp file contains the completion marker\r\n      const match = /saved to (\\/.*?\\.txt)/.exec(result.note ?? \"\");\r\n      expect(match).toBeDefined();\r\n      if (match) {\r\n        const overflowPath = match[1];\r\n        const fileContent = fs.readFileSync(overflowPath, \"utf-8\");\r\n\r\n        // CRITICAL: File must contain COMPLETION_MARKER, proving command ran to completion\r\n        // If process was killed at display limit, this marker would be missing\r\n        expect(fileContent).toContain(\"COMPLETION_MARKER\");\r\n\r\n        // Clean up\r\n        fs.unlinkSync(overflowPath);\r\n      }\r\n    }\r\n\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should kill process immediately when single line exceeds per-line limit\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-per-line-kill\");\r\n    const tool = createBashTool({\r\n      ...getTestDeps(),\r\n      cwd: process.cwd(),\r\n      runtime: new LocalRuntime(process.cwd()),\r\n      runtimeTempDir: tempDir.path,\r\n    });\r\n\r\n    // Generate a single line exceeding 1KB limit, then try to output more\r\n    const args: BashToolArgs = {\r\n      run_in_background: false,\r\n      script: \"printf 'x%.0s' {1..2000}; echo; echo 'SHOULD_NOT_APPEAR'\",\r\n      timeout_secs: 5,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      // Should hit per-line limit (file truncation, not display)\r\n      expect(result.output).toBe(\"\");\r\n      expect(result.note).toContain(\"per-line limit\");\r\n      expect(result.exitCode).toBe(0);\r\n\r\n      // Extract and verify temp file does NOT contain the second echo\r\n      const match = /saved to (\\/.*?\\.txt)/.exec(result.note ?? \"\");\r\n      expect(match).toBeDefined();\r\n      if (match) {\r\n        const overflowPath = match[1];\r\n        const fileContent = fs.readFileSync(overflowPath, \"utf-8\");\r\n\r\n        // CRITICAL: File must NOT contain SHOULD_NOT_APPEAR\r\n        // This proves process was killed immediately at per-line limit\r\n        expect(fileContent).not.toContain(\"SHOULD_NOT_APPEAR\");\r\n\r\n        // Clean up\r\n        fs.unlinkSync(overflowPath);\r\n      }\r\n    }\r\n\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should handle output just under 16KB without truncation\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-under-limit\");\r\n    const tool = createBashTool({\r\n      ...getTestDeps(),\r\n      cwd: process.cwd(),\r\n      runtime: new LocalRuntime(process.cwd()),\r\n      runtimeTempDir: tempDir.path,\r\n    });\r\n\r\n    // Generate ~15KB of output (just under 16KB display limit)\r\n    // Each line is ~50 bytes, 15KB / 50 = 300 lines exactly (at the line limit)\r\n    const args: BashToolArgs = {\r\n      run_in_background: false,\r\n      script: \"for i in {1..299}; do printf 'line%04d with some padding text here now\\\\n' $i; done\",\r\n      timeout_secs: 5,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    // Should succeed without overflow (299 lines < 300 line limit)\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toContain(\"line0001\");\r\n      expect(result.output).toContain(\"line0299\");\r\n      // Should NOT have created a temp file\r\n      const files = fs.readdirSync(tempDir.path);\r\n      expect(files.length).toBe(0);\r\n    }\r\n\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should trigger display truncation at exactly 300 lines\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-exact-limit\");\r\n    const tool = createBashTool({\r\n      ...getTestDeps(),\r\n      cwd: process.cwd(),\r\n      runtime: new LocalRuntime(process.cwd()),\r\n      runtimeTempDir: tempDir.path,\r\n    });\r\n\r\n    // Generate exactly 300 lines (hits line limit exactly)\r\n    const args: BashToolArgs = {\r\n      run_in_background: false,\r\n      script: \"for i in {1..300}; do printf 'line%04d\\\\n' $i; done\",\r\n      timeout_secs: 5,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    // Should trigger display truncation at exactly 300 lines\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      expect(result.output).toBe(\"\");\r\n      expect(result.note).toContain(\"[OUTPUT OVERFLOW\");\r\n      expect(result.note).toContain(\"300 lines\");\r\n      expect(result.note).toContain(\"display limit\");\r\n      expect(result.exitCode).toBe(0);\r\n    }\r\n\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should interleave stdout and stderr\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args: BashToolArgs = {\r\n      script: \"echo stdout1 && echo stderr1 >&2 && echo stdout2 && echo stderr2 >&2\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      // Output should contain all lines interleaved\r\n      expect(result.output).toContain(\"stdout1\");\r\n      expect(result.output).toContain(\"stderr1\");\r\n      expect(result.output).toContain(\"stdout2\");\r\n      expect(result.output).toContain(\"stderr2\");\r\n    }\r\n  });\r\n\r\n  it(\"should handle command failure with exit code\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args: BashToolArgs = {\r\n      script: \"exit 42\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.exitCode).toBe(42);\r\n      expect(result.error).toContain(\"exited with code 42\");\r\n    }\r\n  });\r\n\r\n  it(\"should timeout long-running commands\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args: BashToolArgs = {\r\n      script: \"while true; do sleep 0.1; done\",\r\n      timeout_secs: 1,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"timeout\");\r\n      expect(result.exitCode).toBe(-1);\r\n    }\r\n  });\r\n\r\n  it(\"should handle empty output\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args: BashToolArgs = {\r\n      script: \"true\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toBe(\"\");\r\n      expect(result.exitCode).toBe(0);\r\n    }\r\n  });\r\n\r\n  it(\"should complete instantly for grep-like commands (regression test)\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const startTime = performance.now();\r\n\r\n    // This test catches the bug where readline interface close events\r\n    // weren't firing, causing commands with minimal output to hang\r\n    const args: BashToolArgs = {\r\n      script: \"echo 'test:first-child' | grep ':first-child'\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n    const duration = performance.now() - startTime;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toContain(\"first-child\");\r\n      expect(result.exitCode).toBe(0);\r\n      // Should complete in well under 1 second (give 2s buffer for slow machines)\r\n      expect(duration).toBeLessThan(2000);\r\n    }\r\n  });\r\n\r\n  it(\"should not hang on commands that read from stdin (cat test)\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const startTime = performance.now();\r\n\r\n    // cat without input should complete immediately\r\n    // This used to hang because stdin.close() would wait for acknowledgment\r\n    // Fixed by using stdin.abort() for immediate closure\r\n    const args: BashToolArgs = {\r\n      script: \"echo test | cat\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n    const duration = performance.now() - startTime;\r\n\r\n    // Should complete almost instantly (not wait for timeout)\r\n    expect(duration).toBeLessThan(4000);\r\n\r\n    // cat with no input should succeed with empty output (stdin is closed)\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toContain(\"test\");\r\n      expect(duration).toBeLessThan(2000);\r\n    }\r\n  });\r\n\r\n  it(\"should present stdin as a non-pipe for search tools\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n\r\n    const args: BashToolArgs = {\r\n      script:\r\n        'python3 -c \"import os,stat;mode=os.fstat(0).st_mode;print(stat.S_IFMT(mode)==stat.S_IFIFO)\"',\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output.trim()).toBe(\"False\");\r\n    }\r\n  });\r\n\r\n  it(\"should not hang on git rebase --continue\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const startTime = performance.now();\r\n\r\n    // Extremely minimal case - just enough to trigger rebase --continue\r\n    const script = `\r\n      T=$(mktemp -d) && cd \"$T\"\r\n      git init && git config user.email \"t@t\" && git config user.name \"T\" && git config commit.gpgsign false\r\n      echo a > f && git add f && git commit -m a\r\n      git checkout -b b && echo b > f && git commit -am b\r\n      git checkout main && echo c > f && git commit -am c\r\n      git rebase b || true\r\n      echo resolved > f && git add f\r\n      git rebase --continue\r\n    `;\r\n\r\n    const result = (await tool.execute!(\r\n      { script, timeout_secs: 5 },\r\n      mockToolCallOptions\r\n    )) as BashToolResult;\r\n\r\n    const duration = performance.now() - startTime;\r\n\r\n    expect(duration).toBeLessThan(4000);\r\n    expect(result).toBeDefined();\r\n  });\r\n\r\n  it(\"should work with just script and timeout\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n\r\n    const args: BashToolArgs = {\r\n      script: \"echo test\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toBe(\"test\");\r\n    }\r\n  });\r\n\r\n  it(\"should allow commands that don't start with cd\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n\r\n    const args: BashToolArgs = {\r\n      script: \"echo 'cd' && echo test\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toContain(\"cd\");\r\n      expect(result.output).toContain(\"test\");\r\n    }\r\n  });\r\n\r\n  it(\"should complete quickly when background process is spawned\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const startTime = performance.now();\r\n\r\n    const args: BashToolArgs = {\r\n      // Background process that would block if we waited for it\r\n      script: \"while true; do sleep 1; done > /dev/null 2>&1 &\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n    const duration = performance.now() - startTime;\r\n\r\n    expect(result.success).toBe(true);\r\n    // Should complete in well under 1 second, not wait for infinite loop\r\n    expect(duration).toBeLessThan(2000);\r\n  });\r\n\r\n  it(\"should complete quickly with background process and PID echo\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const startTime = performance.now();\r\n\r\n    const args: BashToolArgs = {\r\n      // Spawn background process, echo its PID, then exit\r\n      // Should not wait for the background process\r\n      script: \"while true; do sleep 1; done > /dev/null 2>&1 & echo $!\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n    const duration = performance.now() - startTime;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      // Should output the PID\r\n      expect(result.output).toMatch(/^\\d+$/);\r\n    }\r\n    // Should complete quickly\r\n    expect(duration).toBeLessThan(2000);\r\n  });\r\n\r\n  it(\"should timeout background processes that don't complete\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const startTime = performance.now();\r\n\r\n    const args: BashToolArgs = {\r\n      // Background process with output redirected but still blocking\r\n      script: \"while true; do sleep 0.1; done & wait\",\r\n      timeout_secs: 1,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n    const duration = performance.now() - startTime;\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"timeout\");\r\n      expect(duration).toBeLessThan(2000);\r\n    }\r\n  });\r\n\r\n  it(\"should report overflow when line exceeds max line bytes\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const longLine = \"x\".repeat(2000);\r\n    const args: BashToolArgs = {\r\n      script: `echo '${longLine}'`,\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      expect(result.output).toBe(\"\");\r\n      expect(result.note).toMatch(/exceeded per-line limit|OUTPUT OVERFLOW/);\r\n      expect(result.exitCode).toBe(0);\r\n    }\r\n  });\r\n\r\n  it(\"should report overflow when total bytes limit exceeded\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const lineContent = \"x\".repeat(100);\r\n    const numLines = Math.ceil(BASH_MAX_TOTAL_BYTES / 100) + 50;\r\n    const args: BashToolArgs = {\r\n      script: `for i in {1..${numLines}}; do echo '${lineContent}'; done`,\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      expect(result.output).toBe(\"\");\r\n      expect(result.note).toMatch(/Total output exceeded limit|OUTPUT OVERFLOW/);\r\n      expect(result.exitCode).toBe(0);\r\n    }\r\n  });\r\n\r\n  it(\"should report overflow when byte limit is reached\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args: BashToolArgs = {\r\n      run_in_background: false,\r\n      script: `for i in {1..1000}; do echo 'This is line number '$i' with some content'; done`,\r\n      timeout_secs: 5,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (isForegroundSuccess(result)) {\r\n      expect(result.output).toBe(\"\");\r\n      expect(result.note).toMatch(/Total output exceeded limit|OUTPUT OVERFLOW/);\r\n      expect(result.exitCode).toBe(0);\r\n    }\r\n  });\r\n\r\n  it(\"should fail immediately when script is empty\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args: BashToolArgs = {\r\n      script: \"\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"Script parameter is empty\");\r\n      expect(result.error).toContain(\"malformed tool call\");\r\n      expect(result.exitCode).toBe(-1);\r\n      expect(result.wall_duration_ms).toBe(0);\r\n    }\r\n  });\r\n\r\n  describe(\"script sanitization\", () => {\r\n    const shouldRewriteNullRedirects = process.platform === \"win32\";\r\n\r\n    it(\"should rewrite >nul to /dev/null (and not create a `nul` file)\", async () => {\r\n      using tempDir = new TestTempDir(\"test-bash-nul-redirect\");\r\n      const tool = createBashTool(createTestToolConfig(tempDir.path));\r\n\r\n      const args: BashToolArgs = {\r\n        script: \"echo hello >nul\",\r\n        timeout_secs: 5,\r\n        run_in_background: false,\r\n        display_name: \"test\",\r\n      };\r\n\r\n      const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n      expect(result.success).toBe(true);\r\n      if (isForegroundSuccess(result)) {\r\n        if (shouldRewriteNullRedirects) {\r\n          expect(result.note).toContain(\"Rewrote `>nul`/`2>nul`\");\r\n        } else {\r\n          expect(result.note).toBeUndefined();\r\n        }\r\n      }\r\n\r\n      expect(fs.existsSync(path.join(tempDir.path, \"nul\"))).toBe(!shouldRewriteNullRedirects);\r\n    });\r\n\r\n    it(\"should rewrite 2>nul to /dev/null (and not create a `nul` file)\", async () => {\r\n      using tempDir = new TestTempDir(\"test-bash-nul-redirect-stderr\");\r\n      const tool = createBashTool(createTestToolConfig(tempDir.path));\r\n\r\n      const args: BashToolArgs = {\r\n        script: \"ls does-not-exist 2>nul || true\",\r\n        timeout_secs: 5,\r\n        run_in_background: false,\r\n        display_name: \"test\",\r\n      };\r\n\r\n      const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n      expect(result.success).toBe(true);\r\n      if (isForegroundSuccess(result)) {\r\n        if (shouldRewriteNullRedirects) {\r\n          expect(result.note).toContain(\"Rewrote `>nul`/`2>nul`\");\r\n        } else {\r\n          expect(result.note).toBeUndefined();\r\n        }\r\n      }\r\n\r\n      expect(fs.existsSync(path.join(tempDir.path, \"nul\"))).toBe(!shouldRewriteNullRedirects);\r\n    });\r\n\r\n    it(\"should not rewrite an explicit path like >./nul\", async () => {\r\n      using tempDir = new TestTempDir(\"test-bash-dot-nul\");\r\n      const tool = createBashTool(createTestToolConfig(tempDir.path));\r\n\r\n      const args: BashToolArgs = {\r\n        script: \"echo hello >./nul\",\r\n        timeout_secs: 5,\r\n        run_in_background: false,\r\n        display_name: \"test\",\r\n      };\r\n\r\n      const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n      expect(result.success).toBe(true);\r\n      if (isForegroundSuccess(result)) {\r\n        expect(result.note).toBeUndefined();\r\n      }\r\n\r\n      expect(fs.existsSync(path.join(tempDir.path, \"nul\"))).toBe(true);\r\n    });\r\n  });\r\n\r\n  it(\"should fail immediately when script is only whitespace\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args: BashToolArgs = {\r\n      script: \"   \\n\\t  \",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"Script parameter is empty\");\r\n      expect(result.exitCode).toBe(-1);\r\n      expect(result.wall_duration_ms).toBe(0);\r\n    }\r\n  });\r\n\r\n  it(\"should allow sleep command at start of script\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args: BashToolArgs = {\r\n      script: \"sleep 0.1; echo done\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toBe(\"done\");\r\n      expect(result.exitCode).toBe(0);\r\n    }\r\n  });\r\n\r\n  it(\"should allow sleep in polling loops\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args: BashToolArgs = {\r\n      script: \"for i in 1 2 3; do echo $i; sleep 0.1; done\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toContain(\"1\");\r\n      expect(result.output).toContain(\"2\");\r\n      expect(result.output).toContain(\"3\");\r\n    }\r\n  });\r\n\r\n  it(\"should use default timeout (3s) when timeout_secs is undefined\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args = {\r\n      script: \"echo hello\",\r\n      timeout_secs: undefined,\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toBe(\"hello\");\r\n      expect(result.exitCode).toBe(0);\r\n    }\r\n  });\r\n\r\n  it(\"should use default timeout (3s) when timeout_secs is omitted\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args = {\r\n      script: \"echo hello\",\r\n      // timeout_secs omitted entirely\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toBe(\"hello\");\r\n      expect(result.exitCode).toBe(0);\r\n    }\r\n  });\r\n\r\n  // Note: Zero and negative timeout_secs are rejected by Zod schema validation\r\n  // before reaching the execute function, so these cases are handled at the schema level\r\n});\r\n\r\ndescribe(\"zombie process cleanup\", () => {\r\n  it(\"should not create zombie processes when spawning background tasks\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n\r\n    // Spawn a background sleep process that would become a zombie if not cleaned up\r\n    // Use a unique marker to identify our test process\r\n    const marker = `zombie-test-${Date.now()}`;\r\n    const args: BashToolArgs = {\r\n      script: `echo \"${marker}\"; sleep 100 & echo $!`,\r\n      timeout_secs: 1,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    // Tool should complete successfully\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toContain(marker);\r\n      const lines = result.output.split(\"\\n\");\r\n      const bgPid = lines[1]; // Second line should be the background PID\r\n\r\n      // Give a moment for cleanup to happen\r\n      await new Promise((resolve) => setTimeout(resolve, 100));\r\n\r\n      // Verify the background process was killed (process group cleanup)\r\n      using checkEnv = createTestBashTool();\r\n      const checkResult = (await checkEnv.tool.execute!(\r\n        {\r\n          script: `ps -p ${bgPid} > /dev/null 2>&1 && echo \"ALIVE\" || echo \"DEAD\"`,\r\n          timeout_secs: 1,\r\n        },\r\n        mockToolCallOptions\r\n      )) as BashToolResult;\r\n\r\n      expect(checkResult.success).toBe(true);\r\n      if (checkResult.success) {\r\n        expect(checkResult.output).toBe(\"DEAD\");\r\n      }\r\n    }\r\n  });\r\n\r\n  it(\"should kill all processes when aborted via AbortController\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n\r\n    // Create AbortController to simulate user interruption\r\n    const abortController = new AbortController();\r\n\r\n    // Use unique token to identify our test processes\r\n    const token = (100 + Math.random() * 100).toFixed(4); // Unique duration for grep\r\n\r\n    // Spawn a command that creates child processes (simulating cargo build)\r\n    const args: BashToolArgs = {\r\n      script: `\r\n        # Simulate cargo spawning rustc processes\r\n        for i in {1..5}; do\r\n          (echo \"child-\\${i}\"; exec sleep ${token}) &\r\n          echo \"SPAWNED:$!\"\r\n        done\r\n        echo \"ALL_SPAWNED\"\r\n        # Wait so we can abort while children are running\r\n        exec sleep ${token}\r\n      `,\r\n      timeout_secs: 10,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    // Start the command\r\n    const resultPromise = tool.execute!(args, {\r\n      ...mockToolCallOptions,\r\n      abortSignal: abortController.signal,\r\n    }) as Promise<BashToolResult>;\r\n\r\n    // Wait for children to spawn\r\n    await new Promise((resolve) => setTimeout(resolve, 500));\r\n\r\n    // Abort the operation (simulating Ctrl+C)\r\n    abortController.abort();\r\n\r\n    // Wait for the result\r\n    const result = await resultPromise;\r\n\r\n    // Command should be aborted\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"aborted\");\r\n    }\r\n\r\n    // Wait for all processes to be cleaned up (SIGKILL needs time to propagate in CI)\r\n    // Retry with exponential backoff instead of fixed wait\r\n    // Use ps + grep to avoid pgrep matching itself\r\n    let remainingProcesses = -1;\r\n    for (let attempt = 0; attempt < 5; attempt++) {\r\n      await new Promise((resolve) => setTimeout(resolve, 200 * (attempt + 1)));\r\n\r\n      using checkEnv = createTestBashTool();\r\n      const checkResult = (await checkEnv.tool.execute!(\r\n        {\r\n          script: `ps aux | grep \"sleep ${token}\" | grep -v grep | wc -l`,\r\n          timeout_secs: 1,\r\n        },\r\n        mockToolCallOptions\r\n      )) as BashToolResult;\r\n\r\n      expect(checkResult.success).toBe(true);\r\n      if (checkResult.success) {\r\n        remainingProcesses = parseInt(checkResult.output.trim());\r\n        if (remainingProcesses === 0) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    expect(remainingProcesses).toBe(0);\r\n  });\r\n\r\n  it(\"should abort quickly when command produces continuous output\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n\r\n    // Create AbortController to simulate user interruption\r\n    const abortController = new AbortController();\r\n\r\n    // Command that produces slow, continuous output\r\n    // The key is it keeps running, so the abort happens while reader.read() is waiting\r\n    const args: BashToolArgs = {\r\n      script: `\r\n        # Produce continuous output slowly (prevents hitting truncation limits)\r\n        for i in {1..1000}; do\r\n          echo \"Output line $i\"\r\n          sleep 0.1\r\n        done\r\n      `,\r\n      timeout_secs: 120,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    // Start the command\r\n    const resultPromise = tool.execute!(args, {\r\n      ...mockToolCallOptions,\r\n      abortSignal: abortController.signal,\r\n    }) as Promise<BashToolResult>;\r\n\r\n    // Wait for output to start (give it time to produce a few lines)\r\n    await new Promise((resolve) => setTimeout(resolve, 250));\r\n\r\n    // Abort the operation while it's still producing output\r\n    const abortTime = Date.now();\r\n    abortController.abort();\r\n\r\n    // Wait for the result with a timeout to detect hangs\r\n    const timeoutPromise = new Promise((_, reject) =>\r\n      setTimeout(() => reject(new Error(\"Test timeout - tool did not abort quickly\")), 5000)\r\n    );\r\n\r\n    const result = (await Promise.race([resultPromise, timeoutPromise])) as BashToolResult;\r\n    const duration = Date.now() - abortTime;\r\n\r\n    // Command should be aborted\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      // Error should mention abort or indicate the process was killed\r\n      const errorText = result.error.toLowerCase();\r\n      expect(\r\n        errorText.includes(\"abort\") ||\r\n          errorText.includes(\"killed\") ||\r\n          errorText.includes(\"signal\") ||\r\n          result.exitCode === -1\r\n      ).toBe(true);\r\n    }\r\n\r\n    // CRITICAL: Tool should return quickly after abort (< 2s)\r\n    // This is the regression test - without checking abort signal in consumeStream(),\r\n    // the tool hangs until the streams close (which can take a long time)\r\n    expect(duration).toBeLessThan(2000);\r\n  });\r\n});\r\n\r\ndescribe(\"muxEnv environment variables\", () => {\r\n  it(\"should inject MUX_ environment variables when muxEnv is provided\", async () => {\r\n    using tempDir = new TestTempDir(\"test-mux-env\");\r\n    const config = createTestToolConfig(process.cwd());\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.muxEnv = {\r\n      MUX_PROJECT_PATH: \"/test/project/path\",\r\n      MUX_RUNTIME: \"worktree\",\r\n      MUX_WORKSPACE_NAME: \"feature-branch\",\r\n    };\r\n    const tool = createBashTool(config);\r\n\r\n    const args: BashToolArgs = {\r\n      script: 'echo \"PROJECT:$MUX_PROJECT_PATH RUNTIME:$MUX_RUNTIME WORKSPACE:$MUX_WORKSPACE_NAME\"',\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toContain(\"PROJECT:/test/project/path\");\r\n      expect(result.output).toContain(\"RUNTIME:worktree\");\r\n      expect(result.output).toContain(\"WORKSPACE:feature-branch\");\r\n    }\r\n  });\r\n\r\n  it(\"should allow secrets to override muxEnv\", async () => {\r\n    using tempDir = new TestTempDir(\"test-mux-env-override\");\r\n    const config = createTestToolConfig(process.cwd());\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.muxEnv = {\r\n      MUX_PROJECT_PATH: \"/mux/path\",\r\n      CUSTOM_VAR: \"from-mux\",\r\n    };\r\n    config.secrets = {\r\n      CUSTOM_VAR: \"from-secrets\",\r\n    };\r\n    const tool = createBashTool(config);\r\n\r\n    const args: BashToolArgs = {\r\n      script: 'echo \"MUX:$MUX_PROJECT_PATH CUSTOM:$CUSTOM_VAR\"',\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      // MUX_PROJECT_PATH from muxEnv should be present\r\n      expect(result.output).toContain(\"MUX:/mux/path\");\r\n      // Secrets should override muxEnv when there's a conflict\r\n      expect(result.output).toContain(\"CUSTOM:from-secrets\");\r\n    }\r\n  });\r\n});\r\n\r\ndescribe(\"SSH runtime redundant cd detection\", () => {\r\n  // Helper to create bash tool with SSH runtime configuration\r\n  // Note: These tests check redundant cd detection logic only - they don't actually execute via SSH\r\n  function createTestBashToolWithSSH(cwd: string) {\r\n    const tempDir = new TestTempDir(\"test-bash-ssh\");\r\n    const sshConfig = {\r\n      type: \"ssh\" as const,\r\n      host: \"test-host\",\r\n      srcBaseDir: \"/remote/base\",\r\n    };\r\n    const sshRuntime = createRuntime(sshConfig);\r\n\r\n    // Pre-mark connection as healthy to skip actual SSH probe in tests\r\n    sshConnectionPool.markHealthy(sshConfig);\r\n\r\n    const tool = createBashTool({\r\n      ...getTestDeps(),\r\n      cwd,\r\n      runtime: sshRuntime,\r\n      runtimeTempDir: tempDir.path,\r\n    });\r\n\r\n    return {\r\n      tool,\r\n      [Symbol.dispose]() {\r\n        tempDir[Symbol.dispose]();\r\n      },\r\n    };\r\n  }\r\n\r\n  it(\"should reject redundant cd when command cds to working directory\", async () => {\r\n    const remoteCwd = \"/remote/workspace/project/branch\";\r\n    using testEnv = createTestBashToolWithSSH(remoteCwd);\r\n    const tool = testEnv.tool;\r\n\r\n    const args: BashToolArgs = {\r\n      script: \"cd /remote/workspace/project/branch && echo test\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    // Should reject the redundant cd\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"Redundant cd to working directory\");\r\n      expect(result.error).toContain(\"no cd needed\");\r\n      expect(result.exitCode).toBe(-1);\r\n    }\r\n  });\r\n\r\n  it(\"should not treat cd to a different directory as redundant\", () => {\r\n    // Only testing normalization here - SSH execution would hang (no real host).\r\n    const remoteCwd = \"/remote/workspace/project/branch\";\r\n\r\n    const sshRuntime = createRuntime({\r\n      type: \"ssh\" as const,\r\n      host: \"test-host\",\r\n      srcBaseDir: \"/remote/base\",\r\n    });\r\n\r\n    const normalizedTarget = sshRuntime.normalizePath(\"/tmp\", remoteCwd);\r\n    const normalizedCwd = sshRuntime.normalizePath(\".\", remoteCwd);\r\n\r\n    expect(normalizedTarget).not.toBe(normalizedCwd);\r\n  });\r\n});\r\n\r\ndescribe(\"bash tool - tool_env\", () => {\r\n  it(\"should source .mux/tool_env before running script\", async () => {\r\n    using tempDir = new TestTempDir(\"test-bash-tool-env\");\r\n    const muxDir = `${tempDir.path}/.mux`;\r\n    fs.mkdirSync(muxDir, { recursive: true });\r\n    fs.writeFileSync(`${muxDir}/tool_env`, \"export MUX_TEST_VAR=from_tool_env\");\r\n\r\n    const config = createTestToolConfig(tempDir.path);\r\n    config.runtimeTempDir = tempDir.path;\r\n    const tool = createBashTool(config);\r\n\r\n    const args: BashToolArgs = {\r\n      script: \"echo $MUX_TEST_VAR\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    expect(result.output).toBe(\"from_tool_env\");\r\n  });\r\n\r\n  it(\"should fail with clear error if tool_env sourcing fails\", async () => {\r\n    using tempDir = new TestTempDir(\"test-bash-tool-env-fail\");\r\n    const muxDir = `${tempDir.path}/.mux`;\r\n    fs.mkdirSync(muxDir, { recursive: true });\r\n    // Fail `source` without terminating the parent shell.\r\n    fs.writeFileSync(`${muxDir}/tool_env`, \"return 1\");\r\n\r\n    const config = createTestToolConfig(tempDir.path);\r\n    config.runtimeTempDir = tempDir.path;\r\n    const tool = createBashTool(config);\r\n\r\n    const args: BashToolArgs = {\r\n      script: \"echo should_not_run\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(false);\r\n    expect(result.exitCode).toBe(1);\r\n    expect(result.output).toContain(\"failed to source\");\r\n  });\r\n\r\n  it(\"should run script normally when no tool_env exists\", async () => {\r\n    using tempDir = new TestTempDir(\"test-bash-no-tool-env\");\r\n\r\n    const config = createTestToolConfig(tempDir.path);\r\n    config.runtimeTempDir = tempDir.path;\r\n    const tool = createBashTool(config);\r\n\r\n    const args: BashToolArgs = {\r\n      script: \"echo normal_execution\",\r\n      timeout_secs: 5,\r\n      run_in_background: false,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    expect(result.output).toBe(\"normal_execution\");\r\n  });\r\n});\r\n\r\ndescribe(\"bash tool - background execution\", () => {\r\n  it(\"should reject background mode when manager not available\", async () => {\r\n    using testEnv = createTestBashTool();\r\n    const tool = testEnv.tool;\r\n    const args: BashToolArgs = {\r\n      script: \"echo test\",\r\n      timeout_secs: 5,\r\n      run_in_background: true,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"Background execution is only available for AI tool calls\");\r\n    }\r\n  });\r\n\r\n  it(\"should accept timeout with background mode for auto-termination\", async () => {\r\n    const manager = new BackgroundProcessManager(\"/tmp/mux-test-bg\");\r\n\r\n    const tempDir = new TestTempDir(\"test-bash-bg\");\r\n    const config = createTestToolConfig(tempDir.path);\r\n    config.backgroundProcessManager = manager;\r\n\r\n    const tool = createBashTool(config);\r\n    const args: BashToolArgs = {\r\n      script: \"echo test\",\r\n      timeout_secs: 5,\r\n      run_in_background: true,\r\n      display_name: \"test-timeout-bg\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    // Background with timeout should succeed - timeout is used for auto-termination\r\n    expect(result.success).toBe(true);\r\n    if (result.success && \"backgroundProcessId\" in result) {\r\n      expect(result.backgroundProcessId).toBe(\"test-timeout-bg\");\r\n    }\r\n\r\n    await manager.terminateAll();\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should start background process and return process ID\", async () => {\r\n    const manager = new BackgroundProcessManager(\"/tmp/mux-test-bg\");\r\n\r\n    const tempDir = new TestTempDir(\"test-bash-bg\");\r\n    const config = createTestToolConfig(tempDir.path);\r\n    config.backgroundProcessManager = manager;\r\n\r\n    const tool = createBashTool(config);\r\n    const args: BashToolArgs = {\r\n      script: \"echo hello\",\r\n      timeout_secs: 5,\r\n      run_in_background: true,\r\n      display_name: \"test\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success && \"backgroundProcessId\" in result) {\r\n      expect(result.backgroundProcessId).toBeDefined();\r\n\r\n      // Process ID is now the display name directly\r\n      expect(result.backgroundProcessId).toBe(\"test\");\r\n    } else {\r\n      throw new Error(\"Expected background process ID in result\");\r\n    }\r\n\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should inject muxEnv environment variables in background mode\", async () => {\r\n    const manager = new BackgroundProcessManager(\"/tmp/mux-test-bg\");\r\n\r\n    const tempDir = new TestTempDir(\"test-bash-bg-mux-env\");\r\n    const config = createTestToolConfig(tempDir.path);\r\n    config.backgroundProcessManager = manager;\r\n    config.muxEnv = {\r\n      MUX_MODEL_STRING: \"openai:gpt-5.2\",\r\n      MUX_THINKING_LEVEL: \"medium\",\r\n    };\r\n\r\n    const tool = createBashTool(config);\r\n    const args: BashToolArgs = {\r\n      script: 'echo \"MODEL:$MUX_MODEL_STRING THINKING:$MUX_THINKING_LEVEL\"',\r\n      timeout_secs: 5,\r\n      run_in_background: true,\r\n      display_name: \"test-mux-env-bg\",\r\n    };\r\n\r\n    const result = (await tool.execute!(args, mockToolCallOptions)) as BashToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success && \"backgroundProcessId\" in result) {\r\n      const outputResult = await manager.getOutput(\r\n        result.backgroundProcessId,\r\n        undefined,\r\n        undefined,\r\n        2\r\n      );\r\n      expect(outputResult.success).toBe(true);\r\n      if (outputResult.success) {\r\n        expect(outputResult.output).toContain(\"MODEL:openai:gpt-5.2\");\r\n        expect(outputResult.output).toContain(\"THINKING:medium\");\r\n      }\r\n    } else {\r\n      throw new Error(\"Expected background process ID in result\");\r\n    }\r\n\r\n    await manager.terminateAll();\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n});\r\n"]}