{"version":3,"file":"fileCommon.test.js","sourceRoot":"","sources":["../../../../src/node/services/tools/fileCommon.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, it, expect } from \"bun:test\";\r\nimport type { ToolConfiguration } from \"@/common/utils/tools/tools\";\r\nimport type { FileStat, Runtime } from \"@/node/runtime/Runtime\";\r\nimport {\r\n  validatePlanModeAccess,\r\n  validatePathInCwd,\r\n  validateFileSize,\r\n  validateNoRedundantPrefix,\r\n  MAX_FILE_SIZE,\r\n} from \"./fileCommon\";\r\nimport { createRuntime } from \"@/node/runtime/runtimeFactory\";\r\n\r\ndescribe(\"fileCommon\", () => {\r\n  describe(\"validateFileSize\", () => {\r\n    it(\"should return null for files within size limit\", () => {\r\n      const stats: FileStat = {\r\n        size: 1024, // 1KB\r\n        modifiedTime: new Date(),\r\n        isDirectory: false,\r\n      };\r\n\r\n      expect(validateFileSize(stats)).toBeNull();\r\n    });\r\n\r\n    it(\"should return null for files at exactly the limit\", () => {\r\n      const stats: FileStat = {\r\n        size: MAX_FILE_SIZE,\r\n        modifiedTime: new Date(),\r\n        isDirectory: false,\r\n      };\r\n\r\n      expect(validateFileSize(stats)).toBeNull();\r\n    });\r\n\r\n    it(\"should return error for files exceeding size limit\", () => {\r\n      const stats: FileStat = {\r\n        size: MAX_FILE_SIZE + 1,\r\n        modifiedTime: new Date(),\r\n        isDirectory: false,\r\n      };\r\n\r\n      const result = validateFileSize(stats);\r\n      expect(result).not.toBeNull();\r\n      expect(result?.error).toContain(\"too large\");\r\n      expect(result?.error).toContain(\"system tools\");\r\n    });\r\n\r\n    it(\"should include size information in error message\", () => {\r\n      const stats: FileStat = {\r\n        size: MAX_FILE_SIZE * 2, // 2MB\r\n        modifiedTime: new Date(),\r\n        isDirectory: false,\r\n      };\r\n\r\n      const result = validateFileSize(stats);\r\n      expect(result?.error).toContain(\"2.00MB\");\r\n      expect(result?.error).toContain(\"1.00MB\");\r\n    });\r\n\r\n    it(\"should suggest alternative tools in error message\", () => {\r\n      const stats: FileStat = {\r\n        size: MAX_FILE_SIZE + 1,\r\n        modifiedTime: new Date(),\r\n        isDirectory: false,\r\n      };\r\n\r\n      const result = validateFileSize(stats);\r\n      expect(result?.error).toContain(\"grep\");\r\n      expect(result?.error).toContain(\"sed\");\r\n    });\r\n  });\r\n\r\n  describe(\"validatePathInCwd\", () => {\r\n    const cwd = \"/workspace/project\";\r\n    const runtime = createRuntime({ type: \"local\", srcBaseDir: cwd });\r\n\r\n    it(\"should allow relative paths within cwd\", () => {\r\n      expect(validatePathInCwd(\"src/file.ts\", cwd, runtime)).toBeNull();\r\n      expect(validatePathInCwd(\"./src/file.ts\", cwd, runtime)).toBeNull();\r\n      expect(validatePathInCwd(\"file.ts\", cwd, runtime)).toBeNull();\r\n    });\r\n\r\n    it(\"should allow absolute paths within extraAllowedDirs\", () => {\r\n      expect(validatePathInCwd(\"/tmp/test.txt\", cwd, runtime, [\"/tmp\"])).toBeNull();\r\n    });\r\n\r\n    it(\"should reject absolute paths outside cwd and extraAllowedDirs\", () => {\r\n      const result = validatePathInCwd(\"/etc/passwd\", cwd, runtime, [\"/tmp\"]);\r\n      expect(result).not.toBeNull();\r\n      expect(result?.error).toContain(\"restricted to the workspace directory\");\r\n    });\r\n\r\n    it(\"should allow absolute paths within cwd\", () => {\r\n      expect(validatePathInCwd(\"/workspace/project/src/file.ts\", cwd, runtime)).toBeNull();\r\n      expect(validatePathInCwd(\"/workspace/project/file.ts\", cwd, runtime)).toBeNull();\r\n    });\r\n\r\n    it(\"should reject paths that go up and outside cwd with ..\", () => {\r\n      const result = validatePathInCwd(\"../outside.ts\", cwd, runtime);\r\n      expect(result).not.toBeNull();\r\n      expect(result?.error).toContain(\"restricted to the workspace directory\");\r\n      expect(result?.error).toContain(\"/workspace/project\");\r\n    });\r\n\r\n    it(\"should reject paths that go multiple levels up\", () => {\r\n      const result = validatePathInCwd(\"../../outside.ts\", cwd, runtime);\r\n      expect(result).not.toBeNull();\r\n      expect(result?.error).toContain(\"restricted to the workspace directory\");\r\n    });\r\n\r\n    it(\"should reject paths that go down then up outside cwd\", () => {\r\n      const result = validatePathInCwd(\"src/../../outside.ts\", cwd, runtime);\r\n      expect(result).not.toBeNull();\r\n      expect(result?.error).toContain(\"restricted to the workspace directory\");\r\n    });\r\n\r\n    it(\"should reject absolute paths outside cwd\", () => {\r\n      const result = validatePathInCwd(\"/etc/passwd\", cwd, runtime);\r\n      expect(result).not.toBeNull();\r\n      expect(result?.error).toContain(\"restricted to the workspace directory\");\r\n    });\r\n\r\n    it(\"should reject absolute paths in different directory tree\", () => {\r\n      const result = validatePathInCwd(\"/home/user/file.ts\", cwd, runtime);\r\n      expect(result).not.toBeNull();\r\n      expect(result?.error).toContain(\"restricted to the workspace directory\");\r\n    });\r\n\r\n    it(\"should handle paths with trailing slashes\", () => {\r\n      expect(validatePathInCwd(\"src/\", cwd, runtime)).toBeNull();\r\n    });\r\n\r\n    it(\"should handle nested paths correctly\", () => {\r\n      expect(validatePathInCwd(\"src/components/Button/index.ts\", cwd, runtime)).toBeNull();\r\n      expect(validatePathInCwd(\"./src/components/Button/index.ts\", cwd, runtime)).toBeNull();\r\n    });\r\n\r\n    it(\"should provide helpful error message mentioning to ask user\", () => {\r\n      const result = validatePathInCwd(\"../outside.ts\", cwd, runtime);\r\n      expect(result?.error).toContain(\"ask the user for permission\");\r\n    });\r\n\r\n    it(\"should work with cwd that has trailing slash\", () => {\r\n      const cwdWithSlash = \"/workspace/project/\";\r\n      expect(validatePathInCwd(\"src/file.ts\", cwdWithSlash, runtime)).toBeNull();\r\n\r\n      const result = validatePathInCwd(\"../outside.ts\", cwdWithSlash, runtime);\r\n      expect(result).not.toBeNull();\r\n    });\r\n\r\n    it(\"should reject tilde paths outside cwd\", () => {\r\n      // Tilde paths expand to home directory, which is outside /workspace/project\r\n      const result = validatePathInCwd(\"~/other-project/file.ts\", cwd, runtime);\r\n      expect(result).not.toBeNull();\r\n      expect(result?.error).toContain(\"restricted to the workspace directory\");\r\n    });\r\n\r\n    it(\"should reject tilde paths to sensitive files\", () => {\r\n      const result = validatePathInCwd(\"~/.ssh/id_rsa\", cwd, runtime);\r\n      expect(result).not.toBeNull();\r\n      expect(result?.error).toContain(\"restricted to the workspace directory\");\r\n    });\r\n\r\n    it(\"should reject bare tilde path\", () => {\r\n      const result = validatePathInCwd(\"~\", cwd, runtime);\r\n      expect(result).not.toBeNull();\r\n      expect(result?.error).toContain(\"restricted to the workspace directory\");\r\n    });\r\n  });\r\n\r\n  describe(\"validateNoRedundantPrefix\", () => {\r\n    const cwd = \"/workspace/project\";\r\n    const runtime = createRuntime({ type: \"local\", srcBaseDir: cwd });\r\n\r\n    it(\"should allow relative paths\", () => {\r\n      expect(validateNoRedundantPrefix(\"src/file.ts\", cwd, runtime)).toBeNull();\r\n      expect(validateNoRedundantPrefix(\"./src/file.ts\", cwd, runtime)).toBeNull();\r\n      expect(validateNoRedundantPrefix(\"file.ts\", cwd, runtime)).toBeNull();\r\n    });\r\n\r\n    it(\"should auto-correct absolute paths that contain the cwd prefix\", () => {\r\n      const result = validateNoRedundantPrefix(\"/workspace/project/src/file.ts\", cwd, runtime);\r\n      expect(result).not.toBeNull();\r\n      expect(result?.correctedPath).toBe(\"src/file.ts\");\r\n      expect(result?.warning).toContain(\"Using relative paths\");\r\n      expect(result?.warning).toContain(\"saves tokens\");\r\n      expect(result?.warning).toContain(\"auto-corrected\");\r\n    });\r\n\r\n    it(\"should auto-correct absolute paths at the cwd root\", () => {\r\n      const result = validateNoRedundantPrefix(\"/workspace/project/file.ts\", cwd, runtime);\r\n      expect(result).not.toBeNull();\r\n      expect(result?.correctedPath).toBe(\"file.ts\");\r\n      expect(result?.warning).toContain(\"auto-corrected\");\r\n    });\r\n\r\n    it(\"should allow absolute paths outside cwd (they will be caught by validatePathInCwd)\", () => {\r\n      // This validation only catches redundant prefixes, not paths outside cwd\r\n      expect(validateNoRedundantPrefix(\"/etc/passwd\", cwd, runtime)).toBeNull();\r\n      expect(validateNoRedundantPrefix(\"/home/user/file.ts\", cwd, runtime)).toBeNull();\r\n    });\r\n\r\n    it(\"should handle paths with ..\", () => {\r\n      // Relative paths with .. are fine for this check\r\n      expect(validateNoRedundantPrefix(\"../outside.ts\", cwd, runtime)).toBeNull();\r\n      expect(validateNoRedundantPrefix(\"src/../../outside.ts\", cwd, runtime)).toBeNull();\r\n    });\r\n\r\n    it(\"should work with cwd that has trailing slash\", () => {\r\n      const cwdWithSlash = \"/workspace/project/\";\r\n      const result = validateNoRedundantPrefix(\r\n        \"/workspace/project/src/file.ts\",\r\n        cwdWithSlash,\r\n        runtime\r\n      );\r\n      expect(result).not.toBeNull();\r\n      expect(result?.correctedPath).toBe(\"src/file.ts\");\r\n      expect(result?.warning).toContain(\"auto-corrected\");\r\n    });\r\n\r\n    it(\"should handle nested paths correctly\", () => {\r\n      const result = validateNoRedundantPrefix(\r\n        \"/workspace/project/src/components/Button/index.ts\",\r\n        cwd,\r\n        runtime\r\n      );\r\n      expect(result).not.toBeNull();\r\n      expect(result?.correctedPath).toBe(\"src/components/Button/index.ts\");\r\n      expect(result?.warning).toContain(\"auto-corrected\");\r\n    });\r\n\r\n    it(\"should auto-correct path that equals cwd exactly\", () => {\r\n      const result = validateNoRedundantPrefix(\"/workspace/project\", cwd, runtime);\r\n      expect(result).not.toBeNull();\r\n      expect(result?.correctedPath).toBe(\".\");\r\n      expect(result?.warning).toContain(\"auto-corrected\");\r\n    });\r\n\r\n    it(\"should not match partial directory names\", () => {\r\n      // /workspace/project2 should NOT match /workspace/project\r\n      expect(validateNoRedundantPrefix(\"/workspace/project2/file.ts\", cwd, runtime)).toBeNull();\r\n      expect(validateNoRedundantPrefix(\"/workspace/project-old/file.ts\", cwd, runtime)).toBeNull();\r\n    });\r\n\r\n    it(\"should work with SSH runtime\", () => {\r\n      const sshRuntime = createRuntime({\r\n        type: \"ssh\",\r\n        host: \"user@localhost\",\r\n        srcBaseDir: \"/home/user/mux\",\r\n        identityFile: \"/tmp/fake-key\",\r\n      });\r\n      const sshCwd = \"/home/user/mux/project/branch\";\r\n\r\n      // Should auto-correct absolute paths with redundant prefix on SSH too\r\n      const result = validateNoRedundantPrefix(\r\n        \"/home/user/mux/project/branch/src/file.ts\",\r\n        sshCwd,\r\n        sshRuntime\r\n      );\r\n      expect(result).not.toBeNull();\r\n      expect(result?.correctedPath).toBe(\"src/file.ts\");\r\n      expect(result?.warning).toContain(\"auto-corrected\");\r\n\r\n      // Should allow relative paths on SSH\r\n      expect(validateNoRedundantPrefix(\"src/file.ts\", sshCwd, sshRuntime)).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe(\"validatePlanModeAccess\", () => {\r\n    const planFilePath = \"~/.mux/plans/plan.md\";\r\n    const resolvedPlanFilePath = \"/home/user/.mux/plans/plan.md\";\r\n\r\n    const mockRuntime = {\r\n      resolvePath: (targetPath: string): Promise<string> => {\r\n        if (targetPath === planFilePath) {\r\n          return Promise.resolve(resolvedPlanFilePath);\r\n        }\r\n        if (targetPath === resolvedPlanFilePath) {\r\n          return Promise.resolve(resolvedPlanFilePath);\r\n        }\r\n        if (targetPath === \"src/main.ts\") {\r\n          return Promise.resolve(\"/home/user/project/src/main.ts\");\r\n        }\r\n        return Promise.resolve(targetPath);\r\n      },\r\n    } as unknown as Runtime;\r\n\r\n    const config: ToolConfiguration = {\r\n      cwd: \"/home/user/project\",\r\n      runtime: mockRuntime,\r\n      runtimeTempDir: \"/tmp\",\r\n      planFileOnly: true,\r\n      planFilePath,\r\n    };\r\n\r\n    it(\"should allow editing when filePath is exactly planFilePath\", async () => {\r\n      expect(await validatePlanModeAccess(planFilePath, config)).toBeNull();\r\n    });\r\n\r\n    it(\"should reject alternate paths that resolve to the plan file\", async () => {\r\n      const result = await validatePlanModeAccess(resolvedPlanFilePath, config);\r\n      expect(result).not.toBeNull();\r\n      expect(result?.error).toContain(\"exact plan file path\");\r\n      expect(result?.error).toContain(planFilePath);\r\n      expect(result?.error).toContain(resolvedPlanFilePath);\r\n      expect(result?.error).toContain(\"resolves to the plan file\");\r\n    });\r\n\r\n    it(\"should reject non-plan files in plan mode\", async () => {\r\n      const result = await validatePlanModeAccess(\"src/main.ts\", config);\r\n      expect(result).not.toBeNull();\r\n      expect(result?.error).toContain(\"only the plan file can be edited\");\r\n      expect(result?.error).toContain(\"exact plan file path\");\r\n      expect(result?.error).toContain(planFilePath);\r\n      expect(result?.error).toContain(\"src/main.ts\");\r\n    });\r\n  });\r\n});\r\n"]}