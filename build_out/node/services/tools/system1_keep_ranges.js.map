{"version":3,"file":"system1_keep_ranges.js","sourceRoot":"","sources":["../../../../src/node/services/tools/system1_keep_ranges.ts"],"names":[],"mappings":";;;AAAA,2BAA0B;AAK1B,0EAAwE;AAgBxE,qCACE,OAA0B,EAC1B,OAEC,EACK;IACN,IAAI,MAAM,GAAG,KAAK,CAAC;IAEnB,OAAO,IAAA,SAAI,EAAC;QACV,WAAW,EAAE,kCAAgB,CAAC,mBAAmB,CAAC,WAAW;QAC7D,WAAW,EAAE,kCAAgB,CAAC,mBAAmB,CAAC,MAAM;QACxD,OAAO,EAAE,CAAC,EAAE,WAAW,EAA6B,EAA+B,EAAE,CAAC;YACpF,uFAAuF;YACvF,IAAI,MAAM,EAAE,CAAC;gBACX,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;YAC3B,CAAC;YACD,MAAM,GAAG,IAAI,CAAC;YACd,OAAO,EAAE,YAAY,EAAE,CAAC,WAAW,CAAC,CAAC;YACrC,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;QAAA,CAC1B;KACF,CAAC,CAAC;AAAA,CACJ","sourcesContent":["import { tool } from \"ai\";\r\nimport type { Tool } from \"ai\";\r\n\r\nimport type { z } from \"zod\";\r\nimport type { ToolConfiguration } from \"@/common/utils/tools/tools\";\r\nimport { TOOL_DEFINITIONS } from \"@/common/utils/tools/toolDefinitions\";\r\n\r\nimport type { System1KeepRange } from \"@/node/services/system1/bashOutputFiltering\";\r\n\r\n// Derived from the Zod schema (single source of truth) to avoid drift.\r\nexport type System1KeepRangesToolArgs = z.infer<typeof TOOL_DEFINITIONS.system1_keep_ranges.schema>;\r\n\r\nexport type System1KeepRangesToolResult =\r\n  | {\r\n      success: true;\r\n    }\r\n  | {\r\n      success: false;\r\n      error: string;\r\n    };\r\n\r\nexport function createSystem1KeepRangesTool(\r\n  _config: ToolConfiguration,\r\n  options?: {\r\n    onKeepRanges?: (keepRanges: System1KeepRange[]) => void;\r\n  }\r\n): Tool {\r\n  let called = false;\r\n\r\n  return tool({\r\n    description: TOOL_DEFINITIONS.system1_keep_ranges.description,\r\n    inputSchema: TOOL_DEFINITIONS.system1_keep_ranges.schema,\r\n    execute: ({ keep_ranges }: System1KeepRangesToolArgs): System1KeepRangesToolResult => {\r\n      // Defensive: the model should only call this once, but don't error-loop if it retries.\r\n      if (called) {\r\n        return { success: true };\r\n      }\r\n      called = true;\r\n      options?.onKeepRanges?.(keep_ranges);\r\n      return { success: true };\r\n    },\r\n  });\r\n}\r\n"]}