{"version":3,"file":"system1_keep_ranges.js","sourceRoot":"","sources":["../../../../src/node/services/tools/system1_keep_ranges.ts"],"names":[],"mappings":";;;AAAA,2BAA0B;AAK1B,0EAAwE;AAgBxE,qCACE,OAA0B,EAC1B,OAEC,EACK;IACN,IAAI,MAAM,GAAG,KAAK,CAAC;IAEnB,OAAO,IAAA,SAAI,EAAC;QACV,WAAW,EAAE,kCAAgB,CAAC,mBAAmB,CAAC,WAAW;QAC7D,WAAW,EAAE,kCAAgB,CAAC,mBAAmB,CAAC,MAAM;QACxD,OAAO,EAAE,CAAC,EAAE,WAAW,EAA6B,EAA+B,EAAE,CAAC;YACpF,uFAAuF;YACvF,IAAI,MAAM,EAAE,CAAC;gBACX,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;YAC3B,CAAC;YACD,MAAM,GAAG,IAAI,CAAC;YACd,OAAO,EAAE,YAAY,EAAE,CAAC,WAAW,CAAC,CAAC;YACrC,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;QAAA,CAC1B;KACF,CAAC,CAAC;AAAA,CACJ","sourcesContent":["import { tool } from \"ai\";\nimport type { Tool } from \"ai\";\n\nimport type { z } from \"zod\";\nimport type { ToolConfiguration } from \"@/common/utils/tools/tools\";\nimport { TOOL_DEFINITIONS } from \"@/common/utils/tools/toolDefinitions\";\n\nimport type { System1KeepRange } from \"@/node/services/system1/bashOutputFiltering\";\n\n// Derived from the Zod schema (single source of truth) to avoid drift.\nexport type System1KeepRangesToolArgs = z.infer<typeof TOOL_DEFINITIONS.system1_keep_ranges.schema>;\n\nexport type System1KeepRangesToolResult =\n  | {\n      success: true;\n    }\n  | {\n      success: false;\n      error: string;\n    };\n\nexport function createSystem1KeepRangesTool(\n  _config: ToolConfiguration,\n  options?: {\n    onKeepRanges?: (keepRanges: System1KeepRange[]) => void;\n  }\n): Tool {\n  let called = false;\n\n  return tool({\n    description: TOOL_DEFINITIONS.system1_keep_ranges.description,\n    inputSchema: TOOL_DEFINITIONS.system1_keep_ranges.schema,\n    execute: ({ keep_ranges }: System1KeepRangesToolArgs): System1KeepRangesToolResult => {\n      // Defensive: the model should only call this once, but don't error-loop if it retries.\n      if (called) {\n        return { success: true };\n      }\n      called = true;\n      options?.onKeepRanges?.(keep_ranges);\n      return { success: true };\n    },\n  });\n}\n"]}