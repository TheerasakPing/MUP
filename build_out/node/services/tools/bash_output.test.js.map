{"version":3,"file":"bash_output.test.js","sourceRoot":"","sources":["../../../../src/node/services/tools/bash_output.test.ts"],"names":[],"mappings":"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","sourcesContent":["import * as fs from \"fs\";\r\nimport * as path from \"path\";\r\n\r\nimport { describe, it, expect } from \"bun:test\";\r\nimport { createBashOutputTool } from \"./bash_output\";\r\nimport { BackgroundProcessManager } from \"@/node/services/backgroundProcessManager\";\r\nimport { LocalRuntime } from \"@/node/runtime/LocalRuntime\";\r\nimport type { Runtime } from \"@/node/runtime/Runtime\";\r\nimport type { BashOutputToolResult } from \"@/common/types/tools\";\r\nimport { TestTempDir, createTestToolConfig } from \"./testHelpers\";\r\nimport type { ToolExecutionOptions } from \"ai\";\r\n\r\nconst mockToolCallOptions: ToolExecutionOptions = {\r\n  toolCallId: \"test-call-id\",\r\n  messages: [],\r\n};\r\n\r\n// Create test runtime\r\nfunction createTestRuntime(): Runtime {\r\n  return new LocalRuntime(process.cwd());\r\n}\r\n\r\ndescribe(\"bash_output tool\", () => {\r\n  it(\"should return error when manager not available\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-output\");\r\n    const config = createTestToolConfig(process.cwd());\r\n    config.runtimeTempDir = tempDir.path;\r\n\r\n    const tool = createBashOutputTool(config);\r\n    const result = (await tool.execute!(\r\n      { process_id: \"bash_1\", timeout_secs: 0 },\r\n      mockToolCallOptions\r\n    )) as BashOutputToolResult;\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"Background process manager not available\");\r\n    }\r\n\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should return error when workspaceId not available\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-output\");\r\n    const manager = new BackgroundProcessManager(tempDir.path);\r\n\r\n    const config = createTestToolConfig(process.cwd());\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.backgroundProcessManager = manager;\r\n    delete config.workspaceId;\r\n\r\n    const tool = createBashOutputTool(config);\r\n    const result = (await tool.execute!(\r\n      { process_id: \"bash_1\", timeout_secs: 0 },\r\n      mockToolCallOptions\r\n    )) as BashOutputToolResult;\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"Workspace ID not available\");\r\n    }\r\n\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should return error for non-existent process\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-output\");\r\n    const manager = new BackgroundProcessManager(tempDir.path);\r\n\r\n    const config = createTestToolConfig(process.cwd());\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.backgroundProcessManager = manager;\r\n\r\n    const tool = createBashOutputTool(config);\r\n    const result = (await tool.execute!(\r\n      { process_id: \"bash_1\", timeout_secs: 0 },\r\n      mockToolCallOptions\r\n    )) as BashOutputToolResult;\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"Process not found\");\r\n    }\r\n\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should return incremental output from process\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-output\");\r\n    const manager = new BackgroundProcessManager(tempDir.path);\r\n\r\n    const runtime = createTestRuntime();\r\n    const config = createTestToolConfig(process.cwd(), { sessionsDir: tempDir.path });\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.backgroundProcessManager = manager;\r\n\r\n    // Spawn a process that outputs incrementally\r\n    const spawnResult = await manager.spawn(\r\n      runtime,\r\n      \"test-workspace\",\r\n      \"echo 'line1'; sleep 0.5; echo 'line2'\",\r\n      { cwd: process.cwd(), displayName: \"test\" }\r\n    );\r\n\r\n    if (!spawnResult.success) {\r\n      throw new Error(\"Failed to spawn process\");\r\n    }\r\n\r\n    const tool = createBashOutputTool(config);\r\n\r\n    // Wait a bit for first output\r\n    await new Promise((r) => setTimeout(r, 200));\r\n\r\n    // First call - should get some output\r\n    const result1 = (await tool.execute!(\r\n      { process_id: spawnResult.processId, timeout_secs: 0 },\r\n      mockToolCallOptions\r\n    )) as BashOutputToolResult;\r\n\r\n    expect(result1.success).toBe(true);\r\n    if (result1.success) {\r\n      expect(result1.output).toContain(\"line1\");\r\n    }\r\n\r\n    // Wait for more output\r\n    await new Promise((r) => setTimeout(r, 600));\r\n\r\n    // Second call - should ONLY get new output (incremental)\r\n    const result2 = (await tool.execute!(\r\n      { process_id: spawnResult.processId, timeout_secs: 0 },\r\n      mockToolCallOptions\r\n    )) as BashOutputToolResult;\r\n\r\n    expect(result2.success).toBe(true);\r\n    if (result2.success) {\r\n      // Should contain line2 but NOT line1 (already read)\r\n      expect(result2.output).toContain(\"line2\");\r\n      expect(result2.output).not.toContain(\"line1\");\r\n    }\r\n\r\n    // Cleanup\r\n    await manager.cleanup(\"test-workspace\");\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should filter output with regex\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-output\");\r\n    const manager = new BackgroundProcessManager(tempDir.path);\r\n\r\n    const runtime = createTestRuntime();\r\n    const config = createTestToolConfig(process.cwd(), { sessionsDir: tempDir.path });\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.backgroundProcessManager = manager;\r\n\r\n    // Spawn a process that outputs multiple lines\r\n    const spawnResult = await manager.spawn(\r\n      runtime,\r\n      \"test-workspace\",\r\n      \"echo 'ERROR: something failed'; echo 'INFO: everything ok'; echo 'ERROR: another error'\",\r\n      { cwd: process.cwd(), displayName: \"test\" }\r\n    );\r\n\r\n    if (!spawnResult.success) {\r\n      throw new Error(\"Failed to spawn process\");\r\n    }\r\n\r\n    // Wait for output\r\n    await new Promise((r) => setTimeout(r, 200));\r\n\r\n    const tool = createBashOutputTool(config);\r\n    const result = (await tool.execute!(\r\n      { process_id: spawnResult.processId, filter: \"ERROR\", timeout_secs: 0 },\r\n      mockToolCallOptions\r\n    )) as BashOutputToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      // Should only contain ERROR lines\r\n      expect(result.output).toContain(\"ERROR\");\r\n      expect(result.output).not.toContain(\"INFO\");\r\n    }\r\n\r\n    // Cleanup\r\n    await manager.cleanup(\"test-workspace\");\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should return error for invalid regex filter\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-output\");\r\n    const manager = new BackgroundProcessManager(tempDir.path);\r\n\r\n    const runtime = createTestRuntime();\r\n    const config = createTestToolConfig(process.cwd(), { sessionsDir: tempDir.path });\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.backgroundProcessManager = manager;\r\n\r\n    const spawnResult = await manager.spawn(runtime, \"test-workspace\", \"echo 'test'\", {\r\n      cwd: process.cwd(),\r\n      displayName: \"test\",\r\n    });\r\n\r\n    if (!spawnResult.success) {\r\n      throw new Error(\"Failed to spawn process\");\r\n    }\r\n\r\n    // Wait for output\r\n    await new Promise((r) => setTimeout(r, 100));\r\n\r\n    const tool = createBashOutputTool(config);\r\n    const result = (await tool.execute!(\r\n      { process_id: spawnResult.processId, filter: \"[invalid(\", timeout_secs: 0 },\r\n      mockToolCallOptions\r\n    )) as BashOutputToolResult;\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"Invalid filter regex\");\r\n    }\r\n\r\n    // Cleanup\r\n    await manager.cleanup(\"test-workspace\");\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should not return output from other workspace's processes\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-output\");\r\n    const manager = new BackgroundProcessManager(tempDir.path);\r\n\r\n    const runtime = createTestRuntime();\r\n\r\n    const config = createTestToolConfig(process.cwd(), {\r\n      workspaceId: \"workspace-a\",\r\n      sessionsDir: tempDir.path,\r\n    });\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.backgroundProcessManager = manager;\r\n\r\n    // Spawn process in different workspace\r\n    const spawnResult = await manager.spawn(runtime, \"workspace-b\", \"echo 'test'\", {\r\n      cwd: process.cwd(),\r\n      displayName: \"test\",\r\n    });\r\n\r\n    if (!spawnResult.success) {\r\n      throw new Error(\"Failed to spawn process\");\r\n    }\r\n\r\n    const tool = createBashOutputTool(config);\r\n    const result = (await tool.execute!(\r\n      { process_id: spawnResult.processId, timeout_secs: 0 },\r\n      mockToolCallOptions\r\n    )) as BashOutputToolResult;\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"Process not found\");\r\n    }\r\n\r\n    // Cleanup\r\n    await manager.cleanup(\"workspace-b\");\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should include process status and exit code\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-output\");\r\n    const manager = new BackgroundProcessManager(tempDir.path);\r\n\r\n    const runtime = createTestRuntime();\r\n    const config = createTestToolConfig(process.cwd(), { sessionsDir: tempDir.path });\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.backgroundProcessManager = manager;\r\n\r\n    // Spawn a process that exits quickly\r\n    const spawnResult = await manager.spawn(runtime, \"test-workspace\", \"echo 'done'\", {\r\n      cwd: process.cwd(),\r\n      displayName: \"test\",\r\n    });\r\n\r\n    if (!spawnResult.success) {\r\n      throw new Error(\"Failed to spawn process\");\r\n    }\r\n\r\n    // Wait for process to exit\r\n    await new Promise((r) => setTimeout(r, 200));\r\n\r\n    const tool = createBashOutputTool(config);\r\n    const result = (await tool.execute!(\r\n      { process_id: spawnResult.processId, timeout_secs: 0 },\r\n      mockToolCallOptions\r\n    )) as BashOutputToolResult;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.status).toBe(\"exited\");\r\n      expect(result.exitCode).toBe(0);\r\n    }\r\n\r\n    // Cleanup\r\n    await manager.cleanup(\"test-workspace\");\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should block and wait for output when timeout_secs > 0\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-output\");\r\n    const manager = new BackgroundProcessManager(tempDir.path);\r\n\r\n    const runtime = createTestRuntime();\r\n    const config = createTestToolConfig(process.cwd(), { sessionsDir: tempDir.path });\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.backgroundProcessManager = manager;\r\n\r\n    // Use unique process ID to avoid leftover state from previous runs\r\n    const processId = `delayed-output-${Date.now()}`;\r\n    const signalPath = path.join(tempDir.path, `${processId}.signal`);\r\n\r\n    // Spawn a process that blocks until we create a signal file, then outputs.\r\n    // This avoids flakiness from the spawn call itself taking a non-trivial amount of time.\r\n    const spawnResult = await manager.spawn(\r\n      runtime,\r\n      \"test-workspace\",\r\n      `while [ ! -f \"${signalPath}\" ]; do sleep 0.1; done; echo 'delayed output'`,\r\n      { cwd: process.cwd(), displayName: processId }\r\n    );\r\n\r\n    if (!spawnResult.success) {\r\n      throw new Error(\"Failed to spawn process\");\r\n    }\r\n\r\n    const tool = createBashOutputTool(config);\r\n\r\n    // Call with timeout=3 should wait and return output (waiting for signal file)\r\n    const start = Date.now();\r\n    const resultPromise = tool.execute!(\r\n      { process_id: spawnResult.processId, timeout_secs: 3 },\r\n      mockToolCallOptions\r\n    ) as Promise<BashOutputToolResult>;\r\n\r\n    // Ensure bash_output is actually waiting before we trigger output.\r\n    await new Promise((r) => setTimeout(r, 300));\r\n    await fs.promises.writeFile(signalPath, \"go\");\r\n\r\n    const result = await resultPromise;\r\n    const elapsed = Date.now() - start;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toContain(\"delayed output\");\r\n      expect(elapsed).toBeGreaterThan(250);\r\n      expect(elapsed).toBeLessThan(3500);\r\n    }\r\n\r\n    // Cleanup\r\n    await manager.cleanup(\"test-workspace\");\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should return early when process exits during wait\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-output\");\r\n    const manager = new BackgroundProcessManager(tempDir.path);\r\n\r\n    const runtime = createTestRuntime();\r\n    const config = createTestToolConfig(process.cwd(), { sessionsDir: tempDir.path });\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.backgroundProcessManager = manager;\r\n\r\n    // Use unique process ID to avoid leftover state from previous runs\r\n    const processId = `quick-exit-${Date.now()}`;\r\n\r\n    // Spawn a process that exits quickly\r\n    const spawnResult = await manager.spawn(runtime, \"test-workspace\", \"echo 'quick exit'\", {\r\n      cwd: process.cwd(),\r\n      displayName: processId,\r\n    });\r\n\r\n    if (!spawnResult.success) {\r\n      throw new Error(\"Failed to spawn process\");\r\n    }\r\n\r\n    // Wait for process to exit\r\n    await new Promise((r) => setTimeout(r, 200));\r\n\r\n    const tool = createBashOutputTool(config);\r\n\r\n    // Call with long timeout - should return quickly since process already exited\r\n    const start = Date.now();\r\n    const result = (await tool.execute!(\r\n      { process_id: spawnResult.processId, timeout_secs: 10 },\r\n      mockToolCallOptions\r\n    )) as BashOutputToolResult;\r\n    const elapsed = Date.now() - start;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toContain(\"quick exit\");\r\n      expect(result.status).toBe(\"exited\");\r\n      expect(elapsed).toBeLessThan(500); // Should return quickly, not wait full 10s\r\n    }\r\n\r\n    // Cleanup\r\n    await manager.cleanup(\"test-workspace\");\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should wait full timeout duration when no output and process running\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-output\");\r\n    const manager = new BackgroundProcessManager(tempDir.path);\r\n\r\n    const runtime = createTestRuntime();\r\n    const config = createTestToolConfig(process.cwd(), { sessionsDir: tempDir.path });\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.backgroundProcessManager = manager;\r\n\r\n    const processId = `long-sleep-${Date.now()}`;\r\n\r\n    // Spawn a process that sleeps for a long time with no output\r\n    const spawnResult = await manager.spawn(runtime, \"test-workspace\", \"sleep 30\", {\r\n      cwd: process.cwd(),\r\n      displayName: processId,\r\n    });\r\n\r\n    if (!spawnResult.success) {\r\n      throw new Error(\"Failed to spawn process\");\r\n    }\r\n\r\n    const tool = createBashOutputTool(config);\r\n\r\n    // Call with short timeout - should wait full duration then return empty\r\n    const start = Date.now();\r\n    const result = (await tool.execute!(\r\n      { process_id: spawnResult.processId, timeout_secs: 1 },\r\n      mockToolCallOptions\r\n    )) as BashOutputToolResult;\r\n    const elapsed = Date.now() - start;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toBe(\"\"); // No output\r\n      expect(result.status).toBe(\"running\"); // Process still running\r\n      // Should have waited close to 1 second\r\n      expect(elapsed).toBeGreaterThan(900);\r\n      expect(elapsed).toBeLessThan(1500);\r\n    }\r\n\r\n    // Cleanup\r\n    await manager.terminate(spawnResult.processId);\r\n    await manager.cleanup(\"test-workspace\");\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should return immediately with timeout_secs: 0 even when no output\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-output\");\r\n    const manager = new BackgroundProcessManager(tempDir.path);\r\n\r\n    const runtime = createTestRuntime();\r\n    const config = createTestToolConfig(process.cwd(), { sessionsDir: tempDir.path });\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.backgroundProcessManager = manager;\r\n\r\n    const processId = `no-wait-${Date.now()}`;\r\n\r\n    // Spawn a process that sleeps (no immediate output)\r\n    const spawnResult = await manager.spawn(runtime, \"test-workspace\", \"sleep 30\", {\r\n      cwd: process.cwd(),\r\n      displayName: processId,\r\n    });\r\n\r\n    if (!spawnResult.success) {\r\n      throw new Error(\"Failed to spawn process\");\r\n    }\r\n\r\n    const tool = createBashOutputTool(config);\r\n\r\n    // Call with timeout=0 - should return immediately\r\n    const start = Date.now();\r\n    const result = (await tool.execute!(\r\n      { process_id: spawnResult.processId, timeout_secs: 0 },\r\n      mockToolCallOptions\r\n    )) as BashOutputToolResult;\r\n    const elapsed = Date.now() - start;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.output).toBe(\"\");\r\n      expect(result.status).toBe(\"running\");\r\n      expect(elapsed).toBeLessThan(200); // Should return almost immediately\r\n    }\r\n\r\n    // Cleanup\r\n    await manager.terminate(spawnResult.processId);\r\n    await manager.cleanup(\"test-workspace\");\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should return early with 'interrupted' status when abortSignal is triggered\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-output\");\r\n    const manager = new BackgroundProcessManager(tempDir.path);\r\n\r\n    const runtime = createTestRuntime();\r\n    const config = createTestToolConfig(process.cwd(), { sessionsDir: tempDir.path });\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.backgroundProcessManager = manager;\r\n\r\n    const processId = `abort-test-${Date.now()}`;\r\n\r\n    // Spawn a long-running process with no output\r\n    const spawnResult = await manager.spawn(runtime, \"test-workspace\", \"sleep 60\", {\r\n      cwd: process.cwd(),\r\n      displayName: processId,\r\n    });\r\n\r\n    if (!spawnResult.success) {\r\n      throw new Error(\"Failed to spawn process\");\r\n    }\r\n\r\n    const tool = createBashOutputTool(config);\r\n    const abortController = new AbortController();\r\n\r\n    // Abort after 200ms\r\n    setTimeout(() => abortController.abort(), 200);\r\n\r\n    // Call with long timeout - should be interrupted by abort signal\r\n    const start = Date.now();\r\n    const result = (await tool.execute!(\r\n      { process_id: spawnResult.processId, timeout_secs: 30 },\r\n      { ...mockToolCallOptions, abortSignal: abortController.signal }\r\n    )) as BashOutputToolResult;\r\n    const elapsed = Date.now() - start;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.status).toBe(\"interrupted\");\r\n      expect(result.output).toBe(\"(waiting interrupted)\");\r\n      // Should have returned quickly after abort, not waiting full 30s\r\n      expect(elapsed).toBeLessThan(1000);\r\n      expect(elapsed).toBeGreaterThan(150); // At least waited until abort\r\n    }\r\n\r\n    // Cleanup\r\n    await manager.terminate(spawnResult.processId);\r\n    await manager.cleanup(\"test-workspace\");\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n\r\n  it(\"should return early with 'interrupted' status when message is queued\", async () => {\r\n    const tempDir = new TestTempDir(\"test-bash-output\");\r\n    const manager = new BackgroundProcessManager(tempDir.path);\r\n\r\n    const runtime = createTestRuntime();\r\n    const config = createTestToolConfig(process.cwd(), { sessionsDir: tempDir.path });\r\n    config.runtimeTempDir = tempDir.path;\r\n    config.backgroundProcessManager = manager;\r\n\r\n    const processId = `queued-msg-test-${Date.now()}`;\r\n\r\n    // Spawn a long-running process with no output\r\n    const spawnResult = await manager.spawn(runtime, \"test-workspace\", \"sleep 60\", {\r\n      cwd: process.cwd(),\r\n      displayName: processId,\r\n    });\r\n\r\n    if (!spawnResult.success) {\r\n      throw new Error(\"Failed to spawn process\");\r\n    }\r\n\r\n    const tool = createBashOutputTool(config);\r\n\r\n    // Queue a message after 200ms\r\n    setTimeout(() => manager.setMessageQueued(\"test-workspace\", true), 200);\r\n\r\n    // Call with long timeout - should be interrupted by queued message\r\n    const start = Date.now();\r\n    const result = (await tool.execute!(\r\n      { process_id: spawnResult.processId, timeout_secs: 30 },\r\n      mockToolCallOptions\r\n    )) as BashOutputToolResult;\r\n    const elapsed = Date.now() - start;\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.status).toBe(\"interrupted\");\r\n      expect(result.output).toBe(\"(waiting interrupted)\");\r\n      // Should have returned quickly after queued message, not waiting full 30s\r\n      expect(elapsed).toBeLessThan(1000);\r\n      expect(elapsed).toBeGreaterThan(150); // At least waited until message was queued\r\n    }\r\n\r\n    // Cleanup\r\n    manager.setMessageQueued(\"test-workspace\", false);\r\n    await manager.terminate(spawnResult.processId);\r\n    await manager.cleanup(\"test-workspace\");\r\n    tempDir[Symbol.dispose]();\r\n  });\r\n});\r\n"]}