{"version":3,"file":"task_list.test.js","sourceRoot":"","sources":["../../../../src/node/services/tools/task_list.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, it, expect, mock } from \"bun:test\";\nimport type { ToolExecutionOptions } from \"ai\";\n\nimport { createTaskListTool } from \"./task_list\";\nimport { TestTempDir, createTestToolConfig } from \"./testHelpers\";\nimport type { TaskService } from \"@/node/services/taskService\";\n\nconst mockToolCallOptions: ToolExecutionOptions = {\n  toolCallId: \"test-call-id\",\n  messages: [],\n};\n\ndescribe(\"task_list tool\", () => {\n  it(\"uses default statuses when none are provided\", async () => {\n    using tempDir = new TestTempDir(\"test-task-list-default-statuses\");\n    const baseConfig = createTestToolConfig(tempDir.path, { workspaceId: \"root-workspace\" });\n\n    const listDescendantAgentTasks = mock(() => []);\n    const taskService = { listDescendantAgentTasks } as unknown as TaskService;\n\n    const tool = createTaskListTool({ ...baseConfig, taskService });\n\n    const result: unknown = await Promise.resolve(tool.execute!({}, mockToolCallOptions));\n\n    expect(result).toEqual({ tasks: [] });\n    expect(listDescendantAgentTasks).toHaveBeenCalledWith(\"root-workspace\", {\n      statuses: [\"queued\", \"running\", \"awaiting_report\"],\n    });\n  });\n\n  it(\"passes through provided statuses\", async () => {\n    using tempDir = new TestTempDir(\"test-task-list-statuses\");\n    const baseConfig = createTestToolConfig(tempDir.path, { workspaceId: \"root-workspace\" });\n\n    const listDescendantAgentTasks = mock(() => []);\n    const taskService = { listDescendantAgentTasks } as unknown as TaskService;\n\n    const tool = createTaskListTool({ ...baseConfig, taskService });\n\n    const result: unknown = await Promise.resolve(\n      tool.execute!({ statuses: [\"running\"] }, mockToolCallOptions)\n    );\n\n    expect(result).toEqual({ tasks: [] });\n    expect(listDescendantAgentTasks).toHaveBeenCalledWith(\"root-workspace\", {\n      statuses: [\"running\"],\n    });\n  });\n\n  it(\"returns tasks with metadata\", async () => {\n    using tempDir = new TestTempDir(\"test-task-list-ok\");\n    const baseConfig = createTestToolConfig(tempDir.path, { workspaceId: \"root-workspace\" });\n\n    const listDescendantAgentTasks = mock(() => [\n      {\n        taskId: \"task-1\",\n        status: \"running\",\n        parentWorkspaceId: \"root-workspace\",\n        agentType: \"exec\",\n        workspaceName: \"agent_exec_task-1\",\n        title: \"t\",\n        createdAt: \"2025-01-01T00:00:00.000Z\",\n        modelString: \"anthropic:claude-haiku-4-5\",\n        thinkingLevel: \"low\",\n        depth: 1,\n      },\n    ]);\n    const taskService = { listDescendantAgentTasks } as unknown as TaskService;\n\n    const tool = createTaskListTool({ ...baseConfig, taskService });\n\n    const result: unknown = await Promise.resolve(tool.execute!({}, mockToolCallOptions));\n\n    expect(result).toEqual({\n      tasks: [\n        {\n          taskId: \"task-1\",\n          status: \"running\",\n          parentWorkspaceId: \"root-workspace\",\n          agentType: \"exec\",\n          workspaceName: \"agent_exec_task-1\",\n          title: \"t\",\n          createdAt: \"2025-01-01T00:00:00.000Z\",\n          modelString: \"anthropic:claude-haiku-4-5\",\n          thinkingLevel: \"low\",\n          depth: 1,\n        },\n      ],\n    });\n  });\n});\n"]}