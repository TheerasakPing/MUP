{"version":3,"file":"projectService.js","sourceRoot":"","sources":["../../../src/node/services/projectService.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Config, ProjectConfig } from \"@/node/config\";\r\nimport type { SectionConfig } from \"@/common/types/project\";\r\nimport { DEFAULT_SECTION_COLOR } from \"@/common/constants/ui\";\r\nimport { sortSectionsByLinkedList } from \"@/common/utils/sections\";\r\nimport { isWorkspaceArchived } from \"@/common/utils/archive\";\r\nimport { randomBytes } from \"crypto\";\r\nimport { validateProjectPath, isGitRepository } from \"@/node/utils/pathUtils\";\r\nimport { listLocalBranches, detectDefaultTrunkBranch } from \"@/node/git\";\r\nimport type { Result } from \"@/common/types/result\";\r\nimport { Ok, Err } from \"@/common/types/result\";\r\nimport type { Secret } from \"@/common/types/secrets\";\r\nimport type { Stats } from \"fs\";\r\nimport * as fsPromises from \"fs/promises\";\r\nimport { execAsync } from \"@/node/utils/disposableExec\";\r\nimport {\r\n  buildFileCompletionsIndex,\r\n  EMPTY_FILE_COMPLETIONS_INDEX,\r\n  searchFileCompletions,\r\n  type FileCompletionsIndex,\r\n} from \"@/node/services/fileCompletionsIndex\";\r\nimport { log } from \"@/node/services/log\";\r\nimport type { BranchListResult } from \"@/common/orpc/types\";\r\nimport type { FileTreeNode } from \"@/common/utils/git/numstatParser\";\r\nimport * as path from \"path\";\r\nimport { getMuxProjectsDir } from \"@/common/constants/paths\";\r\nimport { expandTilde } from \"@/node/runtime/tildeExpansion\";\r\n\r\n/**\r\n * List directory contents for the DirectoryPickerModal.\r\n * Returns a FileTreeNode where:\r\n * - name and path are the resolved absolute path of the requested directory\r\n * - children are the immediate subdirectories (not recursive)\r\n */\r\nasync function listDirectory(requestedPath: string): Promise<FileTreeNode> {\r\n  // Expand ~ to home directory (path.resolve doesn't handle tilde)\r\n  const expanded =\r\n    requestedPath === \"~\" || requestedPath.startsWith(\"~/\") || requestedPath.startsWith(\"~\\\\\")\r\n      ? expandTilde(requestedPath)\r\n      : requestedPath;\r\n  const normalizedRoot = path.resolve(expanded || \".\");\r\n  const entries = await fsPromises.readdir(normalizedRoot, { withFileTypes: true });\r\n\r\n  const children: FileTreeNode[] = entries\r\n    .filter((entry) => entry.isDirectory())\r\n    .map((entry) => {\r\n      const entryPath = path.join(normalizedRoot, entry.name);\r\n      return {\r\n        name: entry.name,\r\n        path: entryPath,\r\n        isDirectory: true,\r\n        children: [],\r\n      };\r\n    });\r\n\r\n  return {\r\n    name: normalizedRoot,\r\n    path: normalizedRoot,\r\n    isDirectory: true,\r\n    children,\r\n  };\r\n}\r\n\r\nconst FILE_COMPLETIONS_CACHE_TTL_MS = 10_000;\r\n\r\ninterface FileCompletionsCacheEntry {\r\n  index: FileCompletionsIndex;\r\n  fetchedAt: number;\r\n  refreshing?: Promise<void>;\r\n}\r\n\r\nexport class ProjectService {\r\n  private readonly fileCompletionsCache = new Map<string, FileCompletionsCacheEntry>();\r\n  private directoryPicker?: () => Promise<string | null>;\r\n\r\n  constructor(private readonly config: Config) {}\r\n\r\n  setDirectoryPicker(picker: () => Promise<string | null>) {\r\n    this.directoryPicker = picker;\r\n  }\r\n\r\n  async pickDirectory(): Promise<string | null> {\r\n    if (!this.directoryPicker) return null;\r\n    return this.directoryPicker();\r\n  }\r\n\r\n  async create(\r\n    projectPath: string\r\n  ): Promise<Result<{ projectConfig: ProjectConfig; normalizedPath: string }>> {\r\n    try {\r\n      // Validate input\r\n      if (!projectPath || projectPath.trim().length === 0) {\r\n        return Err(\"Project path cannot be empty\");\r\n      }\r\n\r\n      // Resolve the path:\r\n      // - Bare names like \"my-project\" → ~/.mux/projects/my-project\r\n      // - Paths with ~ → expand to home directory\r\n      // - Absolute/relative paths → resolve normally\r\n      const isBareProjectName =\r\n        projectPath.length > 0 &&\r\n        !projectPath.includes(\"/\") &&\r\n        !projectPath.includes(\"\\\\\") &&\r\n        !projectPath.startsWith(\"~\");\r\n\r\n      let normalizedPath: string;\r\n      if (isBareProjectName) {\r\n        // Bare project name - put in default projects directory\r\n        normalizedPath = path.join(getMuxProjectsDir(), projectPath);\r\n      } else if (\r\n        projectPath === \"~\" ||\r\n        projectPath.startsWith(\"~/\") ||\r\n        projectPath.startsWith(\"~\\\\\")\r\n      ) {\r\n        // Tilde expansion - uses expandTilde to respect MUX_ROOT for ~/.mux paths\r\n        normalizedPath = path.resolve(expandTilde(projectPath));\r\n      } else {\r\n        normalizedPath = path.resolve(projectPath);\r\n      }\r\n\r\n      let existingStat: Stats | null = null;\r\n      try {\r\n        existingStat = await fsPromises.stat(normalizedPath);\r\n      } catch (error) {\r\n        const err = error as NodeJS.ErrnoException;\r\n        if (err.code !== \"ENOENT\") {\r\n          throw error;\r\n        }\r\n      }\r\n\r\n      if (existingStat && !existingStat.isDirectory()) {\r\n        return Err(\"Project path is not a directory\");\r\n      }\r\n\r\n      const config = this.config.loadConfigOrDefault();\r\n\r\n      if (config.projects.has(normalizedPath)) {\r\n        return Err(\"Project already exists\");\r\n      }\r\n\r\n      // Create the directory if it doesn't exist (like mkdir -p)\r\n      await fsPromises.mkdir(normalizedPath, { recursive: true });\r\n\r\n      const projectConfig: ProjectConfig = { workspaces: [] };\r\n      config.projects.set(normalizedPath, projectConfig);\r\n      await this.config.saveConfig(config);\r\n\r\n      return Ok({ projectConfig, normalizedPath });\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      return Err(`Failed to create project: ${message}`);\r\n    }\r\n  }\r\n\r\n  async remove(projectPath: string): Promise<Result<void>> {\r\n    try {\r\n      const config = this.config.loadConfigOrDefault();\r\n      const projectConfig = config.projects.get(projectPath);\r\n\r\n      if (!projectConfig) {\r\n        return Err(\"Project not found\");\r\n      }\r\n\r\n      if (projectConfig.workspaces.length > 0) {\r\n        return Err(\r\n          `Cannot remove project with active workspaces. Please remove all ${projectConfig.workspaces.length} workspace(s) first.`\r\n        );\r\n      }\r\n\r\n      config.projects.delete(projectPath);\r\n      await this.config.saveConfig(config);\r\n\r\n      try {\r\n        await this.config.updateProjectSecrets(projectPath, []);\r\n      } catch (error) {\r\n        log.error(`Failed to clean up secrets for project ${projectPath}:`, error);\r\n      }\r\n\r\n      return Ok(undefined);\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      return Err(`Failed to remove project: ${message}`);\r\n    }\r\n  }\r\n\r\n  list(): Array<[string, ProjectConfig]> {\r\n    try {\r\n      const config = this.config.loadConfigOrDefault();\r\n      return Array.from(config.projects.entries());\r\n    } catch (error) {\r\n      log.error(\"Failed to list projects:\", error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  async listBranches(projectPath: string): Promise<BranchListResult> {\r\n    if (typeof projectPath !== \"string\" || projectPath.trim().length === 0) {\r\n      throw new Error(\"Project path is required to list branches\");\r\n    }\r\n    try {\r\n      const validation = await validateProjectPath(projectPath);\r\n      if (!validation.valid) {\r\n        throw new Error(validation.error ?? \"Invalid project path\");\r\n      }\r\n      const normalizedPath = validation.expandedPath!;\r\n\r\n      // Non-git repos return empty branches - they're restricted to local runtime only\r\n      if (!(await isGitRepository(normalizedPath))) {\r\n        return { branches: [], recommendedTrunk: null };\r\n      }\r\n\r\n      const branches = await listLocalBranches(normalizedPath);\r\n\r\n      // Empty branches means the repo is unborn (git init but no commits yet)\r\n      // Return empty branches - frontend will show the git init banner since no branches exist\r\n      // After user creates a commit, branches will populate\r\n      if (branches.length === 0) {\r\n        return { branches: [], recommendedTrunk: null };\r\n      }\r\n\r\n      const recommendedTrunk = await detectDefaultTrunkBranch(normalizedPath, branches);\r\n      return { branches, recommendedTrunk };\r\n    } catch (error) {\r\n      log.error(\"Failed to list branches:\", error);\r\n      throw error instanceof Error ? error : new Error(String(error));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize a git repository in the project directory.\r\n   * Runs `git init` and creates an initial commit so branches exist.\r\n   * Also handles \"unborn\" repos (git init already run but no commits yet).\r\n   */\r\n  async gitInit(projectPath: string): Promise<Result<void>> {\r\n    if (typeof projectPath !== \"string\" || projectPath.trim().length === 0) {\r\n      return Err(\"Project path is required\");\r\n    }\r\n    try {\r\n      const validation = await validateProjectPath(projectPath);\r\n      if (!validation.valid) {\r\n        return Err(validation.error ?? \"Invalid project path\");\r\n      }\r\n      const normalizedPath = validation.expandedPath!;\r\n\r\n      const isGitRepo = await isGitRepository(normalizedPath);\r\n\r\n      if (isGitRepo) {\r\n        // Check if repo is \"unborn\" (git init but no commits yet)\r\n        const branches = await listLocalBranches(normalizedPath);\r\n        if (branches.length > 0) {\r\n          return Err(\"Directory is already a git repository with commits\");\r\n        }\r\n        // Repo exists but is unborn - just create the initial commit\r\n      } else {\r\n        // Initialize git repository with main as default branch\r\n        using initProc = execAsync(`git -C \"${normalizedPath}\" init -b main`);\r\n        await initProc.result;\r\n      }\r\n\r\n      // Create an initial empty commit so the branch exists and worktree/SSH can work\r\n      // Without a commit, the repo is \"unborn\" and has no branches\r\n      // Use -c flags to set identity only for this commit (don't persist to repo config)\r\n      using commitProc = execAsync(\r\n        `git -C \"${normalizedPath}\" -c user.name=\"mux\" -c user.email=\"mux@localhost\" commit --allow-empty -m \"Initial commit\"`\r\n      );\r\n      await commitProc.result;\r\n\r\n      // Invalidate file completions cache since the repo state changed\r\n      this.fileCompletionsCache.delete(normalizedPath);\r\n\r\n      return Ok(undefined);\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      log.error(\"Failed to initialize git repository:\", error);\r\n      return Err(`Failed to initialize git repository: ${message}`);\r\n    }\r\n  }\r\n\r\n  async getFileCompletions(\r\n    projectPath: string,\r\n    query: string,\r\n    limit?: number\r\n  ): Promise<{ paths: string[] }> {\r\n    const resolvedLimit = limit ?? 20;\r\n\r\n    if (typeof projectPath !== \"string\" || projectPath.trim().length === 0) {\r\n      return { paths: [] };\r\n    }\r\n\r\n    const validation = await validateProjectPath(projectPath);\r\n    if (!validation.valid) {\r\n      return { paths: [] };\r\n    }\r\n\r\n    const normalizedPath = validation.expandedPath!;\r\n\r\n    let cacheEntry = this.fileCompletionsCache.get(normalizedPath);\r\n    if (!cacheEntry) {\r\n      cacheEntry = { index: EMPTY_FILE_COMPLETIONS_INDEX, fetchedAt: 0 };\r\n      this.fileCompletionsCache.set(normalizedPath, cacheEntry);\r\n    }\r\n\r\n    const now = Date.now();\r\n    const isStale =\r\n      cacheEntry.fetchedAt === 0 || now - cacheEntry.fetchedAt > FILE_COMPLETIONS_CACHE_TTL_MS;\r\n\r\n    if (isStale && !cacheEntry.refreshing) {\r\n      cacheEntry.refreshing = (async () => {\r\n        try {\r\n          if (!(await isGitRepository(normalizedPath))) {\r\n            cacheEntry.index = EMPTY_FILE_COMPLETIONS_INDEX;\r\n            return;\r\n          }\r\n\r\n          using proc = execAsync(`git -C \"${normalizedPath}\" ls-files -co --exclude-standard`);\r\n          const { stdout } = await proc.result;\r\n\r\n          const files = stdout\r\n            .split(\"\\n\")\r\n            .map((line) => line.trim())\r\n            .filter((line) => line.length > 0)\r\n            // File @mentions are whitespace-delimited (extractAtMentions uses /@(\\\\S+)/), so\r\n            // suggestions containing spaces would be inserted incorrectly (e.g. \"@foo bar.ts\").\r\n            .filter((filePath) => !/\\s/.test(filePath));\r\n\r\n          cacheEntry.index = buildFileCompletionsIndex(files);\r\n        } catch (error) {\r\n          log.debug(\"getFileCompletions: failed to list files\", {\r\n            projectPath: normalizedPath,\r\n            error: error instanceof Error ? error.message : String(error),\r\n          });\r\n        } finally {\r\n          cacheEntry.fetchedAt = Date.now();\r\n          cacheEntry.refreshing = undefined;\r\n        }\r\n      })();\r\n    }\r\n\r\n    if (cacheEntry.fetchedAt === 0 && cacheEntry.refreshing) {\r\n      await cacheEntry.refreshing;\r\n    }\r\n\r\n    return { paths: searchFileCompletions(cacheEntry.index, query, resolvedLimit) };\r\n  }\r\n\r\n  getSecrets(projectPath: string): Secret[] {\r\n    try {\r\n      return this.config.getProjectSecrets(projectPath);\r\n    } catch (error) {\r\n      log.error(\"Failed to get project secrets:\", error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  async listDirectory(path: string) {\r\n    try {\r\n      const tree = await listDirectory(path);\r\n      return { success: true as const, data: tree };\r\n    } catch (error) {\r\n      return {\r\n        success: false as const,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      };\r\n    }\r\n  }\r\n\r\n  async createDirectory(\r\n    requestedPath: string\r\n  ): Promise<Result<{ normalizedPath: string }, string>> {\r\n    try {\r\n      // Expand ~ to home directory\r\n      const expanded =\r\n        requestedPath === \"~\" || requestedPath.startsWith(\"~/\") || requestedPath.startsWith(\"~\\\\\")\r\n          ? expandTilde(requestedPath)\r\n          : requestedPath;\r\n      const normalizedPath = path.resolve(expanded);\r\n\r\n      await fsPromises.mkdir(normalizedPath, { recursive: true });\r\n      return Ok({ normalizedPath });\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      return Err(`Failed to create directory: ${message}`);\r\n    }\r\n  }\r\n\r\n  async updateSecrets(projectPath: string, secrets: Secret[]): Promise<Result<void>> {\r\n    try {\r\n      await this.config.updateProjectSecrets(projectPath, secrets);\r\n      return Ok(undefined);\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      return Err(`Failed to update project secrets: ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get idle compaction hours setting for a project.\r\n   * Returns null if disabled or project not found.\r\n   */\r\n  getIdleCompactionHours(projectPath: string): number | null {\r\n    try {\r\n      const config = this.config.loadConfigOrDefault();\r\n      const project = config.projects.get(projectPath);\r\n      return project?.idleCompactionHours ?? null;\r\n    } catch (error) {\r\n      log.error(\"Failed to get idle compaction hours:\", error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set idle compaction hours for a project.\r\n   * Pass null to disable idle compaction.\r\n   */\r\n  async setIdleCompactionHours(projectPath: string, hours: number | null): Promise<Result<void>> {\r\n    try {\r\n      const config = this.config.loadConfigOrDefault();\r\n      const project = config.projects.get(projectPath);\r\n\r\n      if (!project) {\r\n        return Err(`Project not found: ${projectPath}`);\r\n      }\r\n\r\n      project.idleCompactionHours = hours;\r\n      await this.config.saveConfig(config);\r\n      return Ok(undefined);\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      return Err(`Failed to set idle compaction hours: ${message}`);\r\n    }\r\n  }\r\n\r\n  // ─────────────────────────────────────────────────────────────────────────────\r\n  // Section Management\r\n  // ─────────────────────────────────────────────────────────────────────────────\r\n\r\n  /**\r\n   * List all sections for a project, sorted by linked-list order.\r\n   */\r\n  listSections(projectPath: string): SectionConfig[] {\r\n    try {\r\n      const config = this.config.loadConfigOrDefault();\r\n      const project = config.projects.get(projectPath);\r\n      if (!project) return [];\r\n      return sortSectionsByLinkedList(project.sections ?? []);\r\n    } catch (error) {\r\n      log.error(\"Failed to list sections:\", error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a new section in a project.\r\n   */\r\n  async createSection(\r\n    projectPath: string,\r\n    name: string,\r\n    color?: string\r\n  ): Promise<Result<SectionConfig>> {\r\n    try {\r\n      const config = this.config.loadConfigOrDefault();\r\n      const project = config.projects.get(projectPath);\r\n\r\n      if (!project) {\r\n        return Err(`Project not found: ${projectPath}`);\r\n      }\r\n\r\n      const sections = project.sections ?? [];\r\n\r\n      const section: SectionConfig = {\r\n        id: randomBytes(4).toString(\"hex\"),\r\n        name,\r\n        color: color ?? DEFAULT_SECTION_COLOR,\r\n        nextId: null, // new section is last\r\n      };\r\n\r\n      // Find current tail (nextId is null/undefined) and point it to new section\r\n      const sorted = sortSectionsByLinkedList(sections);\r\n      if (sorted.length > 0) {\r\n        const tail = sorted[sorted.length - 1];\r\n        tail.nextId = section.id;\r\n      }\r\n\r\n      project.sections = [...sections, section];\r\n      await this.config.saveConfig(config);\r\n      return Ok(section);\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      return Err(`Failed to create section: ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update section name and/or color.\r\n   */\r\n  async updateSection(\r\n    projectPath: string,\r\n    sectionId: string,\r\n    updates: { name?: string; color?: string }\r\n  ): Promise<Result<void>> {\r\n    try {\r\n      const config = this.config.loadConfigOrDefault();\r\n      const project = config.projects.get(projectPath);\r\n\r\n      if (!project) {\r\n        return Err(`Project not found: ${projectPath}`);\r\n      }\r\n\r\n      const sections = project.sections ?? [];\r\n      const sectionIndex = sections.findIndex((s) => s.id === sectionId);\r\n\r\n      if (sectionIndex === -1) {\r\n        return Err(`Section not found: ${sectionId}`);\r\n      }\r\n\r\n      const section = sections[sectionIndex];\r\n      if (updates.name !== undefined) section.name = updates.name;\r\n      if (updates.color !== undefined) section.color = updates.color;\r\n\r\n      await this.config.saveConfig(config);\r\n      return Ok(undefined);\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      return Err(`Failed to update section: ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove a section. Only archived workspaces can remain in the section;\r\n   * active workspaces block removal. Archived workspaces become unsectioned.\r\n   */\r\n  async removeSection(projectPath: string, sectionId: string): Promise<Result<void>> {\r\n    try {\r\n      const config = this.config.loadConfigOrDefault();\r\n      const project = config.projects.get(projectPath);\r\n\r\n      if (!project) {\r\n        return Err(`Project not found: ${projectPath}`);\r\n      }\r\n\r\n      const sections = project.sections ?? [];\r\n      const sectionIndex = sections.findIndex((s) => s.id === sectionId);\r\n\r\n      if (sectionIndex === -1) {\r\n        return Err(`Section not found: ${sectionId}`);\r\n      }\r\n\r\n      // Check for active (non-archived) workspaces in this section\r\n      const workspacesInSection = project.workspaces.filter((w) => w.sectionId === sectionId);\r\n      const activeWorkspaces = workspacesInSection.filter(\r\n        (w) => !isWorkspaceArchived(w.archivedAt, w.unarchivedAt)\r\n      );\r\n\r\n      if (activeWorkspaces.length > 0) {\r\n        return Err(\r\n          `Cannot remove section: ${activeWorkspaces.length} active workspace(s) still assigned. ` +\r\n            `Archive or move workspaces first.`\r\n        );\r\n      }\r\n\r\n      // Remove sectionId from archived workspaces in this section\r\n      for (const workspace of workspacesInSection) {\r\n        workspace.sectionId = undefined;\r\n      }\r\n\r\n      // Remove the section\r\n      project.sections = sections.filter((s) => s.id !== sectionId);\r\n      await this.config.saveConfig(config);\r\n      return Ok(undefined);\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      return Err(`Failed to remove section: ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reorder sections by providing the full ordered list of section IDs.\r\n   */\r\n  async reorderSections(projectPath: string, sectionIds: string[]): Promise<Result<void>> {\r\n    try {\r\n      const config = this.config.loadConfigOrDefault();\r\n      const project = config.projects.get(projectPath);\r\n\r\n      if (!project) {\r\n        return Err(`Project not found: ${projectPath}`);\r\n      }\r\n\r\n      const sections = project.sections ?? [];\r\n      const sectionMap = new Map(sections.map((s) => [s.id, s]));\r\n\r\n      // Validate all IDs exist\r\n      for (const id of sectionIds) {\r\n        if (!sectionMap.has(id)) {\r\n          return Err(`Section not found: ${id}`);\r\n        }\r\n      }\r\n\r\n      // Update nextId pointers based on array order\r\n      for (let i = 0; i < sectionIds.length; i++) {\r\n        const section = sectionMap.get(sectionIds[i])!;\r\n        section.nextId = i < sectionIds.length - 1 ? sectionIds[i + 1] : null;\r\n      }\r\n\r\n      await this.config.saveConfig(config);\r\n      return Ok(undefined);\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      return Err(`Failed to reorder sections: ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Assign a workspace to a section (or remove from section with null).\r\n   */\r\n  async assignWorkspaceToSection(\r\n    projectPath: string,\r\n    workspaceId: string,\r\n    sectionId: string | null\r\n  ): Promise<Result<void>> {\r\n    try {\r\n      const config = this.config.loadConfigOrDefault();\r\n      const project = config.projects.get(projectPath);\r\n\r\n      if (!project) {\r\n        return Err(`Project not found: ${projectPath}`);\r\n      }\r\n\r\n      // Validate section exists if not null\r\n      if (sectionId !== null) {\r\n        const sections = project.sections ?? [];\r\n        if (!sections.some((s) => s.id === sectionId)) {\r\n          return Err(`Section not found: ${sectionId}`);\r\n        }\r\n      }\r\n\r\n      // Find and update workspace\r\n      const workspace = project.workspaces.find((w) => w.id === workspaceId);\r\n      if (!workspace) {\r\n        return Err(`Workspace not found: ${workspaceId}`);\r\n      }\r\n\r\n      workspace.sectionId = sectionId ?? undefined;\r\n      await this.config.saveConfig(config);\r\n      return Ok(undefined);\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : String(error);\r\n      return Err(`Failed to assign workspace to section: ${message}`);\r\n    }\r\n  }\r\n}\r\n"]}