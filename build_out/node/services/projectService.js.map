{"version":3,"file":"projectService.js","sourceRoot":"","sources":["../../../src/node/services/projectService.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Config, ProjectConfig } from \"@/node/config\";\nimport type { SectionConfig } from \"@/common/types/project\";\nimport { DEFAULT_SECTION_COLOR } from \"@/common/constants/ui\";\nimport { sortSectionsByLinkedList } from \"@/common/utils/sections\";\nimport { isWorkspaceArchived } from \"@/common/utils/archive\";\nimport { randomBytes } from \"crypto\";\nimport { validateProjectPath, isGitRepository } from \"@/node/utils/pathUtils\";\nimport { listLocalBranches, detectDefaultTrunkBranch } from \"@/node/git\";\nimport type { Result } from \"@/common/types/result\";\nimport { Ok, Err } from \"@/common/types/result\";\nimport type { Secret } from \"@/common/types/secrets\";\nimport type { Stats } from \"fs\";\nimport * as fsPromises from \"fs/promises\";\nimport { execAsync } from \"@/node/utils/disposableExec\";\nimport {\n  buildFileCompletionsIndex,\n  EMPTY_FILE_COMPLETIONS_INDEX,\n  searchFileCompletions,\n  type FileCompletionsIndex,\n} from \"@/node/services/fileCompletionsIndex\";\nimport { log } from \"@/node/services/log\";\nimport type { BranchListResult } from \"@/common/orpc/types\";\nimport type { FileTreeNode } from \"@/common/utils/git/numstatParser\";\nimport * as path from \"path\";\nimport { getMuxProjectsDir } from \"@/common/constants/paths\";\nimport { expandTilde } from \"@/node/runtime/tildeExpansion\";\n\n/**\n * List directory contents for the DirectoryPickerModal.\n * Returns a FileTreeNode where:\n * - name and path are the resolved absolute path of the requested directory\n * - children are the immediate subdirectories (not recursive)\n */\nasync function listDirectory(requestedPath: string): Promise<FileTreeNode> {\n  // Expand ~ to home directory (path.resolve doesn't handle tilde)\n  const expanded =\n    requestedPath === \"~\" || requestedPath.startsWith(\"~/\") || requestedPath.startsWith(\"~\\\\\")\n      ? expandTilde(requestedPath)\n      : requestedPath;\n  const normalizedRoot = path.resolve(expanded || \".\");\n  const entries = await fsPromises.readdir(normalizedRoot, { withFileTypes: true });\n\n  const children: FileTreeNode[] = entries\n    .filter((entry) => entry.isDirectory())\n    .map((entry) => {\n      const entryPath = path.join(normalizedRoot, entry.name);\n      return {\n        name: entry.name,\n        path: entryPath,\n        isDirectory: true,\n        children: [],\n      };\n    });\n\n  return {\n    name: normalizedRoot,\n    path: normalizedRoot,\n    isDirectory: true,\n    children,\n  };\n}\n\nconst FILE_COMPLETIONS_CACHE_TTL_MS = 10_000;\n\ninterface FileCompletionsCacheEntry {\n  index: FileCompletionsIndex;\n  fetchedAt: number;\n  refreshing?: Promise<void>;\n}\n\nexport class ProjectService {\n  private readonly fileCompletionsCache = new Map<string, FileCompletionsCacheEntry>();\n  private directoryPicker?: () => Promise<string | null>;\n\n  constructor(private readonly config: Config) {}\n\n  setDirectoryPicker(picker: () => Promise<string | null>) {\n    this.directoryPicker = picker;\n  }\n\n  async pickDirectory(): Promise<string | null> {\n    if (!this.directoryPicker) return null;\n    return this.directoryPicker();\n  }\n\n  async create(\n    projectPath: string\n  ): Promise<Result<{ projectConfig: ProjectConfig; normalizedPath: string }>> {\n    try {\n      // Validate input\n      if (!projectPath || projectPath.trim().length === 0) {\n        return Err(\"Project path cannot be empty\");\n      }\n\n      // Resolve the path:\n      // - Bare names like \"my-project\" → ~/.mux/projects/my-project\n      // - Paths with ~ → expand to home directory\n      // - Absolute/relative paths → resolve normally\n      const isBareProjectName =\n        projectPath.length > 0 &&\n        !projectPath.includes(\"/\") &&\n        !projectPath.includes(\"\\\\\") &&\n        !projectPath.startsWith(\"~\");\n\n      let normalizedPath: string;\n      if (isBareProjectName) {\n        // Bare project name - put in default projects directory\n        normalizedPath = path.join(getMuxProjectsDir(), projectPath);\n      } else if (\n        projectPath === \"~\" ||\n        projectPath.startsWith(\"~/\") ||\n        projectPath.startsWith(\"~\\\\\")\n      ) {\n        // Tilde expansion - uses expandTilde to respect MUX_ROOT for ~/.mux paths\n        normalizedPath = path.resolve(expandTilde(projectPath));\n      } else {\n        normalizedPath = path.resolve(projectPath);\n      }\n\n      let existingStat: Stats | null = null;\n      try {\n        existingStat = await fsPromises.stat(normalizedPath);\n      } catch (error) {\n        const err = error as NodeJS.ErrnoException;\n        if (err.code !== \"ENOENT\") {\n          throw error;\n        }\n      }\n\n      if (existingStat && !existingStat.isDirectory()) {\n        return Err(\"Project path is not a directory\");\n      }\n\n      const config = this.config.loadConfigOrDefault();\n\n      if (config.projects.has(normalizedPath)) {\n        return Err(\"Project already exists\");\n      }\n\n      // Create the directory if it doesn't exist (like mkdir -p)\n      await fsPromises.mkdir(normalizedPath, { recursive: true });\n\n      const projectConfig: ProjectConfig = { workspaces: [] };\n      config.projects.set(normalizedPath, projectConfig);\n      await this.config.saveConfig(config);\n\n      return Ok({ projectConfig, normalizedPath });\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to create project: ${message}`);\n    }\n  }\n\n  async remove(projectPath: string): Promise<Result<void>> {\n    try {\n      const config = this.config.loadConfigOrDefault();\n      const projectConfig = config.projects.get(projectPath);\n\n      if (!projectConfig) {\n        return Err(\"Project not found\");\n      }\n\n      if (projectConfig.workspaces.length > 0) {\n        return Err(\n          `Cannot remove project with active workspaces. Please remove all ${projectConfig.workspaces.length} workspace(s) first.`\n        );\n      }\n\n      config.projects.delete(projectPath);\n      await this.config.saveConfig(config);\n\n      try {\n        await this.config.updateProjectSecrets(projectPath, []);\n      } catch (error) {\n        log.error(`Failed to clean up secrets for project ${projectPath}:`, error);\n      }\n\n      return Ok(undefined);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to remove project: ${message}`);\n    }\n  }\n\n  list(): Array<[string, ProjectConfig]> {\n    try {\n      const config = this.config.loadConfigOrDefault();\n      return Array.from(config.projects.entries());\n    } catch (error) {\n      log.error(\"Failed to list projects:\", error);\n      return [];\n    }\n  }\n\n  async listBranches(projectPath: string): Promise<BranchListResult> {\n    if (typeof projectPath !== \"string\" || projectPath.trim().length === 0) {\n      throw new Error(\"Project path is required to list branches\");\n    }\n    try {\n      const validation = await validateProjectPath(projectPath);\n      if (!validation.valid) {\n        throw new Error(validation.error ?? \"Invalid project path\");\n      }\n      const normalizedPath = validation.expandedPath!;\n\n      // Non-git repos return empty branches - they're restricted to local runtime only\n      if (!(await isGitRepository(normalizedPath))) {\n        return { branches: [], recommendedTrunk: null };\n      }\n\n      const branches = await listLocalBranches(normalizedPath);\n\n      // Empty branches means the repo is unborn (git init but no commits yet)\n      // Return empty branches - frontend will show the git init banner since no branches exist\n      // After user creates a commit, branches will populate\n      if (branches.length === 0) {\n        return { branches: [], recommendedTrunk: null };\n      }\n\n      const recommendedTrunk = await detectDefaultTrunkBranch(normalizedPath, branches);\n      return { branches, recommendedTrunk };\n    } catch (error) {\n      log.error(\"Failed to list branches:\", error);\n      throw error instanceof Error ? error : new Error(String(error));\n    }\n  }\n\n  /**\n   * Initialize a git repository in the project directory.\n   * Runs `git init` and creates an initial commit so branches exist.\n   * Also handles \"unborn\" repos (git init already run but no commits yet).\n   */\n  async gitInit(projectPath: string): Promise<Result<void>> {\n    if (typeof projectPath !== \"string\" || projectPath.trim().length === 0) {\n      return Err(\"Project path is required\");\n    }\n    try {\n      const validation = await validateProjectPath(projectPath);\n      if (!validation.valid) {\n        return Err(validation.error ?? \"Invalid project path\");\n      }\n      const normalizedPath = validation.expandedPath!;\n\n      const isGitRepo = await isGitRepository(normalizedPath);\n\n      if (isGitRepo) {\n        // Check if repo is \"unborn\" (git init but no commits yet)\n        const branches = await listLocalBranches(normalizedPath);\n        if (branches.length > 0) {\n          return Err(\"Directory is already a git repository with commits\");\n        }\n        // Repo exists but is unborn - just create the initial commit\n      } else {\n        // Initialize git repository with main as default branch\n        using initProc = execAsync(`git -C \"${normalizedPath}\" init -b main`);\n        await initProc.result;\n      }\n\n      // Create an initial empty commit so the branch exists and worktree/SSH can work\n      // Without a commit, the repo is \"unborn\" and has no branches\n      // Use -c flags to set identity only for this commit (don't persist to repo config)\n      using commitProc = execAsync(\n        `git -C \"${normalizedPath}\" -c user.name=\"mux\" -c user.email=\"mux@localhost\" commit --allow-empty -m \"Initial commit\"`\n      );\n      await commitProc.result;\n\n      // Invalidate file completions cache since the repo state changed\n      this.fileCompletionsCache.delete(normalizedPath);\n\n      return Ok(undefined);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      log.error(\"Failed to initialize git repository:\", error);\n      return Err(`Failed to initialize git repository: ${message}`);\n    }\n  }\n\n  async getFileCompletions(\n    projectPath: string,\n    query: string,\n    limit?: number\n  ): Promise<{ paths: string[] }> {\n    const resolvedLimit = limit ?? 20;\n\n    if (typeof projectPath !== \"string\" || projectPath.trim().length === 0) {\n      return { paths: [] };\n    }\n\n    const validation = await validateProjectPath(projectPath);\n    if (!validation.valid) {\n      return { paths: [] };\n    }\n\n    const normalizedPath = validation.expandedPath!;\n\n    let cacheEntry = this.fileCompletionsCache.get(normalizedPath);\n    if (!cacheEntry) {\n      cacheEntry = { index: EMPTY_FILE_COMPLETIONS_INDEX, fetchedAt: 0 };\n      this.fileCompletionsCache.set(normalizedPath, cacheEntry);\n    }\n\n    const now = Date.now();\n    const isStale =\n      cacheEntry.fetchedAt === 0 || now - cacheEntry.fetchedAt > FILE_COMPLETIONS_CACHE_TTL_MS;\n\n    if (isStale && !cacheEntry.refreshing) {\n      cacheEntry.refreshing = (async () => {\n        try {\n          if (!(await isGitRepository(normalizedPath))) {\n            cacheEntry.index = EMPTY_FILE_COMPLETIONS_INDEX;\n            return;\n          }\n\n          using proc = execAsync(`git -C \"${normalizedPath}\" ls-files -co --exclude-standard`);\n          const { stdout } = await proc.result;\n\n          const files = stdout\n            .split(\"\\n\")\n            .map((line) => line.trim())\n            .filter((line) => line.length > 0)\n            // File @mentions are whitespace-delimited (extractAtMentions uses /@(\\\\S+)/), so\n            // suggestions containing spaces would be inserted incorrectly (e.g. \"@foo bar.ts\").\n            .filter((filePath) => !/\\s/.test(filePath));\n\n          cacheEntry.index = buildFileCompletionsIndex(files);\n        } catch (error) {\n          log.debug(\"getFileCompletions: failed to list files\", {\n            projectPath: normalizedPath,\n            error: error instanceof Error ? error.message : String(error),\n          });\n        } finally {\n          cacheEntry.fetchedAt = Date.now();\n          cacheEntry.refreshing = undefined;\n        }\n      })();\n    }\n\n    if (cacheEntry.fetchedAt === 0 && cacheEntry.refreshing) {\n      await cacheEntry.refreshing;\n    }\n\n    return { paths: searchFileCompletions(cacheEntry.index, query, resolvedLimit) };\n  }\n\n  getSecrets(projectPath: string): Secret[] {\n    try {\n      return this.config.getProjectSecrets(projectPath);\n    } catch (error) {\n      log.error(\"Failed to get project secrets:\", error);\n      return [];\n    }\n  }\n\n  async listDirectory(path: string) {\n    try {\n      const tree = await listDirectory(path);\n      return { success: true as const, data: tree };\n    } catch (error) {\n      return {\n        success: false as const,\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  async createDirectory(\n    requestedPath: string\n  ): Promise<Result<{ normalizedPath: string }, string>> {\n    try {\n      // Expand ~ to home directory\n      const expanded =\n        requestedPath === \"~\" || requestedPath.startsWith(\"~/\") || requestedPath.startsWith(\"~\\\\\")\n          ? expandTilde(requestedPath)\n          : requestedPath;\n      const normalizedPath = path.resolve(expanded);\n\n      await fsPromises.mkdir(normalizedPath, { recursive: true });\n      return Ok({ normalizedPath });\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to create directory: ${message}`);\n    }\n  }\n\n  async updateSecrets(projectPath: string, secrets: Secret[]): Promise<Result<void>> {\n    try {\n      await this.config.updateProjectSecrets(projectPath, secrets);\n      return Ok(undefined);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to update project secrets: ${message}`);\n    }\n  }\n\n  /**\n   * Get idle compaction hours setting for a project.\n   * Returns null if disabled or project not found.\n   */\n  getIdleCompactionHours(projectPath: string): number | null {\n    try {\n      const config = this.config.loadConfigOrDefault();\n      const project = config.projects.get(projectPath);\n      return project?.idleCompactionHours ?? null;\n    } catch (error) {\n      log.error(\"Failed to get idle compaction hours:\", error);\n      return null;\n    }\n  }\n\n  /**\n   * Set idle compaction hours for a project.\n   * Pass null to disable idle compaction.\n   */\n  async setIdleCompactionHours(projectPath: string, hours: number | null): Promise<Result<void>> {\n    try {\n      const config = this.config.loadConfigOrDefault();\n      const project = config.projects.get(projectPath);\n\n      if (!project) {\n        return Err(`Project not found: ${projectPath}`);\n      }\n\n      project.idleCompactionHours = hours;\n      await this.config.saveConfig(config);\n      return Ok(undefined);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to set idle compaction hours: ${message}`);\n    }\n  }\n\n  // ─────────────────────────────────────────────────────────────────────────────\n  // Section Management\n  // ─────────────────────────────────────────────────────────────────────────────\n\n  /**\n   * List all sections for a project, sorted by linked-list order.\n   */\n  listSections(projectPath: string): SectionConfig[] {\n    try {\n      const config = this.config.loadConfigOrDefault();\n      const project = config.projects.get(projectPath);\n      if (!project) return [];\n      return sortSectionsByLinkedList(project.sections ?? []);\n    } catch (error) {\n      log.error(\"Failed to list sections:\", error);\n      return [];\n    }\n  }\n\n  /**\n   * Create a new section in a project.\n   */\n  async createSection(\n    projectPath: string,\n    name: string,\n    color?: string\n  ): Promise<Result<SectionConfig>> {\n    try {\n      const config = this.config.loadConfigOrDefault();\n      const project = config.projects.get(projectPath);\n\n      if (!project) {\n        return Err(`Project not found: ${projectPath}`);\n      }\n\n      const sections = project.sections ?? [];\n\n      const section: SectionConfig = {\n        id: randomBytes(4).toString(\"hex\"),\n        name,\n        color: color ?? DEFAULT_SECTION_COLOR,\n        nextId: null, // new section is last\n      };\n\n      // Find current tail (nextId is null/undefined) and point it to new section\n      const sorted = sortSectionsByLinkedList(sections);\n      if (sorted.length > 0) {\n        const tail = sorted[sorted.length - 1];\n        tail.nextId = section.id;\n      }\n\n      project.sections = [...sections, section];\n      await this.config.saveConfig(config);\n      return Ok(section);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to create section: ${message}`);\n    }\n  }\n\n  /**\n   * Update section name and/or color.\n   */\n  async updateSection(\n    projectPath: string,\n    sectionId: string,\n    updates: { name?: string; color?: string }\n  ): Promise<Result<void>> {\n    try {\n      const config = this.config.loadConfigOrDefault();\n      const project = config.projects.get(projectPath);\n\n      if (!project) {\n        return Err(`Project not found: ${projectPath}`);\n      }\n\n      const sections = project.sections ?? [];\n      const sectionIndex = sections.findIndex((s) => s.id === sectionId);\n\n      if (sectionIndex === -1) {\n        return Err(`Section not found: ${sectionId}`);\n      }\n\n      const section = sections[sectionIndex];\n      if (updates.name !== undefined) section.name = updates.name;\n      if (updates.color !== undefined) section.color = updates.color;\n\n      await this.config.saveConfig(config);\n      return Ok(undefined);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to update section: ${message}`);\n    }\n  }\n\n  /**\n   * Remove a section. Only archived workspaces can remain in the section;\n   * active workspaces block removal. Archived workspaces become unsectioned.\n   */\n  async removeSection(projectPath: string, sectionId: string): Promise<Result<void>> {\n    try {\n      const config = this.config.loadConfigOrDefault();\n      const project = config.projects.get(projectPath);\n\n      if (!project) {\n        return Err(`Project not found: ${projectPath}`);\n      }\n\n      const sections = project.sections ?? [];\n      const sectionIndex = sections.findIndex((s) => s.id === sectionId);\n\n      if (sectionIndex === -1) {\n        return Err(`Section not found: ${sectionId}`);\n      }\n\n      // Check for active (non-archived) workspaces in this section\n      const workspacesInSection = project.workspaces.filter((w) => w.sectionId === sectionId);\n      const activeWorkspaces = workspacesInSection.filter(\n        (w) => !isWorkspaceArchived(w.archivedAt, w.unarchivedAt)\n      );\n\n      if (activeWorkspaces.length > 0) {\n        return Err(\n          `Cannot remove section: ${activeWorkspaces.length} active workspace(s) still assigned. ` +\n            `Archive or move workspaces first.`\n        );\n      }\n\n      // Remove sectionId from archived workspaces in this section\n      for (const workspace of workspacesInSection) {\n        workspace.sectionId = undefined;\n      }\n\n      // Remove the section\n      project.sections = sections.filter((s) => s.id !== sectionId);\n      await this.config.saveConfig(config);\n      return Ok(undefined);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to remove section: ${message}`);\n    }\n  }\n\n  /**\n   * Reorder sections by providing the full ordered list of section IDs.\n   */\n  async reorderSections(projectPath: string, sectionIds: string[]): Promise<Result<void>> {\n    try {\n      const config = this.config.loadConfigOrDefault();\n      const project = config.projects.get(projectPath);\n\n      if (!project) {\n        return Err(`Project not found: ${projectPath}`);\n      }\n\n      const sections = project.sections ?? [];\n      const sectionMap = new Map(sections.map((s) => [s.id, s]));\n\n      // Validate all IDs exist\n      for (const id of sectionIds) {\n        if (!sectionMap.has(id)) {\n          return Err(`Section not found: ${id}`);\n        }\n      }\n\n      // Update nextId pointers based on array order\n      for (let i = 0; i < sectionIds.length; i++) {\n        const section = sectionMap.get(sectionIds[i])!;\n        section.nextId = i < sectionIds.length - 1 ? sectionIds[i + 1] : null;\n      }\n\n      await this.config.saveConfig(config);\n      return Ok(undefined);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to reorder sections: ${message}`);\n    }\n  }\n\n  /**\n   * Assign a workspace to a section (or remove from section with null).\n   */\n  async assignWorkspaceToSection(\n    projectPath: string,\n    workspaceId: string,\n    sectionId: string | null\n  ): Promise<Result<void>> {\n    try {\n      const config = this.config.loadConfigOrDefault();\n      const project = config.projects.get(projectPath);\n\n      if (!project) {\n        return Err(`Project not found: ${projectPath}`);\n      }\n\n      // Validate section exists if not null\n      if (sectionId !== null) {\n        const sections = project.sections ?? [];\n        if (!sections.some((s) => s.id === sectionId)) {\n          return Err(`Section not found: ${sectionId}`);\n        }\n      }\n\n      // Find and update workspace\n      const workspace = project.workspaces.find((w) => w.id === workspaceId);\n      if (!workspace) {\n        return Err(`Workspace not found: ${workspaceId}`);\n      }\n\n      workspace.sectionId = sectionId ?? undefined;\n      await this.config.saveConfig(config);\n      return Ok(undefined);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return Err(`Failed to assign workspace to section: ${message}`);\n    }\n  }\n}\n"]}