{"version":3,"file":"editorService.test.js","sourceRoot":"","sources":["../../../src/node/services/editorService.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, test } from \"bun:test\";\r\nimport type { Config } from \"@/node/config\";\r\nimport type { FrontendWorkspaceMetadata } from \"@/common/types/workspace\";\r\nimport { EditorService } from \"./editorService\";\r\n\r\ndescribe(\"EditorService\", () => {\r\n  test(\"rejects non-custom editors (renderer must use deep links)\", async () => {\r\n    const editorService = new EditorService({} as Config);\r\n\r\n    const result = await editorService.openInEditor(\"ws1\", \"/tmp\", {\r\n      editor: \"vscode\",\r\n    });\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"deep links\");\r\n    }\r\n  });\r\n\r\n  test(\"validates custom editor executable exists before spawning\", async () => {\r\n    const workspace: FrontendWorkspaceMetadata = {\r\n      id: \"ws1\",\r\n      name: \"ws1\",\r\n      projectName: \"proj\",\r\n      projectPath: \"/tmp/proj\",\r\n      createdAt: \"2025-01-01T00:00:00.000Z\",\r\n      runtimeConfig: { type: \"worktree\", srcBaseDir: \"/tmp/src\" },\r\n      namedWorkspacePath: \"/tmp/src/proj/ws1\",\r\n    };\r\n\r\n    const mockConfig: Pick<Config, \"getAllWorkspaceMetadata\"> = {\r\n      getAllWorkspaceMetadata: () => Promise.resolve([workspace]),\r\n    } as unknown as Pick<Config, \"getAllWorkspaceMetadata\">;\r\n\r\n    const editorService = new EditorService(mockConfig as Config);\r\n\r\n    const result = await editorService.openInEditor(\"ws1\", \"/tmp\", {\r\n      editor: \"custom\",\r\n      customCommand: \"definitely-not-a-command\",\r\n    });\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"Editor command not found\");\r\n    }\r\n  });\r\n\r\n  test(\"errors on invalid custom editor command quoting\", async () => {\r\n    const workspace: FrontendWorkspaceMetadata = {\r\n      id: \"ws1\",\r\n      name: \"ws1\",\r\n      projectName: \"proj\",\r\n      projectPath: \"/tmp/proj\",\r\n      createdAt: \"2025-01-01T00:00:00.000Z\",\r\n      runtimeConfig: { type: \"worktree\", srcBaseDir: \"/tmp/src\" },\r\n      namedWorkspacePath: \"/tmp/src/proj/ws1\",\r\n    };\r\n\r\n    const mockConfig: Pick<Config, \"getAllWorkspaceMetadata\"> = {\r\n      getAllWorkspaceMetadata: () => Promise.resolve([workspace]),\r\n    } as unknown as Pick<Config, \"getAllWorkspaceMetadata\">;\r\n\r\n    const editorService = new EditorService(mockConfig as Config);\r\n\r\n    const result = await editorService.openInEditor(\"ws1\", \"/tmp\", {\r\n      editor: \"custom\",\r\n      customCommand: '\"unterminated',\r\n    });\r\n\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"Invalid custom editor command\");\r\n    }\r\n  });\r\n});\r\n"]}