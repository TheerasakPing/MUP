{"version":3,"file":"testHistoryService.js","sourceRoot":"","sources":["../../../src/node/services/testHistoryService.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;GASG;AACH,mEAAgE;AAChE,0CAAuC;AACvC,MAAY,EAAE,wCAAoB;AAClC,MAAY,EAAE,+BAAW;AACzB,MAAY,IAAI,iCAAa;AAEtB,KAAK,qCAKT;IACD,MAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CACvB,EAAE,CAAC,MAAM,EAAE,EACX,oBAAoB,IAAI,CAAC,GAAG,EAAE,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CACxE,CAAC;IACF,MAAM,EAAE,CAAC,KAAK,CAAC,OAAO,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;IAC7C,MAAM,MAAM,GAAG,IAAI,eAAM,CAAC,OAAO,CAAC,CAAC;IACnC,MAAM,cAAc,GAAG,IAAI,+BAAc,CAAC,MAAM,CAAC,CAAC;IAClD,OAAO;QACL,cAAc;QACd,MAAM;QACN,OAAO;QACP,OAAO,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,OAAO,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;KAChE,CAAC;AAAA,CACH","sourcesContent":["/**\r\n * Shared test helper: creates a real HistoryService backed by a temp directory.\r\n *\r\n * HistoryService is pure filesystem I/O with a single dependency (getSessionDir).\r\n * Prefer this over mocks in tests â€” it's fast (sub-millisecond on temp dirs),\r\n * requires no initialization, and exercises real read/write paths.\r\n *\r\n * For error injection, use the real instance + spyOn:\r\n *   spyOn(historyService, \"appendToHistory\").mockRejectedValueOnce(...)\r\n */\r\nimport { HistoryService } from \"@/node/services/historyService\";\r\nimport { Config } from \"@/node/config\";\r\nimport * as fs from \"fs/promises\";\r\nimport * as os from \"os\";\r\nimport * as path from \"path\";\r\n\r\nexport async function createTestHistoryService(): Promise<{\r\n  historyService: HistoryService;\r\n  config: Config;\r\n  tempDir: string;\r\n  cleanup: () => Promise<void>;\r\n}> {\r\n  const tempDir = path.join(\r\n    os.tmpdir(),\r\n    `mux-test-history-${Date.now()}-${Math.random().toString(36).slice(2)}`\r\n  );\r\n  await fs.mkdir(tempDir, { recursive: true });\r\n  const config = new Config(tempDir);\r\n  const historyService = new HistoryService(config);\r\n  return {\r\n    historyService,\r\n    config,\r\n    tempDir,\r\n    cleanup: () => fs.rm(tempDir, { recursive: true, force: true }),\r\n  };\r\n}\r\n"]}