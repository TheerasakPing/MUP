{"version":3,"file":"testHistoryService.js","sourceRoot":"","sources":["../../../src/node/services/testHistoryService.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;GASG;AACH,mEAAgE;AAChE,0CAAuC;AACvC,MAAY,EAAE,wCAAoB;AAClC,MAAY,EAAE,+BAAW;AACzB,MAAY,IAAI,iCAAa;AAEtB,KAAK,qCAKT;IACD,MAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CACvB,EAAE,CAAC,MAAM,EAAE,EACX,oBAAoB,IAAI,CAAC,GAAG,EAAE,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CACxE,CAAC;IACF,MAAM,EAAE,CAAC,KAAK,CAAC,OAAO,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;IAC7C,MAAM,MAAM,GAAG,IAAI,eAAM,CAAC,OAAO,CAAC,CAAC;IACnC,MAAM,cAAc,GAAG,IAAI,+BAAc,CAAC,MAAM,CAAC,CAAC;IAClD,OAAO;QACL,cAAc;QACd,MAAM;QACN,OAAO;QACP,OAAO,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,OAAO,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;KAChE,CAAC;AAAA,CACH","sourcesContent":["/**\n * Shared test helper: creates a real HistoryService backed by a temp directory.\n *\n * HistoryService is pure filesystem I/O with a single dependency (getSessionDir).\n * Prefer this over mocks in tests â€” it's fast (sub-millisecond on temp dirs),\n * requires no initialization, and exercises real read/write paths.\n *\n * For error injection, use the real instance + spyOn:\n *   spyOn(historyService, \"appendToHistory\").mockRejectedValueOnce(...)\n */\nimport { HistoryService } from \"@/node/services/historyService\";\nimport { Config } from \"@/node/config\";\nimport * as fs from \"fs/promises\";\nimport * as os from \"os\";\nimport * as path from \"path\";\n\nexport async function createTestHistoryService(): Promise<{\n  historyService: HistoryService;\n  config: Config;\n  tempDir: string;\n  cleanup: () => Promise<void>;\n}> {\n  const tempDir = path.join(\n    os.tmpdir(),\n    `mux-test-history-${Date.now()}-${Math.random().toString(36).slice(2)}`\n  );\n  await fs.mkdir(tempDir, { recursive: true });\n  const config = new Config(tempDir);\n  const historyService = new HistoryService(config);\n  return {\n    historyService,\n    config,\n    tempDir,\n    cleanup: () => fs.rm(tempDir, { recursive: true, force: true }),\n  };\n}\n"]}