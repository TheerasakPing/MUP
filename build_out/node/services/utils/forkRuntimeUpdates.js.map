{"version":3,"file":"forkRuntimeUpdates.js","sourceRoot":"","sources":["../../../../src/node/services/utils/forkRuntimeUpdates.ts"],"names":[],"mappings":";;;;AAIA,mCACE,mBAAkC,EAClC,UAA+B,EAI/B;IACA,OAAO;QACL,mBAAmB,EAAE,UAAU,CAAC,mBAAmB,IAAI,mBAAmB;QAC1E,yBAAyB,EAAE,UAAU,CAAC,mBAAmB;KAC1D,CAAC;AAAA,CACH;AAED;;;;;;;;GAQG;AACI,KAAK,kCACV,MAAc,EACd,iBAAyB,EACzB,mBAAkC,EAClC,UAA+B,EACkB;IACjD,MAAM,QAAQ,GAAG,yBAAyB,CAAC,mBAAmB,EAAE,UAAU,CAAC,CAAC;IAE5E,IAAI,QAAQ,CAAC,yBAAyB,EAAE,CAAC;QACvC,MAAM,MAAM,CAAC,uBAAuB,CAAC,iBAAiB,EAAE;YACtD,aAAa,EAAE,QAAQ,CAAC,yBAAyB;SAClD,CAAC,CAAC;IACL,CAAC;IAED,OAAO,EAAE,mBAAmB,EAAE,QAAQ,CAAC,mBAAmB,EAAE,CAAC;AAAA,CAC9D","sourcesContent":["import type { Config } from \"@/node/config\";\nimport type { RuntimeConfig } from \"@/common/types/runtime\";\nimport type { WorkspaceForkResult } from \"@/node/runtime/Runtime\";\n\nexport function resolveForkRuntimeConfigs(\n  sourceRuntimeConfig: RuntimeConfig,\n  forkResult: WorkspaceForkResult\n): {\n  forkedRuntimeConfig: RuntimeConfig;\n  sourceRuntimeConfigUpdate?: RuntimeConfig;\n} {\n  return {\n    forkedRuntimeConfig: forkResult.forkedRuntimeConfig ?? sourceRuntimeConfig,\n    sourceRuntimeConfigUpdate: forkResult.sourceRuntimeConfig,\n  };\n}\n\n/**\n * Apply runtime config updates returned by runtime.forkWorkspace().\n *\n * Runtimes may return updated runtimeConfig for:\n * - the new workspace (forkedRuntimeConfig)\n * - the source workspace (sourceRuntimeConfig)\n *\n * This helper centralizes the logic so WorkspaceService and TaskService stay consistent.\n */\nexport async function applyForkRuntimeUpdates(\n  config: Config,\n  sourceWorkspaceId: string,\n  sourceRuntimeConfig: RuntimeConfig,\n  forkResult: WorkspaceForkResult\n): Promise<{ forkedRuntimeConfig: RuntimeConfig }> {\n  const resolved = resolveForkRuntimeConfigs(sourceRuntimeConfig, forkResult);\n\n  if (resolved.sourceRuntimeConfigUpdate) {\n    await config.updateWorkspaceMetadata(sourceWorkspaceId, {\n      runtimeConfig: resolved.sourceRuntimeConfigUpdate,\n    });\n  }\n\n  return { forkedRuntimeConfig: resolved.forkedRuntimeConfig };\n}\n"]}