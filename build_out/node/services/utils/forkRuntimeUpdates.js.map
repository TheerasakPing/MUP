{"version":3,"file":"forkRuntimeUpdates.js","sourceRoot":"","sources":["../../../../src/node/services/utils/forkRuntimeUpdates.ts"],"names":[],"mappings":";;;;AAIA,mCACE,mBAAkC,EAClC,UAA+B,EAI/B;IACA,OAAO;QACL,mBAAmB,EAAE,UAAU,CAAC,mBAAmB,IAAI,mBAAmB;QAC1E,yBAAyB,EAAE,UAAU,CAAC,mBAAmB;KAC1D,CAAC;AAAA,CACH;AAED;;;;;;;;GAQG;AACI,KAAK,kCACV,MAAc,EACd,iBAAyB,EACzB,mBAAkC,EAClC,UAA+B,EACkB;IACjD,MAAM,QAAQ,GAAG,yBAAyB,CAAC,mBAAmB,EAAE,UAAU,CAAC,CAAC;IAE5E,IAAI,QAAQ,CAAC,yBAAyB,EAAE,CAAC;QACvC,MAAM,MAAM,CAAC,uBAAuB,CAAC,iBAAiB,EAAE;YACtD,aAAa,EAAE,QAAQ,CAAC,yBAAyB;SAClD,CAAC,CAAC;IACL,CAAC;IAED,OAAO,EAAE,mBAAmB,EAAE,QAAQ,CAAC,mBAAmB,EAAE,CAAC;AAAA,CAC9D","sourcesContent":["import type { Config } from \"@/node/config\";\r\nimport type { RuntimeConfig } from \"@/common/types/runtime\";\r\nimport type { WorkspaceForkResult } from \"@/node/runtime/Runtime\";\r\n\r\nexport function resolveForkRuntimeConfigs(\r\n  sourceRuntimeConfig: RuntimeConfig,\r\n  forkResult: WorkspaceForkResult\r\n): {\r\n  forkedRuntimeConfig: RuntimeConfig;\r\n  sourceRuntimeConfigUpdate?: RuntimeConfig;\r\n} {\r\n  return {\r\n    forkedRuntimeConfig: forkResult.forkedRuntimeConfig ?? sourceRuntimeConfig,\r\n    sourceRuntimeConfigUpdate: forkResult.sourceRuntimeConfig,\r\n  };\r\n}\r\n\r\n/**\r\n * Apply runtime config updates returned by runtime.forkWorkspace().\r\n *\r\n * Runtimes may return updated runtimeConfig for:\r\n * - the new workspace (forkedRuntimeConfig)\r\n * - the source workspace (sourceRuntimeConfig)\r\n *\r\n * This helper centralizes the logic so WorkspaceService and TaskService stay consistent.\r\n */\r\nexport async function applyForkRuntimeUpdates(\r\n  config: Config,\r\n  sourceWorkspaceId: string,\r\n  sourceRuntimeConfig: RuntimeConfig,\r\n  forkResult: WorkspaceForkResult\r\n): Promise<{ forkedRuntimeConfig: RuntimeConfig }> {\r\n  const resolved = resolveForkRuntimeConfigs(sourceRuntimeConfig, forkResult);\r\n\r\n  if (resolved.sourceRuntimeConfigUpdate) {\r\n    await config.updateWorkspaceMetadata(sourceWorkspaceId, {\r\n      runtimeConfig: resolved.sourceRuntimeConfigUpdate,\r\n    });\r\n  }\r\n\r\n  return { forkedRuntimeConfig: resolved.forkedRuntimeConfig };\r\n}\r\n"]}