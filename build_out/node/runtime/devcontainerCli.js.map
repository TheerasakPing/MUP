{"version":3,"file":"devcontainerCli.js","sourceRoot":"","sources":["../../../src/node/runtime/devcontainerCli.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Devcontainer CLI helper - wraps `devcontainer` CLI commands.\r\n *\r\n * This module provides async functions for devcontainer operations:\r\n * - checkVersion: verify CLI is installed and get version\r\n * - up: build/start container with streaming logs\r\n * - exec: execute commands inside the container\r\n * - down: stop and remove the container\r\n */\r\nimport { spawn } from \"child_process\";\r\nimport type { InitLogger } from \"./Runtime\";\r\nimport { LineBuffer } from \"./initHook\";\r\nimport { getErrorMessage } from \"@/common/utils/errors\";\r\nimport { log } from \"@/node/services/log\";\r\n\r\ntype DevcontainerUpOutcome = \"success\" | \"error\";\r\n\r\nexport interface DevcontainerUpResultLine {\r\n  outcome: DevcontainerUpOutcome;\r\n  containerId?: string;\r\n  remoteUser?: string;\r\n  remoteWorkspaceFolder?: string;\r\n  message?: string;\r\n  description?: string;\r\n}\r\n\r\nexport type DevcontainerStdoutParse =\r\n  | { kind: \"result\"; result: DevcontainerUpResultLine }\r\n  | { kind: \"log\"; text: string }\r\n  | { kind: \"raw\"; text: string };\r\n\r\nfunction isRecord(value: unknown): value is Record<string, unknown> {\r\n  return typeof value === \"object\" && value !== null;\r\n}\r\n\r\nfunction isDevcontainerUpOutcome(value: unknown): value is DevcontainerUpOutcome {\r\n  return value === \"success\" || value === \"error\";\r\n}\r\n\r\nfunction isDevcontainerUpResult(value: unknown): value is DevcontainerUpResultLine {\r\n  if (!isRecord(value)) return false;\r\n  return isDevcontainerUpOutcome(value.outcome);\r\n}\r\n\r\nfunction extractDevcontainerLogText(value: Record<string, unknown>): string | null {\r\n  const text = typeof value.text === \"string\" ? value.text : undefined;\r\n  if (text) {\r\n    const level = typeof value.level === \"number\" ? value.level : 0;\r\n    const channel = typeof value.channel === \"string\" ? value.channel : \"\";\r\n    const type = typeof value.type === \"string\" ? value.type : \"\";\r\n    const isError = channel === \"error\" || type === \"error\";\r\n    if (level >= 2 || isError) {\r\n      return text;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  const name = typeof value.name === \"string\" ? value.name : undefined;\r\n  if (name) {\r\n    return name;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nfunction parseJsonLine(line: string): unknown {\r\n  try {\r\n    return JSON.parse(line) as unknown;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function parseDevcontainerStdoutLine(line: string): DevcontainerStdoutParse | null {\r\n  const trimmed = line.trim();\r\n  if (!trimmed) return null;\r\n  if (!trimmed.startsWith(\"{\")) {\r\n    return { kind: \"raw\", text: line };\r\n  }\r\n\r\n  const parsed = parseJsonLine(trimmed);\r\n  if (!parsed) {\r\n    return { kind: \"raw\", text: line };\r\n  }\r\n\r\n  if (isDevcontainerUpResult(parsed)) {\r\n    return { kind: \"result\", result: parsed };\r\n  }\r\n\r\n  if (isRecord(parsed)) {\r\n    const text = extractDevcontainerLogText(parsed);\r\n    if (text) {\r\n      return { kind: \"log\", text };\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nexport function formatDevcontainerUpError(\r\n  result: DevcontainerUpResultLine,\r\n  stderrSummary?: string\r\n): string {\r\n  const messageParts = [result.message, result.description].filter(\r\n    (value): value is string => typeof value === \"string\" && value.trim().length > 0\r\n  );\r\n  if (messageParts.length > 0) {\r\n    return `devcontainer up failed: ${messageParts.join(\" - \")}`;\r\n  }\r\n\r\n  if (stderrSummary && stderrSummary.trim().length > 0) {\r\n    return `devcontainer up failed: ${stderrSummary.trim()}`;\r\n  }\r\n\r\n  return \"devcontainer up failed\";\r\n}\r\n\r\nexport function shouldCleanupDevcontainer(result: DevcontainerUpResultLine): boolean {\r\n  return (\r\n    result.outcome === \"error\" &&\r\n    typeof result.containerId === \"string\" &&\r\n    result.containerId.trim().length > 0\r\n  );\r\n}\r\n/** Output from `devcontainer up` command */\r\nexport interface DevcontainerUpResult {\r\n  containerId: string;\r\n  remoteUser: string;\r\n  remoteWorkspaceFolder: string;\r\n}\r\n\r\n/** Devcontainer CLI availability info */\r\nexport interface DevcontainerCliInfo {\r\n  available: true;\r\n  version: string;\r\n}\r\n\r\n/** devcontainer up options */\r\nexport interface DevcontainerUpOptions {\r\n  workspaceFolder: string;\r\n  configPath?: string;\r\n  initLogger: InitLogger;\r\n  abortSignal?: AbortSignal;\r\n  /** Additional mount flags (for credential sharing) */\r\n  additionalMounts?: string[];\r\n  /** Additional remote env vars */\r\n  remoteEnv?: Record<string, string>;\r\n  /** Timeout in milliseconds (default: 30 minutes) */\r\n  timeoutMs?: number;\r\n}\r\n\r\n/** devcontainer exec options */\r\nexport interface DevcontainerExecOptions {\r\n  workspaceFolder: string;\r\n  configPath?: string;\r\n  command: string;\r\n  /** Working directory inside container */\r\n  cwd?: string;\r\n  /** Environment variables to pass */\r\n  env?: Record<string, string>;\r\n  abortSignal?: AbortSignal;\r\n  /** Timeout in milliseconds */\r\n  timeoutMs?: number;\r\n}\r\n\r\nconst SENSITIVE_REMOTE_ENV_KEYS = new Set([\r\n  \"GH_TOKEN\",\r\n  \"GITHUB_TOKEN\",\r\n  \"GH_ENTERPRISE_TOKEN\",\r\n  \"GITHUB_ENTERPRISE_TOKEN\",\r\n]);\r\n\r\nfunction redactRemoteEnvArgs(args: string[]): string[] {\r\n  const redacted = [...args];\r\n  for (let i = 0; i < redacted.length - 1; i += 1) {\r\n    if (redacted[i] !== \"--remote-env\") continue;\r\n    const entry = redacted[i + 1] ?? \"\";\r\n    const [key] = entry.split(\"=\");\r\n    if (SENSITIVE_REMOTE_ENV_KEYS.has(key)) {\r\n      redacted[i + 1] = `${key}=<redacted>`;\r\n    }\r\n  }\r\n  return redacted;\r\n}\r\nconst DEFAULT_UP_TIMEOUT_MS = 30 * 60 * 1000; // 30 minutes\r\nconst MAX_STDERR_BUFFER_LENGTH = 8_000; // 8KB cap for error summaries\r\nconst DEFAULT_CLEANUP_TIMEOUT_MS = 60_000; // 1 minute\r\n\r\nasync function removeDevcontainerContainer(containerId: string): Promise<void> {\r\n  await new Promise<void>((resolve) => {\r\n    const proc = spawn(\"docker\", [\"rm\", \"-f\", containerId], {\r\n      stdio: [\"ignore\", \"pipe\", \"pipe\"],\r\n      timeout: DEFAULT_CLEANUP_TIMEOUT_MS,\r\n    });\r\n\r\n    proc.on(\"error\", () => {\r\n      resolve();\r\n    });\r\n\r\n    proc.on(\"close\", () => {\r\n      resolve();\r\n    });\r\n  });\r\n}\r\nconst VERSION_CHECK_TIMEOUT_MS = 10_000; // 10 seconds\r\n\r\n/**\r\n * Check if devcontainer CLI is installed and get version.\r\n */\r\nexport async function checkDevcontainerCliVersion(): Promise<DevcontainerCliInfo | null> {\r\n  return new Promise((resolve) => {\r\n    const proc = spawn(\"devcontainer\", [\"--version\"], {\r\n      stdio: [\"ignore\", \"pipe\", \"pipe\"],\r\n      timeout: VERSION_CHECK_TIMEOUT_MS,\r\n    });\r\n\r\n    let stdout = \"\";\r\n    proc.stdout?.on(\"data\", (data: Buffer) => {\r\n      stdout += data.toString();\r\n    });\r\n\r\n    proc.on(\"error\", () => {\r\n      resolve(null);\r\n    });\r\n\r\n    proc.on(\"close\", (code) => {\r\n      if (code === 0 && stdout.trim()) {\r\n        resolve({ available: true, version: stdout.trim() });\r\n      } else {\r\n        resolve(null);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Run `devcontainer up` with streaming logs.\r\n * Parses the JSON output to extract container info.\r\n */\r\nexport async function devcontainerUp(\r\n  options: DevcontainerUpOptions\r\n): Promise<DevcontainerUpResult> {\r\n  const {\r\n    workspaceFolder,\r\n    configPath,\r\n    initLogger,\r\n    abortSignal,\r\n    additionalMounts,\r\n    remoteEnv,\r\n    timeoutMs = DEFAULT_UP_TIMEOUT_MS,\r\n  } = options;\r\n\r\n  const baseArgs = [\"up\", \"--log-format\", \"json\", \"--workspace-folder\", workspaceFolder];\r\n\r\n  if (configPath) {\r\n    baseArgs.push(\"--config\", configPath);\r\n  }\r\n\r\n  // Add mounts for credential sharing\r\n  if (additionalMounts) {\r\n    for (const mount of additionalMounts) {\r\n      baseArgs.push(\"--mount\", mount);\r\n    }\r\n  }\r\n\r\n  // Add remote env vars\r\n  if (remoteEnv) {\r\n    for (const [key, value] of Object.entries(remoteEnv)) {\r\n      baseArgs.push(\"--remote-env\", `${key}=${value}`);\r\n    }\r\n  }\r\n\r\n  const runUp = (args: string[]): Promise<DevcontainerUpResult> => {\r\n    const logArgs = redactRemoteEnvArgs(args);\r\n    initLogger.logStep(`Running: devcontainer ${logArgs.join(\" \")}`);\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const proc = spawn(\"devcontainer\", args, {\r\n        stdio: [\"ignore\", \"pipe\", \"pipe\"],\r\n        timeout: timeoutMs,\r\n        cwd: workspaceFolder,\r\n      });\r\n\r\n      let settled = false;\r\n      let lastResultLine: DevcontainerUpResultLine | null = null;\r\n      let stderrBuffer = \"\";\r\n      let timeoutId: ReturnType<typeof setTimeout> | undefined;\r\n\r\n      const settleSuccess = (result: DevcontainerUpResult) => {\r\n        if (settled) return;\r\n        settled = true;\r\n        if (timeoutId) clearTimeout(timeoutId);\r\n        resolve(result);\r\n      };\r\n\r\n      const appendStderrSummary = (text: string) => {\r\n        if (stderrBuffer.length >= MAX_STDERR_BUFFER_LENGTH) return;\r\n        const next = `${text}\\n`;\r\n        stderrBuffer = (stderrBuffer + next).slice(0, MAX_STDERR_BUFFER_LENGTH);\r\n      };\r\n      const settleError = (error: Error) => {\r\n        if (settled) return;\r\n        settled = true;\r\n        if (timeoutId) clearTimeout(timeoutId);\r\n        reject(error);\r\n      };\r\n\r\n      const stdoutLineBuffer = new LineBuffer((line) => {\r\n        const parsed = parseDevcontainerStdoutLine(line);\r\n        if (!parsed) return;\r\n        if (parsed.kind === \"result\") {\r\n          lastResultLine = parsed.result;\r\n          return;\r\n        }\r\n        if (parsed.kind === \"log\") {\r\n          initLogger.logStdout(parsed.text);\r\n          return;\r\n        }\r\n        initLogger.logStdout(parsed.text);\r\n      });\r\n\r\n      const stderrLineBuffer = new LineBuffer((line) => {\r\n        const parsed = parseDevcontainerStdoutLine(line);\r\n        if (parsed?.kind === \"result\") {\r\n          lastResultLine ??= parsed.result;\r\n          return;\r\n        }\r\n        const summaryText = parsed ? parsed.text : line;\r\n        appendStderrSummary(summaryText);\r\n        if (!parsed) return;\r\n        initLogger.logStdout(parsed.text);\r\n      });\r\n\r\n      proc.stdout?.on(\"data\", (data: Buffer) => {\r\n        stdoutLineBuffer.append(data.toString());\r\n      });\r\n\r\n      proc.stderr?.on(\"data\", (data: Buffer) => {\r\n        stderrLineBuffer.append(data.toString());\r\n      });\r\n\r\n      const abortHandler = () => {\r\n        proc.kill(\"SIGTERM\");\r\n        settleError(new Error(\"devcontainer up aborted\"));\r\n      };\r\n\r\n      if (timeoutMs && timeoutMs > 0) {\r\n        timeoutId = setTimeout(() => {\r\n          proc.kill(\"SIGTERM\");\r\n          settleError(new Error(`devcontainer up timed out after ${timeoutMs}ms`));\r\n        }, timeoutMs);\r\n      }\r\n      abortSignal?.addEventListener(\"abort\", abortHandler);\r\n\r\n      const finalizeError = async (message: string, result?: DevcontainerUpResultLine | null) => {\r\n        if (result && shouldCleanupDevcontainer(result)) {\r\n          try {\r\n            await removeDevcontainerContainer(result.containerId ?? \"\");\r\n          } catch (cleanupError) {\r\n            log.debug(\"Failed to remove devcontainer container\", {\r\n              cleanupError,\r\n              containerId: result.containerId,\r\n            });\r\n          }\r\n        }\r\n        settleError(new Error(message));\r\n      };\r\n\r\n      proc.on(\"error\", (err) => {\r\n        abortSignal?.removeEventListener(\"abort\", abortHandler);\r\n        stdoutLineBuffer.flush();\r\n        stderrLineBuffer.flush();\r\n        settleError(new Error(`devcontainer up failed: ${getErrorMessage(err)}`));\r\n      });\r\n\r\n      proc.on(\"close\", (code) => {\r\n        const handleClose = async () => {\r\n          abortSignal?.removeEventListener(\"abort\", abortHandler);\r\n          stdoutLineBuffer.flush();\r\n          stderrLineBuffer.flush();\r\n\r\n          if (settled) return;\r\n\r\n          const stderrSummary = stderrBuffer.trim();\r\n\r\n          if (lastResultLine) {\r\n            if (lastResultLine.outcome === \"success\") {\r\n              if (\r\n                !lastResultLine.containerId ||\r\n                !lastResultLine.remoteUser ||\r\n                !lastResultLine.remoteWorkspaceFolder\r\n              ) {\r\n                await finalizeError(\r\n                  \"devcontainer up output missing required fields\",\r\n                  lastResultLine\r\n                );\r\n                return;\r\n              }\r\n\r\n              settleSuccess({\r\n                containerId: lastResultLine.containerId,\r\n                remoteUser: lastResultLine.remoteUser,\r\n                remoteWorkspaceFolder: lastResultLine.remoteWorkspaceFolder,\r\n              });\r\n              return;\r\n            }\r\n\r\n            await finalizeError(\r\n              formatDevcontainerUpError(lastResultLine, stderrSummary),\r\n              lastResultLine\r\n            );\r\n            return;\r\n          }\r\n\r\n          if (code !== 0) {\r\n            const suffix = stderrSummary.length > 0 ? `: ${stderrSummary}` : \"\";\r\n            settleError(new Error(`devcontainer up exited with code ${String(code)}${suffix}`));\r\n            return;\r\n          }\r\n\r\n          const suffix = stderrSummary.length > 0 ? `: ${stderrSummary}` : \"\";\r\n          settleError(new Error(`devcontainer up did not produce result output${suffix}`));\r\n        };\r\n\r\n        void handleClose();\r\n      });\r\n    });\r\n  };\r\n\r\n  return runUp(baseArgs);\r\n}\r\n\r\n/**\r\n * Execute a command inside the devcontainer.\r\n * Returns stdout as a string.\r\n */\r\nexport async function devcontainerExec(\r\n  options: DevcontainerExecOptions\r\n): Promise<{ stdout: string; stderr: string; exitCode: number }> {\r\n  const { workspaceFolder, configPath, command, cwd, env, abortSignal, timeoutMs } = options;\r\n\r\n  const args = [\"exec\", \"--workspace-folder\", workspaceFolder];\r\n\r\n  if (configPath) {\r\n    args.push(\"--config\", configPath);\r\n  }\r\n\r\n  // Add environment variables\r\n  if (env) {\r\n    for (const [key, value] of Object.entries(env)) {\r\n      args.push(\"--remote-env\", `${key}=${value}`);\r\n    }\r\n  }\r\n\r\n  // Build the command with cd if cwd specified\r\n  let fullCommand = command;\r\n  if (cwd) {\r\n    // Use bash -c to handle cd + command\r\n    fullCommand = `cd ${JSON.stringify(cwd)} && ${command}`;\r\n  }\r\n\r\n  // The command goes after --\r\n  args.push(\"--\", \"bash\", \"-c\", fullCommand);\r\n\r\n  return new Promise((resolve, reject) => {\r\n    const proc = spawn(\"devcontainer\", args, {\r\n      stdio: [\"ignore\", \"pipe\", \"pipe\"],\r\n      timeout: timeoutMs,\r\n      cwd: workspaceFolder,\r\n    });\r\n\r\n    let stdout = \"\";\r\n    let stderr = \"\";\r\n    let settled = false;\r\n    let timeoutId: ReturnType<typeof setTimeout> | undefined;\r\n\r\n    const abortHandler = () => {\r\n      proc.kill(\"SIGTERM\");\r\n      settleReject(new Error(\"devcontainer exec aborted\"));\r\n    };\r\n\r\n    const clearAbortHandler = () => {\r\n      abortSignal?.removeEventListener(\"abort\", abortHandler);\r\n    };\r\n\r\n    const settleResolve = (exitCode: number) => {\r\n      if (settled) return;\r\n      settled = true;\r\n      if (timeoutId) clearTimeout(timeoutId);\r\n      clearAbortHandler();\r\n      resolve({ stdout, stderr, exitCode });\r\n    };\r\n\r\n    const settleReject = (error: Error) => {\r\n      if (settled) return;\r\n      settled = true;\r\n      if (timeoutId) clearTimeout(timeoutId);\r\n      clearAbortHandler();\r\n      reject(error);\r\n    };\r\n\r\n    proc.stdout?.on(\"data\", (data: Buffer) => {\r\n      stdout += data.toString();\r\n    });\r\n\r\n    proc.stderr?.on(\"data\", (data: Buffer) => {\r\n      stderr += data.toString();\r\n    });\r\n\r\n    abortSignal?.addEventListener(\"abort\", abortHandler);\r\n\r\n    if (timeoutMs && timeoutMs > 0) {\r\n      timeoutId = setTimeout(() => {\r\n        proc.kill(\"SIGTERM\");\r\n        settleReject(new Error(`devcontainer exec timed out after ${timeoutMs}ms`));\r\n      }, timeoutMs);\r\n    }\r\n\r\n    proc.on(\"error\", (err) => {\r\n      settleReject(new Error(`devcontainer exec failed: ${getErrorMessage(err)}`));\r\n    });\r\n\r\n    proc.on(\"close\", (code) => {\r\n      settleResolve(code ?? -1);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Get the container ID for a devcontainer workspace.\r\n * Returns null if no container exists.\r\n */\r\nexport async function getDevcontainerContainerId(\r\n  workspaceFolder: string,\r\n  _configPath?: string,\r\n  timeoutMs = 10_000\r\n): Promise<string | null> {\r\n  // The devcontainer CLI labels containers with the workspace folder path\r\n  // We can use `devcontainer read-configuration` or docker labels to find it\r\n  // For now, use docker ps with label filter\r\n  const labelValue = workspaceFolder;\r\n\r\n  return new Promise((resolve) => {\r\n    const proc = spawn(\r\n      \"docker\",\r\n      [\"ps\", \"-q\", \"--filter\", `label=devcontainer.local_folder=${labelValue}`],\r\n      {\r\n        stdio: [\"ignore\", \"pipe\", \"pipe\"],\r\n        timeout: timeoutMs,\r\n      }\r\n    );\r\n\r\n    let stdout = \"\";\r\n    proc.stdout?.on(\"data\", (data: Buffer) => {\r\n      stdout += data.toString();\r\n    });\r\n\r\n    proc.on(\"error\", () => {\r\n      resolve(null);\r\n    });\r\n\r\n    proc.on(\"close\", (code) => {\r\n      if (code === 0 && stdout.trim()) {\r\n        // Return first container ID (there should only be one)\r\n        resolve(stdout.trim().split(\"\\n\")[0]);\r\n      } else {\r\n        resolve(null);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Get the container name for a devcontainer workspace.\r\n * Returns null if no container exists.\r\n *\r\n * Note: VS Code devcontainer deep links require the container NAME (not ID).\r\n * The devcontainer CLI only returns container ID, so we query Docker directly.\r\n */\r\nexport async function getDevcontainerContainerName(\r\n  workspaceFolder: string,\r\n  timeoutMs = 10_000\r\n): Promise<string | null> {\r\n  // The devcontainer CLI labels containers with the workspace folder path\r\n  const labelValue = workspaceFolder;\r\n\r\n  return new Promise((resolve) => {\r\n    const proc = spawn(\r\n      \"docker\",\r\n      [\"ps\", \"--format\", \"{{.Names}}\", \"--filter\", `label=devcontainer.local_folder=${labelValue}`],\r\n      {\r\n        stdio: [\"ignore\", \"pipe\", \"pipe\"],\r\n        timeout: timeoutMs,\r\n      }\r\n    );\r\n\r\n    let stdout = \"\";\r\n    proc.stdout?.on(\"data\", (data: Buffer) => {\r\n      stdout += data.toString();\r\n    });\r\n\r\n    proc.on(\"error\", () => {\r\n      resolve(null);\r\n    });\r\n\r\n    proc.on(\"close\", (code) => {\r\n      if (code === 0 && stdout.trim()) {\r\n        // Return first container name (there should only be one)\r\n        resolve(stdout.trim().split(\"\\n\")[0]);\r\n      } else {\r\n        resolve(null);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Stop and remove the devcontainer (best-effort cleanup).\r\n * Does not throw on failure - container may not exist.\r\n *\r\n * Note: `devcontainer down` is not yet implemented in the CLI (as of v0.81.1),\r\n * so we use docker commands directly with the container label.\r\n */\r\nexport async function devcontainerDown(\r\n  workspaceFolder: string,\r\n  _configPath?: string,\r\n  timeoutMs = 60_000\r\n): Promise<void> {\r\n  const containerId = await getDevcontainerContainerId(workspaceFolder);\r\n  if (!containerId) {\r\n    // No container to stop\r\n    return;\r\n  }\r\n\r\n  return new Promise((resolve) => {\r\n    // Stop and remove the container\r\n    const proc = spawn(\"docker\", [\"rm\", \"-f\", containerId], {\r\n      stdio: [\"ignore\", \"pipe\", \"pipe\"],\r\n      timeout: timeoutMs,\r\n    });\r\n\r\n    proc.on(\"error\", () => {\r\n      // Best-effort - don't fail if can't run\r\n      resolve();\r\n    });\r\n\r\n    proc.on(\"close\", () => {\r\n      resolve();\r\n    });\r\n  });\r\n}\r\n"]}