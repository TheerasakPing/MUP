{"version":3,"file":"devcontainerCli.js","sourceRoot":"","sources":["../../../src/node/runtime/devcontainerCli.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Devcontainer CLI helper - wraps `devcontainer` CLI commands.\n *\n * This module provides async functions for devcontainer operations:\n * - checkVersion: verify CLI is installed and get version\n * - up: build/start container with streaming logs\n * - exec: execute commands inside the container\n * - down: stop and remove the container\n */\nimport { spawn } from \"child_process\";\nimport type { InitLogger } from \"./Runtime\";\nimport { LineBuffer } from \"./initHook\";\nimport { getErrorMessage } from \"@/common/utils/errors\";\nimport { log } from \"@/node/services/log\";\n\ntype DevcontainerUpOutcome = \"success\" | \"error\";\n\nexport interface DevcontainerUpResultLine {\n  outcome: DevcontainerUpOutcome;\n  containerId?: string;\n  remoteUser?: string;\n  remoteWorkspaceFolder?: string;\n  message?: string;\n  description?: string;\n}\n\nexport type DevcontainerStdoutParse =\n  | { kind: \"result\"; result: DevcontainerUpResultLine }\n  | { kind: \"log\"; text: string }\n  | { kind: \"raw\"; text: string };\n\nfunction isRecord(value: unknown): value is Record<string, unknown> {\n  return typeof value === \"object\" && value !== null;\n}\n\nfunction isDevcontainerUpOutcome(value: unknown): value is DevcontainerUpOutcome {\n  return value === \"success\" || value === \"error\";\n}\n\nfunction isDevcontainerUpResult(value: unknown): value is DevcontainerUpResultLine {\n  if (!isRecord(value)) return false;\n  return isDevcontainerUpOutcome(value.outcome);\n}\n\nfunction extractDevcontainerLogText(value: Record<string, unknown>): string | null {\n  const text = typeof value.text === \"string\" ? value.text : undefined;\n  if (text) {\n    const level = typeof value.level === \"number\" ? value.level : 0;\n    const channel = typeof value.channel === \"string\" ? value.channel : \"\";\n    const type = typeof value.type === \"string\" ? value.type : \"\";\n    const isError = channel === \"error\" || type === \"error\";\n    if (level >= 2 || isError) {\n      return text;\n    }\n    return null;\n  }\n\n  const name = typeof value.name === \"string\" ? value.name : undefined;\n  if (name) {\n    return name;\n  }\n\n  return null;\n}\n\nfunction parseJsonLine(line: string): unknown {\n  try {\n    return JSON.parse(line) as unknown;\n  } catch {\n    return null;\n  }\n}\n\nexport function parseDevcontainerStdoutLine(line: string): DevcontainerStdoutParse | null {\n  const trimmed = line.trim();\n  if (!trimmed) return null;\n  if (!trimmed.startsWith(\"{\")) {\n    return { kind: \"raw\", text: line };\n  }\n\n  const parsed = parseJsonLine(trimmed);\n  if (!parsed) {\n    return { kind: \"raw\", text: line };\n  }\n\n  if (isDevcontainerUpResult(parsed)) {\n    return { kind: \"result\", result: parsed };\n  }\n\n  if (isRecord(parsed)) {\n    const text = extractDevcontainerLogText(parsed);\n    if (text) {\n      return { kind: \"log\", text };\n    }\n  }\n\n  return null;\n}\n\nexport function formatDevcontainerUpError(\n  result: DevcontainerUpResultLine,\n  stderrSummary?: string\n): string {\n  const messageParts = [result.message, result.description].filter(\n    (value): value is string => typeof value === \"string\" && value.trim().length > 0\n  );\n  if (messageParts.length > 0) {\n    return `devcontainer up failed: ${messageParts.join(\" - \")}`;\n  }\n\n  if (stderrSummary && stderrSummary.trim().length > 0) {\n    return `devcontainer up failed: ${stderrSummary.trim()}`;\n  }\n\n  return \"devcontainer up failed\";\n}\n\nexport function shouldCleanupDevcontainer(result: DevcontainerUpResultLine): boolean {\n  return (\n    result.outcome === \"error\" &&\n    typeof result.containerId === \"string\" &&\n    result.containerId.trim().length > 0\n  );\n}\n/** Output from `devcontainer up` command */\nexport interface DevcontainerUpResult {\n  containerId: string;\n  remoteUser: string;\n  remoteWorkspaceFolder: string;\n}\n\n/** Devcontainer CLI availability info */\nexport interface DevcontainerCliInfo {\n  available: true;\n  version: string;\n}\n\n/** devcontainer up options */\nexport interface DevcontainerUpOptions {\n  workspaceFolder: string;\n  configPath?: string;\n  initLogger: InitLogger;\n  abortSignal?: AbortSignal;\n  /** Additional mount flags (for credential sharing) */\n  additionalMounts?: string[];\n  /** Additional remote env vars */\n  remoteEnv?: Record<string, string>;\n  /** Timeout in milliseconds (default: 30 minutes) */\n  timeoutMs?: number;\n}\n\n/** devcontainer exec options */\nexport interface DevcontainerExecOptions {\n  workspaceFolder: string;\n  configPath?: string;\n  command: string;\n  /** Working directory inside container */\n  cwd?: string;\n  /** Environment variables to pass */\n  env?: Record<string, string>;\n  abortSignal?: AbortSignal;\n  /** Timeout in milliseconds */\n  timeoutMs?: number;\n}\n\nconst SENSITIVE_REMOTE_ENV_KEYS = new Set([\n  \"GH_TOKEN\",\n  \"GITHUB_TOKEN\",\n  \"GH_ENTERPRISE_TOKEN\",\n  \"GITHUB_ENTERPRISE_TOKEN\",\n]);\n\nfunction redactRemoteEnvArgs(args: string[]): string[] {\n  const redacted = [...args];\n  for (let i = 0; i < redacted.length - 1; i += 1) {\n    if (redacted[i] !== \"--remote-env\") continue;\n    const entry = redacted[i + 1] ?? \"\";\n    const [key] = entry.split(\"=\");\n    if (SENSITIVE_REMOTE_ENV_KEYS.has(key)) {\n      redacted[i + 1] = `${key}=<redacted>`;\n    }\n  }\n  return redacted;\n}\nconst DEFAULT_UP_TIMEOUT_MS = 30 * 60 * 1000; // 30 minutes\nconst MAX_STDERR_BUFFER_LENGTH = 8_000; // 8KB cap for error summaries\nconst DEFAULT_CLEANUP_TIMEOUT_MS = 60_000; // 1 minute\n\nasync function removeDevcontainerContainer(containerId: string): Promise<void> {\n  await new Promise<void>((resolve) => {\n    const proc = spawn(\"docker\", [\"rm\", \"-f\", containerId], {\n      stdio: [\"ignore\", \"pipe\", \"pipe\"],\n      timeout: DEFAULT_CLEANUP_TIMEOUT_MS,\n    });\n\n    proc.on(\"error\", () => {\n      resolve();\n    });\n\n    proc.on(\"close\", () => {\n      resolve();\n    });\n  });\n}\nconst VERSION_CHECK_TIMEOUT_MS = 10_000; // 10 seconds\n\n/**\n * Check if devcontainer CLI is installed and get version.\n */\nexport async function checkDevcontainerCliVersion(): Promise<DevcontainerCliInfo | null> {\n  return new Promise((resolve) => {\n    const proc = spawn(\"devcontainer\", [\"--version\"], {\n      stdio: [\"ignore\", \"pipe\", \"pipe\"],\n      timeout: VERSION_CHECK_TIMEOUT_MS,\n    });\n\n    let stdout = \"\";\n    proc.stdout?.on(\"data\", (data: Buffer) => {\n      stdout += data.toString();\n    });\n\n    proc.on(\"error\", () => {\n      resolve(null);\n    });\n\n    proc.on(\"close\", (code) => {\n      if (code === 0 && stdout.trim()) {\n        resolve({ available: true, version: stdout.trim() });\n      } else {\n        resolve(null);\n      }\n    });\n  });\n}\n\n/**\n * Run `devcontainer up` with streaming logs.\n * Parses the JSON output to extract container info.\n */\nexport async function devcontainerUp(\n  options: DevcontainerUpOptions\n): Promise<DevcontainerUpResult> {\n  const {\n    workspaceFolder,\n    configPath,\n    initLogger,\n    abortSignal,\n    additionalMounts,\n    remoteEnv,\n    timeoutMs = DEFAULT_UP_TIMEOUT_MS,\n  } = options;\n\n  const baseArgs = [\"up\", \"--log-format\", \"json\", \"--workspace-folder\", workspaceFolder];\n\n  if (configPath) {\n    baseArgs.push(\"--config\", configPath);\n  }\n\n  // Add mounts for credential sharing\n  if (additionalMounts) {\n    for (const mount of additionalMounts) {\n      baseArgs.push(\"--mount\", mount);\n    }\n  }\n\n  // Add remote env vars\n  if (remoteEnv) {\n    for (const [key, value] of Object.entries(remoteEnv)) {\n      baseArgs.push(\"--remote-env\", `${key}=${value}`);\n    }\n  }\n\n  const runUp = (args: string[]): Promise<DevcontainerUpResult> => {\n    const logArgs = redactRemoteEnvArgs(args);\n    initLogger.logStep(`Running: devcontainer ${logArgs.join(\" \")}`);\n\n    return new Promise((resolve, reject) => {\n      const proc = spawn(\"devcontainer\", args, {\n        stdio: [\"ignore\", \"pipe\", \"pipe\"],\n        timeout: timeoutMs,\n        cwd: workspaceFolder,\n      });\n\n      let settled = false;\n      let lastResultLine: DevcontainerUpResultLine | null = null;\n      let stderrBuffer = \"\";\n      let timeoutId: ReturnType<typeof setTimeout> | undefined;\n\n      const settleSuccess = (result: DevcontainerUpResult) => {\n        if (settled) return;\n        settled = true;\n        if (timeoutId) clearTimeout(timeoutId);\n        resolve(result);\n      };\n\n      const appendStderrSummary = (text: string) => {\n        if (stderrBuffer.length >= MAX_STDERR_BUFFER_LENGTH) return;\n        const next = `${text}\\n`;\n        stderrBuffer = (stderrBuffer + next).slice(0, MAX_STDERR_BUFFER_LENGTH);\n      };\n      const settleError = (error: Error) => {\n        if (settled) return;\n        settled = true;\n        if (timeoutId) clearTimeout(timeoutId);\n        reject(error);\n      };\n\n      const stdoutLineBuffer = new LineBuffer((line) => {\n        const parsed = parseDevcontainerStdoutLine(line);\n        if (!parsed) return;\n        if (parsed.kind === \"result\") {\n          lastResultLine = parsed.result;\n          return;\n        }\n        if (parsed.kind === \"log\") {\n          initLogger.logStdout(parsed.text);\n          return;\n        }\n        initLogger.logStdout(parsed.text);\n      });\n\n      const stderrLineBuffer = new LineBuffer((line) => {\n        const parsed = parseDevcontainerStdoutLine(line);\n        if (parsed?.kind === \"result\") {\n          lastResultLine ??= parsed.result;\n          return;\n        }\n        const summaryText = parsed ? parsed.text : line;\n        appendStderrSummary(summaryText);\n        if (!parsed) return;\n        initLogger.logStdout(parsed.text);\n      });\n\n      proc.stdout?.on(\"data\", (data: Buffer) => {\n        stdoutLineBuffer.append(data.toString());\n      });\n\n      proc.stderr?.on(\"data\", (data: Buffer) => {\n        stderrLineBuffer.append(data.toString());\n      });\n\n      const abortHandler = () => {\n        proc.kill(\"SIGTERM\");\n        settleError(new Error(\"devcontainer up aborted\"));\n      };\n\n      if (timeoutMs && timeoutMs > 0) {\n        timeoutId = setTimeout(() => {\n          proc.kill(\"SIGTERM\");\n          settleError(new Error(`devcontainer up timed out after ${timeoutMs}ms`));\n        }, timeoutMs);\n      }\n      abortSignal?.addEventListener(\"abort\", abortHandler);\n\n      const finalizeError = async (message: string, result?: DevcontainerUpResultLine | null) => {\n        if (result && shouldCleanupDevcontainer(result)) {\n          try {\n            await removeDevcontainerContainer(result.containerId ?? \"\");\n          } catch (cleanupError) {\n            log.debug(\"Failed to remove devcontainer container\", {\n              cleanupError,\n              containerId: result.containerId,\n            });\n          }\n        }\n        settleError(new Error(message));\n      };\n\n      proc.on(\"error\", (err) => {\n        abortSignal?.removeEventListener(\"abort\", abortHandler);\n        stdoutLineBuffer.flush();\n        stderrLineBuffer.flush();\n        settleError(new Error(`devcontainer up failed: ${getErrorMessage(err)}`));\n      });\n\n      proc.on(\"close\", (code) => {\n        const handleClose = async () => {\n          abortSignal?.removeEventListener(\"abort\", abortHandler);\n          stdoutLineBuffer.flush();\n          stderrLineBuffer.flush();\n\n          if (settled) return;\n\n          const stderrSummary = stderrBuffer.trim();\n\n          if (lastResultLine) {\n            if (lastResultLine.outcome === \"success\") {\n              if (\n                !lastResultLine.containerId ||\n                !lastResultLine.remoteUser ||\n                !lastResultLine.remoteWorkspaceFolder\n              ) {\n                await finalizeError(\n                  \"devcontainer up output missing required fields\",\n                  lastResultLine\n                );\n                return;\n              }\n\n              settleSuccess({\n                containerId: lastResultLine.containerId,\n                remoteUser: lastResultLine.remoteUser,\n                remoteWorkspaceFolder: lastResultLine.remoteWorkspaceFolder,\n              });\n              return;\n            }\n\n            await finalizeError(\n              formatDevcontainerUpError(lastResultLine, stderrSummary),\n              lastResultLine\n            );\n            return;\n          }\n\n          if (code !== 0) {\n            const suffix = stderrSummary.length > 0 ? `: ${stderrSummary}` : \"\";\n            settleError(new Error(`devcontainer up exited with code ${String(code)}${suffix}`));\n            return;\n          }\n\n          const suffix = stderrSummary.length > 0 ? `: ${stderrSummary}` : \"\";\n          settleError(new Error(`devcontainer up did not produce result output${suffix}`));\n        };\n\n        void handleClose();\n      });\n    });\n  };\n\n  return runUp(baseArgs);\n}\n\n/**\n * Execute a command inside the devcontainer.\n * Returns stdout as a string.\n */\nexport async function devcontainerExec(\n  options: DevcontainerExecOptions\n): Promise<{ stdout: string; stderr: string; exitCode: number }> {\n  const { workspaceFolder, configPath, command, cwd, env, abortSignal, timeoutMs } = options;\n\n  const args = [\"exec\", \"--workspace-folder\", workspaceFolder];\n\n  if (configPath) {\n    args.push(\"--config\", configPath);\n  }\n\n  // Add environment variables\n  if (env) {\n    for (const [key, value] of Object.entries(env)) {\n      args.push(\"--remote-env\", `${key}=${value}`);\n    }\n  }\n\n  // Build the command with cd if cwd specified\n  let fullCommand = command;\n  if (cwd) {\n    // Use bash -c to handle cd + command\n    fullCommand = `cd ${JSON.stringify(cwd)} && ${command}`;\n  }\n\n  // The command goes after --\n  args.push(\"--\", \"bash\", \"-c\", fullCommand);\n\n  return new Promise((resolve, reject) => {\n    const proc = spawn(\"devcontainer\", args, {\n      stdio: [\"ignore\", \"pipe\", \"pipe\"],\n      timeout: timeoutMs,\n      cwd: workspaceFolder,\n    });\n\n    let stdout = \"\";\n    let stderr = \"\";\n    let settled = false;\n    let timeoutId: ReturnType<typeof setTimeout> | undefined;\n\n    const abortHandler = () => {\n      proc.kill(\"SIGTERM\");\n      settleReject(new Error(\"devcontainer exec aborted\"));\n    };\n\n    const clearAbortHandler = () => {\n      abortSignal?.removeEventListener(\"abort\", abortHandler);\n    };\n\n    const settleResolve = (exitCode: number) => {\n      if (settled) return;\n      settled = true;\n      if (timeoutId) clearTimeout(timeoutId);\n      clearAbortHandler();\n      resolve({ stdout, stderr, exitCode });\n    };\n\n    const settleReject = (error: Error) => {\n      if (settled) return;\n      settled = true;\n      if (timeoutId) clearTimeout(timeoutId);\n      clearAbortHandler();\n      reject(error);\n    };\n\n    proc.stdout?.on(\"data\", (data: Buffer) => {\n      stdout += data.toString();\n    });\n\n    proc.stderr?.on(\"data\", (data: Buffer) => {\n      stderr += data.toString();\n    });\n\n    abortSignal?.addEventListener(\"abort\", abortHandler);\n\n    if (timeoutMs && timeoutMs > 0) {\n      timeoutId = setTimeout(() => {\n        proc.kill(\"SIGTERM\");\n        settleReject(new Error(`devcontainer exec timed out after ${timeoutMs}ms`));\n      }, timeoutMs);\n    }\n\n    proc.on(\"error\", (err) => {\n      settleReject(new Error(`devcontainer exec failed: ${getErrorMessage(err)}`));\n    });\n\n    proc.on(\"close\", (code) => {\n      settleResolve(code ?? -1);\n    });\n  });\n}\n\n/**\n * Get the container ID for a devcontainer workspace.\n * Returns null if no container exists.\n */\nexport async function getDevcontainerContainerId(\n  workspaceFolder: string,\n  _configPath?: string,\n  timeoutMs = 10_000\n): Promise<string | null> {\n  // The devcontainer CLI labels containers with the workspace folder path\n  // We can use `devcontainer read-configuration` or docker labels to find it\n  // For now, use docker ps with label filter\n  const labelValue = workspaceFolder;\n\n  return new Promise((resolve) => {\n    const proc = spawn(\n      \"docker\",\n      [\"ps\", \"-q\", \"--filter\", `label=devcontainer.local_folder=${labelValue}`],\n      {\n        stdio: [\"ignore\", \"pipe\", \"pipe\"],\n        timeout: timeoutMs,\n      }\n    );\n\n    let stdout = \"\";\n    proc.stdout?.on(\"data\", (data: Buffer) => {\n      stdout += data.toString();\n    });\n\n    proc.on(\"error\", () => {\n      resolve(null);\n    });\n\n    proc.on(\"close\", (code) => {\n      if (code === 0 && stdout.trim()) {\n        // Return first container ID (there should only be one)\n        resolve(stdout.trim().split(\"\\n\")[0]);\n      } else {\n        resolve(null);\n      }\n    });\n  });\n}\n\n/**\n * Get the container name for a devcontainer workspace.\n * Returns null if no container exists.\n *\n * Note: VS Code devcontainer deep links require the container NAME (not ID).\n * The devcontainer CLI only returns container ID, so we query Docker directly.\n */\nexport async function getDevcontainerContainerName(\n  workspaceFolder: string,\n  timeoutMs = 10_000\n): Promise<string | null> {\n  // The devcontainer CLI labels containers with the workspace folder path\n  const labelValue = workspaceFolder;\n\n  return new Promise((resolve) => {\n    const proc = spawn(\n      \"docker\",\n      [\"ps\", \"--format\", \"{{.Names}}\", \"--filter\", `label=devcontainer.local_folder=${labelValue}`],\n      {\n        stdio: [\"ignore\", \"pipe\", \"pipe\"],\n        timeout: timeoutMs,\n      }\n    );\n\n    let stdout = \"\";\n    proc.stdout?.on(\"data\", (data: Buffer) => {\n      stdout += data.toString();\n    });\n\n    proc.on(\"error\", () => {\n      resolve(null);\n    });\n\n    proc.on(\"close\", (code) => {\n      if (code === 0 && stdout.trim()) {\n        // Return first container name (there should only be one)\n        resolve(stdout.trim().split(\"\\n\")[0]);\n      } else {\n        resolve(null);\n      }\n    });\n  });\n}\n\n/**\n * Stop and remove the devcontainer (best-effort cleanup).\n * Does not throw on failure - container may not exist.\n *\n * Note: `devcontainer down` is not yet implemented in the CLI (as of v0.81.1),\n * so we use docker commands directly with the container label.\n */\nexport async function devcontainerDown(\n  workspaceFolder: string,\n  _configPath?: string,\n  timeoutMs = 60_000\n): Promise<void> {\n  const containerId = await getDevcontainerContainerId(workspaceFolder);\n  if (!containerId) {\n    // No container to stop\n    return;\n  }\n\n  return new Promise((resolve) => {\n    // Stop and remove the container\n    const proc = spawn(\"docker\", [\"rm\", \"-f\", containerId], {\n      stdio: [\"ignore\", \"pipe\", \"pipe\"],\n      timeout: timeoutMs,\n    });\n\n    proc.on(\"error\", () => {\n      // Best-effort - don't fail if can't run\n      resolve();\n    });\n\n    proc.on(\"close\", () => {\n      resolve();\n    });\n  });\n}\n"]}