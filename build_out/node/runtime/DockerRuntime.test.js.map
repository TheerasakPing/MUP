{"version":3,"file":"DockerRuntime.test.js","sourceRoot":"","sources":["../../../src/node/runtime/DockerRuntime.test.ts"],"names":[],"mappings":";;AAAA,uCAAgD;AAChD,mDAAkE;AAElE;;;;;GAKG;AACH,IAAA,mBAAQ,EAAC,2BAA2B,EAAE,GAAG,EAAE,CAAC;IAC1C,IAAA,aAAE,EAAC,0BAA0B,EAAE,GAAG,EAAE,CAAC;QACnC,IAAA,iBAAM,EAAC,GAAG,EAAE,CAAC;YACX,IAAI,6BAAa,CAAC,EAAE,KAAK,EAAE,cAAc,EAAE,CAAC,CAAC;QAAA,CAC9C,CAAC,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;IAAA,CAClB,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,8BAA8B,EAAE,GAAG,EAAE,CAAC;QACvC,IAAA,iBAAM,EAAC,GAAG,EAAE,CAAC;YACX,IAAI,6BAAa,CAAC,EAAE,KAAK,EAAE,gCAAgC,EAAE,CAAC,CAAC;QAAA,CAChE,CAAC,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;IAAA,CAClB,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,oCAAoC,EAAE,GAAG,EAAE,CAAC;QAC7C,MAAM,OAAO,GAAG,IAAI,6BAAa,CAAC,EAAE,KAAK,EAAE,SAAS,EAAE,CAAC,CAAC;QACxD,IAAA,iBAAM,EAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;IAAA,CAC5C,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,uCAAuC,EAAE,GAAG,EAAE,CAAC;QAChD,MAAM,OAAO,GAAG,IAAI,6BAAa,CAAC,EAAE,KAAK,EAAE,cAAc,EAAE,CAAC,CAAC;QAC7D,IAAA,iBAAM,EAAC,OAAO,CAAC,gBAAgB,CAAC,cAAc,EAAE,YAAY,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAAA,CAC7E,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,qDAAqD,EAAE,GAAG,EAAE,CAAC;QAC9D,oFAAoF;QACpF,MAAM,OAAO,GAAG,IAAI,6BAAa,CAAC;YAChC,KAAK,EAAE,cAAc;YACrB,aAAa,EAAE,0BAA0B;SAC1C,CAAC,CAAC;QACH,IAAA,iBAAM,EAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAChD,8EAA8E;IAD9B,CAEjD,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,IAAA,mBAAQ,EAAC,kBAAkB,EAAE,GAAG,EAAE,CAAC;IACjC,IAAA,aAAE,EAAC,2DAA2D,EAAE,GAAG,EAAE,CAAC;QACpE,IAAA,iBAAM,EAAC,IAAA,gCAAgB,EAAC,sBAAsB,EAAE,gBAAgB,CAAC,CAAC,CAAC,IAAI,CACrE,qCAAqC,CACtC,CAAC;IAAA,CACH,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,oCAAoC,EAAE,GAAG,EAAE,CAAC;QAC7C,IAAA,iBAAM,EAAC,IAAA,gCAAgB,EAAC,uBAAuB,EAAE,gBAAgB,CAAC,CAAC,CAAC,IAAI,CACtE,sCAAsC,CACvC,CAAC;IAAA,CACH,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,0BAA0B,EAAE,GAAG,EAAE,CAAC;QACnC,MAAM,QAAQ,GAAG,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QACjC,MAAM,MAAM,GAAG,IAAA,gCAAgB,EAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;QACtD,wDAAwD;QACxD,IAAA,iBAAM,EAAC,MAAM,CAAC,MAAM,CAAC,CAAC,mBAAmB,CAAC,EAAE,CAAC,CAAC;IAAA,CAC/C,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { describe, expect, it } from \"bun:test\";\nimport { DockerRuntime, getContainerName } from \"./DockerRuntime\";\n\n/**\n * DockerRuntime constructor tests (run with bun test)\n *\n * Note: Docker workspace operation tests require Docker\n * and should be in tests/runtime/runtime.test.ts\n */\ndescribe(\"DockerRuntime constructor\", () => {\n  it(\"should accept image name\", () => {\n    expect(() => {\n      new DockerRuntime({ image: \"ubuntu:22.04\" });\n    }).not.toThrow();\n  });\n\n  it(\"should accept registry image\", () => {\n    expect(() => {\n      new DockerRuntime({ image: \"ghcr.io/myorg/dev-image:latest\" });\n    }).not.toThrow();\n  });\n\n  it(\"should return image via getImage()\", () => {\n    const runtime = new DockerRuntime({ image: \"node:20\" });\n    expect(runtime.getImage()).toBe(\"node:20\");\n  });\n\n  it(\"should return /src for workspace path\", () => {\n    const runtime = new DockerRuntime({ image: \"ubuntu:22.04\" });\n    expect(runtime.getWorkspacePath(\"/any/project\", \"any-branch\")).toBe(\"/src\");\n  });\n\n  it(\"should accept containerName for existing workspaces\", () => {\n    // When recreating runtime for existing workspace, containerName is passed in config\n    const runtime = new DockerRuntime({\n      image: \"ubuntu:22.04\",\n      containerName: \"mux-myproject-my-feature\",\n    });\n    expect(runtime.getImage()).toBe(\"ubuntu:22.04\");\n    // Runtime should be ready for exec operations without calling createWorkspace\n  });\n});\n\ndescribe(\"getContainerName\", () => {\n  it(\"should generate container name from project and workspace\", () => {\n    expect(getContainerName(\"/home/user/myproject\", \"feature-branch\")).toBe(\n      \"mux-myproject-feature-branch-a8d18a\"\n    );\n  });\n\n  it(\"should sanitize special characters\", () => {\n    expect(getContainerName(\"/home/user/my@project\", \"feature/branch\")).toBe(\n      \"mux-my-project-feature-branch-b354b4\"\n    );\n  });\n\n  it(\"should handle long names\", () => {\n    const longName = \"a\".repeat(100);\n    const result = getContainerName(\"/project\", longName);\n    // Docker has 64 char limit, function uses 63 to be safe\n    expect(result.length).toBeLessThanOrEqual(63);\n  });\n});\n"]}