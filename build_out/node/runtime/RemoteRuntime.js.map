{"version":3,"file":"RemoteRuntime.js","sourceRoot":"","sources":["../../../src/node/runtime/RemoteRuntime.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;;GAcG;;;AAGH,mCAAkC;AAclC,uCAAyC;AACzC,4DAAoF;AACpF,6CAA0C;AAC1C,4DAAqE;AACrE,gDAAkE;AAClE,gEAAgE;AAChE,+CAAyD;AAYzD;;GAEG;AACH;IAgCE;;;;OAIG;IACO,UAAU,CAAC,SAAiB,EAAE,QAAqB,EAAE,OAAe,EAAQ;QACpF,8DAA8D;IADuB,CAEtF;IAOD;;;OAGG;IACH,KAAK,CAAC,IAAI,CAAC,OAAe,EAAE,OAAoB,EAAuB;QACrE,MAAM,SAAS,GAAG,WAAW,CAAC,GAAG,EAAE,CAAC;QAEpC,mCAAmC;QACnC,IAAI,OAAO,CAAC,WAAW,EAAE,OAAO,EAAE,CAAC;YACjC,MAAM,IAAI,sBAAY,CAAC,oCAAoC,EAAE,MAAM,CAAC,CAAC;QACvE,CAAC;QAED,sBAAsB;QACtB,MAAM,KAAK,GAAa,EAAE,CAAC;QAE3B,iBAAiB;QACjB,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC;QAExC,oFAAoF;QACpF,MAAM,OAAO,GAAG,EAAE,GAAG,OAAO,CAAC,GAAG,EAAE,GAAG,8BAAwB,EAAE,CAAC;QAChE,KAAK,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC;YACnD,KAAK,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,sBAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;QACvD,CAAC;QAED,yBAAyB;QACzB,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAEpB,wEAAwE;QACxE,IAAI,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAErC,6CAA6C;QAC7C,WAAW,GAAG,WAAW,sBAAQ,CAAC,KAAK,CAAC,WAAW,CAAC,EAAE,CAAC;QAEvD,+BAA+B;QAC/B,IAAI,OAAO,CAAC,OAAO,KAAK,SAAS,EAAE,CAAC;YAClC,MAAM,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;YACrD,WAAW,GAAG,mBAAmB,aAAa,IAAI,WAAW,EAAE,CAAC;QAClE,CAAC;QAED,2CAA2C;QAC3C,+DAA+D;QAC/D,MAAM,EAAE,OAAO,EAAE,YAAY,EAAE,GAAG,MAAM,IAAI,CAAC,kBAAkB,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;QAEtF,qEAAqE;QACrE,IAAI,YAAY,CAAC,KAAK,EAAE,CAAC;YACvB,IAAA,uCAAwB,EAAC,YAAY,CAAC,KAAK,EAAE,GAAG,IAAI,CAAC,aAAa,QAAQ,EAAE;gBAC1E,MAAM,EAAE,SAAG;aACZ,CAAC,CAAC;QACL,CAAC;QAED,wCAAwC;QACxC,MAAM,UAAU,GAAG,IAAI,kCAAiB,CAAC,YAAY,CAAC,CAAC;QAEvD,yDAAyD;QACzD,IAAI,QAAQ,GAAG,KAAK,CAAC;QACrB,IAAI,OAAO,GAAG,KAAK,CAAC;QAEpB,kEAAkE;QAClE,iEAAiE;QACjE,kDAAkD;QAClD,IAAI,uBAAuB,GAAG,EAAE,CAAC;QAEjC,0DAA0D;QAC1D,MAAM,QAAQ,GAAG,IAAI,OAAO,CAAS,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE,CAAC;YACxD,YAAY,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,EAAE,CAAC;gBACzC,IAAI,OAAO,IAAI,OAAO,CAAC,WAAW,EAAE,OAAO,EAAE,CAAC;oBAC5C,OAAO,CAAC,6BAAiB,CAAC,CAAC;oBAC3B,OAAO;gBACT,CAAC;gBACD,IAAI,QAAQ,EAAE,CAAC;oBACb,OAAO,CAAC,6BAAiB,CAAC,CAAC;oBAC3B,OAAO;gBACT,CAAC;gBACD,MAAM,aAAa,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBAEhD,4DAA4D;gBAC5D,IAAI,CAAC,UAAU,CAAC,aAAa,EAAE,OAAO,EAAE,uBAAuB,CAAC,CAAC;gBAEjE,OAAO,CAAC,aAAa,CAAC,CAAC;YAAA,CACxB,CAAC,CAAC;YAEH,YAAY,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC;gBAChC,MAAM,CACJ,IAAI,sBAAY,CACd,qBAAqB,IAAI,CAAC,aAAa,aAAa,GAAG,CAAC,OAAO,EAAE,EACjE,MAAM,EACN,GAAG,CACJ,CACF,CAAC;YAAA,CACH,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,MAAM,QAAQ,GAAG,QAAQ,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,WAAW,CAAC,GAAG,EAAE,GAAG,SAAS,CAAC,CAAC;QAEpE,sBAAsB;QACtB,IAAI,OAAO,CAAC,WAAW,EAAE,CAAC;YACxB,MAAM,WAAW,GAAG,OAAO,CAAC,WAAW,CAAC;YACxC,MAAM,OAAO,GAAG,GAAG,EAAE,CAAC;gBACpB,OAAO,GAAG,IAAI,CAAC;gBAEf,oFAAoF;gBACpF,qFAAqF;gBACrF,8CAA8C;gBAC9C,EAAE;gBACF,oFAAoF;gBACpF,8CAA8C;gBAC9C,IAAI,CAAC;oBACH,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gBAC/B,CAAC;gBAAC,MAAM,CAAC;oBACP,SAAS;gBACX,CAAC;gBAED,MAAM,cAAc,GAAG,UAAU,CAAC,GAAG,EAAE,CAAC;oBACtC,MAAM,SAAS,GAAG,YAAY,CAAC,QAAQ,KAAK,IAAI,IAAI,YAAY,CAAC,UAAU,KAAK,IAAI,CAAC;oBACrF,IAAI,SAAS,EAAE,CAAC;wBACd,OAAO;oBACT,CAAC;oBACD,UAAU,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;gBAAA,CAC9B,EAAE,IAAI,CAAC,CAAC;gBACT,cAAc,CAAC,KAAK,EAAE,CAAC;YAAA,CACxB,CAAC;YAEF,WAAW,CAAC,gBAAgB,CAAC,OAAO,EAAE,OAAO,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;YAE/D,+EAA+E;YAC/E,KAAK,QAAQ,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,WAAW,CAAC,mBAAmB,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC,CAAC;QACjF,CAAC;QAED,iBAAiB;QACjB,IAAI,OAAO,CAAC,OAAO,KAAK,SAAS,EAAE,CAAC;YAClC,MAAM,aAAa,GAAG,UAAU,CAAC,GAAG,EAAE,CAAC;gBACrC,QAAQ,GAAG,IAAI,CAAC;gBAEhB,IAAI,CAAC;oBACH,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gBAC/B,CAAC;gBAAC,MAAM,CAAC;oBACP,SAAS;gBACX,CAAC;gBAED,MAAM,cAAc,GAAG,UAAU,CAAC,GAAG,EAAE,CAAC;oBACtC,MAAM,SAAS,GAAG,YAAY,CAAC,QAAQ,KAAK,IAAI,IAAI,YAAY,CAAC,UAAU,KAAK,IAAI,CAAC;oBACrF,IAAI,SAAS,EAAE,CAAC;wBACd,OAAO;oBACT,CAAC;oBACD,UAAU,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;gBAAA,CAC9B,EAAE,IAAI,CAAC,CAAC;gBACT,cAAc,CAAC,KAAK,EAAE,CAAC;YAAA,CACxB,EAAE,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC,CAAC;YAE3B,KAAK,QAAQ,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC,CAAC;QAC3D,CAAC;QAED,yCAAyC;QACzC,MAAM,MAAM,GAAG,iBAAQ,CAAC,KAAK,CAAC,YAAY,CAAC,MAAO,CAA0C,CAAC;QAC7F,MAAM,MAAM,GAAG,iBAAQ,CAAC,KAAK,CAAC,YAAY,CAAC,MAAO,CAA0C,CAAC;QAE7F,yEAAyE;QACzE,0FAA0F;QAC1F,YAAY,CAAC,MAAM,EAAE,EAAE,CAAC,MAAM,EAAE,CAAC,IAAY,EAAE,EAAE,CAAC;YAChD,uBAAuB,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;QAAA,CAC5C,CAAC,CAAC;QAEH,uFAAuF;QACvF,sFAAsF;QACtF,4DAA4D;QAC5D,EAAE;QACF,iDAAiD;QACjD,MAAM,KAAK,GAAG,IAAI,cAAc,CAAa;YAC3C,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,EAAE,CAAC;gBACtB,MAAM,SAAS,GAAG,YAAY,CAAC,KAAK,CAAC;gBACrC,IAAI,CAAC,SAAS,IAAI,SAAS,CAAC,SAAS,EAAE,CAAC;oBACtC,OAAO;gBACT,CAAC;gBAED,MAAM,IAAI,OAAO,CAAO,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE,CAAC;oBAC3C,MAAM,OAAO,GAAG,CAAC,GAAU,EAAE,EAAE,CAAC;wBAC9B,SAAS,CAAC,GAAG,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;wBAChC,MAAM,CAAC,GAAG,CAAC,CAAC;oBAAA,CACb,CAAC;oBACF,SAAS,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;oBAE/B,SAAS,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC;wBAC3C,SAAS,CAAC,GAAG,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;wBAChC,IAAI,GAAG,EAAE,CAAC;4BACR,MAAM,CAAC,GAAG,CAAC,CAAC;4BACZ,OAAO;wBACT,CAAC;wBACD,OAAO,EAAE,CAAC;oBAAA,CACX,CAAC,CAAC;gBAAA,CACJ,CAAC,CAAC;YAAA,CACJ;YACD,KAAK,EAAE,KAAK,IAAI,EAAE,CAAC;gBACjB,MAAM,SAAS,GAAG,YAAY,CAAC,KAAK,CAAC;gBACrC,IAAI,CAAC,SAAS,IAAI,SAAS,CAAC,SAAS,IAAI,SAAS,CAAC,aAAa,EAAE,CAAC;oBACjE,OAAO;gBACT,CAAC;gBAED,MAAM,IAAI,OAAO,CAAO,CAAC,OAAO,EAAE,EAAE,CAAC;oBACnC,MAAM,OAAO,GAAG,GAAG,EAAE,CAAC;wBACpB,OAAO,EAAE,CAAC;wBACV,OAAO,EAAE,CAAC;oBAAA,CACX,CAAC;oBAEF,MAAM,QAAQ,GAAG,GAAG,EAAE,CAAC;wBACrB,OAAO,EAAE,CAAC;wBACV,OAAO,EAAE,CAAC;oBAAA,CACX,CAAC;oBAEF,MAAM,OAAO,GAAG,GAAG,EAAE,CAAC;wBACpB,SAAS,CAAC,cAAc,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;wBAC3C,SAAS,CAAC,cAAc,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;oBAAA,CAC9C,CAAC;oBAEF,SAAS,CAAC,IAAI,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;oBACjC,SAAS,CAAC,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;oBAEnC,IAAI,CAAC;wBACH,SAAS,CAAC,GAAG,EAAE,CAAC;oBAClB,CAAC;oBAAC,MAAM,CAAC;wBACP,OAAO,EAAE,CAAC;oBACZ,CAAC;gBAAA,CACF,CAAC,CAAC;YAAA,CACJ;YACD,KAAK,EAAE,GAAG,EAAE,CAAC;gBACX,YAAY,CAAC,KAAK,EAAE,OAAO,EAAE,CAAC;YAAA,CAC/B;SACF,CAAC,CAAC;QAEH,SAAG,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,aAAa,aAAa,WAAW,EAAE,CAAC,CAAC;QAE3D,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC;IAAA,CACtD;IAED;;OAEG;IACH,QAAQ,CAAC,QAAgB,EAAE,WAAyB,EAA8B;QAChF,OAAO,IAAI,cAAc,CAAa;YACpC,KAAK,EAAE,KAAK,EAAE,UAAuD,EAAE,EAAE,CAAC;gBACxE,IAAI,CAAC;oBACH,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE,EAAE;wBACrE,GAAG,EAAE,IAAI,CAAC,WAAW,EAAE;wBACvB,OAAO,EAAE,GAAG;wBACZ,WAAW;qBACZ,CAAC,CAAC;oBAEH,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC;oBACzC,MAAM,eAAe,GAAG,MAAM,CAAC,QAAQ,CAAC;oBAExC,OAAO,IAAI,EAAE,CAAC;wBACZ,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,MAAM,CAAC,IAAI,EAAE,CAAC;wBAC5C,IAAI,IAAI;4BAAE,MAAM;wBAChB,UAAU,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;oBAC5B,CAAC;oBAED,MAAM,IAAI,GAAG,MAAM,eAAe,CAAC;oBACnC,IAAI,IAAI,KAAK,CAAC,EAAE,CAAC;wBACf,MAAM,MAAM,GAAG,MAAM,IAAA,4BAAc,EAAC,MAAM,CAAC,MAAM,CAAC,CAAC;wBACnD,MAAM,IAAI,sBAAY,CAAC,uBAAuB,QAAQ,KAAK,MAAM,EAAE,EAAE,SAAS,CAAC,CAAC;oBAClF,CAAC;oBAED,UAAU,CAAC,KAAK,EAAE,CAAC;gBACrB,CAAC;gBAAC,OAAO,GAAG,EAAE,CAAC;oBACb,IAAI,GAAG,YAAY,sBAAY,EAAE,CAAC;wBAChC,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBACxB,CAAC;yBAAM,CAAC;wBACN,UAAU,CAAC,KAAK,CACd,IAAI,sBAAY,CACd,uBAAuB,QAAQ,KAAK,GAAG,YAAY,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,EACtF,SAAS,EACT,GAAG,YAAY,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,SAAS,CACvC,CACF,CAAC;oBACJ,CAAC;gBACH,CAAC;YAAA,CACF;SACF,CAAC,CAAC;IAAA,CACJ;IAED;;;OAGG;IACH,SAAS,CAAC,QAAgB,EAAE,WAAyB,EAA8B;QACjF,MAAM,UAAU,GAAG,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QACjD,MAAM,QAAQ,GAAG,GAAG,QAAQ,QAAQ,IAAI,CAAC,GAAG,EAAE,EAAE,CAAC;QACjD,MAAM,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QAErD,uFAAuF;QACvF,MAAM,YAAY,GAAG,IAAI,CAAC,iBAAiB,CAAC,UAAU,EAAE,cAAc,CAAC,CAAC;QAExE,IAAI,WAAW,GAA+B,IAAI,CAAC;QAEnD,MAAM,aAAa,GAAG,GAAG,EAAE,CAAC;YAC1B,WAAW,KAAX,WAAW,GAAK,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;gBACtC,GAAG,EAAE,IAAI,CAAC,WAAW,EAAE;gBACvB,OAAO,EAAE,GAAG;gBACZ,WAAW;aACZ,CAAC,EAAC;YACH,OAAO,WAAW,CAAC;QAAA,CACpB,CAAC;QAEF,OAAO,IAAI,cAAc,CAAa;YACpC,KAAK,EAAE,KAAK,EAAE,KAAiB,EAAE,EAAE,CAAC;gBAClC,MAAM,MAAM,GAAG,MAAM,aAAa,EAAE,CAAC;gBACrC,MAAM,MAAM,GAAG,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC;gBACxC,IAAI,CAAC;oBACH,MAAM,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;gBAC5B,CAAC;wBAAS,CAAC;oBACT,MAAM,CAAC,WAAW,EAAE,CAAC;gBACvB,CAAC;YAAA,CACF;YACD,KAAK,EAAE,KAAK,IAAI,EAAE,CAAC;gBACjB,MAAM,MAAM,GAAG,MAAM,aAAa,EAAE,CAAC;gBACrC,MAAM,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;gBAC3B,MAAM,QAAQ,GAAG,MAAM,MAAM,CAAC,QAAQ,CAAC;gBAEvC,IAAI,QAAQ,KAAK,CAAC,EAAE,CAAC;oBACnB,MAAM,MAAM,GAAG,MAAM,IAAA,4BAAc,EAAC,MAAM,CAAC,MAAM,CAAC,CAAC;oBACnD,MAAM,IAAI,sBAAY,CAAC,wBAAwB,QAAQ,KAAK,MAAM,EAAE,EAAE,SAAS,CAAC,CAAC;gBACnF,CAAC;YAAA,CACF;YACD,KAAK,EAAE,KAAK,EAAE,MAAgB,EAAE,EAAE,CAAC;gBACjC,MAAM,MAAM,GAAG,MAAM,aAAa,EAAE,CAAC;gBACrC,MAAM,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;gBAC3B,MAAM,IAAI,sBAAY,CAAC,wBAAwB,QAAQ,KAAK,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,SAAS,CAAC,CAAC;YAAA,CAC1F;SACF,CAAC,CAAC;IAAA,CACJ;IAED;;;OAGG;IACO,iBAAiB,CAAC,UAAkB,EAAE,cAAsB,EAAU;QAC9E,OAAO,sBAAsB,UAAU,cAAc,cAAc,UAAU,cAAc,IAAI,UAAU,EAAE,CAAC;IAAA,CAC7G;IAED;;OAEG;IACH,KAAK,CAAC,SAAS,CAAC,OAAe,EAAiB;QAC9C,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE,EAAE;YACzE,GAAG,EAAE,GAAG;YACR,OAAO,EAAE,EAAE;SACZ,CAAC,CAAC;QAEH,MAAM,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;QAE3B,MAAM,CAAC,MAAM,EAAE,MAAM,EAAE,QAAQ,CAAC,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;YACnD,IAAA,4BAAc,EAAC,MAAM,CAAC,MAAM,CAAC;YAC7B,IAAA,4BAAc,EAAC,MAAM,CAAC,MAAM,CAAC;YAC7B,MAAM,CAAC,QAAQ;SAChB,CAAC,CAAC;QAEH,IAAI,QAAQ,KAAK,CAAC,EAAE,CAAC;YACnB,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,EAAE,IAAI,MAAM,CAAC,IAAI,EAAE,CAAC;YAC7C,MAAM,IAAI,sBAAY,CACpB,8BAA8B,OAAO,eAAe,QAAQ,GAAG,KAAK,CAAC,CAAC,CAAC,KAAK,KAAK,EAAE,CAAC,CAAC,CAAC,EAAE,EAAE,EAC1F,SAAS,CACV,CAAC;QACJ,CAAC;IAAA,CACF;IAED;;;OAGG;IACH,KAAK,CAAC,IAAI,CAAC,QAAgB,EAAE,WAAyB,EAAqB;QACzE,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,IAAI,CAAC,yBAAyB,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE,EAAE;YACvF,GAAG,EAAE,IAAI,CAAC,WAAW,EAAE;YACvB,OAAO,EAAE,EAAE;YACX,WAAW;SACZ,CAAC,CAAC;QAEH,MAAM,CAAC,MAAM,EAAE,MAAM,EAAE,QAAQ,CAAC,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;YACnD,IAAA,4BAAc,EAAC,MAAM,CAAC,MAAM,CAAC;YAC7B,IAAA,4BAAc,EAAC,MAAM,CAAC,MAAM,CAAC;YAC7B,MAAM,CAAC,QAAQ;SAChB,CAAC,CAAC;QAEH,IAAI,QAAQ,KAAK,CAAC,EAAE,CAAC;YACnB,MAAM,IAAI,sBAAY,CAAC,kBAAkB,QAAQ,KAAK,MAAM,EAAE,EAAE,SAAS,CAAC,CAAC;QAC7E,CAAC;QAED,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACvC,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YACrB,MAAM,IAAI,sBAAY,CAAC,mCAAmC,QAAQ,KAAK,MAAM,EAAE,EAAE,SAAS,CAAC,CAAC;QAC9F,CAAC;QAED,MAAM,IAAI,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;QACpC,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;QACrC,MAAM,QAAQ,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAE1C,OAAO;YACL,IAAI;YACJ,YAAY,EAAE,IAAI,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;YACpC,WAAW,EAAE,QAAQ,KAAK,WAAW;SACtC,CAAC;IAAA,CACH;IAED;;;OAGG;IACH,aAAa,CAAC,UAAkB,EAAE,QAAgB,EAAU;QAC1D,MAAM,MAAM,GAAG,UAAU,CAAC,IAAI,EAAE,CAAC;QACjC,IAAI,IAAI,GAAG,QAAQ,CAAC,IAAI,EAAE,CAAC;QAE3B,oEAAoE;QACpE,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC;YAC1C,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QAC3B,CAAC;QAED,yCAAyC;QACzC,IAAI,MAAM,KAAK,GAAG,EAAE,CAAC;YACnB,OAAO,IAAI,CAAC;QACd,CAAC;QAED,kCAAkC;QAClC,IAAI,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,MAAM,KAAK,GAAG,IAAI,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC;YACxE,IAAI,gBAAgB,GAAG,MAAM,CAAC;YAC9B,6DAA6D;YAC7D,IAAI,gBAAgB,CAAC,MAAM,GAAG,CAAC,IAAI,gBAAgB,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC;gBAClE,gBAAgB,GAAG,gBAAgB,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YACnD,CAAC;YACD,OAAO,gBAAgB,CAAC;QAC1B,CAAC;QAED,uCAAuC;QACvC,MAAM,gBAAgB,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,GAAG,MAAM,CAAC,CAAC,CAAC,IAAI,GAAG,GAAG,GAAG,MAAM,CAAC;QAElF,wBAAwB;QACxB,IAAI,gBAAgB,CAAC,MAAM,GAAG,CAAC,IAAI,gBAAgB,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC;YAClE,OAAO,gBAAgB,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QACvC,CAAC;QAED,OAAO,gBAAgB,CAAC;IAAA,CACzB;IAED;;OAEG;IACH,OAAO,GAAoB;QACzB,OAAO,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;IAAA,CAChC;IAED,UAAU,GAAW;QACnB,OAAO,QAAQ,CAAC;IAAA,CACjB;IAED,kDAAkD;IAElD;;;OAGG;IACH,WAAW,GAA+B;QACxC,OAAO,OAAO,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;IAAA,CACzC;CAqBF","sourcesContent":["/**\r\n * Abstract base class for remote execution runtimes (SSH, Docker).\r\n *\r\n * Provides shared implementation for:\r\n * - exec() with streaming I/O, timeout/abort handling\r\n * - readFile(), writeFile(), stat() via exec\r\n * - normalizePath() for POSIX paths\r\n * - tempDir() returning /tmp\r\n *\r\n * Subclasses implement:\r\n * - spawnRemoteProcess() - how to spawn the external process (ssh/docker)\r\n * - getBasePath() - base directory for workspace operations\r\n * - quoteForRemote() - path quoting strategy\r\n * - onExitCode() - optional exit code handling (SSH connection pool)\r\n */\r\n\r\nimport type { ChildProcess } from \"child_process\";\r\nimport { Readable } from \"stream\";\r\nimport type {\r\n  Runtime,\r\n  ExecOptions,\r\n  ExecStream,\r\n  FileStat,\r\n  WorkspaceCreationParams,\r\n  WorkspaceCreationResult,\r\n  WorkspaceInitParams,\r\n  WorkspaceInitResult,\r\n  WorkspaceForkParams,\r\n  WorkspaceForkResult,\r\n  EnsureReadyResult,\r\n} from \"./Runtime\";\r\nimport { RuntimeError } from \"./Runtime\";\r\nimport { EXIT_CODE_ABORTED, EXIT_CODE_TIMEOUT } from \"@/common/constants/exitCodes\";\r\nimport { log } from \"@/node/services/log\";\r\nimport { attachStreamErrorHandler } from \"@/node/utils/streamErrors\";\r\nimport { NON_INTERACTIVE_ENV_VARS } from \"@/common/constants/env\";\r\nimport { DisposableProcess } from \"@/node/utils/disposableExec\";\r\nimport { streamToString, shescape } from \"./streamUtils\";\r\n\r\n/**\r\n * Result from spawning a remote process.\r\n */\r\nexport interface SpawnResult {\r\n  /** The spawned child process */\r\n  process: ChildProcess;\r\n  /** Optional async work to do before exec (e.g., acquire connection) */\r\n  preExec?: Promise<void>;\r\n}\r\n\r\n/**\r\n * Abstract base class for remote execution runtimes.\r\n */\r\nexport abstract class RemoteRuntime implements Runtime {\r\n  /**\r\n   * Spawn the external process for command execution.\r\n   * SSH spawns `ssh`, Docker spawns `docker exec`.\r\n   *\r\n   * @param fullCommand The full shell command to execute (already wrapped in bash -c)\r\n   * @param options Original exec options\r\n   * @returns The spawned process and optional pre-exec work\r\n   */\r\n  protected abstract spawnRemoteProcess(\r\n    fullCommand: string,\r\n    options: ExecOptions\r\n  ): Promise<SpawnResult>;\r\n\r\n  /**\r\n   * Get the base path for file operations (used as cwd for file commands).\r\n   * SSH returns srcBaseDir, Docker returns /src.\r\n   */\r\n  protected abstract getBasePath(): string;\r\n\r\n  /**\r\n   * Quote a path for use in remote shell commands.\r\n   * SSH uses expandTildeForSSH (handles ~ expansion), Docker uses shescape.quote.\r\n   */\r\n  protected abstract quoteForRemote(path: string): string;\r\n\r\n  /**\r\n   * Build the cd command for the given cwd.\r\n   * SSH needs special handling for ~, Docker uses simple quoting.\r\n   */\r\n  protected abstract cdCommand(cwd: string): string;\r\n\r\n  /**\r\n   * Called when exec completes with an exit code.\r\n   * Subclasses can use this for connection pool health tracking.\r\n   * @param stderr - Captured stderr for error reporting (e.g., SSH connection failures)\r\n   */\r\n  protected onExitCode(_exitCode: number, _options: ExecOptions, _stderr: string): void {\r\n    // Default: no-op. SSH overrides to report to connection pool.\r\n  }\r\n\r\n  /**\r\n   * Command prefix (e.g., \"SSH\" or \"Docker\") for logging.\r\n   */\r\n  protected abstract readonly commandPrefix: string;\r\n\r\n  /**\r\n   * Execute command with streaming I/O.\r\n   * Shared implementation that delegates process spawning to subclass.\r\n   */\r\n  async exec(command: string, options: ExecOptions): Promise<ExecStream> {\r\n    const startTime = performance.now();\r\n\r\n    // Short-circuit if already aborted\r\n    if (options.abortSignal?.aborted) {\r\n      throw new RuntimeError(\"Operation aborted before execution\", \"exec\");\r\n    }\r\n\r\n    // Build command parts\r\n    const parts: string[] = [];\r\n\r\n    // Add cd command\r\n    parts.push(this.cdCommand(options.cwd));\r\n\r\n    // Add environment variable exports (user env first, then non-interactive overrides)\r\n    const envVars = { ...options.env, ...NON_INTERACTIVE_ENV_VARS };\r\n    for (const [key, value] of Object.entries(envVars)) {\r\n      parts.push(`export ${key}=${shescape.quote(value)}`);\r\n    }\r\n\r\n    // Add the actual command\r\n    parts.push(command);\r\n\r\n    // Join all parts with && to ensure each step succeeds before continuing\r\n    let fullCommand = parts.join(\" && \");\r\n\r\n    // Wrap in bash for consistent shell behavior\r\n    fullCommand = `bash -c ${shescape.quote(fullCommand)}`;\r\n\r\n    // Optionally wrap with timeout\r\n    if (options.timeout !== undefined) {\r\n      const remoteTimeout = Math.ceil(options.timeout) + 1;\r\n      fullCommand = `timeout -s KILL ${remoteTimeout} ${fullCommand}`;\r\n    }\r\n\r\n    // Spawn the remote process (SSH or Docker)\r\n    // For SSH, this awaits connection pool backoff before spawning\r\n    const { process: childProcess } = await this.spawnRemoteProcess(fullCommand, options);\r\n\r\n    // Short-lived commands can close stdin before writes/close complete.\r\n    if (childProcess.stdin) {\r\n      attachStreamErrorHandler(childProcess.stdin, `${this.commandPrefix} stdin`, {\r\n        logger: log,\r\n      });\r\n    }\r\n\r\n    // Wrap in DisposableProcess for cleanup\r\n    const disposable = new DisposableProcess(childProcess);\r\n\r\n    // Track if we killed the process due to timeout or abort\r\n    let timedOut = false;\r\n    let aborted = false;\r\n\r\n    // Declared here so it's captured by the exitCode promise closure,\r\n    // but the data listener is added AFTER Readable.toWeb() to avoid\r\n    // putting the stream in flowing mode prematurely.\r\n    let stderrForErrorReporting = \"\";\r\n\r\n    // Create promises for exit code and duration immediately.\r\n    const exitCode = new Promise<number>((resolve, reject) => {\r\n      childProcess.on(\"close\", (code, signal) => {\r\n        if (aborted || options.abortSignal?.aborted) {\r\n          resolve(EXIT_CODE_ABORTED);\r\n          return;\r\n        }\r\n        if (timedOut) {\r\n          resolve(EXIT_CODE_TIMEOUT);\r\n          return;\r\n        }\r\n        const finalExitCode = code ?? (signal ? -1 : 0);\r\n\r\n        // Let subclass handle exit code (e.g., SSH connection pool)\r\n        this.onExitCode(finalExitCode, options, stderrForErrorReporting);\r\n\r\n        resolve(finalExitCode);\r\n      });\r\n\r\n      childProcess.on(\"error\", (err) => {\r\n        reject(\r\n          new RuntimeError(\r\n            `Failed to execute ${this.commandPrefix} command: ${err.message}`,\r\n            \"exec\",\r\n            err\r\n          )\r\n        );\r\n      });\r\n    });\r\n\r\n    const duration = exitCode.then(() => performance.now() - startTime);\r\n\r\n    // Handle abort signal\r\n    if (options.abortSignal) {\r\n      const abortSignal = options.abortSignal;\r\n      const onAbort = () => {\r\n        aborted = true;\r\n\r\n        // For SSH/Docker, killing the local client too aggressively (SIGKILL) can leave the\r\n        // remote command running. Prefer SIGTERM first so the runtime can tear down cleanly,\r\n        // then hard-kill if it doesn't exit promptly.\r\n        //\r\n        // Note: SSH2's ChildProcess shim only sends a remote signal when an explicit signal\r\n        // string is provided, so always pass SIGTERM.\r\n        try {\r\n          childProcess.kill(\"SIGTERM\");\r\n        } catch {\r\n          // ignore\r\n        }\r\n\r\n        const hardKillHandle = setTimeout(() => {\r\n          const hasExited = childProcess.exitCode !== null || childProcess.signalCode !== null;\r\n          if (hasExited) {\r\n            return;\r\n          }\r\n          disposable[Symbol.dispose]();\r\n        }, 1000);\r\n        hardKillHandle.unref();\r\n      };\r\n\r\n      abortSignal.addEventListener(\"abort\", onAbort, { once: true });\r\n\r\n      // Avoid retaining closures on long-lived abort signals once the process exits.\r\n      void exitCode.finally(() => abortSignal.removeEventListener(\"abort\", onAbort));\r\n    }\r\n\r\n    // Handle timeout\r\n    if (options.timeout !== undefined) {\r\n      const timeoutHandle = setTimeout(() => {\r\n        timedOut = true;\r\n\r\n        try {\r\n          childProcess.kill(\"SIGTERM\");\r\n        } catch {\r\n          // ignore\r\n        }\r\n\r\n        const hardKillHandle = setTimeout(() => {\r\n          const hasExited = childProcess.exitCode !== null || childProcess.signalCode !== null;\r\n          if (hasExited) {\r\n            return;\r\n          }\r\n          disposable[Symbol.dispose]();\r\n        }, 1000);\r\n        hardKillHandle.unref();\r\n      }, options.timeout * 1000);\r\n\r\n      void exitCode.finally(() => clearTimeout(timeoutHandle));\r\n    }\r\n\r\n    // Convert Node.js streams to Web Streams\r\n    const stdout = Readable.toWeb(childProcess.stdout!) as unknown as ReadableStream<Uint8Array>;\r\n    const stderr = Readable.toWeb(childProcess.stderr!) as unknown as ReadableStream<Uint8Array>;\r\n\r\n    // Capture stderr for error reporting (e.g., SSH exit code 255 failures).\r\n    // Must be AFTER Readable.toWeb() to avoid putting the stream in flowing mode prematurely.\r\n    childProcess.stderr?.on(\"data\", (data: Buffer) => {\r\n      stderrForErrorReporting += data.toString();\r\n    });\r\n\r\n    // Writable.toWeb(childProcess.stdin) is surprisingly easy to get into an invalid state\r\n    // for short-lived remote commands (notably via SSH) where stdin may already be closed\r\n    // by the time callers attempt `await stream.stdin.close()`.\r\n    //\r\n    // Wrap stdin ourselves so close() is idempotent.\r\n    const stdin = new WritableStream<Uint8Array>({\r\n      write: async (chunk) => {\r\n        const nodeStdin = childProcess.stdin;\r\n        if (!nodeStdin || nodeStdin.destroyed) {\r\n          return;\r\n        }\r\n\r\n        await new Promise<void>((resolve, reject) => {\r\n          const onError = (err: Error) => {\r\n            nodeStdin.off(\"error\", onError);\r\n            reject(err);\r\n          };\r\n          nodeStdin.on(\"error\", onError);\r\n\r\n          nodeStdin.write(Buffer.from(chunk), (err) => {\r\n            nodeStdin.off(\"error\", onError);\r\n            if (err) {\r\n              reject(err);\r\n              return;\r\n            }\r\n            resolve();\r\n          });\r\n        });\r\n      },\r\n      close: async () => {\r\n        const nodeStdin = childProcess.stdin;\r\n        if (!nodeStdin || nodeStdin.destroyed || nodeStdin.writableEnded) {\r\n          return;\r\n        }\r\n\r\n        await new Promise<void>((resolve) => {\r\n          const onError = () => {\r\n            cleanup();\r\n            resolve();\r\n          };\r\n\r\n          const onFinish = () => {\r\n            cleanup();\r\n            resolve();\r\n          };\r\n\r\n          const cleanup = () => {\r\n            nodeStdin.removeListener(\"error\", onError);\r\n            nodeStdin.removeListener(\"finish\", onFinish);\r\n          };\r\n\r\n          nodeStdin.once(\"error\", onError);\r\n          nodeStdin.once(\"finish\", onFinish);\r\n\r\n          try {\r\n            nodeStdin.end();\r\n          } catch {\r\n            onError();\r\n          }\r\n        });\r\n      },\r\n      abort: () => {\r\n        childProcess.stdin?.destroy();\r\n      },\r\n    });\r\n\r\n    log.debug(`${this.commandPrefix} command: ${fullCommand}`);\r\n\r\n    return { stdout, stderr, stdin, exitCode, duration };\r\n  }\r\n\r\n  /**\r\n   * Read file contents as a stream via exec.\r\n   */\r\n  readFile(filePath: string, abortSignal?: AbortSignal): ReadableStream<Uint8Array> {\r\n    return new ReadableStream<Uint8Array>({\r\n      start: async (controller: ReadableStreamDefaultController<Uint8Array>) => {\r\n        try {\r\n          const stream = await this.exec(`cat ${this.quoteForRemote(filePath)}`, {\r\n            cwd: this.getBasePath(),\r\n            timeout: 300,\r\n            abortSignal,\r\n          });\r\n\r\n          const reader = stream.stdout.getReader();\r\n          const exitCodePromise = stream.exitCode;\r\n\r\n          while (true) {\r\n            const { done, value } = await reader.read();\r\n            if (done) break;\r\n            controller.enqueue(value);\r\n          }\r\n\r\n          const code = await exitCodePromise;\r\n          if (code !== 0) {\r\n            const stderr = await streamToString(stream.stderr);\r\n            throw new RuntimeError(`Failed to read file ${filePath}: ${stderr}`, \"file_io\");\r\n          }\r\n\r\n          controller.close();\r\n        } catch (err) {\r\n          if (err instanceof RuntimeError) {\r\n            controller.error(err);\r\n          } else {\r\n            controller.error(\r\n              new RuntimeError(\r\n                `Failed to read file ${filePath}: ${err instanceof Error ? err.message : String(err)}`,\r\n                \"file_io\",\r\n                err instanceof Error ? err : undefined\r\n              )\r\n            );\r\n          }\r\n        }\r\n      },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Write file contents atomically via exec.\r\n   * Uses temp file + mv for atomic write.\r\n   */\r\n  writeFile(filePath: string, abortSignal?: AbortSignal): WritableStream<Uint8Array> {\r\n    const quotedPath = this.quoteForRemote(filePath);\r\n    const tempPath = `${filePath}.tmp.${Date.now()}`;\r\n    const quotedTempPath = this.quoteForRemote(tempPath);\r\n\r\n    // Build write command - subclasses can override buildWriteCommand for special handling\r\n    const writeCommand = this.buildWriteCommand(quotedPath, quotedTempPath);\r\n\r\n    let execPromise: Promise<ExecStream> | null = null;\r\n\r\n    const getExecStream = () => {\r\n      execPromise ??= this.exec(writeCommand, {\r\n        cwd: this.getBasePath(),\r\n        timeout: 300,\r\n        abortSignal,\r\n      });\r\n      return execPromise;\r\n    };\r\n\r\n    return new WritableStream<Uint8Array>({\r\n      write: async (chunk: Uint8Array) => {\r\n        const stream = await getExecStream();\r\n        const writer = stream.stdin.getWriter();\r\n        try {\r\n          await writer.write(chunk);\r\n        } finally {\r\n          writer.releaseLock();\r\n        }\r\n      },\r\n      close: async () => {\r\n        const stream = await getExecStream();\r\n        await stream.stdin.close();\r\n        const exitCode = await stream.exitCode;\r\n\r\n        if (exitCode !== 0) {\r\n          const stderr = await streamToString(stream.stderr);\r\n          throw new RuntimeError(`Failed to write file ${filePath}: ${stderr}`, \"file_io\");\r\n        }\r\n      },\r\n      abort: async (reason?: unknown) => {\r\n        const stream = await getExecStream();\r\n        await stream.stdin.abort();\r\n        throw new RuntimeError(`Failed to write file ${filePath}: ${String(reason)}`, \"file_io\");\r\n      },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Build the write command for atomic file writes.\r\n   * Can be overridden by subclasses for special handling (e.g., SSH symlink preservation).\r\n   */\r\n  protected buildWriteCommand(quotedPath: string, quotedTempPath: string): string {\r\n    return `mkdir -p $(dirname ${quotedPath}) && cat > ${quotedTempPath} && mv ${quotedTempPath} ${quotedPath}`;\r\n  }\r\n\r\n  /**\r\n   * Ensure a directory exists (mkdir -p semantics).\r\n   */\r\n  async ensureDir(dirPath: string): Promise<void> {\r\n    const stream = await this.exec(`mkdir -p ${this.quoteForRemote(dirPath)}`, {\r\n      cwd: \"/\",\r\n      timeout: 10,\r\n    });\r\n\r\n    await stream.stdin.close();\r\n\r\n    const [stdout, stderr, exitCode] = await Promise.all([\r\n      streamToString(stream.stdout),\r\n      streamToString(stream.stderr),\r\n      stream.exitCode,\r\n    ]);\r\n\r\n    if (exitCode !== 0) {\r\n      const extra = stderr.trim() || stdout.trim();\r\n      throw new RuntimeError(\r\n        `Failed to create directory ${dirPath}: exit code ${exitCode}${extra ? `: ${extra}` : \"\"}`,\r\n        \"file_io\"\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get file statistics via exec.\r\n   * Uses stat -L to follow symlinks (report target's type, not \"symbolic link\").\r\n   */\r\n  async stat(filePath: string, abortSignal?: AbortSignal): Promise<FileStat> {\r\n    const stream = await this.exec(`stat -L -c '%s %Y %F' ${this.quoteForRemote(filePath)}`, {\r\n      cwd: this.getBasePath(),\r\n      timeout: 10,\r\n      abortSignal,\r\n    });\r\n\r\n    const [stdout, stderr, exitCode] = await Promise.all([\r\n      streamToString(stream.stdout),\r\n      streamToString(stream.stderr),\r\n      stream.exitCode,\r\n    ]);\r\n\r\n    if (exitCode !== 0) {\r\n      throw new RuntimeError(`Failed to stat ${filePath}: ${stderr}`, \"file_io\");\r\n    }\r\n\r\n    const parts = stdout.trim().split(\" \");\r\n    if (parts.length < 3) {\r\n      throw new RuntimeError(`Failed to parse stat output for ${filePath}: ${stdout}`, \"file_io\");\r\n    }\r\n\r\n    const size = parseInt(parts[0], 10);\r\n    const mtime = parseInt(parts[1], 10);\r\n    const fileType = parts.slice(2).join(\" \");\r\n\r\n    return {\r\n      size,\r\n      modifiedTime: new Date(mtime * 1000),\r\n      isDirectory: fileType === \"directory\",\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Normalize path for comparison (POSIX semantics).\r\n   * Shared between SSH and Docker.\r\n   */\r\n  normalizePath(targetPath: string, basePath: string): string {\r\n    const target = targetPath.trim();\r\n    let base = basePath.trim();\r\n\r\n    // Normalize base path - remove trailing slash (except for root \"/\")\r\n    if (base.length > 1 && base.endsWith(\"/\")) {\r\n      base = base.slice(0, -1);\r\n    }\r\n\r\n    // Handle special case: current directory\r\n    if (target === \".\") {\r\n      return base;\r\n    }\r\n\r\n    // Handle absolute paths and tilde\r\n    if (target.startsWith(\"/\") || target === \"~\" || target.startsWith(\"~/\")) {\r\n      let normalizedTarget = target;\r\n      // Remove trailing slash for comparison (except for root \"/\")\r\n      if (normalizedTarget.length > 1 && normalizedTarget.endsWith(\"/\")) {\r\n        normalizedTarget = normalizedTarget.slice(0, -1);\r\n      }\r\n      return normalizedTarget;\r\n    }\r\n\r\n    // Relative path - resolve against base\r\n    const normalizedTarget = base.endsWith(\"/\") ? base + target : base + \"/\" + target;\r\n\r\n    // Remove trailing slash\r\n    if (normalizedTarget.length > 1 && normalizedTarget.endsWith(\"/\")) {\r\n      return normalizedTarget.slice(0, -1);\r\n    }\r\n\r\n    return normalizedTarget;\r\n  }\r\n\r\n  /**\r\n   * Return /tmp as the temp directory for remote runtimes.\r\n   */\r\n  tempDir(): Promise<string> {\r\n    return Promise.resolve(\"/tmp\");\r\n  }\r\n\r\n  getMuxHome(): string {\r\n    return \"~/.mux\";\r\n  }\r\n\r\n  // Abstract methods that subclasses must implement\r\n\r\n  /**\r\n   * Remote runtimes are always ready (SSH connections are re-established as needed).\r\n   * Subclasses (CoderSSHRuntime, DockerRuntime) may override for provisioning checks.\r\n   */\r\n  ensureReady(): Promise<EnsureReadyResult> {\r\n    return Promise.resolve({ ready: true });\r\n  }\r\n\r\n  abstract resolvePath(path: string): Promise<string>;\r\n  abstract getWorkspacePath(projectPath: string, workspaceName: string): string;\r\n  abstract createWorkspace(params: WorkspaceCreationParams): Promise<WorkspaceCreationResult>;\r\n  abstract initWorkspace(params: WorkspaceInitParams): Promise<WorkspaceInitResult>;\r\n  abstract renameWorkspace(\r\n    projectPath: string,\r\n    oldName: string,\r\n    newName: string,\r\n    abortSignal?: AbortSignal\r\n  ): Promise<\r\n    { success: true; oldPath: string; newPath: string } | { success: false; error: string }\r\n  >;\r\n  abstract deleteWorkspace(\r\n    projectPath: string,\r\n    workspaceName: string,\r\n    force: boolean,\r\n    abortSignal?: AbortSignal\r\n  ): Promise<{ success: true; deletedPath: string } | { success: false; error: string }>;\r\n  abstract forkWorkspace(params: WorkspaceForkParams): Promise<WorkspaceForkResult>;\r\n}\r\n"]}