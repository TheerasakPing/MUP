{"version":3,"file":"sshConnectionPool.test.js","sourceRoot":"","sources":["../../../src/node/runtime/sshConnectionPool.test.ts"],"names":[],"mappings":"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","sourcesContent":["import * as os from \"os\";\r\nimport * as path from \"path\";\r\nimport { getControlPath, SSHConnectionPool, type SSHRuntimeConfig } from \"./sshConnectionPool\";\r\n\r\ndescribe(\"sshConnectionPool\", () => {\r\n  describe(\"getControlPath\", () => {\r\n    test(\"identical configs produce same controlPath\", () => {\r\n      const config: SSHRuntimeConfig = {\r\n        host: \"test.example.com\",\r\n        srcBaseDir: \"/work\",\r\n      };\r\n      const path1 = getControlPath(config);\r\n      const path2 = getControlPath(config);\r\n\r\n      expect(path1).toBe(path2);\r\n    });\r\n\r\n    test(\"different hosts produce different controlPaths\", () => {\r\n      const config1: SSHRuntimeConfig = {\r\n        host: \"host1.example.com\",\r\n        srcBaseDir: \"/work\",\r\n      };\r\n      const config2: SSHRuntimeConfig = {\r\n        host: \"host2.example.com\",\r\n        srcBaseDir: \"/work\",\r\n      };\r\n\r\n      const path1 = getControlPath(config1);\r\n      const path2 = getControlPath(config2);\r\n\r\n      expect(path1).not.toBe(path2);\r\n    });\r\n\r\n    test(\"different ports produce different controlPaths\", () => {\r\n      const config1: SSHRuntimeConfig = {\r\n        host: \"test.com\",\r\n        srcBaseDir: \"/work\",\r\n        port: 22,\r\n      };\r\n      const config2: SSHRuntimeConfig = {\r\n        host: \"test.com\",\r\n        srcBaseDir: \"/work\",\r\n        port: 2222,\r\n      };\r\n\r\n      expect(getControlPath(config1)).not.toBe(getControlPath(config2));\r\n    });\r\n\r\n    test(\"different identityFiles produce different controlPaths\", () => {\r\n      const config1: SSHRuntimeConfig = {\r\n        host: \"test.com\",\r\n        srcBaseDir: \"/work\",\r\n        identityFile: \"/path/to/key1\",\r\n      };\r\n      const config2: SSHRuntimeConfig = {\r\n        host: \"test.com\",\r\n        srcBaseDir: \"/work\",\r\n        identityFile: \"/path/to/key2\",\r\n      };\r\n\r\n      expect(getControlPath(config1)).not.toBe(getControlPath(config2));\r\n    });\r\n\r\n    test(\"different srcBaseDirs produce same controlPaths (connection shared)\", () => {\r\n      // srcBaseDir is intentionally excluded from connection key -\r\n      // workspaces on the same host share health tracking and multiplexing\r\n      const config1: SSHRuntimeConfig = {\r\n        host: \"test.com\",\r\n        srcBaseDir: \"/work1\",\r\n      };\r\n      const config2: SSHRuntimeConfig = {\r\n        host: \"test.com\",\r\n        srcBaseDir: \"/work2\",\r\n      };\r\n\r\n      expect(getControlPath(config1)).toBe(getControlPath(config2));\r\n    });\r\n\r\n    test(\"controlPath is in tmpdir with expected format\", () => {\r\n      const config: SSHRuntimeConfig = {\r\n        host: \"test.com\",\r\n        srcBaseDir: \"/work\",\r\n      };\r\n      const controlPath = getControlPath(config);\r\n\r\n      expect(controlPath).toContain(os.tmpdir());\r\n      expect(controlPath).toMatch(/mux-ssh-[a-f0-9]{12}$/);\r\n    });\r\n\r\n    test(\"missing port defaults to 22 in hash calculation\", () => {\r\n      const config1: SSHRuntimeConfig = {\r\n        host: \"test.com\",\r\n        srcBaseDir: \"/work\",\r\n        port: 22,\r\n      };\r\n      const config2: SSHRuntimeConfig = {\r\n        host: \"test.com\",\r\n        srcBaseDir: \"/work\",\r\n        // port omitted, should default to 22\r\n      };\r\n\r\n      expect(getControlPath(config1)).toBe(getControlPath(config2));\r\n    });\r\n\r\n    test(\"missing identityFile defaults to 'default' in hash calculation\", () => {\r\n      const config1: SSHRuntimeConfig = {\r\n        host: \"test.com\",\r\n        srcBaseDir: \"/work\",\r\n        identityFile: undefined,\r\n      };\r\n      const config2: SSHRuntimeConfig = {\r\n        host: \"test.com\",\r\n        srcBaseDir: \"/work\",\r\n        // identityFile omitted\r\n      };\r\n\r\n      expect(getControlPath(config1)).toBe(getControlPath(config2));\r\n    });\r\n  });\r\n});\r\n\r\ndescribe(\"username isolation\", () => {\r\n  test(\"controlPath includes local username to prevent cross-user collisions\", () => {\r\n    // This test verifies that os.userInfo().username is included in the hash\r\n    // On multi-user systems, different users connecting to the same remote\r\n    // would get different controlPaths, preventing permission errors\r\n    const config: SSHRuntimeConfig = {\r\n      host: \"test.com\",\r\n      srcBaseDir: \"/work\",\r\n    };\r\n    const controlPath = getControlPath(config);\r\n\r\n    // The path should be deterministic for this user\r\n    expect(controlPath).toBe(getControlPath(config));\r\n\r\n    const expectedPrefix = path.join(os.tmpdir(), \"mux-ssh-\");\r\n    expect(controlPath.startsWith(expectedPrefix)).toBe(true);\r\n    expect(controlPath).toMatch(/mux-ssh-[a-f0-9]{12}$/);\r\n  });\r\n});\r\n\r\ndescribe(\"SSHConnectionPool\", () => {\r\n  describe(\"health tracking\", () => {\r\n    test(\"getConnectionHealth returns undefined for unknown connection\", () => {\r\n      const pool = new SSHConnectionPool();\r\n      const config: SSHRuntimeConfig = {\r\n        host: \"unknown.example.com\",\r\n        srcBaseDir: \"/work\",\r\n      };\r\n\r\n      expect(pool.getConnectionHealth(config)).toBeUndefined();\r\n    });\r\n\r\n    test(\"markHealthy sets connection to healthy state\", () => {\r\n      const pool = new SSHConnectionPool();\r\n      const config: SSHRuntimeConfig = {\r\n        host: \"test.example.com\",\r\n        srcBaseDir: \"/work\",\r\n      };\r\n\r\n      pool.markHealthy(config);\r\n      const health = pool.getConnectionHealth(config);\r\n\r\n      expect(health).toBeDefined();\r\n      expect(health!.status).toBe(\"healthy\");\r\n      expect(health!.consecutiveFailures).toBe(0);\r\n      expect(health!.lastSuccess).toBeInstanceOf(Date);\r\n    });\r\n\r\n    test(\"reportFailure puts connection into backoff\", () => {\r\n      const pool = new SSHConnectionPool();\r\n      const config: SSHRuntimeConfig = {\r\n        host: \"test.example.com\",\r\n        srcBaseDir: \"/work\",\r\n      };\r\n\r\n      // Mark healthy first\r\n      pool.markHealthy(config);\r\n      expect(pool.getConnectionHealth(config)?.status).toBe(\"healthy\");\r\n\r\n      // Report a failure\r\n      pool.reportFailure(config, \"Connection refused\");\r\n      const health = pool.getConnectionHealth(config);\r\n\r\n      expect(health?.status).toBe(\"unhealthy\");\r\n      expect(health?.consecutiveFailures).toBe(1);\r\n      expect(health?.lastError).toBe(\"Connection refused\");\r\n      expect(health?.backoffUntil).toBeDefined();\r\n    });\r\n\r\n    test(\"backoff caps at ~10s with jitter\", () => {\r\n      const pool = new SSHConnectionPool();\r\n      const config: SSHRuntimeConfig = {\r\n        host: \"test.example.com\",\r\n        srcBaseDir: \"/work\",\r\n      };\r\n\r\n      // Report many failures to hit the cap\r\n      for (let i = 0; i < 10; i++) {\r\n        pool.reportFailure(config, \"Connection refused\");\r\n      }\r\n\r\n      const health = pool.getConnectionHealth(config)!;\r\n      const backoffMs = health.backoffUntil!.getTime() - Date.now();\r\n\r\n      // Max base is 10s, jitter adds Â±20%, so max is ~12s (10 * 1.2)\r\n      expect(backoffMs).toBeGreaterThan(7_500); // 10 * 0.8 - some tolerance\r\n      expect(backoffMs).toBeLessThanOrEqual(12_500); // 10 * 1.2 + some tolerance\r\n    });\r\n\r\n    test(\"resetBackoff clears backoff state after failed probe\", async () => {\r\n      const pool = new SSHConnectionPool();\r\n      const config: SSHRuntimeConfig = {\r\n        host: \"nonexistent.invalid.host.test\",\r\n        srcBaseDir: \"/work\",\r\n      };\r\n\r\n      // Trigger a failure via acquireConnection (will fail to connect)\r\n      await expect(\r\n        pool.acquireConnection(config, { timeoutMs: 1000, maxWaitMs: 0 })\r\n      ).rejects.toThrow();\r\n\r\n      // Verify we're now in backoff\r\n      const healthBefore = pool.getConnectionHealth(config);\r\n      expect(healthBefore?.status).toBe(\"unhealthy\");\r\n      expect(healthBefore?.backoffUntil).toBeDefined();\r\n\r\n      // Reset backoff\r\n      pool.resetBackoff(config);\r\n      const healthAfter = pool.getConnectionHealth(config);\r\n\r\n      expect(healthAfter).toBeDefined();\r\n      expect(healthAfter!.status).toBe(\"unknown\");\r\n      expect(healthAfter!.consecutiveFailures).toBe(0);\r\n      expect(healthAfter!.backoffUntil).toBeUndefined();\r\n    });\r\n  });\r\n\r\n  describe(\"acquireConnection\", () => {\r\n    test(\"returns immediately for known healthy connection\", async () => {\r\n      const pool = new SSHConnectionPool();\r\n      const config: SSHRuntimeConfig = {\r\n        host: \"test.example.com\",\r\n        srcBaseDir: \"/work\",\r\n      };\r\n\r\n      // Mark as healthy first\r\n      pool.markHealthy(config);\r\n\r\n      // Should return immediately without probing\r\n      const start = Date.now();\r\n      await pool.acquireConnection(config);\r\n      const elapsed = Date.now() - start;\r\n\r\n      // Should be nearly instant (< 50ms)\r\n      expect(elapsed).toBeLessThan(50);\r\n    });\r\n\r\n    test(\"waits through backoff (bounded) instead of throwing\", async () => {\r\n      const pool = new SSHConnectionPool();\r\n      const config: SSHRuntimeConfig = {\r\n        host: \"test.example.com\",\r\n        srcBaseDir: \"/work\",\r\n      };\r\n\r\n      // Put host into backoff without doing a real probe.\r\n      pool.reportFailure(config, \"Connection refused\");\r\n      expect(pool.getConnectionHealth(config)?.backoffUntil).toBeDefined();\r\n\r\n      const sleepCalls: number[] = [];\r\n      const onWaitCalls: number[] = [];\r\n\r\n      await pool.acquireConnection(config, {\r\n        onWait: (ms) => {\r\n          onWaitCalls.push(ms);\r\n        },\r\n        sleep: (ms) => {\r\n          sleepCalls.push(ms);\r\n          // Simulate time passing / recovery.\r\n          pool.markHealthy(config);\r\n          return Promise.resolve();\r\n        },\r\n      });\r\n\r\n      expect(sleepCalls.length).toBe(1);\r\n      expect(onWaitCalls.length).toBe(1);\r\n      expect(sleepCalls[0]).toBeGreaterThan(0);\r\n      expect(onWaitCalls[0]).toBe(sleepCalls[0]);\r\n      expect(pool.getConnectionHealth(config)?.status).toBe(\"healthy\");\r\n    });\r\n    test(\"throws immediately when in backoff\", async () => {\r\n      const pool = new SSHConnectionPool();\r\n      const config: SSHRuntimeConfig = {\r\n        host: \"nonexistent.invalid.host.test\",\r\n        srcBaseDir: \"/work\",\r\n      };\r\n\r\n      // Trigger a failure to put connection in backoff\r\n      await expect(\r\n        pool.acquireConnection(config, { timeoutMs: 1000, maxWaitMs: 0 })\r\n      ).rejects.toThrow();\r\n\r\n      // Second call should throw immediately with backoff message\r\n      await expect(pool.acquireConnection(config, { maxWaitMs: 0 })).rejects.toThrow(/in backoff/);\r\n    });\r\n\r\n    test(\"getControlPath returns deterministic path\", () => {\r\n      const pool = new SSHConnectionPool();\r\n      const config: SSHRuntimeConfig = {\r\n        host: \"test.example.com\",\r\n        srcBaseDir: \"/work\",\r\n      };\r\n\r\n      const path1 = pool.getControlPath(config);\r\n      const path2 = pool.getControlPath(config);\r\n\r\n      expect(path1).toBe(path2);\r\n      expect(path1).toBe(getControlPath(config));\r\n    });\r\n  });\r\n\r\n  describe(\"singleflighting\", () => {\r\n    test(\"concurrent acquireConnection calls share same probe\", async () => {\r\n      const pool = new SSHConnectionPool();\r\n      const config: SSHRuntimeConfig = {\r\n        host: \"nonexistent.invalid.host.test\",\r\n        srcBaseDir: \"/work\",\r\n      };\r\n\r\n      // All concurrent calls should share the same probe and get same result\r\n      const results = await Promise.allSettled([\r\n        pool.acquireConnection(config, { timeoutMs: 1000, maxWaitMs: 0 }),\r\n        pool.acquireConnection(config, { timeoutMs: 1000, maxWaitMs: 0 }),\r\n        pool.acquireConnection(config, { timeoutMs: 1000, maxWaitMs: 0 }),\r\n      ]);\r\n\r\n      // All should be rejected (connection fails)\r\n      expect(results.every((r) => r.status === \"rejected\")).toBe(true);\r\n\r\n      // Only 1 failure should be recorded (not 3) - proves singleflighting worked\r\n      expect(pool.getConnectionHealth(config)?.consecutiveFailures).toBe(1);\r\n    });\r\n\r\n    test(\"callers waking from backoff share single probe (herd only released on success)\", async () => {\r\n      const pool = new SSHConnectionPool();\r\n      const config: SSHRuntimeConfig = {\r\n        host: \"test.example.com\",\r\n        srcBaseDir: \"/work\",\r\n      };\r\n\r\n      // Put connection in backoff\r\n      pool.reportFailure(config, \"Initial failure\");\r\n      expect(pool.getConnectionHealth(config)?.consecutiveFailures).toBe(1);\r\n\r\n      let probeCount = 0;\r\n      const sleepResolvers: Array<() => void> = [];\r\n\r\n      // Start 3 waiters - they'll all sleep through backoff\r\n      const waiters = [1, 2, 3].map(() =>\r\n        pool.acquireConnection(config, {\r\n          sleep: () =>\r\n            new Promise<void>((resolve) => {\r\n              sleepResolvers.push(() => {\r\n                // When sleep resolves, simulate recovery (mark healthy)\r\n                // This happens during the first probe - all waiters share it\r\n                if (probeCount === 0) {\r\n                  probeCount++;\r\n                  pool.markHealthy(config);\r\n                }\r\n                resolve();\r\n              });\r\n            }),\r\n        })\r\n      );\r\n\r\n      // Let all sleepers proceed\r\n      await Promise.resolve(); // Let all acquireConnection calls reach sleep\r\n      expect(sleepResolvers.length).toBe(3);\r\n\r\n      // Wake them all up \"simultaneously\"\r\n      sleepResolvers.forEach((resolve) => resolve());\r\n\r\n      // All should succeed\r\n      await Promise.all(waiters);\r\n\r\n      // Only one \"probe\" (markHealthy) should have happened\r\n      expect(probeCount).toBe(1);\r\n      expect(pool.getConnectionHealth(config)?.status).toBe(\"healthy\");\r\n    });\r\n  });\r\n});\r\n"]}