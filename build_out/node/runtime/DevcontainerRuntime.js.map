{"version":3,"file":"DevcontainerRuntime.js","sourceRoot":"","sources":["../../../src/node/runtime/DevcontainerRuntime.ts"],"names":[],"mappings":"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","sourcesContent":["import { spawn } from \"child_process\";\r\nimport * as path from \"path\";\r\nimport { Readable, Writable } from \"stream\";\r\nimport type {\r\n  RuntimeCreateFlags,\r\n  WorkspaceCreationParams,\r\n  WorkspaceCreationResult,\r\n  WorkspaceForkParams,\r\n  WorkspaceForkResult,\r\n  WorkspaceInitParams,\r\n  WorkspaceInitResult,\r\n  ExecOptions,\r\n  ExecStream,\r\n  EnsureReadyResult,\r\n  EnsureReadyOptions,\r\n  FileStat,\r\n} from \"./Runtime\";\r\nimport { RuntimeError, WORKSPACE_REPO_MISSING_ERROR } from \"./Runtime\";\r\nimport { LocalBaseRuntime } from \"./LocalBaseRuntime\";\r\nimport { WorktreeManager } from \"@/node/worktree/WorktreeManager\";\r\nimport { expandTildeForSSH } from \"./tildeExpansion\";\r\nimport { shescape, streamToString } from \"./streamUtils\";\r\nimport {\r\n  readHostGitconfig,\r\n  resolveGhToken,\r\n  resolveSshAgentForwarding,\r\n} from \"./credentialForwarding\";\r\nimport { devcontainerUp, devcontainerDown } from \"./devcontainerCli\";\r\nimport { checkInitHookExists, getMuxEnv } from \"./initHook\";\r\nimport { runInitHookOnRuntime } from \"./initHook\";\r\nimport { DisposableProcess, killProcessTree } from \"@/node/utils/disposableExec\";\r\nimport { EXIT_CODE_ABORTED, EXIT_CODE_TIMEOUT } from \"@/common/constants/exitCodes\";\r\nimport { NON_INTERACTIVE_ENV_VARS } from \"@/common/constants/env\";\r\nimport { getErrorMessage } from \"@/common/utils/errors\";\r\nimport { log } from \"@/node/services/log\";\r\nimport { isGitRepository, stripTrailingSlashes } from \"@/node/utils/pathUtils\";\r\n\r\nexport interface DevcontainerRuntimeOptions {\r\n  srcBaseDir: string;\r\n  configPath: string;\r\n  shareCredentials?: boolean;\r\n}\r\n\r\n/**\r\n * Devcontainer runtime implementation.\r\n *\r\n * This runtime creates git worktrees on the host and runs commands inside\r\n * a devcontainer built from the project's devcontainer.json configuration.\r\n *\r\n * Architecture:\r\n * - Worktree operations (create/delete/fork) → WorktreeManager (host filesystem)\r\n * - Command execution (exec) → devcontainer exec (inside container)\r\n * - File I/O → host fs (worktree is bind-mounted into container)\r\n * - ensureReady → devcontainer up (starts/rebuilds container as needed)\r\n */\r\nexport class DevcontainerRuntime extends LocalBaseRuntime {\r\n  private readonly worktreeManager: WorktreeManager;\r\n  private readonly configPath: string;\r\n\r\n  // Cached env used for credential forwarding\r\n  private lastCredentialEnv?: Record<string, string>;\r\n  private readonly shareCredentials: boolean;\r\n\r\n  // Cached from devcontainer up output\r\n  private remoteHomeDir?: string;\r\n  private remoteWorkspaceFolder?: string;\r\n  private remoteUser?: string;\r\n\r\n  // Current workspace context (set during postCreateSetup/ensureReady)\r\n  private currentWorkspacePath?: string;\r\n\r\n  readonly createFlags: RuntimeCreateFlags = {\r\n    deferredRuntimeAccess: true,\r\n  };\r\n\r\n  private buildCredentialForwarding(env?: Record<string, string>): {\r\n    additionalMounts: string[];\r\n    remoteEnv: Record<string, string>;\r\n  } {\r\n    const additionalMounts: string[] = [];\r\n    const remoteEnv: Record<string, string> = {};\r\n\r\n    if (!this.shareCredentials) {\r\n      return { additionalMounts, remoteEnv };\r\n    }\r\n\r\n    const sshForwarding = resolveSshAgentForwarding(\"/tmp/ssh-agent.sock\");\r\n    if (sshForwarding) {\r\n      additionalMounts.push(\r\n        `type=bind,source=${sshForwarding.hostSocketPath},target=${sshForwarding.targetSocketPath}`\r\n      );\r\n      remoteEnv.SSH_AUTH_SOCK = sshForwarding.targetSocketPath;\r\n    }\r\n\r\n    const ghToken = resolveGhToken(env);\r\n    if (ghToken) {\r\n      remoteEnv.GH_TOKEN = ghToken;\r\n    }\r\n\r\n    return { additionalMounts, remoteEnv };\r\n  }\r\n\r\n  private mapContainerPathToHost(containerPath: string): string | null {\r\n    if (!this.remoteWorkspaceFolder || !this.currentWorkspacePath) return null;\r\n\r\n    const remoteRoot = this.remoteWorkspaceFolder.replace(/\\/+$/, \"\");\r\n    if (containerPath !== remoteRoot && !containerPath.startsWith(`${remoteRoot}/`)) return null;\r\n\r\n    const suffix = containerPath.slice(remoteRoot.length).replace(/^\\/+/, \"\");\r\n    return suffix.length === 0\r\n      ? this.currentWorkspacePath\r\n      : path.join(this.currentWorkspacePath, suffix);\r\n  }\r\n\r\n  private getContainerBasePath(): string {\r\n    return this.remoteWorkspaceFolder ?? \"/\";\r\n  }\r\n\r\n  private resolveHostPathForMounted(filePath: string): string | null {\r\n    if (this.currentWorkspacePath) {\r\n      const normalizedFilePath = filePath.replaceAll(\"\\\\\", \"/\");\r\n      const normalizedHostRoot = stripTrailingSlashes(\r\n        this.currentWorkspacePath.replaceAll(\"\\\\\", \"/\")\r\n      );\r\n      if (\r\n        normalizedFilePath === normalizedHostRoot ||\r\n        normalizedFilePath.startsWith(`${normalizedHostRoot}/`)\r\n      ) {\r\n        return filePath;\r\n      }\r\n    }\r\n\r\n    return this.mapContainerPathToHost(filePath);\r\n  }\r\n\r\n  private quoteForContainer(filePath: string): string {\r\n    if (filePath === \"~\" || filePath.startsWith(\"~/\")) {\r\n      return expandTildeForSSH(filePath);\r\n    }\r\n    return shescape.quote(filePath);\r\n  }\r\n\r\n  /**\r\n   * Expand tilde in file paths for container operations.\r\n   * Returns unexpanded path when container user is unknown (before ensureReady).\r\n   * Callers must check for unexpanded tilde and handle appropriately.\r\n   */\r\n  private expandTildeForContainer(filePath: string): string {\r\n    if (filePath === \"~\" || filePath.startsWith(\"~/\")) {\r\n      // If we know the home directory, use it\r\n      if (this.remoteHomeDir) {\r\n        return filePath === \"~\" ? this.remoteHomeDir : this.remoteHomeDir + filePath.slice(1);\r\n      }\r\n      // If we know the user, derive home directory\r\n      if (this.remoteUser !== undefined) {\r\n        const homeDir = this.remoteUser === \"root\" ? \"/root\" : `/home/${this.remoteUser}`;\r\n        return filePath === \"~\" ? homeDir : homeDir + filePath.slice(1);\r\n      }\r\n      // User unknown - return unexpanded to signal caller should handle\r\n      return filePath;\r\n    }\r\n    return filePath;\r\n  }\r\n\r\n  /**\r\n   * Check if a path contains unexpanded tilde (container user unknown).\r\n   */\r\n  private hasUnexpandedTilde(filePath: string): boolean {\r\n    return filePath === \"~\" || filePath.startsWith(\"~/\");\r\n  }\r\n\r\n  private async setupCredentials(env?: Record<string, string>): Promise<void> {\r\n    if (!this.shareCredentials) return;\r\n\r\n    const gitconfigContents = await readHostGitconfig();\r\n    if (gitconfigContents) {\r\n      const stream = await this.exec('cat > \"$HOME/.gitconfig\"', {\r\n        cwd: this.getContainerBasePath(),\r\n        timeout: 30,\r\n      });\r\n      const writer = stream.stdin.getWriter();\r\n      try {\r\n        await writer.write(gitconfigContents);\r\n      } finally {\r\n        writer.releaseLock();\r\n      }\r\n      await stream.stdin.close();\r\n      const exitCode = await stream.exitCode;\r\n      if (exitCode !== 0) {\r\n        const stderr = await streamToString(stream.stderr);\r\n        throw new RuntimeError(`Failed to copy gitconfig: ${stderr}`, \"file_io\");\r\n      }\r\n    }\r\n\r\n    const ghToken = resolveGhToken(env);\r\n    if (ghToken) {\r\n      const stream = await this.exec(\"command -v gh >/dev/null && gh auth setup-git || true\", {\r\n        cwd: this.getContainerBasePath(),\r\n        timeout: 30,\r\n        env: { GH_TOKEN: ghToken },\r\n      });\r\n      await stream.stdin.close();\r\n      await stream.exitCode;\r\n    }\r\n  }\r\n\r\n  private async fetchRemoteHome(): Promise<void> {\r\n    if (!this.currentWorkspacePath) return;\r\n    try {\r\n      const stream = await this.exec('printf \"%s\" \"$HOME\"', {\r\n        cwd: this.remoteWorkspaceFolder ?? \"/\",\r\n        timeout: 10,\r\n      });\r\n      await stream.stdin.close();\r\n      const stdout = await streamToString(stream.stdout);\r\n      const exitCode = await stream.exitCode;\r\n      if (exitCode === 0 && stdout.trim()) {\r\n        this.remoteHomeDir = stdout.trim();\r\n      }\r\n    } catch {\r\n      // Best-effort; keep going if $HOME cannot be resolved\r\n    }\r\n  }\r\n\r\n  private readFileViaExec(filePath: string, abortSignal?: AbortSignal): ReadableStream<Uint8Array> {\r\n    return new ReadableStream<Uint8Array>({\r\n      start: async (controller) => {\r\n        try {\r\n          const stream = await this.exec(`cat ${this.quoteForContainer(filePath)}`, {\r\n            cwd: this.getContainerBasePath(),\r\n            timeout: 300,\r\n            abortSignal,\r\n          });\r\n\r\n          const reader = stream.stdout.getReader();\r\n          const exitCodePromise = stream.exitCode;\r\n\r\n          while (true) {\r\n            const { done, value } = await reader.read();\r\n            if (done) break;\r\n            controller.enqueue(value);\r\n          }\r\n\r\n          const code = await exitCodePromise;\r\n          if (code !== 0) {\r\n            const stderr = await streamToString(stream.stderr);\r\n            throw new RuntimeError(`Failed to read file ${filePath}: ${stderr}`, \"file_io\");\r\n          }\r\n\r\n          controller.close();\r\n        } catch (err) {\r\n          if (err instanceof RuntimeError) {\r\n            controller.error(err);\r\n          } else {\r\n            controller.error(\r\n              new RuntimeError(\r\n                `Failed to read file ${filePath}: ${err instanceof Error ? err.message : String(err)}`,\r\n                \"file_io\",\r\n                err instanceof Error ? err : undefined\r\n              )\r\n            );\r\n          }\r\n        }\r\n      },\r\n    });\r\n  }\r\n\r\n  private writeFileViaExec(\r\n    filePath: string,\r\n    abortSignal?: AbortSignal\r\n  ): WritableStream<Uint8Array> {\r\n    const quotedPath = this.quoteForContainer(filePath);\r\n    const tempPath = `${filePath}.tmp.${Date.now()}`;\r\n    const quotedTempPath = this.quoteForContainer(tempPath);\r\n    const writeCommand = `mkdir -p $(dirname ${quotedPath}) && cat > ${quotedTempPath} && mv ${quotedTempPath} ${quotedPath}`;\r\n\r\n    let execPromise: Promise<ExecStream> | null = null;\r\n\r\n    const getExecStream = () => {\r\n      execPromise ??= this.exec(writeCommand, {\r\n        cwd: this.getContainerBasePath(),\r\n        timeout: 300,\r\n        abortSignal,\r\n      });\r\n      return execPromise;\r\n    };\r\n\r\n    return new WritableStream<Uint8Array>({\r\n      write: async (chunk) => {\r\n        const stream = await getExecStream();\r\n        const writer = stream.stdin.getWriter();\r\n        try {\r\n          await writer.write(chunk);\r\n        } finally {\r\n          writer.releaseLock();\r\n        }\r\n      },\r\n      close: async () => {\r\n        const stream = await getExecStream();\r\n        await stream.stdin.close();\r\n        const exitCode = await stream.exitCode;\r\n\r\n        if (exitCode !== 0) {\r\n          const stderr = await streamToString(stream.stderr);\r\n          throw new RuntimeError(`Failed to write file ${filePath}: ${stderr}`, \"file_io\");\r\n        }\r\n      },\r\n      abort: async (reason?: unknown) => {\r\n        const stream = await getExecStream();\r\n        await stream.stdin.abort();\r\n        throw new RuntimeError(`Failed to write file ${filePath}: ${String(reason)}`, \"file_io\");\r\n      },\r\n    });\r\n  }\r\n\r\n  private async ensureDirViaExec(dirPath: string): Promise<void> {\r\n    const stream = await this.exec(`mkdir -p ${this.quoteForContainer(dirPath)}`, {\r\n      cwd: \"/\",\r\n      timeout: 10,\r\n    });\r\n\r\n    await stream.stdin.close();\r\n\r\n    const [stdout, stderr, exitCode] = await Promise.all([\r\n      streamToString(stream.stdout),\r\n      streamToString(stream.stderr),\r\n      stream.exitCode,\r\n    ]);\r\n\r\n    if (exitCode !== 0) {\r\n      const extra = stderr.trim() || stdout.trim();\r\n      throw new RuntimeError(\r\n        `Failed to create directory ${dirPath}: exit code ${exitCode}${extra ? `: ${extra}` : \"\"}`,\r\n        \"file_io\"\r\n      );\r\n    }\r\n  }\r\n\r\n  private async statViaExec(filePath: string, abortSignal?: AbortSignal): Promise<FileStat> {\r\n    // -L follows symlinks so symlinked paths report the target's type\r\n    const stream = await this.exec(`stat -L -c '%s %Y %F' ${this.quoteForContainer(filePath)}`, {\r\n      cwd: this.getContainerBasePath(),\r\n      timeout: 10,\r\n      abortSignal,\r\n    });\r\n\r\n    const [stdout, stderr, exitCode] = await Promise.all([\r\n      streamToString(stream.stdout),\r\n      streamToString(stream.stderr),\r\n      stream.exitCode,\r\n    ]);\r\n\r\n    if (exitCode !== 0) {\r\n      throw new RuntimeError(`Failed to stat ${filePath}: ${stderr}`, \"file_io\");\r\n    }\r\n\r\n    const parts = stdout.trim().split(\" \");\r\n    if (parts.length < 3) {\r\n      throw new RuntimeError(`Failed to parse stat output for ${filePath}: ${stdout}`, \"file_io\");\r\n    }\r\n\r\n    const size = parseInt(parts[0], 10);\r\n    const mtime = parseInt(parts[1], 10);\r\n    const fileType = parts.slice(2).join(\" \");\r\n\r\n    return {\r\n      size,\r\n      modifiedTime: new Date(mtime * 1000),\r\n      isDirectory: fileType === \"directory\",\r\n    };\r\n  }\r\n  private mapHostPathToContainer(hostPath: string): string | null {\r\n    if (!this.remoteWorkspaceFolder || !this.currentWorkspacePath) return null;\r\n\r\n    // Normalize to forward slashes for cross-platform comparison (Windows uses backslashes)\r\n    const normalizedHostPath = hostPath.replaceAll(\"\\\\\", \"/\");\r\n    const hostRoot = this.currentWorkspacePath.replaceAll(\"\\\\\", \"/\").replace(/\\/+$/, \"\");\r\n    if (normalizedHostPath !== hostRoot && !normalizedHostPath.startsWith(`${hostRoot}/`))\r\n      return null;\r\n\r\n    const suffix = normalizedHostPath.slice(hostRoot.length).replace(/^\\/+/, \"\");\r\n    return suffix.length === 0\r\n      ? this.remoteWorkspaceFolder\r\n      : path.posix.join(this.remoteWorkspaceFolder, suffix);\r\n  }\r\n\r\n  /**\r\n   * Resolve cwd for container exec, filtering out unmappable host paths.\r\n   * Only uses options.cwd if it looks like a valid container path (POSIX absolute, no Windows drive letters).\r\n   */\r\n  private resolveContainerCwd(optionsCwd: string | undefined, workspaceFolder: string): string {\r\n    if (optionsCwd && this.looksLikeContainerPath(optionsCwd)) {\r\n      return optionsCwd;\r\n    }\r\n    return this.remoteWorkspaceFolder ?? workspaceFolder;\r\n  }\r\n\r\n  /**\r\n   * Check if a path looks like a valid container path (POSIX absolute, no Windows artifacts).\r\n   */\r\n  private looksLikeContainerPath(p: string): boolean {\r\n    // Reject Windows drive letters (e.g., C:\\, D:/)\r\n    if (/^[A-Za-z]:/.test(p)) return false;\r\n    // Reject backslashes (Windows path separators)\r\n    if (p.includes(\"\\\\\")) return false;\r\n    // Must be absolute POSIX path\r\n    return p.startsWith(\"/\");\r\n  }\r\n\r\n  constructor(options: DevcontainerRuntimeOptions) {\r\n    super();\r\n    this.worktreeManager = new WorktreeManager(options.srcBaseDir);\r\n    this.configPath = options.configPath;\r\n    this.shareCredentials = options.shareCredentials ?? false;\r\n  }\r\n\r\n  getWorkspacePath(projectPath: string, workspaceName: string): string {\r\n    return this.worktreeManager.getWorkspacePath(projectPath, workspaceName);\r\n  }\r\n\r\n  async createWorkspace(params: WorkspaceCreationParams): Promise<WorkspaceCreationResult> {\r\n    return this.worktreeManager.createWorkspace({\r\n      projectPath: params.projectPath,\r\n      branchName: params.branchName,\r\n      trunkBranch: params.trunkBranch,\r\n      initLogger: params.initLogger,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Build and start the devcontainer after workspace creation.\r\n   * This runs `devcontainer up` which builds the image and starts the container.\r\n   */\r\n  async postCreateSetup(params: WorkspaceInitParams): Promise<void> {\r\n    const { workspacePath, initLogger, abortSignal, env } = params;\r\n\r\n    initLogger.logStep(\"Building devcontainer...\");\r\n\r\n    this.lastCredentialEnv = env;\r\n    const { additionalMounts, remoteEnv } = this.buildCredentialForwarding(env);\r\n\r\n    try {\r\n      const result = await devcontainerUp({\r\n        workspaceFolder: workspacePath,\r\n        configPath: this.configPath,\r\n        initLogger,\r\n        abortSignal,\r\n        additionalMounts: additionalMounts.length > 0 ? additionalMounts : undefined,\r\n        remoteEnv: Object.keys(remoteEnv).length > 0 ? remoteEnv : undefined,\r\n      });\r\n\r\n      // Cache container info\r\n      this.remoteWorkspaceFolder = result.remoteWorkspaceFolder;\r\n      this.remoteUser = result.remoteUser;\r\n      this.currentWorkspacePath = workspacePath;\r\n      await this.fetchRemoteHome();\r\n\r\n      await this.setupCredentials(env);\r\n\r\n      initLogger.logStep(\"Devcontainer ready\");\r\n    } catch (error) {\r\n      throw new Error(`Failed to start devcontainer: ${getErrorMessage(error)}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Run .mux/init hook inside the devcontainer.\r\n   */\r\n  async initWorkspace(params: WorkspaceInitParams): Promise<WorkspaceInitResult> {\r\n    const { projectPath, branchName, workspacePath, initLogger, env } = params;\r\n\r\n    try {\r\n      // Check if init hook exists (on host - worktree is bind-mounted)\r\n      const hookExists = await checkInitHookExists(workspacePath);\r\n      if (hookExists) {\r\n        initLogger.enterHookPhase?.();\r\n        const muxEnv = { ...env, ...getMuxEnv(projectPath, \"devcontainer\", branchName) };\r\n        const containerWorkspacePath = this.remoteWorkspaceFolder ?? workspacePath;\r\n        const hookPath = `${containerWorkspacePath}/.mux/init`;\r\n        await runInitHookOnRuntime(this, hookPath, containerWorkspacePath, muxEnv, initLogger);\r\n      } else {\r\n        // No hook - signal completion immediately\r\n        initLogger.logComplete(0);\r\n      }\r\n      return { success: true };\r\n    } catch (error) {\r\n      const errorMsg = getErrorMessage(error);\r\n      initLogger.logStderr(`Initialization failed: ${errorMsg}`);\r\n      initLogger.logComplete(-1);\r\n      return {\r\n        success: false,\r\n        error: errorMsg,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute a command inside the devcontainer.\r\n   * Overrides LocalBaseRuntime.exec() to use `devcontainer exec`.\r\n   */\r\n  override exec(command: string, options: ExecOptions): Promise<ExecStream> {\r\n    const startTime = performance.now();\r\n\r\n    // Short-circuit if already aborted\r\n    if (options.abortSignal?.aborted) {\r\n      throw new RuntimeError(\"Operation aborted before execution\", \"exec\");\r\n    }\r\n\r\n    // Build devcontainer exec args\r\n    const workspaceFolder = this.currentWorkspacePath;\r\n    if (!workspaceFolder) {\r\n      throw new RuntimeError(\"Devcontainer not initialized. Call ensureReady() first.\", \"exec\");\r\n    }\r\n\r\n    const args = [\"exec\", \"--workspace-folder\", workspaceFolder];\r\n\r\n    if (this.configPath) {\r\n      args.push(\"--config\", this.configPath);\r\n    }\r\n\r\n    // Add environment variables\r\n    const envVars = { ...options.env, ...NON_INTERACTIVE_ENV_VARS };\r\n    for (const [key, value] of Object.entries(envVars)) {\r\n      args.push(\"--remote-env\", `${key}=${value}`);\r\n    }\r\n\r\n    // Build the full command with cd\r\n    // Map host workspace path to container path; fall back to container workspace if unmappable\r\n    const mappedCwd = options.cwd ? this.mapHostPathToContainer(options.cwd) : null;\r\n    const cwd = mappedCwd ?? this.resolveContainerCwd(options.cwd, workspaceFolder);\r\n    const fullCommand = `cd ${JSON.stringify(cwd)} && ${command}`;\r\n    args.push(\"--\", \"bash\", \"-c\", fullCommand);\r\n\r\n    const childProcess = spawn(\"devcontainer\", args, {\r\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\r\n      detached: true,\r\n      windowsHide: true,\r\n      cwd: workspaceFolder,\r\n    });\r\n\r\n    const disposable = new DisposableProcess(childProcess);\r\n\r\n    // Convert Node.js streams to Web Streams (casts required for ExecStream compatibility)\r\n    /* eslint-disable @typescript-eslint/no-unnecessary-type-assertion */\r\n    const stdout = Readable.toWeb(childProcess.stdout!) as unknown as ReadableStream<Uint8Array>;\r\n    const stderr = Readable.toWeb(childProcess.stderr!) as unknown as ReadableStream<Uint8Array>;\r\n    const stdin = Writable.toWeb(childProcess.stdin!) as unknown as WritableStream<Uint8Array>;\r\n    /* eslint-enable @typescript-eslint/no-unnecessary-type-assertion */\r\n\r\n    let timedOut = false;\r\n    let aborted = false;\r\n\r\n    const exitCode = new Promise<number>((resolve, reject) => {\r\n      childProcess.on(\"exit\", (code) => {\r\n        if (childProcess.pid !== undefined) {\r\n          killProcessTree(childProcess.pid);\r\n        }\r\n\r\n        if (aborted || options.abortSignal?.aborted) {\r\n          resolve(EXIT_CODE_ABORTED);\r\n          return;\r\n        }\r\n        if (timedOut) {\r\n          resolve(EXIT_CODE_TIMEOUT);\r\n          return;\r\n        }\r\n        resolve(code ?? 0);\r\n      });\r\n\r\n      childProcess.on(\"error\", (err) => {\r\n        reject(\r\n          new RuntimeError(`Failed to execute devcontainer exec: ${err.message}`, \"exec\", err)\r\n        );\r\n      });\r\n    });\r\n\r\n    const duration = exitCode.then(() => performance.now() - startTime);\r\n    void exitCode.catch(() => undefined);\r\n    void duration.catch(() => undefined);\r\n\r\n    // Handle timeout\r\n    let timeoutId: ReturnType<typeof setTimeout> | undefined;\r\n    if (options.timeout && options.timeout > 0) {\r\n      timeoutId = setTimeout(() => {\r\n        timedOut = true;\r\n        disposable[Symbol.dispose]();\r\n      }, options.timeout * 1000);\r\n\r\n      void exitCode.finally(() => {\r\n        if (timeoutId) clearTimeout(timeoutId);\r\n      });\r\n    }\r\n\r\n    // Handle abort signal\r\n    const abortHandler = () => {\r\n      aborted = true;\r\n      disposable[Symbol.dispose]();\r\n    };\r\n    options.abortSignal?.addEventListener(\"abort\", abortHandler);\r\n    void exitCode.finally(() => {\r\n      options.abortSignal?.removeEventListener(\"abort\", abortHandler);\r\n    });\r\n\r\n    return Promise.resolve({\r\n      stdout,\r\n      stderr,\r\n      stdin,\r\n      exitCode,\r\n      duration,\r\n    });\r\n  }\r\n\r\n  override readFile(filePath: string, abortSignal?: AbortSignal): ReadableStream<Uint8Array> {\r\n    const hostPath = this.resolveHostPathForMounted(filePath);\r\n    if (hostPath) {\r\n      return super.readFile(hostPath, abortSignal);\r\n    }\r\n    return this.readFileViaExec(filePath, abortSignal);\r\n  }\r\n\r\n  override writeFile(filePath: string, abortSignal?: AbortSignal): WritableStream<Uint8Array> {\r\n    const hostPath = this.resolveHostPathForMounted(filePath);\r\n    if (hostPath) {\r\n      return super.writeFile(hostPath, abortSignal);\r\n    }\r\n    return this.writeFileViaExec(filePath, abortSignal);\r\n  }\r\n\r\n  override async stat(filePath: string): Promise<FileStat> {\r\n    const hostPath = this.resolveHostPathForMounted(filePath);\r\n    if (hostPath) {\r\n      return super.stat(hostPath);\r\n    }\r\n    return this.statViaExec(filePath);\r\n  }\r\n\r\n  override async ensureDir(dirPath: string): Promise<void> {\r\n    const hostPath = this.resolveHostPathForMounted(dirPath);\r\n    if (hostPath) {\r\n      return super.ensureDir(hostPath);\r\n    }\r\n    return this.ensureDirViaExec(dirPath);\r\n  }\r\n\r\n  override async resolvePath(filePath: string): Promise<string> {\r\n    let expanded = this.expandTildeForContainer(filePath);\r\n\r\n    if (this.hasUnexpandedTilde(expanded)) {\r\n      await this.fetchRemoteHome();\r\n      if (this.remoteHomeDir) {\r\n        expanded = filePath === \"~\" ? this.remoteHomeDir : this.remoteHomeDir + filePath.slice(1);\r\n      } else {\r\n        throw new RuntimeError(\r\n          `Failed to resolve path ${filePath}: container home directory unavailable`,\r\n          \"exec\"\r\n        );\r\n      }\r\n    }\r\n\r\n    // Resolve relative paths against container workspace (avoid host cwd leakage)\r\n    if (!expanded.startsWith(\"/\")) {\r\n      const basePath = this.remoteWorkspaceFolder ?? \"/\";\r\n      return path.posix.resolve(basePath, expanded);\r\n    }\r\n\r\n    // For absolute paths, resolve using posix (container is Linux)\r\n    return path.posix.resolve(expanded);\r\n  }\r\n\r\n  override tempDir(): Promise<string> {\r\n    const workspaceRoot = this.remoteWorkspaceFolder ?? this.currentWorkspacePath;\r\n    if (!workspaceRoot) {\r\n      return super.tempDir();\r\n    }\r\n\r\n    const tmpPath = this.remoteWorkspaceFolder\r\n      ? path.posix.join(workspaceRoot, \".mux\", \"tmp\")\r\n      : path.join(workspaceRoot, \".mux\", \"tmp\");\r\n    return Promise.resolve(tmpPath);\r\n  }\r\n\r\n  /**\r\n   * Ensure the devcontainer is ready for operations.\r\n   * Runs `devcontainer up` which starts the container if stopped,\r\n   * or rebuilds if the container was deleted.\r\n   */\r\n  override async ensureReady(options?: EnsureReadyOptions): Promise<EnsureReadyResult> {\r\n    if (!this.currentWorkspacePath) {\r\n      return {\r\n        ready: false,\r\n        error: \"Workspace path not set. Call postCreateSetup() first.\",\r\n        errorType: \"runtime_not_ready\",\r\n      };\r\n    }\r\n\r\n    const statusSink = options?.statusSink;\r\n    statusSink?.({\r\n      phase: \"checking\",\r\n      runtimeType: \"devcontainer\",\r\n      detail: \"Checking repository...\",\r\n    });\r\n\r\n    const hasRepo = await isGitRepository(this.currentWorkspacePath);\r\n    if (!hasRepo) {\r\n      statusSink?.({\r\n        phase: \"error\",\r\n        runtimeType: \"devcontainer\",\r\n        detail: WORKSPACE_REPO_MISSING_ERROR,\r\n      });\r\n      return {\r\n        ready: false,\r\n        error: WORKSPACE_REPO_MISSING_ERROR,\r\n        errorType: \"runtime_not_ready\",\r\n      };\r\n    }\r\n\r\n    try {\r\n      statusSink?.({\r\n        phase: \"starting\",\r\n        runtimeType: \"devcontainer\",\r\n        detail: \"Starting devcontainer...\",\r\n      });\r\n\r\n      // Create a minimal logger for ensureReady (we don't want verbose output here)\r\n      const silentLogger = {\r\n        logStep: (_message: string) => {\r\n          /* silent */\r\n        },\r\n        logStdout: (_line: string) => {\r\n          /* silent */\r\n        },\r\n        logStderr: (line: string) => log.debug(\"devcontainer up stderr:\", { line }),\r\n        logComplete: (_exitCode: number) => {\r\n          /* silent */\r\n        },\r\n      };\r\n\r\n      const { additionalMounts, remoteEnv } = this.buildCredentialForwarding(\r\n        this.lastCredentialEnv\r\n      );\r\n      const result = await devcontainerUp({\r\n        workspaceFolder: this.currentWorkspacePath,\r\n        configPath: this.configPath,\r\n        initLogger: silentLogger,\r\n        abortSignal: options?.signal,\r\n        additionalMounts: additionalMounts.length > 0 ? additionalMounts : undefined,\r\n        remoteEnv: Object.keys(remoteEnv).length > 0 ? remoteEnv : undefined,\r\n      });\r\n\r\n      // Update cached info (container may have been rebuilt)\r\n      this.remoteWorkspaceFolder = result.remoteWorkspaceFolder;\r\n      this.remoteUser = result.remoteUser;\r\n      await this.fetchRemoteHome();\r\n\r\n      await this.setupCredentials(this.lastCredentialEnv);\r\n\r\n      statusSink?.({ phase: \"ready\", runtimeType: \"devcontainer\" });\r\n      return { ready: true };\r\n    } catch (error) {\r\n      const errorMsg = getErrorMessage(error);\r\n      statusSink?.({ phase: \"error\", runtimeType: \"devcontainer\", detail: errorMsg });\r\n\r\n      return {\r\n        ready: false,\r\n        error: errorMsg,\r\n        errorType: \"runtime_not_ready\",\r\n      };\r\n    }\r\n  }\r\n\r\n  async renameWorkspace(\r\n    projectPath: string,\r\n    oldName: string,\r\n    newName: string,\r\n    _abortSignal?: AbortSignal\r\n  ): Promise<\r\n    { success: true; oldPath: string; newPath: string } | { success: false; error: string }\r\n  > {\r\n    // Stop container before rename (container labels reference old path)\r\n    const oldPath = this.getWorkspacePath(projectPath, oldName);\r\n    await devcontainerDown(oldPath, this.configPath);\r\n\r\n    // Rename worktree on host\r\n    const result = await this.worktreeManager.renameWorkspace(projectPath, oldName, newName);\r\n\r\n    if (result.success) {\r\n      // Update current workspace path if this was the active workspace\r\n      if (this.currentWorkspacePath === oldPath) {\r\n        this.currentWorkspacePath = result.newPath;\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  async deleteWorkspace(\r\n    projectPath: string,\r\n    workspaceName: string,\r\n    force: boolean,\r\n    _abortSignal?: AbortSignal\r\n  ): Promise<{ success: true; deletedPath: string } | { success: false; error: string }> {\r\n    const workspacePath = this.getWorkspacePath(projectPath, workspaceName);\r\n\r\n    // Stop and remove container (best-effort)\r\n    try {\r\n      await devcontainerDown(workspacePath, this.configPath);\r\n    } catch (error) {\r\n      log.debug(\"devcontainerDown failed (container may not exist):\", { error });\r\n    }\r\n\r\n    // Delete worktree on host\r\n    return this.worktreeManager.deleteWorkspace(projectPath, workspaceName, force);\r\n  }\r\n\r\n  async forkWorkspace(params: WorkspaceForkParams): Promise<WorkspaceForkResult> {\r\n    // Fork creates a new worktree - container will be built on first ensureReady\r\n    return this.worktreeManager.forkWorkspace(params);\r\n  }\r\n\r\n  /**\r\n   * Set the current workspace path for exec operations.\r\n   * Called by workspaceService when switching to an existing workspace.\r\n   */\r\n  setCurrentWorkspacePath(workspacePath: string): void {\r\n    this.currentWorkspacePath = workspacePath;\r\n  }\r\n\r\n  /**\r\n   * Get the remote workspace folder path (inside container).\r\n   */\r\n  getRemoteWorkspaceFolder(): string | undefined {\r\n    return this.remoteWorkspaceFolder;\r\n  }\r\n}\r\n"]}