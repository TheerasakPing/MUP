{"version":3,"file":"DevcontainerRuntime.js","sourceRoot":"","sources":["../../../src/node/runtime/DevcontainerRuntime.ts"],"names":[],"mappings":"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","sourcesContent":["import { spawn } from \"child_process\";\nimport * as path from \"path\";\nimport { Readable, Writable } from \"stream\";\nimport type {\n  RuntimeCreateFlags,\n  WorkspaceCreationParams,\n  WorkspaceCreationResult,\n  WorkspaceForkParams,\n  WorkspaceForkResult,\n  WorkspaceInitParams,\n  WorkspaceInitResult,\n  ExecOptions,\n  ExecStream,\n  EnsureReadyResult,\n  EnsureReadyOptions,\n  FileStat,\n} from \"./Runtime\";\nimport { RuntimeError, WORKSPACE_REPO_MISSING_ERROR } from \"./Runtime\";\nimport { LocalBaseRuntime } from \"./LocalBaseRuntime\";\nimport { WorktreeManager } from \"@/node/worktree/WorktreeManager\";\nimport { expandTildeForSSH } from \"./tildeExpansion\";\nimport { shescape, streamToString } from \"./streamUtils\";\nimport {\n  readHostGitconfig,\n  resolveGhToken,\n  resolveSshAgentForwarding,\n} from \"./credentialForwarding\";\nimport { devcontainerUp, devcontainerDown } from \"./devcontainerCli\";\nimport { checkInitHookExists, getMuxEnv } from \"./initHook\";\nimport { runInitHookOnRuntime } from \"./initHook\";\nimport { DisposableProcess, killProcessTree } from \"@/node/utils/disposableExec\";\nimport { EXIT_CODE_ABORTED, EXIT_CODE_TIMEOUT } from \"@/common/constants/exitCodes\";\nimport { NON_INTERACTIVE_ENV_VARS } from \"@/common/constants/env\";\nimport { getErrorMessage } from \"@/common/utils/errors\";\nimport { log } from \"@/node/services/log\";\nimport { isGitRepository, stripTrailingSlashes } from \"@/node/utils/pathUtils\";\n\nexport interface DevcontainerRuntimeOptions {\n  srcBaseDir: string;\n  configPath: string;\n  shareCredentials?: boolean;\n}\n\n/**\n * Devcontainer runtime implementation.\n *\n * This runtime creates git worktrees on the host and runs commands inside\n * a devcontainer built from the project's devcontainer.json configuration.\n *\n * Architecture:\n * - Worktree operations (create/delete/fork) → WorktreeManager (host filesystem)\n * - Command execution (exec) → devcontainer exec (inside container)\n * - File I/O → host fs (worktree is bind-mounted into container)\n * - ensureReady → devcontainer up (starts/rebuilds container as needed)\n */\nexport class DevcontainerRuntime extends LocalBaseRuntime {\n  private readonly worktreeManager: WorktreeManager;\n  private readonly configPath: string;\n\n  // Cached env used for credential forwarding\n  private lastCredentialEnv?: Record<string, string>;\n  private readonly shareCredentials: boolean;\n\n  // Cached from devcontainer up output\n  private remoteHomeDir?: string;\n  private remoteWorkspaceFolder?: string;\n  private remoteUser?: string;\n\n  // Current workspace context (set during postCreateSetup/ensureReady)\n  private currentWorkspacePath?: string;\n\n  readonly createFlags: RuntimeCreateFlags = {\n    deferredRuntimeAccess: true,\n  };\n\n  private buildCredentialForwarding(env?: Record<string, string>): {\n    additionalMounts: string[];\n    remoteEnv: Record<string, string>;\n  } {\n    const additionalMounts: string[] = [];\n    const remoteEnv: Record<string, string> = {};\n\n    if (!this.shareCredentials) {\n      return { additionalMounts, remoteEnv };\n    }\n\n    const sshForwarding = resolveSshAgentForwarding(\"/tmp/ssh-agent.sock\");\n    if (sshForwarding) {\n      additionalMounts.push(\n        `type=bind,source=${sshForwarding.hostSocketPath},target=${sshForwarding.targetSocketPath}`\n      );\n      remoteEnv.SSH_AUTH_SOCK = sshForwarding.targetSocketPath;\n    }\n\n    const ghToken = resolveGhToken(env);\n    if (ghToken) {\n      remoteEnv.GH_TOKEN = ghToken;\n    }\n\n    return { additionalMounts, remoteEnv };\n  }\n\n  private mapContainerPathToHost(containerPath: string): string | null {\n    if (!this.remoteWorkspaceFolder || !this.currentWorkspacePath) return null;\n\n    const remoteRoot = this.remoteWorkspaceFolder.replace(/\\/+$/, \"\");\n    if (containerPath !== remoteRoot && !containerPath.startsWith(`${remoteRoot}/`)) return null;\n\n    const suffix = containerPath.slice(remoteRoot.length).replace(/^\\/+/, \"\");\n    return suffix.length === 0\n      ? this.currentWorkspacePath\n      : path.join(this.currentWorkspacePath, suffix);\n  }\n\n  private getContainerBasePath(): string {\n    return this.remoteWorkspaceFolder ?? \"/\";\n  }\n\n  private resolveHostPathForMounted(filePath: string): string | null {\n    if (this.currentWorkspacePath) {\n      const normalizedFilePath = filePath.replaceAll(\"\\\\\", \"/\");\n      const normalizedHostRoot = stripTrailingSlashes(\n        this.currentWorkspacePath.replaceAll(\"\\\\\", \"/\")\n      );\n      if (\n        normalizedFilePath === normalizedHostRoot ||\n        normalizedFilePath.startsWith(`${normalizedHostRoot}/`)\n      ) {\n        return filePath;\n      }\n    }\n\n    return this.mapContainerPathToHost(filePath);\n  }\n\n  private quoteForContainer(filePath: string): string {\n    if (filePath === \"~\" || filePath.startsWith(\"~/\")) {\n      return expandTildeForSSH(filePath);\n    }\n    return shescape.quote(filePath);\n  }\n\n  /**\n   * Expand tilde in file paths for container operations.\n   * Returns unexpanded path when container user is unknown (before ensureReady).\n   * Callers must check for unexpanded tilde and handle appropriately.\n   */\n  private expandTildeForContainer(filePath: string): string {\n    if (filePath === \"~\" || filePath.startsWith(\"~/\")) {\n      // If we know the home directory, use it\n      if (this.remoteHomeDir) {\n        return filePath === \"~\" ? this.remoteHomeDir : this.remoteHomeDir + filePath.slice(1);\n      }\n      // If we know the user, derive home directory\n      if (this.remoteUser !== undefined) {\n        const homeDir = this.remoteUser === \"root\" ? \"/root\" : `/home/${this.remoteUser}`;\n        return filePath === \"~\" ? homeDir : homeDir + filePath.slice(1);\n      }\n      // User unknown - return unexpanded to signal caller should handle\n      return filePath;\n    }\n    return filePath;\n  }\n\n  /**\n   * Check if a path contains unexpanded tilde (container user unknown).\n   */\n  private hasUnexpandedTilde(filePath: string): boolean {\n    return filePath === \"~\" || filePath.startsWith(\"~/\");\n  }\n\n  private async setupCredentials(env?: Record<string, string>): Promise<void> {\n    if (!this.shareCredentials) return;\n\n    const gitconfigContents = await readHostGitconfig();\n    if (gitconfigContents) {\n      const stream = await this.exec('cat > \"$HOME/.gitconfig\"', {\n        cwd: this.getContainerBasePath(),\n        timeout: 30,\n      });\n      const writer = stream.stdin.getWriter();\n      try {\n        await writer.write(gitconfigContents);\n      } finally {\n        writer.releaseLock();\n      }\n      await stream.stdin.close();\n      const exitCode = await stream.exitCode;\n      if (exitCode !== 0) {\n        const stderr = await streamToString(stream.stderr);\n        throw new RuntimeError(`Failed to copy gitconfig: ${stderr}`, \"file_io\");\n      }\n    }\n\n    const ghToken = resolveGhToken(env);\n    if (ghToken) {\n      const stream = await this.exec(\"command -v gh >/dev/null && gh auth setup-git || true\", {\n        cwd: this.getContainerBasePath(),\n        timeout: 30,\n        env: { GH_TOKEN: ghToken },\n      });\n      await stream.stdin.close();\n      await stream.exitCode;\n    }\n  }\n\n  private async fetchRemoteHome(): Promise<void> {\n    if (!this.currentWorkspacePath) return;\n    try {\n      const stream = await this.exec('printf \"%s\" \"$HOME\"', {\n        cwd: this.remoteWorkspaceFolder ?? \"/\",\n        timeout: 10,\n      });\n      await stream.stdin.close();\n      const stdout = await streamToString(stream.stdout);\n      const exitCode = await stream.exitCode;\n      if (exitCode === 0 && stdout.trim()) {\n        this.remoteHomeDir = stdout.trim();\n      }\n    } catch {\n      // Best-effort; keep going if $HOME cannot be resolved\n    }\n  }\n\n  private readFileViaExec(filePath: string, abortSignal?: AbortSignal): ReadableStream<Uint8Array> {\n    return new ReadableStream<Uint8Array>({\n      start: async (controller) => {\n        try {\n          const stream = await this.exec(`cat ${this.quoteForContainer(filePath)}`, {\n            cwd: this.getContainerBasePath(),\n            timeout: 300,\n            abortSignal,\n          });\n\n          const reader = stream.stdout.getReader();\n          const exitCodePromise = stream.exitCode;\n\n          while (true) {\n            const { done, value } = await reader.read();\n            if (done) break;\n            controller.enqueue(value);\n          }\n\n          const code = await exitCodePromise;\n          if (code !== 0) {\n            const stderr = await streamToString(stream.stderr);\n            throw new RuntimeError(`Failed to read file ${filePath}: ${stderr}`, \"file_io\");\n          }\n\n          controller.close();\n        } catch (err) {\n          if (err instanceof RuntimeError) {\n            controller.error(err);\n          } else {\n            controller.error(\n              new RuntimeError(\n                `Failed to read file ${filePath}: ${err instanceof Error ? err.message : String(err)}`,\n                \"file_io\",\n                err instanceof Error ? err : undefined\n              )\n            );\n          }\n        }\n      },\n    });\n  }\n\n  private writeFileViaExec(\n    filePath: string,\n    abortSignal?: AbortSignal\n  ): WritableStream<Uint8Array> {\n    const quotedPath = this.quoteForContainer(filePath);\n    const tempPath = `${filePath}.tmp.${Date.now()}`;\n    const quotedTempPath = this.quoteForContainer(tempPath);\n    const writeCommand = `mkdir -p $(dirname ${quotedPath}) && cat > ${quotedTempPath} && mv ${quotedTempPath} ${quotedPath}`;\n\n    let execPromise: Promise<ExecStream> | null = null;\n\n    const getExecStream = () => {\n      execPromise ??= this.exec(writeCommand, {\n        cwd: this.getContainerBasePath(),\n        timeout: 300,\n        abortSignal,\n      });\n      return execPromise;\n    };\n\n    return new WritableStream<Uint8Array>({\n      write: async (chunk) => {\n        const stream = await getExecStream();\n        const writer = stream.stdin.getWriter();\n        try {\n          await writer.write(chunk);\n        } finally {\n          writer.releaseLock();\n        }\n      },\n      close: async () => {\n        const stream = await getExecStream();\n        await stream.stdin.close();\n        const exitCode = await stream.exitCode;\n\n        if (exitCode !== 0) {\n          const stderr = await streamToString(stream.stderr);\n          throw new RuntimeError(`Failed to write file ${filePath}: ${stderr}`, \"file_io\");\n        }\n      },\n      abort: async (reason?: unknown) => {\n        const stream = await getExecStream();\n        await stream.stdin.abort();\n        throw new RuntimeError(`Failed to write file ${filePath}: ${String(reason)}`, \"file_io\");\n      },\n    });\n  }\n\n  private async ensureDirViaExec(dirPath: string): Promise<void> {\n    const stream = await this.exec(`mkdir -p ${this.quoteForContainer(dirPath)}`, {\n      cwd: \"/\",\n      timeout: 10,\n    });\n\n    await stream.stdin.close();\n\n    const [stdout, stderr, exitCode] = await Promise.all([\n      streamToString(stream.stdout),\n      streamToString(stream.stderr),\n      stream.exitCode,\n    ]);\n\n    if (exitCode !== 0) {\n      const extra = stderr.trim() || stdout.trim();\n      throw new RuntimeError(\n        `Failed to create directory ${dirPath}: exit code ${exitCode}${extra ? `: ${extra}` : \"\"}`,\n        \"file_io\"\n      );\n    }\n  }\n\n  private async statViaExec(filePath: string, abortSignal?: AbortSignal): Promise<FileStat> {\n    // -L follows symlinks so symlinked paths report the target's type\n    const stream = await this.exec(`stat -L -c '%s %Y %F' ${this.quoteForContainer(filePath)}`, {\n      cwd: this.getContainerBasePath(),\n      timeout: 10,\n      abortSignal,\n    });\n\n    const [stdout, stderr, exitCode] = await Promise.all([\n      streamToString(stream.stdout),\n      streamToString(stream.stderr),\n      stream.exitCode,\n    ]);\n\n    if (exitCode !== 0) {\n      throw new RuntimeError(`Failed to stat ${filePath}: ${stderr}`, \"file_io\");\n    }\n\n    const parts = stdout.trim().split(\" \");\n    if (parts.length < 3) {\n      throw new RuntimeError(`Failed to parse stat output for ${filePath}: ${stdout}`, \"file_io\");\n    }\n\n    const size = parseInt(parts[0], 10);\n    const mtime = parseInt(parts[1], 10);\n    const fileType = parts.slice(2).join(\" \");\n\n    return {\n      size,\n      modifiedTime: new Date(mtime * 1000),\n      isDirectory: fileType === \"directory\",\n    };\n  }\n  private mapHostPathToContainer(hostPath: string): string | null {\n    if (!this.remoteWorkspaceFolder || !this.currentWorkspacePath) return null;\n\n    // Normalize to forward slashes for cross-platform comparison (Windows uses backslashes)\n    const normalizedHostPath = hostPath.replaceAll(\"\\\\\", \"/\");\n    const hostRoot = this.currentWorkspacePath.replaceAll(\"\\\\\", \"/\").replace(/\\/+$/, \"\");\n    if (normalizedHostPath !== hostRoot && !normalizedHostPath.startsWith(`${hostRoot}/`))\n      return null;\n\n    const suffix = normalizedHostPath.slice(hostRoot.length).replace(/^\\/+/, \"\");\n    return suffix.length === 0\n      ? this.remoteWorkspaceFolder\n      : path.posix.join(this.remoteWorkspaceFolder, suffix);\n  }\n\n  /**\n   * Resolve cwd for container exec, filtering out unmappable host paths.\n   * Only uses options.cwd if it looks like a valid container path (POSIX absolute, no Windows drive letters).\n   */\n  private resolveContainerCwd(optionsCwd: string | undefined, workspaceFolder: string): string {\n    if (optionsCwd && this.looksLikeContainerPath(optionsCwd)) {\n      return optionsCwd;\n    }\n    return this.remoteWorkspaceFolder ?? workspaceFolder;\n  }\n\n  /**\n   * Check if a path looks like a valid container path (POSIX absolute, no Windows artifacts).\n   */\n  private looksLikeContainerPath(p: string): boolean {\n    // Reject Windows drive letters (e.g., C:\\, D:/)\n    if (/^[A-Za-z]:/.test(p)) return false;\n    // Reject backslashes (Windows path separators)\n    if (p.includes(\"\\\\\")) return false;\n    // Must be absolute POSIX path\n    return p.startsWith(\"/\");\n  }\n\n  constructor(options: DevcontainerRuntimeOptions) {\n    super();\n    this.worktreeManager = new WorktreeManager(options.srcBaseDir);\n    this.configPath = options.configPath;\n    this.shareCredentials = options.shareCredentials ?? false;\n  }\n\n  getWorkspacePath(projectPath: string, workspaceName: string): string {\n    return this.worktreeManager.getWorkspacePath(projectPath, workspaceName);\n  }\n\n  async createWorkspace(params: WorkspaceCreationParams): Promise<WorkspaceCreationResult> {\n    return this.worktreeManager.createWorkspace({\n      projectPath: params.projectPath,\n      branchName: params.branchName,\n      trunkBranch: params.trunkBranch,\n      initLogger: params.initLogger,\n    });\n  }\n\n  /**\n   * Build and start the devcontainer after workspace creation.\n   * This runs `devcontainer up` which builds the image and starts the container.\n   */\n  async postCreateSetup(params: WorkspaceInitParams): Promise<void> {\n    const { workspacePath, initLogger, abortSignal, env } = params;\n\n    initLogger.logStep(\"Building devcontainer...\");\n\n    this.lastCredentialEnv = env;\n    const { additionalMounts, remoteEnv } = this.buildCredentialForwarding(env);\n\n    try {\n      const result = await devcontainerUp({\n        workspaceFolder: workspacePath,\n        configPath: this.configPath,\n        initLogger,\n        abortSignal,\n        additionalMounts: additionalMounts.length > 0 ? additionalMounts : undefined,\n        remoteEnv: Object.keys(remoteEnv).length > 0 ? remoteEnv : undefined,\n      });\n\n      // Cache container info\n      this.remoteWorkspaceFolder = result.remoteWorkspaceFolder;\n      this.remoteUser = result.remoteUser;\n      this.currentWorkspacePath = workspacePath;\n      await this.fetchRemoteHome();\n\n      await this.setupCredentials(env);\n\n      initLogger.logStep(\"Devcontainer ready\");\n    } catch (error) {\n      throw new Error(`Failed to start devcontainer: ${getErrorMessage(error)}`);\n    }\n  }\n\n  /**\n   * Run .mux/init hook inside the devcontainer.\n   */\n  async initWorkspace(params: WorkspaceInitParams): Promise<WorkspaceInitResult> {\n    const { projectPath, branchName, workspacePath, initLogger, env } = params;\n\n    try {\n      // Check if init hook exists (on host - worktree is bind-mounted)\n      const hookExists = await checkInitHookExists(workspacePath);\n      if (hookExists) {\n        initLogger.enterHookPhase?.();\n        const muxEnv = { ...env, ...getMuxEnv(projectPath, \"devcontainer\", branchName) };\n        const containerWorkspacePath = this.remoteWorkspaceFolder ?? workspacePath;\n        const hookPath = `${containerWorkspacePath}/.mux/init`;\n        await runInitHookOnRuntime(this, hookPath, containerWorkspacePath, muxEnv, initLogger);\n      } else {\n        // No hook - signal completion immediately\n        initLogger.logComplete(0);\n      }\n      return { success: true };\n    } catch (error) {\n      const errorMsg = getErrorMessage(error);\n      initLogger.logStderr(`Initialization failed: ${errorMsg}`);\n      initLogger.logComplete(-1);\n      return {\n        success: false,\n        error: errorMsg,\n      };\n    }\n  }\n\n  /**\n   * Execute a command inside the devcontainer.\n   * Overrides LocalBaseRuntime.exec() to use `devcontainer exec`.\n   */\n  override exec(command: string, options: ExecOptions): Promise<ExecStream> {\n    const startTime = performance.now();\n\n    // Short-circuit if already aborted\n    if (options.abortSignal?.aborted) {\n      throw new RuntimeError(\"Operation aborted before execution\", \"exec\");\n    }\n\n    // Build devcontainer exec args\n    const workspaceFolder = this.currentWorkspacePath;\n    if (!workspaceFolder) {\n      throw new RuntimeError(\"Devcontainer not initialized. Call ensureReady() first.\", \"exec\");\n    }\n\n    const args = [\"exec\", \"--workspace-folder\", workspaceFolder];\n\n    if (this.configPath) {\n      args.push(\"--config\", this.configPath);\n    }\n\n    // Add environment variables\n    const envVars = { ...options.env, ...NON_INTERACTIVE_ENV_VARS };\n    for (const [key, value] of Object.entries(envVars)) {\n      args.push(\"--remote-env\", `${key}=${value}`);\n    }\n\n    // Build the full command with cd\n    // Map host workspace path to container path; fall back to container workspace if unmappable\n    const mappedCwd = options.cwd ? this.mapHostPathToContainer(options.cwd) : null;\n    const cwd = mappedCwd ?? this.resolveContainerCwd(options.cwd, workspaceFolder);\n    const fullCommand = `cd ${JSON.stringify(cwd)} && ${command}`;\n    args.push(\"--\", \"bash\", \"-c\", fullCommand);\n\n    const childProcess = spawn(\"devcontainer\", args, {\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\n      detached: true,\n      windowsHide: true,\n      cwd: workspaceFolder,\n    });\n\n    const disposable = new DisposableProcess(childProcess);\n\n    // Convert Node.js streams to Web Streams (casts required for ExecStream compatibility)\n    /* eslint-disable @typescript-eslint/no-unnecessary-type-assertion */\n    const stdout = Readable.toWeb(childProcess.stdout!) as unknown as ReadableStream<Uint8Array>;\n    const stderr = Readable.toWeb(childProcess.stderr!) as unknown as ReadableStream<Uint8Array>;\n    const stdin = Writable.toWeb(childProcess.stdin!) as unknown as WritableStream<Uint8Array>;\n    /* eslint-enable @typescript-eslint/no-unnecessary-type-assertion */\n\n    let timedOut = false;\n    let aborted = false;\n\n    const exitCode = new Promise<number>((resolve, reject) => {\n      childProcess.on(\"exit\", (code) => {\n        if (childProcess.pid !== undefined) {\n          killProcessTree(childProcess.pid);\n        }\n\n        if (aborted || options.abortSignal?.aborted) {\n          resolve(EXIT_CODE_ABORTED);\n          return;\n        }\n        if (timedOut) {\n          resolve(EXIT_CODE_TIMEOUT);\n          return;\n        }\n        resolve(code ?? 0);\n      });\n\n      childProcess.on(\"error\", (err) => {\n        reject(\n          new RuntimeError(`Failed to execute devcontainer exec: ${err.message}`, \"exec\", err)\n        );\n      });\n    });\n\n    const duration = exitCode.then(() => performance.now() - startTime);\n    void exitCode.catch(() => undefined);\n    void duration.catch(() => undefined);\n\n    // Handle timeout\n    let timeoutId: ReturnType<typeof setTimeout> | undefined;\n    if (options.timeout && options.timeout > 0) {\n      timeoutId = setTimeout(() => {\n        timedOut = true;\n        disposable[Symbol.dispose]();\n      }, options.timeout * 1000);\n\n      void exitCode.finally(() => {\n        if (timeoutId) clearTimeout(timeoutId);\n      });\n    }\n\n    // Handle abort signal\n    const abortHandler = () => {\n      aborted = true;\n      disposable[Symbol.dispose]();\n    };\n    options.abortSignal?.addEventListener(\"abort\", abortHandler);\n    void exitCode.finally(() => {\n      options.abortSignal?.removeEventListener(\"abort\", abortHandler);\n    });\n\n    return Promise.resolve({\n      stdout,\n      stderr,\n      stdin,\n      exitCode,\n      duration,\n    });\n  }\n\n  override readFile(filePath: string, abortSignal?: AbortSignal): ReadableStream<Uint8Array> {\n    const hostPath = this.resolveHostPathForMounted(filePath);\n    if (hostPath) {\n      return super.readFile(hostPath, abortSignal);\n    }\n    return this.readFileViaExec(filePath, abortSignal);\n  }\n\n  override writeFile(filePath: string, abortSignal?: AbortSignal): WritableStream<Uint8Array> {\n    const hostPath = this.resolveHostPathForMounted(filePath);\n    if (hostPath) {\n      return super.writeFile(hostPath, abortSignal);\n    }\n    return this.writeFileViaExec(filePath, abortSignal);\n  }\n\n  override async stat(filePath: string): Promise<FileStat> {\n    const hostPath = this.resolveHostPathForMounted(filePath);\n    if (hostPath) {\n      return super.stat(hostPath);\n    }\n    return this.statViaExec(filePath);\n  }\n\n  override async ensureDir(dirPath: string): Promise<void> {\n    const hostPath = this.resolveHostPathForMounted(dirPath);\n    if (hostPath) {\n      return super.ensureDir(hostPath);\n    }\n    return this.ensureDirViaExec(dirPath);\n  }\n\n  override async resolvePath(filePath: string): Promise<string> {\n    let expanded = this.expandTildeForContainer(filePath);\n\n    if (this.hasUnexpandedTilde(expanded)) {\n      await this.fetchRemoteHome();\n      if (this.remoteHomeDir) {\n        expanded = filePath === \"~\" ? this.remoteHomeDir : this.remoteHomeDir + filePath.slice(1);\n      } else {\n        throw new RuntimeError(\n          `Failed to resolve path ${filePath}: container home directory unavailable`,\n          \"exec\"\n        );\n      }\n    }\n\n    // Resolve relative paths against container workspace (avoid host cwd leakage)\n    if (!expanded.startsWith(\"/\")) {\n      const basePath = this.remoteWorkspaceFolder ?? \"/\";\n      return path.posix.resolve(basePath, expanded);\n    }\n\n    // For absolute paths, resolve using posix (container is Linux)\n    return path.posix.resolve(expanded);\n  }\n\n  override tempDir(): Promise<string> {\n    const workspaceRoot = this.remoteWorkspaceFolder ?? this.currentWorkspacePath;\n    if (!workspaceRoot) {\n      return super.tempDir();\n    }\n\n    const tmpPath = this.remoteWorkspaceFolder\n      ? path.posix.join(workspaceRoot, \".mux\", \"tmp\")\n      : path.join(workspaceRoot, \".mux\", \"tmp\");\n    return Promise.resolve(tmpPath);\n  }\n\n  /**\n   * Ensure the devcontainer is ready for operations.\n   * Runs `devcontainer up` which starts the container if stopped,\n   * or rebuilds if the container was deleted.\n   */\n  override async ensureReady(options?: EnsureReadyOptions): Promise<EnsureReadyResult> {\n    if (!this.currentWorkspacePath) {\n      return {\n        ready: false,\n        error: \"Workspace path not set. Call postCreateSetup() first.\",\n        errorType: \"runtime_not_ready\",\n      };\n    }\n\n    const statusSink = options?.statusSink;\n    statusSink?.({\n      phase: \"checking\",\n      runtimeType: \"devcontainer\",\n      detail: \"Checking repository...\",\n    });\n\n    const hasRepo = await isGitRepository(this.currentWorkspacePath);\n    if (!hasRepo) {\n      statusSink?.({\n        phase: \"error\",\n        runtimeType: \"devcontainer\",\n        detail: WORKSPACE_REPO_MISSING_ERROR,\n      });\n      return {\n        ready: false,\n        error: WORKSPACE_REPO_MISSING_ERROR,\n        errorType: \"runtime_not_ready\",\n      };\n    }\n\n    try {\n      statusSink?.({\n        phase: \"starting\",\n        runtimeType: \"devcontainer\",\n        detail: \"Starting devcontainer...\",\n      });\n\n      // Create a minimal logger for ensureReady (we don't want verbose output here)\n      const silentLogger = {\n        logStep: (_message: string) => {\n          /* silent */\n        },\n        logStdout: (_line: string) => {\n          /* silent */\n        },\n        logStderr: (line: string) => log.debug(\"devcontainer up stderr:\", { line }),\n        logComplete: (_exitCode: number) => {\n          /* silent */\n        },\n      };\n\n      const { additionalMounts, remoteEnv } = this.buildCredentialForwarding(\n        this.lastCredentialEnv\n      );\n      const result = await devcontainerUp({\n        workspaceFolder: this.currentWorkspacePath,\n        configPath: this.configPath,\n        initLogger: silentLogger,\n        abortSignal: options?.signal,\n        additionalMounts: additionalMounts.length > 0 ? additionalMounts : undefined,\n        remoteEnv: Object.keys(remoteEnv).length > 0 ? remoteEnv : undefined,\n      });\n\n      // Update cached info (container may have been rebuilt)\n      this.remoteWorkspaceFolder = result.remoteWorkspaceFolder;\n      this.remoteUser = result.remoteUser;\n      await this.fetchRemoteHome();\n\n      await this.setupCredentials(this.lastCredentialEnv);\n\n      statusSink?.({ phase: \"ready\", runtimeType: \"devcontainer\" });\n      return { ready: true };\n    } catch (error) {\n      const errorMsg = getErrorMessage(error);\n      statusSink?.({ phase: \"error\", runtimeType: \"devcontainer\", detail: errorMsg });\n\n      return {\n        ready: false,\n        error: errorMsg,\n        errorType: \"runtime_not_ready\",\n      };\n    }\n  }\n\n  async renameWorkspace(\n    projectPath: string,\n    oldName: string,\n    newName: string,\n    _abortSignal?: AbortSignal\n  ): Promise<\n    { success: true; oldPath: string; newPath: string } | { success: false; error: string }\n  > {\n    // Stop container before rename (container labels reference old path)\n    const oldPath = this.getWorkspacePath(projectPath, oldName);\n    await devcontainerDown(oldPath, this.configPath);\n\n    // Rename worktree on host\n    const result = await this.worktreeManager.renameWorkspace(projectPath, oldName, newName);\n\n    if (result.success) {\n      // Update current workspace path if this was the active workspace\n      if (this.currentWorkspacePath === oldPath) {\n        this.currentWorkspacePath = result.newPath;\n      }\n    }\n\n    return result;\n  }\n\n  async deleteWorkspace(\n    projectPath: string,\n    workspaceName: string,\n    force: boolean,\n    _abortSignal?: AbortSignal\n  ): Promise<{ success: true; deletedPath: string } | { success: false; error: string }> {\n    const workspacePath = this.getWorkspacePath(projectPath, workspaceName);\n\n    // Stop and remove container (best-effort)\n    try {\n      await devcontainerDown(workspacePath, this.configPath);\n    } catch (error) {\n      log.debug(\"devcontainerDown failed (container may not exist):\", { error });\n    }\n\n    // Delete worktree on host\n    return this.worktreeManager.deleteWorkspace(projectPath, workspaceName, force);\n  }\n\n  async forkWorkspace(params: WorkspaceForkParams): Promise<WorkspaceForkResult> {\n    // Fork creates a new worktree - container will be built on first ensureReady\n    return this.worktreeManager.forkWorkspace(params);\n  }\n\n  /**\n   * Set the current workspace path for exec operations.\n   * Called by workspaceService when switching to an existing workspace.\n   */\n  setCurrentWorkspacePath(workspacePath: string): void {\n    this.currentWorkspacePath = workspacePath;\n  }\n\n  /**\n   * Get the remote workspace folder path (inside container).\n   */\n  getRemoteWorkspaceFolder(): string | undefined {\n    return this.remoteWorkspaceFolder;\n  }\n}\n"]}