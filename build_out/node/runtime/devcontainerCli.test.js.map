{"version":3,"file":"devcontainerCli.test.js","sourceRoot":"","sources":["../../../src/node/runtime/devcontainerCli.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, it } from \"bun:test\";\r\nimport {\r\n  formatDevcontainerUpError,\r\n  parseDevcontainerStdoutLine,\r\n  shouldCleanupDevcontainer,\r\n} from \"./devcontainerCli\";\r\n\r\ndescribe(\"parseDevcontainerStdoutLine\", () => {\r\n  it(\"parses JSON log lines with text\", () => {\r\n    const line = JSON.stringify({ type: \"text\", level: 3, text: \"Building...\" });\r\n    expect(parseDevcontainerStdoutLine(line)).toEqual({\r\n      kind: \"log\",\r\n      text: \"Building...\",\r\n    });\r\n  });\r\n\r\n  it(\"parses progress lines with name and status\", () => {\r\n    const line = JSON.stringify({\r\n      type: \"progress\",\r\n      name: \"Running postCreateCommand...\",\r\n      status: \"succeeded\",\r\n      channel: \"postCreate\",\r\n    });\r\n    expect(parseDevcontainerStdoutLine(line)).toEqual({\r\n      kind: \"log\",\r\n      text: \"Running postCreateCommand...\",\r\n    });\r\n  });\r\n\r\n  it(\"parses error channel text below level 2\", () => {\r\n    const line = JSON.stringify({ type: \"text\", level: 1, text: \"Oops\", channel: \"error\" });\r\n    expect(parseDevcontainerStdoutLine(line)).toEqual({\r\n      kind: \"log\",\r\n      text: \"Oops\",\r\n    });\r\n  });\r\n  it(\"skips text lines below level 2\", () => {\r\n    const line = JSON.stringify({ type: \"text\", level: 1, text: \"debug\" });\r\n    expect(parseDevcontainerStdoutLine(line)).toBeNull();\r\n  });\r\n\r\n  it(\"parses result lines\", () => {\r\n    const line = JSON.stringify({\r\n      outcome: \"success\",\r\n      containerId: \"abc123\",\r\n      remoteUser: \"node\",\r\n      remoteWorkspaceFolder: \"/workspaces/demo\",\r\n    });\r\n    const parsed = parseDevcontainerStdoutLine(line);\r\n    expect(parsed?.kind).toBe(\"result\");\r\n    if (parsed?.kind === \"result\") {\r\n      expect(parsed.result.containerId).toBe(\"abc123\");\r\n    }\r\n  });\r\n\r\n  it(\"falls back to raw lines for non-JSON output\", () => {\r\n    expect(parseDevcontainerStdoutLine(\"not json\")).toEqual({\r\n      kind: \"raw\",\r\n      text: \"not json\",\r\n    });\r\n  });\r\n});\r\n\r\ndescribe(\"formatDevcontainerUpError\", () => {\r\n  it(\"prefers message and description\", () => {\r\n    expect(\r\n      formatDevcontainerUpError({\r\n        outcome: \"error\",\r\n        message: \"Command failed\",\r\n        description: \"postCreateCommand failed\",\r\n      })\r\n    ).toBe(\"devcontainer up failed: Command failed - postCreateCommand failed\");\r\n  });\r\n\r\n  it(\"falls back to stderr summary\", () => {\r\n    expect(formatDevcontainerUpError({ outcome: \"error\" }, \"stderr info\")).toBe(\r\n      \"devcontainer up failed: stderr info\"\r\n    );\r\n  });\r\n});\r\n\r\ndescribe(\"shouldCleanupDevcontainer\", () => {\r\n  it(\"returns true for error results with containerId\", () => {\r\n    expect(shouldCleanupDevcontainer({ outcome: \"error\", containerId: \"abc\" })).toBe(true);\r\n  });\r\n\r\n  it(\"returns false for error results without containerId\", () => {\r\n    expect(shouldCleanupDevcontainer({ outcome: \"error\" })).toBe(false);\r\n  });\r\n\r\n  it(\"returns false for success results\", () => {\r\n    expect(shouldCleanupDevcontainer({ outcome: \"success\", containerId: \"abc\" })).toBe(false);\r\n  });\r\n});\r\n"]}