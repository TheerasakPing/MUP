{"version":3,"file":"devcontainerCli.test.js","sourceRoot":"","sources":["../../../src/node/runtime/devcontainerCli.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, it } from \"bun:test\";\nimport {\n  formatDevcontainerUpError,\n  parseDevcontainerStdoutLine,\n  shouldCleanupDevcontainer,\n} from \"./devcontainerCli\";\n\ndescribe(\"parseDevcontainerStdoutLine\", () => {\n  it(\"parses JSON log lines with text\", () => {\n    const line = JSON.stringify({ type: \"text\", level: 3, text: \"Building...\" });\n    expect(parseDevcontainerStdoutLine(line)).toEqual({\n      kind: \"log\",\n      text: \"Building...\",\n    });\n  });\n\n  it(\"parses progress lines with name and status\", () => {\n    const line = JSON.stringify({\n      type: \"progress\",\n      name: \"Running postCreateCommand...\",\n      status: \"succeeded\",\n      channel: \"postCreate\",\n    });\n    expect(parseDevcontainerStdoutLine(line)).toEqual({\n      kind: \"log\",\n      text: \"Running postCreateCommand...\",\n    });\n  });\n\n  it(\"parses error channel text below level 2\", () => {\n    const line = JSON.stringify({ type: \"text\", level: 1, text: \"Oops\", channel: \"error\" });\n    expect(parseDevcontainerStdoutLine(line)).toEqual({\n      kind: \"log\",\n      text: \"Oops\",\n    });\n  });\n  it(\"skips text lines below level 2\", () => {\n    const line = JSON.stringify({ type: \"text\", level: 1, text: \"debug\" });\n    expect(parseDevcontainerStdoutLine(line)).toBeNull();\n  });\n\n  it(\"parses result lines\", () => {\n    const line = JSON.stringify({\n      outcome: \"success\",\n      containerId: \"abc123\",\n      remoteUser: \"node\",\n      remoteWorkspaceFolder: \"/workspaces/demo\",\n    });\n    const parsed = parseDevcontainerStdoutLine(line);\n    expect(parsed?.kind).toBe(\"result\");\n    if (parsed?.kind === \"result\") {\n      expect(parsed.result.containerId).toBe(\"abc123\");\n    }\n  });\n\n  it(\"falls back to raw lines for non-JSON output\", () => {\n    expect(parseDevcontainerStdoutLine(\"not json\")).toEqual({\n      kind: \"raw\",\n      text: \"not json\",\n    });\n  });\n});\n\ndescribe(\"formatDevcontainerUpError\", () => {\n  it(\"prefers message and description\", () => {\n    expect(\n      formatDevcontainerUpError({\n        outcome: \"error\",\n        message: \"Command failed\",\n        description: \"postCreateCommand failed\",\n      })\n    ).toBe(\"devcontainer up failed: Command failed - postCreateCommand failed\");\n  });\n\n  it(\"falls back to stderr summary\", () => {\n    expect(formatDevcontainerUpError({ outcome: \"error\" }, \"stderr info\")).toBe(\n      \"devcontainer up failed: stderr info\"\n    );\n  });\n});\n\ndescribe(\"shouldCleanupDevcontainer\", () => {\n  it(\"returns true for error results with containerId\", () => {\n    expect(shouldCleanupDevcontainer({ outcome: \"error\", containerId: \"abc\" })).toBe(true);\n  });\n\n  it(\"returns false for error results without containerId\", () => {\n    expect(shouldCleanupDevcontainer({ outcome: \"error\" })).toBe(false);\n  });\n\n  it(\"returns false for success results\", () => {\n    expect(shouldCleanupDevcontainer({ outcome: \"success\", containerId: \"abc\" })).toBe(false);\n  });\n});\n"]}