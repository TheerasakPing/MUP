{"version":3,"file":"backgroundCommands.test.js","sourceRoot":"","sources":["../../../src/node/runtime/backgroundCommands.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, it, expect } from \"bun:test\";\r\nimport { execSync } from \"child_process\";\r\nimport * as fs from \"fs/promises\";\r\nimport {\r\n  shellQuote,\r\n  buildWrapperScript,\r\n  buildSpawnCommand,\r\n  buildTerminateCommand,\r\n  parseExitCode,\r\n  parsePid,\r\n} from \"./backgroundCommands\";\r\n\r\ndescribe(\"backgroundCommands\", () => {\r\n  describe(\"shellQuote\", () => {\r\n    it(\"quotes empty string\", () => {\r\n      expect(shellQuote(\"\")).toBe(\"''\");\r\n    });\r\n\r\n    it(\"quotes simple strings and paths\", () => {\r\n      expect(shellQuote(\"hello\")).toBe(\"'hello'\");\r\n      expect(shellQuote(\"/path/with spaces/file\")).toBe(\"'/path/with spaces/file'\");\r\n    });\r\n\r\n    it(\"escapes single quotes\", () => {\r\n      expect(shellQuote(\"it's\")).toBe(\"'it'\\\"'\\\"'s'\");\r\n      expect(shellQuote(\"it's a 'test'\")).toBe(\"'it'\\\"'\\\"'s a '\\\"'\\\"'test'\\\"'\\\"''\");\r\n    });\r\n\r\n    it(\"preserves special characters inside quotes\", () => {\r\n      expect(shellQuote(\"$HOME\")).toBe(\"'$HOME'\");\r\n      expect(shellQuote(\"a && b\")).toBe(\"'a && b'\");\r\n      expect(shellQuote(\"foo\\nbar\")).toBe(\"'foo\\nbar'\");\r\n    });\r\n  });\r\n\r\n  describe(\"buildWrapperScript\", () => {\r\n    it(\"builds script with trap, cd, and user script joined by &&\", () => {\r\n      const result = buildWrapperScript({\r\n        exitCodePath: \"/tmp/exit_code\",\r\n        cwd: \"/home/user/project\",\r\n        script: \"echo hello\",\r\n      });\r\n\r\n      expect(result).toBe(\r\n        `__MUX_EXIT_CODE_PATH='/tmp/exit_code' && trap 'echo $? > \"$__MUX_EXIT_CODE_PATH\"' EXIT && cd '/home/user/project' && echo hello`\r\n      );\r\n    });\r\n\r\n    it(\"includes env exports\", () => {\r\n      const result = buildWrapperScript({\r\n        exitCodePath: \"/tmp/exit_code\",\r\n        cwd: \"/home/user\",\r\n        env: { FOO: \"bar\", BAZ: \"qux\" },\r\n        script: \"env\",\r\n      });\r\n\r\n      expect(result).toContain(\"export FOO='bar'\");\r\n      expect(result).toContain(\"export BAZ='qux'\");\r\n    });\r\n\r\n    it(\"quotes paths with spaces\", () => {\r\n      const result = buildWrapperScript({\r\n        exitCodePath: \"/tmp/my dir/exit_code\",\r\n        cwd: \"/home/user/my project\",\r\n        script: \"ls\",\r\n      });\r\n\r\n      expect(result).toContain(\"'/tmp/my dir/exit_code'\");\r\n      expect(result).toContain(\"'/home/user/my project'\");\r\n    });\r\n\r\n    it(\"produces valid bash when exit code path contains spaces\", async () => {\r\n      // Regression test: spaces in process ID (display_name) caused invalid trap syntax\r\n      // The trap command needs to properly nest quoted paths\r\n      const testDir = `/tmp/PR Checks ${Date.now()}`;\r\n      const exitCodePath = `${testDir}/exit_code`;\r\n\r\n      const result = buildWrapperScript({\r\n        exitCodePath,\r\n        cwd: \"/tmp\",\r\n        script: \"exit 42\",\r\n      });\r\n\r\n      // The wrapper script should be valid bash - execute it and verify exit code is captured\r\n      await fs.mkdir(testDir, { recursive: true });\r\n      // Ensure no stale file\r\n      await fs.rm(exitCodePath, { force: true });\r\n\r\n      try {\r\n        execSync(`bash -c ${shellQuote(result)}`, { stdio: \"pipe\" });\r\n      } catch {\r\n        // Expected - script exits with 42\r\n      }\r\n\r\n      // The exit code file MUST exist if the trap worked correctly\r\n      const exitCode = await fs.readFile(exitCodePath, \"utf-8\");\r\n      expect(exitCode.trim()).toBe(\"42\");\r\n\r\n      await fs.rm(testDir, { recursive: true });\r\n    });\r\n\r\n    it(\"escapes single quotes in env values\", () => {\r\n      const result = buildWrapperScript({\r\n        exitCodePath: \"/tmp/exit_code\",\r\n        cwd: \"/home\",\r\n        env: { MSG: \"it's a test\" },\r\n        script: \"echo $MSG\",\r\n      });\r\n\r\n      expect(result).toContain(\"export MSG='it'\\\"'\\\"'s a test'\");\r\n    });\r\n  });\r\n\r\n  describe(\"buildSpawnCommand\", () => {\r\n    it(\"uses set -m, nohup, unified output with 2>&1, and echoes PID\", () => {\r\n      const result = buildSpawnCommand({\r\n        wrapperScript: \"echo hello\",\r\n        outputPath: \"/tmp/output.log\",\r\n      });\r\n\r\n      expect(result).toMatch(/^\\(set -m; nohup 'bash' -c /);\r\n      expect(result).toContain(\"> '/tmp/output.log' 2>&1\");\r\n      expect(result).toContain(\"< /dev/null\");\r\n      expect(result).toContain(\"& echo $!)\");\r\n    });\r\n\r\n    it(\"uses custom bash path (including paths with spaces)\", () => {\r\n      const result = buildSpawnCommand({\r\n        wrapperScript: \"echo hello\",\r\n        outputPath: \"/tmp/output.log\",\r\n        bashPath: \"/c/Program Files/Git/bin/bash.exe\",\r\n      });\r\n\r\n      expect(result).toContain(\"'/c/Program Files/Git/bin/bash.exe' -c\");\r\n    });\r\n\r\n    it(\"quotes the wrapper script\", () => {\r\n      const result = buildSpawnCommand({\r\n        wrapperScript: \"echo 'hello world'\",\r\n        outputPath: \"/tmp/output.log\",\r\n      });\r\n\r\n      expect(result).toContain(\"-c 'echo '\\\"'\\\"'hello world'\\\"'\\\"''\");\r\n    });\r\n  });\r\n\r\n  describe(\"buildTerminateCommand\", () => {\r\n    it(\"sends SIGTERM then SIGKILL to process group using negative PID\", () => {\r\n      const result = buildTerminateCommand(1234, \"/tmp/exit_code\");\r\n\r\n      expect(result).toContain(\"kill -15 -1234 2>/dev/null || true\");\r\n      expect(result).toContain(\"sleep 2\");\r\n      expect(result).toContain(\"kill -0 -1234\");\r\n      expect(result).toContain(\"kill -9 -1234 2>/dev/null || true\");\r\n      expect(result).toContain(\"echo 137 >\"); // SIGKILL exit code\r\n      expect(result).toContain(\"echo 143 >\"); // SIGTERM exit code (written after process exits)\r\n    });\r\n\r\n    it(\"quotes exit code path with spaces\", () => {\r\n      const result = buildTerminateCommand(1234, \"/tmp/my dir/exit_code\");\r\n\r\n      expect(result).toContain(\"'/tmp/my dir/exit_code'\");\r\n    });\r\n\r\n    it(\"uses custom quotePath function for SSH tilde expansion\", () => {\r\n      const expandTilde = (p: string) => (p.startsWith(\"~/\") ? `\"$HOME/${p.slice(2)}\"` : `\"${p}\"`);\r\n      const result = buildTerminateCommand(1234, \"~/mux/exit_code\", expandTilde);\r\n\r\n      expect(result).toContain('\"$HOME/mux/exit_code\"');\r\n    });\r\n  });\r\n\r\n  describe(\"parseExitCode\", () => {\r\n    it(\"parses valid exit codes with whitespace\", () => {\r\n      expect(parseExitCode(\"0\")).toBe(0);\r\n      expect(parseExitCode(\"  137\\n\")).toBe(137);\r\n      expect(parseExitCode(\"\\t42\\t\")).toBe(42);\r\n    });\r\n\r\n    it(\"returns null for empty or non-numeric input\", () => {\r\n      expect(parseExitCode(\"\")).toBeNull();\r\n      expect(parseExitCode(\"   \")).toBeNull();\r\n      expect(parseExitCode(\"abc\")).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe(\"parsePid\", () => {\r\n    it(\"parses valid PID with whitespace\", () => {\r\n      expect(parsePid(\"1234\")).toBe(1234);\r\n      expect(parsePid(\"  1234\\n\")).toBe(1234);\r\n    });\r\n\r\n    it(\"returns null for invalid input\", () => {\r\n      expect(parsePid(\"\")).toBeNull();\r\n      expect(parsePid(\"   \")).toBeNull();\r\n      expect(parsePid(\"abc\")).toBeNull();\r\n      expect(parsePid(\"-1\")).toBeNull();\r\n      expect(parsePid(\"0\")).toBeNull();\r\n    });\r\n  });\r\n});\r\n"]}