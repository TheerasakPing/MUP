{"version":3,"file":"runtimeFactory.test.js","sourceRoot":"","sources":["../../../src/node/runtime/runtimeFactory.test.ts"],"names":[],"mappings":";;AAAA,uCAAgD;AAChD,8EAAkF;AAClF,qDAA2E;AAE3E,iDAA8C;AAC9C,uDAAoD;AAEpD,IAAA,mBAAQ,EAAC,6BAA6B,EAAE,GAAG,EAAE,CAAC;IAC5C,IAAA,aAAE,EAAC,oCAAoC,EAAE,GAAG,EAAE,CAAC;QAC7C,IAAA,iBAAM,EAAC,IAAA,kDAA2B,EAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CAC5D,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,kEAAkE,EAAE,GAAG,EAAE,CAAC;QAC3E,MAAM,MAAM,GAAkB;YAC5B,IAAI,EAAE,OAAO;YACb,UAAU,EAAE,YAAY;SACzB,CAAC;QACF,IAAA,iBAAM,EAAC,IAAA,kDAA2B,EAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CACzD,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,sEAAsE,EAAE,GAAG,EAAE,CAAC;QAC/E,gEAAgE;QAChE,MAAM,MAAM,GAAkB,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;QAChD,IAAA,iBAAM,EAAC,IAAA,kDAA2B,EAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CACzD,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,mCAAmC,EAAE,GAAG,EAAE,CAAC;QAC5C,MAAM,MAAM,GAAkB;YAC5B,IAAI,EAAE,UAAU;YAChB,UAAU,EAAE,YAAY;SACzB,CAAC;QACF,IAAA,iBAAM,EAAC,IAAA,kDAA2B,EAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CACzD,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,8BAA8B,EAAE,GAAG,EAAE,CAAC;QACvC,MAAM,MAAM,GAAkB;YAC5B,IAAI,EAAE,KAAK;YACX,IAAI,EAAE,aAAa;YACnB,UAAU,EAAE,gBAAgB;SAC7B,CAAC;QACF,IAAA,iBAAM,EAAC,IAAA,kDAA2B,EAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CACzD,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,4DAA4D,EAAE,GAAG,EAAE,CAAC;QACrE,wDAAwD;QACxD,MAAM,MAAM,GAAG,EAAE,IAAI,EAAE,gBAAgB,EAA8B,CAAC;QACtE,IAAA,iBAAM,EAAC,IAAA,kDAA2B,EAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAAA,CACxD,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,IAAA,mBAAQ,EAAC,eAAe,EAAE,GAAG,EAAE,CAAC;IAC9B,IAAA,aAAE,EAAC,mEAAmE,EAAE,GAAG,EAAE,CAAC;QAC5E,MAAM,MAAM,GAAkB;YAC5B,IAAI,EAAE,OAAO;YACb,UAAU,EAAE,eAAe;SAC5B,CAAC;QACF,MAAM,OAAO,GAAG,IAAA,8BAAa,EAAC,MAAM,CAAC,CAAC;QACtC,IAAA,iBAAM,EAAC,OAAO,CAAC,CAAC,cAAc,CAAC,iCAAe,CAAC,CAAC;IAAA,CACjD,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,wEAAwE,EAAE,GAAG,EAAE,CAAC;QACjF,MAAM,MAAM,GAAkB,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;QAChD,MAAM,OAAO,GAAG,IAAA,8BAAa,EAAC,MAAM,EAAE,EAAE,WAAW,EAAE,iBAAiB,EAAE,CAAC,CAAC;QAC1E,IAAA,iBAAM,EAAC,OAAO,CAAC,CAAC,cAAc,CAAC,2BAAY,CAAC,CAAC;IAAA,CAC9C,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,sDAAsD,EAAE,GAAG,EAAE,CAAC;QAC/D,MAAM,MAAM,GAAkB;YAC5B,IAAI,EAAE,UAAU;YAChB,UAAU,EAAE,eAAe;SAC5B,CAAC;QACF,MAAM,OAAO,GAAG,IAAA,8BAAa,EAAC,MAAM,CAAC,CAAC;QACtC,IAAA,iBAAM,EAAC,OAAO,CAAC,CAAC,cAAc,CAAC,iCAAe,CAAC,CAAC;IAAA,CACjD,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,+DAA+D,EAAE,GAAG,EAAE,CAAC;QACxE,MAAM,MAAM,GAAkB,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;QAChD,IAAA,iBAAM,EAAC,GAAG,EAAE,CAAC,IAAA,8BAAa,EAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;IAAA,CAC5D,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,0DAA0D,EAAE,GAAG,EAAE,CAAC;QACnE,MAAM,MAAM,GAAG,EAAE,IAAI,EAAE,gBAAgB,EAA8B,CAAC;QACtE,IAAA,iBAAM,EAAC,GAAG,EAAE,CAAC,IAAA,8BAAa,EAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,yCAAwB,CAAC,CAAC;QACtE,IAAA,iBAAM,EAAC,GAAG,EAAE,CAAC,IAAA,8BAAa,EAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,sBAAsB,CAAC,CAAC;IAAA,CACrE,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { describe, expect, it } from \"bun:test\";\r\nimport { isIncompatibleRuntimeConfig } from \"@/common/utils/runtimeCompatibility\";\r\nimport { createRuntime, IncompatibleRuntimeError } from \"./runtimeFactory\";\r\nimport type { RuntimeConfig } from \"@/common/types/runtime\";\r\nimport { LocalRuntime } from \"./LocalRuntime\";\r\nimport { WorktreeRuntime } from \"./WorktreeRuntime\";\r\n\r\ndescribe(\"isIncompatibleRuntimeConfig\", () => {\r\n  it(\"returns false for undefined config\", () => {\r\n    expect(isIncompatibleRuntimeConfig(undefined)).toBe(false);\r\n  });\r\n\r\n  it(\"returns false for local config with srcBaseDir (legacy worktree)\", () => {\r\n    const config: RuntimeConfig = {\r\n      type: \"local\",\r\n      srcBaseDir: \"~/.mux/src\",\r\n    };\r\n    expect(isIncompatibleRuntimeConfig(config)).toBe(false);\r\n  });\r\n\r\n  it(\"returns false for local config without srcBaseDir (project-dir mode)\", () => {\r\n    // Local without srcBaseDir is now supported as project-dir mode\r\n    const config: RuntimeConfig = { type: \"local\" };\r\n    expect(isIncompatibleRuntimeConfig(config)).toBe(false);\r\n  });\r\n\r\n  it(\"returns false for worktree config\", () => {\r\n    const config: RuntimeConfig = {\r\n      type: \"worktree\",\r\n      srcBaseDir: \"~/.mux/src\",\r\n    };\r\n    expect(isIncompatibleRuntimeConfig(config)).toBe(false);\r\n  });\r\n\r\n  it(\"returns false for SSH config\", () => {\r\n    const config: RuntimeConfig = {\r\n      type: \"ssh\",\r\n      host: \"example.com\",\r\n      srcBaseDir: \"/home/user/mux\",\r\n    };\r\n    expect(isIncompatibleRuntimeConfig(config)).toBe(false);\r\n  });\r\n\r\n  it(\"returns true for unknown runtime type from future versions\", () => {\r\n    // Simulate a config from a future version with new type\r\n    const config = { type: \"future-runtime\" } as unknown as RuntimeConfig;\r\n    expect(isIncompatibleRuntimeConfig(config)).toBe(true);\r\n  });\r\n});\r\n\r\ndescribe(\"createRuntime\", () => {\r\n  it(\"creates WorktreeRuntime for local config with srcBaseDir (legacy)\", () => {\r\n    const config: RuntimeConfig = {\r\n      type: \"local\",\r\n      srcBaseDir: \"/tmp/test-src\",\r\n    };\r\n    const runtime = createRuntime(config);\r\n    expect(runtime).toBeInstanceOf(WorktreeRuntime);\r\n  });\r\n\r\n  it(\"creates LocalRuntime for local config without srcBaseDir (project-dir)\", () => {\r\n    const config: RuntimeConfig = { type: \"local\" };\r\n    const runtime = createRuntime(config, { projectPath: \"/tmp/my-project\" });\r\n    expect(runtime).toBeInstanceOf(LocalRuntime);\r\n  });\r\n\r\n  it(\"creates WorktreeRuntime for explicit worktree config\", () => {\r\n    const config: RuntimeConfig = {\r\n      type: \"worktree\",\r\n      srcBaseDir: \"/tmp/test-src\",\r\n    };\r\n    const runtime = createRuntime(config);\r\n    expect(runtime).toBeInstanceOf(WorktreeRuntime);\r\n  });\r\n\r\n  it(\"throws error for local project-dir without projectPath option\", () => {\r\n    const config: RuntimeConfig = { type: \"local\" };\r\n    expect(() => createRuntime(config)).toThrow(/projectPath/);\r\n  });\r\n\r\n  it(\"throws IncompatibleRuntimeError for unknown runtime type\", () => {\r\n    const config = { type: \"future-runtime\" } as unknown as RuntimeConfig;\r\n    expect(() => createRuntime(config)).toThrow(IncompatibleRuntimeError);\r\n    expect(() => createRuntime(config)).toThrow(/newer version of mux/);\r\n  });\r\n});\r\n"]}