{"version":3,"file":"runtimeFactory.test.js","sourceRoot":"","sources":["../../../src/node/runtime/runtimeFactory.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, it } from \"bun:test\";\nimport { isIncompatibleRuntimeConfig } from \"@/common/utils/runtimeCompatibility\";\nimport { createRuntime, IncompatibleRuntimeError } from \"./runtimeFactory\";\nimport type { RuntimeConfig } from \"@/common/types/runtime\";\nimport { LocalRuntime } from \"./LocalRuntime\";\nimport { WorktreeRuntime } from \"./WorktreeRuntime\";\n\ndescribe(\"isIncompatibleRuntimeConfig\", () => {\n  it(\"returns false for undefined config\", () => {\n    expect(isIncompatibleRuntimeConfig(undefined)).toBe(false);\n  });\n\n  it(\"returns false for local config with srcBaseDir (legacy worktree)\", () => {\n    const config: RuntimeConfig = {\n      type: \"local\",\n      srcBaseDir: \"~/.mux/src\",\n    };\n    expect(isIncompatibleRuntimeConfig(config)).toBe(false);\n  });\n\n  it(\"returns false for local config without srcBaseDir (project-dir mode)\", () => {\n    // Local without srcBaseDir is now supported as project-dir mode\n    const config: RuntimeConfig = { type: \"local\" };\n    expect(isIncompatibleRuntimeConfig(config)).toBe(false);\n  });\n\n  it(\"returns false for worktree config\", () => {\n    const config: RuntimeConfig = {\n      type: \"worktree\",\n      srcBaseDir: \"~/.mux/src\",\n    };\n    expect(isIncompatibleRuntimeConfig(config)).toBe(false);\n  });\n\n  it(\"returns false for SSH config\", () => {\n    const config: RuntimeConfig = {\n      type: \"ssh\",\n      host: \"example.com\",\n      srcBaseDir: \"/home/user/mux\",\n    };\n    expect(isIncompatibleRuntimeConfig(config)).toBe(false);\n  });\n\n  it(\"returns true for unknown runtime type from future versions\", () => {\n    // Simulate a config from a future version with new type\n    const config = { type: \"future-runtime\" } as unknown as RuntimeConfig;\n    expect(isIncompatibleRuntimeConfig(config)).toBe(true);\n  });\n});\n\ndescribe(\"createRuntime\", () => {\n  it(\"creates WorktreeRuntime for local config with srcBaseDir (legacy)\", () => {\n    const config: RuntimeConfig = {\n      type: \"local\",\n      srcBaseDir: \"/tmp/test-src\",\n    };\n    const runtime = createRuntime(config);\n    expect(runtime).toBeInstanceOf(WorktreeRuntime);\n  });\n\n  it(\"creates LocalRuntime for local config without srcBaseDir (project-dir)\", () => {\n    const config: RuntimeConfig = { type: \"local\" };\n    const runtime = createRuntime(config, { projectPath: \"/tmp/my-project\" });\n    expect(runtime).toBeInstanceOf(LocalRuntime);\n  });\n\n  it(\"creates WorktreeRuntime for explicit worktree config\", () => {\n    const config: RuntimeConfig = {\n      type: \"worktree\",\n      srcBaseDir: \"/tmp/test-src\",\n    };\n    const runtime = createRuntime(config);\n    expect(runtime).toBeInstanceOf(WorktreeRuntime);\n  });\n\n  it(\"throws error for local project-dir without projectPath option\", () => {\n    const config: RuntimeConfig = { type: \"local\" };\n    expect(() => createRuntime(config)).toThrow(/projectPath/);\n  });\n\n  it(\"throws IncompatibleRuntimeError for unknown runtime type\", () => {\n    const config = { type: \"future-runtime\" } as unknown as RuntimeConfig;\n    expect(() => createRuntime(config)).toThrow(IncompatibleRuntimeError);\n    expect(() => createRuntime(config)).toThrow(/newer version of mux/);\n  });\n});\n"]}