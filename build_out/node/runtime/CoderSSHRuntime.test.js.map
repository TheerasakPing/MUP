{"version":3,"file":"CoderSSHRuntime.test.js","sourceRoot":"","sources":["../../../src/node/runtime/CoderSSHRuntime.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, it, mock, beforeEach, afterEach, spyOn, type Mock } from \"bun:test\";\nimport type { CoderService } from \"@/node/services/coderService\";\nimport type { RuntimeConfig } from \"@/common/types/runtime\";\nimport * as runtimeHelpers from \"@/node/utils/runtime/helpers\";\n\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nconst noop = () => {};\nimport type { RuntimeStatusEvent } from \"./Runtime\";\n\nimport { CoderSSHRuntime, type CoderSSHRuntimeConfig } from \"./CoderSSHRuntime\";\nimport { SSHRuntime } from \"./SSHRuntime\";\nimport { createSSHTransport } from \"./transports\";\n\n/**\n * Create a minimal mock CoderService for testing.\n * Only mocks methods used by the tested code paths.\n */\nfunction createMockCoderService(overrides?: Partial<CoderService>): CoderService {\n  const provisioningSession = {\n    token: \"token\",\n    dispose: mock(() => Promise.resolve()),\n  };\n\n  return {\n    createWorkspace: mock(() =>\n      (async function* (): AsyncGenerator<string, void, unknown> {\n        await Promise.resolve();\n        // default: no output\n        for (const line of [] as string[]) {\n          yield line;\n        }\n      })()\n    ),\n    deleteWorkspace: mock(() => Promise.resolve()),\n    deleteWorkspaceEventually: mock(() =>\n      Promise.resolve({ success: true as const, data: undefined })\n    ),\n    ensureProvisioningSession: mock(() => Promise.resolve(provisioningSession)),\n    takeProvisioningSession: mock(() => provisioningSession),\n    disposeProvisioningSession: mock(() => Promise.resolve()),\n    fetchDeploymentSshConfig: mock(() => Promise.resolve({ hostnameSuffix: \"coder\" })),\n    ensureSSHConfig: mock(() => Promise.resolve()),\n    getWorkspaceStatus: mock(() =>\n      Promise.resolve({ kind: \"ok\" as const, status: \"running\" as const })\n    ),\n    listWorkspaces: mock(() => Promise.resolve({ ok: true, workspaces: [] })),\n    waitForStartupScripts: mock(() =>\n      (async function* (): AsyncGenerator<string, void, unknown> {\n        await Promise.resolve();\n        // default: no output (startup scripts completed)\n        for (const line of [] as string[]) {\n          yield line;\n        }\n      })()\n    ),\n    workspaceExists: mock(() => Promise.resolve(false)),\n    ...overrides,\n  } as unknown as CoderService;\n}\n\n/**\n * Create a CoderSSHRuntime with minimal config for testing.\n */\nfunction createRuntime(\n  coderConfig: {\n    existingWorkspace?: boolean;\n    workspaceName?: string;\n    template?: string;\n  },\n  coderService: CoderService\n): CoderSSHRuntime {\n  const template = \"template\" in coderConfig ? coderConfig.template : \"default-template\";\n\n  const config: CoderSSHRuntimeConfig = {\n    host: \"placeholder.coder\",\n    srcBaseDir: \"~/src\",\n    coder: {\n      existingWorkspace: coderConfig.existingWorkspace ?? false,\n      workspaceName: coderConfig.workspaceName,\n      template,\n    },\n  };\n  const transport = createSSHTransport(config, false);\n  return new CoderSSHRuntime(config, transport, coderService);\n}\n\n/**\n * Create an SSH+Coder RuntimeConfig for finalizeConfig tests.\n */\nfunction createSSHCoderConfig(coder: {\n  existingWorkspace?: boolean;\n  workspaceName?: string;\n}): RuntimeConfig {\n  return {\n    type: \"ssh\",\n    host: \"placeholder.coder\",\n    srcBaseDir: \"~/src\",\n    coder: {\n      existingWorkspace: coder.existingWorkspace ?? false,\n      workspaceName: coder.workspaceName,\n      template: \"default-template\",\n    },\n  };\n}\n\n// =============================================================================\n// Test Suite 1: finalizeConfig (name/host derivation)\n// =============================================================================\n\ndescribe(\"CoderSSHRuntime.finalizeConfig\", () => {\n  let coderService: CoderService;\n  let runtime: CoderSSHRuntime;\n\n  beforeEach(() => {\n    coderService = createMockCoderService();\n    runtime = createRuntime({}, coderService);\n  });\n\n  describe(\"new workspace mode\", () => {\n    it(\"uses hostname suffix from deployment SSH config\", async () => {\n      const fetchDeploymentSshConfig = mock(() => Promise.resolve({ hostnameSuffix: \"corp\" }));\n      coderService = createMockCoderService({ fetchDeploymentSshConfig });\n      runtime = createRuntime({}, coderService);\n\n      const config = createSSHCoderConfig({ existingWorkspace: false });\n      const result = await runtime.finalizeConfig(\"my-feature\", config);\n\n      expect(result.success).toBe(true);\n      if (result.success && result.data.type === \"ssh\") {\n        expect(result.data.host).toBe(\"mux-my-feature.corp\");\n      }\n      expect(fetchDeploymentSshConfig).toHaveBeenCalled();\n    });\n    it(\"derives Coder name from branch name when not provided\", async () => {\n      const config = createSSHCoderConfig({ existingWorkspace: false });\n      const result = await runtime.finalizeConfig(\"my-feature\", config);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.type).toBe(\"ssh\");\n        if (result.data.type === \"ssh\") {\n          expect(result.data.coder?.workspaceName).toBe(\"mux-my-feature\");\n          expect(result.data.host).toBe(\"mux-my-feature.coder\");\n        }\n      }\n    });\n\n    it(\"converts underscores to hyphens\", async () => {\n      const config = createSSHCoderConfig({ existingWorkspace: false });\n      const result = await runtime.finalizeConfig(\"my_feature_branch\", config);\n\n      expect(result.success).toBe(true);\n      if (result.success && result.data.type === \"ssh\") {\n        expect(result.data.coder?.workspaceName).toBe(\"mux-my-feature-branch\");\n        expect(result.data.host).toBe(\"mux-my-feature-branch.coder\");\n      }\n    });\n\n    it(\"collapses multiple hyphens and trims leading/trailing\", async () => {\n      const config = createSSHCoderConfig({ existingWorkspace: false });\n      const result = await runtime.finalizeConfig(\"--my--feature--\", config);\n\n      expect(result.success).toBe(true);\n      if (result.success && result.data.type === \"ssh\") {\n        expect(result.data.coder?.workspaceName).toBe(\"mux-my-feature\");\n      }\n    });\n\n    it(\"rejects names that fail regex after conversion\", async () => {\n      const config = createSSHCoderConfig({ existingWorkspace: false });\n      // Name with special chars that can't form a valid Coder name (only hyphens/underscores become invalid)\n      const result = await runtime.finalizeConfig(\"@#$%\", config);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error).toContain(\"cannot be converted to a valid Coder name\");\n      }\n    });\n\n    it(\"returns error when deployment SSH config fetch fails\", async () => {\n      const provisioningSession = {\n        token: \"token\",\n        dispose: mock(() => Promise.resolve()),\n      };\n      const ensureProvisioningSession = mock(() => Promise.resolve(provisioningSession));\n      const fetchDeploymentSshConfig = mock(() => Promise.reject(new Error(\"nope\")));\n      const disposeProvisioningSession = mock(() => Promise.resolve());\n\n      coderService = createMockCoderService({\n        ensureProvisioningSession,\n        fetchDeploymentSshConfig,\n        disposeProvisioningSession,\n      });\n      runtime = createRuntime({}, coderService);\n\n      const config = createSSHCoderConfig({ existingWorkspace: false });\n      const result = await runtime.finalizeConfig(\"branch\", config);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error).toContain(\"Failed to read Coder deployment SSH config\");\n        expect(result.error).toContain(\"nope\");\n      }\n      expect(ensureProvisioningSession).toHaveBeenCalledWith(\"mux-branch\");\n      expect(fetchDeploymentSshConfig).toHaveBeenCalledWith(provisioningSession);\n      expect(disposeProvisioningSession).toHaveBeenCalledWith(\"mux-branch\");\n    });\n    it(\"uses provided workspaceName over branch name\", async () => {\n      const config = createSSHCoderConfig({\n        existingWorkspace: false,\n        workspaceName: \"custom-name\",\n      });\n      const result = await runtime.finalizeConfig(\"branch-name\", config);\n\n      expect(result.success).toBe(true);\n      if (result.success && result.data.type === \"ssh\") {\n        expect(result.data.coder?.workspaceName).toBe(\"custom-name\");\n        expect(result.data.host).toBe(\"custom-name.coder\");\n      }\n    });\n  });\n\n  describe(\"existing workspace mode\", () => {\n    it(\"requires workspaceName to be provided\", async () => {\n      const config = createSSHCoderConfig({ existingWorkspace: true });\n      const result = await runtime.finalizeConfig(\"branch-name\", config);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error).toContain(\"required for existing workspaces\");\n      }\n    });\n\n    it(\"keeps provided workspaceName and sets host\", async () => {\n      const config = createSSHCoderConfig({\n        existingWorkspace: true,\n        workspaceName: \"existing-ws\",\n      });\n      const result = await runtime.finalizeConfig(\"branch-name\", config);\n\n      expect(result.success).toBe(true);\n      if (result.success && result.data.type === \"ssh\") {\n        expect(result.data.coder?.workspaceName).toBe(\"existing-ws\");\n        expect(result.data.host).toBe(\"existing-ws.coder\");\n      }\n    });\n  });\n\n  it(\"passes through non-SSH configs unchanged\", async () => {\n    const config: RuntimeConfig = { type: \"local\" };\n    const result = await runtime.finalizeConfig(\"branch\", config);\n\n    expect(result.success).toBe(true);\n    if (result.success) {\n      expect(result.data).toEqual(config);\n    }\n  });\n\n  it(\"passes through SSH configs without coder unchanged\", async () => {\n    const config: RuntimeConfig = { type: \"ssh\", host: \"example.com\", srcBaseDir: \"/src\" };\n    const result = await runtime.finalizeConfig(\"branch\", config);\n\n    expect(result.success).toBe(true);\n    if (result.success) {\n      expect(result.data).toEqual(config);\n    }\n  });\n});\n\n// =============================================================================\n// Test Suite 2: deleteWorkspace behavior\n// =============================================================================\n\ndescribe(\"CoderSSHRuntime.deleteWorkspace\", () => {\n  /**\n   * For deleteWorkspace tests, we mock SSHRuntime.prototype.deleteWorkspace\n   * to control the parent class behavior.\n   */\n  let sshDeleteSpy: Mock<typeof SSHRuntime.prototype.deleteWorkspace>;\n\n  beforeEach(() => {\n    sshDeleteSpy = spyOn(SSHRuntime.prototype, \"deleteWorkspace\").mockResolvedValue({\n      success: true,\n      deletedPath: \"/path\",\n    });\n  });\n\n  afterEach(() => {\n    sshDeleteSpy.mockRestore();\n  });\n\n  it(\"never calls coderService.deleteWorkspaceEventually when existingWorkspace=true\", async () => {\n    const deleteWorkspaceEventually = mock(() =>\n      Promise.resolve({ success: true as const, data: undefined })\n    );\n    const coderService = createMockCoderService({ deleteWorkspaceEventually });\n\n    const runtime = createRuntime(\n      { existingWorkspace: true, workspaceName: \"existing-ws\" },\n      coderService\n    );\n\n    await runtime.deleteWorkspace(\"/project\", \"ws\", false);\n    expect(deleteWorkspaceEventually).not.toHaveBeenCalled();\n  });\n\n  it(\"skips Coder deletion when workspaceName is not set\", async () => {\n    const deleteWorkspaceEventually = mock(() =>\n      Promise.resolve({ success: true as const, data: undefined })\n    );\n    const coderService = createMockCoderService({ deleteWorkspaceEventually });\n\n    // No workspaceName provided\n    const runtime = createRuntime({ existingWorkspace: false }, coderService);\n\n    const result = await runtime.deleteWorkspace(\"/project\", \"ws\", false);\n    expect(deleteWorkspaceEventually).not.toHaveBeenCalled();\n    expect(result.success).toBe(true);\n  });\n\n  it(\"skips Coder deletion when SSH delete fails and force=false\", async () => {\n    sshDeleteSpy.mockResolvedValue({ success: false, error: \"dirty workspace\" });\n\n    const deleteWorkspaceEventually = mock(() =>\n      Promise.resolve({ success: true as const, data: undefined })\n    );\n    const coderService = createMockCoderService({ deleteWorkspaceEventually });\n\n    const runtime = createRuntime(\n      { existingWorkspace: false, workspaceName: \"my-ws\" },\n      coderService\n    );\n\n    const result = await runtime.deleteWorkspace(\"/project\", \"ws\", false);\n    expect(deleteWorkspaceEventually).not.toHaveBeenCalled();\n    expect(result.success).toBe(false);\n  });\n\n  it(\"calls Coder deletion (no SSH) when force=true\", async () => {\n    sshDeleteSpy.mockResolvedValue({ success: false, error: \"dirty workspace\" });\n\n    const deleteWorkspaceEventually = mock(() =>\n      Promise.resolve({ success: true as const, data: undefined })\n    );\n    const coderService = createMockCoderService({ deleteWorkspaceEventually });\n\n    const runtime = createRuntime(\n      { existingWorkspace: false, workspaceName: \"my-ws\" },\n      coderService\n    );\n\n    await runtime.deleteWorkspace(\"/project\", \"ws\", true);\n    expect(sshDeleteSpy).not.toHaveBeenCalled();\n    expect(deleteWorkspaceEventually).toHaveBeenCalledWith(\n      \"my-ws\",\n      expect.objectContaining({ waitForExistence: true, waitForExistenceTimeoutMs: 10_000 })\n    );\n  });\n\n  it(\"returns combined error when SSH succeeds but Coder delete fails\", async () => {\n    const deleteWorkspaceEventually = mock(() =>\n      Promise.resolve({ success: false as const, error: \"Coder API error\" })\n    );\n    const coderService = createMockCoderService({ deleteWorkspaceEventually });\n\n    const runtime = createRuntime(\n      { existingWorkspace: false, workspaceName: \"my-ws\" },\n      coderService\n    );\n\n    const result = await runtime.deleteWorkspace(\"/project\", \"ws\", false);\n    expect(result.success).toBe(false);\n    if (!result.success) {\n      expect(result.error).toContain(\"SSH delete succeeded\");\n      expect(result.error).toContain(\"Coder API error\");\n    }\n  });\n\n  it(\"succeeds immediately when Coder workspace is already deleted\", async () => {\n    // getWorkspaceStatus returns { kind: \"not_found\" } when workspace doesn't exist\n    const getWorkspaceStatus = mock(() => Promise.resolve({ kind: \"not_found\" as const }));\n    const deleteWorkspaceEventually = mock(() =>\n      Promise.resolve({ success: true as const, data: undefined })\n    );\n    const coderService = createMockCoderService({ getWorkspaceStatus, deleteWorkspaceEventually });\n\n    const runtime = createRuntime(\n      { existingWorkspace: false, workspaceName: \"my-ws\" },\n      coderService\n    );\n\n    const result = await runtime.deleteWorkspace(\"/project\", \"ws\", false);\n\n    // Should succeed without calling SSH delete or Coder delete\n    expect(result.success).toBe(true);\n    expect(sshDeleteSpy).not.toHaveBeenCalled();\n    expect(deleteWorkspaceEventually).not.toHaveBeenCalled();\n  });\n\n  it(\"proceeds with SSH cleanup when status check fails with API error\", async () => {\n    // API error (auth, network) - should NOT treat as \"already deleted\"\n    const getWorkspaceStatus = mock(() =>\n      Promise.resolve({ kind: \"error\" as const, error: \"coder timed out\" })\n    );\n    const deleteWorkspaceEventually = mock(() =>\n      Promise.resolve({ success: true as const, data: undefined })\n    );\n    const coderService = createMockCoderService({ getWorkspaceStatus, deleteWorkspaceEventually });\n\n    const runtime = createRuntime(\n      { existingWorkspace: false, workspaceName: \"my-ws\" },\n      coderService\n    );\n\n    const result = await runtime.deleteWorkspace(\"/project\", \"ws\", false);\n\n    // Should proceed with SSH cleanup (which succeeds), then Coder delete\n    expect(sshDeleteSpy).toHaveBeenCalled();\n    expect(deleteWorkspaceEventually).toHaveBeenCalled();\n    expect(result.success).toBe(true);\n  });\n\n  it(\"deletes stopped Coder workspace without SSH cleanup\", async () => {\n    const getWorkspaceStatus = mock(() =>\n      Promise.resolve({ kind: \"ok\" as const, status: \"stopped\" as const })\n    );\n    const deleteWorkspaceEventually = mock(() =>\n      Promise.resolve({ success: true as const, data: undefined })\n    );\n    const coderService = createMockCoderService({ getWorkspaceStatus, deleteWorkspaceEventually });\n\n    const runtime = createRuntime(\n      { existingWorkspace: false, workspaceName: \"my-ws\" },\n      coderService\n    );\n\n    const result = await runtime.deleteWorkspace(\"/project\", \"ws\", false);\n\n    expect(result.success).toBe(true);\n    expect(sshDeleteSpy).not.toHaveBeenCalled();\n    expect(deleteWorkspaceEventually).toHaveBeenCalledWith(\n      \"my-ws\",\n      expect.objectContaining({ waitForExistence: false })\n    );\n  });\n  it(\"succeeds immediately when Coder workspace status is 'deleting'\", async () => {\n    const getWorkspaceStatus = mock(() =>\n      Promise.resolve({ kind: \"ok\" as const, status: \"deleting\" as const })\n    );\n    const deleteWorkspaceEventually = mock(() =>\n      Promise.resolve({ success: true as const, data: undefined })\n    );\n    const coderService = createMockCoderService({ getWorkspaceStatus, deleteWorkspaceEventually });\n\n    const runtime = createRuntime(\n      { existingWorkspace: false, workspaceName: \"my-ws\" },\n      coderService\n    );\n\n    const result = await runtime.deleteWorkspace(\"/project\", \"ws\", false);\n\n    // Should succeed without calling SSH delete or Coder delete (workspace already dying)\n    expect(result.success).toBe(true);\n    expect(sshDeleteSpy).not.toHaveBeenCalled();\n    expect(deleteWorkspaceEventually).not.toHaveBeenCalled();\n  });\n});\n\n// =============================================================================\n// Test Suite 3: validateBeforePersist (collision detection)\n// =============================================================================\n\ndescribe(\"CoderSSHRuntime.validateBeforePersist\", () => {\n  it(\"returns error when Coder workspace already exists\", async () => {\n    const workspaceExists = mock(() => Promise.resolve(true));\n    const coderService = createMockCoderService({ workspaceExists });\n    const runtime = createRuntime({}, coderService);\n\n    const config = createSSHCoderConfig({\n      existingWorkspace: false,\n      workspaceName: \"my-ws\",\n    });\n\n    const result = await runtime.validateBeforePersist(\"branch\", config);\n    expect(result.success).toBe(false);\n    if (!result.success) {\n      expect(result.error).toContain(\"already exists\");\n    }\n    expect(workspaceExists).toHaveBeenCalledWith(\"my-ws\");\n  });\n\n  it(\"skips collision check for existingWorkspace=true\", async () => {\n    const workspaceExists = mock(() => Promise.resolve(true));\n    const coderService = createMockCoderService({ workspaceExists });\n    const runtime = createRuntime({}, coderService);\n\n    const config = createSSHCoderConfig({\n      existingWorkspace: true,\n      workspaceName: \"existing-ws\",\n    });\n\n    const result = await runtime.validateBeforePersist(\"branch\", config);\n    expect(result.success).toBe(true);\n    expect(workspaceExists).not.toHaveBeenCalled();\n  });\n});\n\n// =============================================================================\n// Test Suite 4: postCreateSetup (provisioning)\n// =============================================================================\n\ndescribe(\"CoderSSHRuntime.postCreateSetup\", () => {\n  let execBufferedSpy: ReturnType<typeof spyOn<typeof runtimeHelpers, \"execBuffered\">>;\n\n  beforeEach(() => {\n    execBufferedSpy = spyOn(runtimeHelpers, \"execBuffered\").mockResolvedValue({\n      stdout: \"\",\n      stderr: \"\",\n      exitCode: 0,\n      duration: 0,\n    });\n  });\n\n  afterEach(() => {\n    execBufferedSpy.mockRestore();\n  });\n\n  it(\"creates a new Coder workspace and prepares the directory\", async () => {\n    const createWorkspace = mock(() =>\n      (async function* (): AsyncGenerator<string, void, unknown> {\n        await Promise.resolve();\n        yield \"build line 1\";\n        yield \"build line 2\";\n      })()\n    );\n    const ensureSSHConfig = mock(() => Promise.resolve());\n    const provisioningSession = {\n      token: \"token\",\n      dispose: mock(() => Promise.resolve()),\n    };\n    const takeProvisioningSession = mock(() => provisioningSession);\n\n    // Start with workspace not found, then return running after creation\n    let workspaceCreated = false;\n    const getWorkspaceStatus = mock(() =>\n      Promise.resolve(\n        workspaceCreated\n          ? { kind: \"ok\" as const, status: \"running\" as const }\n          : { kind: \"not_found\" as const }\n      )\n    );\n\n    const coderService = createMockCoderService({\n      createWorkspace,\n      ensureSSHConfig,\n      getWorkspaceStatus,\n      takeProvisioningSession,\n    });\n    const runtime = createRuntime(\n      { existingWorkspace: false, workspaceName: \"my-ws\", template: \"my-template\" },\n      coderService\n    );\n\n    // Before postCreateSetup, ensureReady should fail (workspace doesn't exist on server)\n    const beforeReady = await runtime.ensureReady();\n    expect(beforeReady.ready).toBe(false);\n    if (!beforeReady.ready) {\n      expect(beforeReady.errorType).toBe(\"runtime_not_ready\");\n    }\n\n    // Simulate workspace being created by postCreateSetup\n    workspaceCreated = true;\n\n    const steps: string[] = [];\n    const stdout: string[] = [];\n    const stderr: string[] = [];\n    const initLogger = {\n      logStep: (s: string) => {\n        steps.push(s);\n      },\n      logStdout: (s: string) => {\n        stdout.push(s);\n      },\n      logStderr: (s: string) => {\n        stderr.push(s);\n      },\n      logComplete: noop,\n    };\n\n    await runtime.postCreateSetup({\n      initLogger,\n      projectPath: \"/project\",\n      branchName: \"branch\",\n      trunkBranch: \"main\",\n      workspacePath: \"/home/user/src/my-project/my-ws\",\n    });\n\n    expect(takeProvisioningSession).toHaveBeenCalledWith(\"my-ws\");\n    expect(createWorkspace).toHaveBeenCalledWith(\n      \"my-ws\",\n      \"my-template\",\n      undefined,\n      undefined,\n      undefined,\n      provisioningSession\n    );\n    expect(provisioningSession.dispose).toHaveBeenCalled();\n    expect(ensureSSHConfig).toHaveBeenCalled();\n    expect(execBufferedSpy).toHaveBeenCalled();\n\n    // After postCreateSetup, ensureReady should succeed (workspace exists on server)\n    const afterReady = await runtime.ensureReady();\n    expect(afterReady.ready).toBe(true);\n\n    expect(stdout).toEqual([\"build line 1\", \"build line 2\"]);\n    expect(stderr).toEqual([]);\n    expect(steps.join(\"\\n\")).toContain(\"Creating Coder workspace\");\n    expect(steps.join(\"\\n\")).toContain(\"Configuring SSH\");\n    expect(steps.join(\"\\n\")).toContain(\"Preparing workspace directory\");\n  });\n\n  it(\"disposes provisioning session when workspace creation fails\", async () => {\n    const createWorkspace = mock(() =>\n      (async function* (): AsyncGenerator<string, void, unknown> {\n        yield \"Starting workspace...\";\n        await Promise.resolve();\n        throw new Error(\"boom\");\n      })()\n    );\n    const provisioningSession = {\n      token: \"token\",\n      dispose: mock(() => Promise.resolve()),\n    };\n    const takeProvisioningSession = mock(() => provisioningSession);\n\n    const coderService = createMockCoderService({\n      createWorkspace,\n      takeProvisioningSession,\n    });\n    const runtime = createRuntime(\n      { existingWorkspace: false, workspaceName: \"my-ws\", template: \"my-template\" },\n      coderService\n    );\n\n    let caughtError: Error | undefined;\n    try {\n      await runtime.postCreateSetup({\n        initLogger: {\n          logStep: noop,\n          logStdout: noop,\n          logStderr: noop,\n          logComplete: noop,\n        },\n        projectPath: \"/project\",\n        branchName: \"branch\",\n        trunkBranch: \"main\",\n        workspacePath: \"/home/user/src/my-project/my-ws\",\n      });\n    } catch (err) {\n      caughtError = err as Error;\n    }\n\n    expect(caughtError?.message).toContain(\"Failed to create Coder workspace\");\n    expect(takeProvisioningSession).toHaveBeenCalledWith(\"my-ws\");\n    expect(createWorkspace).toHaveBeenCalledWith(\n      \"my-ws\",\n      \"my-template\",\n      undefined,\n      undefined,\n      undefined,\n      provisioningSession\n    );\n    expect(provisioningSession.dispose).toHaveBeenCalled();\n  });\n\n  it(\"skips workspace creation when existingWorkspace=true and workspace is running\", async () => {\n    const createWorkspace = mock(() =>\n      (async function* (): AsyncGenerator<string, void, unknown> {\n        await Promise.resolve();\n        yield \"should not happen\";\n      })()\n    );\n    const waitForStartupScripts = mock(() =>\n      (async function* (): AsyncGenerator<string, void, unknown> {\n        await Promise.resolve();\n        yield \"Already running\";\n      })()\n    );\n    const ensureSSHConfig = mock(() => Promise.resolve());\n    const getWorkspaceStatus = mock(() =>\n      Promise.resolve({ kind: \"ok\" as const, status: \"running\" as const })\n    );\n\n    const coderService = createMockCoderService({\n      createWorkspace,\n      waitForStartupScripts,\n      ensureSSHConfig,\n      getWorkspaceStatus,\n    });\n    const runtime = createRuntime(\n      { existingWorkspace: true, workspaceName: \"existing-ws\" },\n      coderService\n    );\n\n    await runtime.postCreateSetup({\n      initLogger: {\n        logStep: noop,\n        logStdout: noop,\n        logStderr: noop,\n        logComplete: noop,\n      },\n      projectPath: \"/project\",\n      branchName: \"branch\",\n      trunkBranch: \"main\",\n      workspacePath: \"/home/user/src/my-project/existing-ws\",\n    });\n\n    expect(createWorkspace).not.toHaveBeenCalled();\n    // waitForStartupScripts is called (it handles running workspaces quickly)\n    expect(waitForStartupScripts).toHaveBeenCalled();\n    expect(ensureSSHConfig).toHaveBeenCalled();\n    expect(execBufferedSpy).toHaveBeenCalled();\n  });\n\n  it(\"uses waitForStartupScripts for existing stopped workspace (auto-starts via coder ssh)\", async () => {\n    const createWorkspace = mock(() =>\n      (async function* (): AsyncGenerator<string, void, unknown> {\n        await Promise.resolve();\n        yield \"should not happen\";\n      })()\n    );\n    const waitForStartupScripts = mock(() =>\n      (async function* (): AsyncGenerator<string, void, unknown> {\n        await Promise.resolve();\n        yield \"Starting workspace...\";\n        yield \"Build complete\";\n        yield \"Startup scripts finished\";\n      })()\n    );\n    const ensureSSHConfig = mock(() => Promise.resolve());\n    const getWorkspaceStatus = mock(() =>\n      Promise.resolve({ kind: \"ok\" as const, status: \"stopped\" as const })\n    );\n\n    const coderService = createMockCoderService({\n      createWorkspace,\n      waitForStartupScripts,\n      ensureSSHConfig,\n      getWorkspaceStatus,\n    });\n    const runtime = createRuntime(\n      { existingWorkspace: true, workspaceName: \"existing-ws\" },\n      coderService\n    );\n\n    const loggedStdout: string[] = [];\n    await runtime.postCreateSetup({\n      initLogger: {\n        logStep: noop,\n        logStdout: (line) => loggedStdout.push(line),\n        logStderr: noop,\n        logComplete: noop,\n      },\n      projectPath: \"/project\",\n      branchName: \"branch\",\n      trunkBranch: \"main\",\n      workspacePath: \"/home/user/src/my-project/existing-ws\",\n    });\n\n    expect(createWorkspace).not.toHaveBeenCalled();\n    expect(waitForStartupScripts).toHaveBeenCalled();\n    expect(loggedStdout).toContain(\"Starting workspace...\");\n    expect(loggedStdout).toContain(\"Startup scripts finished\");\n    expect(ensureSSHConfig).toHaveBeenCalled();\n  });\n\n  it(\"polls until stopping workspace becomes stopped before connecting\", async () => {\n    let pollCount = 0;\n    const getWorkspaceStatus = mock(() => {\n      pollCount++;\n      // First 2 calls return \"stopping\", then \"stopped\"\n      if (pollCount <= 2) {\n        return Promise.resolve({ kind: \"ok\" as const, status: \"stopping\" as const });\n      }\n      return Promise.resolve({ kind: \"ok\" as const, status: \"stopped\" as const });\n    });\n    const waitForStartupScripts = mock(() =>\n      (async function* (): AsyncGenerator<string, void, unknown> {\n        await Promise.resolve();\n        yield \"Ready\";\n      })()\n    );\n    const ensureSSHConfig = mock(() => Promise.resolve());\n\n    const coderService = createMockCoderService({\n      getWorkspaceStatus,\n      waitForStartupScripts,\n      ensureSSHConfig,\n    });\n\n    const runtime = createRuntime(\n      { existingWorkspace: true, workspaceName: \"stopping-ws\" },\n      coderService\n    );\n\n    // Avoid real sleeps in this polling test\n    interface RuntimeWithSleep {\n      sleep: (ms: number, abortSignal?: AbortSignal) => Promise<void>;\n    }\n    spyOn(runtime as unknown as RuntimeWithSleep, \"sleep\").mockResolvedValue(undefined);\n\n    const loggedSteps: string[] = [];\n    await runtime.postCreateSetup({\n      initLogger: {\n        logStep: (step) => loggedSteps.push(step),\n        logStdout: noop,\n        logStderr: noop,\n        logComplete: noop,\n      },\n      projectPath: \"/project\",\n      branchName: \"branch\",\n      trunkBranch: \"main\",\n      workspacePath: \"/home/user/src/my-project/stopping-ws\",\n    });\n\n    // Should have polled status multiple times\n    expect(pollCount).toBeGreaterThan(2);\n    expect(loggedSteps.some((s) => s.includes(\"Waiting for Coder workspace\"))).toBe(true);\n    expect(waitForStartupScripts).toHaveBeenCalled();\n  });\n\n  it(\"throws when workspaceName is missing\", () => {\n    const coderService = createMockCoderService();\n    const runtime = createRuntime({ existingWorkspace: false, template: \"tmpl\" }, coderService);\n\n    return expect(\n      runtime.postCreateSetup({\n        initLogger: {\n          logStep: noop,\n          logStdout: noop,\n          logStderr: noop,\n          logComplete: noop,\n        },\n        projectPath: \"/project\",\n        branchName: \"branch\",\n        trunkBranch: \"main\",\n        workspacePath: \"/home/user/src/my-project/ws\",\n      })\n    ).rejects.toThrow(\"Coder workspace name is required\");\n  });\n\n  it(\"throws when template is missing for new workspaces\", () => {\n    const coderService = createMockCoderService();\n    const runtime = createRuntime(\n      { existingWorkspace: false, workspaceName: \"my-ws\", template: undefined },\n      coderService\n    );\n\n    return expect(\n      runtime.postCreateSetup({\n        initLogger: {\n          logStep: noop,\n          logStdout: noop,\n          logStderr: noop,\n          logComplete: noop,\n        },\n        projectPath: \"/project\",\n        branchName: \"branch\",\n        trunkBranch: \"main\",\n        workspacePath: \"/home/user/src/my-project/ws\",\n      })\n    ).rejects.toThrow(\"Coder template is required\");\n  });\n});\n\n// =============================================================================\n// Test Suite 5: ensureReady (runtime readiness + status events)\n// =============================================================================\n\ndescribe(\"CoderSSHRuntime.ensureReady\", () => {\n  it(\"returns ready when workspace is already running\", async () => {\n    const getWorkspaceStatus = mock(() =>\n      Promise.resolve({ kind: \"ok\" as const, status: \"running\" as const })\n    );\n    const waitForStartupScripts = mock(() =>\n      (async function* (): AsyncGenerator<string, void, unknown> {\n        await Promise.resolve();\n        yield \"should not be called\";\n      })()\n    );\n    const coderService = createMockCoderService({ getWorkspaceStatus, waitForStartupScripts });\n\n    const runtime = createRuntime(\n      { existingWorkspace: true, workspaceName: \"my-ws\" },\n      coderService\n    );\n\n    const events: RuntimeStatusEvent[] = [];\n    const result = await runtime.ensureReady({\n      statusSink: (e) => events.push(e),\n    });\n\n    expect(result).toEqual({ ready: true });\n    expect(getWorkspaceStatus).toHaveBeenCalled();\n    // Short-circuited because status is already \"running\"\n    expect(waitForStartupScripts).not.toHaveBeenCalled();\n    expect(events.map((e) => e.phase)).toEqual([\"checking\", \"ready\"]);\n    expect(events[0]?.runtimeType).toBe(\"ssh\");\n  });\n\n  it(\"connects via waitForStartupScripts when status is stopped (auto-starts)\", async () => {\n    const getWorkspaceStatus = mock(() =>\n      Promise.resolve({ kind: \"ok\" as const, status: \"stopped\" as const })\n    );\n    const waitForStartupScripts = mock(() =>\n      (async function* (): AsyncGenerator<string, void, unknown> {\n        await Promise.resolve();\n        yield \"Starting workspace...\";\n        yield \"Workspace started\";\n      })()\n    );\n    const coderService = createMockCoderService({ getWorkspaceStatus, waitForStartupScripts });\n\n    const runtime = createRuntime(\n      { existingWorkspace: true, workspaceName: \"my-ws\" },\n      coderService\n    );\n\n    const events: RuntimeStatusEvent[] = [];\n    const result = await runtime.ensureReady({\n      statusSink: (e) => events.push(e),\n    });\n\n    expect(result).toEqual({ ready: true });\n    expect(waitForStartupScripts).toHaveBeenCalled();\n    // We should see checking, then starting, then ready\n    expect(events[0]?.phase).toBe(\"checking\");\n    expect(events.some((e) => e.phase === \"starting\")).toBe(true);\n    expect(events.at(-1)?.phase).toBe(\"ready\");\n  });\n\n  it(\"returns runtime_start_failed when waitForStartupScripts fails\", async () => {\n    const getWorkspaceStatus = mock(() =>\n      Promise.resolve({ kind: \"ok\" as const, status: \"stopped\" as const })\n    );\n    const waitForStartupScripts = mock(() =>\n      (async function* (): AsyncGenerator<string, void, unknown> {\n        await Promise.resolve();\n        yield \"Starting workspace...\";\n        throw new Error(\"connection failed\");\n      })()\n    );\n    const coderService = createMockCoderService({ getWorkspaceStatus, waitForStartupScripts });\n\n    const runtime = createRuntime(\n      { existingWorkspace: true, workspaceName: \"my-ws\" },\n      coderService\n    );\n\n    const events: RuntimeStatusEvent[] = [];\n    const result = await runtime.ensureReady({\n      statusSink: (e) => events.push(e),\n    });\n\n    expect(result.ready).toBe(false);\n    if (!result.ready) {\n      expect(result.errorType).toBe(\"runtime_start_failed\");\n      expect(result.error).toContain(\"Failed to connect\");\n    }\n\n    expect(events.at(-1)?.phase).toBe(\"error\");\n  });\n});\n"]}