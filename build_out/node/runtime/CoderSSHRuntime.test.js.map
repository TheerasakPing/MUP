{"version":3,"file":"CoderSSHRuntime.test.js","sourceRoot":"","sources":["../../../src/node/runtime/CoderSSHRuntime.test.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,uCAA+F;AAG/F,MAAY,cAAc,yDAAqC;AAE/D,gEAAgE;AAChE,MAAM,IAAI,GAAG,GAAG,EAAE,CAAC,EAAC,CAAC,CAAC;AAGtB,uDAAgF;AAChF,6CAA0C;AAC1C,6CAAkD;AAElD;;;GAGG;AACH,SAAS,sBAAsB,CAAC,SAAiC,EAAgB;IAC/E,MAAM,mBAAmB,GAAG;QAC1B,KAAK,EAAE,OAAO;QACd,OAAO,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;KACvC,CAAC;IAEF,OAAO;QACL,eAAe,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CACzB,CAAC,KAAK,SAAS,CAAC,IAA2C;YACzD,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC;YACxB,qBAAqB;YACrB,KAAK,MAAM,IAAI,IAAI,EAAc,EAAE,CAAC;gBAClC,MAAM,IAAI,CAAC;YACb,CAAC;QAAA,CACF,CAAC,EAAE,CACL;QACD,eAAe,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;QAC9C,yBAAyB,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CACnC,OAAO,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,IAAa,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,CAC7D;QACD,yBAAyB,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,mBAAmB,CAAC,CAAC;QAC3E,uBAAuB,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,mBAAmB,CAAC;QACxD,0BAA0B,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;QACzD,wBAAwB,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,cAAc,EAAE,OAAO,EAAE,CAAC,CAAC;QAClF,eAAe,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;QAC9C,kBAAkB,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CAC5B,OAAO,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,IAAa,EAAE,MAAM,EAAE,SAAkB,EAAE,CAAC,CACrE;QACD,cAAc,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,EAAE,EAAE,IAAI,EAAE,UAAU,EAAE,EAAE,EAAE,CAAC,CAAC;QACzE,qBAAqB,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CAC/B,CAAC,KAAK,SAAS,CAAC,IAA2C;YACzD,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC;YACxB,iDAAiD;YACjD,KAAK,MAAM,IAAI,IAAI,EAAc,EAAE,CAAC;gBAClC,MAAM,IAAI,CAAC;YACb,CAAC;QAAA,CACF,CAAC,EAAE,CACL;QACD,eAAe,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QACnD,GAAG,SAAS;KACc,CAAC;AAAA,CAC9B;AAED;;GAEG;AACH,SAAS,aAAa,CACpB,WAIC,EACD,YAA0B,EACT;IACjB,MAAM,QAAQ,GAAG,UAAU,IAAI,WAAW,CAAC,CAAC,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,CAAC,kBAAkB,CAAC;IAEvF,MAAM,MAAM,GAA0B;QACpC,IAAI,EAAE,mBAAmB;QACzB,UAAU,EAAE,OAAO;QACnB,KAAK,EAAE;YACL,iBAAiB,EAAE,WAAW,CAAC,iBAAiB,IAAI,KAAK;YACzD,aAAa,EAAE,WAAW,CAAC,aAAa;YACxC,QAAQ;SACT;KACF,CAAC;IACF,MAAM,SAAS,GAAG,IAAA,+BAAkB,EAAC,MAAM,EAAE,KAAK,CAAC,CAAC;IACpD,OAAO,IAAI,iCAAe,CAAC,MAAM,EAAE,SAAS,EAAE,YAAY,CAAC,CAAC;AAAA,CAC7D;AAED;;GAEG;AACH,SAAS,oBAAoB,CAAC,KAG7B,EAAiB;IAChB,OAAO;QACL,IAAI,EAAE,KAAK;QACX,IAAI,EAAE,mBAAmB;QACzB,UAAU,EAAE,OAAO;QACnB,KAAK,EAAE;YACL,iBAAiB,EAAE,KAAK,CAAC,iBAAiB,IAAI,KAAK;YACnD,aAAa,EAAE,KAAK,CAAC,aAAa;YAClC,QAAQ,EAAE,kBAAkB;SAC7B;KACF,CAAC;AAAA,CACH;AAED,gFAAgF;AAChF,sDAAsD;AACtD,gFAAgF;AAEhF,IAAA,mBAAQ,EAAC,gCAAgC,EAAE,GAAG,EAAE,CAAC;IAC/C,IAAI,YAA0B,CAAC;IAC/B,IAAI,OAAwB,CAAC;IAE7B,IAAA,qBAAU,EAAC,GAAG,EAAE,CAAC;QACf,YAAY,GAAG,sBAAsB,EAAE,CAAC;QACxC,OAAO,GAAG,aAAa,CAAC,EAAE,EAAE,YAAY,CAAC,CAAC;IAAA,CAC3C,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,oBAAoB,EAAE,GAAG,EAAE,CAAC;QACnC,IAAA,aAAE,EAAC,iDAAiD,EAAE,KAAK,IAAI,EAAE,CAAC;YAChE,MAAM,wBAAwB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,cAAc,EAAE,MAAM,EAAE,CAAC,CAAC,CAAC;YACzF,YAAY,GAAG,sBAAsB,CAAC,EAAE,wBAAwB,EAAE,CAAC,CAAC;YACpE,OAAO,GAAG,aAAa,CAAC,EAAE,EAAE,YAAY,CAAC,CAAC;YAE1C,MAAM,MAAM,GAAG,oBAAoB,CAAC,EAAE,iBAAiB,EAAE,KAAK,EAAE,CAAC,CAAC;YAClE,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,cAAc,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;YAElE,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,IAAI,MAAM,CAAC,OAAO,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,KAAK,EAAE,CAAC;gBACjD,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;YACvD,CAAC;YACD,IAAA,iBAAM,EAAC,wBAAwB,CAAC,CAAC,gBAAgB,EAAE,CAAC;QAAA,CACrD,CAAC,CAAC;QACH,IAAA,aAAE,EAAC,uDAAuD,EAAE,KAAK,IAAI,EAAE,CAAC;YACtE,MAAM,MAAM,GAAG,oBAAoB,CAAC,EAAE,iBAAiB,EAAE,KAAK,EAAE,CAAC,CAAC;YAClE,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,cAAc,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;YAElE,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,IAAI,MAAM,CAAC,OAAO,EAAE,CAAC;gBACnB,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBACrC,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,KAAK,EAAE,CAAC;oBAC/B,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,aAAa,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;oBAChE,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;gBACxD,CAAC;YACH,CAAC;QAAA,CACF,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,iCAAiC,EAAE,KAAK,IAAI,EAAE,CAAC;YAChD,MAAM,MAAM,GAAG,oBAAoB,CAAC,EAAE,iBAAiB,EAAE,KAAK,EAAE,CAAC,CAAC;YAClE,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,cAAc,CAAC,mBAAmB,EAAE,MAAM,CAAC,CAAC;YAEzE,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,IAAI,MAAM,CAAC,OAAO,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,KAAK,EAAE,CAAC;gBACjD,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,aAAa,CAAC,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;gBACvE,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,6BAA6B,CAAC,CAAC;YAC/D,CAAC;QAAA,CACF,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,uDAAuD,EAAE,KAAK,IAAI,EAAE,CAAC;YACtE,MAAM,MAAM,GAAG,oBAAoB,CAAC,EAAE,iBAAiB,EAAE,KAAK,EAAE,CAAC,CAAC;YAClE,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,cAAc,CAAC,iBAAiB,EAAE,MAAM,CAAC,CAAC;YAEvE,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,IAAI,MAAM,CAAC,OAAO,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,KAAK,EAAE,CAAC;gBACjD,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,aAAa,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAClE,CAAC;QAAA,CACF,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,gDAAgD,EAAE,KAAK,IAAI,EAAE,CAAC;YAC/D,MAAM,MAAM,GAAG,oBAAoB,CAAC,EAAE,iBAAiB,EAAE,KAAK,EAAE,CAAC,CAAC;YAClE,uGAAuG;YACvG,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,cAAc,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;YAE5D,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACnC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;gBACpB,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,2CAA2C,CAAC,CAAC;YAC9E,CAAC;QAAA,CACF,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,sDAAsD,EAAE,KAAK,IAAI,EAAE,CAAC;YACrE,MAAM,mBAAmB,GAAG;gBAC1B,KAAK,EAAE,OAAO;gBACd,OAAO,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;aACvC,CAAC;YACF,MAAM,yBAAyB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,mBAAmB,CAAC,CAAC,CAAC;YACnF,MAAM,wBAAwB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YAC/E,MAAM,0BAA0B,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC;YAEjE,YAAY,GAAG,sBAAsB,CAAC;gBACpC,yBAAyB;gBACzB,wBAAwB;gBACxB,0BAA0B;aAC3B,CAAC,CAAC;YACH,OAAO,GAAG,aAAa,CAAC,EAAE,EAAE,YAAY,CAAC,CAAC;YAE1C,MAAM,MAAM,GAAG,oBAAoB,CAAC,EAAE,iBAAiB,EAAE,KAAK,EAAE,CAAC,CAAC;YAClE,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,cAAc,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;YAE9D,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACnC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;gBACpB,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,4CAA4C,CAAC,CAAC;gBAC7E,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;YACzC,CAAC;YACD,IAAA,iBAAM,EAAC,yBAAyB,CAAC,CAAC,oBAAoB,CAAC,YAAY,CAAC,CAAC;YACrE,IAAA,iBAAM,EAAC,wBAAwB,CAAC,CAAC,oBAAoB,CAAC,mBAAmB,CAAC,CAAC;YAC3E,IAAA,iBAAM,EAAC,0BAA0B,CAAC,CAAC,oBAAoB,CAAC,YAAY,CAAC,CAAC;QAAA,CACvE,CAAC,CAAC;QACH,IAAA,aAAE,EAAC,8CAA8C,EAAE,KAAK,IAAI,EAAE,CAAC;YAC7D,MAAM,MAAM,GAAG,oBAAoB,CAAC;gBAClC,iBAAiB,EAAE,KAAK;gBACxB,aAAa,EAAE,aAAa;aAC7B,CAAC,CAAC;YACH,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,cAAc,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC;YAEnE,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,IAAI,MAAM,CAAC,OAAO,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,KAAK,EAAE,CAAC;gBACjD,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,aAAa,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;gBAC7D,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;YACrD,CAAC;QAAA,CACF,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,yBAAyB,EAAE,GAAG,EAAE,CAAC;QACxC,IAAA,aAAE,EAAC,uCAAuC,EAAE,KAAK,IAAI,EAAE,CAAC;YACtD,MAAM,MAAM,GAAG,oBAAoB,CAAC,EAAE,iBAAiB,EAAE,IAAI,EAAE,CAAC,CAAC;YACjE,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,cAAc,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC;YAEnE,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACnC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;gBACpB,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,kCAAkC,CAAC,CAAC;YACrE,CAAC;QAAA,CACF,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,4CAA4C,EAAE,KAAK,IAAI,EAAE,CAAC;YAC3D,MAAM,MAAM,GAAG,oBAAoB,CAAC;gBAClC,iBAAiB,EAAE,IAAI;gBACvB,aAAa,EAAE,aAAa;aAC7B,CAAC,CAAC;YACH,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,cAAc,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC;YAEnE,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,IAAI,MAAM,CAAC,OAAO,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,KAAK,EAAE,CAAC;gBACjD,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,aAAa,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;gBAC7D,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;YACrD,CAAC;QAAA,CACF,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE,CAAC;QACzD,MAAM,MAAM,GAAkB,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;QAChD,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,cAAc,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;QAE9D,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClC,IAAI,MAAM,CAAC,OAAO,EAAE,CAAC;YACnB,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QACtC,CAAC;IAAA,CACF,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,oDAAoD,EAAE,KAAK,IAAI,EAAE,CAAC;QACnE,MAAM,MAAM,GAAkB,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,aAAa,EAAE,UAAU,EAAE,MAAM,EAAE,CAAC;QACvF,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,cAAc,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;QAE9D,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClC,IAAI,MAAM,CAAC,OAAO,EAAE,CAAC;YACnB,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QACtC,CAAC;IAAA,CACF,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,gFAAgF;AAChF,yCAAyC;AACzC,gFAAgF;AAEhF,IAAA,mBAAQ,EAAC,iCAAiC,EAAE,GAAG,EAAE,CAAC;IAChD;;;OAGG;IACH,IAAI,YAA+D,CAAC;IAEpE,IAAA,qBAAU,EAAC,GAAG,EAAE,CAAC;QACf,YAAY,GAAG,IAAA,gBAAK,EAAC,uBAAU,CAAC,SAAS,EAAE,iBAAiB,CAAC,CAAC,iBAAiB,CAAC;YAC9E,OAAO,EAAE,IAAI;YACb,WAAW,EAAE,OAAO;SACrB,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,oBAAS,EAAC,GAAG,EAAE,CAAC;QACd,YAAY,CAAC,WAAW,EAAE,CAAC;IAAA,CAC5B,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,gFAAgF,EAAE,KAAK,IAAI,EAAE,CAAC;QAC/F,MAAM,yBAAyB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAC1C,OAAO,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,IAAa,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,CAC7D,CAAC;QACF,MAAM,YAAY,GAAG,sBAAsB,CAAC,EAAE,yBAAyB,EAAE,CAAC,CAAC;QAE3E,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,IAAI,EAAE,aAAa,EAAE,aAAa,EAAE,EACzD,YAAY,CACb,CAAC;QAEF,MAAM,OAAO,CAAC,eAAe,CAAC,UAAU,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;QACvD,IAAA,iBAAM,EAAC,yBAAyB,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;IAAA,CAC1D,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,oDAAoD,EAAE,KAAK,IAAI,EAAE,CAAC;QACnE,MAAM,yBAAyB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAC1C,OAAO,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,IAAa,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,CAC7D,CAAC;QACF,MAAM,YAAY,GAAG,sBAAsB,CAAC,EAAE,yBAAyB,EAAE,CAAC,CAAC;QAE3E,4BAA4B;QAC5B,MAAM,OAAO,GAAG,aAAa,CAAC,EAAE,iBAAiB,EAAE,KAAK,EAAE,EAAE,YAAY,CAAC,CAAC;QAE1E,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,eAAe,CAAC,UAAU,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;QACtE,IAAA,iBAAM,EAAC,yBAAyB,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QACzD,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAAA,CACnC,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,4DAA4D,EAAE,KAAK,IAAI,EAAE,CAAC;QAC3E,YAAY,CAAC,iBAAiB,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,iBAAiB,EAAE,CAAC,CAAC;QAE7E,MAAM,yBAAyB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAC1C,OAAO,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,IAAa,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,CAC7D,CAAC;QACF,MAAM,YAAY,GAAG,sBAAsB,CAAC,EAAE,yBAAyB,EAAE,CAAC,CAAC;QAE3E,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,KAAK,EAAE,aAAa,EAAE,OAAO,EAAE,EACpD,YAAY,CACb,CAAC;QAEF,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,eAAe,CAAC,UAAU,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;QACtE,IAAA,iBAAM,EAAC,yBAAyB,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QACzD,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CACpC,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,+CAA+C,EAAE,KAAK,IAAI,EAAE,CAAC;QAC9D,YAAY,CAAC,iBAAiB,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,iBAAiB,EAAE,CAAC,CAAC;QAE7E,MAAM,yBAAyB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAC1C,OAAO,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,IAAa,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,CAC7D,CAAC;QACF,MAAM,YAAY,GAAG,sBAAsB,CAAC,EAAE,yBAAyB,EAAE,CAAC,CAAC;QAE3E,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,KAAK,EAAE,aAAa,EAAE,OAAO,EAAE,EACpD,YAAY,CACb,CAAC;QAEF,MAAM,OAAO,CAAC,eAAe,CAAC,UAAU,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QACtD,IAAA,iBAAM,EAAC,YAAY,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QAC5C,IAAA,iBAAM,EAAC,yBAAyB,CAAC,CAAC,oBAAoB,CACpD,OAAO,EACP,iBAAM,CAAC,gBAAgB,CAAC,EAAE,gBAAgB,EAAE,IAAI,EAAE,yBAAyB,EAAE,MAAM,EAAE,CAAC,CACvF,CAAC;IAAA,CACH,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,iEAAiE,EAAE,KAAK,IAAI,EAAE,CAAC;QAChF,MAAM,yBAAyB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAC1C,OAAO,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,KAAc,EAAE,KAAK,EAAE,iBAAiB,EAAE,CAAC,CACvE,CAAC;QACF,MAAM,YAAY,GAAG,sBAAsB,CAAC,EAAE,yBAAyB,EAAE,CAAC,CAAC;QAE3E,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,KAAK,EAAE,aAAa,EAAE,OAAO,EAAE,EACpD,YAAY,CACb,CAAC;QAEF,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,eAAe,CAAC,UAAU,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;QACtE,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACnC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;YACpB,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,sBAAsB,CAAC,CAAC;YACvD,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;QACpD,CAAC;IAAA,CACF,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,8DAA8D,EAAE,KAAK,IAAI,EAAE,CAAC;QAC7E,gFAAgF;QAChF,MAAM,kBAAkB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,WAAoB,EAAE,CAAC,CAAC,CAAC;QACvF,MAAM,yBAAyB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAC1C,OAAO,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,IAAa,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,CAC7D,CAAC;QACF,MAAM,YAAY,GAAG,sBAAsB,CAAC,EAAE,kBAAkB,EAAE,yBAAyB,EAAE,CAAC,CAAC;QAE/F,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,KAAK,EAAE,aAAa,EAAE,OAAO,EAAE,EACpD,YAAY,CACb,CAAC;QAEF,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,eAAe,CAAC,UAAU,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;QAEtE,4DAA4D;QAC5D,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClC,IAAA,iBAAM,EAAC,YAAY,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QAC5C,IAAA,iBAAM,EAAC,yBAAyB,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;IAAA,CAC1D,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,kEAAkE,EAAE,KAAK,IAAI,EAAE,CAAC;QACjF,oEAAoE;QACpE,MAAM,kBAAkB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CACnC,OAAO,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,OAAgB,EAAE,KAAK,EAAE,iBAAiB,EAAE,CAAC,CACtE,CAAC;QACF,MAAM,yBAAyB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAC1C,OAAO,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,IAAa,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,CAC7D,CAAC;QACF,MAAM,YAAY,GAAG,sBAAsB,CAAC,EAAE,kBAAkB,EAAE,yBAAyB,EAAE,CAAC,CAAC;QAE/F,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,KAAK,EAAE,aAAa,EAAE,OAAO,EAAE,EACpD,YAAY,CACb,CAAC;QAEF,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,eAAe,CAAC,UAAU,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;QAEtE,sEAAsE;QACtE,IAAA,iBAAM,EAAC,YAAY,CAAC,CAAC,gBAAgB,EAAE,CAAC;QACxC,IAAA,iBAAM,EAAC,yBAAyB,CAAC,CAAC,gBAAgB,EAAE,CAAC;QACrD,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAAA,CACnC,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,qDAAqD,EAAE,KAAK,IAAI,EAAE,CAAC;QACpE,MAAM,kBAAkB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CACnC,OAAO,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,IAAa,EAAE,MAAM,EAAE,SAAkB,EAAE,CAAC,CACrE,CAAC;QACF,MAAM,yBAAyB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAC1C,OAAO,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,IAAa,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,CAC7D,CAAC;QACF,MAAM,YAAY,GAAG,sBAAsB,CAAC,EAAE,kBAAkB,EAAE,yBAAyB,EAAE,CAAC,CAAC;QAE/F,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,KAAK,EAAE,aAAa,EAAE,OAAO,EAAE,EACpD,YAAY,CACb,CAAC;QAEF,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,eAAe,CAAC,UAAU,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;QAEtE,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClC,IAAA,iBAAM,EAAC,YAAY,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QAC5C,IAAA,iBAAM,EAAC,yBAAyB,CAAC,CAAC,oBAAoB,CACpD,OAAO,EACP,iBAAM,CAAC,gBAAgB,CAAC,EAAE,gBAAgB,EAAE,KAAK,EAAE,CAAC,CACrD,CAAC;IAAA,CACH,CAAC,CAAC;IACH,IAAA,aAAE,EAAC,gEAAgE,EAAE,KAAK,IAAI,EAAE,CAAC;QAC/E,MAAM,kBAAkB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CACnC,OAAO,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,IAAa,EAAE,MAAM,EAAE,UAAmB,EAAE,CAAC,CACtE,CAAC;QACF,MAAM,yBAAyB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAC1C,OAAO,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,IAAa,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,CAC7D,CAAC;QACF,MAAM,YAAY,GAAG,sBAAsB,CAAC,EAAE,kBAAkB,EAAE,yBAAyB,EAAE,CAAC,CAAC;QAE/F,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,KAAK,EAAE,aAAa,EAAE,OAAO,EAAE,EACpD,YAAY,CACb,CAAC;QAEF,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,eAAe,CAAC,UAAU,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;QAEtE,sFAAsF;QACtF,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClC,IAAA,iBAAM,EAAC,YAAY,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QAC5C,IAAA,iBAAM,EAAC,yBAAyB,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;IAAA,CAC1D,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,gFAAgF;AAChF,4DAA4D;AAC5D,gFAAgF;AAEhF,IAAA,mBAAQ,EAAC,uCAAuC,EAAE,GAAG,EAAE,CAAC;IACtD,IAAA,aAAE,EAAC,mDAAmD,EAAE,KAAK,IAAI,EAAE,CAAC;QAClE,MAAM,eAAe,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;QAC1D,MAAM,YAAY,GAAG,sBAAsB,CAAC,EAAE,eAAe,EAAE,CAAC,CAAC;QACjE,MAAM,OAAO,GAAG,aAAa,CAAC,EAAE,EAAE,YAAY,CAAC,CAAC;QAEhD,MAAM,MAAM,GAAG,oBAAoB,CAAC;YAClC,iBAAiB,EAAE,KAAK;YACxB,aAAa,EAAE,OAAO;SACvB,CAAC,CAAC;QAEH,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,qBAAqB,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;QACrE,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACnC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;YACpB,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,gBAAgB,CAAC,CAAC;QACnD,CAAC;QACD,IAAA,iBAAM,EAAC,eAAe,CAAC,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;IAAA,CACvD,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,kDAAkD,EAAE,KAAK,IAAI,EAAE,CAAC;QACjE,MAAM,eAAe,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;QAC1D,MAAM,YAAY,GAAG,sBAAsB,CAAC,EAAE,eAAe,EAAE,CAAC,CAAC;QACjE,MAAM,OAAO,GAAG,aAAa,CAAC,EAAE,EAAE,YAAY,CAAC,CAAC;QAEhD,MAAM,MAAM,GAAG,oBAAoB,CAAC;YAClC,iBAAiB,EAAE,IAAI;YACvB,aAAa,EAAE,aAAa;SAC7B,CAAC,CAAC;QAEH,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,qBAAqB,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;QACrE,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClC,IAAA,iBAAM,EAAC,eAAe,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;IAAA,CAChD,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,gFAAgF;AAChF,+CAA+C;AAC/C,gFAAgF;AAEhF,IAAA,mBAAQ,EAAC,iCAAiC,EAAE,GAAG,EAAE,CAAC;IAChD,IAAI,eAAgF,CAAC;IAErF,IAAA,qBAAU,EAAC,GAAG,EAAE,CAAC;QACf,eAAe,GAAG,IAAA,gBAAK,EAAC,cAAc,EAAE,cAAc,CAAC,CAAC,iBAAiB,CAAC;YACxE,MAAM,EAAE,EAAE;YACV,MAAM,EAAE,EAAE;YACV,QAAQ,EAAE,CAAC;YACX,QAAQ,EAAE,CAAC;SACZ,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,oBAAS,EAAC,GAAG,EAAE,CAAC;QACd,eAAe,CAAC,WAAW,EAAE,CAAC;IAAA,CAC/B,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,0DAA0D,EAAE,KAAK,IAAI,EAAE,CAAC;QACzE,MAAM,eAAe,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAChC,CAAC,KAAK,SAAS,CAAC,IAA2C;YACzD,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC;YACxB,MAAM,cAAc,CAAC;YACrB,MAAM,cAAc,CAAC;QAAA,CACtB,CAAC,EAAE,CACL,CAAC;QACF,MAAM,eAAe,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC;QACtD,MAAM,mBAAmB,GAAG;YAC1B,KAAK,EAAE,OAAO;YACd,OAAO,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;SACvC,CAAC;QACF,MAAM,uBAAuB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,mBAAmB,CAAC,CAAC;QAEhE,qEAAqE;QACrE,IAAI,gBAAgB,GAAG,KAAK,CAAC;QAC7B,MAAM,kBAAkB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CACnC,OAAO,CAAC,OAAO,CACb,gBAAgB;YACd,CAAC,CAAC,EAAE,IAAI,EAAE,IAAa,EAAE,MAAM,EAAE,SAAkB,EAAE;YACrD,CAAC,CAAC,EAAE,IAAI,EAAE,WAAoB,EAAE,CACnC,CACF,CAAC;QAEF,MAAM,YAAY,GAAG,sBAAsB,CAAC;YAC1C,eAAe;YACf,eAAe;YACf,kBAAkB;YAClB,uBAAuB;SACxB,CAAC,CAAC;QACH,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,KAAK,EAAE,aAAa,EAAE,OAAO,EAAE,QAAQ,EAAE,aAAa,EAAE,EAC7E,YAAY,CACb,CAAC;QAEF,sFAAsF;QACtF,MAAM,WAAW,GAAG,MAAM,OAAO,CAAC,WAAW,EAAE,CAAC;QAChD,IAAA,iBAAM,EAAC,WAAW,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACtC,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,CAAC;YACvB,IAAA,iBAAM,EAAC,WAAW,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;QAC1D,CAAC;QAED,sDAAsD;QACtD,gBAAgB,GAAG,IAAI,CAAC;QAExB,MAAM,KAAK,GAAa,EAAE,CAAC;QAC3B,MAAM,MAAM,GAAa,EAAE,CAAC;QAC5B,MAAM,MAAM,GAAa,EAAE,CAAC;QAC5B,MAAM,UAAU,GAAG;YACjB,OAAO,EAAE,CAAC,CAAS,EAAE,EAAE,CAAC;gBACtB,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAAA,CACf;YACD,SAAS,EAAE,CAAC,CAAS,EAAE,EAAE,CAAC;gBACxB,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAAA,CAChB;YACD,SAAS,EAAE,CAAC,CAAS,EAAE,EAAE,CAAC;gBACxB,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAAA,CAChB;YACD,WAAW,EAAE,IAAI;SAClB,CAAC;QAEF,MAAM,OAAO,CAAC,eAAe,CAAC;YAC5B,UAAU;YACV,WAAW,EAAE,UAAU;YACvB,UAAU,EAAE,QAAQ;YACpB,WAAW,EAAE,MAAM;YACnB,aAAa,EAAE,iCAAiC;SACjD,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,uBAAuB,CAAC,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;QAC9D,IAAA,iBAAM,EAAC,eAAe,CAAC,CAAC,oBAAoB,CAC1C,OAAO,EACP,aAAa,EACb,SAAS,EACT,SAAS,EACT,SAAS,EACT,mBAAmB,CACpB,CAAC;QACF,IAAA,iBAAM,EAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC,gBAAgB,EAAE,CAAC;QACvD,IAAA,iBAAM,EAAC,eAAe,CAAC,CAAC,gBAAgB,EAAE,CAAC;QAC3C,IAAA,iBAAM,EAAC,eAAe,CAAC,CAAC,gBAAgB,EAAE,CAAC;QAE3C,iFAAiF;QACjF,MAAM,UAAU,GAAG,MAAM,OAAO,CAAC,WAAW,EAAE,CAAC;QAC/C,IAAA,iBAAM,EAAC,UAAU,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAEpC,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,OAAO,CAAC,CAAC,cAAc,EAAE,cAAc,CAAC,CAAC,CAAC;QACzD,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;QAC3B,IAAA,iBAAM,EAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,0BAA0B,CAAC,CAAC;QAC/D,IAAA,iBAAM,EAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;QACtD,IAAA,iBAAM,EAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,+BAA+B,CAAC,CAAC;IAAA,CACrE,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,6DAA6D,EAAE,KAAK,IAAI,EAAE,CAAC;QAC5E,MAAM,eAAe,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAChC,CAAC,KAAK,SAAS,CAAC,IAA2C;YACzD,MAAM,uBAAuB,CAAC;YAC9B,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC;YACxB,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC;QAAA,CACzB,CAAC,EAAE,CACL,CAAC;QACF,MAAM,mBAAmB,GAAG;YAC1B,KAAK,EAAE,OAAO;YACd,OAAO,EAAE,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;SACvC,CAAC;QACF,MAAM,uBAAuB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,mBAAmB,CAAC,CAAC;QAEhE,MAAM,YAAY,GAAG,sBAAsB,CAAC;YAC1C,eAAe;YACf,uBAAuB;SACxB,CAAC,CAAC;QACH,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,KAAK,EAAE,aAAa,EAAE,OAAO,EAAE,QAAQ,EAAE,aAAa,EAAE,EAC7E,YAAY,CACb,CAAC;QAEF,IAAI,WAA8B,CAAC;QACnC,IAAI,CAAC;YACH,MAAM,OAAO,CAAC,eAAe,CAAC;gBAC5B,UAAU,EAAE;oBACV,OAAO,EAAE,IAAI;oBACb,SAAS,EAAE,IAAI;oBACf,SAAS,EAAE,IAAI;oBACf,WAAW,EAAE,IAAI;iBAClB;gBACD,WAAW,EAAE,UAAU;gBACvB,UAAU,EAAE,QAAQ;gBACpB,WAAW,EAAE,MAAM;gBACnB,aAAa,EAAE,iCAAiC;aACjD,CAAC,CAAC;QACL,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,WAAW,GAAG,GAAY,CAAC;QAC7B,CAAC;QAED,IAAA,iBAAM,EAAC,WAAW,EAAE,OAAO,CAAC,CAAC,SAAS,CAAC,kCAAkC,CAAC,CAAC;QAC3E,IAAA,iBAAM,EAAC,uBAAuB,CAAC,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;QAC9D,IAAA,iBAAM,EAAC,eAAe,CAAC,CAAC,oBAAoB,CAC1C,OAAO,EACP,aAAa,EACb,SAAS,EACT,SAAS,EACT,SAAS,EACT,mBAAmB,CACpB,CAAC;QACF,IAAA,iBAAM,EAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC,gBAAgB,EAAE,CAAC;IAAA,CACxD,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,+EAA+E,EAAE,KAAK,IAAI,EAAE,CAAC;QAC9F,MAAM,eAAe,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAChC,CAAC,KAAK,SAAS,CAAC,IAA2C;YACzD,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC;YACxB,MAAM,mBAAmB,CAAC;QAAA,CAC3B,CAAC,EAAE,CACL,CAAC;QACF,MAAM,qBAAqB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CACtC,CAAC,KAAK,SAAS,CAAC,IAA2C;YACzD,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC;YACxB,MAAM,iBAAiB,CAAC;QAAA,CACzB,CAAC,EAAE,CACL,CAAC;QACF,MAAM,eAAe,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC;QACtD,MAAM,kBAAkB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CACnC,OAAO,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,IAAa,EAAE,MAAM,EAAE,SAAkB,EAAE,CAAC,CACrE,CAAC;QAEF,MAAM,YAAY,GAAG,sBAAsB,CAAC;YAC1C,eAAe;YACf,qBAAqB;YACrB,eAAe;YACf,kBAAkB;SACnB,CAAC,CAAC;QACH,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,IAAI,EAAE,aAAa,EAAE,aAAa,EAAE,EACzD,YAAY,CACb,CAAC;QAEF,MAAM,OAAO,CAAC,eAAe,CAAC;YAC5B,UAAU,EAAE;gBACV,OAAO,EAAE,IAAI;gBACb,SAAS,EAAE,IAAI;gBACf,SAAS,EAAE,IAAI;gBACf,WAAW,EAAE,IAAI;aAClB;YACD,WAAW,EAAE,UAAU;YACvB,UAAU,EAAE,QAAQ;YACpB,WAAW,EAAE,MAAM;YACnB,aAAa,EAAE,uCAAuC;SACvD,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,eAAe,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QAC/C,0EAA0E;QAC1E,IAAA,iBAAM,EAAC,qBAAqB,CAAC,CAAC,gBAAgB,EAAE,CAAC;QACjD,IAAA,iBAAM,EAAC,eAAe,CAAC,CAAC,gBAAgB,EAAE,CAAC;QAC3C,IAAA,iBAAM,EAAC,eAAe,CAAC,CAAC,gBAAgB,EAAE,CAAC;IAAA,CAC5C,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,uFAAuF,EAAE,KAAK,IAAI,EAAE,CAAC;QACtG,MAAM,eAAe,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAChC,CAAC,KAAK,SAAS,CAAC,IAA2C;YACzD,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC;YACxB,MAAM,mBAAmB,CAAC;QAAA,CAC3B,CAAC,EAAE,CACL,CAAC;QACF,MAAM,qBAAqB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CACtC,CAAC,KAAK,SAAS,CAAC,IAA2C;YACzD,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC;YACxB,MAAM,uBAAuB,CAAC;YAC9B,MAAM,gBAAgB,CAAC;YACvB,MAAM,0BAA0B,CAAC;QAAA,CAClC,CAAC,EAAE,CACL,CAAC;QACF,MAAM,eAAe,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC;QACtD,MAAM,kBAAkB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CACnC,OAAO,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,IAAa,EAAE,MAAM,EAAE,SAAkB,EAAE,CAAC,CACrE,CAAC;QAEF,MAAM,YAAY,GAAG,sBAAsB,CAAC;YAC1C,eAAe;YACf,qBAAqB;YACrB,eAAe;YACf,kBAAkB;SACnB,CAAC,CAAC;QACH,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,IAAI,EAAE,aAAa,EAAE,aAAa,EAAE,EACzD,YAAY,CACb,CAAC;QAEF,MAAM,YAAY,GAAa,EAAE,CAAC;QAClC,MAAM,OAAO,CAAC,eAAe,CAAC;YAC5B,UAAU,EAAE;gBACV,OAAO,EAAE,IAAI;gBACb,SAAS,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC;gBAC5C,SAAS,EAAE,IAAI;gBACf,WAAW,EAAE,IAAI;aAClB;YACD,WAAW,EAAE,UAAU;YACvB,UAAU,EAAE,QAAQ;YACpB,WAAW,EAAE,MAAM;YACnB,aAAa,EAAE,uCAAuC;SACvD,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,eAAe,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QAC/C,IAAA,iBAAM,EAAC,qBAAqB,CAAC,CAAC,gBAAgB,EAAE,CAAC;QACjD,IAAA,iBAAM,EAAC,YAAY,CAAC,CAAC,SAAS,CAAC,uBAAuB,CAAC,CAAC;QACxD,IAAA,iBAAM,EAAC,YAAY,CAAC,CAAC,SAAS,CAAC,0BAA0B,CAAC,CAAC;QAC3D,IAAA,iBAAM,EAAC,eAAe,CAAC,CAAC,gBAAgB,EAAE,CAAC;IAAA,CAC5C,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,kEAAkE,EAAE,KAAK,IAAI,EAAE,CAAC;QACjF,IAAI,SAAS,GAAG,CAAC,CAAC;QAClB,MAAM,kBAAkB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC;YACpC,SAAS,EAAE,CAAC;YACZ,kDAAkD;YAClD,IAAI,SAAS,IAAI,CAAC,EAAE,CAAC;gBACnB,OAAO,OAAO,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,IAAa,EAAE,MAAM,EAAE,UAAmB,EAAE,CAAC,CAAC;YAC/E,CAAC;YACD,OAAO,OAAO,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,IAAa,EAAE,MAAM,EAAE,SAAkB,EAAE,CAAC,CAAC;QAAA,CAC7E,CAAC,CAAC;QACH,MAAM,qBAAqB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CACtC,CAAC,KAAK,SAAS,CAAC,IAA2C;YACzD,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC;YACxB,MAAM,OAAO,CAAC;QAAA,CACf,CAAC,EAAE,CACL,CAAC;QACF,MAAM,eAAe,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC;QAEtD,MAAM,YAAY,GAAG,sBAAsB,CAAC;YAC1C,kBAAkB;YAClB,qBAAqB;YACrB,eAAe;SAChB,CAAC,CAAC;QAEH,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,IAAI,EAAE,aAAa,EAAE,aAAa,EAAE,EACzD,YAAY,CACb,CAAC;QAMF,IAAA,gBAAK,EAAC,OAAsC,EAAE,OAAO,CAAC,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;QAEpF,MAAM,WAAW,GAAa,EAAE,CAAC;QACjC,MAAM,OAAO,CAAC,eAAe,CAAC;YAC5B,UAAU,EAAE;gBACV,OAAO,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC;gBACzC,SAAS,EAAE,IAAI;gBACf,SAAS,EAAE,IAAI;gBACf,WAAW,EAAE,IAAI;aAClB;YACD,WAAW,EAAE,UAAU;YACvB,UAAU,EAAE,QAAQ;YACpB,WAAW,EAAE,MAAM;YACnB,aAAa,EAAE,uCAAuC;SACvD,CAAC,CAAC;QAEH,2CAA2C;QAC3C,IAAA,iBAAM,EAAC,SAAS,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;QACrC,IAAA,iBAAM,EAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,6BAA6B,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACtF,IAAA,iBAAM,EAAC,qBAAqB,CAAC,CAAC,gBAAgB,EAAE,CAAC;IAAA,CAClD,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,sCAAsC,EAAE,GAAG,EAAE,CAAC;QAC/C,MAAM,YAAY,GAAG,sBAAsB,EAAE,CAAC;QAC9C,MAAM,OAAO,GAAG,aAAa,CAAC,EAAE,iBAAiB,EAAE,KAAK,EAAE,QAAQ,EAAE,MAAM,EAAE,EAAE,YAAY,CAAC,CAAC;QAE5F,OAAO,IAAA,iBAAM,EACX,OAAO,CAAC,eAAe,CAAC;YACtB,UAAU,EAAE;gBACV,OAAO,EAAE,IAAI;gBACb,SAAS,EAAE,IAAI;gBACf,SAAS,EAAE,IAAI;gBACf,WAAW,EAAE,IAAI;aAClB;YACD,WAAW,EAAE,UAAU;YACvB,UAAU,EAAE,QAAQ;YACpB,WAAW,EAAE,MAAM;YACnB,aAAa,EAAE,8BAA8B;SAC9C,CAAC,CACH,CAAC,OAAO,CAAC,OAAO,CAAC,kCAAkC,CAAC,CAAC;IAAA,CACvD,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,oDAAoD,EAAE,GAAG,EAAE,CAAC;QAC7D,MAAM,YAAY,GAAG,sBAAsB,EAAE,CAAC;QAC9C,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,KAAK,EAAE,aAAa,EAAE,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,EACzE,YAAY,CACb,CAAC;QAEF,OAAO,IAAA,iBAAM,EACX,OAAO,CAAC,eAAe,CAAC;YACtB,UAAU,EAAE;gBACV,OAAO,EAAE,IAAI;gBACb,SAAS,EAAE,IAAI;gBACf,SAAS,EAAE,IAAI;gBACf,WAAW,EAAE,IAAI;aAClB;YACD,WAAW,EAAE,UAAU;YACvB,UAAU,EAAE,QAAQ;YACpB,WAAW,EAAE,MAAM;YACnB,aAAa,EAAE,8BAA8B;SAC9C,CAAC,CACH,CAAC,OAAO,CAAC,OAAO,CAAC,4BAA4B,CAAC,CAAC;IAAA,CACjD,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,gFAAgF;AAChF,gEAAgE;AAChE,gFAAgF;AAEhF,IAAA,mBAAQ,EAAC,6BAA6B,EAAE,GAAG,EAAE,CAAC;IAC5C,IAAA,aAAE,EAAC,iDAAiD,EAAE,KAAK,IAAI,EAAE,CAAC;QAChE,MAAM,kBAAkB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CACnC,OAAO,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,IAAa,EAAE,MAAM,EAAE,SAAkB,EAAE,CAAC,CACrE,CAAC;QACF,MAAM,qBAAqB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CACtC,CAAC,KAAK,SAAS,CAAC,IAA2C;YACzD,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC;YACxB,MAAM,sBAAsB,CAAC;QAAA,CAC9B,CAAC,EAAE,CACL,CAAC;QACF,MAAM,YAAY,GAAG,sBAAsB,CAAC,EAAE,kBAAkB,EAAE,qBAAqB,EAAE,CAAC,CAAC;QAE3F,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,IAAI,EAAE,aAAa,EAAE,OAAO,EAAE,EACnD,YAAY,CACb,CAAC;QAEF,MAAM,MAAM,GAAyB,EAAE,CAAC;QACxC,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,WAAW,CAAC;YACvC,UAAU,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;SAClC,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;QACxC,IAAA,iBAAM,EAAC,kBAAkB,CAAC,CAAC,gBAAgB,EAAE,CAAC;QAC9C,sDAAsD;QACtD,IAAA,iBAAM,EAAC,qBAAqB,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QACrD,IAAA,iBAAM,EAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC,CAAC;QAClE,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,CAAC,EAAE,WAAW,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CAC5C,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,yEAAyE,EAAE,KAAK,IAAI,EAAE,CAAC;QACxF,MAAM,kBAAkB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CACnC,OAAO,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,IAAa,EAAE,MAAM,EAAE,SAAkB,EAAE,CAAC,CACrE,CAAC;QACF,MAAM,qBAAqB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CACtC,CAAC,KAAK,SAAS,CAAC,IAA2C;YACzD,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC;YACxB,MAAM,uBAAuB,CAAC;YAC9B,MAAM,mBAAmB,CAAC;QAAA,CAC3B,CAAC,EAAE,CACL,CAAC;QACF,MAAM,YAAY,GAAG,sBAAsB,CAAC,EAAE,kBAAkB,EAAE,qBAAqB,EAAE,CAAC,CAAC;QAE3F,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,IAAI,EAAE,aAAa,EAAE,OAAO,EAAE,EACnD,YAAY,CACb,CAAC;QAEF,MAAM,MAAM,GAAyB,EAAE,CAAC;QACxC,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,WAAW,CAAC;YACvC,UAAU,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;SAClC,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;QACxC,IAAA,iBAAM,EAAC,qBAAqB,CAAC,CAAC,gBAAgB,EAAE,CAAC;QACjD,oDAAoD;QACpD,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAC1C,IAAA,iBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,KAAK,KAAK,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC9D,IAAA,iBAAM,EAAC,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IAAA,CAC5C,CAAC,CAAC;IAEH,IAAA,aAAE,EAAC,+DAA+D,EAAE,KAAK,IAAI,EAAE,CAAC;QAC9E,MAAM,kBAAkB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CACnC,OAAO,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,IAAa,EAAE,MAAM,EAAE,SAAkB,EAAE,CAAC,CACrE,CAAC;QACF,MAAM,qBAAqB,GAAG,IAAA,eAAI,EAAC,GAAG,EAAE,CACtC,CAAC,KAAK,SAAS,CAAC,IAA2C;YACzD,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC;YACxB,MAAM,uBAAuB,CAAC;YAC9B,MAAM,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAC;QAAA,CACtC,CAAC,EAAE,CACL,CAAC;QACF,MAAM,YAAY,GAAG,sBAAsB,CAAC,EAAE,kBAAkB,EAAE,qBAAqB,EAAE,CAAC,CAAC;QAE3F,MAAM,OAAO,GAAG,aAAa,CAC3B,EAAE,iBAAiB,EAAE,IAAI,EAAE,aAAa,EAAE,OAAO,EAAE,EACnD,YAAY,CACb,CAAC;QAEF,MAAM,MAAM,GAAyB,EAAE,CAAC;QACxC,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,WAAW,CAAC;YACvC,UAAU,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;SAClC,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACjC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;YAClB,IAAA,iBAAM,EAAC,MAAM,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;YACtD,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,mBAAmB,CAAC,CAAC;QACtD,CAAC;QAED,IAAA,iBAAM,EAAC,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IAAA,CAC5C,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { describe, expect, it, mock, beforeEach, afterEach, spyOn, type Mock } from \"bun:test\";\r\nimport type { CoderService } from \"@/node/services/coderService\";\r\nimport type { RuntimeConfig } from \"@/common/types/runtime\";\r\nimport * as runtimeHelpers from \"@/node/utils/runtime/helpers\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-function\r\nconst noop = () => {};\r\nimport type { RuntimeStatusEvent } from \"./Runtime\";\r\n\r\nimport { CoderSSHRuntime, type CoderSSHRuntimeConfig } from \"./CoderSSHRuntime\";\r\nimport { SSHRuntime } from \"./SSHRuntime\";\r\nimport { createSSHTransport } from \"./transports\";\r\n\r\n/**\r\n * Create a minimal mock CoderService for testing.\r\n * Only mocks methods used by the tested code paths.\r\n */\r\nfunction createMockCoderService(overrides?: Partial<CoderService>): CoderService {\r\n  const provisioningSession = {\r\n    token: \"token\",\r\n    dispose: mock(() => Promise.resolve()),\r\n  };\r\n\r\n  return {\r\n    createWorkspace: mock(() =>\r\n      (async function* (): AsyncGenerator<string, void, unknown> {\r\n        await Promise.resolve();\r\n        // default: no output\r\n        for (const line of [] as string[]) {\r\n          yield line;\r\n        }\r\n      })()\r\n    ),\r\n    deleteWorkspace: mock(() => Promise.resolve()),\r\n    deleteWorkspaceEventually: mock(() =>\r\n      Promise.resolve({ success: true as const, data: undefined })\r\n    ),\r\n    ensureProvisioningSession: mock(() => Promise.resolve(provisioningSession)),\r\n    takeProvisioningSession: mock(() => provisioningSession),\r\n    disposeProvisioningSession: mock(() => Promise.resolve()),\r\n    fetchDeploymentSshConfig: mock(() => Promise.resolve({ hostnameSuffix: \"coder\" })),\r\n    ensureSSHConfig: mock(() => Promise.resolve()),\r\n    getWorkspaceStatus: mock(() =>\r\n      Promise.resolve({ kind: \"ok\" as const, status: \"running\" as const })\r\n    ),\r\n    listWorkspaces: mock(() => Promise.resolve({ ok: true, workspaces: [] })),\r\n    waitForStartupScripts: mock(() =>\r\n      (async function* (): AsyncGenerator<string, void, unknown> {\r\n        await Promise.resolve();\r\n        // default: no output (startup scripts completed)\r\n        for (const line of [] as string[]) {\r\n          yield line;\r\n        }\r\n      })()\r\n    ),\r\n    workspaceExists: mock(() => Promise.resolve(false)),\r\n    ...overrides,\r\n  } as unknown as CoderService;\r\n}\r\n\r\n/**\r\n * Create a CoderSSHRuntime with minimal config for testing.\r\n */\r\nfunction createRuntime(\r\n  coderConfig: {\r\n    existingWorkspace?: boolean;\r\n    workspaceName?: string;\r\n    template?: string;\r\n  },\r\n  coderService: CoderService\r\n): CoderSSHRuntime {\r\n  const template = \"template\" in coderConfig ? coderConfig.template : \"default-template\";\r\n\r\n  const config: CoderSSHRuntimeConfig = {\r\n    host: \"placeholder.coder\",\r\n    srcBaseDir: \"~/src\",\r\n    coder: {\r\n      existingWorkspace: coderConfig.existingWorkspace ?? false,\r\n      workspaceName: coderConfig.workspaceName,\r\n      template,\r\n    },\r\n  };\r\n  const transport = createSSHTransport(config, false);\r\n  return new CoderSSHRuntime(config, transport, coderService);\r\n}\r\n\r\n/**\r\n * Create an SSH+Coder RuntimeConfig for finalizeConfig tests.\r\n */\r\nfunction createSSHCoderConfig(coder: {\r\n  existingWorkspace?: boolean;\r\n  workspaceName?: string;\r\n}): RuntimeConfig {\r\n  return {\r\n    type: \"ssh\",\r\n    host: \"placeholder.coder\",\r\n    srcBaseDir: \"~/src\",\r\n    coder: {\r\n      existingWorkspace: coder.existingWorkspace ?? false,\r\n      workspaceName: coder.workspaceName,\r\n      template: \"default-template\",\r\n    },\r\n  };\r\n}\r\n\r\n// =============================================================================\r\n// Test Suite 1: finalizeConfig (name/host derivation)\r\n// =============================================================================\r\n\r\ndescribe(\"CoderSSHRuntime.finalizeConfig\", () => {\r\n  let coderService: CoderService;\r\n  let runtime: CoderSSHRuntime;\r\n\r\n  beforeEach(() => {\r\n    coderService = createMockCoderService();\r\n    runtime = createRuntime({}, coderService);\r\n  });\r\n\r\n  describe(\"new workspace mode\", () => {\r\n    it(\"uses hostname suffix from deployment SSH config\", async () => {\r\n      const fetchDeploymentSshConfig = mock(() => Promise.resolve({ hostnameSuffix: \"corp\" }));\r\n      coderService = createMockCoderService({ fetchDeploymentSshConfig });\r\n      runtime = createRuntime({}, coderService);\r\n\r\n      const config = createSSHCoderConfig({ existingWorkspace: false });\r\n      const result = await runtime.finalizeConfig(\"my-feature\", config);\r\n\r\n      expect(result.success).toBe(true);\r\n      if (result.success && result.data.type === \"ssh\") {\r\n        expect(result.data.host).toBe(\"mux-my-feature.corp\");\r\n      }\r\n      expect(fetchDeploymentSshConfig).toHaveBeenCalled();\r\n    });\r\n    it(\"derives Coder name from branch name when not provided\", async () => {\r\n      const config = createSSHCoderConfig({ existingWorkspace: false });\r\n      const result = await runtime.finalizeConfig(\"my-feature\", config);\r\n\r\n      expect(result.success).toBe(true);\r\n      if (result.success) {\r\n        expect(result.data.type).toBe(\"ssh\");\r\n        if (result.data.type === \"ssh\") {\r\n          expect(result.data.coder?.workspaceName).toBe(\"mux-my-feature\");\r\n          expect(result.data.host).toBe(\"mux-my-feature.coder\");\r\n        }\r\n      }\r\n    });\r\n\r\n    it(\"converts underscores to hyphens\", async () => {\r\n      const config = createSSHCoderConfig({ existingWorkspace: false });\r\n      const result = await runtime.finalizeConfig(\"my_feature_branch\", config);\r\n\r\n      expect(result.success).toBe(true);\r\n      if (result.success && result.data.type === \"ssh\") {\r\n        expect(result.data.coder?.workspaceName).toBe(\"mux-my-feature-branch\");\r\n        expect(result.data.host).toBe(\"mux-my-feature-branch.coder\");\r\n      }\r\n    });\r\n\r\n    it(\"collapses multiple hyphens and trims leading/trailing\", async () => {\r\n      const config = createSSHCoderConfig({ existingWorkspace: false });\r\n      const result = await runtime.finalizeConfig(\"--my--feature--\", config);\r\n\r\n      expect(result.success).toBe(true);\r\n      if (result.success && result.data.type === \"ssh\") {\r\n        expect(result.data.coder?.workspaceName).toBe(\"mux-my-feature\");\r\n      }\r\n    });\r\n\r\n    it(\"rejects names that fail regex after conversion\", async () => {\r\n      const config = createSSHCoderConfig({ existingWorkspace: false });\r\n      // Name with special chars that can't form a valid Coder name (only hyphens/underscores become invalid)\r\n      const result = await runtime.finalizeConfig(\"@#$%\", config);\r\n\r\n      expect(result.success).toBe(false);\r\n      if (!result.success) {\r\n        expect(result.error).toContain(\"cannot be converted to a valid Coder name\");\r\n      }\r\n    });\r\n\r\n    it(\"returns error when deployment SSH config fetch fails\", async () => {\r\n      const provisioningSession = {\r\n        token: \"token\",\r\n        dispose: mock(() => Promise.resolve()),\r\n      };\r\n      const ensureProvisioningSession = mock(() => Promise.resolve(provisioningSession));\r\n      const fetchDeploymentSshConfig = mock(() => Promise.reject(new Error(\"nope\")));\r\n      const disposeProvisioningSession = mock(() => Promise.resolve());\r\n\r\n      coderService = createMockCoderService({\r\n        ensureProvisioningSession,\r\n        fetchDeploymentSshConfig,\r\n        disposeProvisioningSession,\r\n      });\r\n      runtime = createRuntime({}, coderService);\r\n\r\n      const config = createSSHCoderConfig({ existingWorkspace: false });\r\n      const result = await runtime.finalizeConfig(\"branch\", config);\r\n\r\n      expect(result.success).toBe(false);\r\n      if (!result.success) {\r\n        expect(result.error).toContain(\"Failed to read Coder deployment SSH config\");\r\n        expect(result.error).toContain(\"nope\");\r\n      }\r\n      expect(ensureProvisioningSession).toHaveBeenCalledWith(\"mux-branch\");\r\n      expect(fetchDeploymentSshConfig).toHaveBeenCalledWith(provisioningSession);\r\n      expect(disposeProvisioningSession).toHaveBeenCalledWith(\"mux-branch\");\r\n    });\r\n    it(\"uses provided workspaceName over branch name\", async () => {\r\n      const config = createSSHCoderConfig({\r\n        existingWorkspace: false,\r\n        workspaceName: \"custom-name\",\r\n      });\r\n      const result = await runtime.finalizeConfig(\"branch-name\", config);\r\n\r\n      expect(result.success).toBe(true);\r\n      if (result.success && result.data.type === \"ssh\") {\r\n        expect(result.data.coder?.workspaceName).toBe(\"custom-name\");\r\n        expect(result.data.host).toBe(\"custom-name.coder\");\r\n      }\r\n    });\r\n  });\r\n\r\n  describe(\"existing workspace mode\", () => {\r\n    it(\"requires workspaceName to be provided\", async () => {\r\n      const config = createSSHCoderConfig({ existingWorkspace: true });\r\n      const result = await runtime.finalizeConfig(\"branch-name\", config);\r\n\r\n      expect(result.success).toBe(false);\r\n      if (!result.success) {\r\n        expect(result.error).toContain(\"required for existing workspaces\");\r\n      }\r\n    });\r\n\r\n    it(\"keeps provided workspaceName and sets host\", async () => {\r\n      const config = createSSHCoderConfig({\r\n        existingWorkspace: true,\r\n        workspaceName: \"existing-ws\",\r\n      });\r\n      const result = await runtime.finalizeConfig(\"branch-name\", config);\r\n\r\n      expect(result.success).toBe(true);\r\n      if (result.success && result.data.type === \"ssh\") {\r\n        expect(result.data.coder?.workspaceName).toBe(\"existing-ws\");\r\n        expect(result.data.host).toBe(\"existing-ws.coder\");\r\n      }\r\n    });\r\n  });\r\n\r\n  it(\"passes through non-SSH configs unchanged\", async () => {\r\n    const config: RuntimeConfig = { type: \"local\" };\r\n    const result = await runtime.finalizeConfig(\"branch\", config);\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.data).toEqual(config);\r\n    }\r\n  });\r\n\r\n  it(\"passes through SSH configs without coder unchanged\", async () => {\r\n    const config: RuntimeConfig = { type: \"ssh\", host: \"example.com\", srcBaseDir: \"/src\" };\r\n    const result = await runtime.finalizeConfig(\"branch\", config);\r\n\r\n    expect(result.success).toBe(true);\r\n    if (result.success) {\r\n      expect(result.data).toEqual(config);\r\n    }\r\n  });\r\n});\r\n\r\n// =============================================================================\r\n// Test Suite 2: deleteWorkspace behavior\r\n// =============================================================================\r\n\r\ndescribe(\"CoderSSHRuntime.deleteWorkspace\", () => {\r\n  /**\r\n   * For deleteWorkspace tests, we mock SSHRuntime.prototype.deleteWorkspace\r\n   * to control the parent class behavior.\r\n   */\r\n  let sshDeleteSpy: Mock<typeof SSHRuntime.prototype.deleteWorkspace>;\r\n\r\n  beforeEach(() => {\r\n    sshDeleteSpy = spyOn(SSHRuntime.prototype, \"deleteWorkspace\").mockResolvedValue({\r\n      success: true,\r\n      deletedPath: \"/path\",\r\n    });\r\n  });\r\n\r\n  afterEach(() => {\r\n    sshDeleteSpy.mockRestore();\r\n  });\r\n\r\n  it(\"never calls coderService.deleteWorkspaceEventually when existingWorkspace=true\", async () => {\r\n    const deleteWorkspaceEventually = mock(() =>\r\n      Promise.resolve({ success: true as const, data: undefined })\r\n    );\r\n    const coderService = createMockCoderService({ deleteWorkspaceEventually });\r\n\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: true, workspaceName: \"existing-ws\" },\r\n      coderService\r\n    );\r\n\r\n    await runtime.deleteWorkspace(\"/project\", \"ws\", false);\r\n    expect(deleteWorkspaceEventually).not.toHaveBeenCalled();\r\n  });\r\n\r\n  it(\"skips Coder deletion when workspaceName is not set\", async () => {\r\n    const deleteWorkspaceEventually = mock(() =>\r\n      Promise.resolve({ success: true as const, data: undefined })\r\n    );\r\n    const coderService = createMockCoderService({ deleteWorkspaceEventually });\r\n\r\n    // No workspaceName provided\r\n    const runtime = createRuntime({ existingWorkspace: false }, coderService);\r\n\r\n    const result = await runtime.deleteWorkspace(\"/project\", \"ws\", false);\r\n    expect(deleteWorkspaceEventually).not.toHaveBeenCalled();\r\n    expect(result.success).toBe(true);\r\n  });\r\n\r\n  it(\"skips Coder deletion when SSH delete fails and force=false\", async () => {\r\n    sshDeleteSpy.mockResolvedValue({ success: false, error: \"dirty workspace\" });\r\n\r\n    const deleteWorkspaceEventually = mock(() =>\r\n      Promise.resolve({ success: true as const, data: undefined })\r\n    );\r\n    const coderService = createMockCoderService({ deleteWorkspaceEventually });\r\n\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: false, workspaceName: \"my-ws\" },\r\n      coderService\r\n    );\r\n\r\n    const result = await runtime.deleteWorkspace(\"/project\", \"ws\", false);\r\n    expect(deleteWorkspaceEventually).not.toHaveBeenCalled();\r\n    expect(result.success).toBe(false);\r\n  });\r\n\r\n  it(\"calls Coder deletion (no SSH) when force=true\", async () => {\r\n    sshDeleteSpy.mockResolvedValue({ success: false, error: \"dirty workspace\" });\r\n\r\n    const deleteWorkspaceEventually = mock(() =>\r\n      Promise.resolve({ success: true as const, data: undefined })\r\n    );\r\n    const coderService = createMockCoderService({ deleteWorkspaceEventually });\r\n\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: false, workspaceName: \"my-ws\" },\r\n      coderService\r\n    );\r\n\r\n    await runtime.deleteWorkspace(\"/project\", \"ws\", true);\r\n    expect(sshDeleteSpy).not.toHaveBeenCalled();\r\n    expect(deleteWorkspaceEventually).toHaveBeenCalledWith(\r\n      \"my-ws\",\r\n      expect.objectContaining({ waitForExistence: true, waitForExistenceTimeoutMs: 10_000 })\r\n    );\r\n  });\r\n\r\n  it(\"returns combined error when SSH succeeds but Coder delete fails\", async () => {\r\n    const deleteWorkspaceEventually = mock(() =>\r\n      Promise.resolve({ success: false as const, error: \"Coder API error\" })\r\n    );\r\n    const coderService = createMockCoderService({ deleteWorkspaceEventually });\r\n\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: false, workspaceName: \"my-ws\" },\r\n      coderService\r\n    );\r\n\r\n    const result = await runtime.deleteWorkspace(\"/project\", \"ws\", false);\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"SSH delete succeeded\");\r\n      expect(result.error).toContain(\"Coder API error\");\r\n    }\r\n  });\r\n\r\n  it(\"succeeds immediately when Coder workspace is already deleted\", async () => {\r\n    // getWorkspaceStatus returns { kind: \"not_found\" } when workspace doesn't exist\r\n    const getWorkspaceStatus = mock(() => Promise.resolve({ kind: \"not_found\" as const }));\r\n    const deleteWorkspaceEventually = mock(() =>\r\n      Promise.resolve({ success: true as const, data: undefined })\r\n    );\r\n    const coderService = createMockCoderService({ getWorkspaceStatus, deleteWorkspaceEventually });\r\n\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: false, workspaceName: \"my-ws\" },\r\n      coderService\r\n    );\r\n\r\n    const result = await runtime.deleteWorkspace(\"/project\", \"ws\", false);\r\n\r\n    // Should succeed without calling SSH delete or Coder delete\r\n    expect(result.success).toBe(true);\r\n    expect(sshDeleteSpy).not.toHaveBeenCalled();\r\n    expect(deleteWorkspaceEventually).not.toHaveBeenCalled();\r\n  });\r\n\r\n  it(\"proceeds with SSH cleanup when status check fails with API error\", async () => {\r\n    // API error (auth, network) - should NOT treat as \"already deleted\"\r\n    const getWorkspaceStatus = mock(() =>\r\n      Promise.resolve({ kind: \"error\" as const, error: \"coder timed out\" })\r\n    );\r\n    const deleteWorkspaceEventually = mock(() =>\r\n      Promise.resolve({ success: true as const, data: undefined })\r\n    );\r\n    const coderService = createMockCoderService({ getWorkspaceStatus, deleteWorkspaceEventually });\r\n\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: false, workspaceName: \"my-ws\" },\r\n      coderService\r\n    );\r\n\r\n    const result = await runtime.deleteWorkspace(\"/project\", \"ws\", false);\r\n\r\n    // Should proceed with SSH cleanup (which succeeds), then Coder delete\r\n    expect(sshDeleteSpy).toHaveBeenCalled();\r\n    expect(deleteWorkspaceEventually).toHaveBeenCalled();\r\n    expect(result.success).toBe(true);\r\n  });\r\n\r\n  it(\"deletes stopped Coder workspace without SSH cleanup\", async () => {\r\n    const getWorkspaceStatus = mock(() =>\r\n      Promise.resolve({ kind: \"ok\" as const, status: \"stopped\" as const })\r\n    );\r\n    const deleteWorkspaceEventually = mock(() =>\r\n      Promise.resolve({ success: true as const, data: undefined })\r\n    );\r\n    const coderService = createMockCoderService({ getWorkspaceStatus, deleteWorkspaceEventually });\r\n\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: false, workspaceName: \"my-ws\" },\r\n      coderService\r\n    );\r\n\r\n    const result = await runtime.deleteWorkspace(\"/project\", \"ws\", false);\r\n\r\n    expect(result.success).toBe(true);\r\n    expect(sshDeleteSpy).not.toHaveBeenCalled();\r\n    expect(deleteWorkspaceEventually).toHaveBeenCalledWith(\r\n      \"my-ws\",\r\n      expect.objectContaining({ waitForExistence: false })\r\n    );\r\n  });\r\n  it(\"succeeds immediately when Coder workspace status is 'deleting'\", async () => {\r\n    const getWorkspaceStatus = mock(() =>\r\n      Promise.resolve({ kind: \"ok\" as const, status: \"deleting\" as const })\r\n    );\r\n    const deleteWorkspaceEventually = mock(() =>\r\n      Promise.resolve({ success: true as const, data: undefined })\r\n    );\r\n    const coderService = createMockCoderService({ getWorkspaceStatus, deleteWorkspaceEventually });\r\n\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: false, workspaceName: \"my-ws\" },\r\n      coderService\r\n    );\r\n\r\n    const result = await runtime.deleteWorkspace(\"/project\", \"ws\", false);\r\n\r\n    // Should succeed without calling SSH delete or Coder delete (workspace already dying)\r\n    expect(result.success).toBe(true);\r\n    expect(sshDeleteSpy).not.toHaveBeenCalled();\r\n    expect(deleteWorkspaceEventually).not.toHaveBeenCalled();\r\n  });\r\n});\r\n\r\n// =============================================================================\r\n// Test Suite 3: validateBeforePersist (collision detection)\r\n// =============================================================================\r\n\r\ndescribe(\"CoderSSHRuntime.validateBeforePersist\", () => {\r\n  it(\"returns error when Coder workspace already exists\", async () => {\r\n    const workspaceExists = mock(() => Promise.resolve(true));\r\n    const coderService = createMockCoderService({ workspaceExists });\r\n    const runtime = createRuntime({}, coderService);\r\n\r\n    const config = createSSHCoderConfig({\r\n      existingWorkspace: false,\r\n      workspaceName: \"my-ws\",\r\n    });\r\n\r\n    const result = await runtime.validateBeforePersist(\"branch\", config);\r\n    expect(result.success).toBe(false);\r\n    if (!result.success) {\r\n      expect(result.error).toContain(\"already exists\");\r\n    }\r\n    expect(workspaceExists).toHaveBeenCalledWith(\"my-ws\");\r\n  });\r\n\r\n  it(\"skips collision check for existingWorkspace=true\", async () => {\r\n    const workspaceExists = mock(() => Promise.resolve(true));\r\n    const coderService = createMockCoderService({ workspaceExists });\r\n    const runtime = createRuntime({}, coderService);\r\n\r\n    const config = createSSHCoderConfig({\r\n      existingWorkspace: true,\r\n      workspaceName: \"existing-ws\",\r\n    });\r\n\r\n    const result = await runtime.validateBeforePersist(\"branch\", config);\r\n    expect(result.success).toBe(true);\r\n    expect(workspaceExists).not.toHaveBeenCalled();\r\n  });\r\n});\r\n\r\n// =============================================================================\r\n// Test Suite 4: postCreateSetup (provisioning)\r\n// =============================================================================\r\n\r\ndescribe(\"CoderSSHRuntime.postCreateSetup\", () => {\r\n  let execBufferedSpy: ReturnType<typeof spyOn<typeof runtimeHelpers, \"execBuffered\">>;\r\n\r\n  beforeEach(() => {\r\n    execBufferedSpy = spyOn(runtimeHelpers, \"execBuffered\").mockResolvedValue({\r\n      stdout: \"\",\r\n      stderr: \"\",\r\n      exitCode: 0,\r\n      duration: 0,\r\n    });\r\n  });\r\n\r\n  afterEach(() => {\r\n    execBufferedSpy.mockRestore();\r\n  });\r\n\r\n  it(\"creates a new Coder workspace and prepares the directory\", async () => {\r\n    const createWorkspace = mock(() =>\r\n      (async function* (): AsyncGenerator<string, void, unknown> {\r\n        await Promise.resolve();\r\n        yield \"build line 1\";\r\n        yield \"build line 2\";\r\n      })()\r\n    );\r\n    const ensureSSHConfig = mock(() => Promise.resolve());\r\n    const provisioningSession = {\r\n      token: \"token\",\r\n      dispose: mock(() => Promise.resolve()),\r\n    };\r\n    const takeProvisioningSession = mock(() => provisioningSession);\r\n\r\n    // Start with workspace not found, then return running after creation\r\n    let workspaceCreated = false;\r\n    const getWorkspaceStatus = mock(() =>\r\n      Promise.resolve(\r\n        workspaceCreated\r\n          ? { kind: \"ok\" as const, status: \"running\" as const }\r\n          : { kind: \"not_found\" as const }\r\n      )\r\n    );\r\n\r\n    const coderService = createMockCoderService({\r\n      createWorkspace,\r\n      ensureSSHConfig,\r\n      getWorkspaceStatus,\r\n      takeProvisioningSession,\r\n    });\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: false, workspaceName: \"my-ws\", template: \"my-template\" },\r\n      coderService\r\n    );\r\n\r\n    // Before postCreateSetup, ensureReady should fail (workspace doesn't exist on server)\r\n    const beforeReady = await runtime.ensureReady();\r\n    expect(beforeReady.ready).toBe(false);\r\n    if (!beforeReady.ready) {\r\n      expect(beforeReady.errorType).toBe(\"runtime_not_ready\");\r\n    }\r\n\r\n    // Simulate workspace being created by postCreateSetup\r\n    workspaceCreated = true;\r\n\r\n    const steps: string[] = [];\r\n    const stdout: string[] = [];\r\n    const stderr: string[] = [];\r\n    const initLogger = {\r\n      logStep: (s: string) => {\r\n        steps.push(s);\r\n      },\r\n      logStdout: (s: string) => {\r\n        stdout.push(s);\r\n      },\r\n      logStderr: (s: string) => {\r\n        stderr.push(s);\r\n      },\r\n      logComplete: noop,\r\n    };\r\n\r\n    await runtime.postCreateSetup({\r\n      initLogger,\r\n      projectPath: \"/project\",\r\n      branchName: \"branch\",\r\n      trunkBranch: \"main\",\r\n      workspacePath: \"/home/user/src/my-project/my-ws\",\r\n    });\r\n\r\n    expect(takeProvisioningSession).toHaveBeenCalledWith(\"my-ws\");\r\n    expect(createWorkspace).toHaveBeenCalledWith(\r\n      \"my-ws\",\r\n      \"my-template\",\r\n      undefined,\r\n      undefined,\r\n      undefined,\r\n      provisioningSession\r\n    );\r\n    expect(provisioningSession.dispose).toHaveBeenCalled();\r\n    expect(ensureSSHConfig).toHaveBeenCalled();\r\n    expect(execBufferedSpy).toHaveBeenCalled();\r\n\r\n    // After postCreateSetup, ensureReady should succeed (workspace exists on server)\r\n    const afterReady = await runtime.ensureReady();\r\n    expect(afterReady.ready).toBe(true);\r\n\r\n    expect(stdout).toEqual([\"build line 1\", \"build line 2\"]);\r\n    expect(stderr).toEqual([]);\r\n    expect(steps.join(\"\\n\")).toContain(\"Creating Coder workspace\");\r\n    expect(steps.join(\"\\n\")).toContain(\"Configuring SSH\");\r\n    expect(steps.join(\"\\n\")).toContain(\"Preparing workspace directory\");\r\n  });\r\n\r\n  it(\"disposes provisioning session when workspace creation fails\", async () => {\r\n    const createWorkspace = mock(() =>\r\n      (async function* (): AsyncGenerator<string, void, unknown> {\r\n        yield \"Starting workspace...\";\r\n        await Promise.resolve();\r\n        throw new Error(\"boom\");\r\n      })()\r\n    );\r\n    const provisioningSession = {\r\n      token: \"token\",\r\n      dispose: mock(() => Promise.resolve()),\r\n    };\r\n    const takeProvisioningSession = mock(() => provisioningSession);\r\n\r\n    const coderService = createMockCoderService({\r\n      createWorkspace,\r\n      takeProvisioningSession,\r\n    });\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: false, workspaceName: \"my-ws\", template: \"my-template\" },\r\n      coderService\r\n    );\r\n\r\n    let caughtError: Error | undefined;\r\n    try {\r\n      await runtime.postCreateSetup({\r\n        initLogger: {\r\n          logStep: noop,\r\n          logStdout: noop,\r\n          logStderr: noop,\r\n          logComplete: noop,\r\n        },\r\n        projectPath: \"/project\",\r\n        branchName: \"branch\",\r\n        trunkBranch: \"main\",\r\n        workspacePath: \"/home/user/src/my-project/my-ws\",\r\n      });\r\n    } catch (err) {\r\n      caughtError = err as Error;\r\n    }\r\n\r\n    expect(caughtError?.message).toContain(\"Failed to create Coder workspace\");\r\n    expect(takeProvisioningSession).toHaveBeenCalledWith(\"my-ws\");\r\n    expect(createWorkspace).toHaveBeenCalledWith(\r\n      \"my-ws\",\r\n      \"my-template\",\r\n      undefined,\r\n      undefined,\r\n      undefined,\r\n      provisioningSession\r\n    );\r\n    expect(provisioningSession.dispose).toHaveBeenCalled();\r\n  });\r\n\r\n  it(\"skips workspace creation when existingWorkspace=true and workspace is running\", async () => {\r\n    const createWorkspace = mock(() =>\r\n      (async function* (): AsyncGenerator<string, void, unknown> {\r\n        await Promise.resolve();\r\n        yield \"should not happen\";\r\n      })()\r\n    );\r\n    const waitForStartupScripts = mock(() =>\r\n      (async function* (): AsyncGenerator<string, void, unknown> {\r\n        await Promise.resolve();\r\n        yield \"Already running\";\r\n      })()\r\n    );\r\n    const ensureSSHConfig = mock(() => Promise.resolve());\r\n    const getWorkspaceStatus = mock(() =>\r\n      Promise.resolve({ kind: \"ok\" as const, status: \"running\" as const })\r\n    );\r\n\r\n    const coderService = createMockCoderService({\r\n      createWorkspace,\r\n      waitForStartupScripts,\r\n      ensureSSHConfig,\r\n      getWorkspaceStatus,\r\n    });\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: true, workspaceName: \"existing-ws\" },\r\n      coderService\r\n    );\r\n\r\n    await runtime.postCreateSetup({\r\n      initLogger: {\r\n        logStep: noop,\r\n        logStdout: noop,\r\n        logStderr: noop,\r\n        logComplete: noop,\r\n      },\r\n      projectPath: \"/project\",\r\n      branchName: \"branch\",\r\n      trunkBranch: \"main\",\r\n      workspacePath: \"/home/user/src/my-project/existing-ws\",\r\n    });\r\n\r\n    expect(createWorkspace).not.toHaveBeenCalled();\r\n    // waitForStartupScripts is called (it handles running workspaces quickly)\r\n    expect(waitForStartupScripts).toHaveBeenCalled();\r\n    expect(ensureSSHConfig).toHaveBeenCalled();\r\n    expect(execBufferedSpy).toHaveBeenCalled();\r\n  });\r\n\r\n  it(\"uses waitForStartupScripts for existing stopped workspace (auto-starts via coder ssh)\", async () => {\r\n    const createWorkspace = mock(() =>\r\n      (async function* (): AsyncGenerator<string, void, unknown> {\r\n        await Promise.resolve();\r\n        yield \"should not happen\";\r\n      })()\r\n    );\r\n    const waitForStartupScripts = mock(() =>\r\n      (async function* (): AsyncGenerator<string, void, unknown> {\r\n        await Promise.resolve();\r\n        yield \"Starting workspace...\";\r\n        yield \"Build complete\";\r\n        yield \"Startup scripts finished\";\r\n      })()\r\n    );\r\n    const ensureSSHConfig = mock(() => Promise.resolve());\r\n    const getWorkspaceStatus = mock(() =>\r\n      Promise.resolve({ kind: \"ok\" as const, status: \"stopped\" as const })\r\n    );\r\n\r\n    const coderService = createMockCoderService({\r\n      createWorkspace,\r\n      waitForStartupScripts,\r\n      ensureSSHConfig,\r\n      getWorkspaceStatus,\r\n    });\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: true, workspaceName: \"existing-ws\" },\r\n      coderService\r\n    );\r\n\r\n    const loggedStdout: string[] = [];\r\n    await runtime.postCreateSetup({\r\n      initLogger: {\r\n        logStep: noop,\r\n        logStdout: (line) => loggedStdout.push(line),\r\n        logStderr: noop,\r\n        logComplete: noop,\r\n      },\r\n      projectPath: \"/project\",\r\n      branchName: \"branch\",\r\n      trunkBranch: \"main\",\r\n      workspacePath: \"/home/user/src/my-project/existing-ws\",\r\n    });\r\n\r\n    expect(createWorkspace).not.toHaveBeenCalled();\r\n    expect(waitForStartupScripts).toHaveBeenCalled();\r\n    expect(loggedStdout).toContain(\"Starting workspace...\");\r\n    expect(loggedStdout).toContain(\"Startup scripts finished\");\r\n    expect(ensureSSHConfig).toHaveBeenCalled();\r\n  });\r\n\r\n  it(\"polls until stopping workspace becomes stopped before connecting\", async () => {\r\n    let pollCount = 0;\r\n    const getWorkspaceStatus = mock(() => {\r\n      pollCount++;\r\n      // First 2 calls return \"stopping\", then \"stopped\"\r\n      if (pollCount <= 2) {\r\n        return Promise.resolve({ kind: \"ok\" as const, status: \"stopping\" as const });\r\n      }\r\n      return Promise.resolve({ kind: \"ok\" as const, status: \"stopped\" as const });\r\n    });\r\n    const waitForStartupScripts = mock(() =>\r\n      (async function* (): AsyncGenerator<string, void, unknown> {\r\n        await Promise.resolve();\r\n        yield \"Ready\";\r\n      })()\r\n    );\r\n    const ensureSSHConfig = mock(() => Promise.resolve());\r\n\r\n    const coderService = createMockCoderService({\r\n      getWorkspaceStatus,\r\n      waitForStartupScripts,\r\n      ensureSSHConfig,\r\n    });\r\n\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: true, workspaceName: \"stopping-ws\" },\r\n      coderService\r\n    );\r\n\r\n    // Avoid real sleeps in this polling test\r\n    interface RuntimeWithSleep {\r\n      sleep: (ms: number, abortSignal?: AbortSignal) => Promise<void>;\r\n    }\r\n    spyOn(runtime as unknown as RuntimeWithSleep, \"sleep\").mockResolvedValue(undefined);\r\n\r\n    const loggedSteps: string[] = [];\r\n    await runtime.postCreateSetup({\r\n      initLogger: {\r\n        logStep: (step) => loggedSteps.push(step),\r\n        logStdout: noop,\r\n        logStderr: noop,\r\n        logComplete: noop,\r\n      },\r\n      projectPath: \"/project\",\r\n      branchName: \"branch\",\r\n      trunkBranch: \"main\",\r\n      workspacePath: \"/home/user/src/my-project/stopping-ws\",\r\n    });\r\n\r\n    // Should have polled status multiple times\r\n    expect(pollCount).toBeGreaterThan(2);\r\n    expect(loggedSteps.some((s) => s.includes(\"Waiting for Coder workspace\"))).toBe(true);\r\n    expect(waitForStartupScripts).toHaveBeenCalled();\r\n  });\r\n\r\n  it(\"throws when workspaceName is missing\", () => {\r\n    const coderService = createMockCoderService();\r\n    const runtime = createRuntime({ existingWorkspace: false, template: \"tmpl\" }, coderService);\r\n\r\n    return expect(\r\n      runtime.postCreateSetup({\r\n        initLogger: {\r\n          logStep: noop,\r\n          logStdout: noop,\r\n          logStderr: noop,\r\n          logComplete: noop,\r\n        },\r\n        projectPath: \"/project\",\r\n        branchName: \"branch\",\r\n        trunkBranch: \"main\",\r\n        workspacePath: \"/home/user/src/my-project/ws\",\r\n      })\r\n    ).rejects.toThrow(\"Coder workspace name is required\");\r\n  });\r\n\r\n  it(\"throws when template is missing for new workspaces\", () => {\r\n    const coderService = createMockCoderService();\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: false, workspaceName: \"my-ws\", template: undefined },\r\n      coderService\r\n    );\r\n\r\n    return expect(\r\n      runtime.postCreateSetup({\r\n        initLogger: {\r\n          logStep: noop,\r\n          logStdout: noop,\r\n          logStderr: noop,\r\n          logComplete: noop,\r\n        },\r\n        projectPath: \"/project\",\r\n        branchName: \"branch\",\r\n        trunkBranch: \"main\",\r\n        workspacePath: \"/home/user/src/my-project/ws\",\r\n      })\r\n    ).rejects.toThrow(\"Coder template is required\");\r\n  });\r\n});\r\n\r\n// =============================================================================\r\n// Test Suite 5: ensureReady (runtime readiness + status events)\r\n// =============================================================================\r\n\r\ndescribe(\"CoderSSHRuntime.ensureReady\", () => {\r\n  it(\"returns ready when workspace is already running\", async () => {\r\n    const getWorkspaceStatus = mock(() =>\r\n      Promise.resolve({ kind: \"ok\" as const, status: \"running\" as const })\r\n    );\r\n    const waitForStartupScripts = mock(() =>\r\n      (async function* (): AsyncGenerator<string, void, unknown> {\r\n        await Promise.resolve();\r\n        yield \"should not be called\";\r\n      })()\r\n    );\r\n    const coderService = createMockCoderService({ getWorkspaceStatus, waitForStartupScripts });\r\n\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: true, workspaceName: \"my-ws\" },\r\n      coderService\r\n    );\r\n\r\n    const events: RuntimeStatusEvent[] = [];\r\n    const result = await runtime.ensureReady({\r\n      statusSink: (e) => events.push(e),\r\n    });\r\n\r\n    expect(result).toEqual({ ready: true });\r\n    expect(getWorkspaceStatus).toHaveBeenCalled();\r\n    // Short-circuited because status is already \"running\"\r\n    expect(waitForStartupScripts).not.toHaveBeenCalled();\r\n    expect(events.map((e) => e.phase)).toEqual([\"checking\", \"ready\"]);\r\n    expect(events[0]?.runtimeType).toBe(\"ssh\");\r\n  });\r\n\r\n  it(\"connects via waitForStartupScripts when status is stopped (auto-starts)\", async () => {\r\n    const getWorkspaceStatus = mock(() =>\r\n      Promise.resolve({ kind: \"ok\" as const, status: \"stopped\" as const })\r\n    );\r\n    const waitForStartupScripts = mock(() =>\r\n      (async function* (): AsyncGenerator<string, void, unknown> {\r\n        await Promise.resolve();\r\n        yield \"Starting workspace...\";\r\n        yield \"Workspace started\";\r\n      })()\r\n    );\r\n    const coderService = createMockCoderService({ getWorkspaceStatus, waitForStartupScripts });\r\n\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: true, workspaceName: \"my-ws\" },\r\n      coderService\r\n    );\r\n\r\n    const events: RuntimeStatusEvent[] = [];\r\n    const result = await runtime.ensureReady({\r\n      statusSink: (e) => events.push(e),\r\n    });\r\n\r\n    expect(result).toEqual({ ready: true });\r\n    expect(waitForStartupScripts).toHaveBeenCalled();\r\n    // We should see checking, then starting, then ready\r\n    expect(events[0]?.phase).toBe(\"checking\");\r\n    expect(events.some((e) => e.phase === \"starting\")).toBe(true);\r\n    expect(events.at(-1)?.phase).toBe(\"ready\");\r\n  });\r\n\r\n  it(\"returns runtime_start_failed when waitForStartupScripts fails\", async () => {\r\n    const getWorkspaceStatus = mock(() =>\r\n      Promise.resolve({ kind: \"ok\" as const, status: \"stopped\" as const })\r\n    );\r\n    const waitForStartupScripts = mock(() =>\r\n      (async function* (): AsyncGenerator<string, void, unknown> {\r\n        await Promise.resolve();\r\n        yield \"Starting workspace...\";\r\n        throw new Error(\"connection failed\");\r\n      })()\r\n    );\r\n    const coderService = createMockCoderService({ getWorkspaceStatus, waitForStartupScripts });\r\n\r\n    const runtime = createRuntime(\r\n      { existingWorkspace: true, workspaceName: \"my-ws\" },\r\n      coderService\r\n    );\r\n\r\n    const events: RuntimeStatusEvent[] = [];\r\n    const result = await runtime.ensureReady({\r\n      statusSink: (e) => events.push(e),\r\n    });\r\n\r\n    expect(result.ready).toBe(false);\r\n    if (!result.ready) {\r\n      expect(result.errorType).toBe(\"runtime_start_failed\");\r\n      expect(result.error).toContain(\"Failed to connect\");\r\n    }\r\n\r\n    expect(events.at(-1)?.phase).toBe(\"error\");\r\n  });\r\n});\r\n"]}