{"version":3,"file":"tracking.js","sourceRoot":"","sources":["../../../src/common/telemetry/tracking.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Telemetry tracking functions\n *\n * These functions provide a clean API for tracking telemetry events.\n * Callers pass raw values; rounding and formatting happen internally.\n * This ensures consistent privacy-preserving transformations.\n */\n\nimport { trackEvent } from \"./client\";\nimport { roundToBase2 } from \"./utils\";\nimport type {\n  TelemetryRuntimeType,\n  TelemetryThinkingLevel,\n  TelemetryCommandType,\n  FrontendPlatformInfo,\n} from \"./payload\";\n\n/**\n * Get frontend platform information for telemetry.\n * Uses browser APIs (navigator) which are safe to send and widely shared.\n */\nfunction getFrontendPlatform(): FrontendPlatformInfo {\n  if (typeof navigator === \"undefined\") {\n    return { userAgent: \"unknown\", platform: \"unknown\" };\n  }\n  return {\n    userAgent: navigator.userAgent,\n    platform: navigator.platform,\n  };\n}\n\n// =============================================================================\n// Tracking Functions\n// =============================================================================\n\n/**\n * Track workspace creation\n */\nexport function trackWorkspaceCreated(\n  workspaceId: string,\n  runtimeType: TelemetryRuntimeType\n): void {\n  trackEvent({\n    event: \"workspace_created\",\n    properties: {\n      workspaceId,\n      runtimeType,\n      frontendPlatform: getFrontendPlatform(),\n    },\n  });\n}\n\n/**\n * Track workspace switch\n */\nexport function trackWorkspaceSwitched(fromWorkspaceId: string, toWorkspaceId: string): void {\n  trackEvent({\n    event: \"workspace_switched\",\n    properties: { fromWorkspaceId, toWorkspaceId },\n  });\n}\n\n/**\n * Track message sent\n * @param messageLength - Raw character count (will be rounded to base-2)\n */\nexport function trackMessageSent(\n  workspaceId: string,\n  model: string,\n  agentId: string,\n  messageLength: number,\n  runtimeType: TelemetryRuntimeType,\n  thinkingLevel: TelemetryThinkingLevel\n): void {\n  trackEvent({\n    event: \"message_sent\",\n    properties: {\n      workspaceId,\n      model,\n      agentId,\n      message_length_b2: roundToBase2(messageLength),\n      runtimeType,\n      frontendPlatform: getFrontendPlatform(),\n      thinkingLevel,\n    },\n  });\n}\n\n/**\n * Track stats tab opening.\n */\nexport function trackStatsTabOpened(\n  viewMode: \"session\" | \"last-request\",\n  showModeBreakdown: boolean\n): void {\n  trackEvent({\n    event: \"stats_tab_opened\",\n    properties: { viewMode, showModeBreakdown },\n  });\n}\n\n/**\n * Track stream completion\n * @param durationSecs - Raw duration in seconds (will be rounded to base-2)\n * @param outputTokens - Raw token count (will be rounded to base-2)\n */\nexport function trackStreamCompleted(\n  model: string,\n  wasInterrupted: boolean,\n  durationSecs: number,\n  outputTokens: number\n): void {\n  trackEvent({\n    event: \"stream_completed\",\n    properties: {\n      model,\n      wasInterrupted,\n      duration_b2: roundToBase2(durationSecs),\n      output_tokens_b2: roundToBase2(outputTokens),\n    },\n  });\n}\n\n/**\n * Track provider configuration (not the key value, just that it was configured)\n */\nexport function trackProviderConfigured(provider: string, keyType: string): void {\n  trackEvent({\n    event: \"provider_configured\",\n    properties: { provider, keyType },\n  });\n}\n\n/**\n * Track slash command usage\n */\nexport function trackCommandUsed(command: TelemetryCommandType): void {\n  trackEvent({\n    event: \"command_used\",\n    properties: { command },\n  });\n}\n\n/**\n * Track voice transcription\n * @param audioDurationSecs - Raw duration in seconds (will be rounded to base-2)\n */\nexport function trackVoiceTranscription(audioDurationSecs: number, success: boolean): void {\n  trackEvent({\n    event: \"voice_transcription\",\n    properties: {\n      audio_duration_b2: roundToBase2(audioDurationSecs),\n      success,\n    },\n  });\n}\n\n/**\n * Track error occurrence\n */\nexport function trackErrorOccurred(\n  errorType: string,\n  context:\n    | \"workspace-creation\"\n    | \"workspace-deletion\"\n    | \"workspace-switch\"\n    | \"message-send\"\n    | \"message-stream\"\n    | \"project-add\"\n    | \"project-remove\"\n    | \"git-operation\"\n): void {\n  trackEvent({\n    event: \"error_occurred\",\n    properties: { errorType, context },\n  });\n}\n\n/**\n * Track experiment override - when a user manually toggles an experiment\n * @param experimentId - The experiment identifier\n * @param assignedVariant - What PostHog assigned (null if not remote-controlled)\n * @param userChoice - What the user chose (true = enabled, false = disabled)\n */\nexport function trackExperimentOverridden(\n  experimentId: string,\n  assignedVariant: string | boolean | null,\n  userChoice: boolean\n): void {\n  trackEvent({\n    event: \"experiment_overridden\",\n    properties: { experimentId, assignedVariant, userChoice },\n  });\n}\n"]}