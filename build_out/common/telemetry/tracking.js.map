{"version":3,"file":"tracking.js","sourceRoot":"","sources":["../../../src/common/telemetry/tracking.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Telemetry tracking functions\r\n *\r\n * These functions provide a clean API for tracking telemetry events.\r\n * Callers pass raw values; rounding and formatting happen internally.\r\n * This ensures consistent privacy-preserving transformations.\r\n */\r\n\r\nimport { trackEvent } from \"./client\";\r\nimport { roundToBase2 } from \"./utils\";\r\nimport type {\r\n  TelemetryRuntimeType,\r\n  TelemetryThinkingLevel,\r\n  TelemetryCommandType,\r\n  FrontendPlatformInfo,\r\n} from \"./payload\";\r\n\r\n/**\r\n * Get frontend platform information for telemetry.\r\n * Uses browser APIs (navigator) which are safe to send and widely shared.\r\n */\r\nfunction getFrontendPlatform(): FrontendPlatformInfo {\r\n  if (typeof navigator === \"undefined\") {\r\n    return { userAgent: \"unknown\", platform: \"unknown\" };\r\n  }\r\n  return {\r\n    userAgent: navigator.userAgent,\r\n    platform: navigator.platform,\r\n  };\r\n}\r\n\r\n// =============================================================================\r\n// Tracking Functions\r\n// =============================================================================\r\n\r\n/**\r\n * Track workspace creation\r\n */\r\nexport function trackWorkspaceCreated(\r\n  workspaceId: string,\r\n  runtimeType: TelemetryRuntimeType\r\n): void {\r\n  trackEvent({\r\n    event: \"workspace_created\",\r\n    properties: {\r\n      workspaceId,\r\n      runtimeType,\r\n      frontendPlatform: getFrontendPlatform(),\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Track workspace switch\r\n */\r\nexport function trackWorkspaceSwitched(fromWorkspaceId: string, toWorkspaceId: string): void {\r\n  trackEvent({\r\n    event: \"workspace_switched\",\r\n    properties: { fromWorkspaceId, toWorkspaceId },\r\n  });\r\n}\r\n\r\n/**\r\n * Track message sent\r\n * @param messageLength - Raw character count (will be rounded to base-2)\r\n */\r\nexport function trackMessageSent(\r\n  workspaceId: string,\r\n  model: string,\r\n  agentId: string,\r\n  messageLength: number,\r\n  runtimeType: TelemetryRuntimeType,\r\n  thinkingLevel: TelemetryThinkingLevel\r\n): void {\r\n  trackEvent({\r\n    event: \"message_sent\",\r\n    properties: {\r\n      workspaceId,\r\n      model,\r\n      agentId,\r\n      message_length_b2: roundToBase2(messageLength),\r\n      runtimeType,\r\n      frontendPlatform: getFrontendPlatform(),\r\n      thinkingLevel,\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Track stats tab opening.\r\n */\r\nexport function trackStatsTabOpened(\r\n  viewMode: \"session\" | \"last-request\",\r\n  showModeBreakdown: boolean\r\n): void {\r\n  trackEvent({\r\n    event: \"stats_tab_opened\",\r\n    properties: { viewMode, showModeBreakdown },\r\n  });\r\n}\r\n\r\n/**\r\n * Track stream completion\r\n * @param durationSecs - Raw duration in seconds (will be rounded to base-2)\r\n * @param outputTokens - Raw token count (will be rounded to base-2)\r\n */\r\nexport function trackStreamCompleted(\r\n  model: string,\r\n  wasInterrupted: boolean,\r\n  durationSecs: number,\r\n  outputTokens: number\r\n): void {\r\n  trackEvent({\r\n    event: \"stream_completed\",\r\n    properties: {\r\n      model,\r\n      wasInterrupted,\r\n      duration_b2: roundToBase2(durationSecs),\r\n      output_tokens_b2: roundToBase2(outputTokens),\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Track provider configuration (not the key value, just that it was configured)\r\n */\r\nexport function trackProviderConfigured(provider: string, keyType: string): void {\r\n  trackEvent({\r\n    event: \"provider_configured\",\r\n    properties: { provider, keyType },\r\n  });\r\n}\r\n\r\n/**\r\n * Track slash command usage\r\n */\r\nexport function trackCommandUsed(command: TelemetryCommandType): void {\r\n  trackEvent({\r\n    event: \"command_used\",\r\n    properties: { command },\r\n  });\r\n}\r\n\r\n/**\r\n * Track voice transcription\r\n * @param audioDurationSecs - Raw duration in seconds (will be rounded to base-2)\r\n */\r\nexport function trackVoiceTranscription(audioDurationSecs: number, success: boolean): void {\r\n  trackEvent({\r\n    event: \"voice_transcription\",\r\n    properties: {\r\n      audio_duration_b2: roundToBase2(audioDurationSecs),\r\n      success,\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Track error occurrence\r\n */\r\nexport function trackErrorOccurred(\r\n  errorType: string,\r\n  context:\r\n    | \"workspace-creation\"\r\n    | \"workspace-deletion\"\r\n    | \"workspace-switch\"\r\n    | \"message-send\"\r\n    | \"message-stream\"\r\n    | \"project-add\"\r\n    | \"project-remove\"\r\n    | \"git-operation\"\r\n): void {\r\n  trackEvent({\r\n    event: \"error_occurred\",\r\n    properties: { errorType, context },\r\n  });\r\n}\r\n\r\n/**\r\n * Track experiment override - when a user manually toggles an experiment\r\n * @param experimentId - The experiment identifier\r\n * @param assignedVariant - What PostHog assigned (null if not remote-controlled)\r\n * @param userChoice - What the user chose (true = enabled, false = disabled)\r\n */\r\nexport function trackExperimentOverridden(\r\n  experimentId: string,\r\n  assignedVariant: string | boolean | null,\r\n  userChoice: boolean\r\n): void {\r\n  trackEvent({\r\n    event: \"experiment_overridden\",\r\n    properties: { experimentId, assignedVariant, userChoice },\r\n  });\r\n}\r\n"]}