{"version":3,"file":"client.js","sourceRoot":"","sources":["../../../src/common/telemetry/client.ts"],"names":[],"mappings":";AAAA;;;;;;;;;GASG;;;;;AAIH;;;;GAIG;AACH,SAAS,eAAe,GAAY;IAClC,IAAI,OAAO,OAAO,KAAK,WAAW,EAAE,CAAC;QACnC,OAAO,KAAK,CAAC;IACf,CAAC;IACD,OAAO,CACL,OAAO,CAAC,GAAG,CAAC,EAAE,KAAK,MAAM;QACzB,OAAO,CAAC,GAAG,CAAC,EAAE,KAAK,GAAG;QACtB,OAAO,CAAC,GAAG,CAAC,cAAc,KAAK,MAAM;QACrC,OAAO,CAAC,GAAG,CAAC,SAAS,KAAK,MAAM;QAChC,OAAO,CAAC,GAAG,CAAC,WAAW,KAAK,SAAS;QACrC,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,MAAM,CAChC,CAAC;AAAA,CACH;AAED;;GAEG;AACH,SAAS,iBAAiB,GAAY;IACpC,OAAO,CACL,CAAC,OAAO,OAAO,KAAK,WAAW;QAC7B,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,MAAM;YAC9B,OAAO,CAAC,GAAG,CAAC,cAAc,KAAK,SAAS;YACxC,OAAO,CAAC,GAAG,CAAC,MAAM,KAAK,SAAS;YAChC,OAAO,CAAC,GAAG,CAAC,gBAAgB,KAAK,GAAG,CAAC,CAAC;QAC1C,eAAe,EAAE,CAClB,CAAC;AAAA,CACH;AAED;;;;;GAKG;AACH,SAAS,oBAAoB,GAAY;IACvC,IAAI,OAAO,QAAQ,KAAK,WAAW,EAAE,CAAC;QACpC,OAAO,KAAK,CAAC;IACf,CAAC;IAED,6CAA6C;IAC7C,OAAO,QAAQ,CAAC,aAAa,CAAC,8BAA8B,CAAC,KAAK,IAAI,CAAC;AAAA,CACxE;AAED;;GAEG;AACH,yBAAsC;IACpC,yCAAyC;AADJ,CAEtC;AAED;;;;;GAKG;AACH,oBAA2B,OAA8B,EAAQ;IAC/D,0EAA0E;IAC1E,kCAAkC;IAClC,EAAE;IACF,6EAA6E;IAC7E,+EAA+E;IAC/E,0BAA0B;IAC1B,IACE,OAAO,MAAM,KAAK,WAAW;QAC7B,iBAAiB,EAAE;QACnB,MAAM,CAAC,GAAG,EAAE,KAAK,KAAK,IAAI;QAC1B,CAAC,oBAAoB,EAAE,IAAI,MAAM,CAAC,GAAG,EAAE,oBAAoB,KAAK,IAAI,CAAC,EACrE,CAAC;QACD,OAAO;IACT,CAAC;IAED,MAAM,MAAM,GAAG,MAAM,CAAC,eAAe,CAAC;IACtC,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;QAC9B,OAAO;IACT,CAAC;IAED,6CAA6C;IAC7C,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;QAC1C,yBAAyB;IADkB,CAE5C,CAAC,CAAC;AAAA,CACJ;AAED;;GAEG;AACH,6BAA0C;IACxC,mCAAmC;AADM,CAE1C","sourcesContent":["/**\r\n * PostHog Telemetry Client (Frontend)\r\n *\r\n * Forwards telemetry events to the backend via ORPC.\r\n * The backend decides whether to actually send events to PostHog\r\n * (controlled by MUX_DISABLE_TELEMETRY environment variable).\r\n *\r\n * This design avoids ad-blocker issues and centralizes control.\r\n * All payloads are defined in ./payload.ts for transparency.\r\n */\r\n\r\nimport type { TelemetryEventPayload } from \"./payload\";\r\n\r\n/**\r\n * Check if running in a CI/automation environment.\r\n * Covers major CI providers. This is a subset of what the backend checks\r\n * since the browser process has limited env var access.\r\n */\r\nfunction isCIEnvironment(): boolean {\r\n  if (typeof process === \"undefined\") {\r\n    return false;\r\n  }\r\n  return (\r\n    process.env.CI === \"true\" ||\r\n    process.env.CI === \"1\" ||\r\n    process.env.GITHUB_ACTIONS === \"true\" ||\r\n    process.env.GITLAB_CI === \"true\" ||\r\n    process.env.JENKINS_URL !== undefined ||\r\n    process.env.CIRCLECI === \"true\"\r\n  );\r\n}\r\n\r\n/**\r\n * Check if we're running in a test or CI environment\r\n */\r\nfunction isTestEnvironment(): boolean {\r\n  return (\r\n    (typeof process !== \"undefined\" &&\r\n      (process.env.NODE_ENV === \"test\" ||\r\n        process.env.JEST_WORKER_ID !== undefined ||\r\n        process.env.VITEST !== undefined ||\r\n        process.env.TEST_INTEGRATION === \"1\")) ||\r\n    isCIEnvironment()\r\n  );\r\n}\r\n\r\n/**\r\n * Check if we're running under the Vite dev server.\r\n *\r\n * We avoid import.meta.env here because this module is shared across the\r\n * renderer and the main-process builds (tsconfig.main uses module=CommonJS).\r\n */\r\nfunction isViteDevEnvironment(): boolean {\r\n  if (typeof document === \"undefined\") {\r\n    return false;\r\n  }\r\n\r\n  // Vite injects /@vite/client in dev for HMR.\r\n  return document.querySelector('script[src^=\"/@vite/client\"]') !== null;\r\n}\r\n\r\n/**\r\n * Initialize telemetry (no-op, kept for API compatibility)\r\n */\r\nexport function initTelemetry(): void {\r\n  // No-op - backend handles initialization\r\n}\r\n\r\n/**\r\n * Send a telemetry event via the backend\r\n * Events are type-safe and must match definitions in payload.ts\r\n *\r\n * The backend decides whether to actually send to PostHog.\r\n */\r\nexport function trackEvent(payload: TelemetryEventPayload): void {\r\n  // Telemetry is a no-op in tests/CI/E2E, and also in SSR-ish test contexts\r\n  // where `window` isn't available.\r\n  //\r\n  // Under the Vite dev server we also require explicit opt-in from the preload\r\n  // script (window.api.enableTelemetryInDev) to avoid accidentally emitting data\r\n  // from local development.\r\n  if (\r\n    typeof window === \"undefined\" ||\r\n    isTestEnvironment() ||\r\n    window.api?.isE2E === true ||\r\n    (isViteDevEnvironment() && window.api?.enableTelemetryInDev !== true)\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  const client = window.__ORPC_CLIENT__;\r\n  if (!client?.telemetry?.track) {\r\n    return;\r\n  }\r\n\r\n  // Fire and forget - don't block on telemetry\r\n  client.telemetry.track(payload).catch(() => {\r\n    // Silently ignore errors\r\n  });\r\n}\r\n\r\n/**\r\n * Shutdown telemetry (no-op, kept for API compatibility)\r\n */\r\nexport function shutdownTelemetry(): void {\r\n  // No-op - backend handles shutdown\r\n}\r\n"]}