{"version":3,"file":"client.js","sourceRoot":"","sources":["../../../src/common/telemetry/client.ts"],"names":[],"mappings":";AAAA;;;;;;;;;GASG;;;;;AAIH;;;;GAIG;AACH,SAAS,eAAe,GAAY;IAClC,IAAI,OAAO,OAAO,KAAK,WAAW,EAAE,CAAC;QACnC,OAAO,KAAK,CAAC;IACf,CAAC;IACD,OAAO,CACL,OAAO,CAAC,GAAG,CAAC,EAAE,KAAK,MAAM;QACzB,OAAO,CAAC,GAAG,CAAC,EAAE,KAAK,GAAG;QACtB,OAAO,CAAC,GAAG,CAAC,cAAc,KAAK,MAAM;QACrC,OAAO,CAAC,GAAG,CAAC,SAAS,KAAK,MAAM;QAChC,OAAO,CAAC,GAAG,CAAC,WAAW,KAAK,SAAS;QACrC,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,MAAM,CAChC,CAAC;AAAA,CACH;AAED;;GAEG;AACH,SAAS,iBAAiB,GAAY;IACpC,OAAO,CACL,CAAC,OAAO,OAAO,KAAK,WAAW;QAC7B,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,MAAM;YAC9B,OAAO,CAAC,GAAG,CAAC,cAAc,KAAK,SAAS;YACxC,OAAO,CAAC,GAAG,CAAC,MAAM,KAAK,SAAS;YAChC,OAAO,CAAC,GAAG,CAAC,gBAAgB,KAAK,GAAG,CAAC,CAAC;QAC1C,eAAe,EAAE,CAClB,CAAC;AAAA,CACH;AAED;;;;;GAKG;AACH,SAAS,oBAAoB,GAAY;IACvC,IAAI,OAAO,QAAQ,KAAK,WAAW,EAAE,CAAC;QACpC,OAAO,KAAK,CAAC;IACf,CAAC;IAED,6CAA6C;IAC7C,OAAO,QAAQ,CAAC,aAAa,CAAC,8BAA8B,CAAC,KAAK,IAAI,CAAC;AAAA,CACxE;AAED;;GAEG;AACH,yBAAsC;IACpC,yCAAyC;AADJ,CAEtC;AAED;;;;;GAKG;AACH,oBAA2B,OAA8B,EAAQ;IAC/D,0EAA0E;IAC1E,kCAAkC;IAClC,EAAE;IACF,6EAA6E;IAC7E,+EAA+E;IAC/E,0BAA0B;IAC1B,IACE,OAAO,MAAM,KAAK,WAAW;QAC7B,iBAAiB,EAAE;QACnB,MAAM,CAAC,GAAG,EAAE,KAAK,KAAK,IAAI;QAC1B,CAAC,oBAAoB,EAAE,IAAI,MAAM,CAAC,GAAG,EAAE,oBAAoB,KAAK,IAAI,CAAC,EACrE,CAAC;QACD,OAAO;IACT,CAAC;IAED,MAAM,MAAM,GAAG,MAAM,CAAC,eAAe,CAAC;IACtC,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;QAC9B,OAAO;IACT,CAAC;IAED,6CAA6C;IAC7C,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;QAC1C,yBAAyB;IADkB,CAE5C,CAAC,CAAC;AAAA,CACJ;AAED;;GAEG;AACH,6BAA0C;IACxC,mCAAmC;AADM,CAE1C","sourcesContent":["/**\n * PostHog Telemetry Client (Frontend)\n *\n * Forwards telemetry events to the backend via ORPC.\n * The backend decides whether to actually send events to PostHog\n * (controlled by MUX_DISABLE_TELEMETRY environment variable).\n *\n * This design avoids ad-blocker issues and centralizes control.\n * All payloads are defined in ./payload.ts for transparency.\n */\n\nimport type { TelemetryEventPayload } from \"./payload\";\n\n/**\n * Check if running in a CI/automation environment.\n * Covers major CI providers. This is a subset of what the backend checks\n * since the browser process has limited env var access.\n */\nfunction isCIEnvironment(): boolean {\n  if (typeof process === \"undefined\") {\n    return false;\n  }\n  return (\n    process.env.CI === \"true\" ||\n    process.env.CI === \"1\" ||\n    process.env.GITHUB_ACTIONS === \"true\" ||\n    process.env.GITLAB_CI === \"true\" ||\n    process.env.JENKINS_URL !== undefined ||\n    process.env.CIRCLECI === \"true\"\n  );\n}\n\n/**\n * Check if we're running in a test or CI environment\n */\nfunction isTestEnvironment(): boolean {\n  return (\n    (typeof process !== \"undefined\" &&\n      (process.env.NODE_ENV === \"test\" ||\n        process.env.JEST_WORKER_ID !== undefined ||\n        process.env.VITEST !== undefined ||\n        process.env.TEST_INTEGRATION === \"1\")) ||\n    isCIEnvironment()\n  );\n}\n\n/**\n * Check if we're running under the Vite dev server.\n *\n * We avoid import.meta.env here because this module is shared across the\n * renderer and the main-process builds (tsconfig.main uses module=CommonJS).\n */\nfunction isViteDevEnvironment(): boolean {\n  if (typeof document === \"undefined\") {\n    return false;\n  }\n\n  // Vite injects /@vite/client in dev for HMR.\n  return document.querySelector('script[src^=\"/@vite/client\"]') !== null;\n}\n\n/**\n * Initialize telemetry (no-op, kept for API compatibility)\n */\nexport function initTelemetry(): void {\n  // No-op - backend handles initialization\n}\n\n/**\n * Send a telemetry event via the backend\n * Events are type-safe and must match definitions in payload.ts\n *\n * The backend decides whether to actually send to PostHog.\n */\nexport function trackEvent(payload: TelemetryEventPayload): void {\n  // Telemetry is a no-op in tests/CI/E2E, and also in SSR-ish test contexts\n  // where `window` isn't available.\n  //\n  // Under the Vite dev server we also require explicit opt-in from the preload\n  // script (window.api.enableTelemetryInDev) to avoid accidentally emitting data\n  // from local development.\n  if (\n    typeof window === \"undefined\" ||\n    isTestEnvironment() ||\n    window.api?.isE2E === true ||\n    (isViteDevEnvironment() && window.api?.enableTelemetryInDev !== true)\n  ) {\n    return;\n  }\n\n  const client = window.__ORPC_CLIENT__;\n  if (!client?.telemetry?.track) {\n    return;\n  }\n\n  // Fire and forget - don't block on telemetry\n  client.telemetry.track(payload).catch(() => {\n    // Silently ignore errors\n  });\n}\n\n/**\n * Shutdown telemetry (no-op, kept for API compatibility)\n */\nexport function shutdownTelemetry(): void {\n  // No-op - backend handles shutdown\n}\n"]}