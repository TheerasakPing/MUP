{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../src/common/telemetry/utils.ts"],"names":[],"mappings":";AAAA;;GAEG;;;;;AAKH;;;;;GAKG;AACH,sBAA6B,KAAa,EAAU;IAClD,IAAI,KAAK,IAAI,CAAC;QAAE,OAAO,CAAC,CAAC;IACzB,2BAA2B;IAC3B,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AAAA,CACjD;AAED;;;GAGG;AACH,mCAAgE;IAC9D,0DAA0D;IAC1D,IAAI,OAAO,SAAS,KAAK,WAAW,EAAE,CAAC;QACrC,OAAO;YACL,SAAS,EAAE,SAAS;YACpB,QAAQ,EAAE,SAAS;SACpB,CAAC;IACJ,CAAC;IAED,OAAO;QACL,SAAS,EAAE,SAAS,CAAC,SAAS;QAC9B,QAAQ,EAAE,SAAS,CAAC,QAAQ;KAC7B,CAAC;AAAA,CACH;AAED;;;GAGG;AACH,oCACE,aAAwC,EAClB;IACtB,IAAI,CAAC,aAAa,EAAE,CAAC;QACnB,2BAA2B;QAC3B,OAAO,UAAU,CAAC;IACpB,CAAC;IAED,QAAQ,aAAa,CAAC,IAAI,EAAE,CAAC;QAC3B,KAAK,KAAK;YACR,OAAO,KAAK,CAAC;QACf,KAAK,QAAQ;YACX,OAAO,QAAQ,CAAC;QAClB,KAAK,cAAc;YACjB,OAAO,cAAc,CAAC;QACxB,KAAK,UAAU;YACb,OAAO,UAAU,CAAC;QACpB,KAAK,OAAO;YACV,+CAA+C;YAC/C,IAAI,YAAY,IAAI,aAAa,IAAI,aAAa,CAAC,UAAU,EAAE,CAAC;gBAC9D,OAAO,UAAU,CAAC,CAAC,yBAAyB;YAC9C,CAAC;YACD,OAAO,OAAO,CAAC,CAAC,yBAAyB;IAC7C,CAAC;AAAA,CACF","sourcesContent":["/**\n * Telemetry utility functions\n */\n\nimport type { RuntimeConfig } from \"@/common/types/runtime\";\nimport type { FrontendPlatformInfo, TelemetryRuntimeType } from \"./payload\";\n\n/**\n * Round a number to the nearest power of 2 for privacy-preserving metrics\n * E.g., 350 -> 512, 1200 -> 2048\n *\n * This allows numerical analysis while preventing exact values from leaking information\n */\nexport function roundToBase2(value: number): number {\n  if (value <= 0) return 0;\n  // Find the next power of 2\n  return Math.pow(2, Math.ceil(Math.log2(value)));\n}\n\n/**\n * Get frontend platform information for telemetry.\n * Uses browser APIs (navigator) which are safe to send and widely shared.\n */\nexport function getFrontendPlatformInfo(): FrontendPlatformInfo {\n  // Safe defaults for non-browser environments (SSR, tests)\n  if (typeof navigator === \"undefined\") {\n    return {\n      userAgent: \"unknown\",\n      platform: \"unknown\",\n    };\n  }\n\n  return {\n    userAgent: navigator.userAgent,\n    platform: navigator.platform,\n  };\n}\n\n/**\n * Convert RuntimeConfig to telemetry-friendly runtime type.\n * Handles legacy \"local with srcBaseDir\" as worktree.\n */\nexport function getRuntimeTypeForTelemetry(\n  runtimeConfig: RuntimeConfig | undefined\n): TelemetryRuntimeType {\n  if (!runtimeConfig) {\n    // Default is worktree mode\n    return \"worktree\";\n  }\n\n  switch (runtimeConfig.type) {\n    case \"ssh\":\n      return \"ssh\";\n    case \"docker\":\n      return \"docker\";\n    case \"devcontainer\":\n      return \"devcontainer\";\n    case \"worktree\":\n      return \"worktree\";\n    case \"local\":\n      // Check if it has srcBaseDir (legacy worktree)\n      if (\"srcBaseDir\" in runtimeConfig && runtimeConfig.srcBaseDir) {\n        return \"worktree\"; // Legacy worktree config\n      }\n      return \"local\"; // True project-dir local\n  }\n}\n"]}