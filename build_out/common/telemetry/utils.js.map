{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../src/common/telemetry/utils.ts"],"names":[],"mappings":";AAAA;;GAEG;;;;;AAKH;;;;;GAKG;AACH,sBAA6B,KAAa,EAAU;IAClD,IAAI,KAAK,IAAI,CAAC;QAAE,OAAO,CAAC,CAAC;IACzB,2BAA2B;IAC3B,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AAAA,CACjD;AAED;;;GAGG;AACH,mCAAgE;IAC9D,0DAA0D;IAC1D,IAAI,OAAO,SAAS,KAAK,WAAW,EAAE,CAAC;QACrC,OAAO;YACL,SAAS,EAAE,SAAS;YACpB,QAAQ,EAAE,SAAS;SACpB,CAAC;IACJ,CAAC;IAED,OAAO;QACL,SAAS,EAAE,SAAS,CAAC,SAAS;QAC9B,QAAQ,EAAE,SAAS,CAAC,QAAQ;KAC7B,CAAC;AAAA,CACH;AAED;;;GAGG;AACH,oCACE,aAAwC,EAClB;IACtB,IAAI,CAAC,aAAa,EAAE,CAAC;QACnB,2BAA2B;QAC3B,OAAO,UAAU,CAAC;IACpB,CAAC;IAED,QAAQ,aAAa,CAAC,IAAI,EAAE,CAAC;QAC3B,KAAK,KAAK;YACR,OAAO,KAAK,CAAC;QACf,KAAK,QAAQ;YACX,OAAO,QAAQ,CAAC;QAClB,KAAK,cAAc;YACjB,OAAO,cAAc,CAAC;QACxB,KAAK,UAAU;YACb,OAAO,UAAU,CAAC;QACpB,KAAK,OAAO;YACV,+CAA+C;YAC/C,IAAI,YAAY,IAAI,aAAa,IAAI,aAAa,CAAC,UAAU,EAAE,CAAC;gBAC9D,OAAO,UAAU,CAAC,CAAC,yBAAyB;YAC9C,CAAC;YACD,OAAO,OAAO,CAAC,CAAC,yBAAyB;IAC7C,CAAC;AAAA,CACF","sourcesContent":["/**\r\n * Telemetry utility functions\r\n */\r\n\r\nimport type { RuntimeConfig } from \"@/common/types/runtime\";\r\nimport type { FrontendPlatformInfo, TelemetryRuntimeType } from \"./payload\";\r\n\r\n/**\r\n * Round a number to the nearest power of 2 for privacy-preserving metrics\r\n * E.g., 350 -> 512, 1200 -> 2048\r\n *\r\n * This allows numerical analysis while preventing exact values from leaking information\r\n */\r\nexport function roundToBase2(value: number): number {\r\n  if (value <= 0) return 0;\r\n  // Find the next power of 2\r\n  return Math.pow(2, Math.ceil(Math.log2(value)));\r\n}\r\n\r\n/**\r\n * Get frontend platform information for telemetry.\r\n * Uses browser APIs (navigator) which are safe to send and widely shared.\r\n */\r\nexport function getFrontendPlatformInfo(): FrontendPlatformInfo {\r\n  // Safe defaults for non-browser environments (SSR, tests)\r\n  if (typeof navigator === \"undefined\") {\r\n    return {\r\n      userAgent: \"unknown\",\r\n      platform: \"unknown\",\r\n    };\r\n  }\r\n\r\n  return {\r\n    userAgent: navigator.userAgent,\r\n    platform: navigator.platform,\r\n  };\r\n}\r\n\r\n/**\r\n * Convert RuntimeConfig to telemetry-friendly runtime type.\r\n * Handles legacy \"local with srcBaseDir\" as worktree.\r\n */\r\nexport function getRuntimeTypeForTelemetry(\r\n  runtimeConfig: RuntimeConfig | undefined\r\n): TelemetryRuntimeType {\r\n  if (!runtimeConfig) {\r\n    // Default is worktree mode\r\n    return \"worktree\";\r\n  }\r\n\r\n  switch (runtimeConfig.type) {\r\n    case \"ssh\":\r\n      return \"ssh\";\r\n    case \"docker\":\r\n      return \"docker\";\r\n    case \"devcontainer\":\r\n      return \"devcontainer\";\r\n    case \"worktree\":\r\n      return \"worktree\";\r\n    case \"local\":\r\n      // Check if it has srcBaseDir (legacy worktree)\r\n      if (\"srcBaseDir\" in runtimeConfig && runtimeConfig.srcBaseDir) {\r\n        return \"worktree\"; // Legacy worktree config\r\n      }\r\n      return \"local\"; // True project-dir local\r\n  }\r\n}\r\n"]}