{"version":3,"file":"hashKey.js","sourceRoot":"","sources":["../../../src/common/lib/hashKey.ts"],"names":[],"mappings":";;;;;;AAAA,8DAAiC;AAEjC,IAAI,QAAQ,GAA8C,IAAI,CAAC;AAE/D;;;;GAIG;AACI,KAAK,kBAAkB,KAAa,EAAmB;IAC5D,uEAAuE;IACvE,IAAI,MAAM,CAAC,MAAM,EAAE,CAAC;QAClB,MAAM,IAAI,GAAG,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QACzD,sCAAsC;QACtC,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;aAChD,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;aAC3C,IAAI,CAAC,EAAE,CAAC,CAAC;IACd,CAAC;IACD,4CAA4C;IAC5C,QAAQ,KAAR,QAAQ,GAAK,MAAM,IAAA,qBAAM,GAAE,EAAC;IAC5B,OAAO,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;AAAA,CACzC","sourcesContent":["import xxhash from \"xxhash-wasm\";\n\nlet xxhasher: Awaited<ReturnType<typeof xxhash>> | null = null;\n\n/**\n * Generate a 64-bit hash key for caching/deduplication.\n * Prefers SHA-256 (truncated to 64 bits) when crypto.subtle is available,\n * falls back to xxhash64 in insecure contexts (e.g., HTTP dev servers).\n */\nexport async function hashKey(input: string): Promise<string> {\n  // crypto.subtle is only available in secure contexts (HTTPS/localhost)\n  if (crypto.subtle) {\n    const data = new TextEncoder().encode(input);\n    const hash = await crypto.subtle.digest(\"SHA-256\", data);\n    // Take first 8 bytes (64 bits) as hex\n    return Array.from(new Uint8Array(hash).slice(0, 8))\n      .map((b) => b.toString(16).padStart(2, \"0\"))\n      .join(\"\");\n  }\n  // Fallback to xxhash64 for dev environments\n  xxhasher ??= await xxhash();\n  return xxhasher.h64(input).toString(16);\n}\n"]}