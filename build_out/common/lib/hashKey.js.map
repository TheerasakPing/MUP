{"version":3,"file":"hashKey.js","sourceRoot":"","sources":["../../../src/common/lib/hashKey.ts"],"names":[],"mappings":";;;;;;AAAA,8DAAiC;AAEjC,IAAI,QAAQ,GAA8C,IAAI,CAAC;AAE/D;;;;GAIG;AACI,KAAK,kBAAkB,KAAa,EAAmB;IAC5D,uEAAuE;IACvE,IAAI,MAAM,CAAC,MAAM,EAAE,CAAC;QAClB,MAAM,IAAI,GAAG,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QACzD,sCAAsC;QACtC,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;aAChD,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;aAC3C,IAAI,CAAC,EAAE,CAAC,CAAC;IACd,CAAC;IACD,4CAA4C;IAC5C,QAAQ,KAAR,QAAQ,GAAK,MAAM,IAAA,qBAAM,GAAE,EAAC;IAC5B,OAAO,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;AAAA,CACzC","sourcesContent":["import xxhash from \"xxhash-wasm\";\r\n\r\nlet xxhasher: Awaited<ReturnType<typeof xxhash>> | null = null;\r\n\r\n/**\r\n * Generate a 64-bit hash key for caching/deduplication.\r\n * Prefers SHA-256 (truncated to 64 bits) when crypto.subtle is available,\r\n * falls back to xxhash64 in insecure contexts (e.g., HTTP dev servers).\r\n */\r\nexport async function hashKey(input: string): Promise<string> {\r\n  // crypto.subtle is only available in secure contexts (HTTPS/localhost)\r\n  if (crypto.subtle) {\r\n    const data = new TextEncoder().encode(input);\r\n    const hash = await crypto.subtle.digest(\"SHA-256\", data);\r\n    // Take first 8 bytes (64 bits) as hex\r\n    return Array.from(new Uint8Array(hash).slice(0, 8))\r\n      .map((b) => b.toString(16).padStart(2, \"0\"))\r\n      .join(\"\");\r\n  }\r\n  // Fallback to xxhash64 for dev environments\r\n  xxhasher ??= await xxhash();\r\n  return xxhasher.h64(input).toString(16);\r\n}\r\n"]}