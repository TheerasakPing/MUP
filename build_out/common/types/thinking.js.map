{"version":3,"file":"thinking.js","sourceRoot":"","sources":["../../../src/common/types/thinking.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Thinking/Reasoning level types and mappings for AI models\n *\n * This module provides a unified interface for controlling reasoning across\n * different AI providers (Anthropic, OpenAI, etc.)\n */\n\nexport const THINKING_LEVELS = [\"off\", \"low\", \"medium\", \"high\", \"xhigh\", \"max\"] as const;\nexport type ThinkingLevel = (typeof THINKING_LEVELS)[number];\n\n/**\n * User-facing display labels for thinking levels.\n * Used in CLI help text and UI display.\n */\nexport const THINKING_DISPLAY_LABELS: Record<ThinkingLevel, string> = {\n  off: \"OFF\",\n  low: \"LOW\",\n  medium: \"MED\",\n  high: \"HIGH\",\n  xhigh: \"MAX\",\n  max: \"MAX\",\n};\n\n/**\n * Display label for thinking levels, with provider-aware xhigh labeling.\n * OpenAI models show \"XHIGH\" (their API term); Anthropic/default show \"MAX\".\n * Medium always displays as \"MED\".\n */\nexport function getThinkingDisplayLabel(level: ThinkingLevel, modelString?: string): string {\n  // xhigh and max are synonyms; show provider-aligned label\n  if ((level === \"xhigh\" || level === \"max\") && modelString) {\n    const normalized = modelString.trim().toLowerCase();\n    // OpenAI models: \"openai:gpt-5.2\" or \"mux-gateway:openai/gpt-5.2\"\n    if (normalized.startsWith(\"openai:\")) return \"XHIGH\";\n    const withoutPrefix = normalized.replace(/^[a-z0-9_-]+:\\s*/, \"\");\n    if (withoutPrefix.startsWith(\"openai/\")) return \"XHIGH\";\n  }\n  return THINKING_DISPLAY_LABELS[level];\n}\n\n/**\n * UI option label for thinking levels.\n *\n * Settings dropdowns use lowercase labels for most levels, but xhigh/max should\n * remain provider-aware to match the model's terminology.\n */\nexport function getThinkingOptionLabel(level: ThinkingLevel, modelString?: string): string {\n  if (level !== \"xhigh\" && level !== \"max\") {\n    return level;\n  }\n\n  return getThinkingDisplayLabel(level, modelString) === \"XHIGH\" ? \"xhigh\" : \"max\";\n}\n\n/**\n * Reverse mapping from display labels/aliases to internal ThinkingLevel values.\n * Accepts both canonical names and shorthand aliases (e.g., \"med\" → \"medium\").\n */\nconst DISPLAY_LABEL_TO_LEVEL: Record<string, ThinkingLevel> = {\n  off: \"off\",\n  low: \"low\",\n  med: \"medium\",\n  high: \"high\",\n  max: \"max\",\n  xhigh: \"xhigh\",\n  medium: \"medium\",\n};\n\n/**\n * Parse a thinking level from user input (display label or legacy value)\n * Returns undefined if not recognized\n */\nexport function parseThinkingDisplayLabel(value: string): ThinkingLevel | undefined {\n  const normalized = value.trim().toLowerCase();\n  return DISPLAY_LABEL_TO_LEVEL[normalized];\n}\n\n/**\n * Result of parsing a thinking level input. Named levels resolve to a\n * ThinkingLevel string immediately; numeric indices are deferred and\n * resolved against the target model's thinking policy at send time\n * (since different models have different allowed level sets).\n */\nexport type ParsedThinkingInput = ThinkingLevel | number;\n\n/**\n * Maximum numeric thinking index (inclusive). Indices 0–N map to\n * the model's allowed levels sorted from lowest to highest.\n * Kept generous — out-of-range indices are clamped to the model's max.\n */\nexport const MAX_THINKING_INDEX = 9;\n\n/**\n * Parse a thinking level from user input — accepts both named levels\n * (\"off\", \"low\", \"med\", \"medium\", \"high\", \"max\", \"xhigh\") and numeric\n * indices (0–N). Named levels resolve immediately; numeric indices are\n * returned as numbers for model-aware resolution later via\n * `resolveThinkingInput()` in policy.ts.\n *\n * Used by both `mux run --thinking` and `/model+level` oneshot.\n */\nexport function parseThinkingInput(value: string): ParsedThinkingInput | undefined {\n  const normalized = value.trim().toLowerCase();\n\n  // Named level first (e.g., \"off\", \"low\", \"med\", \"high\", \"max\", \"xhigh\")\n  const named = DISPLAY_LABEL_TO_LEVEL[normalized];\n  if (named) return named;\n\n  // Numeric index — resolved later against the model's thinking policy\n  // (e.g., 0 = lowest allowed level, which is \"medium\" for gpt-5.2-pro)\n  const num = parseInt(normalized, 10);\n  if (!Number.isNaN(num) && String(num) === normalized && num >= 0 && num <= MAX_THINKING_INDEX) {\n    return num;\n  }\n\n  return undefined;\n}\n\n/**\n * Active thinking levels (excludes \"off\")\n * Used for storing/restoring the last-used thinking level per model\n */\nexport type ThinkingLevelOn = Exclude<ThinkingLevel, \"off\">;\n\nexport function isThinkingLevel(value: unknown): value is ThinkingLevel {\n  return typeof value === \"string\" && THINKING_LEVELS.includes(value as ThinkingLevel);\n}\n\n/**\n * Synonym aliases for CLI/UI input: \"med\" → \"medium\".\n * \"xhigh\" and \"max\" are both first-class ThinkingLevel values (not synonyms).\n */\nexport const THINKING_LEVEL_SYNONYMS: Readonly<Record<string, ThinkingLevel>> = {\n  med: \"medium\",\n};\n\nexport function coerceThinkingLevel(value: unknown): ThinkingLevel | undefined {\n  if (typeof value !== \"string\") return undefined;\n  const synonym = THINKING_LEVEL_SYNONYMS[value];\n  if (synonym) return synonym;\n  return isThinkingLevel(value) ? value : undefined;\n}\n\n/**\n * Anthropic thinking token budget mapping\n *\n * These heuristics balance thinking depth with response time and cost.\n * Used for models that support extended thinking with budgetTokens\n * (e.g., Sonnet 4.5, Haiku 4.5, Opus 4.1, etc.)\n *\n * - off: No extended thinking\n * - low: Quick thinking for straightforward tasks (4K tokens)\n * - medium: Standard thinking for moderate complexity (10K tokens)\n * - high: Deep thinking for complex problems (20K tokens)\n */\nexport const ANTHROPIC_THINKING_BUDGETS: Record<ThinkingLevel, number> = {\n  off: 0,\n  low: 4000,\n  medium: 10000,\n  high: 20000,\n  xhigh: 20000, // Same as high - budget ceiling; effort: \"max\" controls depth\n  max: 20000,\n};\n\n/**\n * Anthropic effort type - matches SDK's AnthropicProviderOptions[\"effort\"]\n */\nexport type AnthropicEffortLevel = \"low\" | \"medium\" | \"high\" | \"max\";\n\n/**\n * Anthropic effort parameter mapping (Opus 4.5+)\n *\n * The effort parameter controls how much computational work the model applies.\n * - Opus 4.5 supports: low, medium, high (policy clamps xhigh → high)\n * - Opus 4.6 supports: low, medium, high, max (xhigh maps to \"max\" effort)\n */\nconst ANTHROPIC_EFFORT: Record<ThinkingLevel, AnthropicEffortLevel> = {\n  off: \"low\",\n  low: \"low\",\n  medium: \"medium\",\n  high: \"high\",\n  xhigh: \"max\", // Opus 4.6; policy clamps Opus 4.5 to \"high\" so xhigh never reaches 4.5\n  max: \"max\",\n};\n\nexport function getAnthropicEffort(level: ThinkingLevel): AnthropicEffortLevel {\n  return ANTHROPIC_EFFORT[level];\n}\n\n/**\n * Default thinking level when no value is set (UI initial state, backend fallback).\n * Semantically different from DEFAULT_THINKING_LEVEL which is the level used\n * when a user opts *into* thinking (e.g., CLI `--thinking` with no explicit level).\n */\nexport const THINKING_LEVEL_OFF: ThinkingLevel = \"off\";\n\n/**\n * Default thinking level to use when toggling thinking on\n * if no previous value is stored for the model\n */\nexport const DEFAULT_THINKING_LEVEL: ThinkingLevelOn = \"medium\";\n\n/**\n * OpenAI reasoning_effort mapping\n *\n * Maps our unified levels to OpenAI's reasoningEffort parameter\n * (used by o1, o3-mini, gpt-5, etc.)\n */\nexport const OPENAI_REASONING_EFFORT: Record<ThinkingLevel, string | undefined> = {\n  off: undefined,\n  low: \"low\",\n  medium: \"medium\",\n  high: \"high\",\n  xhigh: \"xhigh\", // Maps 1:1 to OpenAI's reasoning effort value\n  max: \"xhigh\",\n};\n\n/**\n * OpenRouter reasoning effort mapping\n *\n * Maps our unified levels to OpenRouter's reasoning.effort parameter\n * (used by Claude Sonnet Thinking and other reasoning models via OpenRouter)\n */\n\n/**\n * Thinking budgets for Gemini 2.5 models (in tokens)\n */\nexport const GEMINI_THINKING_BUDGETS: Record<ThinkingLevel, number> = {\n  off: 0,\n  low: 2048,\n  medium: 8192,\n  high: 16384, // Conservative max (some models go to 32k)\n  xhigh: 16384, // Same as high - Gemini doesn't support xhigh\n  max: 16384,\n} as const;\nexport const OPENROUTER_REASONING_EFFORT: Record<\n  ThinkingLevel,\n  \"low\" | \"medium\" | \"high\" | undefined\n> = {\n  off: undefined,\n  low: \"low\",\n  medium: \"medium\",\n  high: \"high\",\n  xhigh: \"high\", // Fallback to high - OpenRouter doesn't support xhigh\n  max: \"high\",\n};\n"]}