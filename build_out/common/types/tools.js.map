{"version":3,"file":"tools.js","sourceRoot":"","sources":["../../../src/common/types/tools.ts"],"names":[],"mappings":";AAAA;;;GAGG;;;AA2FU,QAAA,8BAA8B,GACzC,yEAAyE,CAAC;AAwC/D,QAAA,oBAAoB,GAAG;IAClC,0BAA0B;IAC1B,yBAAyB;IACzB,kBAAkB;CACV,CAAC;AAIX;;;GAGG;AACU,QAAA,mBAAmB,GAAG,gCAAgC,CAAC;AAEpE;;;GAGG;AACU,QAAA,uBAAuB,GAAG,sCAAsC,CAAC;AAE9E;;GAEG;AACU,QAAA,oBAAoB,GAAG,mDAAmD,CAAC;AAC3E,QAAA,0BAA0B,GACrC,mEAAmE,CAAC;AACzD,QAAA,0BAA0B,GAAG,gCAAgC,CAAC;AAE3E;;GAEG;AACU,QAAA,iBAAiB,GAC5B,uEAAuE,CAAC","sourcesContent":["/**\r\n * Shared type definitions for AI tools\r\n * These types are used by both the tool implementations and UI components\r\n */\r\n\r\nimport type { z } from \"zod\";\r\nimport type {\r\n  AgentReportToolResultSchema,\r\n  AgentSkillReadFileToolResultSchema,\r\n  AgentSkillReadToolResultSchema,\r\n  AskUserQuestionOptionSchema,\r\n  AskUserQuestionQuestionSchema,\r\n  AskUserQuestionToolResultSchema,\r\n  BashBackgroundListResultSchema,\r\n  BashBackgroundTerminateResultSchema,\r\n  BashOutputToolResultSchema,\r\n  BashToolResultSchema,\r\n  FileEditInsertToolResultSchema,\r\n  FileEditReplaceStringToolResultSchema,\r\n  MuxGlobalAgentsReadToolResultSchema,\r\n  MuxGlobalAgentsWriteToolResultSchema,\r\n  FileReadToolResultSchema,\r\n  TaskToolResultSchema,\r\n  TaskAwaitToolResultSchema,\r\n  TaskApplyGitPatchToolResultSchema,\r\n  TaskListToolResultSchema,\r\n  TaskTerminateToolResultSchema,\r\n  TOOL_DEFINITIONS,\r\n  WebFetchToolResultSchema,\r\n} from \"@/common/utils/tools/toolDefinitions\";\r\n\r\n// Bash Tool Types — derived from schema (avoid drift)\r\nexport type BashToolArgs = z.infer<typeof TOOL_DEFINITIONS.bash.schema>;\r\n\r\n// BashToolResult derived from Zod schema (single source of truth)\r\nexport type BashToolResult = z.infer<typeof BashToolResultSchema>;\r\n\r\n// File Read Tool Types — derived from schema (avoid drift)\r\nexport type FileReadToolArgs = z.infer<typeof TOOL_DEFINITIONS.file_read.schema>;\r\n\r\n// Agent Skill Tool Types\r\n// Args derived from schema (avoid drift)\r\nexport type AgentSkillReadToolArgs = z.infer<typeof TOOL_DEFINITIONS.agent_skill_read.schema>;\r\nexport type AgentSkillReadToolResult = z.infer<typeof AgentSkillReadToolResultSchema>;\r\n\r\nexport type AgentSkillReadFileToolArgs = z.infer<\r\n  typeof TOOL_DEFINITIONS.agent_skill_read_file.schema\r\n>;\r\nexport type AgentSkillReadFileToolResult = z.infer<typeof AgentSkillReadFileToolResultSchema>;\r\n\r\nexport interface AskUserQuestionUiOnlyPayload {\r\n  questions: AskUserQuestionQuestion[];\r\n  answers: Record<string, string>;\r\n}\r\n\r\nexport interface FileEditUiOnlyPayload {\r\n  diff: string;\r\n}\r\n\r\nexport interface NotifyUiOnlyPayload {\r\n  notifiedVia: \"electron\" | \"browser\";\r\n  workspaceId?: string;\r\n}\r\n\r\nexport interface ToolOutputUiOnly {\r\n  ask_user_question?: AskUserQuestionUiOnlyPayload;\r\n  file_edit?: FileEditUiOnlyPayload;\r\n  notify?: NotifyUiOnlyPayload;\r\n}\r\n\r\nexport interface ToolOutputUiOnlyFields {\r\n  ui_only?: ToolOutputUiOnly;\r\n}\r\n\r\n// FileReadToolResult derived from Zod schema (single source of truth)\r\nexport type FileReadToolResult = z.infer<typeof FileReadToolResultSchema>;\r\n\r\n// mux_global_agents_* tool types\r\nexport type MuxGlobalAgentsReadToolArgs = z.infer<\r\n  typeof TOOL_DEFINITIONS.mux_global_agents_read.schema\r\n>;\r\nexport type MuxGlobalAgentsReadToolResult = z.infer<typeof MuxGlobalAgentsReadToolResultSchema>;\r\n\r\nexport type MuxGlobalAgentsWriteToolArgs = z.infer<\r\n  typeof TOOL_DEFINITIONS.mux_global_agents_write.schema\r\n>;\r\nexport type MuxGlobalAgentsWriteToolResult = z.infer<typeof MuxGlobalAgentsWriteToolResultSchema>;\r\n\r\nexport interface FileEditDiffSuccessBase extends ToolOutputUiOnlyFields {\r\n  success: true;\r\n  diff: string;\r\n  warning?: string;\r\n}\r\n\r\nexport const FILE_EDIT_DIFF_OMITTED_MESSAGE =\r\n  \"[diff omitted in context - call file_read on the target file if needed]\";\r\n\r\nexport interface FileEditErrorResult extends ToolOutputUiOnlyFields {\r\n  success: false;\r\n  error: string;\r\n  note?: string; // Agent-only message (not displayed in UI)\r\n}\r\n\r\n// FileEditInsertToolArgs derived from schema (avoid drift)\r\nexport type FileEditInsertToolArgs = z.infer<typeof TOOL_DEFINITIONS.file_edit_insert.schema>;\r\n\r\n// FileEditInsertToolResult derived from Zod schema (single source of truth)\r\nexport type FileEditInsertToolResult = z.infer<typeof FileEditInsertToolResultSchema>;\r\n\r\n// FileEditReplaceStringToolArgs derived from schema (avoid drift)\r\nexport type FileEditReplaceStringToolArgs = z.infer<\r\n  typeof TOOL_DEFINITIONS.file_edit_replace_string.schema\r\n>;\r\n\r\n// FileEditReplaceStringToolResult derived from Zod schema (single source of truth)\r\nexport type FileEditReplaceStringToolResult = z.infer<typeof FileEditReplaceStringToolResultSchema>;\r\n\r\n// FileEditReplaceLinesToolArgs derived from schema (avoid drift)\r\nexport type FileEditReplaceLinesToolArgs = z.infer<\r\n  typeof TOOL_DEFINITIONS.file_edit_replace_lines.schema\r\n>;\r\n\r\nexport type FileEditReplaceLinesToolResult =\r\n  | (FileEditDiffSuccessBase & {\r\n      edits_applied: number;\r\n      lines_replaced: number;\r\n      line_delta: number;\r\n    })\r\n  | FileEditErrorResult;\r\n\r\nexport type FileEditSharedToolResult =\r\n  | FileEditReplaceStringToolResult\r\n  | FileEditReplaceLinesToolResult\r\n  | FileEditInsertToolResult;\r\n\r\nexport const FILE_EDIT_TOOL_NAMES = [\r\n  \"file_edit_replace_string\",\r\n  \"file_edit_replace_lines\",\r\n  \"file_edit_insert\",\r\n] as const;\r\n\r\nexport type FileEditToolName = (typeof FILE_EDIT_TOOL_NAMES)[number];\r\n\r\n/**\r\n * Prefix for file write denial error messages.\r\n * This consistent prefix helps both the UI and models detect when writes fail.\r\n */\r\nexport const WRITE_DENIED_PREFIX = \"WRITE DENIED, FILE UNMODIFIED:\";\r\n\r\n/**\r\n * Prefix for edit failure notes (agent-only messages).\r\n * This prefix signals to the agent that the file was not modified.\r\n */\r\nexport const EDIT_FAILED_NOTE_PREFIX = \"EDIT FAILED - file was NOT modified.\";\r\n\r\n/**\r\n * Common note fragments for DRY error messages\r\n */\r\nexport const NOTE_READ_FILE_RETRY = \"Read the file to get current content, then retry.\";\r\nexport const NOTE_READ_FILE_FIRST_RETRY =\r\n  \"Read the file first to get the exact current content, then retry.\";\r\nexport const NOTE_READ_FILE_AGAIN_RETRY = \"Read the file again and retry.\";\r\n\r\n/**\r\n * Tool description warning for file edit tools\r\n */\r\nexport const TOOL_EDIT_WARNING =\r\n  \"Always check the tool result before proceeding with other operations.\";\r\n\r\n// Generic tool error shape emitted via streamManager on tool-error parts.\r\nexport interface ToolErrorResult extends ToolOutputUiOnlyFields {\r\n  success: false;\r\n  error: string;\r\n}\r\nexport type FileEditToolArgs =\r\n  | FileEditReplaceStringToolArgs\r\n  | FileEditReplaceLinesToolArgs\r\n  | FileEditInsertToolArgs;\r\n\r\n// Ask User Question Tool Types\r\n// Args derived from schema (avoid drift)\r\nexport type AskUserQuestionToolArgs = z.infer<typeof TOOL_DEFINITIONS.ask_user_question.schema>;\r\n\r\nexport type AskUserQuestionOption = z.infer<typeof AskUserQuestionOptionSchema>;\r\nexport type AskUserQuestionQuestion = z.infer<typeof AskUserQuestionQuestionSchema>;\r\n\r\nexport type AskUserQuestionToolSuccessResult = z.infer<typeof AskUserQuestionToolResultSchema>;\r\n\r\nexport type AskUserQuestionToolResult = AskUserQuestionToolSuccessResult | ToolErrorResult;\r\n\r\n// Task Tool Types\r\nexport type TaskToolArgs = z.infer<typeof TOOL_DEFINITIONS.task.schema>;\r\n\r\nexport type TaskToolSuccessResult = z.infer<typeof TaskToolResultSchema>;\r\n\r\nexport type TaskToolResult = TaskToolSuccessResult | ToolErrorResult;\r\n\r\n// Task Await Tool Types\r\nexport type TaskAwaitToolArgs = z.infer<typeof TOOL_DEFINITIONS.task_await.schema>;\r\n\r\nexport type TaskAwaitToolSuccessResult = z.infer<typeof TaskAwaitToolResultSchema>;\r\n\r\n// Task Apply Git Patch Tool Types\r\nexport type TaskApplyGitPatchToolArgs = z.infer<\r\n  typeof TOOL_DEFINITIONS.task_apply_git_patch.schema\r\n>;\r\n\r\nexport type TaskApplyGitPatchToolSuccessResult = z.infer<typeof TaskApplyGitPatchToolResultSchema>;\r\n\r\nexport type TaskApplyGitPatchToolResult = TaskApplyGitPatchToolSuccessResult | ToolErrorResult;\r\n\r\nexport type TaskAwaitToolResult = TaskAwaitToolSuccessResult | ToolErrorResult;\r\n\r\n// Task List Tool Types\r\nexport type TaskListToolArgs = z.infer<typeof TOOL_DEFINITIONS.task_list.schema>;\r\n\r\nexport type TaskListToolSuccessResult = z.infer<typeof TaskListToolResultSchema>;\r\n\r\nexport type TaskListToolResult = TaskListToolSuccessResult | ToolErrorResult;\r\n\r\n// Task Terminate Tool Types\r\nexport type TaskTerminateToolArgs = z.infer<typeof TOOL_DEFINITIONS.task_terminate.schema>;\r\n\r\nexport type TaskTerminateToolSuccessResult = z.infer<typeof TaskTerminateToolResultSchema>;\r\n\r\nexport type TaskTerminateToolResult = TaskTerminateToolSuccessResult | ToolErrorResult;\r\n\r\n// Agent Report Tool Types\r\nexport type AgentReportToolArgs = z.infer<typeof TOOL_DEFINITIONS.agent_report.schema>;\r\n\r\nexport type AgentReportToolResult = z.infer<typeof AgentReportToolResultSchema> | ToolErrorResult;\r\n\r\n// Propose Plan Tool Types\r\n// Args derived from schema\r\nexport type ProposePlanToolArgs = z.infer<typeof TOOL_DEFINITIONS.propose_plan.schema>;\r\n\r\n// Result type for file-based propose_plan tool\r\n// Note: planContent is NOT included to save context - plan is visible via file_edit_* diffs\r\n// and will be included in mode transition message when switching to exec mode\r\nexport interface ProposePlanToolResult {\r\n  success: true;\r\n  planPath: string;\r\n  message: string;\r\n}\r\n\r\n// Error result when plan file not found\r\nexport interface ProposePlanToolError {\r\n  success: false;\r\n  error: string;\r\n}\r\n\r\n/**\r\n * @deprecated Legacy args type for backwards compatibility with old propose_plan tool calls.\r\n * Old sessions may have tool calls with title + plan args stored in chat history.\r\n */\r\nexport interface LegacyProposePlanToolArgs {\r\n  title: string;\r\n  plan: string;\r\n}\r\n\r\n/**\r\n * @deprecated Legacy result type for backwards compatibility.\r\n */\r\nexport interface LegacyProposePlanToolResult {\r\n  success: true;\r\n  title: string;\r\n  plan: string;\r\n  message: string;\r\n}\r\n\r\n// Todo Tool Types — derived from schema (avoid drift)\r\nexport type TodoWriteToolArgs = z.infer<typeof TOOL_DEFINITIONS.todo_write.schema>;\r\nexport type TodoItem = TodoWriteToolArgs[\"todos\"][number];\r\n\r\nexport interface TodoWriteToolResult {\r\n  success: true;\r\n  count: number;\r\n}\r\n\r\n// Status Set Tool Types — derived from schema (avoid drift)\r\nexport type StatusSetToolArgs = z.infer<typeof TOOL_DEFINITIONS.status_set.schema>;\r\n\r\n// Bash Output Tool Types — derived from schema (avoid drift)\r\nexport type BashOutputToolArgs = z.infer<typeof TOOL_DEFINITIONS.bash_output.schema>;\r\n\r\n// BashOutputToolResult derived from Zod schema (single source of truth)\r\nexport type BashOutputToolResult = z.infer<typeof BashOutputToolResultSchema>;\r\n\r\n// Bash Background Tool Types — derived from schema (avoid drift)\r\nexport type BashBackgroundTerminateArgs = z.infer<\r\n  typeof TOOL_DEFINITIONS.bash_background_terminate.schema\r\n>;\r\n\r\n// BashBackgroundTerminateResult derived from Zod schema (single source of truth)\r\nexport type BashBackgroundTerminateResult = z.infer<typeof BashBackgroundTerminateResultSchema>;\r\n\r\n// Bash Background List Tool Types\r\nexport type BashBackgroundListArgs = Record<string, never>;\r\n\r\n// BashBackgroundListResult derived from Zod schema (single source of truth)\r\nexport type BashBackgroundListResult = z.infer<typeof BashBackgroundListResultSchema>;\r\n\r\n// BashBackgroundListProcess extracted from result type for convenience\r\nexport type BashBackgroundListProcess = Extract<\r\n  BashBackgroundListResult,\r\n  { success: true }\r\n>[\"processes\"][number];\r\n\r\nexport type StatusSetToolResult =\r\n  | {\r\n      success: true;\r\n      emoji: string;\r\n      message: string;\r\n      url?: string;\r\n    }\r\n  | {\r\n      success: false;\r\n      error: string;\r\n    };\r\n\r\n// Web Fetch Tool Types — derived from schema (avoid drift)\r\nexport type WebFetchToolArgs = z.infer<typeof TOOL_DEFINITIONS.web_fetch.schema>;\r\n\r\n// WebFetchToolResult derived from Zod schema (single source of truth)\r\nexport type WebFetchToolResult = z.infer<typeof WebFetchToolResultSchema>;\r\n\r\n// Notify Tool Types\r\nexport type NotifyToolResult =\r\n  | (ToolOutputUiOnlyFields & {\r\n      success: true;\r\n      title: string;\r\n      message?: string;\r\n    })\r\n  | {\r\n      success: false;\r\n      error: string;\r\n    };\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// Hook Output Types\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Tool results may include hook_output when a tool hook (pre/post) produced output.\r\n * This is added by withHooks.ts in the backend.\r\n */\r\nexport interface WithHookOutput {\r\n  hook_output?: string;\r\n  /** Total hook execution time (pre + post) in milliseconds */\r\n  hook_duration_ms?: number;\r\n  /** Path to the hook file that produced this output (helps the model investigate/modify) */\r\n  hook_path?: string;\r\n}\r\n\r\n/**\r\n * Type utility to add hook_output to any tool result type.\r\n * Use this when you need to represent a result that may have hook output attached.\r\n */\r\nexport type MayHaveHookOutput<T> = T & WithHookOutput;\r\n"]}