{"version":3,"file":"tools.js","sourceRoot":"","sources":["../../../src/common/types/tools.ts"],"names":[],"mappings":";AAAA;;;GAGG;;;AA2FU,QAAA,8BAA8B,GACzC,yEAAyE,CAAC;AAwC/D,QAAA,oBAAoB,GAAG;IAClC,0BAA0B;IAC1B,yBAAyB;IACzB,kBAAkB;CACV,CAAC;AAIX;;;GAGG;AACU,QAAA,mBAAmB,GAAG,gCAAgC,CAAC;AAEpE;;;GAGG;AACU,QAAA,uBAAuB,GAAG,sCAAsC,CAAC;AAE9E;;GAEG;AACU,QAAA,oBAAoB,GAAG,mDAAmD,CAAC;AAC3E,QAAA,0BAA0B,GACrC,mEAAmE,CAAC;AACzD,QAAA,0BAA0B,GAAG,gCAAgC,CAAC;AAE3E;;GAEG;AACU,QAAA,iBAAiB,GAC5B,uEAAuE,CAAC","sourcesContent":["/**\n * Shared type definitions for AI tools\n * These types are used by both the tool implementations and UI components\n */\n\nimport type { z } from \"zod\";\nimport type {\n  AgentReportToolResultSchema,\n  AgentSkillReadFileToolResultSchema,\n  AgentSkillReadToolResultSchema,\n  AskUserQuestionOptionSchema,\n  AskUserQuestionQuestionSchema,\n  AskUserQuestionToolResultSchema,\n  BashBackgroundListResultSchema,\n  BashBackgroundTerminateResultSchema,\n  BashOutputToolResultSchema,\n  BashToolResultSchema,\n  FileEditInsertToolResultSchema,\n  FileEditReplaceStringToolResultSchema,\n  MuxGlobalAgentsReadToolResultSchema,\n  MuxGlobalAgentsWriteToolResultSchema,\n  FileReadToolResultSchema,\n  TaskToolResultSchema,\n  TaskAwaitToolResultSchema,\n  TaskApplyGitPatchToolResultSchema,\n  TaskListToolResultSchema,\n  TaskTerminateToolResultSchema,\n  TOOL_DEFINITIONS,\n  WebFetchToolResultSchema,\n} from \"@/common/utils/tools/toolDefinitions\";\n\n// Bash Tool Types — derived from schema (avoid drift)\nexport type BashToolArgs = z.infer<typeof TOOL_DEFINITIONS.bash.schema>;\n\n// BashToolResult derived from Zod schema (single source of truth)\nexport type BashToolResult = z.infer<typeof BashToolResultSchema>;\n\n// File Read Tool Types — derived from schema (avoid drift)\nexport type FileReadToolArgs = z.infer<typeof TOOL_DEFINITIONS.file_read.schema>;\n\n// Agent Skill Tool Types\n// Args derived from schema (avoid drift)\nexport type AgentSkillReadToolArgs = z.infer<typeof TOOL_DEFINITIONS.agent_skill_read.schema>;\nexport type AgentSkillReadToolResult = z.infer<typeof AgentSkillReadToolResultSchema>;\n\nexport type AgentSkillReadFileToolArgs = z.infer<\n  typeof TOOL_DEFINITIONS.agent_skill_read_file.schema\n>;\nexport type AgentSkillReadFileToolResult = z.infer<typeof AgentSkillReadFileToolResultSchema>;\n\nexport interface AskUserQuestionUiOnlyPayload {\n  questions: AskUserQuestionQuestion[];\n  answers: Record<string, string>;\n}\n\nexport interface FileEditUiOnlyPayload {\n  diff: string;\n}\n\nexport interface NotifyUiOnlyPayload {\n  notifiedVia: \"electron\" | \"browser\";\n  workspaceId?: string;\n}\n\nexport interface ToolOutputUiOnly {\n  ask_user_question?: AskUserQuestionUiOnlyPayload;\n  file_edit?: FileEditUiOnlyPayload;\n  notify?: NotifyUiOnlyPayload;\n}\n\nexport interface ToolOutputUiOnlyFields {\n  ui_only?: ToolOutputUiOnly;\n}\n\n// FileReadToolResult derived from Zod schema (single source of truth)\nexport type FileReadToolResult = z.infer<typeof FileReadToolResultSchema>;\n\n// mux_global_agents_* tool types\nexport type MuxGlobalAgentsReadToolArgs = z.infer<\n  typeof TOOL_DEFINITIONS.mux_global_agents_read.schema\n>;\nexport type MuxGlobalAgentsReadToolResult = z.infer<typeof MuxGlobalAgentsReadToolResultSchema>;\n\nexport type MuxGlobalAgentsWriteToolArgs = z.infer<\n  typeof TOOL_DEFINITIONS.mux_global_agents_write.schema\n>;\nexport type MuxGlobalAgentsWriteToolResult = z.infer<typeof MuxGlobalAgentsWriteToolResultSchema>;\n\nexport interface FileEditDiffSuccessBase extends ToolOutputUiOnlyFields {\n  success: true;\n  diff: string;\n  warning?: string;\n}\n\nexport const FILE_EDIT_DIFF_OMITTED_MESSAGE =\n  \"[diff omitted in context - call file_read on the target file if needed]\";\n\nexport interface FileEditErrorResult extends ToolOutputUiOnlyFields {\n  success: false;\n  error: string;\n  note?: string; // Agent-only message (not displayed in UI)\n}\n\n// FileEditInsertToolArgs derived from schema (avoid drift)\nexport type FileEditInsertToolArgs = z.infer<typeof TOOL_DEFINITIONS.file_edit_insert.schema>;\n\n// FileEditInsertToolResult derived from Zod schema (single source of truth)\nexport type FileEditInsertToolResult = z.infer<typeof FileEditInsertToolResultSchema>;\n\n// FileEditReplaceStringToolArgs derived from schema (avoid drift)\nexport type FileEditReplaceStringToolArgs = z.infer<\n  typeof TOOL_DEFINITIONS.file_edit_replace_string.schema\n>;\n\n// FileEditReplaceStringToolResult derived from Zod schema (single source of truth)\nexport type FileEditReplaceStringToolResult = z.infer<typeof FileEditReplaceStringToolResultSchema>;\n\n// FileEditReplaceLinesToolArgs derived from schema (avoid drift)\nexport type FileEditReplaceLinesToolArgs = z.infer<\n  typeof TOOL_DEFINITIONS.file_edit_replace_lines.schema\n>;\n\nexport type FileEditReplaceLinesToolResult =\n  | (FileEditDiffSuccessBase & {\n      edits_applied: number;\n      lines_replaced: number;\n      line_delta: number;\n    })\n  | FileEditErrorResult;\n\nexport type FileEditSharedToolResult =\n  | FileEditReplaceStringToolResult\n  | FileEditReplaceLinesToolResult\n  | FileEditInsertToolResult;\n\nexport const FILE_EDIT_TOOL_NAMES = [\n  \"file_edit_replace_string\",\n  \"file_edit_replace_lines\",\n  \"file_edit_insert\",\n] as const;\n\nexport type FileEditToolName = (typeof FILE_EDIT_TOOL_NAMES)[number];\n\n/**\n * Prefix for file write denial error messages.\n * This consistent prefix helps both the UI and models detect when writes fail.\n */\nexport const WRITE_DENIED_PREFIX = \"WRITE DENIED, FILE UNMODIFIED:\";\n\n/**\n * Prefix for edit failure notes (agent-only messages).\n * This prefix signals to the agent that the file was not modified.\n */\nexport const EDIT_FAILED_NOTE_PREFIX = \"EDIT FAILED - file was NOT modified.\";\n\n/**\n * Common note fragments for DRY error messages\n */\nexport const NOTE_READ_FILE_RETRY = \"Read the file to get current content, then retry.\";\nexport const NOTE_READ_FILE_FIRST_RETRY =\n  \"Read the file first to get the exact current content, then retry.\";\nexport const NOTE_READ_FILE_AGAIN_RETRY = \"Read the file again and retry.\";\n\n/**\n * Tool description warning for file edit tools\n */\nexport const TOOL_EDIT_WARNING =\n  \"Always check the tool result before proceeding with other operations.\";\n\n// Generic tool error shape emitted via streamManager on tool-error parts.\nexport interface ToolErrorResult extends ToolOutputUiOnlyFields {\n  success: false;\n  error: string;\n}\nexport type FileEditToolArgs =\n  | FileEditReplaceStringToolArgs\n  | FileEditReplaceLinesToolArgs\n  | FileEditInsertToolArgs;\n\n// Ask User Question Tool Types\n// Args derived from schema (avoid drift)\nexport type AskUserQuestionToolArgs = z.infer<typeof TOOL_DEFINITIONS.ask_user_question.schema>;\n\nexport type AskUserQuestionOption = z.infer<typeof AskUserQuestionOptionSchema>;\nexport type AskUserQuestionQuestion = z.infer<typeof AskUserQuestionQuestionSchema>;\n\nexport type AskUserQuestionToolSuccessResult = z.infer<typeof AskUserQuestionToolResultSchema>;\n\nexport type AskUserQuestionToolResult = AskUserQuestionToolSuccessResult | ToolErrorResult;\n\n// Task Tool Types\nexport type TaskToolArgs = z.infer<typeof TOOL_DEFINITIONS.task.schema>;\n\nexport type TaskToolSuccessResult = z.infer<typeof TaskToolResultSchema>;\n\nexport type TaskToolResult = TaskToolSuccessResult | ToolErrorResult;\n\n// Task Await Tool Types\nexport type TaskAwaitToolArgs = z.infer<typeof TOOL_DEFINITIONS.task_await.schema>;\n\nexport type TaskAwaitToolSuccessResult = z.infer<typeof TaskAwaitToolResultSchema>;\n\n// Task Apply Git Patch Tool Types\nexport type TaskApplyGitPatchToolArgs = z.infer<\n  typeof TOOL_DEFINITIONS.task_apply_git_patch.schema\n>;\n\nexport type TaskApplyGitPatchToolSuccessResult = z.infer<typeof TaskApplyGitPatchToolResultSchema>;\n\nexport type TaskApplyGitPatchToolResult = TaskApplyGitPatchToolSuccessResult | ToolErrorResult;\n\nexport type TaskAwaitToolResult = TaskAwaitToolSuccessResult | ToolErrorResult;\n\n// Task List Tool Types\nexport type TaskListToolArgs = z.infer<typeof TOOL_DEFINITIONS.task_list.schema>;\n\nexport type TaskListToolSuccessResult = z.infer<typeof TaskListToolResultSchema>;\n\nexport type TaskListToolResult = TaskListToolSuccessResult | ToolErrorResult;\n\n// Task Terminate Tool Types\nexport type TaskTerminateToolArgs = z.infer<typeof TOOL_DEFINITIONS.task_terminate.schema>;\n\nexport type TaskTerminateToolSuccessResult = z.infer<typeof TaskTerminateToolResultSchema>;\n\nexport type TaskTerminateToolResult = TaskTerminateToolSuccessResult | ToolErrorResult;\n\n// Agent Report Tool Types\nexport type AgentReportToolArgs = z.infer<typeof TOOL_DEFINITIONS.agent_report.schema>;\n\nexport type AgentReportToolResult = z.infer<typeof AgentReportToolResultSchema> | ToolErrorResult;\n\n// Propose Plan Tool Types\n// Args derived from schema\nexport type ProposePlanToolArgs = z.infer<typeof TOOL_DEFINITIONS.propose_plan.schema>;\n\n// Result type for file-based propose_plan tool\n// Note: planContent is NOT included to save context - plan is visible via file_edit_* diffs\n// and will be included in mode transition message when switching to exec mode\nexport interface ProposePlanToolResult {\n  success: true;\n  planPath: string;\n  message: string;\n}\n\n// Error result when plan file not found\nexport interface ProposePlanToolError {\n  success: false;\n  error: string;\n}\n\n/**\n * @deprecated Legacy args type for backwards compatibility with old propose_plan tool calls.\n * Old sessions may have tool calls with title + plan args stored in chat history.\n */\nexport interface LegacyProposePlanToolArgs {\n  title: string;\n  plan: string;\n}\n\n/**\n * @deprecated Legacy result type for backwards compatibility.\n */\nexport interface LegacyProposePlanToolResult {\n  success: true;\n  title: string;\n  plan: string;\n  message: string;\n}\n\n// Todo Tool Types — derived from schema (avoid drift)\nexport type TodoWriteToolArgs = z.infer<typeof TOOL_DEFINITIONS.todo_write.schema>;\nexport type TodoItem = TodoWriteToolArgs[\"todos\"][number];\n\nexport interface TodoWriteToolResult {\n  success: true;\n  count: number;\n}\n\n// Status Set Tool Types — derived from schema (avoid drift)\nexport type StatusSetToolArgs = z.infer<typeof TOOL_DEFINITIONS.status_set.schema>;\n\n// Bash Output Tool Types — derived from schema (avoid drift)\nexport type BashOutputToolArgs = z.infer<typeof TOOL_DEFINITIONS.bash_output.schema>;\n\n// BashOutputToolResult derived from Zod schema (single source of truth)\nexport type BashOutputToolResult = z.infer<typeof BashOutputToolResultSchema>;\n\n// Bash Background Tool Types — derived from schema (avoid drift)\nexport type BashBackgroundTerminateArgs = z.infer<\n  typeof TOOL_DEFINITIONS.bash_background_terminate.schema\n>;\n\n// BashBackgroundTerminateResult derived from Zod schema (single source of truth)\nexport type BashBackgroundTerminateResult = z.infer<typeof BashBackgroundTerminateResultSchema>;\n\n// Bash Background List Tool Types\nexport type BashBackgroundListArgs = Record<string, never>;\n\n// BashBackgroundListResult derived from Zod schema (single source of truth)\nexport type BashBackgroundListResult = z.infer<typeof BashBackgroundListResultSchema>;\n\n// BashBackgroundListProcess extracted from result type for convenience\nexport type BashBackgroundListProcess = Extract<\n  BashBackgroundListResult,\n  { success: true }\n>[\"processes\"][number];\n\nexport type StatusSetToolResult =\n  | {\n      success: true;\n      emoji: string;\n      message: string;\n      url?: string;\n    }\n  | {\n      success: false;\n      error: string;\n    };\n\n// Web Fetch Tool Types — derived from schema (avoid drift)\nexport type WebFetchToolArgs = z.infer<typeof TOOL_DEFINITIONS.web_fetch.schema>;\n\n// WebFetchToolResult derived from Zod schema (single source of truth)\nexport type WebFetchToolResult = z.infer<typeof WebFetchToolResultSchema>;\n\n// Notify Tool Types\nexport type NotifyToolResult =\n  | (ToolOutputUiOnlyFields & {\n      success: true;\n      title: string;\n      message?: string;\n    })\n  | {\n      success: false;\n      error: string;\n    };\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// Hook Output Types\n// ═══════════════════════════════════════════════════════════════════════════════\n\n/**\n * Tool results may include hook_output when a tool hook (pre/post) produced output.\n * This is added by withHooks.ts in the backend.\n */\nexport interface WithHookOutput {\n  hook_output?: string;\n  /** Total hook execution time (pre + post) in milliseconds */\n  hook_duration_ms?: number;\n  /** Path to the hook file that produced this output (helps the model investigate/modify) */\n  hook_path?: string;\n}\n\n/**\n * Type utility to add hook_output to any tool result type.\n * Use this when you need to represent a result that may have hook output attached.\n */\nexport type MayHaveHookOutput<T> = T & WithHookOutput;\n"]}