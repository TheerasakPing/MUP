{"version":3,"file":"thinking.test.js","sourceRoot":"","sources":["../../../src/common/types/thinking.test.ts"],"names":[],"mappings":";;AAAA,uCAAkD;AAClD,yCAMoB;AAEpB,IAAA,mBAAQ,EAAC,yBAAyB,EAAE,GAAG,EAAE,CAAC;IACxC,IAAA,eAAI,EAAC,+CAA+C,EAAE,GAAG,EAAE,CAAC;QAC1D,IAAA,iBAAM,EAAC,IAAA,kCAAuB,EAAC,OAAO,EAAE,2BAA2B,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAClF,IAAA,iBAAM,EAAC,IAAA,kCAAuB,EAAC,KAAK,EAAE,2BAA2B,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAChF,IAAA,iBAAM,EAAC,IAAA,kCAAuB,EAAC,OAAO,EAAE,uCAAuC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC9F,IAAA,iBAAM,EAAC,IAAA,kCAAuB,EAAC,OAAO,EAAE,2BAA2B,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CACnF,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,8CAA8C,EAAE,GAAG,EAAE,CAAC;QACzD,IAAA,iBAAM,EAAC,IAAA,kCAAuB,EAAC,OAAO,EAAE,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACzE,IAAA,iBAAM,EAAC,IAAA,kCAAuB,EAAC,KAAK,EAAE,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACvE,IAAA,iBAAM,EAAC,IAAA,kCAAuB,EAAC,OAAO,EAAE,4BAA4B,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACrF,IAAA,iBAAM,EAAC,IAAA,kCAAuB,EAAC,KAAK,EAAE,4BAA4B,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IAAA,CACpF,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,6DAA6D,EAAE,GAAG,EAAE,CAAC;QACxE,IAAA,iBAAM,EAAC,IAAA,kCAAuB,EAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACrD,IAAA,iBAAM,EAAC,IAAA,kCAAuB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CACpD,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,kEAAkE,EAAE,GAAG,EAAE,CAAC;QAC7E,IAAA,iBAAM,EAAC,IAAA,kCAAuB,EAAC,KAAK,EAAE,2BAA2B,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAChF,IAAA,iBAAM,EAAC,IAAA,kCAAuB,EAAC,KAAK,EAAE,2BAA2B,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAChF,IAAA,iBAAM,EAAC,IAAA,kCAAuB,EAAC,QAAQ,EAAE,2BAA2B,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACnF,IAAA,iBAAM,EAAC,IAAA,kCAAuB,EAAC,MAAM,EAAE,2BAA2B,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAAA,CACnF,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,IAAA,mBAAQ,EAAC,wBAAwB,EAAE,GAAG,EAAE,CAAC;IACvC,IAAA,eAAI,EAAC,2CAA2C,EAAE,GAAG,EAAE,CAAC;QACtD,IAAA,iBAAM,EAAC,IAAA,iCAAsB,EAAC,OAAO,EAAE,2BAA2B,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CAClF,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,8CAA8C,EAAE,GAAG,EAAE,CAAC;QACzD,IAAA,iBAAM,EAAC,IAAA,iCAAsB,EAAC,OAAO,EAAE,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACxE,IAAA,iBAAM,EAAC,IAAA,iCAAsB,EAAC,KAAK,EAAE,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IAAA,CACvE,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,4BAA4B,EAAE,GAAG,EAAE,CAAC;QACvC,IAAA,iBAAM,EAAC,IAAA,iCAAsB,EAAC,QAAQ,EAAE,2BAA2B,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAAA,CACtF,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,IAAA,mBAAQ,EAAC,qBAAqB,EAAE,GAAG,EAAE,CAAC;IACpC,IAAA,eAAI,EAAC,8BAA8B,EAAE,GAAG,EAAE,CAAC;QACzC,IAAA,iBAAM,EAAC,IAAA,8BAAmB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAAA,CACnD,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,mDAAmD,EAAE,GAAG,EAAE,CAAC;QAC9D,IAAA,iBAAM,EAAC,IAAA,8BAAmB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC/C,IAAA,iBAAM,EAAC,IAAA,8BAAmB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC/C,IAAA,iBAAM,EAAC,IAAA,8BAAmB,EAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACrD,IAAA,iBAAM,EAAC,IAAA,8BAAmB,EAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACjD,IAAA,iBAAM,EAAC,IAAA,8BAAmB,EAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACnD,IAAA,iBAAM,EAAC,IAAA,8BAAmB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAAA,CAChD,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,sCAAsC,EAAE,GAAG,EAAE,CAAC;QACjD,IAAA,iBAAM,EAAC,IAAA,8BAAmB,EAAC,SAAS,CAAC,CAAC,CAAC,aAAa,EAAE,CAAC;QACvD,IAAA,iBAAM,EAAC,IAAA,8BAAmB,EAAC,EAAE,CAAC,CAAC,CAAC,aAAa,EAAE,CAAC;QAChD,IAAA,iBAAM,EAAC,IAAA,8BAAmB,EAAC,IAAI,CAAC,CAAC,CAAC,aAAa,EAAE,CAAC;IAAA,CACnD,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,IAAA,mBAAQ,EAAC,oBAAoB,EAAE,GAAG,EAAE,CAAC;IACnC,eAAI,CAAC,IAAI,CAAC;QACR,CAAC,KAAK,EAAE,KAAK,CAAC;QACd,CAAC,KAAK,EAAE,KAAK,CAAC;QACd,CAAC,KAAK,EAAE,QAAQ,CAAC;QACjB,CAAC,QAAQ,EAAE,QAAQ,CAAC;QACpB,CAAC,MAAM,EAAE,MAAM,CAAC;QAChB,CAAC,KAAK,EAAE,KAAK,CAAC;QACd,CAAC,OAAO,EAAE,OAAO,CAAC;QAClB,CAAC,KAAK,EAAE,KAAK,CAAC;QACd,CAAC,KAAK,EAAE,QAAQ,CAAC;QACjB,CAAC,MAAM,EAAE,MAAM,CAAC;KACR,CAAC,CAAC,8BAA4B,EAAE,CAAC,KAAK,EAAE,QAAQ,EAAE,EAAE,CAAC;QAC7D,IAAA,iBAAM,EAAC,IAAA,6BAAkB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAAA,CAClD,CAAC,CAAC;IAEH,2FAA2F;IAC3F,eAAI,CAAC,IAAI,CAAC;QACR,CAAC,GAAG,EAAE,CAAC,CAAC;QACR,CAAC,GAAG,EAAE,CAAC,CAAC;QACR,CAAC,GAAG,EAAE,CAAC,CAAC;QACR,CAAC,GAAG,EAAE,CAAC,CAAC;QACR,CAAC,GAAG,EAAE,CAAC,CAAC;QACR,CAAC,GAAG,EAAE,CAAC,CAAC;KACA,CAAC,CAAC,gCAA8B,EAAE,CAAC,KAAK,EAAE,QAAQ,EAAE,EAAE,CAAC;QAC/D,IAAA,iBAAM,EAAC,IAAA,6BAAkB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAAA,CAClD,CAAC,CAAC;IAEH,eAAI,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,EAAE,EAAE,IAAI,CAAC,CAAC,CAC7D,wCAAwC,EACxC,CAAC,KAAK,EAAE,EAAE,CAAC;QACT,IAAA,iBAAM,EAAC,IAAA,6BAAkB,EAAC,KAAK,CAAC,CAAC,CAAC,aAAa,EAAE,CAAC;IAAA,CACnD,CACF,CAAC;IAEF,IAAA,eAAI,EAAC,kBAAkB,EAAE,GAAG,EAAE,CAAC;QAC7B,IAAA,iBAAM,EAAC,IAAA,6BAAkB,EAAC,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACpD,2CAA2C;QAC3C,IAAA,iBAAM,EAAC,IAAA,6BAAkB,EAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAAA,CAC3C,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC;AAEH,IAAA,mBAAQ,EAAC,oBAAoB,EAAE,GAAG,EAAE,CAAC;IACnC,IAAA,eAAI,EAAC,iDAAiD,EAAE,GAAG,EAAE,CAAC;QAC5D,IAAA,iBAAM,EAAC,6BAAkB,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAAA,CACpC,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { describe, expect, test } from \"bun:test\";\nimport {\n  coerceThinkingLevel,\n  getThinkingDisplayLabel,\n  getThinkingOptionLabel,\n  MAX_THINKING_INDEX,\n  parseThinkingInput,\n} from \"./thinking\";\n\ndescribe(\"getThinkingDisplayLabel\", () => {\n  test(\"returns MAX for xhigh/max on Anthropic models\", () => {\n    expect(getThinkingDisplayLabel(\"xhigh\", \"anthropic:claude-opus-4-6\")).toBe(\"MAX\");\n    expect(getThinkingDisplayLabel(\"max\", \"anthropic:claude-opus-4-6\")).toBe(\"MAX\");\n    expect(getThinkingDisplayLabel(\"xhigh\", \"mux-gateway:anthropic/claude-opus-4-6\")).toBe(\"MAX\");\n    expect(getThinkingDisplayLabel(\"xhigh\", \"anthropic:claude-opus-4-5\")).toBe(\"MAX\");\n  });\n\n  test(\"returns XHIGH for xhigh/max on OpenAI models\", () => {\n    expect(getThinkingDisplayLabel(\"xhigh\", \"openai:gpt-5.2\")).toBe(\"XHIGH\");\n    expect(getThinkingDisplayLabel(\"max\", \"openai:gpt-5.2\")).toBe(\"XHIGH\");\n    expect(getThinkingDisplayLabel(\"xhigh\", \"mux-gateway:openai/gpt-5.2\")).toBe(\"XHIGH\");\n    expect(getThinkingDisplayLabel(\"max\", \"mux-gateway:openai/gpt-5.2\")).toBe(\"XHIGH\");\n  });\n\n  test(\"returns MAX for xhigh/max when no model specified (default)\", () => {\n    expect(getThinkingDisplayLabel(\"xhigh\")).toBe(\"MAX\");\n    expect(getThinkingDisplayLabel(\"max\")).toBe(\"MAX\");\n  });\n\n  test(\"returns standard labels for non-xhigh levels regardless of model\", () => {\n    expect(getThinkingDisplayLabel(\"off\", \"anthropic:claude-opus-4-6\")).toBe(\"OFF\");\n    expect(getThinkingDisplayLabel(\"low\", \"anthropic:claude-opus-4-6\")).toBe(\"LOW\");\n    expect(getThinkingDisplayLabel(\"medium\", \"anthropic:claude-opus-4-6\")).toBe(\"MED\");\n    expect(getThinkingDisplayLabel(\"high\", \"anthropic:claude-opus-4-6\")).toBe(\"HIGH\");\n  });\n});\n\ndescribe(\"getThinkingOptionLabel\", () => {\n  test(\"renders max for xhigh on Anthropic models\", () => {\n    expect(getThinkingOptionLabel(\"xhigh\", \"anthropic:claude-opus-4-6\")).toBe(\"max\");\n  });\n\n  test(\"renders xhigh for xhigh/max on OpenAI models\", () => {\n    expect(getThinkingOptionLabel(\"xhigh\", \"openai:gpt-5.2\")).toBe(\"xhigh\");\n    expect(getThinkingOptionLabel(\"max\", \"openai:gpt-5.2\")).toBe(\"xhigh\");\n  });\n\n  test(\"preserves non-xhigh labels\", () => {\n    expect(getThinkingOptionLabel(\"medium\", \"anthropic:claude-opus-4-6\")).toBe(\"medium\");\n  });\n});\n\ndescribe(\"coerceThinkingLevel\", () => {\n  test(\"normalizes shorthand aliases\", () => {\n    expect(coerceThinkingLevel(\"med\")).toBe(\"medium\");\n  });\n\n  test(\"passes through all canonical levels including max\", () => {\n    expect(coerceThinkingLevel(\"off\")).toBe(\"off\");\n    expect(coerceThinkingLevel(\"low\")).toBe(\"low\");\n    expect(coerceThinkingLevel(\"medium\")).toBe(\"medium\");\n    expect(coerceThinkingLevel(\"high\")).toBe(\"high\");\n    expect(coerceThinkingLevel(\"xhigh\")).toBe(\"xhigh\");\n    expect(coerceThinkingLevel(\"max\")).toBe(\"max\");\n  });\n\n  test(\"returns undefined for invalid values\", () => {\n    expect(coerceThinkingLevel(\"invalid\")).toBeUndefined();\n    expect(coerceThinkingLevel(42)).toBeUndefined();\n    expect(coerceThinkingLevel(null)).toBeUndefined();\n  });\n});\n\ndescribe(\"parseThinkingInput\", () => {\n  test.each([\n    [\"off\", \"off\"],\n    [\"low\", \"low\"],\n    [\"med\", \"medium\"],\n    [\"medium\", \"medium\"],\n    [\"high\", \"high\"],\n    [\"max\", \"max\"],\n    [\"xhigh\", \"xhigh\"],\n    [\"OFF\", \"off\"],\n    [\"MED\", \"medium\"],\n    [\"High\", \"high\"],\n  ] as const)(\"parses named level %s → %s\", (input, expected) => {\n    expect(parseThinkingInput(input)).toBe(expected);\n  });\n\n  // Numeric indices are returned as raw numbers (resolved against model policy at send time)\n  test.each([\n    [\"0\", 0],\n    [\"1\", 1],\n    [\"2\", 2],\n    [\"3\", 3],\n    [\"4\", 4],\n    [\"9\", 9],\n  ] as const)(\"parses numeric level %s → %s\", (input, expected) => {\n    expect(parseThinkingInput(input)).toBe(expected);\n  });\n\n  test.each([\"-1\", \"10\", \"99\", \"foo\", \"mediun\", \"1.5\", \"\", \"  \"])(\n    \"returns undefined for invalid input %j\",\n    (input) => {\n      expect(parseThinkingInput(input)).toBeUndefined();\n    }\n  );\n\n  test(\"trims whitespace\", () => {\n    expect(parseThinkingInput(\"  high  \")).toBe(\"high\");\n    // Numeric with whitespace returns a number\n    expect(parseThinkingInput(\" 2 \")).toBe(2);\n  });\n});\n\ndescribe(\"MAX_THINKING_INDEX\", () => {\n  test(\"is 9 (generous upper bound for numeric indices)\", () => {\n    expect(MAX_THINKING_INDEX).toBe(9);\n  });\n});\n"]}