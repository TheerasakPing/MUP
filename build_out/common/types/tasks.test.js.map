{"version":3,"file":"tasks.test.js","sourceRoot":"","sources":["../../../src/common/types/tasks.test.ts"],"names":[],"mappings":";;AAAA,uCAAkD;AAElD,mCAKiB;AAEjB,IAAA,mBAAQ,EAAC,uBAAuB,EAAE,GAAG,EAAE,CAAC;IACtC,IAAA,eAAI,EAAC,6BAA6B,EAAE,GAAG,EAAE,CAAC;QACxC,IAAA,iBAAM,EAAC,IAAA,6BAAqB,EAAC,SAAS,CAAC,CAAC,CAAC,OAAO,CAAC,6BAAqB,CAAC,CAAC;QACxE,IAAA,iBAAM,EAAC,IAAA,6BAAqB,EAAC,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,6BAAqB,CAAC,CAAC;IAAA,CAClE,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,iCAAiC,EAAE,GAAG,EAAE,CAAC;QAC5C,MAAM,UAAU,GAAG,IAAA,6BAAqB,EAAC;YACvC,qBAAqB,EAAE,GAAG;YAC1B,mBAAmB,EAAE,CAAC;YACtB,4BAA4B,EAAE,CAAC,CAAC;YAChC,iCAAiC,EAAE,YAAY;YAC/C,gCAAgC,EAAE,CAAC;YACnC,6BAA6B,EAAE,CAAC;SACjC,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,UAAU,CAAC,qBAAqB,CAAC,CAAC,IAAI,CAAC,4BAAoB,CAAC,qBAAqB,CAAC,GAAG,CAAC,CAAC;QAC9F,IAAA,iBAAM,EAAC,UAAU,CAAC,mBAAmB,CAAC,CAAC,IAAI,CAAC,4BAAoB,CAAC,mBAAmB,CAAC,GAAG,CAAC,CAAC;QAE1F,IAAA,iBAAM,EAAC,UAAU,CAAC,4BAA4B,CAAC,CAAC,IAAI,CAClD,6CAAqC,CAAC,4BAA4B,CAAC,GAAG,CACvE,CAAC;QACF,IAAA,iBAAM,EAAC,UAAU,CAAC,iCAAiC,CAAC,CAAC,IAAI,CACvD,6CAAqC,CAAC,iCAAiC,CAAC,GAAG,CAC5E,CAAC;QACF,IAAA,iBAAM,EAAC,UAAU,CAAC,gCAAgC,CAAC,CAAC,IAAI,CACtD,6CAAqC,CAAC,gCAAgC,CAAC,GAAG,CAC3E,CAAC;QACF,IAAA,iBAAM,EAAC,UAAU,CAAC,6BAA6B,CAAC,CAAC,IAAI,CACnD,6CAAqC,CAAC,6BAA6B,CAAC,GAAG,CACxE,CAAC;IAAA,CACH,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,wBAAwB,EAAE,GAAG,EAAE,CAAC;QACnC,MAAM,UAAU,GAAG,IAAA,6BAAqB,EAAC;YACvC,qBAAqB,EAAE,MAAM,CAAC,GAAG;YACjC,mBAAmB,EAAE,MAAM,CAAC,GAAG;YAC/B,4BAA4B,EAAE,MAAM,CAAC,GAAG;YACxC,iCAAiC,EAAE,MAAM,CAAC,GAAG;YAC7C,gCAAgC,EAAE,MAAM,CAAC,GAAG;YAC5C,6BAA6B,EAAE,MAAM,CAAC,GAAG;SAC1C,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,UAAU,CAAC,CAAC,OAAO,CAAC,6BAAqB,CAAC,CAAC;IAAA,CACnD,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { describe, expect, test } from \"bun:test\";\n\nimport {\n  DEFAULT_TASK_SETTINGS,\n  SYSTEM1_BASH_OUTPUT_COMPACTION_LIMITS,\n  TASK_SETTINGS_LIMITS,\n  normalizeTaskSettings,\n} from \"./tasks\";\n\ndescribe(\"normalizeTaskSettings\", () => {\n  test(\"fills defaults when missing\", () => {\n    expect(normalizeTaskSettings(undefined)).toEqual(DEFAULT_TASK_SETTINGS);\n    expect(normalizeTaskSettings({})).toEqual(DEFAULT_TASK_SETTINGS);\n  });\n\n  test(\"clamps values into valid ranges\", () => {\n    const normalized = normalizeTaskSettings({\n      maxParallelAgentTasks: 999,\n      maxTaskNestingDepth: 0,\n      bashOutputCompactionMinLines: -1,\n      bashOutputCompactionMinTotalBytes: 999999999999,\n      bashOutputCompactionMaxKeptLines: 0,\n      bashOutputCompactionTimeoutMs: 0,\n    });\n\n    expect(normalized.maxParallelAgentTasks).toBe(TASK_SETTINGS_LIMITS.maxParallelAgentTasks.max);\n    expect(normalized.maxTaskNestingDepth).toBe(TASK_SETTINGS_LIMITS.maxTaskNestingDepth.min);\n\n    expect(normalized.bashOutputCompactionMinLines).toBe(\n      SYSTEM1_BASH_OUTPUT_COMPACTION_LIMITS.bashOutputCompactionMinLines.min\n    );\n    expect(normalized.bashOutputCompactionMinTotalBytes).toBe(\n      SYSTEM1_BASH_OUTPUT_COMPACTION_LIMITS.bashOutputCompactionMinTotalBytes.max\n    );\n    expect(normalized.bashOutputCompactionMaxKeptLines).toBe(\n      SYSTEM1_BASH_OUTPUT_COMPACTION_LIMITS.bashOutputCompactionMaxKeptLines.min\n    );\n    expect(normalized.bashOutputCompactionTimeoutMs).toBe(\n      SYSTEM1_BASH_OUTPUT_COMPACTION_LIMITS.bashOutputCompactionTimeoutMs.min\n    );\n  });\n\n  test(\"uses fallbacks for NaN\", () => {\n    const normalized = normalizeTaskSettings({\n      maxParallelAgentTasks: Number.NaN,\n      maxTaskNestingDepth: Number.NaN,\n      bashOutputCompactionMinLines: Number.NaN,\n      bashOutputCompactionMinTotalBytes: Number.NaN,\n      bashOutputCompactionMaxKeptLines: Number.NaN,\n      bashOutputCompactionTimeoutMs: Number.NaN,\n    });\n\n    expect(normalized).toEqual(DEFAULT_TASK_SETTINGS);\n  });\n});\n"]}