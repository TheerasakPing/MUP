{"version":3,"file":"runtime.test.js","sourceRoot":"","sources":["../../../src/common/types/runtime.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, it, expect } from \"@jest/globals\";\r\nimport { parseRuntimeModeAndHost, buildRuntimeString, CODER_RUNTIME_PLACEHOLDER } from \"./runtime\";\r\n\r\ndescribe(\"parseRuntimeModeAndHost\", () => {\r\n  it(\"parses SSH mode with host\", () => {\r\n    expect(parseRuntimeModeAndHost(\"ssh user@host\")).toEqual({\r\n      mode: \"ssh\",\r\n      host: \"user@host\",\r\n    });\r\n  });\r\n\r\n  it(\"returns null for SSH mode without host\", () => {\r\n    expect(parseRuntimeModeAndHost(\"ssh\")).toBeNull();\r\n  });\r\n\r\n  it(\"returns null for SSH with trailing space but no host\", () => {\r\n    expect(parseRuntimeModeAndHost(\"ssh \")).toBeNull();\r\n  });\r\n\r\n  it(\"parses Docker mode with image\", () => {\r\n    expect(parseRuntimeModeAndHost(\"docker ubuntu:22.04\")).toEqual({\r\n      mode: \"docker\",\r\n      image: \"ubuntu:22.04\",\r\n    });\r\n  });\r\n\r\n  it(\"returns null for Docker mode without image\", () => {\r\n    expect(parseRuntimeModeAndHost(\"docker\")).toBeNull();\r\n  });\r\n\r\n  it(\"parses local mode\", () => {\r\n    expect(parseRuntimeModeAndHost(\"local\")).toEqual({\r\n      mode: \"local\",\r\n    });\r\n  });\r\n\r\n  it(\"parses worktree mode\", () => {\r\n    expect(parseRuntimeModeAndHost(\"worktree\")).toEqual({\r\n      mode: \"worktree\",\r\n    });\r\n  });\r\n\r\n  it(\"defaults to worktree for undefined\", () => {\r\n    expect(parseRuntimeModeAndHost(undefined)).toEqual({\r\n      mode: \"worktree\",\r\n    });\r\n  });\r\n\r\n  it(\"defaults to worktree for null\", () => {\r\n    expect(parseRuntimeModeAndHost(null)).toEqual({\r\n      mode: \"worktree\",\r\n    });\r\n  });\r\n\r\n  it(\"returns null for unrecognized runtime\", () => {\r\n    expect(parseRuntimeModeAndHost(\"unknown\")).toBeNull();\r\n  });\r\n});\r\n\r\ndescribe(\"buildRuntimeString\", () => {\r\n  it(\"builds SSH string with host\", () => {\r\n    expect(buildRuntimeString({ mode: \"ssh\", host: \"user@host\" })).toBe(\"ssh user@host\");\r\n  });\r\n\r\n  it(\"builds Docker string with image\", () => {\r\n    expect(buildRuntimeString({ mode: \"docker\", image: \"ubuntu:22.04\" })).toBe(\r\n      \"docker ubuntu:22.04\"\r\n    );\r\n  });\r\n\r\n  it(\"returns 'local' for local mode\", () => {\r\n    expect(buildRuntimeString({ mode: \"local\" })).toBe(\"local\");\r\n  });\r\n\r\n  it(\"returns undefined for worktree mode (default)\", () => {\r\n    expect(buildRuntimeString({ mode: \"worktree\" })).toBeUndefined();\r\n  });\r\n});\r\n\r\ndescribe(\"round-trip parsing and building\", () => {\r\n  it(\"preserves SSH mode with host\", () => {\r\n    const built = buildRuntimeString({ mode: \"ssh\", host: \"user@host\" });\r\n    const parsed = parseRuntimeModeAndHost(built);\r\n    expect(parsed).toEqual({ mode: \"ssh\", host: \"user@host\" });\r\n  });\r\n\r\n  it(\"preserves Docker mode with image\", () => {\r\n    const built = buildRuntimeString({ mode: \"docker\", image: \"node:20\" });\r\n    const parsed = parseRuntimeModeAndHost(built);\r\n    expect(parsed).toEqual({ mode: \"docker\", image: \"node:20\" });\r\n  });\r\n\r\n  it(\"preserves local mode\", () => {\r\n    const built = buildRuntimeString({ mode: \"local\" });\r\n    const parsed = parseRuntimeModeAndHost(built);\r\n    expect(parsed).toEqual({ mode: \"local\" });\r\n  });\r\n\r\n  it(\"preserves worktree mode\", () => {\r\n    const built = buildRuntimeString({ mode: \"worktree\" });\r\n    const parsed = parseRuntimeModeAndHost(built);\r\n    expect(parsed).toEqual({ mode: \"worktree\" });\r\n  });\r\n\r\n  it(\"preserves SSH mode with Coder placeholder\", () => {\r\n    // Coder SSH runtimes use placeholder host when no explicit SSH host is set\r\n    const built = buildRuntimeString({ mode: \"ssh\", host: CODER_RUNTIME_PLACEHOLDER });\r\n    const parsed = parseRuntimeModeAndHost(built);\r\n    expect(parsed).toEqual({ mode: \"ssh\", host: CODER_RUNTIME_PLACEHOLDER });\r\n  });\r\n});\r\n"]}