{"version":3,"file":"chatStats.js","sourceRoot":"","sources":["../../../../src/common/orpc/schemas/chatStats.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from \"zod\";\r\n\r\n/** Top file path entry for file_read/file_edit consumers */\r\nexport const TopFilePathSchema = z.object({\r\n  path: z.string().meta({ description: \"File path (relative or absolute)\" }),\r\n  tokens: z.number().meta({ description: \"Token count for this file\" }),\r\n});\r\n\r\nexport const TokenConsumerSchema = z.object({\r\n  name: z.string().meta({ description: '\"User\", \"Assistant\", \"bash\", \"readFile\", etc.' }),\r\n  tokens: z.number().meta({ description: \"Total token count for this consumer\" }),\r\n  percentage: z.number().meta({ description: \"% of total tokens\" }),\r\n  fixedTokens: z\r\n    .number()\r\n    .optional()\r\n    .meta({ description: \"Fixed overhead (e.g., tool definitions)\" }),\r\n  variableTokens: z\r\n    .number()\r\n    .optional()\r\n    .meta({ description: \"Variable usage (e.g., actual tool calls, text)\" }),\r\n});\r\n\r\nexport const ChatUsageComponentSchema = z.object({\r\n  tokens: z.number(),\r\n  cost_usd: z.number().optional(),\r\n});\r\n\r\nexport const ChatUsageDisplaySchema = z.object({\r\n  input: ChatUsageComponentSchema,\r\n  cached: ChatUsageComponentSchema,\r\n  cacheCreate: ChatUsageComponentSchema,\r\n  output: ChatUsageComponentSchema,\r\n  reasoning: ChatUsageComponentSchema,\r\n  model: z.string().optional(),\r\n});\r\n\r\nexport const ChatStatsSchema = z.object({\r\n  consumers: z.array(TokenConsumerSchema).meta({ description: \"Sorted descending by token count\" }),\r\n  totalTokens: z.number(),\r\n  model: z.string(),\r\n  tokenizerName: z.string().meta({ description: 'e.g., \"o200k_base\", \"claude\"' }),\r\n  usageHistory: z\r\n    .array(ChatUsageDisplaySchema)\r\n    .meta({ description: \"Ordered array of actual usage statistics from API responses\" }),\r\n  topFilePaths: z\r\n    .array(TopFilePathSchema)\r\n    .optional()\r\n    .meta({ description: \"Top 10 files by token count aggregated across all file tools\" }),\r\n});\r\n\r\n/**\r\n * Cached token statistics for consumer/file breakdown in the Costs tab.\r\n *\r\n * Stored inside session-usage.json to avoid re-tokenizing on every app start.\r\n */\r\nexport const SessionUsageTokenStatsCacheSchema = z.object({\r\n  version: z.literal(1),\r\n  computedAt: z.number().meta({ description: \"Unix timestamp (ms) when this cache was computed\" }),\r\n  model: z\r\n    .string()\r\n    .meta({ description: \"Model used for tokenization (affects tokenizer + tool definitions)\" }),\r\n  tokenizerName: z.string().meta({ description: 'e.g., \"o200k_base\", \"claude\"' }),\r\n  history: z.object({\r\n    messageCount: z.number().meta({ description: \"Number of messages used to compute this cache\" }),\r\n    maxHistorySequence: z\r\n      .number()\r\n      .optional()\r\n      .meta({ description: \"Max MuxMessage.metadata.historySequence seen in the message list\" }),\r\n  }),\r\n  consumers: z.array(TokenConsumerSchema).meta({ description: \"Sorted descending by token count\" }),\r\n  totalTokens: z.number(),\r\n  topFilePaths: z\r\n    .array(TopFilePathSchema)\r\n    .optional()\r\n    .meta({ description: \"Top 10 files by token count aggregated across all file tools\" }),\r\n});\r\n\r\n/**\r\n * Cumulative session usage file format.\r\n * Stored in ~/.mux/sessions/{workspaceId}/session-usage.json\r\n */\r\nexport const SessionUsageFileSchema = z.object({\r\n  byModel: z.record(z.string(), ChatUsageDisplaySchema),\r\n  lastRequest: z\r\n    .object({\r\n      model: z.string(),\r\n      usage: ChatUsageDisplaySchema,\r\n      timestamp: z.number(),\r\n    })\r\n    .optional(),\r\n  /**\r\n   * Idempotency ledger for rolled-up sub-agent usage.\r\n   * Key: child workspaceId, value: true.\r\n   */\r\n  rolledUpFrom: z.record(z.string(), z.literal(true)).optional(),\r\n  tokenStatsCache: SessionUsageTokenStatsCacheSchema.optional(),\r\n  version: z.literal(1),\r\n});\r\n"]}