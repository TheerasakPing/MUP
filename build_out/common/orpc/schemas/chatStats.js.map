{"version":3,"file":"chatStats.js","sourceRoot":"","sources":["../../../../src/common/orpc/schemas/chatStats.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from \"zod\";\n\n/** Top file path entry for file_read/file_edit consumers */\nexport const TopFilePathSchema = z.object({\n  path: z.string().meta({ description: \"File path (relative or absolute)\" }),\n  tokens: z.number().meta({ description: \"Token count for this file\" }),\n});\n\nexport const TokenConsumerSchema = z.object({\n  name: z.string().meta({ description: '\"User\", \"Assistant\", \"bash\", \"readFile\", etc.' }),\n  tokens: z.number().meta({ description: \"Total token count for this consumer\" }),\n  percentage: z.number().meta({ description: \"% of total tokens\" }),\n  fixedTokens: z\n    .number()\n    .optional()\n    .meta({ description: \"Fixed overhead (e.g., tool definitions)\" }),\n  variableTokens: z\n    .number()\n    .optional()\n    .meta({ description: \"Variable usage (e.g., actual tool calls, text)\" }),\n});\n\nexport const ChatUsageComponentSchema = z.object({\n  tokens: z.number(),\n  cost_usd: z.number().optional(),\n});\n\nexport const ChatUsageDisplaySchema = z.object({\n  input: ChatUsageComponentSchema,\n  cached: ChatUsageComponentSchema,\n  cacheCreate: ChatUsageComponentSchema,\n  output: ChatUsageComponentSchema,\n  reasoning: ChatUsageComponentSchema,\n  model: z.string().optional(),\n});\n\nexport const ChatStatsSchema = z.object({\n  consumers: z.array(TokenConsumerSchema).meta({ description: \"Sorted descending by token count\" }),\n  totalTokens: z.number(),\n  model: z.string(),\n  tokenizerName: z.string().meta({ description: 'e.g., \"o200k_base\", \"claude\"' }),\n  usageHistory: z\n    .array(ChatUsageDisplaySchema)\n    .meta({ description: \"Ordered array of actual usage statistics from API responses\" }),\n  topFilePaths: z\n    .array(TopFilePathSchema)\n    .optional()\n    .meta({ description: \"Top 10 files by token count aggregated across all file tools\" }),\n});\n\n/**\n * Cached token statistics for consumer/file breakdown in the Costs tab.\n *\n * Stored inside session-usage.json to avoid re-tokenizing on every app start.\n */\nexport const SessionUsageTokenStatsCacheSchema = z.object({\n  version: z.literal(1),\n  computedAt: z.number().meta({ description: \"Unix timestamp (ms) when this cache was computed\" }),\n  model: z\n    .string()\n    .meta({ description: \"Model used for tokenization (affects tokenizer + tool definitions)\" }),\n  tokenizerName: z.string().meta({ description: 'e.g., \"o200k_base\", \"claude\"' }),\n  history: z.object({\n    messageCount: z.number().meta({ description: \"Number of messages used to compute this cache\" }),\n    maxHistorySequence: z\n      .number()\n      .optional()\n      .meta({ description: \"Max MuxMessage.metadata.historySequence seen in the message list\" }),\n  }),\n  consumers: z.array(TokenConsumerSchema).meta({ description: \"Sorted descending by token count\" }),\n  totalTokens: z.number(),\n  topFilePaths: z\n    .array(TopFilePathSchema)\n    .optional()\n    .meta({ description: \"Top 10 files by token count aggregated across all file tools\" }),\n});\n\n/**\n * Cumulative session usage file format.\n * Stored in ~/.mux/sessions/{workspaceId}/session-usage.json\n */\nexport const SessionUsageFileSchema = z.object({\n  byModel: z.record(z.string(), ChatUsageDisplaySchema),\n  lastRequest: z\n    .object({\n      model: z.string(),\n      usage: ChatUsageDisplaySchema,\n      timestamp: z.number(),\n    })\n    .optional(),\n  /**\n   * Idempotency ledger for rolled-up sub-agent usage.\n   * Key: child workspaceId, value: true.\n   */\n  rolledUpFrom: z.record(z.string(), z.literal(true)).optional(),\n  tokenStatsCache: SessionUsageTokenStatsCacheSchema.optional(),\n  version: z.literal(1),\n});\n"]}