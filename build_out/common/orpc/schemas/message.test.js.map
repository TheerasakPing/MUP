{"version":3,"file":"message.test.js","sourceRoot":"","sources":["../../../../src/common/orpc/schemas/message.test.ts"],"names":[],"mappings":";;AAAA,uCAAkD;AAClD,uCAA6C;AAE7C,SAAS,aAAa,GAAG;IACvB,OAAO;QACL,EAAE,EAAE,OAAO;QACX,IAAI,EAAE,WAAoB;QAC1B,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,MAAe,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;KAClD,CAAC;AAAA,CACH;AAED,IAAA,mBAAQ,EAAC,0CAA0C,EAAE,GAAG,EAAE,CAAC;IACzD,IAAA,eAAI,EAAC,kDAAkD,EAAE,GAAG,EAAE,CAAC;QAC7D,MAAM,MAAM,GAAG,0BAAgB,CAAC,KAAK,CAAC;YACpC,GAAG,aAAa,EAAE;YAClB,QAAQ,EAAE;gBACR,eAAe,EAAE,CAAC;aACnB;SACF,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,QAAQ,EAAE,eAAe,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAAA,CAClD,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,uEAAuE,EAAE,GAAG,EAAE,CAAC;QAClF,MAAM,8BAA8B,GAAc;YAChD,CAAC;YACD,CAAC,CAAC;YACF,GAAG;YACH,MAAM,CAAC,GAAG;YACV,MAAM,CAAC,iBAAiB;YACxB,GAAG;YACH,IAAI;YACJ,IAAI;YACJ,EAAE;YACF,EAAE;SACH,CAAC;QAEF,KAAK,MAAM,wBAAwB,IAAI,8BAA8B,EAAE,CAAC;YACtE,MAAM,MAAM,GAAG,0BAAgB,CAAC,KAAK,CAAC;gBACpC,GAAG,aAAa,EAAE;gBAClB,QAAQ,EAAE;oBACR,eAAe,EAAE,wBAAwB;iBAC1C;aACF,CAAC,CAAC;YAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,QAAQ,EAAE,eAAe,CAAC,CAAC,aAAa,EAAE,CAAC;QAC3D,CAAC;IAAA,CACF,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { describe, expect, test } from \"bun:test\";\nimport { MuxMessageSchema } from \"./message\";\n\nfunction createMessage() {\n  return {\n    id: \"msg-1\",\n    role: \"assistant\" as const,\n    parts: [{ type: \"text\" as const, text: \"Hello\" }],\n  };\n}\n\ndescribe(\"MuxMessageSchema compactionEpoch parsing\", () => {\n  test(\"preserves valid positive integer compactionEpoch\", () => {\n    const parsed = MuxMessageSchema.parse({\n      ...createMessage(),\n      metadata: {\n        compactionEpoch: 7,\n      },\n    });\n\n    expect(parsed.metadata?.compactionEpoch).toBe(7);\n  });\n\n  test(\"tolerates malformed compactionEpoch values by treating them as absent\", () => {\n    const malformedCompactionEpochValues: unknown[] = [\n      0,\n      -1,\n      1.5,\n      Number.NaN,\n      Number.POSITIVE_INFINITY,\n      \"7\",\n      null,\n      true,\n      {},\n      [],\n    ];\n\n    for (const malformedCompactionEpoch of malformedCompactionEpochValues) {\n      const parsed = MuxMessageSchema.parse({\n        ...createMessage(),\n        metadata: {\n          compactionEpoch: malformedCompactionEpoch,\n        },\n      });\n\n      expect(parsed.metadata?.compactionEpoch).toBeUndefined();\n    }\n  });\n});\n"]}