{"version":3,"file":"message.test.js","sourceRoot":"","sources":["../../../../src/common/orpc/schemas/message.test.ts"],"names":[],"mappings":";;AAAA,uCAAkD;AAClD,uCAA6C;AAE7C,SAAS,aAAa,GAAG;IACvB,OAAO;QACL,EAAE,EAAE,OAAO;QACX,IAAI,EAAE,WAAoB;QAC1B,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,MAAe,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;KAClD,CAAC;AAAA,CACH;AAED,IAAA,mBAAQ,EAAC,0CAA0C,EAAE,GAAG,EAAE,CAAC;IACzD,IAAA,eAAI,EAAC,kDAAkD,EAAE,GAAG,EAAE,CAAC;QAC7D,MAAM,MAAM,GAAG,0BAAgB,CAAC,KAAK,CAAC;YACpC,GAAG,aAAa,EAAE;YAClB,QAAQ,EAAE;gBACR,eAAe,EAAE,CAAC;aACnB;SACF,CAAC,CAAC;QAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,QAAQ,EAAE,eAAe,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAAA,CAClD,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,uEAAuE,EAAE,GAAG,EAAE,CAAC;QAClF,MAAM,8BAA8B,GAAc;YAChD,CAAC;YACD,CAAC,CAAC;YACF,GAAG;YACH,MAAM,CAAC,GAAG;YACV,MAAM,CAAC,iBAAiB;YACxB,GAAG;YACH,IAAI;YACJ,IAAI;YACJ,EAAE;YACF,EAAE;SACH,CAAC;QAEF,KAAK,MAAM,wBAAwB,IAAI,8BAA8B,EAAE,CAAC;YACtE,MAAM,MAAM,GAAG,0BAAgB,CAAC,KAAK,CAAC;gBACpC,GAAG,aAAa,EAAE;gBAClB,QAAQ,EAAE;oBACR,eAAe,EAAE,wBAAwB;iBAC1C;aACF,CAAC,CAAC;YAEH,IAAA,iBAAM,EAAC,MAAM,CAAC,QAAQ,EAAE,eAAe,CAAC,CAAC,aAAa,EAAE,CAAC;QAC3D,CAAC;IAAA,CACF,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { describe, expect, test } from \"bun:test\";\r\nimport { MuxMessageSchema } from \"./message\";\r\n\r\nfunction createMessage() {\r\n  return {\r\n    id: \"msg-1\",\r\n    role: \"assistant\" as const,\r\n    parts: [{ type: \"text\" as const, text: \"Hello\" }],\r\n  };\r\n}\r\n\r\ndescribe(\"MuxMessageSchema compactionEpoch parsing\", () => {\r\n  test(\"preserves valid positive integer compactionEpoch\", () => {\r\n    const parsed = MuxMessageSchema.parse({\r\n      ...createMessage(),\r\n      metadata: {\r\n        compactionEpoch: 7,\r\n      },\r\n    });\r\n\r\n    expect(parsed.metadata?.compactionEpoch).toBe(7);\r\n  });\r\n\r\n  test(\"tolerates malformed compactionEpoch values by treating them as absent\", () => {\r\n    const malformedCompactionEpochValues: unknown[] = [\r\n      0,\r\n      -1,\r\n      1.5,\r\n      Number.NaN,\r\n      Number.POSITIVE_INFINITY,\r\n      \"7\",\r\n      null,\r\n      true,\r\n      {},\r\n      [],\r\n    ];\r\n\r\n    for (const malformedCompactionEpoch of malformedCompactionEpochValues) {\r\n      const parsed = MuxMessageSchema.parse({\r\n        ...createMessage(),\r\n        metadata: {\r\n          compactionEpoch: malformedCompactionEpoch,\r\n        },\r\n      });\r\n\r\n      expect(parsed.metadata?.compactionEpoch).toBeUndefined();\r\n    }\r\n  });\r\n});\r\n"]}