{"version":3,"file":"workspace.js","sourceRoot":"","sources":["../../../../src/common/orpc/schemas/workspace.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from \"zod\";\r\nimport { RuntimeConfigSchema } from \"./runtime\";\r\nimport { WorkspaceAISettingsByAgentSchema, WorkspaceAISettingsSchema } from \"./workspaceAiSettings\";\r\n\r\nconst ThinkingLevelSchema = z.enum([\"off\", \"low\", \"medium\", \"high\", \"xhigh\", \"max\"]);\r\n\r\nexport const WorkspaceMetadataSchema = z.object({\r\n  id: z.string().meta({\r\n    description:\r\n      \"Stable unique identifier (10 hex chars for new workspaces, legacy format for old)\",\r\n  }),\r\n  name: z.string().meta({\r\n    description: 'Git branch / directory name (e.g., \"plan-a1b2\") - used for path computation',\r\n  }),\r\n  title: z.string().optional().meta({\r\n    description:\r\n      'Human-readable workspace title (e.g., \"Fix plan mode over SSH\") - optional for legacy workspaces',\r\n  }),\r\n  projectName: z\r\n    .string()\r\n    .meta({ description: \"Project name extracted from project path (for display)\" }),\r\n  projectPath: z\r\n    .string()\r\n    .meta({ description: \"Absolute path to the project (needed to compute workspace path)\" }),\r\n  createdAt: z.string().optional().meta({\r\n    description:\r\n      \"ISO 8601 timestamp of when workspace was created (optional for backward compatibility)\",\r\n  }),\r\n  aiSettingsByAgent: WorkspaceAISettingsByAgentSchema.optional().meta({\r\n    description: \"Per-agent AI settings persisted in config\",\r\n  }),\r\n  runtimeConfig: RuntimeConfigSchema.meta({\r\n    description: \"Runtime configuration for this workspace (always set, defaults to local on load)\",\r\n  }),\r\n  aiSettings: WorkspaceAISettingsSchema.optional().meta({\r\n    description: \"Workspace-scoped AI settings (model + thinking level) persisted in config\",\r\n  }),\r\n  parentWorkspaceId: z.string().optional().meta({\r\n    description:\r\n      \"If set, this workspace is a child workspace spawned from the parent workspaceId (enables nesting in UI and backend orchestration).\",\r\n  }),\r\n  agentType: z.string().optional().meta({\r\n    description: 'If set, selects an agent preset for this workspace (e.g., \"explore\" or \"exec\").',\r\n  }),\r\n  agentId: z.string().optional().meta({\r\n    description:\r\n      'If set, selects an agent definition for this workspace (e.g., \"explore\" or \"exec\").',\r\n  }),\r\n  taskStatus: z.enum([\"queued\", \"running\", \"awaiting_report\", \"reported\"]).optional().meta({\r\n    description:\r\n      \"Agent task lifecycle status for child workspaces (queued|running|awaiting_report|reported).\",\r\n  }),\r\n  reportedAt: z.string().optional().meta({\r\n    description: \"ISO 8601 timestamp for when an agent task reported completion (optional).\",\r\n  }),\r\n  taskModelString: z.string().optional().meta({\r\n    description: \"Model string used to run this agent task (used for restart-safe resumptions).\",\r\n  }),\r\n  taskThinkingLevel: ThinkingLevelSchema.optional().meta({\r\n    description: \"Thinking level used for this agent task (used for restart-safe resumptions).\",\r\n  }),\r\n  taskPrompt: z.string().optional().meta({\r\n    description:\r\n      \"Initial prompt for a queued agent task (persisted only until the task actually starts).\",\r\n  }),\r\n  taskTrunkBranch: z.string().optional().meta({\r\n    description:\r\n      \"Trunk branch used to create/init this agent task workspace (used for restart-safe init on queued tasks).\",\r\n  }),\r\n  archivedAt: z.string().optional().meta({\r\n    description:\r\n      \"ISO 8601 timestamp when workspace was last archived. Workspace is considered archived if archivedAt > unarchivedAt (or unarchivedAt is absent).\",\r\n  }),\r\n  unarchivedAt: z.string().optional().meta({\r\n    description:\r\n      \"ISO 8601 timestamp when workspace was last unarchived. Used for recency calculation to bump restored workspaces to top.\",\r\n  }),\r\n  sectionId: z.string().optional().meta({\r\n    description: \"ID of the section this workspace belongs to (optional, unsectioned if absent)\",\r\n  }),\r\n});\r\n\r\nexport const FrontendWorkspaceMetadataSchema = WorkspaceMetadataSchema.extend({\r\n  namedWorkspacePath: z\r\n    .string()\r\n    .meta({ description: \"Worktree path (uses workspace name as directory)\" }),\r\n  incompatibleRuntime: z.string().optional().meta({\r\n    description:\r\n      \"If set, this workspace has an incompatible runtime configuration (e.g., from a newer version of mux). The workspace should be displayed but interactions should show this error message.\",\r\n  }),\r\n  isRemoving: z.boolean().optional().meta({\r\n    description: \"True if this workspace is currently being deleted (deletion in progress).\",\r\n  }),\r\n  isInitializing: z.boolean().optional().meta({\r\n    description:\r\n      \"True if this workspace is currently initializing (postCreateSetup or initWorkspace running).\",\r\n  }),\r\n});\r\n\r\nexport const WorkspaceActivitySnapshotSchema = z.object({\r\n  recency: z.number().meta({ description: \"Unix ms timestamp of last user interaction\" }),\r\n  streaming: z.boolean().meta({ description: \"Whether workspace currently has an active stream\" }),\r\n  lastModel: z.string().nullable().meta({ description: \"Last model sent from this workspace\" }),\r\n  lastThinkingLevel: ThinkingLevelSchema.nullable().meta({\r\n    description: \"Last thinking/reasoning level used in this workspace\",\r\n  }),\r\n});\r\n\r\nexport const PostCompactionStateSchema = z.object({\r\n  planPath: z.string().nullable(),\r\n  trackedFilePaths: z.array(z.string()),\r\n  excludedItems: z.array(z.string()),\r\n});\r\n\r\nexport const GitStatusSchema = z.object({\r\n  /** Current HEAD branch name (empty string if detached HEAD or not a git repo) */\r\n  branch: z.string(),\r\n  /** Commit divergence relative to origin's primary branch */\r\n  ahead: z.number(),\r\n  behind: z.number(),\r\n  dirty: z\r\n    .boolean()\r\n    .meta({ description: \"Whether there are uncommitted changes (staged or unstaged)\" }),\r\n\r\n  /**\r\n   * Line deltas for changes unique to this workspace.\r\n   * Computed vs the merge-base with origin's primary branch.\r\n   *\r\n   * Note: outgoing includes committed changes + uncommitted changes (working tree).\r\n   */\r\n  outgoingAdditions: z.number(),\r\n  outgoingDeletions: z.number(),\r\n\r\n  /** Line deltas for changes that exist on origin's primary branch but not locally */\r\n  incomingAdditions: z.number(),\r\n  incomingDeletions: z.number(),\r\n});\r\n"]}