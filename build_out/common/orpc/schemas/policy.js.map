{"version":3,"file":"policy.js","sourceRoot":"","sources":["../../../../src/common/orpc/schemas/policy.ts"],"names":[],"mappings":";;;AAAA,6BAAwB;AACxB,4DAAsF;AAEzE,QAAA,yBAAyB,GAAG,OAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;AAG7C,QAAA,wBAAwB,GAAG,OAAC,CAAC,IAAI,CAC5C,+BAAwD,CACzD,CAAC;AAGW,QAAA,0BAA0B,GAAG,OAAC;KACxC,MAAM,CAAC;IACN,EAAE,EAAE,QAAA,wBAAwB;IAC5B,wCAAwC;IACxC,QAAQ,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IAC/B,qCAAqC;IACrC,YAAY,EAAE,OAAC,CAAC,KAAK,CAAC,OAAC,CAAC,MAAM,EAAE,CAAC,CAAC,QAAQ,EAAE;CAC7C,CAAC;KACD,MAAM,EAAE,CAAC;AAGC,QAAA,+BAA+B,GAAG,OAAC;KAC7C,MAAM,CAAC;IACN,KAAK,EAAE,OAAC,CAAC,OAAO,EAAE;IAClB,MAAM,EAAE,OAAC,CAAC,OAAO,EAAE;CACpB,CAAC;KACD,MAAM,EAAE,CAAC;AAGC,QAAA,iBAAiB,GAAG,OAAC;KAC/B,MAAM,CAAC;IACN,sBAAsB,EAAE,QAAA,+BAA+B,CAAC,QAAQ,EAAE;CACnE,CAAC;KACD,MAAM,EAAE,CAAC;AAGC,QAAA,qBAAqB,GAAG,OAAC,CAAC,IAAI,CAAC;IAC1C,OAAO;IACP,UAAU;IACV,KAAK;IACL,WAAW;IACX,QAAQ;IACR,cAAc;CACf,CAAC,CAAC;AAGU,QAAA,yBAAyB,GAAG,OAAC;KACvC,MAAM,CAAC;IACN,EAAE,EAAE,QAAA,qBAAqB;CAC1B,CAAC;KACD,MAAM,EAAE,CAAC;AAGC,QAAA,gBAAgB,GAAG,OAAC;KAC9B,MAAM,CAAC;IACN,qBAAqB,EAAE,QAAA,yBAAyB;IAChD,cAAc,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IACrC,sBAAsB,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IAE7C,qCAAqC;IACrC,eAAe,EAAE,OAAC,CAAC,KAAK,CAAC,QAAA,0BAA0B,CAAC,CAAC,QAAQ,EAAE;IAE/D,KAAK,EAAE,QAAA,iBAAiB,CAAC,QAAQ,EAAE;IAEnC,qCAAqC;IACrC,QAAQ,EAAE,OAAC,CAAC,KAAK,CAAC,QAAA,yBAAyB,CAAC,CAAC,QAAQ,EAAE;CACxD,CAAC;KACD,MAAM,EAAE,CAAC;AAGC,QAAA,kBAAkB,GAAG,OAAC;KAChC,MAAM,CAAC;IACN,KAAK,EAAE,OAAC,CAAC,IAAI,CAAC,CAAC,UAAU,EAAE,UAAU,EAAE,SAAS,CAAC,CAAC;IAClD,MAAM,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;CAC9B,CAAC;KACD,MAAM,EAAE,CAAC;AAGC,QAAA,kBAAkB,GAAG,OAAC,CAAC,IAAI,CAAC,CAAC,MAAM,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC,CAAC;AAGzD,QAAA,mCAAmC,GAAG,OAAC;KACjD,MAAM,CAAC;IACN,EAAE,EAAE,QAAA,wBAAwB;IAC5B,aAAa,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IACpC,4CAA4C;IAC5C,aAAa,EAAE,OAAC,CAAC,KAAK,CAAC,OAAC,CAAC,MAAM,EAAE,CAAC,CAAC,QAAQ,EAAE,CAAC,QAAQ,EAAE;CACzD,CAAC;KACD,MAAM,EAAE,CAAC;AAEC,QAAA,qBAAqB,GAAG,OAAC;KACnC,MAAM,CAAC;IACN,mBAAmB,EAAE,QAAA,yBAAyB;IAC9C,aAAa,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IACpC,oBAAoB,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IAE3C,oCAAoC;IACpC,cAAc,EAAE,OAAC,CAAC,KAAK,CAAC,QAAA,mCAAmC,CAAC,CAAC,QAAQ,EAAE;IAEvE,GAAG,EAAE,OAAC;SACH,MAAM,CAAC;QACN,gBAAgB,EAAE,OAAC,CAAC,MAAM,CAAC,EAAE,KAAK,EAAE,OAAC,CAAC,OAAO,EAAE,EAAE,MAAM,EAAE,OAAC,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,MAAM,EAAE;KACjF,CAAC;SACD,MAAM,EAAE;IAEX,mCAAmC;IACnC,QAAQ,EAAE,OAAC,CAAC,KAAK,CAAC,QAAA,qBAAqB,CAAC,CAAC,QAAQ,EAAE;CACpD,CAAC;KACD,MAAM,EAAE,CAAC;AAGC,QAAA,uBAAuB,GAAG,OAAC;KACrC,MAAM,CAAC;IACN,MAAM,EAAE,QAAA,kBAAkB;IAC1B,MAAM,EAAE,QAAA,kBAAkB;IAC1B,MAAM,EAAE,QAAA,qBAAqB,CAAC,QAAQ,EAAE;CACzC,CAAC;KACD,MAAM,EAAE,CAAC","sourcesContent":["import { z } from \"zod\";\r\nimport { SUPPORTED_PROVIDERS, type ProviderName } from \"@/common/constants/providers\";\r\n\r\nexport const PolicyFormatVersionSchema = z.literal(\"0.1\");\r\nexport type PolicyFormatVersion = z.infer<typeof PolicyFormatVersionSchema>;\r\n\r\nexport const PolicyProviderNameSchema = z.enum(\r\n  SUPPORTED_PROVIDERS as [ProviderName, ...ProviderName[]]\r\n);\r\nexport type PolicyProviderName = z.infer<typeof PolicyProviderNameSchema>;\r\n\r\nexport const PolicyProviderAccessSchema = z\r\n  .object({\r\n    id: PolicyProviderNameSchema,\r\n    // Empty/undefined means \"do not force\".\r\n    base_url: z.string().optional(),\r\n    // Empty/undefined means \"allow all\".\r\n    model_access: z.array(z.string()).optional(),\r\n  })\r\n  .strict();\r\nexport type PolicyProviderAccess = z.infer<typeof PolicyProviderAccessSchema>;\r\n\r\nexport const PolicyAllowUserDefinedMCPSchema = z\r\n  .object({\r\n    stdio: z.boolean(),\r\n    remote: z.boolean(),\r\n  })\r\n  .strict();\r\nexport type PolicyAllowUserDefinedMCP = z.infer<typeof PolicyAllowUserDefinedMCPSchema>;\r\n\r\nexport const PolicyToolsSchema = z\r\n  .object({\r\n    allow_user_defined_mcp: PolicyAllowUserDefinedMCPSchema.optional(),\r\n  })\r\n  .strict();\r\nexport type PolicyTools = z.infer<typeof PolicyToolsSchema>;\r\n\r\nexport const PolicyRuntimeIdSchema = z.enum([\r\n  \"local\",\r\n  \"worktree\",\r\n  \"ssh\",\r\n  \"ssh+coder\",\r\n  \"docker\",\r\n  \"devcontainer\",\r\n]);\r\nexport type PolicyRuntimeId = z.infer<typeof PolicyRuntimeIdSchema>;\r\n\r\nexport const PolicyRuntimeAccessSchema = z\r\n  .object({\r\n    id: PolicyRuntimeIdSchema,\r\n  })\r\n  .strict();\r\nexport type PolicyRuntimeAccess = z.infer<typeof PolicyRuntimeAccessSchema>;\r\n\r\nexport const PolicyFileSchema = z\r\n  .object({\r\n    policy_format_version: PolicyFormatVersionSchema,\r\n    server_version: z.string().optional(),\r\n    minimum_client_version: z.string().optional(),\r\n\r\n    // Empty/undefined means \"allow all\".\r\n    provider_access: z.array(PolicyProviderAccessSchema).optional(),\r\n\r\n    tools: PolicyToolsSchema.optional(),\r\n\r\n    // Empty/undefined means \"allow all\".\r\n    runtimes: z.array(PolicyRuntimeAccessSchema).optional(),\r\n  })\r\n  .strict();\r\nexport type PolicyFile = z.infer<typeof PolicyFileSchema>;\r\n\r\nexport const PolicyStatusSchema = z\r\n  .object({\r\n    state: z.enum([\"disabled\", \"enforced\", \"blocked\"]),\r\n    reason: z.string().optional(),\r\n  })\r\n  .strict();\r\nexport type PolicyStatus = z.infer<typeof PolicyStatusSchema>;\r\n\r\nexport const PolicySourceSchema = z.enum([\"none\", \"env\", \"governor\"]);\r\nexport type PolicySource = z.infer<typeof PolicySourceSchema>;\r\n\r\nexport const EffectivePolicyProviderAccessSchema = z\r\n  .object({\r\n    id: PolicyProviderNameSchema,\r\n    forcedBaseUrl: z.string().optional(),\r\n    // null means \"allow all\" for that provider.\r\n    allowedModels: z.array(z.string()).nullable().optional(),\r\n  })\r\n  .strict();\r\n\r\nexport const EffectivePolicySchema = z\r\n  .object({\r\n    policyFormatVersion: PolicyFormatVersionSchema,\r\n    serverVersion: z.string().optional(),\r\n    minimumClientVersion: z.string().optional(),\r\n\r\n    // null means \"allow all providers\".\r\n    providerAccess: z.array(EffectivePolicyProviderAccessSchema).nullable(),\r\n\r\n    mcp: z\r\n      .object({\r\n        allowUserDefined: z.object({ stdio: z.boolean(), remote: z.boolean() }).strict(),\r\n      })\r\n      .strict(),\r\n\r\n    // null means \"allow all runtimes\".\r\n    runtimes: z.array(PolicyRuntimeIdSchema).nullable(),\r\n  })\r\n  .strict();\r\nexport type EffectivePolicy = z.infer<typeof EffectivePolicySchema>;\r\n\r\nexport const PolicyGetResponseSchema = z\r\n  .object({\r\n    source: PolicySourceSchema,\r\n    status: PolicyStatusSchema,\r\n    policy: EffectivePolicySchema.nullable(),\r\n  })\r\n  .strict();\r\nexport type PolicyGetResponse = z.infer<typeof PolicyGetResponseSchema>;\r\n"]}