{"version":3,"file":"policy.js","sourceRoot":"","sources":["../../../../src/common/orpc/schemas/policy.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from \"zod\";\nimport { SUPPORTED_PROVIDERS, type ProviderName } from \"@/common/constants/providers\";\n\nexport const PolicyFormatVersionSchema = z.literal(\"0.1\");\nexport type PolicyFormatVersion = z.infer<typeof PolicyFormatVersionSchema>;\n\nexport const PolicyProviderNameSchema = z.enum(\n  SUPPORTED_PROVIDERS as [ProviderName, ...ProviderName[]]\n);\nexport type PolicyProviderName = z.infer<typeof PolicyProviderNameSchema>;\n\nexport const PolicyProviderAccessSchema = z\n  .object({\n    id: PolicyProviderNameSchema,\n    // Empty/undefined means \"do not force\".\n    base_url: z.string().optional(),\n    // Empty/undefined means \"allow all\".\n    model_access: z.array(z.string()).optional(),\n  })\n  .strict();\nexport type PolicyProviderAccess = z.infer<typeof PolicyProviderAccessSchema>;\n\nexport const PolicyAllowUserDefinedMCPSchema = z\n  .object({\n    stdio: z.boolean(),\n    remote: z.boolean(),\n  })\n  .strict();\nexport type PolicyAllowUserDefinedMCP = z.infer<typeof PolicyAllowUserDefinedMCPSchema>;\n\nexport const PolicyToolsSchema = z\n  .object({\n    allow_user_defined_mcp: PolicyAllowUserDefinedMCPSchema.optional(),\n  })\n  .strict();\nexport type PolicyTools = z.infer<typeof PolicyToolsSchema>;\n\nexport const PolicyRuntimeIdSchema = z.enum([\n  \"local\",\n  \"worktree\",\n  \"ssh\",\n  \"ssh+coder\",\n  \"docker\",\n  \"devcontainer\",\n]);\nexport type PolicyRuntimeId = z.infer<typeof PolicyRuntimeIdSchema>;\n\nexport const PolicyRuntimeAccessSchema = z\n  .object({\n    id: PolicyRuntimeIdSchema,\n  })\n  .strict();\nexport type PolicyRuntimeAccess = z.infer<typeof PolicyRuntimeAccessSchema>;\n\nexport const PolicyFileSchema = z\n  .object({\n    policy_format_version: PolicyFormatVersionSchema,\n    server_version: z.string().optional(),\n    minimum_client_version: z.string().optional(),\n\n    // Empty/undefined means \"allow all\".\n    provider_access: z.array(PolicyProviderAccessSchema).optional(),\n\n    tools: PolicyToolsSchema.optional(),\n\n    // Empty/undefined means \"allow all\".\n    runtimes: z.array(PolicyRuntimeAccessSchema).optional(),\n  })\n  .strict();\nexport type PolicyFile = z.infer<typeof PolicyFileSchema>;\n\nexport const PolicyStatusSchema = z\n  .object({\n    state: z.enum([\"disabled\", \"enforced\", \"blocked\"]),\n    reason: z.string().optional(),\n  })\n  .strict();\nexport type PolicyStatus = z.infer<typeof PolicyStatusSchema>;\n\nexport const PolicySourceSchema = z.enum([\"none\", \"env\", \"governor\"]);\nexport type PolicySource = z.infer<typeof PolicySourceSchema>;\n\nexport const EffectivePolicyProviderAccessSchema = z\n  .object({\n    id: PolicyProviderNameSchema,\n    forcedBaseUrl: z.string().optional(),\n    // null means \"allow all\" for that provider.\n    allowedModels: z.array(z.string()).nullable().optional(),\n  })\n  .strict();\n\nexport const EffectivePolicySchema = z\n  .object({\n    policyFormatVersion: PolicyFormatVersionSchema,\n    serverVersion: z.string().optional(),\n    minimumClientVersion: z.string().optional(),\n\n    // null means \"allow all providers\".\n    providerAccess: z.array(EffectivePolicyProviderAccessSchema).nullable(),\n\n    mcp: z\n      .object({\n        allowUserDefined: z.object({ stdio: z.boolean(), remote: z.boolean() }).strict(),\n      })\n      .strict(),\n\n    // null means \"allow all runtimes\".\n    runtimes: z.array(PolicyRuntimeIdSchema).nullable(),\n  })\n  .strict();\nexport type EffectivePolicy = z.infer<typeof EffectivePolicySchema>;\n\nexport const PolicyGetResponseSchema = z\n  .object({\n    source: PolicySourceSchema,\n    status: PolicyStatusSchema,\n    policy: EffectivePolicySchema.nullable(),\n  })\n  .strict();\nexport type PolicyGetResponse = z.infer<typeof PolicyGetResponseSchema>;\n"]}