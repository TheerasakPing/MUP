{"version":3,"file":"agentDefinition.js","sourceRoot":"","sources":["../../../../src/common/orpc/schemas/agentDefinition.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from \"zod\";\r\n\r\nexport const AgentDefinitionScopeSchema = z.enum([\"built-in\", \"project\", \"global\"]);\r\n\r\n// Agent IDs come from filenames (<agentId>.md).\r\n// Keep constraints conservative so IDs are safe to use in storage keys, URLs, etc.\r\nexport const AgentIdSchema = z\r\n  .string()\r\n  .min(1)\r\n  .max(64)\r\n  .regex(/^[a-z0-9]+(?:[a-z0-9_-]*[a-z0-9])?$/);\r\n\r\nconst AgentDefinitionUiRequirementSchema = z.enum([\"plan\"]);\r\nconst ThinkingLevelSchema = z.enum([\"off\", \"low\", \"medium\", \"high\", \"xhigh\", \"max\"]);\r\n\r\nconst AgentDefinitionUiSchema = z\r\n  .object({\r\n    // New: hidden is opt-out. Default: visible.\r\n    hidden: z.boolean().optional(),\r\n\r\n    // Legacy: selectable was opt-in. Keep for backwards compatibility.\r\n    selectable: z.boolean().optional(),\r\n\r\n    // When true, completely hides this agent (useful for disabling built-ins)\r\n    disabled: z.boolean().optional(),\r\n\r\n    // UI color (CSS color value). Inherited from base agent if not specified.\r\n    color: z.string().min(1).optional(),\r\n\r\n    // Requirements for this agent to be selectable in the UI.\r\n    // Enforced in agents.list by toggling uiSelectable.\r\n    requires: z.array(AgentDefinitionUiRequirementSchema).min(1).optional(),\r\n  })\r\n  .strip();\r\n\r\nconst AgentDefinitionSubagentSchema = z\r\n  .object({\r\n    runnable: z.boolean().optional(),\r\n    // Instructions appended when this agent runs as a subagent (child workspace)\r\n    append_prompt: z.string().min(1).optional(),\r\n    // When true, do not run the project's .mux/init hook for this sub-agent.\r\n    // NOTE: This skips only the hook execution, not runtime provisioning (e.g. SSH sync, Docker setup).\r\n    skip_init_hook: z.boolean().optional(),\r\n  })\r\n  .strip();\r\n\r\nconst AgentDefinitionAiDefaultsSchema = z\r\n  .object({\r\n    // Model identifier: full string (e.g. \"anthropic:claude-sonnet-4-5\") or abbreviation (e.g. \"sonnet\")\r\n    model: z.string().min(1).optional(),\r\n    thinkingLevel: ThinkingLevelSchema.optional(),\r\n  })\r\n  .strip();\r\n\r\nconst AgentDefinitionPromptSchema = z\r\n  .object({\r\n    // When true, append this agent's body to the base agent's body (default: false = replace)\r\n    append: z.boolean().optional(),\r\n  })\r\n  .strip();\r\n\r\n// Tool configuration: add/remove patterns (regex).\r\n// Layers are processed in order during inheritance (base first, then child).\r\nconst AgentDefinitionToolsSchema = z\r\n  .object({\r\n    // Patterns to add (enable). Processed before remove.\r\n    add: z.array(z.string().min(1)).optional(),\r\n    // Patterns to remove (disable). Processed after add.\r\n    remove: z.array(z.string().min(1)).optional(),\r\n  })\r\n  .strip();\r\n\r\nexport const AgentDefinitionFrontmatterSchema = z\r\n  .object({\r\n    name: z.string().min(1).max(128),\r\n    description: z.string().min(1).max(1024).optional(),\r\n\r\n    // Inheritance: reference a built-in or custom agent ID\r\n    base: AgentIdSchema.optional(),\r\n\r\n    // When true, this agent is disabled by default.\r\n    //\r\n    // Notes:\r\n    // - This is a top-level flag (separate from ui.disabled) so repos can ship agents that are\r\n    //   present on disk but opt-in.\r\n    // - When both are set, `disabled` takes precedence over `ui.disabled`.\r\n    disabled: z.boolean().optional(),\r\n\r\n    // UI metadata (color, visibility, etc.)\r\n    ui: AgentDefinitionUiSchema.optional(),\r\n\r\n    // Prompt behavior configuration\r\n    prompt: AgentDefinitionPromptSchema.optional(),\r\n\r\n    subagent: AgentDefinitionSubagentSchema.optional(),\r\n\r\n    ai: AgentDefinitionAiDefaultsSchema.optional(),\r\n\r\n    // Tool configuration: add/remove patterns (regex).\r\n    // If omitted and no base, no tools are available.\r\n    tools: AgentDefinitionToolsSchema.optional(),\r\n  })\r\n  .strip();\r\n\r\nexport const AgentDefinitionDescriptorSchema = z\r\n  .object({\r\n    id: AgentIdSchema,\r\n    scope: AgentDefinitionScopeSchema,\r\n    name: z.string().min(1).max(128),\r\n    description: z.string().min(1).max(1024).optional(),\r\n    uiSelectable: z.boolean(),\r\n    uiColor: z.string().min(1).optional(),\r\n    subagentRunnable: z.boolean(),\r\n    // Base agent ID for inheritance (e.g., \"exec\", \"plan\", or custom agent)\r\n    base: AgentIdSchema.optional(),\r\n    aiDefaults: AgentDefinitionAiDefaultsSchema.optional(),\r\n    // Tool configuration (for UI display / inheritance computation)\r\n    tools: AgentDefinitionToolsSchema.optional(),\r\n  })\r\n  .strict();\r\n\r\nexport const AgentDefinitionPackageSchema = z\r\n  .object({\r\n    id: AgentIdSchema,\r\n    scope: AgentDefinitionScopeSchema,\r\n    frontmatter: AgentDefinitionFrontmatterSchema,\r\n    body: z.string(),\r\n  })\r\n  .strict();\r\n"]}