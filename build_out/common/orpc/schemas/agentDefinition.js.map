{"version":3,"file":"agentDefinition.js","sourceRoot":"","sources":["../../../../src/common/orpc/schemas/agentDefinition.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from \"zod\";\n\nexport const AgentDefinitionScopeSchema = z.enum([\"built-in\", \"project\", \"global\"]);\n\n// Agent IDs come from filenames (<agentId>.md).\n// Keep constraints conservative so IDs are safe to use in storage keys, URLs, etc.\nexport const AgentIdSchema = z\n  .string()\n  .min(1)\n  .max(64)\n  .regex(/^[a-z0-9]+(?:[a-z0-9_-]*[a-z0-9])?$/);\n\nconst AgentDefinitionUiRequirementSchema = z.enum([\"plan\"]);\nconst ThinkingLevelSchema = z.enum([\"off\", \"low\", \"medium\", \"high\", \"xhigh\", \"max\"]);\n\nconst AgentDefinitionUiSchema = z\n  .object({\n    // New: hidden is opt-out. Default: visible.\n    hidden: z.boolean().optional(),\n\n    // Legacy: selectable was opt-in. Keep for backwards compatibility.\n    selectable: z.boolean().optional(),\n\n    // When true, completely hides this agent (useful for disabling built-ins)\n    disabled: z.boolean().optional(),\n\n    // UI color (CSS color value). Inherited from base agent if not specified.\n    color: z.string().min(1).optional(),\n\n    // Requirements for this agent to be selectable in the UI.\n    // Enforced in agents.list by toggling uiSelectable.\n    requires: z.array(AgentDefinitionUiRequirementSchema).min(1).optional(),\n  })\n  .strip();\n\nconst AgentDefinitionSubagentSchema = z\n  .object({\n    runnable: z.boolean().optional(),\n    // Instructions appended when this agent runs as a subagent (child workspace)\n    append_prompt: z.string().min(1).optional(),\n    // When true, do not run the project's .mux/init hook for this sub-agent.\n    // NOTE: This skips only the hook execution, not runtime provisioning (e.g. SSH sync, Docker setup).\n    skip_init_hook: z.boolean().optional(),\n  })\n  .strip();\n\nconst AgentDefinitionAiDefaultsSchema = z\n  .object({\n    // Model identifier: full string (e.g. \"anthropic:claude-sonnet-4-5\") or abbreviation (e.g. \"sonnet\")\n    model: z.string().min(1).optional(),\n    thinkingLevel: ThinkingLevelSchema.optional(),\n  })\n  .strip();\n\nconst AgentDefinitionPromptSchema = z\n  .object({\n    // When true, append this agent's body to the base agent's body (default: false = replace)\n    append: z.boolean().optional(),\n  })\n  .strip();\n\n// Tool configuration: add/remove patterns (regex).\n// Layers are processed in order during inheritance (base first, then child).\nconst AgentDefinitionToolsSchema = z\n  .object({\n    // Patterns to add (enable). Processed before remove.\n    add: z.array(z.string().min(1)).optional(),\n    // Patterns to remove (disable). Processed after add.\n    remove: z.array(z.string().min(1)).optional(),\n  })\n  .strip();\n\nexport const AgentDefinitionFrontmatterSchema = z\n  .object({\n    name: z.string().min(1).max(128),\n    description: z.string().min(1).max(1024).optional(),\n\n    // Inheritance: reference a built-in or custom agent ID\n    base: AgentIdSchema.optional(),\n\n    // When true, this agent is disabled by default.\n    //\n    // Notes:\n    // - This is a top-level flag (separate from ui.disabled) so repos can ship agents that are\n    //   present on disk but opt-in.\n    // - When both are set, `disabled` takes precedence over `ui.disabled`.\n    disabled: z.boolean().optional(),\n\n    // UI metadata (color, visibility, etc.)\n    ui: AgentDefinitionUiSchema.optional(),\n\n    // Prompt behavior configuration\n    prompt: AgentDefinitionPromptSchema.optional(),\n\n    subagent: AgentDefinitionSubagentSchema.optional(),\n\n    ai: AgentDefinitionAiDefaultsSchema.optional(),\n\n    // Tool configuration: add/remove patterns (regex).\n    // If omitted and no base, no tools are available.\n    tools: AgentDefinitionToolsSchema.optional(),\n  })\n  .strip();\n\nexport const AgentDefinitionDescriptorSchema = z\n  .object({\n    id: AgentIdSchema,\n    scope: AgentDefinitionScopeSchema,\n    name: z.string().min(1).max(128),\n    description: z.string().min(1).max(1024).optional(),\n    uiSelectable: z.boolean(),\n    uiColor: z.string().min(1).optional(),\n    subagentRunnable: z.boolean(),\n    // Base agent ID for inheritance (e.g., \"exec\", \"plan\", or custom agent)\n    base: AgentIdSchema.optional(),\n    aiDefaults: AgentDefinitionAiDefaultsSchema.optional(),\n    // Tool configuration (for UI display / inheritance computation)\n    tools: AgentDefinitionToolsSchema.optional(),\n  })\n  .strict();\n\nexport const AgentDefinitionPackageSchema = z\n  .object({\n    id: AgentIdSchema,\n    scope: AgentDefinitionScopeSchema,\n    frontmatter: AgentDefinitionFrontmatterSchema,\n    body: z.string(),\n  })\n  .strict();\n"]}