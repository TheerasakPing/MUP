{"version":3,"file":"telemetry.js","sourceRoot":"","sources":["../../../../src/common/orpc/schemas/telemetry.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Telemetry ORPC schemas\r\n *\r\n * Defines input/output schemas for backend telemetry endpoints.\r\n * Telemetry is controlled by MUX_DISABLE_TELEMETRY env var on the backend.\r\n */\r\n\r\nimport { z } from \"zod\";\r\nimport { RuntimeModeSchema } from \"./runtime\";\r\n\r\n// Error context enum (matches payload.ts)\r\nconst ErrorContextSchema = z.enum([\r\n  \"workspace-creation\",\r\n  \"workspace-deletion\",\r\n  \"workspace-switch\",\r\n  \"message-send\",\r\n  \"message-stream\",\r\n  \"project-add\",\r\n  \"project-remove\",\r\n  \"git-operation\",\r\n]);\r\n\r\n// Runtime type - derived from RuntimeModeSchema to stay in sync\r\nconst TelemetryRuntimeTypeSchema = RuntimeModeSchema;\r\n\r\n// Frontend platform info (matches payload.ts FrontendPlatformInfo)\r\nconst FrontendPlatformInfoSchema = z.object({\r\n  userAgent: z.string(),\r\n  platform: z.string(),\r\n});\r\n\r\n// Thinking level enum (matches payload.ts TelemetryThinkingLevel)\r\nconst TelemetryThinkingLevelSchema = z.enum([\"off\", \"low\", \"medium\", \"high\", \"xhigh\", \"max\"]);\r\n\r\n// Command type enum (matches payload.ts TelemetryCommandType)\r\nconst TelemetryCommandTypeSchema = z.enum([\r\n  \"clear\",\r\n  \"compact\",\r\n  \"new\",\r\n  \"fork\",\r\n  \"vim\",\r\n  \"model\",\r\n  \"mode\",\r\n  \"plan\",\r\n  \"providers\",\r\n]);\r\n\r\n// Individual event payload schemas\r\nconst AppStartedPropertiesSchema = z.object({\r\n  isFirstLaunch: z.boolean(),\r\n  vimModeEnabled: z.boolean(),\r\n});\r\n\r\nconst WorkspaceCreatedPropertiesSchema = z.object({\r\n  workspaceId: z.string(),\r\n  runtimeType: TelemetryRuntimeTypeSchema,\r\n  frontendPlatform: FrontendPlatformInfoSchema,\r\n});\r\n\r\nconst WorkspaceSwitchedPropertiesSchema = z.object({\r\n  fromWorkspaceId: z.string(),\r\n  toWorkspaceId: z.string(),\r\n});\r\n\r\nconst MessageSentPropertiesSchema = z.object({\r\n  workspaceId: z.string(),\r\n  model: z.string(),\r\n  agentId: z.string().min(1).optional().catch(undefined),\r\n  message_length_b2: z.number(),\r\n  runtimeType: TelemetryRuntimeTypeSchema,\r\n  frontendPlatform: FrontendPlatformInfoSchema,\r\n  thinkingLevel: TelemetryThinkingLevelSchema,\r\n});\r\n\r\n// MCP transport mode enum (matches payload.ts TelemetryMCPTransportMode)\r\nconst TelemetryMCPTransportModeSchema = z.enum([\r\n  \"none\",\r\n  \"stdio_only\",\r\n  \"http_only\",\r\n  \"sse_only\",\r\n  \"mixed\",\r\n]);\r\n\r\nconst MCPContextInjectedPropertiesSchema = z.object({\r\n  workspaceId: z.string(),\r\n  model: z.string(),\r\n  agentId: z.string().min(1).optional().catch(undefined),\r\n  runtimeType: TelemetryRuntimeTypeSchema,\r\n\r\n  mcp_server_enabled_count: z.number(),\r\n  mcp_server_started_count: z.number(),\r\n  mcp_server_failed_count: z.number(),\r\n\r\n  mcp_tool_count: z.number(),\r\n  total_tool_count: z.number(),\r\n  builtin_tool_count: z.number(),\r\n\r\n  mcp_transport_mode: TelemetryMCPTransportModeSchema,\r\n  mcp_has_http: z.boolean(),\r\n  mcp_has_sse: z.boolean(),\r\n  mcp_has_stdio: z.boolean(),\r\n  mcp_auto_fallback_count: z.number(),\r\n  mcp_setup_duration_ms_b2: z.number(),\r\n});\r\n\r\nconst TelemetryMCPServerTransportSchema = z.enum([\"stdio\", \"http\", \"sse\", \"auto\"]);\r\nconst TelemetryMCPTestErrorCategorySchema = z.enum([\r\n  \"timeout\",\r\n  \"connect\",\r\n  \"http_status\",\r\n  \"unknown\",\r\n]);\r\n\r\nconst MCPServerTestedPropertiesSchema = z.object({\r\n  transport: TelemetryMCPServerTransportSchema,\r\n  success: z.boolean(),\r\n  duration_ms_b2: z.number(),\r\n  error_category: TelemetryMCPTestErrorCategorySchema.optional(),\r\n});\r\n\r\nconst TelemetryMCPServerConfigActionSchema = z.enum([\r\n  \"add\",\r\n  \"edit\",\r\n  \"remove\",\r\n  \"enable\",\r\n  \"disable\",\r\n  \"set_tool_allowlist\",\r\n  \"set_headers\",\r\n]);\r\n\r\nconst StatsTabOpenedPropertiesSchema = z.object({\r\n  viewMode: z.enum([\"session\", \"last-request\"]),\r\n  showModeBreakdown: z.boolean(),\r\n});\r\n\r\nconst StreamTimingComputedPropertiesSchema = z.object({\r\n  model: z.string(),\r\n  agentId: z.string().min(1).optional().catch(undefined),\r\n  duration_b2: z.number(),\r\n  ttft_ms_b2: z.number(),\r\n  tool_ms_b2: z.number(),\r\n  streaming_ms_b2: z.number(),\r\n  tool_percent_bucket: z.number(),\r\n  invalid: z.boolean(),\r\n});\r\n\r\nconst StreamTimingInvalidPropertiesSchema = z.object({\r\n  reason: z.string(),\r\n});\r\n\r\nconst MCPServerConfigChangedPropertiesSchema = z.object({\r\n  action: TelemetryMCPServerConfigActionSchema,\r\n  transport: TelemetryMCPServerTransportSchema,\r\n  has_headers: z.boolean(),\r\n  uses_secret_headers: z.boolean(),\r\n  tool_allowlist_size_b2: z.number().optional(),\r\n});\r\n\r\nconst TelemetryMCPOAuthFlowErrorCategorySchema = z.enum([\r\n  \"timeout\",\r\n  \"cancelled\",\r\n  \"state_mismatch\",\r\n  \"provider_error\",\r\n  \"unknown\",\r\n]);\r\n\r\nconst MCPOAuthFlowStartedPropertiesSchema = z.object({\r\n  transport: TelemetryMCPServerTransportSchema,\r\n  has_scope_hint: z.boolean(),\r\n  has_resource_metadata_hint: z.boolean(),\r\n});\r\n\r\nconst MCPOAuthFlowCompletedPropertiesSchema = z.object({\r\n  transport: TelemetryMCPServerTransportSchema,\r\n  duration_ms_b2: z.number(),\r\n  has_scope_hint: z.boolean(),\r\n  has_resource_metadata_hint: z.boolean(),\r\n});\r\n\r\nconst MCPOAuthFlowFailedPropertiesSchema = z.object({\r\n  transport: TelemetryMCPServerTransportSchema,\r\n  duration_ms_b2: z.number(),\r\n  has_scope_hint: z.boolean(),\r\n  has_resource_metadata_hint: z.boolean(),\r\n  error_category: TelemetryMCPOAuthFlowErrorCategorySchema,\r\n});\r\n\r\nconst StreamCompletedPropertiesSchema = z.object({\r\n  model: z.string(),\r\n  wasInterrupted: z.boolean(),\r\n  duration_b2: z.number(),\r\n  output_tokens_b2: z.number(),\r\n});\r\n\r\nconst CompactionCompletedPropertiesSchema = z.object({\r\n  model: z.string(),\r\n  duration_b2: z.number(),\r\n  input_tokens_b2: z.number(),\r\n  output_tokens_b2: z.number(),\r\n  compaction_source: z.enum([\"manual\", \"idle\"]),\r\n});\r\n\r\nconst ProviderConfiguredPropertiesSchema = z.object({\r\n  provider: z.string(),\r\n  keyType: z.string(),\r\n});\r\n\r\nconst CommandUsedPropertiesSchema = z.object({\r\n  command: TelemetryCommandTypeSchema,\r\n});\r\n\r\nconst VoiceTranscriptionPropertiesSchema = z.object({\r\n  audio_duration_b2: z.number(),\r\n  success: z.boolean(),\r\n});\r\n\r\nconst ErrorOccurredPropertiesSchema = z.object({\r\n  errorType: z.string(),\r\n  context: ErrorContextSchema,\r\n});\r\n\r\nconst ExperimentOverriddenPropertiesSchema = z.object({\r\n  experimentId: z.string(),\r\n  assignedVariant: z.union([z.string(), z.boolean(), z.null()]),\r\n  userChoice: z.boolean(),\r\n});\r\n\r\n// Union of all telemetry events\r\nexport const TelemetryEventSchema = z.discriminatedUnion(\"event\", [\r\n  z.object({\r\n    event: z.literal(\"app_started\"),\r\n    properties: AppStartedPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"workspace_created\"),\r\n    properties: WorkspaceCreatedPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"workspace_switched\"),\r\n    properties: WorkspaceSwitchedPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"mcp_context_injected\"),\r\n    properties: MCPContextInjectedPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"mcp_server_tested\"),\r\n    properties: MCPServerTestedPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"stats_tab_opened\"),\r\n    properties: StatsTabOpenedPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"stream_timing_computed\"),\r\n    properties: StreamTimingComputedPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"stream_timing_invalid\"),\r\n    properties: StreamTimingInvalidPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"mcp_server_config_changed\"),\r\n    properties: MCPServerConfigChangedPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"mcp_oauth_flow_started\"),\r\n    properties: MCPOAuthFlowStartedPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"mcp_oauth_flow_completed\"),\r\n    properties: MCPOAuthFlowCompletedPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"mcp_oauth_flow_failed\"),\r\n    properties: MCPOAuthFlowFailedPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"message_sent\"),\r\n    properties: MessageSentPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"stream_completed\"),\r\n    properties: StreamCompletedPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"compaction_completed\"),\r\n    properties: CompactionCompletedPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"provider_configured\"),\r\n    properties: ProviderConfiguredPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"command_used\"),\r\n    properties: CommandUsedPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"voice_transcription\"),\r\n    properties: VoiceTranscriptionPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"error_occurred\"),\r\n    properties: ErrorOccurredPropertiesSchema,\r\n  }),\r\n  z.object({\r\n    event: z.literal(\"experiment_overridden\"),\r\n    properties: ExperimentOverriddenPropertiesSchema,\r\n  }),\r\n]);\r\n\r\n// API schemas - only track endpoint, enabled state controlled by env var\r\nexport const telemetry = {\r\n  track: {\r\n    input: TelemetryEventSchema,\r\n    output: z.void(),\r\n  },\r\n  status: {\r\n    input: z.void(),\r\n    output: z.object({\r\n      /** True if telemetry is actively running (false in dev mode) */\r\n      enabled: z.boolean(),\r\n      /** True only if user explicitly set MUX_DISABLE_TELEMETRY=1 */\r\n      explicit: z.boolean(),\r\n    }),\r\n  },\r\n};\r\n"]}