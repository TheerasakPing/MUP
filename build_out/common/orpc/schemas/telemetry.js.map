{"version":3,"file":"telemetry.js","sourceRoot":"","sources":["../../../../src/common/orpc/schemas/telemetry.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Telemetry ORPC schemas\n *\n * Defines input/output schemas for backend telemetry endpoints.\n * Telemetry is controlled by MUX_DISABLE_TELEMETRY env var on the backend.\n */\n\nimport { z } from \"zod\";\nimport { RuntimeModeSchema } from \"./runtime\";\n\n// Error context enum (matches payload.ts)\nconst ErrorContextSchema = z.enum([\n  \"workspace-creation\",\n  \"workspace-deletion\",\n  \"workspace-switch\",\n  \"message-send\",\n  \"message-stream\",\n  \"project-add\",\n  \"project-remove\",\n  \"git-operation\",\n]);\n\n// Runtime type - derived from RuntimeModeSchema to stay in sync\nconst TelemetryRuntimeTypeSchema = RuntimeModeSchema;\n\n// Frontend platform info (matches payload.ts FrontendPlatformInfo)\nconst FrontendPlatformInfoSchema = z.object({\n  userAgent: z.string(),\n  platform: z.string(),\n});\n\n// Thinking level enum (matches payload.ts TelemetryThinkingLevel)\nconst TelemetryThinkingLevelSchema = z.enum([\"off\", \"low\", \"medium\", \"high\", \"xhigh\", \"max\"]);\n\n// Command type enum (matches payload.ts TelemetryCommandType)\nconst TelemetryCommandTypeSchema = z.enum([\n  \"clear\",\n  \"compact\",\n  \"new\",\n  \"fork\",\n  \"vim\",\n  \"model\",\n  \"mode\",\n  \"plan\",\n  \"providers\",\n]);\n\n// Individual event payload schemas\nconst AppStartedPropertiesSchema = z.object({\n  isFirstLaunch: z.boolean(),\n  vimModeEnabled: z.boolean(),\n});\n\nconst WorkspaceCreatedPropertiesSchema = z.object({\n  workspaceId: z.string(),\n  runtimeType: TelemetryRuntimeTypeSchema,\n  frontendPlatform: FrontendPlatformInfoSchema,\n});\n\nconst WorkspaceSwitchedPropertiesSchema = z.object({\n  fromWorkspaceId: z.string(),\n  toWorkspaceId: z.string(),\n});\n\nconst MessageSentPropertiesSchema = z.object({\n  workspaceId: z.string(),\n  model: z.string(),\n  agentId: z.string().min(1).optional().catch(undefined),\n  message_length_b2: z.number(),\n  runtimeType: TelemetryRuntimeTypeSchema,\n  frontendPlatform: FrontendPlatformInfoSchema,\n  thinkingLevel: TelemetryThinkingLevelSchema,\n});\n\n// MCP transport mode enum (matches payload.ts TelemetryMCPTransportMode)\nconst TelemetryMCPTransportModeSchema = z.enum([\n  \"none\",\n  \"stdio_only\",\n  \"http_only\",\n  \"sse_only\",\n  \"mixed\",\n]);\n\nconst MCPContextInjectedPropertiesSchema = z.object({\n  workspaceId: z.string(),\n  model: z.string(),\n  agentId: z.string().min(1).optional().catch(undefined),\n  runtimeType: TelemetryRuntimeTypeSchema,\n\n  mcp_server_enabled_count: z.number(),\n  mcp_server_started_count: z.number(),\n  mcp_server_failed_count: z.number(),\n\n  mcp_tool_count: z.number(),\n  total_tool_count: z.number(),\n  builtin_tool_count: z.number(),\n\n  mcp_transport_mode: TelemetryMCPTransportModeSchema,\n  mcp_has_http: z.boolean(),\n  mcp_has_sse: z.boolean(),\n  mcp_has_stdio: z.boolean(),\n  mcp_auto_fallback_count: z.number(),\n  mcp_setup_duration_ms_b2: z.number(),\n});\n\nconst TelemetryMCPServerTransportSchema = z.enum([\"stdio\", \"http\", \"sse\", \"auto\"]);\nconst TelemetryMCPTestErrorCategorySchema = z.enum([\n  \"timeout\",\n  \"connect\",\n  \"http_status\",\n  \"unknown\",\n]);\n\nconst MCPServerTestedPropertiesSchema = z.object({\n  transport: TelemetryMCPServerTransportSchema,\n  success: z.boolean(),\n  duration_ms_b2: z.number(),\n  error_category: TelemetryMCPTestErrorCategorySchema.optional(),\n});\n\nconst TelemetryMCPServerConfigActionSchema = z.enum([\n  \"add\",\n  \"edit\",\n  \"remove\",\n  \"enable\",\n  \"disable\",\n  \"set_tool_allowlist\",\n  \"set_headers\",\n]);\n\nconst StatsTabOpenedPropertiesSchema = z.object({\n  viewMode: z.enum([\"session\", \"last-request\"]),\n  showModeBreakdown: z.boolean(),\n});\n\nconst StreamTimingComputedPropertiesSchema = z.object({\n  model: z.string(),\n  agentId: z.string().min(1).optional().catch(undefined),\n  duration_b2: z.number(),\n  ttft_ms_b2: z.number(),\n  tool_ms_b2: z.number(),\n  streaming_ms_b2: z.number(),\n  tool_percent_bucket: z.number(),\n  invalid: z.boolean(),\n});\n\nconst StreamTimingInvalidPropertiesSchema = z.object({\n  reason: z.string(),\n});\n\nconst MCPServerConfigChangedPropertiesSchema = z.object({\n  action: TelemetryMCPServerConfigActionSchema,\n  transport: TelemetryMCPServerTransportSchema,\n  has_headers: z.boolean(),\n  uses_secret_headers: z.boolean(),\n  tool_allowlist_size_b2: z.number().optional(),\n});\n\nconst TelemetryMCPOAuthFlowErrorCategorySchema = z.enum([\n  \"timeout\",\n  \"cancelled\",\n  \"state_mismatch\",\n  \"provider_error\",\n  \"unknown\",\n]);\n\nconst MCPOAuthFlowStartedPropertiesSchema = z.object({\n  transport: TelemetryMCPServerTransportSchema,\n  has_scope_hint: z.boolean(),\n  has_resource_metadata_hint: z.boolean(),\n});\n\nconst MCPOAuthFlowCompletedPropertiesSchema = z.object({\n  transport: TelemetryMCPServerTransportSchema,\n  duration_ms_b2: z.number(),\n  has_scope_hint: z.boolean(),\n  has_resource_metadata_hint: z.boolean(),\n});\n\nconst MCPOAuthFlowFailedPropertiesSchema = z.object({\n  transport: TelemetryMCPServerTransportSchema,\n  duration_ms_b2: z.number(),\n  has_scope_hint: z.boolean(),\n  has_resource_metadata_hint: z.boolean(),\n  error_category: TelemetryMCPOAuthFlowErrorCategorySchema,\n});\n\nconst StreamCompletedPropertiesSchema = z.object({\n  model: z.string(),\n  wasInterrupted: z.boolean(),\n  duration_b2: z.number(),\n  output_tokens_b2: z.number(),\n});\n\nconst CompactionCompletedPropertiesSchema = z.object({\n  model: z.string(),\n  duration_b2: z.number(),\n  input_tokens_b2: z.number(),\n  output_tokens_b2: z.number(),\n  compaction_source: z.enum([\"manual\", \"idle\"]),\n});\n\nconst ProviderConfiguredPropertiesSchema = z.object({\n  provider: z.string(),\n  keyType: z.string(),\n});\n\nconst CommandUsedPropertiesSchema = z.object({\n  command: TelemetryCommandTypeSchema,\n});\n\nconst VoiceTranscriptionPropertiesSchema = z.object({\n  audio_duration_b2: z.number(),\n  success: z.boolean(),\n});\n\nconst ErrorOccurredPropertiesSchema = z.object({\n  errorType: z.string(),\n  context: ErrorContextSchema,\n});\n\nconst ExperimentOverriddenPropertiesSchema = z.object({\n  experimentId: z.string(),\n  assignedVariant: z.union([z.string(), z.boolean(), z.null()]),\n  userChoice: z.boolean(),\n});\n\n// Union of all telemetry events\nexport const TelemetryEventSchema = z.discriminatedUnion(\"event\", [\n  z.object({\n    event: z.literal(\"app_started\"),\n    properties: AppStartedPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"workspace_created\"),\n    properties: WorkspaceCreatedPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"workspace_switched\"),\n    properties: WorkspaceSwitchedPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"mcp_context_injected\"),\n    properties: MCPContextInjectedPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"mcp_server_tested\"),\n    properties: MCPServerTestedPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"stats_tab_opened\"),\n    properties: StatsTabOpenedPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"stream_timing_computed\"),\n    properties: StreamTimingComputedPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"stream_timing_invalid\"),\n    properties: StreamTimingInvalidPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"mcp_server_config_changed\"),\n    properties: MCPServerConfigChangedPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"mcp_oauth_flow_started\"),\n    properties: MCPOAuthFlowStartedPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"mcp_oauth_flow_completed\"),\n    properties: MCPOAuthFlowCompletedPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"mcp_oauth_flow_failed\"),\n    properties: MCPOAuthFlowFailedPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"message_sent\"),\n    properties: MessageSentPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"stream_completed\"),\n    properties: StreamCompletedPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"compaction_completed\"),\n    properties: CompactionCompletedPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"provider_configured\"),\n    properties: ProviderConfiguredPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"command_used\"),\n    properties: CommandUsedPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"voice_transcription\"),\n    properties: VoiceTranscriptionPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"error_occurred\"),\n    properties: ErrorOccurredPropertiesSchema,\n  }),\n  z.object({\n    event: z.literal(\"experiment_overridden\"),\n    properties: ExperimentOverriddenPropertiesSchema,\n  }),\n]);\n\n// API schemas - only track endpoint, enabled state controlled by env var\nexport const telemetry = {\n  track: {\n    input: TelemetryEventSchema,\n    output: z.void(),\n  },\n  status: {\n    input: z.void(),\n    output: z.object({\n      /** True if telemetry is actively running (false in dev mode) */\n      enabled: z.boolean(),\n      /** True only if user explicitly set MUX_DISABLE_TELEMETRY=1 */\n      explicit: z.boolean(),\n    }),\n  },\n};\n"]}