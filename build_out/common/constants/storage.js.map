{"version":3,"file":"storage.js","sourceRoot":"","sources":["../../../src/common/constants/storage.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * LocalStorage Key Constants and Helpers\r\n * These keys are used for persisting state in localStorage\r\n */\r\n\r\n/**\r\n * Scope ID Helpers\r\n * These create consistent scope identifiers for storage keys\r\n */\r\n\r\n/**\r\n * Get project-scoped ID for storage keys (e.g., model preference before workspace creation)\r\n * Format: \"__project__/{projectPath}\"\r\n * Uses \"/\" delimiter to safely handle projectPath values containing special characters\r\n */\r\nexport function getProjectScopeId(projectPath: string): string {\r\n  return `__project__/${projectPath}`;\r\n}\r\n\r\n/**\r\n * Get pending workspace scope ID for storage keys (e.g., input text during workspace creation)\r\n * Format: \"__pending__{projectPath}\"\r\n */\r\nexport function getPendingScopeId(projectPath: string): string {\r\n  return `__pending__${projectPath}`;\r\n}\r\n\r\n/**\r\n * Get draft workspace scope ID for storage keys.\r\n *\r\n * This is used for UI-only workspace creation drafts so multiple pending drafts can\r\n * exist per project without colliding.\r\n *\r\n * Format: \"__draft__/{projectPath}/{draftId}\"\r\n */\r\nexport function getDraftScopeId(projectPath: string, draftId: string): string {\r\n  return `__draft__/${projectPath}/${draftId}`;\r\n}\r\n\r\n/**\r\n * Global scope ID for workspace-independent preferences\r\n */\r\nexport const GLOBAL_SCOPE_ID = \"__global__\";\r\n\r\n/**\r\n * Get the localStorage key for the UI theme preference (global)\r\n * Format: \"uiTheme\"\r\n */\r\nexport const UI_THEME_KEY = \"uiTheme\";\r\n\r\n/**\r\n * LocalStorage key for the hidden Power Mode UI easter egg (global).\r\n */\r\nexport const POWER_MODE_ENABLED_KEY = \"powerModeEnabled\";\r\n\r\n/**\r\n * Get the localStorage key for the last selected provider when adding custom models (global)\r\n * Format: \"lastCustomModelProvider\"\r\n */\r\nexport const LAST_CUSTOM_MODEL_PROVIDER_KEY = \"lastCustomModelProvider\";\r\n\r\n/**\r\n * Get the localStorage key for the currently selected workspace (global)\r\n * Format: \"selectedWorkspace\"\r\n */\r\nexport const SELECTED_WORKSPACE_KEY = \"selectedWorkspace\";\r\n\r\n/**\r\n * Get the localStorage key for expanded projects in sidebar (global)\r\n * Format: \"expandedProjects\"\r\n */\r\nexport const EXPANDED_PROJECTS_KEY = \"expandedProjects\";\r\n\r\n/**\r\n * LocalStorage key for UI-only workspace creation drafts.\r\n *\r\n * Value: Record<string, Array<{ draftId: string; sectionId: string | null; createdAt: number }>>\r\n * Keyed by projectPath.\r\n */\r\nexport const WORKSPACE_DRAFTS_BY_PROJECT_KEY = \"workspaceDraftsByProject\";\r\n\r\n/**\r\n * LocalStorage keys for Mux Gateway routing preferences (global).\r\n *\r\n * Note: localStorage is origin-scoped (includes port), so these values are also\r\n * mirrored into ~/.mux/config.json for portability across server ports.\r\n */\r\nexport const GATEWAY_MODELS_KEY = \"gateway-models\"; // enabled model IDs (canonical)\r\nexport const GATEWAY_CONFIGURED_KEY = \"gateway-available\"; // synced from provider config\r\nexport const GATEWAY_ENABLED_KEY = \"gateway-enabled\"; // global on/off toggle\r\n\r\n/**\r\n * Get the localStorage key for cached MCP server test results (per project)\r\n * Format: \"mcpTestResults:{projectPath}\"\r\n * Stores: Record<serverName, CachedMCPTestResult>\r\n */\r\nexport function getMCPTestResultsKey(projectPath: string): string {\r\n  return `mcpTestResults:${projectPath}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for cached archived workspaces per project\r\n * Format: \"archivedWorkspaces:{projectPath}\"\r\n * Stores: Array of workspace metadata objects (optimistic cache)\r\n */\r\nexport function getArchivedWorkspacesKey(projectPath: string): string {\r\n  return `archivedWorkspaces:${projectPath}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for cached MCP servers per project\r\n * Format: \"mcpServers:{projectPath}\"\r\n * Stores: Record<serverName, MCPServerInfo> (optimistic cache)\r\n */\r\nexport function getMCPServersKey(projectPath: string): string {\r\n  return `mcpServers:${projectPath}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for thinking level preference per scope (workspace/project).\r\n * Format: \"thinkingLevel:{scopeId}\"\r\n */\r\nexport function getThinkingLevelKey(scopeId: string): string {\r\n  return `thinkingLevel:${scopeId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for per-agent workspace AI overrides cache.\r\n * Format: \"workspaceAiSettingsByAgent:{workspaceId}\"\r\n */\r\nexport function getWorkspaceAISettingsByAgentKey(workspaceId: string): string {\r\n  return `workspaceAiSettingsByAgent:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * LEGACY: Get the localStorage key for thinking level preference per model (global).\r\n * Format: \"thinkingLevel:model:{modelName}\"\r\n *\r\n * Kept for one-time migration to per-workspace thinking.\r\n */\r\nexport function getThinkingLevelByModelKey(modelName: string): string {\r\n  return `thinkingLevel:model:${modelName}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for the user's preferred model for a workspace\r\n */\r\nexport function getModelKey(workspaceId: string): string {\r\n  return `model:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for the input text for a workspace\r\n */\r\nexport function getInputKey(workspaceId: string): string {\r\n  return `input:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for persisted workspace name-generation state.\r\n *\r\n * This is used by the workspace creation flow so drafts can preserve their\r\n * auto-generated (or manually edited) workspace name independently.\r\n *\r\n * Format: \"workspaceNameState:{scopeId}\"\r\n */\r\nexport function getWorkspaceNameStateKey(scopeId: string): string {\r\n  return `workspaceNameState:${scopeId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for the input attachments for a scope.\r\n * Format: \"inputAttachments:{scopeId}\"\r\n *\r\n * Note: The input key functions accept any string scope ID. For normal workspaces\r\n * this is the workspaceId; for creation mode it's a pending scope ID.\r\n */\r\nexport function getInputAttachmentsKey(scopeId: string): string {\r\n  return `inputAttachments:${scopeId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for pending initial send errors after workspace creation.\r\n * Stored so the workspace view can surface a toast after navigation.\r\n * Format: \"pendingSendError:{workspaceId}\"\r\n */\r\nexport function getPendingWorkspaceSendErrorKey(workspaceId: string): string {\r\n  return `pendingSendError:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for auto-retry preference for a workspace\r\n */\r\nexport function getAutoRetryKey(workspaceId: string): string {\r\n  return `${workspaceId}-autoRetry`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for retry state for a workspace\r\n * Stores: { attempt, totalRetryTime, retryStartTime }\r\n */\r\nexport function getRetryStateKey(workspaceId: string): string {\r\n  return `${workspaceId}-retryState`;\r\n}\r\n\r\n/**\r\n * Get storage key for cancelled compaction tracking.\r\n * Stores compaction-request user message ID to verify freshness across reloads.\r\n */\r\nexport function getCancelledCompactionKey(workspaceId: string): string {\r\n  return `workspace:${workspaceId}:cancelled-compaction`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for the selected agent definition id for a scope.\r\n * Format: \"agentId:{scopeId}\"\r\n */\r\nexport function getAgentIdKey(scopeId: string): string {\r\n  return `agentId:${scopeId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for the pinned third agent id for a scope.\r\n * Format: \"pinnedAgentId:{scopeId}\"\r\n */\r\nexport function getPinnedAgentIdKey(scopeId: string): string {\r\n  return `pinnedAgentId:${scopeId}`;\r\n}\r\n/**\r\n * Get the localStorage key for \"disable workspace agents\" toggle per scope.\r\n * When true, workspace-specific agents are disabled - only built-in and global agents are loaded.\r\n * Useful for \"unbricking\" when iterating on agent files in a workspace worktree.\r\n * Format: \"disableWorkspaceAgents:{scopeId}\"\r\n */\r\nexport function getDisableWorkspaceAgentsKey(scopeId: string): string {\r\n  return `disableWorkspaceAgents:${scopeId}`;\r\n}\r\n/**\r\n * Get the localStorage key for the default runtime for a project\r\n * Defaults to worktree if not set; can only be changed via the \"Default for project\" checkbox.\r\n * Format: \"runtime:{projectPath}\"\r\n */\r\nexport function getRuntimeKey(projectPath: string): string {\r\n  return `runtime:${projectPath}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for trunk branch preference for a project\r\n * Stores the last used trunk branch when creating a workspace\r\n * Format: \"trunkBranch:{projectPath}\"\r\n */\r\nexport function getTrunkBranchKey(projectPath: string): string {\r\n  return `trunkBranch:${projectPath}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for whether to show the \"Initialize with AGENTS.md\" nudge for a project.\r\n * Set to true when a project is first added; cleared when user dismisses or runs /init.\r\n * Format: \"agentsInitNudge:{projectPath}\"\r\n */\r\nexport function getAgentsInitNudgeKey(projectPath: string): string {\r\n  return `agentsInitNudge:${projectPath}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for the last runtime config used per provider for a project.\r\n *\r\n * Value shape is a provider-keyed object (e.g. { ssh: { host }, docker: { image } }) so we can\r\n * add new options without adding more storage keys.\r\n *\r\n * Format: \"lastRuntimeConfig:{projectPath}\"\r\n */\r\nexport function getLastRuntimeConfigKey(projectPath: string): string {\r\n  return `lastRuntimeConfig:${projectPath}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for the default model (global).\r\n *\r\n * Note: This is used as a fallback when creating new workspaces.\r\n * Format: \"model-default\"\r\n */\r\nexport const DEFAULT_MODEL_KEY = \"model-default\";\r\n\r\n/**\r\n * Get the localStorage key for the hidden models list (global).\r\n * Format: \"hidden-models\"\r\n */\r\nexport const HIDDEN_MODELS_KEY = \"hidden-models\";\r\n\r\n/**\r\n * Get the localStorage key for the preferred compaction model (global)\r\n * Format: \"preferredCompactionModel\"\r\n */\r\nexport const PREFERRED_COMPACTION_MODEL_KEY = \"preferredCompactionModel\";\r\n\r\n/**\r\n * Get the localStorage key for diff view mode preference (global)\r\n * Format: \"diffViewMode\"\r\n */\r\nexport const DIFF_VIEW_MODE_KEY = \"diffViewMode\";\r\n\r\n/**\r\n * Code snippets library storage key (global)\r\n * Format: \"codeSnippets:list\"\r\n */\r\nexport const CODE_SNIPPETS_KEY = \"codeSnippets:list\";\r\n\r\n/**\r\n * Get the localStorage key for the preferred System 1 model (global)\r\n * Format: \"preferredSystem1Model\"\r\n */\r\nexport const PREFERRED_SYSTEM_1_MODEL_KEY = \"preferredSystem1Model\";\r\n\r\n/**\r\n * Get the localStorage key for the preferred System 1 thinking level (global)\r\n * Format: \"preferredSystem1ThinkingLevel\"\r\n */\r\nexport const PREFERRED_SYSTEM_1_THINKING_LEVEL_KEY = \"preferredSystem1ThinkingLevel\";\r\n\r\n/**\r\n * Get the localStorage key for cached per-agent AI defaults (global).\r\n * Format: \"agentAiDefaults\"\r\n */\r\nexport const AGENT_AI_DEFAULTS_KEY = \"agentAiDefaults\";\r\n\r\n/**\r\n * Get the localStorage key for vim mode preference (global)\r\n * Format: \"vimEnabled\"\r\n */\r\nexport const VIM_ENABLED_KEY = \"vimEnabled\";\r\n\r\n/**\r\n * Preferred expiration for mux.md shares (global)\r\n * Stores: \"1h\" | \"24h\" | \"7d\" | \"30d\" | \"never\"\r\n * Default: \"7d\"\r\n */\r\nexport const SHARE_EXPIRATION_KEY = \"shareExpiration\";\r\n\r\n/**\r\n * Whether to sign shared messages by default.\r\n * Stores: boolean\r\n * Default: true\r\n */\r\nexport const SHARE_SIGNING_KEY = \"shareSigning\";\r\n\r\n/**\r\n * Git status indicator display mode (global)\r\n * Stores: \"line-delta\" | \"divergence\"\r\n */\r\n\r\nexport const GIT_STATUS_INDICATOR_MODE_KEY = \"gitStatusIndicatorMode\";\r\n\r\n/**\r\n * Editor configuration for \"Open in Editor\" feature (global)\r\n * Format: \"editorConfig\"\r\n */\r\nexport const EDITOR_CONFIG_KEY = \"editorConfig\";\r\n\r\nexport type EditorType = \"vscode\" | \"cursor\" | \"zed\" | \"custom\";\r\n\r\nexport interface EditorConfig {\r\n  editor: EditorType;\r\n  customCommand?: string; // Only when editor='custom'\r\n}\r\n\r\nexport const DEFAULT_EDITOR_CONFIG: EditorConfig = {\r\n  editor: \"vscode\",\r\n};\r\n\r\n/**\r\n * Integrated terminal font configuration (global)\r\n * Stores: { fontFamily: string; fontSize: number }\r\n */\r\nexport const TERMINAL_FONT_CONFIG_KEY = \"terminalFontConfig\";\r\n\r\nexport interface TerminalFontConfig {\r\n  fontFamily: string;\r\n  fontSize: number;\r\n}\r\n\r\nexport const DEFAULT_TERMINAL_FONT_CONFIG: TerminalFontConfig = {\r\n  fontFamily: \"Geist Mono, ui-monospace, monospace\",\r\n  fontSize: 13,\r\n};\r\n\r\n/**\r\n * Tutorial state storage key (global)\r\n * Stores: { disabled: boolean, completed: { creation?: true, workspace?: true } }\r\n */\r\nexport const TUTORIAL_STATE_KEY = \"tutorialState\";\r\n\r\nexport type TutorialSequence = \"creation\" | \"workspace\";\r\n\r\nexport interface TutorialState {\r\n  disabled: boolean;\r\n  completed: Partial<Record<TutorialSequence, true>>;\r\n}\r\n\r\nexport const DEFAULT_TUTORIAL_STATE: TutorialState = {\r\n  disabled: false,\r\n  completed: {},\r\n};\r\n\r\n/**\r\n * Get the localStorage key for review (hunk read) state per workspace\r\n * Stores which hunks have been marked as read during code review\r\n * Format: \"review-state:{workspaceId}\"\r\n */\r\nexport function getReviewStateKey(workspaceId: string): string {\r\n  return `review-state:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for hunk first-seen timestamps per workspace\r\n * Tracks when each hunk content address was first observed (for LIFO sorting)\r\n * Format: \"hunkFirstSeen:{workspaceId}\"\r\n */\r\nexport function getHunkFirstSeenKey(workspaceId: string): string {\r\n  return `hunkFirstSeen:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for review sort order preference (global)\r\n * Format: \"review-sort-order\"\r\n */\r\nexport const REVIEW_SORT_ORDER_KEY = \"review-sort-order\";\r\n\r\n/**\r\n * Get the localStorage key for hunk expand/collapse state in Review tab\r\n * Stores user's manual expand/collapse preferences per hunk\r\n * Format: \"reviewExpandState:{workspaceId}\"\r\n */\r\nexport function getReviewExpandStateKey(workspaceId: string): string {\r\n  return `reviewExpandState:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for read-more expansion state per hunk.\r\n * Tracks how many lines are expanded up/down for each hunk.\r\n * Format: \"reviewReadMore:{workspaceId}\"\r\n */\r\nexport function getReviewReadMoreKey(workspaceId: string): string {\r\n  return `reviewReadMore:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for FileTree expand/collapse state in Review tab\r\n * Stores directory expand/collapse preferences per workspace\r\n * Format: \"fileTreeExpandState:{workspaceId}\"\r\n */\r\nexport function getFileTreeExpandStateKey(workspaceId: string): string {\r\n  return `fileTreeExpandState:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * LocalStorage key for file tree view mode in the Review tab (global).\r\n * Format: \"reviewFileTreeViewMode\"\r\n */\r\nexport const REVIEW_FILE_TREE_VIEW_MODE_KEY = \"reviewFileTreeViewMode\";\r\n\r\n/**\r\n * Get the localStorage key for persisted agent status for a workspace\r\n * Stores the most recent successful status_set payload (emoji, message, url)\r\n * Format: \"statusState:{workspaceId}\"\r\n */\r\n\r\n/**\r\n * Get the localStorage key for \"notify on response\" toggle per workspace.\r\n * When true, a browser notification is shown when assistant responses complete.\r\n * Format: \"notifyOnResponse:{workspaceId}\"\r\n */\r\nexport function getNotifyOnResponseKey(workspaceId: string): string {\r\n  return `notifyOnResponse:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for \"auto-enable notifications\" toggle per project.\r\n * When true, new workspaces in this project automatically have notifications enabled.\r\n * Format: \"notifyOnResponseAutoEnable:{projectPath}\"\r\n */\r\nexport function getNotifyOnResponseAutoEnableKey(projectPath: string): string {\r\n  return `notifyOnResponseAutoEnable:${projectPath}`;\r\n}\r\n\r\nexport function getStatusStateKey(workspaceId: string): string {\r\n  return `statusState:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for session timing stats for a workspace\r\n * Stores aggregate timing data: totalDurationMs, totalToolExecutionMs, totalTtftMs, ttftCount, responseCount\r\n * Format: \"sessionTiming:{workspaceId}\"\r\n */\r\nexport function getSessionTimingKey(workspaceId: string): string {\r\n  return `sessionTiming:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for last-read timestamps per workspace.\r\n * Format: \"workspaceLastRead:{workspaceId}\"\r\n */\r\nexport function getWorkspaceLastReadKey(workspaceId: string): string {\r\n  return `workspaceLastRead:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Left sidebar collapsed state (global, manual toggle)\r\n * Format: \"sidebarCollapsed\"\r\n */\r\nexport const LEFT_SIDEBAR_COLLAPSED_KEY = \"sidebarCollapsed\";\r\n\r\n/**\r\n * Left sidebar width\r\n * Format: \"left-sidebar:width\"\r\n */\r\nexport const LEFT_SIDEBAR_WIDTH_KEY = \"left-sidebar:width\";\r\n\r\n/**\r\n * Right sidebar tab selection (global)\r\n * Format: \"right-sidebar-tab\"\r\n */\r\nexport const RIGHT_SIDEBAR_TAB_KEY = \"right-sidebar-tab\";\r\n\r\n/**\r\n * Right sidebar collapsed state (global, manual toggle)\r\n * Format: \"right-sidebar:collapsed\"\r\n */\r\nexport const RIGHT_SIDEBAR_COLLAPSED_KEY = \"right-sidebar:collapsed\";\r\n\r\n/**\r\n * Right sidebar width (unified across all tabs)\r\n * Format: \"right-sidebar:width\"\r\n */\r\nexport const RIGHT_SIDEBAR_WIDTH_KEY = \"right-sidebar:width\";\r\n\r\n/**\r\n * Get the localStorage key for right sidebar dock-lite layout per workspace.\r\n * Each workspace can have its own split/tab configuration (e.g., different\r\n * numbers of terminals). Width and collapsed state remain global.\r\n * Format: \"right-sidebar:layout:{workspaceId}\"\r\n */\r\nexport function getRightSidebarLayoutKey(workspaceId: string): string {\r\n  return `right-sidebar:layout:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for terminal titles per workspace.\r\n * Maps sessionId -> title for persisting OSC-set terminal titles.\r\n * Format: \"right-sidebar:terminal-titles:{workspaceId}\"\r\n */\r\nexport function getTerminalTitlesKey(workspaceId: string): string {\r\n  return `right-sidebar:terminal-titles:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for unified Review search state per workspace\r\n * Stores: { input: string, useRegex: boolean, matchCase: boolean }\r\n * Format: \"reviewSearchState:{workspaceId}\"\r\n */\r\nexport function getReviewSearchStateKey(workspaceId: string): string {\r\n  return `reviewSearchState:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for reviews per workspace\r\n * Stores: ReviewsState (reviews created from diff viewer - pending, attached, or checked)\r\n * Format: \"reviews:{workspaceId}\"\r\n */\r\nexport function getReviewsKey(workspaceId: string): string {\r\n  return `reviews:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for auto-compaction enabled preference per workspace\r\n * Format: \"autoCompaction:enabled:{workspaceId}\"\r\n */\r\nexport function getAutoCompactionEnabledKey(workspaceId: string): string {\r\n  return `autoCompaction:enabled:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for auto-compaction threshold percentage per model\r\n * Format: \"autoCompaction:threshold:{model}\"\r\n * Stored per-model because different models have different context windows\r\n */\r\nexport function getAutoCompactionThresholdKey(model: string): string {\r\n  return `autoCompaction:threshold:${model}`;\r\n}\r\n\r\n/**\r\n * List of workspace-scoped key functions that should be copied on fork and deleted on removal\r\n */\r\nconst PERSISTENT_WORKSPACE_KEY_FUNCTIONS: Array<(workspaceId: string) => string> = [\r\n  getWorkspaceAISettingsByAgentKey,\r\n  getModelKey,\r\n  getInputKey,\r\n  getWorkspaceNameStateKey,\r\n  getInputAttachmentsKey,\r\n  getAgentIdKey,\r\n  getPinnedAgentIdKey,\r\n  getThinkingLevelKey,\r\n  getAutoRetryKey,\r\n  getRetryStateKey,\r\n  getReviewStateKey,\r\n  getHunkFirstSeenKey,\r\n  getReviewExpandStateKey,\r\n  getReviewReadMoreKey,\r\n  getFileTreeExpandStateKey,\r\n  getReviewSearchStateKey,\r\n  getReviewsKey,\r\n  getAutoCompactionEnabledKey,\r\n  getWorkspaceLastReadKey,\r\n  getStatusStateKey,\r\n  // Note: auto-compaction threshold is per-model, not per-workspace\r\n];\r\n\r\n/**\r\n * Get the localStorage key for cached plan content for a workspace\r\n * Stores: { content: string; path: string } - used for optimistic rendering\r\n * Format: \"planContent:{workspaceId}\"\r\n */\r\nexport function getPlanContentKey(workspaceId: string): string {\r\n  return `planContent:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Get the localStorage key for cached post-compaction state for a workspace\r\n * Stores: { planPath: string | null; trackedFilePaths: string[]; excludedItems: string[] }\r\n * Format: \"postCompactionState:{workspaceId}\"\r\n */\r\nexport function getPostCompactionStateKey(workspaceId: string): string {\r\n  return `postCompactionState:${workspaceId}`;\r\n}\r\n\r\n/**\r\n * Additional ephemeral keys to delete on workspace removal (not copied on fork)\r\n */\r\nconst EPHEMERAL_WORKSPACE_KEY_FUNCTIONS: Array<(workspaceId: string) => string> = [\r\n  getCancelledCompactionKey,\r\n  getPendingWorkspaceSendErrorKey,\r\n  getPlanContentKey, // Cache only, no need to preserve on fork\r\n  getPostCompactionStateKey, // Cache only, no need to preserve on fork\r\n];\r\n\r\n/**\r\n * Copy all workspace-specific localStorage keys from source to destination workspace.\r\n * Includes keys listed in PERSISTENT_WORKSPACE_KEY_FUNCTIONS (model, draft input text/attachments, etc).\r\n */\r\nexport function copyWorkspaceStorage(sourceWorkspaceId: string, destWorkspaceId: string): void {\r\n  for (const getKey of PERSISTENT_WORKSPACE_KEY_FUNCTIONS) {\r\n    const sourceKey = getKey(sourceWorkspaceId);\r\n    const destKey = getKey(destWorkspaceId);\r\n    const value = localStorage.getItem(sourceKey);\r\n    if (value !== null) {\r\n      localStorage.setItem(destKey, value);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Delete all workspace-specific localStorage keys for a workspace\r\n * Should be called when a workspace is deleted to prevent orphaned data\r\n */\r\nexport function deleteWorkspaceStorage(workspaceId: string): void {\r\n  const allKeyFunctions = [\r\n    ...PERSISTENT_WORKSPACE_KEY_FUNCTIONS,\r\n    ...EPHEMERAL_WORKSPACE_KEY_FUNCTIONS,\r\n  ];\r\n\r\n  for (const getKey of allKeyFunctions) {\r\n    const key = getKey(workspaceId);\r\n    localStorage.removeItem(key);\r\n  }\r\n}\r\n\r\n/**\r\n * Migrate all workspace-specific localStorage keys from old to new workspace ID\r\n * Should be called when a workspace is renamed to preserve settings\r\n */\r\nexport function migrateWorkspaceStorage(oldWorkspaceId: string, newWorkspaceId: string): void {\r\n  copyWorkspaceStorage(oldWorkspaceId, newWorkspaceId);\r\n  deleteWorkspaceStorage(oldWorkspaceId);\r\n}\r\n"]}