{"version":3,"file":"projectOrdering.test.js","sourceRoot":"","sources":["../../../src/common/utils/projectOrdering.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, it, expect } from \"@jest/globals\";\r\nimport {\r\n  sortProjectsByOrder,\r\n  reorderProjects,\r\n  normalizeOrder,\r\n  equalOrders,\r\n} from \"./projectOrdering\";\r\nimport type { ProjectConfig } from \"@/node/config\";\r\n\r\ndescribe(\"projectOrdering\", () => {\r\n  const createProjects = (paths: string[]): Map<string, ProjectConfig> => {\r\n    const map = new Map<string, ProjectConfig>();\r\n    for (const p of paths) {\r\n      map.set(p, { workspaces: [] });\r\n    }\r\n    return map;\r\n  };\r\n\r\n  describe(\"sortProjectsByOrder\", () => {\r\n    it(\"returns lexical order when order array is empty\", () => {\r\n      const projects = createProjects([\"/a\", \"/c\", \"/b\"]);\r\n      const result = sortProjectsByOrder(projects, []);\r\n      expect(result.map(([p]) => p)).toEqual([\"/a\", \"/b\", \"/c\"]);\r\n    });\r\n\r\n    it(\"sorts projects according to order array\", () => {\r\n      const projects = createProjects([\"/a\", \"/b\", \"/c\"]);\r\n      const result = sortProjectsByOrder(projects, [\"/c\", \"/a\", \"/b\"]);\r\n      expect(result.map(([p]) => p)).toEqual([\"/c\", \"/a\", \"/b\"]);\r\n    });\r\n\r\n    it(\"puts unknown projects at the end in natural order\", () => {\r\n      const projects = createProjects([\"/a\", \"/b\", \"/c\", \"/d\"]);\r\n      const result = sortProjectsByOrder(projects, [\"/c\", \"/a\"]);\r\n      // /c and /a are ordered, /b and /d are unknown and should appear in natural order\r\n      expect(result.map(([p]) => p)).toEqual([\"/c\", \"/a\", \"/b\", \"/d\"]);\r\n    });\r\n  });\r\n\r\n  describe(\"reorderProjects\", () => {\r\n    it(\"moves dragged project to target position\", () => {\r\n      const projects = createProjects([\"/a\", \"/b\", \"/c\", \"/d\"]);\r\n      const currentOrder = [\"/a\", \"/b\", \"/c\", \"/d\"];\r\n      // Drag /d onto /b (move /d to position 1)\r\n      const result = reorderProjects(currentOrder, projects, \"/d\", \"/b\");\r\n      expect(result).toEqual([\"/a\", \"/d\", \"/b\", \"/c\"]);\r\n    });\r\n\r\n    it(\"returns current order if dragged or target not found\", () => {\r\n      const projects = createProjects([\"/a\", \"/b\", \"/c\"]);\r\n      const currentOrder = [\"/a\", \"/b\", \"/c\"];\r\n      const result = reorderProjects(currentOrder, projects, \"/x\", \"/b\");\r\n      expect(result).toEqual([\"/a\", \"/b\", \"/c\"]);\r\n    });\r\n\r\n    it(\"returns current order if dragged === target\", () => {\r\n      const projects = createProjects([\"/a\", \"/b\", \"/c\"]);\r\n      const currentOrder = [\"/a\", \"/b\", \"/c\"];\r\n      const result = reorderProjects(currentOrder, projects, \"/b\", \"/b\");\r\n      expect(result).toEqual([\"/a\", \"/b\", \"/c\"]);\r\n    });\r\n  });\r\n\r\n  describe(\"normalizeOrder\", () => {\r\n    it(\"removes paths that no longer exist\", () => {\r\n      const projects = createProjects([\"/a\", \"/b\"]);\r\n      const order = [\"/a\", \"/b\", \"/c\", \"/d\"];\r\n      const result = normalizeOrder(order, projects);\r\n      expect(result).toEqual([\"/a\", \"/b\"]);\r\n    });\r\n\r\n    it(\"prepends new projects to the front in lexical order\", () => {\r\n      const projects = createProjects([\"/a\", \"/b\", \"/c\", \"/d\"]);\r\n      const order = [\"/b\", \"/a\"];\r\n      const result = normalizeOrder(order, projects);\r\n      // /c and /d are missing from order, prepended in lexical order\r\n      expect(result).toEqual([\"/c\", \"/d\", \"/b\", \"/a\"]);\r\n    });\r\n\r\n    it(\"sorts missing projects lexically for deterministic order\", () => {\r\n      // Even if Map iteration order is non-lexical, missing projects should be sorted\r\n      const projects = new Map<string, ProjectConfig>([\r\n        [\"/z-project\", { workspaces: [] }],\r\n        [\"/a-project\", { workspaces: [] }],\r\n        [\"/m-project\", { workspaces: [] }],\r\n      ]);\r\n      const order: string[] = []; // empty order, all projects are \"missing\"\r\n      const result = normalizeOrder(order, projects);\r\n      // Should be lexically sorted regardless of Map insertion order\r\n      expect(result).toEqual([\"/a-project\", \"/m-project\", \"/z-project\"]);\r\n    });\r\n\r\n    it(\"preserves order of existing projects\", () => {\r\n      const projects = createProjects([\"/a\", \"/b\", \"/c\"]);\r\n      const order = [\"/c\", \"/a\", \"/b\"];\r\n      const result = normalizeOrder(order, projects);\r\n      expect(result).toEqual([\"/c\", \"/a\", \"/b\"]);\r\n    });\r\n  });\r\n\r\n  describe(\"equalOrders\", () => {\r\n    it(\"returns true for identical arrays\", () => {\r\n      const a = [\"/a\", \"/b\", \"/c\"];\r\n      const b = [\"/a\", \"/b\", \"/c\"];\r\n      expect(equalOrders(a, b)).toBe(true);\r\n    });\r\n\r\n    it(\"returns false for arrays with different lengths\", () => {\r\n      const a = [\"/a\", \"/b\"];\r\n      const b = [\"/a\", \"/b\", \"/c\"];\r\n      expect(equalOrders(a, b)).toBe(false);\r\n    });\r\n\r\n    it(\"returns false for arrays with different order\", () => {\r\n      const a = [\"/a\", \"/b\", \"/c\"];\r\n      const b = [\"/a\", \"/c\", \"/b\"];\r\n      expect(equalOrders(a, b)).toBe(false);\r\n    });\r\n\r\n    it(\"returns true for same reference\", () => {\r\n      const a = [\"/a\", \"/b\", \"/c\"];\r\n      expect(equalOrders(a, a)).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe(\"Bug fix: empty projects Map on initial load\", () => {\r\n    it(\"returns empty array when projects Map is empty\", () => {\r\n      // This documents the bug scenario:\r\n      // 1. localStorage has projectOrder = [\"/a\", \"/b\", \"/c\"]\r\n      // 2. Projects haven't loaded yet, so projects = new Map()\r\n      // 3. If normalization runs, it would clear the order\r\n      const emptyProjects = createProjects([]);\r\n      const order = [\"/a\", \"/b\", \"/c\"];\r\n      const result = normalizeOrder(order, emptyProjects);\r\n\r\n      // normalizeOrder returns [] when projects is empty\r\n      expect(result).toEqual([]);\r\n\r\n      // Fix: ProjectSidebar.tsx skips normalization when projects.size === 0\r\n      // This prevents clearing the order during initial component mount\r\n    });\r\n\r\n    it(\"normalizes correctly after projects load\", () => {\r\n      // After projects load, normalization should work normally:\r\n      // 1. projectOrder is still [\"/a\", \"/b\", \"/c\"] from localStorage\r\n      // 2. Projects are now loaded with an additional project [\"/d\"]\r\n      // 3. Normalization should treat the new project as \"most recent\" and put it first\r\n      const projectOrder = [\"/a\", \"/b\", \"/c\"];\r\n      const loadedProjects = createProjects([\"/a\", \"/b\", \"/c\", \"/d\"]);\r\n\r\n      const result = normalizeOrder(projectOrder, loadedProjects);\r\n\r\n      expect(result).toEqual([\"/d\", \"/a\", \"/b\", \"/c\"]);\r\n    });\r\n  });\r\n});\r\n"]}