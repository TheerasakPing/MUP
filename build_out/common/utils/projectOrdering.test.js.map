{"version":3,"file":"projectOrdering.test.js","sourceRoot":"","sources":["../../../src/common/utils/projectOrdering.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, it, expect } from \"@jest/globals\";\nimport {\n  sortProjectsByOrder,\n  reorderProjects,\n  normalizeOrder,\n  equalOrders,\n} from \"./projectOrdering\";\nimport type { ProjectConfig } from \"@/node/config\";\n\ndescribe(\"projectOrdering\", () => {\n  const createProjects = (paths: string[]): Map<string, ProjectConfig> => {\n    const map = new Map<string, ProjectConfig>();\n    for (const p of paths) {\n      map.set(p, { workspaces: [] });\n    }\n    return map;\n  };\n\n  describe(\"sortProjectsByOrder\", () => {\n    it(\"returns lexical order when order array is empty\", () => {\n      const projects = createProjects([\"/a\", \"/c\", \"/b\"]);\n      const result = sortProjectsByOrder(projects, []);\n      expect(result.map(([p]) => p)).toEqual([\"/a\", \"/b\", \"/c\"]);\n    });\n\n    it(\"sorts projects according to order array\", () => {\n      const projects = createProjects([\"/a\", \"/b\", \"/c\"]);\n      const result = sortProjectsByOrder(projects, [\"/c\", \"/a\", \"/b\"]);\n      expect(result.map(([p]) => p)).toEqual([\"/c\", \"/a\", \"/b\"]);\n    });\n\n    it(\"puts unknown projects at the end in natural order\", () => {\n      const projects = createProjects([\"/a\", \"/b\", \"/c\", \"/d\"]);\n      const result = sortProjectsByOrder(projects, [\"/c\", \"/a\"]);\n      // /c and /a are ordered, /b and /d are unknown and should appear in natural order\n      expect(result.map(([p]) => p)).toEqual([\"/c\", \"/a\", \"/b\", \"/d\"]);\n    });\n  });\n\n  describe(\"reorderProjects\", () => {\n    it(\"moves dragged project to target position\", () => {\n      const projects = createProjects([\"/a\", \"/b\", \"/c\", \"/d\"]);\n      const currentOrder = [\"/a\", \"/b\", \"/c\", \"/d\"];\n      // Drag /d onto /b (move /d to position 1)\n      const result = reorderProjects(currentOrder, projects, \"/d\", \"/b\");\n      expect(result).toEqual([\"/a\", \"/d\", \"/b\", \"/c\"]);\n    });\n\n    it(\"returns current order if dragged or target not found\", () => {\n      const projects = createProjects([\"/a\", \"/b\", \"/c\"]);\n      const currentOrder = [\"/a\", \"/b\", \"/c\"];\n      const result = reorderProjects(currentOrder, projects, \"/x\", \"/b\");\n      expect(result).toEqual([\"/a\", \"/b\", \"/c\"]);\n    });\n\n    it(\"returns current order if dragged === target\", () => {\n      const projects = createProjects([\"/a\", \"/b\", \"/c\"]);\n      const currentOrder = [\"/a\", \"/b\", \"/c\"];\n      const result = reorderProjects(currentOrder, projects, \"/b\", \"/b\");\n      expect(result).toEqual([\"/a\", \"/b\", \"/c\"]);\n    });\n  });\n\n  describe(\"normalizeOrder\", () => {\n    it(\"removes paths that no longer exist\", () => {\n      const projects = createProjects([\"/a\", \"/b\"]);\n      const order = [\"/a\", \"/b\", \"/c\", \"/d\"];\n      const result = normalizeOrder(order, projects);\n      expect(result).toEqual([\"/a\", \"/b\"]);\n    });\n\n    it(\"prepends new projects to the front in lexical order\", () => {\n      const projects = createProjects([\"/a\", \"/b\", \"/c\", \"/d\"]);\n      const order = [\"/b\", \"/a\"];\n      const result = normalizeOrder(order, projects);\n      // /c and /d are missing from order, prepended in lexical order\n      expect(result).toEqual([\"/c\", \"/d\", \"/b\", \"/a\"]);\n    });\n\n    it(\"sorts missing projects lexically for deterministic order\", () => {\n      // Even if Map iteration order is non-lexical, missing projects should be sorted\n      const projects = new Map<string, ProjectConfig>([\n        [\"/z-project\", { workspaces: [] }],\n        [\"/a-project\", { workspaces: [] }],\n        [\"/m-project\", { workspaces: [] }],\n      ]);\n      const order: string[] = []; // empty order, all projects are \"missing\"\n      const result = normalizeOrder(order, projects);\n      // Should be lexically sorted regardless of Map insertion order\n      expect(result).toEqual([\"/a-project\", \"/m-project\", \"/z-project\"]);\n    });\n\n    it(\"preserves order of existing projects\", () => {\n      const projects = createProjects([\"/a\", \"/b\", \"/c\"]);\n      const order = [\"/c\", \"/a\", \"/b\"];\n      const result = normalizeOrder(order, projects);\n      expect(result).toEqual([\"/c\", \"/a\", \"/b\"]);\n    });\n  });\n\n  describe(\"equalOrders\", () => {\n    it(\"returns true for identical arrays\", () => {\n      const a = [\"/a\", \"/b\", \"/c\"];\n      const b = [\"/a\", \"/b\", \"/c\"];\n      expect(equalOrders(a, b)).toBe(true);\n    });\n\n    it(\"returns false for arrays with different lengths\", () => {\n      const a = [\"/a\", \"/b\"];\n      const b = [\"/a\", \"/b\", \"/c\"];\n      expect(equalOrders(a, b)).toBe(false);\n    });\n\n    it(\"returns false for arrays with different order\", () => {\n      const a = [\"/a\", \"/b\", \"/c\"];\n      const b = [\"/a\", \"/c\", \"/b\"];\n      expect(equalOrders(a, b)).toBe(false);\n    });\n\n    it(\"returns true for same reference\", () => {\n      const a = [\"/a\", \"/b\", \"/c\"];\n      expect(equalOrders(a, a)).toBe(true);\n    });\n  });\n\n  describe(\"Bug fix: empty projects Map on initial load\", () => {\n    it(\"returns empty array when projects Map is empty\", () => {\n      // This documents the bug scenario:\n      // 1. localStorage has projectOrder = [\"/a\", \"/b\", \"/c\"]\n      // 2. Projects haven't loaded yet, so projects = new Map()\n      // 3. If normalization runs, it would clear the order\n      const emptyProjects = createProjects([]);\n      const order = [\"/a\", \"/b\", \"/c\"];\n      const result = normalizeOrder(order, emptyProjects);\n\n      // normalizeOrder returns [] when projects is empty\n      expect(result).toEqual([]);\n\n      // Fix: ProjectSidebar.tsx skips normalization when projects.size === 0\n      // This prevents clearing the order during initial component mount\n    });\n\n    it(\"normalizes correctly after projects load\", () => {\n      // After projects load, normalization should work normally:\n      // 1. projectOrder is still [\"/a\", \"/b\", \"/c\"] from localStorage\n      // 2. Projects are now loaded with an additional project [\"/d\"]\n      // 3. Normalization should treat the new project as \"most recent\" and put it first\n      const projectOrder = [\"/a\", \"/b\", \"/c\"];\n      const loadedProjects = createProjects([\"/a\", \"/b\", \"/c\", \"/d\"]);\n\n      const result = normalizeOrder(projectOrder, loadedProjects);\n\n      expect(result).toEqual([\"/d\", \"/a\", \"/b\", \"/c\"]);\n    });\n  });\n});\n"]}