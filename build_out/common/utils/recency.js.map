{"version":3,"file":"recency.js","sourceRoot":"","sources":["../../../src/common/utils/recency.ts"],"names":[],"mappings":";;;AAEA;;;;GAIG;AACH,SAAS,uBAAuB,CAAC,GAAe,EAAW;IACzD,MAAM,OAAO,GAAG,GAAG,CAAC,QAAQ,EAAE,WAAW,CAAC;IAC1C,OAAO,OAAO,EAAE,IAAI,KAAK,oBAAoB,IAAI,OAAO,EAAE,MAAM,KAAK,iBAAiB,CAAC;AAAA,CACxF;AAED;;;;;;;;;GASG;AACH,oCACE,QAAsB,EACtB,SAAkB,EAClB,YAAqB,EACN;IACf,MAAM,QAAQ,GAAG,CAAC,GAAG,QAAQ,CAAC,CAAC,OAAO,EAAE,CAAC;IACzC,MAAM,WAAW,GAAG,QAAQ,CAAC,IAAI,CAC/B,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,MAAM,IAAI,CAAC,CAAC,QAAQ,EAAE,SAAS,IAAI,CAAC,uBAAuB,CAAC,CAAC,CAAC,CACjF,CAAC;IACF,kEAAkE;IAClE,MAAM,gBAAgB,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,EAAE,SAAS,IAAI,CAAC,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;IAC9F,MAAM,UAAU,GAAG;QACjB,SAAS,IAAI,IAAI;QACjB,YAAY,IAAI,IAAI;QACpB,WAAW,EAAE,QAAQ,EAAE,SAAS,IAAI,IAAI;QACxC,gBAAgB,EAAE,QAAQ,EAAE,SAAS,IAAI,IAAI;KAC9C,CAAC,MAAM,CAAC,CAAC,CAAC,EAAe,EAAE,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC;IACzC,OAAO,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;AAAA,CAC/D","sourcesContent":["import type { MuxMessage } from \"@/common/types/message\";\n\n/**\n * Check if a message is an idle compaction request.\n * Used to exclude these from recency calculation since they shouldn't affect\n * when the workspace was \"last used\" by the user.\n */\nfunction isIdleCompactionRequest(msg: MuxMessage): boolean {\n  const muxMeta = msg.metadata?.muxMetadata;\n  return muxMeta?.type === \"compaction-request\" && muxMeta?.source === \"idle-compaction\";\n}\n\n/**\n * Compute recency timestamp from messages.\n * Returns max of: createdAt, unarchivedAt, last user message timestamp, last compacted message timestamp.\n * This is the single source of truth for workspace recency.\n *\n * Excludes idle compaction requests since they shouldn't hoist the workspace\n * in the sidebar (they're background operations, not user activity).\n *\n * @param unarchivedAt - When workspace was last unarchived (bumps to top of recency)\n */\nexport function computeRecencyFromMessages(\n  messages: MuxMessage[],\n  createdAt?: number,\n  unarchivedAt?: number\n): number | null {\n  const reversed = [...messages].reverse();\n  const lastUserMsg = reversed.find(\n    (m) => m.role === \"user\" && m.metadata?.timestamp && !isIdleCompactionRequest(m)\n  );\n  // Support both new enum (\"user\"|\"idle\") and legacy boolean (true)\n  const lastCompactedMsg = reversed.find((m) => m.metadata?.compacted && m.metadata?.timestamp);\n  const candidates = [\n    createdAt ?? null,\n    unarchivedAt ?? null,\n    lastUserMsg?.metadata?.timestamp ?? null,\n    lastCompactedMsg?.metadata?.timestamp ?? null,\n  ].filter((t): t is number => t !== null);\n  return candidates.length > 0 ? Math.max(...candidates) : null;\n}\n"]}