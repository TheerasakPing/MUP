{"version":3,"file":"recency.js","sourceRoot":"","sources":["../../../src/common/utils/recency.ts"],"names":[],"mappings":";;;AAEA;;;;GAIG;AACH,SAAS,uBAAuB,CAAC,GAAe,EAAW;IACzD,MAAM,OAAO,GAAG,GAAG,CAAC,QAAQ,EAAE,WAAW,CAAC;IAC1C,OAAO,OAAO,EAAE,IAAI,KAAK,oBAAoB,IAAI,OAAO,EAAE,MAAM,KAAK,iBAAiB,CAAC;AAAA,CACxF;AAED;;;;;;;;;GASG;AACH,oCACE,QAAsB,EACtB,SAAkB,EAClB,YAAqB,EACN;IACf,MAAM,QAAQ,GAAG,CAAC,GAAG,QAAQ,CAAC,CAAC,OAAO,EAAE,CAAC;IACzC,MAAM,WAAW,GAAG,QAAQ,CAAC,IAAI,CAC/B,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,MAAM,IAAI,CAAC,CAAC,QAAQ,EAAE,SAAS,IAAI,CAAC,uBAAuB,CAAC,CAAC,CAAC,CACjF,CAAC;IACF,kEAAkE;IAClE,MAAM,gBAAgB,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,EAAE,SAAS,IAAI,CAAC,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;IAC9F,MAAM,UAAU,GAAG;QACjB,SAAS,IAAI,IAAI;QACjB,YAAY,IAAI,IAAI;QACpB,WAAW,EAAE,QAAQ,EAAE,SAAS,IAAI,IAAI;QACxC,gBAAgB,EAAE,QAAQ,EAAE,SAAS,IAAI,IAAI;KAC9C,CAAC,MAAM,CAAC,CAAC,CAAC,EAAe,EAAE,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC;IACzC,OAAO,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;AAAA,CAC/D","sourcesContent":["import type { MuxMessage } from \"@/common/types/message\";\r\n\r\n/**\r\n * Check if a message is an idle compaction request.\r\n * Used to exclude these from recency calculation since they shouldn't affect\r\n * when the workspace was \"last used\" by the user.\r\n */\r\nfunction isIdleCompactionRequest(msg: MuxMessage): boolean {\r\n  const muxMeta = msg.metadata?.muxMetadata;\r\n  return muxMeta?.type === \"compaction-request\" && muxMeta?.source === \"idle-compaction\";\r\n}\r\n\r\n/**\r\n * Compute recency timestamp from messages.\r\n * Returns max of: createdAt, unarchivedAt, last user message timestamp, last compacted message timestamp.\r\n * This is the single source of truth for workspace recency.\r\n *\r\n * Excludes idle compaction requests since they shouldn't hoist the workspace\r\n * in the sidebar (they're background operations, not user activity).\r\n *\r\n * @param unarchivedAt - When workspace was last unarchived (bumps to top of recency)\r\n */\r\nexport function computeRecencyFromMessages(\r\n  messages: MuxMessage[],\r\n  createdAt?: number,\r\n  unarchivedAt?: number\r\n): number | null {\r\n  const reversed = [...messages].reverse();\r\n  const lastUserMsg = reversed.find(\r\n    (m) => m.role === \"user\" && m.metadata?.timestamp && !isIdleCompactionRequest(m)\r\n  );\r\n  // Support both new enum (\"user\"|\"idle\") and legacy boolean (true)\r\n  const lastCompactedMsg = reversed.find((m) => m.metadata?.compacted && m.metadata?.timestamp);\r\n  const candidates = [\r\n    createdAt ?? null,\r\n    unarchivedAt ?? null,\r\n    lastUserMsg?.metadata?.timestamp ?? null,\r\n    lastCompactedMsg?.metadata?.timestamp ?? null,\r\n  ].filter((t): t is number => t !== null);\r\n  return candidates.length > 0 ? Math.max(...candidates) : null;\r\n}\r\n"]}