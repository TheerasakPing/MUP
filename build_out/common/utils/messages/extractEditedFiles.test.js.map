{"version":3,"file":"extractEditedFiles.test.js","sourceRoot":"","sources":["../../../../src/common/utils/messages/extractEditedFiles.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, it } from \"bun:test\";\r\nimport { createPatch } from \"diff\";\r\nimport { FILE_EDIT_DIFF_OMITTED_MESSAGE } from \"@/common/types/tools\";\r\nimport type { MuxMessage } from \"@/common/types/message\";\r\nimport { extractEditedFileDiffs, extractEditedFilePaths } from \"./extractEditedFiles\";\r\n\r\n/**\r\n * Helper to create a mock MuxMessage with file edit tool results.\r\n */\r\nfunction createAssistantMessage(\r\n  toolCalls: Array<{\r\n    toolName: string;\r\n    filePath: string;\r\n    diff: string;\r\n    uiOnlyDiff?: string;\r\n    success?: boolean;\r\n  }>\r\n): MuxMessage {\r\n  return {\r\n    id: `msg-${Math.random().toString(36).slice(2)}`,\r\n    role: \"assistant\",\r\n    parts: toolCalls.map((tc) => ({\r\n      type: \"dynamic-tool\" as const,\r\n      toolCallId: `tc-${Math.random().toString(36).slice(2)}`,\r\n      toolName: tc.toolName,\r\n      state: \"output-available\" as const,\r\n      input: { file_path: tc.filePath },\r\n      output: {\r\n        success: tc.success ?? true,\r\n        diff: tc.diff,\r\n        ...(tc.uiOnlyDiff\r\n          ? {\r\n              ui_only: {\r\n                file_edit: {\r\n                  diff: tc.uiOnlyDiff,\r\n                },\r\n              },\r\n            }\r\n          : {}),\r\n      },\r\n    })),\r\n  };\r\n}\r\n\r\n/**\r\n * Helper to generate a unified diff.\r\n */\r\nfunction makeDiff(filePath: string, oldContent: string, newContent: string): string {\r\n  return createPatch(filePath, oldContent, newContent, \"\", \"\", { context: 3 });\r\n}\r\n\r\ndescribe(\"extractEditedFilePaths\", () => {\r\n  it(\"should extract file paths from successful edits\", () => {\r\n    const messages: MuxMessage[] = [\r\n      createAssistantMessage([\r\n        {\r\n          toolName: \"file_edit_replace_string\",\r\n          filePath: \"/path/to/file1.ts\",\r\n          diff: makeDiff(\"/path/to/file1.ts\", \"old\", \"new\"),\r\n        },\r\n      ]),\r\n      createAssistantMessage([\r\n        {\r\n          toolName: \"file_edit_insert\",\r\n          filePath: \"/path/to/file2.ts\",\r\n          diff: makeDiff(\"/path/to/file2.ts\", \"\", \"content\"),\r\n        },\r\n      ]),\r\n    ];\r\n\r\n    const paths = extractEditedFilePaths(messages);\r\n    expect(paths).toEqual([\"/path/to/file2.ts\", \"/path/to/file1.ts\"]);\r\n  });\r\n\r\n  it(\"should ignore failed edits\", () => {\r\n    const messages: MuxMessage[] = [\r\n      createAssistantMessage([\r\n        {\r\n          toolName: \"file_edit_replace_string\",\r\n          filePath: \"/path/to/file1.ts\",\r\n          diff: \"\",\r\n          success: false,\r\n        },\r\n      ]),\r\n    ];\r\n\r\n    const paths = extractEditedFilePaths(messages);\r\n    expect(paths).toEqual([]);\r\n  });\r\n\r\n  it(\"should dedupe paths and return most recent first\", () => {\r\n    const messages: MuxMessage[] = [\r\n      createAssistantMessage([\r\n        {\r\n          toolName: \"file_edit_replace_string\",\r\n          filePath: \"/path/to/file1.ts\",\r\n          diff: makeDiff(\"/path/to/file1.ts\", \"v1\", \"v2\"),\r\n        },\r\n      ]),\r\n      createAssistantMessage([\r\n        {\r\n          toolName: \"file_edit_replace_string\",\r\n          filePath: \"/path/to/file2.ts\",\r\n          diff: makeDiff(\"/path/to/file2.ts\", \"old\", \"new\"),\r\n        },\r\n      ]),\r\n      createAssistantMessage([\r\n        {\r\n          toolName: \"file_edit_replace_string\",\r\n          filePath: \"/path/to/file1.ts\",\r\n          diff: makeDiff(\"/path/to/file1.ts\", \"v2\", \"v3\"),\r\n        },\r\n      ]),\r\n    ];\r\n\r\n    const paths = extractEditedFilePaths(messages);\r\n    // file1 was edited last, so it should be first\r\n    expect(paths).toEqual([\"/path/to/file1.ts\", \"/path/to/file2.ts\"]);\r\n  });\r\n});\r\n\r\ndescribe(\"extractEditedFileDiffs\", () => {\r\n  it(\"should extract single diff for a file\", () => {\r\n    const originalContent = \"line1\\nline2\\nline3\";\r\n    const newContent = \"line1\\nmodified\\nline3\";\r\n    const diff = makeDiff(\"/path/to/file.ts\", originalContent, newContent);\r\n\r\n    const messages: MuxMessage[] = [\r\n      createAssistantMessage([\r\n        {\r\n          toolName: \"file_edit_replace_string\",\r\n          filePath: \"/path/to/file.ts\",\r\n          diff,\r\n        },\r\n      ]),\r\n    ];\r\n\r\n    const result = extractEditedFileDiffs(messages);\r\n    expect(result).toHaveLength(1);\r\n    expect(result[0].path).toBe(\"/path/to/file.ts\");\r\n    expect(result[0].truncated).toBe(false);\r\n    // Single diff should be returned as-is\r\n    expect(result[0].diff).toBe(diff);\r\n  });\r\n\r\n  it(\"should prefer ui_only diffs when present\", () => {\r\n    const originalContent = \"line1\\nline2\\nline3\";\r\n    const newContent = \"line1\\nmodified\\nline3\";\r\n    const diff = makeDiff(\"/path/to/file.ts\", originalContent, newContent);\r\n\r\n    const messages: MuxMessage[] = [\r\n      createAssistantMessage([\r\n        {\r\n          toolName: \"file_edit_replace_string\",\r\n          filePath: \"/path/to/file.ts\",\r\n          diff: FILE_EDIT_DIFF_OMITTED_MESSAGE,\r\n          uiOnlyDiff: diff,\r\n        },\r\n      ]),\r\n    ];\r\n\r\n    const result = extractEditedFileDiffs(messages);\r\n    expect(result).toHaveLength(1);\r\n    expect(result[0].diff).toBe(diff);\r\n  });\r\n\r\n  it(\"should combine multiple non-overlapping diffs for the same file\", () => {\r\n    // Edit 1: change line 2\r\n    const original = \"line1\\nline2\\nline3\\nline4\\nline5\";\r\n    const afterEdit1 = \"line1\\nMODIFIED2\\nline3\\nline4\\nline5\";\r\n    const diff1 = makeDiff(\"/path/to/file.ts\", original, afterEdit1);\r\n\r\n    // Edit 2: change line 4\r\n    const afterEdit2 = \"line1\\nMODIFIED2\\nline3\\nMODIFIED4\\nline5\";\r\n    const diff2 = makeDiff(\"/path/to/file.ts\", afterEdit1, afterEdit2);\r\n\r\n    const messages: MuxMessage[] = [\r\n      createAssistantMessage([\r\n        {\r\n          toolName: \"file_edit_replace_string\",\r\n          filePath: \"/path/to/file.ts\",\r\n          diff: diff1,\r\n        },\r\n      ]),\r\n      createAssistantMessage([\r\n        {\r\n          toolName: \"file_edit_replace_string\",\r\n          filePath: \"/path/to/file.ts\",\r\n          diff: diff2,\r\n        },\r\n      ]),\r\n    ];\r\n\r\n    const result = extractEditedFileDiffs(messages);\r\n    expect(result).toHaveLength(1);\r\n    expect(result[0].path).toBe(\"/path/to/file.ts\");\r\n\r\n    // The combined diff should show original -> final\r\n    const expectedCombinedDiff = makeDiff(\"/path/to/file.ts\", original, afterEdit2);\r\n    expect(result[0].diff).toBe(expectedCombinedDiff);\r\n  });\r\n\r\n  it(\"should combine overlapping diffs (editing same lines twice)\", () => {\r\n    // Edit 1: change line 2\r\n    const original = \"line1\\nline2\\nline3\";\r\n    const afterEdit1 = \"line1\\nFIRST_EDIT\\nline3\";\r\n    const diff1 = makeDiff(\"/path/to/file.ts\", original, afterEdit1);\r\n\r\n    // Edit 2: change line 2 again (overlapping edit)\r\n    const afterEdit2 = \"line1\\nSECOND_EDIT\\nline3\";\r\n    const diff2 = makeDiff(\"/path/to/file.ts\", afterEdit1, afterEdit2);\r\n\r\n    const messages: MuxMessage[] = [\r\n      createAssistantMessage([\r\n        {\r\n          toolName: \"file_edit_replace_string\",\r\n          filePath: \"/path/to/file.ts\",\r\n          diff: diff1,\r\n        },\r\n      ]),\r\n      createAssistantMessage([\r\n        {\r\n          toolName: \"file_edit_replace_string\",\r\n          filePath: \"/path/to/file.ts\",\r\n          diff: diff2,\r\n        },\r\n      ]),\r\n    ];\r\n\r\n    const result = extractEditedFileDiffs(messages);\r\n    expect(result).toHaveLength(1);\r\n\r\n    // Combined diff should show original -> final (skipping intermediate state)\r\n    const expectedCombinedDiff = makeDiff(\"/path/to/file.ts\", original, afterEdit2);\r\n    expect(result[0].diff).toBe(expectedCombinedDiff);\r\n  });\r\n\r\n  it(\"should handle three sequential edits to the same lines\", () => {\r\n    const original = \"function foo() {\\n  return 1;\\n}\";\r\n    const v1 = \"function foo() {\\n  return 2;\\n}\";\r\n    const v2 = \"function foo() {\\n  return 3;\\n}\";\r\n    const v3 = \"function foo() {\\n  return 42;\\n}\";\r\n\r\n    const diff1 = makeDiff(\"/path/to/file.ts\", original, v1);\r\n    const diff2 = makeDiff(\"/path/to/file.ts\", v1, v2);\r\n    const diff3 = makeDiff(\"/path/to/file.ts\", v2, v3);\r\n\r\n    const messages: MuxMessage[] = [\r\n      createAssistantMessage([\r\n        { toolName: \"file_edit_replace_string\", filePath: \"/path/to/file.ts\", diff: diff1 },\r\n      ]),\r\n      createAssistantMessage([\r\n        { toolName: \"file_edit_replace_string\", filePath: \"/path/to/file.ts\", diff: diff2 },\r\n      ]),\r\n      createAssistantMessage([\r\n        { toolName: \"file_edit_replace_string\", filePath: \"/path/to/file.ts\", diff: diff3 },\r\n      ]),\r\n    ];\r\n\r\n    const result = extractEditedFileDiffs(messages);\r\n    expect(result).toHaveLength(1);\r\n\r\n    // Should show original -> final\r\n    const expectedCombinedDiff = makeDiff(\"/path/to/file.ts\", original, v3);\r\n    expect(result[0].diff).toBe(expectedCombinedDiff);\r\n  });\r\n\r\n  it(\"should handle edits that add and then modify new lines\", () => {\r\n    // Start with empty file\r\n    const original = \"\";\r\n    const afterInsert = \"line1\\nline2\\nline3\";\r\n    const diff1 = makeDiff(\"/path/to/file.ts\", original, afterInsert);\r\n\r\n    // Then modify one of the inserted lines\r\n    const afterModify = \"line1\\nMODIFIED\\nline3\";\r\n    const diff2 = makeDiff(\"/path/to/file.ts\", afterInsert, afterModify);\r\n\r\n    const messages: MuxMessage[] = [\r\n      createAssistantMessage([\r\n        { toolName: \"file_edit_insert\", filePath: \"/path/to/file.ts\", diff: diff1 },\r\n      ]),\r\n      createAssistantMessage([\r\n        { toolName: \"file_edit_replace_string\", filePath: \"/path/to/file.ts\", diff: diff2 },\r\n      ]),\r\n    ];\r\n\r\n    const result = extractEditedFileDiffs(messages);\r\n    expect(result).toHaveLength(1);\r\n\r\n    // Combined diff should show empty -> final\r\n    const expectedCombinedDiff = makeDiff(\"/path/to/file.ts\", original, afterModify);\r\n    expect(result[0].diff).toBe(expectedCombinedDiff);\r\n  });\r\n\r\n  it(\"should handle multiple files with different edit counts\", () => {\r\n    const file1Original = \"a\";\r\n    const file1Final = \"b\";\r\n    const diff1 = makeDiff(\"/file1.ts\", file1Original, file1Final);\r\n\r\n    const file2Original = \"x\";\r\n    const file2V1 = \"y\";\r\n    const file2Final = \"z\";\r\n    const diff2a = makeDiff(\"/file2.ts\", file2Original, file2V1);\r\n    const diff2b = makeDiff(\"/file2.ts\", file2V1, file2Final);\r\n\r\n    const messages: MuxMessage[] = [\r\n      createAssistantMessage([\r\n        { toolName: \"file_edit_replace_string\", filePath: \"/file1.ts\", diff: diff1 },\r\n      ]),\r\n      createAssistantMessage([\r\n        { toolName: \"file_edit_replace_string\", filePath: \"/file2.ts\", diff: diff2a },\r\n      ]),\r\n      createAssistantMessage([\r\n        { toolName: \"file_edit_replace_string\", filePath: \"/file2.ts\", diff: diff2b },\r\n      ]),\r\n    ];\r\n\r\n    const result = extractEditedFileDiffs(messages);\r\n    expect(result).toHaveLength(2);\r\n\r\n    // file2 was edited last, so it should be first\r\n    expect(result[0].path).toBe(\"/file2.ts\");\r\n    expect(result[0].diff).toBe(makeDiff(\"/file2.ts\", file2Original, file2Final));\r\n\r\n    expect(result[1].path).toBe(\"/file1.ts\");\r\n    expect(result[1].diff).toBe(diff1);\r\n  });\r\n\r\n  it(\"should ignore failed edits when combining\", () => {\r\n    const original = \"original\";\r\n    const afterSuccess = \"modified\";\r\n    const successDiff = makeDiff(\"/file.ts\", original, afterSuccess);\r\n\r\n    const messages: MuxMessage[] = [\r\n      createAssistantMessage([\r\n        { toolName: \"file_edit_replace_string\", filePath: \"/file.ts\", diff: successDiff },\r\n      ]),\r\n      createAssistantMessage([\r\n        {\r\n          toolName: \"file_edit_replace_string\",\r\n          filePath: \"/file.ts\",\r\n          diff: \"\",\r\n          success: false,\r\n        },\r\n      ]),\r\n    ];\r\n\r\n    const result = extractEditedFileDiffs(messages);\r\n    expect(result).toHaveLength(1);\r\n    expect(result[0].diff).toBe(successDiff);\r\n  });\r\n\r\n  it(\"should handle edit that deletes content from edited lines\", () => {\r\n    // Edit 1: add some content\r\n    const original = \"start\\nend\";\r\n    const afterAdd = \"start\\nmiddle1\\nmiddle2\\nend\";\r\n    const diff1 = makeDiff(\"/file.ts\", original, afterAdd);\r\n\r\n    // Edit 2: remove some of the added content\r\n    const afterDelete = \"start\\nmiddle1\\nend\";\r\n    const diff2 = makeDiff(\"/file.ts\", afterAdd, afterDelete);\r\n\r\n    const messages: MuxMessage[] = [\r\n      createAssistantMessage([\r\n        { toolName: \"file_edit_replace_string\", filePath: \"/file.ts\", diff: diff1 },\r\n      ]),\r\n      createAssistantMessage([\r\n        { toolName: \"file_edit_replace_string\", filePath: \"/file.ts\", diff: diff2 },\r\n      ]),\r\n    ];\r\n\r\n    const result = extractEditedFileDiffs(messages);\r\n    expect(result).toHaveLength(1);\r\n\r\n    const expectedCombinedDiff = makeDiff(\"/file.ts\", original, afterDelete);\r\n    expect(result[0].diff).toBe(expectedCombinedDiff);\r\n  });\r\n\r\n  it(\"should combine non-overlapping diffs in large files with separate hunks\", () => {\r\n    // Create a file large enough that edits at top and bottom produce separate hunks\r\n    // (more than 6 lines apart, so the 3-line context doesn't overlap)\r\n    const lines = Array.from({ length: 20 }, (_, i) => `line${i + 1}`);\r\n    const original = lines.join(\"\\n\");\r\n\r\n    // Edit 1: change line 2 (near the top)\r\n    const linesAfterEdit1 = [...lines];\r\n    linesAfterEdit1[1] = \"MODIFIED_LINE2\";\r\n    const afterEdit1 = linesAfterEdit1.join(\"\\n\");\r\n    const diff1 = makeDiff(\"/large-file.ts\", original, afterEdit1);\r\n\r\n    // Edit 2: change line 18 (near the bottom) - far enough to be a separate hunk\r\n    const linesAfterEdit2 = [...linesAfterEdit1];\r\n    linesAfterEdit2[17] = \"MODIFIED_LINE18\";\r\n    const afterEdit2 = linesAfterEdit2.join(\"\\n\");\r\n    const diff2 = makeDiff(\"/large-file.ts\", afterEdit1, afterEdit2);\r\n\r\n    const messages: MuxMessage[] = [\r\n      createAssistantMessage([\r\n        { toolName: \"file_edit_replace_string\", filePath: \"/large-file.ts\", diff: diff1 },\r\n      ]),\r\n      createAssistantMessage([\r\n        { toolName: \"file_edit_replace_string\", filePath: \"/large-file.ts\", diff: diff2 },\r\n      ]),\r\n    ];\r\n\r\n    const result = extractEditedFileDiffs(messages);\r\n    expect(result).toHaveLength(1);\r\n    expect(result[0].path).toBe(\"/large-file.ts\");\r\n\r\n    // The combined diff should show original -> final with both edits\r\n    const expectedCombinedDiff = makeDiff(\"/large-file.ts\", original, afterEdit2);\r\n    expect(result[0].diff).toBe(expectedCombinedDiff);\r\n  });\r\n});\r\n"]}