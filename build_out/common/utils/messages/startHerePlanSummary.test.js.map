{"version":3,"file":"startHerePlanSummary.test.js","sourceRoot":"","sources":["../../../../src/common/utils/messages/startHerePlanSummary.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, it } from \"bun:test\";\nimport type { MuxMessage } from \"@/common/types/message\";\nimport { hasStartHerePlanSummary, isStartHerePlanSummaryMessage } from \"./startHerePlanSummary\";\n\nfunction createTextMessage(overrides: Partial<MuxMessage>): MuxMessage {\n  return {\n    id: overrides.id ?? `msg-${Math.random().toString(36).slice(2)}`,\n    role: overrides.role ?? \"assistant\",\n    parts: overrides.parts ?? [{ type: \"text\", text: \"hello\" }],\n    metadata: overrides.metadata,\n  };\n}\n\ndescribe(\"isStartHerePlanSummaryMessage\", () => {\n  it(\"returns true for Start Here summary messages that include plan content\", () => {\n    const msg = createTextMessage({\n      id: \"start-here-123\",\n      role: \"assistant\",\n      metadata: { compacted: \"user\", agentId: \"plan\" },\n      parts: [\n        {\n          type: \"text\",\n          text: \"# My Plan\\n\\n## Step\\n- Do the thing\\n\\n---\\n\\n*Plan file preserved at:* `~/.mux/plans/demo.md`\",\n        },\n      ],\n    });\n\n    expect(isStartHerePlanSummaryMessage(msg)).toBe(true);\n  });\n\n  it(\"returns false for Start Here summaries that only include the placeholder\", () => {\n    const msg = createTextMessage({\n      id: \"start-here-123\",\n      role: \"assistant\",\n      metadata: { compacted: \"user\", agentId: \"plan\" },\n      parts: [\n        {\n          type: \"text\",\n          text: [\n            \"# My Plan\",\n            \"\",\n            \"*Plan saved to /tmp/demo.md*\",\n            \"\",\n            \"Note: This chat already contains the full plan; no need to re-open the plan file.\",\n            \"\",\n            \"---\",\n            \"\",\n            \"*Plan file preserved at:* `/tmp/demo.md`\",\n          ].join(\"\\n\"),\n        },\n      ],\n    });\n\n    expect(isStartHerePlanSummaryMessage(msg)).toBe(false);\n  });\n\n  it(\"returns false for other Start Here messages from the plan agent\", () => {\n    const msg = createTextMessage({\n      id: \"start-here-123\",\n      role: \"assistant\",\n      metadata: { compacted: \"user\", agentId: \"plan\" },\n      parts: [{ type: \"text\", text: \"Some other message\" }],\n    });\n\n    expect(isStartHerePlanSummaryMessage(msg)).toBe(false);\n  });\n\n  it(\"returns false for normal assistant messages\", () => {\n    const msg = createTextMessage({\n      id: \"msg-1\",\n      role: \"assistant\",\n      metadata: { agentId: \"plan\" },\n      parts: [{ type: \"text\", text: \"# My Plan\" }],\n    });\n\n    expect(isStartHerePlanSummaryMessage(msg)).toBe(false);\n  });\n});\n\ndescribe(\"hasStartHerePlanSummary\", () => {\n  it(\"returns true when a Start Here plan summary exists anywhere in history\", () => {\n    const messages: MuxMessage[] = [\n      createTextMessage({\n        id: \"start-here-123\",\n        role: \"assistant\",\n        metadata: { compacted: \"user\", agentId: \"plan\" },\n        parts: [\n          {\n            type: \"text\",\n            text: \"# My Plan\\n\\n## Step\\n- Do the thing\\n\\n---\\n\\n*Plan file preserved at:* `~/.mux/plans/demo.md`\",\n          },\n        ],\n      }),\n      createTextMessage({\n        id: \"user-1\",\n        role: \"user\",\n        parts: [{ type: \"text\", text: \"Implement the plan\" }],\n      }),\n      createTextMessage({ id: \"msg-2\", role: \"assistant\", metadata: { agentId: \"exec\" } }),\n    ];\n\n    expect(hasStartHerePlanSummary(messages)).toBe(true);\n  });\n});\n"]}