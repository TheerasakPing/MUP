{"version":3,"file":"models.test.js","sourceRoot":"","sources":["../../../../src/common/utils/ai/models.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, it, expect } from \"bun:test\";\r\nimport {\r\n  normalizeGatewayModel,\r\n  getModelName,\r\n  supports1MContext,\r\n  isValidModelFormat,\r\n  resolveModelAlias,\r\n} from \"./models\";\r\n\r\ndescribe(\"normalizeGatewayModel\", () => {\r\n  it(\"should convert mux-gateway:provider/model to provider:model\", () => {\r\n    expect(normalizeGatewayModel(\"mux-gateway:anthropic/claude-opus-4-5\")).toBe(\r\n      \"anthropic:claude-opus-4-5\"\r\n    );\r\n    expect(normalizeGatewayModel(\"mux-gateway:openai/gpt-4o\")).toBe(\"openai:gpt-4o\");\r\n    expect(normalizeGatewayModel(\"mux-gateway:google/gemini-2.5-pro\")).toBe(\r\n      \"google:gemini-2.5-pro\"\r\n    );\r\n  });\r\n\r\n  it(\"should return non-gateway strings unchanged\", () => {\r\n    expect(normalizeGatewayModel(\"anthropic:claude-opus-4-5\")).toBe(\"anthropic:claude-opus-4-5\");\r\n    expect(normalizeGatewayModel(\"openai:gpt-4o\")).toBe(\"openai:gpt-4o\");\r\n    expect(normalizeGatewayModel(\"claude-opus-4-5\")).toBe(\"claude-opus-4-5\");\r\n  });\r\n\r\n  it(\"should return malformed gateway strings unchanged\", () => {\r\n    // No slash in the inner part\r\n    expect(normalizeGatewayModel(\"mux-gateway:no-slash-here\")).toBe(\"mux-gateway:no-slash-here\");\r\n  });\r\n});\r\n\r\ndescribe(\"getModelName\", () => {\r\n  it(\"should extract model name from provider:model format\", () => {\r\n    expect(getModelName(\"anthropic:claude-opus-4-5\")).toBe(\"claude-opus-4-5\");\r\n    expect(getModelName(\"openai:gpt-4o\")).toBe(\"gpt-4o\");\r\n  });\r\n\r\n  it(\"should handle mux-gateway format\", () => {\r\n    expect(getModelName(\"mux-gateway:anthropic/claude-opus-4-5\")).toBe(\"claude-opus-4-5\");\r\n    expect(getModelName(\"mux-gateway:openai/gpt-4o\")).toBe(\"gpt-4o\");\r\n  });\r\n\r\n  it(\"should return full string if no colon\", () => {\r\n    expect(getModelName(\"claude-opus-4-5\")).toBe(\"claude-opus-4-5\");\r\n  });\r\n});\r\n\r\ndescribe(\"supports1MContext\", () => {\r\n  it(\"should return true for Anthropic Sonnet 4 models\", () => {\r\n    expect(supports1MContext(\"anthropic:claude-sonnet-4-5\")).toBe(true);\r\n    expect(supports1MContext(\"anthropic:claude-sonnet-4-5-20250514\")).toBe(true);\r\n    expect(supports1MContext(\"anthropic:claude-sonnet-4-20250514\")).toBe(true);\r\n  });\r\n\r\n  it(\"should return true for mux-gateway Sonnet 4 models\", () => {\r\n    expect(supports1MContext(\"mux-gateway:anthropic/claude-sonnet-4-5\")).toBe(true);\r\n    expect(supports1MContext(\"mux-gateway:anthropic/claude-sonnet-4-5-20250514\")).toBe(true);\r\n  });\r\n\r\n  it(\"should return false for non-Anthropic models\", () => {\r\n    expect(supports1MContext(\"openai:gpt-4o\")).toBe(false);\r\n    expect(supports1MContext(\"mux-gateway:openai/gpt-4o\")).toBe(false);\r\n  });\r\n\r\n  it(\"should return true for Opus 4.6 models\", () => {\r\n    expect(supports1MContext(\"anthropic:claude-opus-4-6\")).toBe(true);\r\n    expect(supports1MContext(\"mux-gateway:anthropic/claude-opus-4-6\")).toBe(true);\r\n  });\r\n\r\n  it(\"should return false for Anthropic non-Sonnet-4 / non-Opus-4.6 models\", () => {\r\n    expect(supports1MContext(\"anthropic:claude-opus-4-5\")).toBe(false);\r\n    expect(supports1MContext(\"anthropic:claude-haiku-4-5\")).toBe(false);\r\n    expect(supports1MContext(\"mux-gateway:anthropic/claude-opus-4-5\")).toBe(false);\r\n  });\r\n\r\n  it(\"should return true for Opus 4.6 models\", () => {\r\n    expect(supports1MContext(\"anthropic:claude-opus-4-6\")).toBe(true);\r\n    expect(supports1MContext(\"anthropic:claude-opus-4-6-20260201\")).toBe(true);\r\n    expect(supports1MContext(\"mux-gateway:anthropic/claude-opus-4-6\")).toBe(true);\r\n  });\r\n});\r\n\r\ndescribe(\"isValidModelFormat\", () => {\r\n  it(\"returns true for valid model formats\", () => {\r\n    expect(isValidModelFormat(\"anthropic:claude-sonnet-4-5\")).toBe(true);\r\n    expect(isValidModelFormat(\"openai:gpt-5.2\")).toBe(true);\r\n    expect(isValidModelFormat(\"google:gemini-3-pro-preview\")).toBe(true);\r\n    expect(isValidModelFormat(\"mux-gateway:anthropic/claude-opus-4-5\")).toBe(true);\r\n    // Ollama-style model names with colons in the model ID\r\n    expect(isValidModelFormat(\"ollama:gpt-oss:20b\")).toBe(true);\r\n  });\r\n\r\n  it(\"returns false for invalid model formats\", () => {\r\n    // Missing colon\r\n    expect(isValidModelFormat(\"gpt\")).toBe(false);\r\n    expect(isValidModelFormat(\"sonnet\")).toBe(false);\r\n    expect(isValidModelFormat(\"badmodel\")).toBe(false);\r\n\r\n    // Colon at start or end\r\n    expect(isValidModelFormat(\":model\")).toBe(false);\r\n    expect(isValidModelFormat(\"provider:\")).toBe(false);\r\n\r\n    // Empty string\r\n    expect(isValidModelFormat(\"\")).toBe(false);\r\n  });\r\n});\r\n\r\ndescribe(\"resolveModelAlias\", () => {\r\n  it(\"resolves known aliases to full model strings\", () => {\r\n    expect(resolveModelAlias(\"haiku\")).toBe(\"anthropic:claude-haiku-4-5\");\r\n    expect(resolveModelAlias(\"sonnet\")).toBe(\"anthropic:claude-sonnet-4-5\");\r\n    expect(resolveModelAlias(\"opus\")).toBe(\"anthropic:claude-opus-4-6\");\r\n    expect(resolveModelAlias(\"grok\")).toBe(\"xai:grok-4-1-fast\");\r\n    expect(resolveModelAlias(\"codex\")).toBe(\"openai:gpt-5.2-codex\");\r\n    expect(resolveModelAlias(\"codex-5.1\")).toBe(\"openai:gpt-5.1-codex\");\r\n  });\r\n\r\n  it(\"returns non-alias strings unchanged\", () => {\r\n    expect(resolveModelAlias(\"anthropic:custom-model\")).toBe(\"anthropic:custom-model\");\r\n    expect(resolveModelAlias(\"openai:gpt-5.2\")).toBe(\"openai:gpt-5.2\");\r\n    expect(resolveModelAlias(\"unknown\")).toBe(\"unknown\");\r\n  });\r\n});\r\n"]}