{"version":3,"file":"toolHookEnv.test.js","sourceRoot":"","sources":["../../../../src/common/utils/tools/toolHookEnv.test.ts"],"names":[],"mappings":";;AAAA,+CAA0D;AAE1D,QAAQ,CAAC,2BAA2B,EAAE,GAAG,EAAE,CAAC;IAC1C,EAAE,CAAC,0BAA0B,EAAE,GAAG,EAAE,CAAC;QACnC,MAAM,CAAC,IAAA,uCAAyB,EAAC,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE,gBAAgB,CAAC,CAAC,CAAC,OAAO,CAAC;YACjF,qBAAqB,EAAE,SAAS;SACjC,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,EAAE,CAAC,yBAAyB,EAAE,GAAG,EAAE,CAAC;QAClC,MAAM,CACJ,IAAA,uCAAyB,EACvB;YACE,IAAI,EAAE;gBACJ,OAAO,EAAE,EAAE;aACZ;SACF,EACD,gBAAgB,CACjB,CACF,CAAC,OAAO,CAAC;YACR,2BAA2B,EAAE,IAAI;SAClC,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,EAAE,CAAC,uCAAuC,EAAE,GAAG,EAAE,CAAC;QAChD,MAAM,CACJ,IAAA,uCAAyB,EACvB;YACE,KAAK,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC;SAClB,EACD,gBAAgB,CACjB,CACF,CAAC,OAAO,CAAC;YACR,0BAA0B,EAAE,GAAG;YAC/B,sBAAsB,EAAE,GAAG;YAC3B,sBAAsB,EAAE,GAAG;SAC5B,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,EAAE,CAAC,4BAA4B,EAAE,GAAG,EAAE,CAAC;QACrC,MAAM,CACJ,IAAA,uCAAyB,EACvB;YACE,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC;SACtC,EACD,gBAAgB,CACjB,CACF,CAAC,OAAO,CAAC;YACR,0BAA0B,EAAE,GAAG;YAC/B,2BAA2B,EAAE,GAAG;YAChC,2BAA2B,EAAE,GAAG;SACjC,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,EAAE,CAAC,0CAA0C,EAAE,GAAG,EAAE,CAAC;QACnD,MAAM,CAAC,IAAA,uCAAyB,EAAC,EAAE,GAAG,EAAE,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,QAAQ,CAAC,CAAC,CAAC,OAAO,CAAC;YAC3E,UAAU,EAAE,IAAI;YAChB,WAAW,EAAE,MAAM;SACpB,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,EAAE,CAAC,oDAAoD,EAAE,GAAG,EAAE,CAAC;QAC7D,MAAM,CAAC,IAAA,uCAAyB,EAAC,OAAO,EAAE,gBAAgB,CAAC,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;IAAA,CAC1E,CAAC,CAAC;IAEH,EAAE,CAAC,oDAAoD,EAAE,GAAG,EAAE,CAAC;QAC7D,MAAM,CAAC,IAAA,uCAAyB,EAAC,EAAE,KAAK,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC;YACxE,WAAW,EAAE,GAAG;SACjB,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,EAAE,CAAC,uDAAuD,EAAE,GAAG,EAAE,CAAC;QAChE,MAAM,CAAC,IAAA,uCAAyB,EAAC,EAAE,QAAQ,EAAE,GAAG,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC;YAClE,aAAa,EAAE,GAAG;SACnB,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,EAAE,CAAC,sDAAsD,EAAE,GAAG,EAAE,CAAC;QAC/D,MAAM,CAAC,IAAA,uCAAyB,EAAC,EAAE,GAAG,EAAE,GAAG,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC;YAC7D,SAAS,EAAE,GAAG;SACf,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,EAAE,CAAC,6DAA6D,EAAE,GAAG,EAAE,CAAC;QACtE,MAAM,CACJ,IAAA,uCAAyB,EACvB;YACE,GAAG,EAAE,QAAQ;YACb,EAAE,EAAE,GAAG;SACR,EACD,KAAK,EACL,EAAE,cAAc,EAAE,CAAC,EAAE,CACtB,CACF,CAAC,OAAO,CAAC;YACR,MAAM,EAAE,GAAG;SACZ,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { flattenToolHookValueToEnv } from \"./toolHookEnv\";\r\n\r\ndescribe(\"flattenToolHookValueToEnv\", () => {\r\n  it(\"flattens a simple object\", () => {\r\n    expect(flattenToolHookValueToEnv({ script: \"echo hi\" }, \"MUX_TOOL_INPUT\")).toEqual({\r\n      MUX_TOOL_INPUT_SCRIPT: \"echo hi\",\r\n    });\r\n  });\r\n\r\n  it(\"flattens nested objects\", () => {\r\n    expect(\r\n      flattenToolHookValueToEnv(\r\n        {\r\n          opts: {\r\n            timeout: 30,\r\n          },\r\n        },\r\n        \"MUX_TOOL_INPUT\"\r\n      )\r\n    ).toEqual({\r\n      MUX_TOOL_INPUT_OPTS_TIMEOUT: \"30\",\r\n    });\r\n  });\r\n\r\n  it(\"flattens arrays and provides a _COUNT\", () => {\r\n    expect(\r\n      flattenToolHookValueToEnv(\r\n        {\r\n          items: [\"a\", \"b\"],\r\n        },\r\n        \"MUX_TOOL_INPUT\"\r\n      )\r\n    ).toEqual({\r\n      MUX_TOOL_INPUT_ITEMS_COUNT: \"2\",\r\n      MUX_TOOL_INPUT_ITEMS_0: \"a\",\r\n      MUX_TOOL_INPUT_ITEMS_1: \"b\",\r\n    });\r\n  });\r\n\r\n  it(\"flattens arrays of objects\", () => {\r\n    expect(\r\n      flattenToolHookValueToEnv(\r\n        {\r\n          items: [{ name: \"x\" }, { name: \"y\" }],\r\n        },\r\n        \"MUX_TOOL_INPUT\"\r\n      )\r\n    ).toEqual({\r\n      MUX_TOOL_INPUT_ITEMS_COUNT: \"2\",\r\n      MUX_TOOL_INPUT_ITEMS_0_NAME: \"x\",\r\n      MUX_TOOL_INPUT_ITEMS_1_NAME: \"y\",\r\n    });\r\n  });\r\n\r\n  it(\"converts numbers and booleans to strings\", () => {\r\n    expect(flattenToolHookValueToEnv({ num: 42, flag: true }, \"PREFIX\")).toEqual({\r\n      PREFIX_NUM: \"42\",\r\n      PREFIX_FLAG: \"true\",\r\n    });\r\n  });\r\n\r\n  it(\"does not emit a root env var for non-object values\", () => {\r\n    expect(flattenToolHookValueToEnv(\"hello\", \"MUX_TOOL_INPUT\")).toEqual({});\r\n  });\r\n\r\n  it(\"sanitizes keys so env var names are shell-friendly\", () => {\r\n    expect(flattenToolHookValueToEnv({ \"a-b\": { \"c.d\": 1 } }, \"PFX\")).toEqual({\r\n      PFX_A_B_C_D: \"1\",\r\n    });\r\n  });\r\n\r\n  it(\"splits camelCase keys into underscore-separated words\", () => {\r\n    expect(flattenToolHookValueToEnv({ filePath: \"x\" }, \"PFX\")).toEqual({\r\n      PFX_FILE_PATH: \"x\",\r\n    });\r\n  });\r\n\r\n  it(\"does not collapse empty key parts back to the prefix\", () => {\r\n    expect(flattenToolHookValueToEnv({ \" \": \"x\" }, \"PFX\")).toEqual({\r\n      PFX_EMPTY: \"x\",\r\n    });\r\n  });\r\n\r\n  it(\"omits values larger than maxValueLength (does not truncate)\", () => {\r\n    expect(\r\n      flattenToolHookValueToEnv(\r\n        {\r\n          big: \"abcdef\",\r\n          ok: \"x\",\r\n        },\r\n        \"PFX\",\r\n        { maxValueLength: 5 }\r\n      )\r\n    ).toEqual({\r\n      PFX_OK: \"x\",\r\n    });\r\n  });\r\n});\r\n"]}