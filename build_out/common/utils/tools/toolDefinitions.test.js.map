{"version":3,"file":"toolDefinitions.test.js","sourceRoot":"","sources":["../../../../src/common/utils/tools/toolDefinitions.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { TaskToolArgsSchema, TOOL_DEFINITIONS } from \"./toolDefinitions\";\n\ndescribe(\"TOOL_DEFINITIONS\", () => {\n  it(\"accepts custom subagent_type IDs (deprecated alias)\", () => {\n    const parsed = TaskToolArgsSchema.safeParse({\n      subagent_type: \"potato\",\n      prompt: \"do the thing\",\n      title: \"Test\",\n      run_in_background: true,\n    });\n\n    expect(parsed.success).toBe(true);\n    if (parsed.success) {\n      expect(parsed.data.subagent_type).toBe(\"potato\");\n    }\n  });\n\n  it(\"accepts bash tool calls using command (alias for script)\", () => {\n    const parsed = TOOL_DEFINITIONS.bash.schema.safeParse({\n      command: \"ls\",\n      timeout_secs: 60,\n      run_in_background: false,\n      display_name: \"Test\",\n    });\n\n    expect(parsed.success).toBe(true);\n    if (parsed.success) {\n      expect(parsed.data.script).toBe(\"ls\");\n      expect(\"command\" in parsed.data).toBe(false);\n    }\n  });\n\n  it(\"prefers script when both script and command are provided\", () => {\n    const parsed = TOOL_DEFINITIONS.bash.schema.safeParse({\n      script: \"echo hi\",\n      command: \"ls\",\n      timeout_secs: 60,\n      run_in_background: false,\n      display_name: \"Test\",\n    });\n\n    expect(parsed.success).toBe(true);\n    if (parsed.success) {\n      expect(parsed.data.script).toBe(\"echo hi\");\n    }\n  });\n\n  it(\"rejects bash tool calls missing both script and command\", () => {\n    const parsed = TOOL_DEFINITIONS.bash.schema.safeParse({\n      timeout_secs: 60,\n      run_in_background: false,\n      display_name: \"Test\",\n    });\n\n    expect(parsed.success).toBe(false);\n  });\n\n  it(\"asks for clarification via ask_user_question (instead of emitting open questions)\", () => {\n    expect(TOOL_DEFINITIONS.ask_user_question.description).toContain(\n      \"MUST be used when you need user clarification\"\n    );\n    expect(TOOL_DEFINITIONS.ask_user_question.description).toContain(\n      \"Do not output a list of open questions\"\n    );\n  });\n\n  it(\"encourages compact task briefs when spawning sub-agents\", () => {\n    expect(TOOL_DEFINITIONS.task.description).toContain(\"compact task brief\");\n    expect(TOOL_DEFINITIONS.task.description).toContain(\"plan file\");\n  });\n\n  it(\"accepts ask_user_question headers longer than 12 characters\", () => {\n    const parsed = TOOL_DEFINITIONS.ask_user_question.schema.safeParse({\n      questions: [\n        {\n          question: \"How should docs be formatted?\",\n          header: \"Documentation\",\n          options: [\n            { label: \"Inline\", description: \"Explain in code comments\" },\n            { label: \"Sections\", description: \"Separate markdown sections\" },\n          ],\n          multiSelect: false,\n        },\n        {\n          question: \"Should we show error handling?\",\n          header: \"Error Handling\",\n          options: [\n            { label: \"Minimal\", description: \"Let errors bubble\" },\n            { label: \"Basic\", description: \"Catch common errors\" },\n          ],\n          multiSelect: false,\n        },\n      ],\n    });\n\n    expect(parsed.success).toBe(true);\n  });\n\n  it(\"rejects task(kind=bash) tool calls (bash is a separate tool)\", () => {\n    const parsed = TOOL_DEFINITIONS.task.schema.safeParse({\n      // Legacy shape; should not validate against the current task schema.\n      kind: \"bash\",\n      script: \"ls\",\n      timeout_secs: 100000,\n      run_in_background: false,\n    });\n\n    expect(parsed.success).toBe(false);\n  });\n\n  it(\"discourages repeating plan contents or plan file location after propose_plan\", () => {\n    expect(TOOL_DEFINITIONS.propose_plan.description).toContain(\"do not paste the plan contents\");\n    expect(TOOL_DEFINITIONS.propose_plan.description).toContain(\"plan file path\");\n  });\n});\n"]}