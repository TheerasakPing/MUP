{"version":3,"file":"toolDefinitions.js","sourceRoot":"","sources":["../../../../src/common/utils/tools/toolDefinitions.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Tool definitions module - Frontend-safe\r\n *\r\n * Single source of truth for all tool definitions.\r\n * Zod schemas are defined here and JSON schemas are auto-generated.\r\n *\r\n * ## Schema convention: `.nullish()` for optional tool parameters\r\n *\r\n * All optional fields in **tool input schemas** (i.e. parameters the model\r\n * provides) MUST use `.nullish()` instead of `.optional()`.\r\n *\r\n * Why: OpenAI's Responses API normalizes tool schemas into strict mode, which\r\n * forces every field into `required` and expects optional fields to accept\r\n * `null` (via `\"type\": [\"string\", \"null\"]`).  Using `.optional()` alone\r\n * produces a schema without a null type, so the model is forced to hallucinate\r\n * values for fields it would normally skip.  `.nullish()` (= `.optional().nullable()`)\r\n * emits both `null` in the type union AND keeps the field out of `required`,\r\n * which satisfies strict-mode providers (OpenAI) while remaining compatible\r\n * with non-strict providers (Anthropic, Google).\r\n *\r\n * Implementation handlers that consume these values should use `!= null`\r\n * (loose equality) instead of `!== undefined` to correctly treat both\r\n * `null` and `undefined` as \"not provided\".\r\n *\r\n * This does NOT apply to tool **output/result** schemas — those are constructed\r\n * by our own backend code and always use `undefined` for absent fields.\r\n */\r\n\r\nimport { z } from \"zod\";\r\nimport { AgentIdSchema, AgentSkillPackageSchema, SkillNameSchema } from \"@/common/orpc/schemas\";\r\nimport {\r\n  BASH_HARD_MAX_LINES,\r\n  BASH_MAX_LINE_BYTES,\r\n  BASH_MAX_TOTAL_BYTES,\r\n  STATUS_MESSAGE_MAX_LENGTH,\r\n  WEB_FETCH_MAX_OUTPUT_BYTES,\r\n} from \"@/common/constants/toolLimits\";\r\nimport { TOOL_EDIT_WARNING } from \"@/common/types/tools\";\r\nimport { SYSTEM1_BASH_OUTPUT_COMPACTION_LIMITS } from \"@/common/types/tasks\";\r\n\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\";\r\n\r\n// -----------------------------------------------------------------------------\r\n// ask_user_question (plan-mode interactive questions)\r\n// -----------------------------------------------------------------------------\r\n\r\nexport const AskUserQuestionOptionSchema = z\r\n  .object({\r\n    label: z.string().min(1),\r\n    description: z.string().min(1),\r\n  })\r\n  .strict();\r\n\r\nexport const AskUserQuestionQuestionSchema = z\r\n  .object({\r\n    question: z.string().min(1),\r\n    header: z.string().min(1).max(32).describe(\"Short label shown in the UI (keep it concise)\"),\r\n    options: z.array(AskUserQuestionOptionSchema).min(2).max(4),\r\n    multiSelect: z.boolean(),\r\n  })\r\n  .strict()\r\n  .superRefine((question, ctx) => {\r\n    const labels = question.options.map((o) => o.label);\r\n    const labelSet = new Set(labels);\r\n    if (labelSet.size !== labels.length) {\r\n      ctx.addIssue({\r\n        code: z.ZodIssueCode.custom,\r\n        message: \"Option labels must be unique within a question\",\r\n        path: [\"options\"],\r\n      });\r\n    }\r\n\r\n    // Claude Code provides \"Other\" automatically; do not include it explicitly.\r\n    if (labels.some((label) => label.trim().toLowerCase() === \"other\")) {\r\n      ctx.addIssue({\r\n        code: z.ZodIssueCode.custom,\r\n        message: \"Do not include an 'Other' option; it is provided automatically\",\r\n        path: [\"options\"],\r\n      });\r\n    }\r\n  });\r\n\r\nconst AskUserQuestionUiOnlySchema = z.object({\r\n  questions: z.array(AskUserQuestionQuestionSchema),\r\n  answers: z.record(z.string(), z.string()),\r\n});\r\n\r\nconst ToolOutputUiOnlySchema = z.object({\r\n  ask_user_question: AskUserQuestionUiOnlySchema.optional(),\r\n  file_edit: z\r\n    .object({\r\n      diff: z.string(),\r\n    })\r\n    .optional(),\r\n  notify: z\r\n    .object({\r\n      notifiedVia: z.enum([\"electron\", \"browser\"]),\r\n      workspaceId: z.string().optional(),\r\n    })\r\n    .optional(),\r\n});\r\n\r\nconst ToolOutputUiOnlyFieldSchema = {\r\n  ui_only: ToolOutputUiOnlySchema.optional(),\r\n};\r\n\r\nexport const AskUserQuestionToolArgsSchema = z\r\n  .object({\r\n    questions: z.array(AskUserQuestionQuestionSchema).min(1).max(4),\r\n    // Optional prefilled answers (Claude Code supports this, though Mux typically won't use it)\r\n    answers: z.record(z.string(), z.string()).nullish(),\r\n  })\r\n  .strict()\r\n  .superRefine((args, ctx) => {\r\n    const questionTexts = args.questions.map((q) => q.question);\r\n    const questionTextSet = new Set(questionTexts);\r\n    if (questionTextSet.size !== questionTexts.length) {\r\n      ctx.addIssue({\r\n        code: z.ZodIssueCode.custom,\r\n        message: \"Question text must be unique across questions\",\r\n        path: [\"questions\"],\r\n      });\r\n    }\r\n  });\r\n\r\nconst AskUserQuestionToolSummarySchema = z\r\n  .object({\r\n    summary: z.string(),\r\n  })\r\n  .extend(ToolOutputUiOnlyFieldSchema);\r\n\r\nconst AskUserQuestionToolLegacySchema = z\r\n  .object({\r\n    questions: z.array(AskUserQuestionQuestionSchema),\r\n    answers: z.record(z.string(), z.string()),\r\n  })\r\n  .strict();\r\n\r\nexport const AskUserQuestionToolResultSchema = z.union([\r\n  AskUserQuestionToolSummarySchema,\r\n  AskUserQuestionToolLegacySchema,\r\n]);\r\n\r\n// -----------------------------------------------------------------------------\r\n// task (sub-workspaces as subagents)\r\n// -----------------------------------------------------------------------------\r\n\r\nconst SubagentTypeSchema = z.preprocess(\r\n  (value) => (typeof value === \"string\" ? value.trim().toLowerCase() : value),\r\n  AgentIdSchema\r\n);\r\n\r\nconst TaskAgentIdSchema = z.preprocess(\r\n  (value) => (typeof value === \"string\" ? value.trim().toLowerCase() : value),\r\n  AgentIdSchema\r\n);\r\n\r\nconst TaskToolAgentArgsSchema = z\r\n  .object({\r\n    // Prefer agentId. subagent_type is a deprecated alias for backwards compatibility.\r\n    agentId: TaskAgentIdSchema.nullish(),\r\n    subagent_type: SubagentTypeSchema.nullish(),\r\n    prompt: z.string().min(1),\r\n    title: z.string().min(1),\r\n    run_in_background: z.boolean().default(false),\r\n  })\r\n  .strict()\r\n  .superRefine((args, ctx) => {\r\n    const hasAgentId = typeof args.agentId === \"string\" && args.agentId.length > 0;\r\n    const hasSubagentType = typeof args.subagent_type === \"string\" && args.subagent_type.length > 0;\r\n\r\n    if (!hasAgentId && !hasSubagentType) {\r\n      ctx.addIssue({\r\n        code: z.ZodIssueCode.custom,\r\n        message: \"Provide agentId (preferred) or subagent_type\",\r\n        path: [\"agentId\"],\r\n      });\r\n      return;\r\n    }\r\n\r\n    // GPT models often send both fields with identical values — allow that.\r\n    // Only reject when they conflict, since the handler silently prefers agentId.\r\n    if (hasAgentId && hasSubagentType && args.agentId !== args.subagent_type) {\r\n      ctx.addIssue({\r\n        code: z.ZodIssueCode.custom,\r\n        message: \"agentId and subagent_type must match when both are provided\",\r\n        path: [\"agentId\"],\r\n      });\r\n      return;\r\n    }\r\n  });\r\n\r\nexport const TaskToolArgsSchema = TaskToolAgentArgsSchema;\r\n\r\nexport const TaskToolQueuedResultSchema = z\r\n  .object({\r\n    status: z.enum([\"queued\", \"running\"]),\r\n    taskId: z.string(),\r\n    note: z\r\n      .string()\r\n      .min(1)\r\n      .describe(\"Additional guidance for the caller (e.g., use task_await to monitor progress).\"),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskToolCompletedResultSchema = z\r\n  .object({\r\n    status: z.literal(\"completed\"),\r\n    taskId: z.string(),\r\n    reportMarkdown: z.string(),\r\n    title: z.string().optional(),\r\n    agentId: z.string().optional(),\r\n    agentType: z.string().optional(),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskToolResultSchema = z.discriminatedUnion(\"status\", [\r\n  TaskToolQueuedResultSchema,\r\n  TaskToolCompletedResultSchema,\r\n]);\r\n\r\n// -----------------------------------------------------------------------------\r\n// task_await (await one or more sub-agent tasks)\r\n// -----------------------------------------------------------------------------\r\n\r\nexport const TaskAwaitToolArgsSchema = z\r\n  .object({\r\n    task_ids: z\r\n      .array(z.string().min(1))\r\n      .nullish()\r\n      .describe(\r\n        \"List of task IDs to await. When omitted, waits for all active descendant tasks of the current workspace.\"\r\n      ),\r\n    filter: z\r\n      .string()\r\n      .nullish()\r\n      .describe(\r\n        \"Optional regex to filter bash task output lines. By default, only matching lines are returned. \" +\r\n          \"When filter_exclude is true, matching lines are excluded instead. \" +\r\n          \"Non-matching lines are discarded and cannot be retrieved later.\"\r\n      ),\r\n    filter_exclude: z\r\n      .boolean()\r\n      .nullish()\r\n      .describe(\r\n        \"When true, lines matching 'filter' are excluded instead of kept. \" +\r\n          \"Requires 'filter' to be set.\"\r\n      ),\r\n    timeout_secs: z\r\n      .number()\r\n      .min(0)\r\n      .nullish()\r\n      .default(600)\r\n      .describe(\r\n        \"Maximum time to wait in seconds for each task. \" +\r\n          \"For bash tasks, this waits for NEW output (or process exit). \" +\r\n          \"If exceeded, the result returns status=queued|running|awaiting_report (task is still active). \" +\r\n          \"Defaults to 600 seconds (10 minutes) if not specified. \" +\r\n          \"Set to 0 for a non-blocking status check.\"\r\n      ),\r\n  })\r\n  .strict()\r\n  .superRefine((args, ctx) => {\r\n    if (args.filter_exclude && !args.filter) {\r\n      ctx.addIssue({\r\n        code: z.ZodIssueCode.custom,\r\n        message: \"filter_exclude requires filter to be set\",\r\n        path: [\"filter_exclude\"],\r\n      });\r\n    }\r\n  });\r\n\r\nexport const SubagentGitPatchArtifactStatusSchema = z.enum([\r\n  \"pending\",\r\n  \"ready\",\r\n  \"failed\",\r\n  \"skipped\",\r\n]);\r\n\r\nexport const SubagentGitPatchArtifactSchema = z\r\n  .object({\r\n    childTaskId: z.string(),\r\n    parentWorkspaceId: z.string(),\r\n    createdAtMs: z.number().int().nonnegative(),\r\n    updatedAtMs: z.number().int().nonnegative().optional(),\r\n    status: SubagentGitPatchArtifactStatusSchema,\r\n    baseCommitSha: z.string().optional(),\r\n    headCommitSha: z.string().optional(),\r\n    commitCount: z.number().int().nonnegative().optional(),\r\n    mboxPath: z.string().optional(),\r\n    error: z.string().optional(),\r\n    appliedAtMs: z.number().int().nonnegative().optional(),\r\n  })\r\n  .strict();\r\n\r\nexport type SubagentGitPatchArtifact = z.infer<typeof SubagentGitPatchArtifactSchema>;\r\n\r\nconst TaskAwaitToolArtifactsSchema = z\r\n  .object({\r\n    gitFormatPatch: SubagentGitPatchArtifactSchema.optional(),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskAwaitToolCompletedResultSchema = z\r\n  .object({\r\n    status: z.literal(\"completed\"),\r\n    taskId: z.string(),\r\n    reportMarkdown: z.string(),\r\n    title: z.string().optional(),\r\n    output: z.string().optional(),\r\n    elapsed_ms: z.number().optional(),\r\n    exitCode: z.number().optional(),\r\n    note: z.string().optional(),\r\n    artifacts: TaskAwaitToolArtifactsSchema.optional(),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskAwaitToolActiveResultSchema = z\r\n  .object({\r\n    status: z.enum([\"queued\", \"running\", \"awaiting_report\"]),\r\n    taskId: z.string(),\r\n    output: z.string().optional(),\r\n    elapsed_ms: z.number().optional(),\r\n    note: z.string().optional(),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskAwaitToolNotFoundResultSchema = z\r\n  .object({\r\n    status: z.literal(\"not_found\"),\r\n    taskId: z.string(),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskAwaitToolInvalidScopeResultSchema = z\r\n  .object({\r\n    status: z.literal(\"invalid_scope\"),\r\n    taskId: z.string(),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskAwaitToolErrorResultSchema = z\r\n  .object({\r\n    status: z.literal(\"error\"),\r\n    taskId: z.string(),\r\n    error: z.string(),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskAwaitToolResultSchema = z\r\n  .object({\r\n    results: z.array(\r\n      z.discriminatedUnion(\"status\", [\r\n        TaskAwaitToolCompletedResultSchema,\r\n        TaskAwaitToolActiveResultSchema,\r\n        TaskAwaitToolNotFoundResultSchema,\r\n        TaskAwaitToolInvalidScopeResultSchema,\r\n        TaskAwaitToolErrorResultSchema,\r\n      ])\r\n    ),\r\n  })\r\n  .strict();\r\n\r\n// -----------------------------------------------------------------------------\r\n// task_apply_git_patch (apply git-format-patch artifact via git am)\r\n// -----------------------------------------------------------------------------\r\n\r\nexport const TaskApplyGitPatchToolArgsSchema = z\r\n  .object({\r\n    task_id: z.string().min(1).describe(\"Child task ID whose patch artifact should be applied\"),\r\n    dry_run: z\r\n      .boolean()\r\n      .nullish()\r\n      .describe(\r\n        \"When true, attempt to apply the patch in a temporary git worktree and then discard it (does not modify the current workspace).\"\r\n      ),\r\n    three_way: z.boolean().nullish().default(true).describe(\"When true, run git am with --3way\"),\r\n    force: z\r\n      .boolean()\r\n      .nullish()\r\n      .describe(\r\n        \"When true, allow apply even if the patch was previously applied (and skip clean-tree checks).\"\r\n      ),\r\n  })\r\n  .strict();\r\n\r\nconst TaskApplyGitPatchAppliedCommitSchema = z\r\n  .object({\r\n    // Commit subject line (always stable, even across dry-run vs real apply)\r\n    subject: z.string().min(1),\r\n    // Optional SHA (omitted for dry-run because the commit IDs may differ when applied for real)\r\n    sha: z.string().min(1).optional(),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskApplyGitPatchToolResultSchema = z.union([\r\n  z\r\n    .object({\r\n      success: z.literal(true),\r\n      taskId: z.string(),\r\n      appliedCommits: z.array(TaskApplyGitPatchAppliedCommitSchema),\r\n      headCommitSha: z.string().optional(),\r\n      dryRun: z.boolean().optional(),\r\n      note: z.string().optional(),\r\n    })\r\n    .strict(),\r\n  z\r\n    .object({\r\n      success: z.literal(false),\r\n      taskId: z.string(),\r\n      error: z.string(),\r\n      dryRun: z.boolean().optional(),\r\n      conflictPaths: z.array(z.string()).optional(),\r\n      failedPatchSubject: z.string().optional(),\r\n      note: z.string().optional(),\r\n    })\r\n    .strict(),\r\n]);\r\n\r\n// -----------------------------------------------------------------------------\r\n// task_terminate (terminate one or more sub-agent tasks)\r\n// -----------------------------------------------------------------------------\r\nexport const TaskTerminateToolArgsSchema = z\r\n  .object({\r\n    task_ids: z\r\n      .array(z.string().min(1))\r\n      .min(1)\r\n      .describe(\r\n        \"List of task IDs to terminate. Each must be a descendant sub-agent task of the current workspace.\"\r\n      ),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskTerminateToolTerminatedResultSchema = z\r\n  .object({\r\n    status: z.literal(\"terminated\"),\r\n    taskId: z.string(),\r\n    terminatedTaskIds: z\r\n      .array(z.string())\r\n      .describe(\"All terminated task IDs (includes descendants)\"),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskTerminateToolNotFoundResultSchema = z\r\n  .object({\r\n    status: z.literal(\"not_found\"),\r\n    taskId: z.string(),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskTerminateToolInvalidScopeResultSchema = z\r\n  .object({\r\n    status: z.literal(\"invalid_scope\"),\r\n    taskId: z.string(),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskTerminateToolErrorResultSchema = z\r\n  .object({\r\n    status: z.literal(\"error\"),\r\n    taskId: z.string(),\r\n    error: z.string(),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskTerminateToolResultSchema = z\r\n  .object({\r\n    results: z.array(\r\n      z.discriminatedUnion(\"status\", [\r\n        TaskTerminateToolTerminatedResultSchema,\r\n        TaskTerminateToolNotFoundResultSchema,\r\n        TaskTerminateToolInvalidScopeResultSchema,\r\n        TaskTerminateToolErrorResultSchema,\r\n      ])\r\n    ),\r\n  })\r\n  .strict();\r\n\r\n// -----------------------------------------------------------------------------\r\n// task_list (list descendant sub-agent tasks)\r\n// -----------------------------------------------------------------------------\r\n\r\nconst TaskListStatusSchema = z.enum([\"queued\", \"running\", \"awaiting_report\", \"reported\"]);\r\nconst TaskListThinkingLevelSchema = z.enum([\"off\", \"low\", \"medium\", \"high\", \"xhigh\", \"max\"]);\r\n\r\nexport const TaskListToolArgsSchema = z\r\n  .object({\r\n    statuses: z\r\n      .array(TaskListStatusSchema)\r\n      .nullish()\r\n      .describe(\r\n        \"Task statuses to include. Defaults to active tasks: queued, running, awaiting_report.\"\r\n      ),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskListToolTaskSchema = z\r\n  .object({\r\n    taskId: z.string(),\r\n    status: TaskListStatusSchema,\r\n    parentWorkspaceId: z.string(),\r\n    agentType: z.string().optional(),\r\n    workspaceName: z.string().optional(),\r\n    title: z.string().optional(),\r\n    createdAt: z.string().optional(),\r\n    modelString: z.string().optional(),\r\n    thinkingLevel: TaskListThinkingLevelSchema.optional(),\r\n    depth: z.number().int().min(0),\r\n  })\r\n  .strict();\r\n\r\nexport const TaskListToolResultSchema = z\r\n  .object({\r\n    tasks: z.array(TaskListToolTaskSchema),\r\n  })\r\n  .strict();\r\n\r\n// -----------------------------------------------------------------------------\r\n// agent_report (explicit subagent -> parent report)\r\n// -----------------------------------------------------------------------------\r\n\r\nexport const AgentReportToolArgsSchema = z\r\n  .object({\r\n    reportMarkdown: z.string().min(1),\r\n    title: z.string().nullish(),\r\n  })\r\n  .strict();\r\n\r\nexport const AgentReportToolResultSchema = z.object({ success: z.literal(true) }).strict();\r\nconst FILE_EDIT_FILE_PATH = z\r\n  .string()\r\n  .describe(\"Path to the file to edit (absolute or relative to the current workspace)\");\r\n\r\ninterface ToolSchema {\r\n  name: string;\r\n  description: string;\r\n  inputSchema: {\r\n    type: string;\r\n    properties: Record<string, unknown>;\r\n    required: string[];\r\n  };\r\n}\r\n\r\n/**\r\n * Schema for a single keep-range item in the system1_keep_ranges tool.\r\n * Extracted as a named export so internal code can derive the type via z.infer<>\r\n * instead of maintaining a hand-written interface.\r\n *\r\n * Note: the tool schema applies .passthrough() on top of this to tolerate extra\r\n * keys from models, but the inferred type is the strict shape.\r\n */\r\nexport const System1KeepRangeSchema = z.object({\r\n  start: z.coerce\r\n    .number()\r\n    .finite()\r\n    .min(1)\r\n    .describe(\"1-based start line (inclusive) in the numbered output\"),\r\n  end: z.coerce\r\n    .number()\r\n    .finite()\r\n    .min(1)\r\n    .describe(\"1-based end line (inclusive) in the numbered output\"),\r\n  // .nullish() accepts both null and undefined, so the preprocess\r\n  // hack that mapped null→undefined is no longer needed.\r\n  reason: z.string().nullish().describe(\"Optional short reason for keeping this range\"),\r\n});\r\n\r\n/**\r\n * Tool definitions: single source of truth\r\n * Key = tool name, Value = { description, schema }\r\n */\r\nexport const TOOL_DEFINITIONS = {\r\n  bash: {\r\n    description:\r\n      \"Execute a bash command with a configurable timeout. \" +\r\n      `Output is strictly limited to ${BASH_HARD_MAX_LINES} lines, ${BASH_MAX_LINE_BYTES} bytes per line, and ${BASH_MAX_TOTAL_BYTES} bytes total. ` +\r\n      \"Commands that exceed these limits will FAIL with an error (no partial output returned). \" +\r\n      \"Be conservative: use 'head', 'tail', 'grep', or other filters to limit output before running commands. \" +\r\n      \"Large outputs may be automatically filtered; when this happens, the result includes a note explaining what was kept and (if available) where the full output was saved.\\n\" +\r\n      \"On Windows this runs in Git Bash; to discard output use `>/dev/null` (not `>nul`).\",\r\n    schema: z.preprocess(\r\n      (value) => {\r\n        // Compatibility: some models emit { command: \"...\" } instead of { script: \"...\" }.\r\n        // Normalize to `script` so downstream code (tool runner + UI) stays consistent.\r\n        if (typeof value !== \"object\" || value === null || Array.isArray(value)) return value;\r\n\r\n        const obj = value as Record<string, unknown>;\r\n        if (typeof obj.script === \"string\") return value;\r\n\r\n        if (typeof obj.command === \"string\") {\r\n          // Drop the legacy field to keep tool args canonical (and avoid confusing downstream consumers).\r\n          const { command, ...rest } = obj as Record<string, unknown> & { command: string };\r\n          return { ...rest, script: command };\r\n        }\r\n\r\n        return value;\r\n      },\r\n      z.object({\r\n        script: z.string().describe(\"The bash script/command to execute\"),\r\n        timeout_secs: z\r\n          .number()\r\n          .positive()\r\n          .describe(\r\n            \"Timeout in seconds. For foreground: max execution time before kill. \" +\r\n              \"For background: max lifetime before auto-termination. \" +\r\n              \"Start small and increase on retry; avoid large initial values to keep UX responsive\"\r\n          ),\r\n        run_in_background: z\r\n          .boolean()\r\n          .default(false)\r\n          .describe(\r\n            \"Run this command in the background without blocking. \" +\r\n              \"Use for processes running >5s (dev servers, builds, file watchers). \" +\r\n              \"Do NOT use for quick commands (<5s), interactive processes (no stdin support), \" +\r\n              \"or processes requiring real-time output (use foreground with larger timeout instead). \" +\r\n              \"Returns immediately with a taskId (bash:<processId>) and backgroundProcessId. \" +\r\n              \"Read output with task_await (returns only new output since last check). \" +\r\n              \"Terminate with task_terminate using the taskId. \" +\r\n              \"List active tasks with task_list. \" +\r\n              \"Process persists until timeout_secs expires, terminated, or workspace is removed.\" +\r\n              \"\\\\n\\\\nFor long-running tasks like builds or compilations, prefer background mode to continue productive work in parallel. \" +\r\n              \"Check back periodically with task_await rather than blocking on completion.\"\r\n          ),\r\n        display_name: z\r\n          .string()\r\n          .describe(\r\n            \"Human-readable name for the process (e.g., 'Dev Server', 'TypeCheck Watch'). \" +\r\n              \"Required for all bash invocations since any process can be sent to background.\"\r\n          ),\r\n      })\r\n    ),\r\n  },\r\n  file_read: {\r\n    description:\r\n      \"Read the contents of a file from the file system. Read as little as possible to complete the task.\",\r\n    schema: z.object({\r\n      file_path: z.string().describe(\"The path to the file to read (absolute or relative)\"),\r\n      offset: z\r\n        .number()\r\n        .int()\r\n        .positive()\r\n        .nullish()\r\n        .describe(\"1-based starting line number (optional, defaults to 1)\"),\r\n      limit: z\r\n        .number()\r\n        .int()\r\n        .positive()\r\n        .nullish()\r\n        .describe(\"Number of lines to return from offset (optional, returns all if not specified)\"),\r\n    }),\r\n  },\r\n  mux_global_agents_read: {\r\n    description:\r\n      \"Read the global AGENTS.md file (mux-wide agent instructions) from the mux home directory.\",\r\n    schema: z.object({}).strict(),\r\n  },\r\n  mux_global_agents_write: {\r\n    description:\r\n      \"Write the global AGENTS.md file (mux-wide agent instructions) in the mux home directory. \" +\r\n      \"Requires explicit confirmation via confirm: true.\",\r\n    schema: z\r\n      .object({\r\n        newContent: z.string().describe(\"The full new contents of the global AGENTS.md file\"),\r\n        confirm: z\r\n          .boolean()\r\n          .describe(\r\n            \"Must be true to apply the write. The agent should ask the user for confirmation first.\"\r\n          ),\r\n      })\r\n      .strict(),\r\n  },\r\n  agent_skill_read: {\r\n    description:\r\n      \"Load an Agent Skill's SKILL.md (YAML frontmatter + markdown body) by name. \" +\r\n      \"Skills are discovered from <projectRoot>/.mux/skills/<name>/SKILL.md and ~/.mux/skills/<name>/SKILL.md.\",\r\n    schema: z\r\n      .object({\r\n        name: SkillNameSchema.describe(\"Skill name (directory name under the skills root)\"),\r\n      })\r\n      .strict(),\r\n  },\r\n  agent_skill_read_file: {\r\n    description:\r\n      \"Read a file within an Agent Skill directory. \" +\r\n      \"filePath must be relative to the skill directory (no absolute paths, no ~, no .. traversal). \" +\r\n      \"Supports offset/limit like file_read.\",\r\n    schema: z\r\n      .object({\r\n        name: SkillNameSchema.describe(\"Skill name (directory name under the skills root)\"),\r\n        filePath: z\r\n          .string()\r\n          .min(1)\r\n          .describe(\"Path to the file within the skill directory (relative)\"),\r\n        offset: z\r\n          .number()\r\n          .int()\r\n          .positive()\r\n          .nullish()\r\n          .describe(\"1-based starting line number (optional, defaults to 1)\"),\r\n        limit: z\r\n          .number()\r\n          .int()\r\n          .positive()\r\n          .nullish()\r\n          .describe(\r\n            \"Number of lines to return from offset (optional, returns all if not specified)\"\r\n          ),\r\n      })\r\n      .strict(),\r\n  },\r\n\r\n  file_edit_replace_string: {\r\n    description:\r\n      \"⚠️ CRITICAL: Always check tool results - edits WILL fail if old_string is not found or unique. Do not proceed with dependent operations (commits, pushes, builds) until confirming success.\\n\\n\" +\r\n      \"Apply one or more edits to a file by replacing exact text matches. All edits are applied sequentially. Each old_string must be unique in the file unless replace_count > 1 or replace_count is -1.\",\r\n    schema: z.object({\r\n      file_path: FILE_EDIT_FILE_PATH,\r\n      old_string: z\r\n        .string()\r\n        .describe(\r\n          \"The exact text to replace (must be unique in file if replace_count is 1). Include enough context (indentation, surrounding lines) to make it unique.\"\r\n        ),\r\n      new_string: z.string().describe(\"The replacement text\"),\r\n      replace_count: z\r\n        .number()\r\n        .int()\r\n        .nullish()\r\n        .describe(\r\n          \"Number of occurrences to replace (default: 1). Use -1 to replace all occurrences. If 1, old_string must be unique in the file.\"\r\n        ),\r\n    }),\r\n  },\r\n  file_edit_replace_lines: {\r\n    description:\r\n      \"⚠️ CRITICAL: Always check tool results - edits WILL fail if line numbers are invalid or file content has changed. Do not proceed with dependent operations (commits, pushes, builds) until confirming success.\\n\\n\" +\r\n      \"Replace a range of lines in a file. Use this for line-based edits when you know the exact line numbers to modify.\",\r\n    schema: z.object({\r\n      file_path: FILE_EDIT_FILE_PATH,\r\n      start_line: z.number().int().min(1).describe(\"1-indexed start line (inclusive) to replace\"),\r\n      end_line: z.number().int().min(1).describe(\"1-indexed end line (inclusive) to replace\"),\r\n      new_lines: z\r\n        .array(z.string())\r\n        .describe(\"Replacement lines. Provide an empty array to delete the specified range.\"),\r\n      expected_lines: z\r\n        .array(z.string())\r\n        .nullish()\r\n        .describe(\r\n          \"Optional safety check. When provided, the current lines in the specified range must match exactly.\"\r\n        ),\r\n    }),\r\n  },\r\n  file_edit_insert: {\r\n    description:\r\n      \"Insert content into a file using substring guards. \" +\r\n      \"Provide exactly one of insert_before or insert_after to anchor the operation when editing an existing file. \" +\r\n      \"When the file does not exist, it is created automatically without guards. \" +\r\n      \"Optional before/after substrings must uniquely match surrounding content. \" +\r\n      \"Avoid short guards like `}` or `}\\\\n` that match multiple locations — \" +\r\n      `use longer patterns like full function signatures or unique comments. ${TOOL_EDIT_WARNING}`,\r\n    schema: z\r\n      .object({\r\n        file_path: FILE_EDIT_FILE_PATH,\r\n        insert_before: z\r\n          .string()\r\n          .min(1)\r\n          .nullish()\r\n          .describe(\r\n            \"Anchor text to insert before. Content will be placed immediately before this substring.\"\r\n          ),\r\n        insert_after: z\r\n          .string()\r\n          .min(1)\r\n          .nullish()\r\n          .describe(\r\n            \"Anchor text to insert after. Content will be placed immediately after this substring.\"\r\n          ),\r\n        content: z.string().describe(\"The content to insert\"),\r\n      })\r\n      .refine((data) => !(data.insert_before != null && data.insert_after != null), {\r\n        message: \"Provide only one of insert_before or insert_after (not both).\",\r\n        path: [\"insert_before\"],\r\n      }),\r\n  },\r\n  ask_user_question: {\r\n    description:\r\n      \"Ask 1–4 multiple-choice questions (with optional multi-select) and wait for the user's answers. \" +\r\n      \"This tool is intended for plan mode and MUST be used when you need user clarification to complete the plan. \" +\r\n      \"Do not output a list of open questions; ask them via this tool instead. \" +\r\n      \"Each question must include 2–4 options; an 'Other' choice is provided automatically.\",\r\n    schema: AskUserQuestionToolArgsSchema,\r\n  },\r\n  propose_plan: {\r\n    description:\r\n      \"Signal that your plan is complete and ready for user approval. \" +\r\n      \"This tool reads the plan from the plan file you wrote. \" +\r\n      \"You must write your plan to the plan file before calling this tool. \" +\r\n      \"After calling this tool, do not paste the plan contents or mention the plan file path; the UI already shows the full plan.\",\r\n    schema: z.object({}),\r\n  },\r\n  task: {\r\n    description:\r\n      \"Spawn a sub-agent task (child workspace). \" +\r\n      \"\\n\\nIMPORTANT: Subagents only see committed state. Uncommitted changes are not available. \" +\r\n      \"Commit any changes you want the sub-agent to consider before spawning a task. \" +\r\n      \"\\n\\nProvide agentId (preferred) or subagent_type, prompt, title, run_in_background. \" +\r\n      \"\\n\\nWhen delegating, include a compact task brief (Task / Background / Scope / Starting points / Acceptance / Deliverables / Constraints). \" +\r\n      \"Avoid telling the sub-agent to read your plan file; child workspaces do not automatically have access to it. \" +\r\n      \"\\n\\nIf run_in_background is false, waits for the sub-agent to finish and returns a completed reportMarkdown. \" +\r\n      \"If the foreground wait times out, returns a queued/running taskId with a note (the task continues running); use task_await to monitor progress. \" +\r\n      \"If run_in_background is true, returns a queued/running taskId with a note; use task_await to wait for completion, task_list to rediscover active tasks, and task_terminate to stop it. \" +\r\n      \"Use the bash tool to run shell commands.\",\r\n    schema: TaskToolArgsSchema,\r\n  },\r\n  task_apply_git_patch: {\r\n    description:\r\n      \"Apply a completed sub-agent task's git-format-patch artifact to the current workspace using `git am`. \" +\r\n      \"This is an explicit integration step: mux will not auto-apply patches.\",\r\n    schema: TaskApplyGitPatchToolArgsSchema,\r\n  },\r\n  task_await: {\r\n    description:\r\n      \"Wait for one or more tasks to produce output. \" +\r\n      \"Agent tasks return reports when completed. \" +\r\n      \"Bash tasks return incremental output while running and a final reportMarkdown when they exit. \" +\r\n      \"For bash tasks, you may optionally pass filter/filter_exclude to include/exclude output lines by regex. \" +\r\n      \"WARNING: when using filter, non-matching lines are permanently discarded. \" +\r\n      \"Use this tool to WAIT; do not poll task_list in a loop to wait for task completion (that is misuse and wastes tool calls). \" +\r\n      \"This is similar to Promise.allSettled(): you always get per-task results. \" +\r\n      \"Possible statuses: completed, queued, running, awaiting_report, not_found, invalid_scope, error. \" +\r\n      \"Bash task outputs may be automatically filtered; when this happens, check each result's note for details and (if available) where the full output was saved.\",\r\n    schema: TaskAwaitToolArgsSchema,\r\n  },\r\n  task_terminate: {\r\n    description:\r\n      \"Terminate one or more tasks immediately (sub-agent tasks or background bash tasks). \" +\r\n      \"For sub-agent tasks, this stops their AI streams and deletes their workspaces (best-effort). \" +\r\n      \"No report will be delivered; any in-progress work is discarded. \" +\r\n      \"If the task has descendant sub-agent tasks, they are terminated too.\",\r\n    schema: TaskTerminateToolArgsSchema,\r\n  },\r\n  task_list: {\r\n    description:\r\n      \"List descendant tasks for the current workspace, including status + metadata. \" +\r\n      \"This includes sub-agent tasks and background bash tasks. \" +\r\n      \"Use this after compaction or interruptions to rediscover which tasks are still active. \" +\r\n      \"This is a discovery tool, NOT a waiting mechanism: if you need to wait for tasks to finish, call task_await (optionally omit task_ids to await all active descendant tasks).\",\r\n    schema: TaskListToolArgsSchema,\r\n  },\r\n  agent_report: {\r\n    description:\r\n      \"Report the final result of a sub-agent task back to the parent workspace. \" +\r\n      \"Call this exactly once when you have a final answer (after any spawned sub-tasks complete).\",\r\n    schema: AgentReportToolArgsSchema,\r\n  },\r\n  system1_keep_ranges: {\r\n    description:\r\n      \"Internal tool used by mux to record which line ranges to keep when filtering large bash output.\",\r\n    schema: z\r\n      .object({\r\n        keep_ranges: z\r\n          .array(\r\n            System1KeepRangeSchema\r\n              // Providers/models sometimes include extra keys in tool arguments; be permissive and\r\n              // ignore them rather than failing the whole compaction call.\r\n              .passthrough()\r\n          )\r\n          .min(1)\r\n          // Allow at least as many ranges as the user can request via maxKeptLines.\r\n          // (In the worst case, the model may emit one 1-line range per kept line.)\r\n          .max(SYSTEM1_BASH_OUTPUT_COMPACTION_LIMITS.bashOutputCompactionMaxKeptLines.max)\r\n          .describe(\"Line ranges to keep\"),\r\n      })\r\n      .passthrough(),\r\n  },\r\n\r\n  todo_write: {\r\n    description:\r\n      \"Create or update the todo list for tracking multi-step tasks (limit: 7 items). \" +\r\n      \"The TODO list is displayed to the user at all times. \" +\r\n      \"Replace the entire list on each call - the AI tracks which tasks are completed.\\n\" +\r\n      \"\\n\" +\r\n      \"Mark ONE task as in_progress at a time. \" +\r\n      \"Order tasks as: completed first, then in_progress (max 1), then pending last. \" +\r\n      \"Use appropriate tense in content: past tense for completed (e.g., 'Added tests'), \" +\r\n      \"present progressive for in_progress (e.g., 'Adding tests'), \" +\r\n      \"and imperative/infinitive for pending (e.g., 'Add tests').\\n\" +\r\n      \"\\n\" +\r\n      \"If you hit the 7-item limit, summarize older completed items into one line \" +\r\n      \"(e.g., 'Completed initial setup (3 tasks)').\\n\" +\r\n      \"\\n\" +\r\n      \"Update the list as work progresses. If work fails or the approach changes, update \" +\r\n      \"the list to reflect reality - only mark tasks complete when they actually succeed.\",\r\n    schema: z.object({\r\n      todos: z.array(\r\n        z.object({\r\n          content: z\r\n            .string()\r\n            .describe(\r\n              \"Task description with tense matching status: past for completed, present progressive for in_progress, imperative for pending\"\r\n            ),\r\n          status: z.enum([\"pending\", \"in_progress\", \"completed\"]).describe(\"Task status\"),\r\n        })\r\n      ),\r\n    }),\r\n  },\r\n  todo_read: {\r\n    description: \"Read the current todo list\",\r\n    schema: z.object({}),\r\n  },\r\n  status_set: {\r\n    description:\r\n      \"Set a status indicator to show what Assistant is currently doing. The status is set IMMEDIATELY \\n\" +\r\n      \"when this tool is called, even before other tool calls complete.\\n\" +\r\n      \"\\n\" +\r\n      \"WHEN TO SET STATUS:\\n\" +\r\n      \"- Set status when beginning concrete work (file edits, running tests, executing commands)\\n\" +\r\n      \"- Update status as work progresses through distinct phases\\n\" +\r\n      \"- Set a final status after completion, only claim success when certain (e.g., after confirming checks passed)\\n\" +\r\n      \"- DO NOT set status during initial exploration, file reading, or planning phases\\n\" +\r\n      \"\\n\" +\r\n      \"The status is cleared when a new user message comes in. Validate your approach is feasible \\n\" +\r\n      \"before setting status - failed tool calls after setting status indicate premature commitment.\\n\" +\r\n      \"\\n\" +\r\n      \"URL PARAMETER:\\n\" +\r\n      \"- Optional 'url' parameter links to external resources (e.g., PR URL: 'https://github.com/owner/repo/pull/123')\\n\" +\r\n      \"- Prefer stable URLs that don't change often - saving the same URL twice is a no-op\\n\" +\r\n      \"- URL persists until replaced by a new status with a different URL\",\r\n    schema: z\r\n      .object({\r\n        emoji: z.string().describe(\"A single emoji character representing the current activity\"),\r\n        message: z\r\n          .string()\r\n          .describe(\r\n            `A brief description of the current activity (auto-truncated to ${STATUS_MESSAGE_MAX_LENGTH} chars with ellipsis if needed)`\r\n          ),\r\n        url: z\r\n          .string()\r\n          .url()\r\n          .nullish()\r\n          .describe(\r\n            \"Optional URL to external resource with more details (e.g., Pull Request URL). The URL persists and is displayed to the user for easy access.\"\r\n          ),\r\n      })\r\n      .strict(),\r\n  },\r\n  bash_output: {\r\n    description:\r\n      'DEPRECATED: use task_await instead (pass bash-prefixed taskId like \"bash:<processId>\"). ' +\r\n      \"Retrieve output from a running or completed background bash process. \" +\r\n      \"Returns only NEW output since the last check (incremental). \" +\r\n      \"Returns stdout and stderr output along with process status. \" +\r\n      \"Supports optional regex filtering to show only lines matching a pattern. \" +\r\n      \"WARNING: When using filter, non-matching lines are permanently discarded. \" +\r\n      \"Use timeout to wait for output instead of polling repeatedly. \" +\r\n      \"Large outputs may be automatically filtered; when this happens, the result includes a note explaining what was kept and (if available) where the full output was saved.\",\r\n    schema: z.object({\r\n      process_id: z.string().describe(\"The ID of the background process to retrieve output from\"),\r\n      filter: z\r\n        .string()\r\n        .nullish()\r\n        .describe(\r\n          \"Optional regex to filter output lines. By default, only matching lines are returned. \" +\r\n            \"When filter_exclude is true, matching lines are excluded instead. \" +\r\n            \"Non-matching lines are permanently discarded and cannot be retrieved later.\"\r\n        ),\r\n      filter_exclude: z\r\n        .boolean()\r\n        .nullish()\r\n        .describe(\r\n          \"When true, lines matching 'filter' are excluded instead of kept. \" +\r\n            \"Key behavior: excluded lines do NOT cause early return from timeout - \" +\r\n            \"waiting continues until non-excluded output arrives or process exits. \" +\r\n            \"Use to avoid busy polling on progress spam (e.g., filter='⏳|waiting|\\\\.\\\\.\\\\.' with filter_exclude=true \" +\r\n            \"lets you set a long timeout and only wake on meaningful output). \" +\r\n            \"Requires 'filter' to be set.\"\r\n        ),\r\n      timeout_secs: z\r\n        .number()\r\n        .min(0)\r\n        .describe(\r\n          \"Seconds to wait for new output. \" +\r\n            \"If no output is immediately available and process is still running, \" +\r\n            \"blocks up to this duration. Returns early when output arrives or process exits. \" +\r\n            \"Only use long timeouts (>15s) when no other useful work can be done in parallel.\"\r\n        ),\r\n    }),\r\n  },\r\n  bash_background_list: {\r\n    description:\r\n      \"DEPRECATED: use task_list instead. \" +\r\n      \"List all background processes started with bash(run_in_background=true). \" +\r\n      \"Returns process_id, status, script for each process. \" +\r\n      \"Use to find process_id for termination or check output with bash_output.\",\r\n    schema: z.object({}),\r\n  },\r\n  bash_background_terminate: {\r\n    description:\r\n      \"DEPRECATED: use task_terminate instead. \" +\r\n      \"Terminate a background process started with bash(run_in_background=true). \" +\r\n      \"Use process_id from the original bash response or from bash_background_list. \" +\r\n      \"Sends SIGTERM, waits briefly, then SIGKILL if needed. \" +\r\n      \"Output remains available via bash_output after termination.\",\r\n    schema: z.object({\r\n      process_id: z.string().describe(\"Background process ID to terminate\"),\r\n    }),\r\n  },\r\n  web_fetch: {\r\n    description:\r\n      `Fetch a web page and extract its main content as clean markdown. ` +\r\n      `Uses the workspace's network context (requests originate from the workspace, not Mux host). ` +\r\n      `Requires curl to be installed in the workspace. ` +\r\n      `Output is truncated to ${Math.floor(WEB_FETCH_MAX_OUTPUT_BYTES / 1024)}KB.`,\r\n    schema: z.object({\r\n      url: z.string().url().describe(\"The URL to fetch (http or https)\"),\r\n    }),\r\n  },\r\n  code_execution: {\r\n    description:\r\n      \"Execute JavaScript code in a sandboxed environment with access to Mux tools. \" +\r\n      \"Available for multi-tool workflows when PTC experiment is enabled.\",\r\n    schema: z.object({\r\n      code: z.string().min(1).describe(\"JavaScript code to execute in the PTC sandbox\"),\r\n    }),\r\n  },\r\n  // #region NOTIFY_DOCS\r\n  notify: {\r\n    description:\r\n      \"Send a system notification to the user. Use this to alert the user about important events that require their attention, such as long-running task completion, errors requiring intervention, or questions. \" +\r\n      \"Notifications appear as OS-native notifications (macOS Notification Center, Windows Toast, Linux). \" +\r\n      \"Infer whether to send notifications from user instructions. If no instructions provided, reserve notifications for major wins or blocking issues. Do not use for routine status updates (use status_set instead).\",\r\n    schema: z\r\n      .object({\r\n        title: z\r\n          .string()\r\n          .min(1)\r\n          .max(64)\r\n          .describe(\"Short notification title (max 64 chars). Should be concise and actionable.\"),\r\n        message: z\r\n          .string()\r\n          .max(200)\r\n          .nullish()\r\n          .describe(\r\n            \"Optional notification body with more details (max 200 chars). \" +\r\n              \"Keep it brief - users may only see a preview.\"\r\n          ),\r\n      })\r\n      .strict(),\r\n  },\r\n  // #endregion NOTIFY_DOCS\r\n} as const;\r\n\r\n// -----------------------------------------------------------------------------\r\n// Result Schemas for Bridgeable Tools (PTC Type Generation)\r\n// -----------------------------------------------------------------------------\r\n// These Zod schemas define the result types for tools exposed in the PTC sandbox.\r\n// They serve as single source of truth for both:\r\n// 1. TypeScript types in tools.ts (via z.infer<>)\r\n// 2. Runtime type generation for PTC (via Zod → JSON Schema → TypeScript string)\r\n\r\n/**\r\n * Truncation info returned when output exceeds limits.\r\n */\r\nconst TruncatedInfoSchema = z.object({\r\n  reason: z.string(),\r\n  totalLines: z.number(),\r\n});\r\n\r\n/**\r\n * Bash tool result - success, background spawn, or failure.\r\n */\r\nconst BashToolSuccessSchema = z\r\n  .object({\r\n    success: z.literal(true),\r\n    output: z.string(),\r\n    exitCode: z.literal(0),\r\n    wall_duration_ms: z.number(),\r\n    note: z.string().optional(),\r\n    truncated: TruncatedInfoSchema.optional(),\r\n  })\r\n  .extend(ToolOutputUiOnlyFieldSchema);\r\n\r\nconst BashToolBackgroundSchema = z\r\n  .object({\r\n    success: z.literal(true),\r\n    output: z.string(),\r\n    exitCode: z.literal(0),\r\n    wall_duration_ms: z.number(),\r\n    taskId: z.string(),\r\n    backgroundProcessId: z.string(),\r\n  })\r\n  .extend(ToolOutputUiOnlyFieldSchema);\r\n\r\nconst BashToolFailureSchema = z\r\n  .object({\r\n    success: z.literal(false),\r\n    output: z.string().optional(),\r\n    exitCode: z.number(),\r\n    error: z.string(),\r\n    wall_duration_ms: z.number(),\r\n    note: z.string().optional(),\r\n    truncated: TruncatedInfoSchema.optional(),\r\n  })\r\n  .extend(ToolOutputUiOnlyFieldSchema);\r\n\r\nexport const BashToolResultSchema = z.union([\r\n  // Foreground success\r\n  BashToolSuccessSchema,\r\n  // Background spawn success\r\n  BashToolBackgroundSchema,\r\n  // Failure\r\n  BashToolFailureSchema,\r\n]);\r\n\r\n/**\r\n * Bash output tool result - process status and incremental output.\r\n */\r\nexport const BashOutputToolResultSchema = z.union([\r\n  z.object({\r\n    success: z.literal(true),\r\n    status: z.enum([\"running\", \"exited\", \"killed\", \"failed\", \"interrupted\"]),\r\n    output: z.string(),\r\n    exitCode: z.number().optional(),\r\n    note: z.string().optional(),\r\n    elapsed_ms: z.number(),\r\n  }),\r\n  z.object({\r\n    success: z.literal(false),\r\n    error: z.string(),\r\n  }),\r\n]);\r\n\r\n/**\r\n * Bash background list tool result - all background processes.\r\n */\r\nexport const BashBackgroundListResultSchema = z.union([\r\n  z.object({\r\n    success: z.literal(true),\r\n    processes: z.array(\r\n      z.object({\r\n        process_id: z.string(),\r\n        status: z.enum([\"running\", \"exited\", \"killed\", \"failed\"]),\r\n        script: z.string(),\r\n        uptime_ms: z.number(),\r\n        exitCode: z.number().optional(),\r\n        display_name: z.string().optional(),\r\n      })\r\n    ),\r\n  }),\r\n  z.object({\r\n    success: z.literal(false),\r\n    error: z.string(),\r\n  }),\r\n]);\r\n\r\n/**\r\n * Bash background terminate tool result.\r\n */\r\nexport const BashBackgroundTerminateResultSchema = z.union([\r\n  z.object({\r\n    success: z.literal(true),\r\n    message: z.string(),\r\n    display_name: z.string().optional(),\r\n  }),\r\n  z.object({\r\n    success: z.literal(false),\r\n    error: z.string(),\r\n  }),\r\n]);\r\n\r\n/**\r\n * mux_global_agents_read tool result.\r\n */\r\nexport const MuxGlobalAgentsReadToolResultSchema = z.union([\r\n  z.object({\r\n    success: z.literal(true),\r\n    content: z.string(),\r\n  }),\r\n  z.object({\r\n    success: z.literal(false),\r\n    error: z.string(),\r\n  }),\r\n]);\r\n\r\n/**\r\n * mux_global_agents_write tool result.\r\n */\r\nexport const MuxGlobalAgentsWriteToolResultSchema = z.union([\r\n  z\r\n    .object({\r\n      success: z.literal(true),\r\n      diff: z.string(),\r\n    })\r\n    .extend(ToolOutputUiOnlyFieldSchema),\r\n  z\r\n    .object({\r\n      success: z.literal(false),\r\n      error: z.string(),\r\n    })\r\n    .extend(ToolOutputUiOnlyFieldSchema),\r\n]);\r\n\r\n/**\r\n * File read tool result - content or error.\r\n */\r\nexport const FileReadToolResultSchema = z.union([\r\n  z.object({\r\n    success: z.literal(true),\r\n    file_size: z.number(),\r\n    modifiedTime: z.string(),\r\n    lines_read: z.number(),\r\n    content: z.string(),\r\n    warning: z.string().optional(),\r\n  }),\r\n  z.object({\r\n    success: z.literal(false),\r\n    error: z.string(),\r\n  }),\r\n]);\r\n\r\n/**\r\n * Agent Skill read tool result - full SKILL.md package or error.\r\n */\r\nexport const AgentSkillReadToolResultSchema = z.union([\r\n  z.object({\r\n    success: z.literal(true),\r\n    skill: AgentSkillPackageSchema,\r\n  }),\r\n  z.object({\r\n    success: z.literal(false),\r\n    error: z.string(),\r\n  }),\r\n]);\r\n\r\n/**\r\n * Agent Skill read_file tool result.\r\n * Uses the same shape/limits as file_read.\r\n */\r\nexport const AgentSkillReadFileToolResultSchema = FileReadToolResultSchema;\r\n\r\n/**\r\n * File edit insert tool result - diff or error.\r\n */\r\nexport const FileEditInsertToolResultSchema = z.union([\r\n  z\r\n    .object({\r\n      success: z.literal(true),\r\n      diff: z.string(),\r\n      warning: z.string().optional(),\r\n    })\r\n    .extend(ToolOutputUiOnlyFieldSchema),\r\n  z\r\n    .object({\r\n      success: z.literal(false),\r\n      error: z.string(),\r\n      note: z.string().optional(),\r\n    })\r\n    .extend(ToolOutputUiOnlyFieldSchema),\r\n]);\r\n\r\n/**\r\n * File edit replace string tool result - diff with edit count or error.\r\n */\r\nexport const FileEditReplaceStringToolResultSchema = z.union([\r\n  z\r\n    .object({\r\n      success: z.literal(true),\r\n      diff: z.string(),\r\n      edits_applied: z.number(),\r\n      warning: z.string().optional(),\r\n    })\r\n    .extend(ToolOutputUiOnlyFieldSchema),\r\n  z\r\n    .object({\r\n      success: z.literal(false),\r\n      error: z.string(),\r\n      note: z.string().optional(),\r\n    })\r\n    .extend(ToolOutputUiOnlyFieldSchema),\r\n]);\r\n\r\n/**\r\n * Web fetch tool result - parsed content or error.\r\n */\r\nexport const WebFetchToolResultSchema = z.union([\r\n  z.object({\r\n    success: z.literal(true),\r\n    title: z.string(),\r\n    content: z.string(),\r\n    url: z.string(),\r\n    byline: z.string().optional(),\r\n    length: z.number(),\r\n  }),\r\n  z.object({\r\n    success: z.literal(false),\r\n    error: z.string(),\r\n    content: z.string().optional(),\r\n  }),\r\n]);\r\n\r\n/**\r\n * Names of tools that are bridgeable to PTC sandbox.\r\n * If adding a new tool here, you must also add its result schema below.\r\n */\r\nexport type BridgeableToolName =\r\n  | \"bash\"\r\n  | \"bash_output\"\r\n  | \"bash_background_list\"\r\n  | \"bash_background_terminate\"\r\n  | \"file_read\"\r\n  | \"agent_skill_read\"\r\n  | \"agent_skill_read_file\"\r\n  | \"file_edit_insert\"\r\n  | \"file_edit_replace_string\"\r\n  | \"web_fetch\"\r\n  | \"task\"\r\n  | \"task_await\"\r\n  | \"task_apply_git_patch\"\r\n  | \"task_list\"\r\n  | \"task_terminate\";\r\n\r\n/**\r\n * Lookup map for result schemas by tool name.\r\n * Used by PTC type generator to get result types for bridgeable tools.\r\n *\r\n * Type-level enforcement ensures all BridgeableToolName entries have schemas.\r\n */\r\nexport const RESULT_SCHEMAS: Record<BridgeableToolName, z.ZodType> = {\r\n  bash: BashToolResultSchema,\r\n  bash_output: BashOutputToolResultSchema,\r\n  bash_background_list: BashBackgroundListResultSchema,\r\n  bash_background_terminate: BashBackgroundTerminateResultSchema,\r\n  file_read: FileReadToolResultSchema,\r\n  agent_skill_read: AgentSkillReadToolResultSchema,\r\n  agent_skill_read_file: AgentSkillReadFileToolResultSchema,\r\n  file_edit_insert: FileEditInsertToolResultSchema,\r\n  file_edit_replace_string: FileEditReplaceStringToolResultSchema,\r\n  web_fetch: WebFetchToolResultSchema,\r\n  task: TaskToolResultSchema,\r\n  task_await: TaskAwaitToolResultSchema,\r\n  task_apply_git_patch: TaskApplyGitPatchToolResultSchema,\r\n  task_list: TaskListToolResultSchema,\r\n  task_terminate: TaskTerminateToolResultSchema,\r\n};\r\n\r\n/**\r\n * Get tool definition schemas for token counting\r\n * JSON schemas are auto-generated from zod schemas\r\n *\r\n * @returns Record of tool name to schema\r\n */\r\nexport function getToolSchemas(): Record<string, ToolSchema> {\r\n  return Object.fromEntries(\r\n    Object.entries(TOOL_DEFINITIONS).map(([name, def]) => [\r\n      name,\r\n      {\r\n        name,\r\n        description: def.description,\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-argument\r\n        inputSchema: zodToJsonSchema(def.schema as any) as ToolSchema[\"inputSchema\"],\r\n      },\r\n    ])\r\n  );\r\n}\r\n\r\n/**\r\n * Get which tools are available for a given model\r\n * @param modelString The model string (e.g., \"anthropic:claude-opus-4-1\")\r\n * @returns Array of tool names available for the model\r\n */\r\nexport function getAvailableTools(\r\n  modelString: string,\r\n  options?: { enableAgentReport?: boolean; enableMuxGlobalAgentsTools?: boolean }\r\n): string[] {\r\n  const [provider] = modelString.split(\":\");\r\n  const enableAgentReport = options?.enableAgentReport ?? true;\r\n\r\n  // Base tools available for all models\r\n  // Note: Tool availability is controlled by agent tool policy (allowlist), not mode checks here.\r\n  const baseTools = [\r\n    ...(options?.enableMuxGlobalAgentsTools\r\n      ? [\"mux_global_agents_read\", \"mux_global_agents_write\"]\r\n      : []),\r\n    \"file_read\",\r\n    \"agent_skill_read\",\r\n    \"agent_skill_read_file\",\r\n    \"file_edit_replace_string\",\r\n    // \"file_edit_replace_lines\", // DISABLED: causes models to break repo state\r\n    \"file_edit_insert\",\r\n    \"ask_user_question\",\r\n    \"propose_plan\",\r\n    \"bash\",\r\n    \"task\",\r\n    \"task_await\",\r\n    \"task_apply_git_patch\",\r\n    \"task_terminate\",\r\n    \"task_list\",\r\n    ...(enableAgentReport ? [\"agent_report\"] : []),\r\n    \"system1_keep_ranges\",\r\n    \"todo_write\",\r\n    \"todo_read\",\r\n    \"status_set\",\r\n    \"notify\",\r\n    \"web_fetch\",\r\n  ];\r\n\r\n  // Add provider-specific tools\r\n  switch (provider) {\r\n    case \"anthropic\":\r\n      return [...baseTools, \"web_search\"];\r\n    case \"openai\":\r\n      // Only some OpenAI models support web search\r\n      if (modelString.includes(\"gpt-4\") || modelString.includes(\"gpt-5\")) {\r\n        return [...baseTools, \"web_search\"];\r\n      }\r\n      return baseTools;\r\n    case \"google\":\r\n      return [...baseTools, \"google_search\"];\r\n    default:\r\n      return baseTools;\r\n  }\r\n}\r\n"]}