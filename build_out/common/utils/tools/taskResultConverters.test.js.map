{"version":3,"file":"taskResultConverters.test.js","sourceRoot":"","sources":["../../../../src/common/utils/tools/taskResultConverters.test.ts"],"names":[],"mappings":";;AAAA,2CAAqD;AAErD,iEAA8D;AAE9D,IAAA,kBAAQ,EAAC,sBAAsB,EAAE,GAAG,EAAE,CAAC;IACrC,IAAA,YAAE,EAAC,iEAAiE,EAAE,GAAG,EAAE,CAAC;QAC1E,MAAM,MAAM,GAAG,IAAA,2CAAoB,EAAC;YAClC,OAAO,EAAE,IAAI;YACb,MAAM,EAAE,SAAS;YACjB,QAAQ,EAAE,CAAC;YACX,gBAAgB,EAAE,CAAC;YACnB,mBAAmB,EAAE,UAAU;SAChC,CAAC,CAAC;QAEH,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;QAC9B,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,aAAa,CAAC;YAC3B,OAAO,EAAE,IAAI;YACb,mBAAmB,EAAE,UAAU;YAC/B,MAAM,EAAE,eAAe;SACxB,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,YAAE,EAAC,oDAAoD,EAAE,GAAG,EAAE,CAAC;QAC7D,MAAM,MAAM,GAAG,IAAA,2CAAoB,EAAC;YAClC,OAAO,EAAE,IAAI;YACb,MAAM,EAAE,SAAS;YACjB,QAAQ,EAAE,CAAC;YACX,gBAAgB,EAAE,CAAC;YACnB,MAAM,EAAE,eAAe;SACxB,CAAC,CAAC;QAEH,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;QAC9B,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,aAAa,CAAC;YAC3B,OAAO,EAAE,IAAI;YACb,mBAAmB,EAAE,UAAU;YAC/B,MAAM,EAAE,eAAe;SACxB,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,YAAE,EAAC,+CAA+C,EAAE,GAAG,EAAE,CAAC;QACxD,MAAM,MAAM,GAAG,IAAA,2CAAoB,EAAC;YAClC,OAAO,EAAE,IAAI;YACb,MAAM,EAAE,SAAS;YACjB,QAAQ,EAAE,CAAC;YACX,gBAAgB,EAAE,CAAC;YACnB,8DAA8D;YAC9D,mBAAmB,EAAE,GAAG;SACzB,CAAC,CAAC;QAEH,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,QAAQ,EAAE,CAAC;IAAA,CAC3B,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { describe, it, expect } from \"@jest/globals\";\r\n\r\nimport { coerceBashToolResult } from \"./taskResultConverters\";\r\n\r\ndescribe(\"coerceBashToolResult\", () => {\r\n  it(\"accepts legacy background results with only backgroundProcessId\", () => {\r\n    const result = coerceBashToolResult({\r\n      success: true,\r\n      output: \"started\",\r\n      exitCode: 0,\r\n      wall_duration_ms: 1,\r\n      backgroundProcessId: \"proc-123\",\r\n    });\r\n\r\n    expect(result).not.toBeNull();\r\n    expect(result).toMatchObject({\r\n      success: true,\r\n      backgroundProcessId: \"proc-123\",\r\n      taskId: \"bash:proc-123\",\r\n    });\r\n  });\r\n\r\n  it(\"accepts legacy background results with only taskId\", () => {\r\n    const result = coerceBashToolResult({\r\n      success: true,\r\n      output: \"started\",\r\n      exitCode: 0,\r\n      wall_duration_ms: 1,\r\n      taskId: \"bash:proc-456\",\r\n    });\r\n\r\n    expect(result).not.toBeNull();\r\n    expect(result).toMatchObject({\r\n      success: true,\r\n      backgroundProcessId: \"proc-456\",\r\n      taskId: \"bash:proc-456\",\r\n    });\r\n  });\r\n\r\n  it(\"rejects backgroundProcessId when not a string\", () => {\r\n    const result = coerceBashToolResult({\r\n      success: true,\r\n      output: \"started\",\r\n      exitCode: 0,\r\n      wall_duration_ms: 1,\r\n      // legacy sessions should never do this; ensure we fail closed\r\n      backgroundProcessId: 123,\r\n    });\r\n\r\n    expect(result).toBeNull();\r\n  });\r\n});\r\n"]}