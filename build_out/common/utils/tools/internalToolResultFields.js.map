{"version":3,"file":"internalToolResultFields.js","sourceRoot":"","sources":["../../../../src/common/utils/tools/internalToolResultFields.ts"],"names":[],"mappings":";;;;;;;;AAAA,mEAA2C;AAE3C;;;;;GAKG;AACU,QAAA,mCAAmC,GAAG,qBAA8B,CAAC;AAElF,0CACE,MAAe,EACf,aAAuB,EACd;IACT,IAAA,gBAAM,EAAC,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC,EAAE,gCAAgC,CAAC,CAAC;IACvE,IAAI,aAAa,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;QAC/B,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,IAAI,CAAC,MAAM,IAAI,OAAO,MAAM,KAAK,QAAQ,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,CAAC;QACnE,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,MAAM,MAAM,GAAG,MAAiC,CAAC;IACjD,MAAM,QAAQ,GAAG,MAAM,CAAC,QAAA,mCAAmC,CAAC,CAAC;IAC7D,MAAM,MAAM,GAAG,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC;QACpC,CAAC,CAAC;YACE,GAAI,QAAsB,CAAC,MAAM,CAAC,CAAC,IAAI,EAAkB,EAAE,CAAC,OAAO,IAAI,KAAK,QAAQ,CAAC;YACrF,GAAG,aAAa;SACjB;QACH,CAAC,CAAC,aAAa,CAAC;IAElB,OAAO;QACL,GAAG,MAAM;QACT,CAAC,QAAA,mCAAmC,CAAC,EAAE,MAAM;KAC9C,CAAC;AAAA,CACH;AAED;;GAEG;AACH,uCAA8C,MAAe,EAAW;IACtE,IAAI,CAAC,MAAM,IAAI,OAAO,MAAM,KAAK,QAAQ,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,CAAC;QACnE,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,IAAI,CAAC,CAAC,QAAA,mCAAmC,IAAI,MAAM,CAAC,EAAE,CAAC;QACrD,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,MAAM,EAAE,CAAC,QAAA,mCAAmC,CAAC,EAAE,cAAc,EAAE,GAAG,IAAI,EAAE,GAAG,MAG1E,CAAC;IACF,KAAK,cAAc,CAAC;IACpB,OAAO,IAAI,CAAC;AAAA,CACb","sourcesContent":["import assert from \"@/common/utils/assert\";\r\n\r\n/**\r\n * Reserved fields that may be injected into tool results for model-only consumption.\r\n *\r\n * IMPORTANT: These fields MUST be stripped before persisting tool outputs to disk or\r\n * sending them to the UI.\r\n */\r\nexport const MODEL_ONLY_TOOL_NOTIFICATIONS_FIELD = \"__mux_notifications\" as const;\r\n\r\nexport function attachModelOnlyToolNotifications(\r\n  result: unknown,\r\n  notifications: string[]\r\n): unknown {\r\n  assert(Array.isArray(notifications), \"notifications must be an array\");\r\n  if (notifications.length === 0) {\r\n    return result;\r\n  }\r\n\r\n  if (!result || typeof result !== \"object\" || Array.isArray(result)) {\r\n    return result;\r\n  }\r\n\r\n  const record = result as Record<string, unknown>;\r\n  const existing = record[MODEL_ONLY_TOOL_NOTIFICATIONS_FIELD];\r\n  const merged = Array.isArray(existing)\r\n    ? [\r\n        ...(existing as unknown[]).filter((item): item is string => typeof item === \"string\"),\r\n        ...notifications,\r\n      ]\r\n    : notifications;\r\n\r\n  return {\r\n    ...record,\r\n    [MODEL_ONLY_TOOL_NOTIFICATIONS_FIELD]: merged,\r\n  };\r\n}\r\n\r\n/**\r\n * Strip model-only fields from tool results before persisting them to history/partial.\r\n */\r\nexport function stripInternalToolResultFields(result: unknown): unknown {\r\n  if (!result || typeof result !== \"object\" || Array.isArray(result)) {\r\n    return result;\r\n  }\r\n\r\n  if (!(MODEL_ONLY_TOOL_NOTIFICATIONS_FIELD in result)) {\r\n    return result;\r\n  }\r\n\r\n  const { [MODEL_ONLY_TOOL_NOTIFICATIONS_FIELD]: _notifications, ...rest } = result as Record<\r\n    string,\r\n    unknown\r\n  >;\r\n  void _notifications;\r\n  return rest;\r\n}\r\n"]}