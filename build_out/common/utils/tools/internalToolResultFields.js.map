{"version":3,"file":"internalToolResultFields.js","sourceRoot":"","sources":["../../../../src/common/utils/tools/internalToolResultFields.ts"],"names":[],"mappings":";;;;;;;;AAAA,mEAA2C;AAE3C;;;;;GAKG;AACU,QAAA,mCAAmC,GAAG,qBAA8B,CAAC;AAElF,0CACE,MAAe,EACf,aAAuB,EACd;IACT,IAAA,gBAAM,EAAC,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC,EAAE,gCAAgC,CAAC,CAAC;IACvE,IAAI,aAAa,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;QAC/B,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,IAAI,CAAC,MAAM,IAAI,OAAO,MAAM,KAAK,QAAQ,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,CAAC;QACnE,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,MAAM,MAAM,GAAG,MAAiC,CAAC;IACjD,MAAM,QAAQ,GAAG,MAAM,CAAC,QAAA,mCAAmC,CAAC,CAAC;IAC7D,MAAM,MAAM,GAAG,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC;QACpC,CAAC,CAAC;YACE,GAAI,QAAsB,CAAC,MAAM,CAAC,CAAC,IAAI,EAAkB,EAAE,CAAC,OAAO,IAAI,KAAK,QAAQ,CAAC;YACrF,GAAG,aAAa;SACjB;QACH,CAAC,CAAC,aAAa,CAAC;IAElB,OAAO;QACL,GAAG,MAAM;QACT,CAAC,QAAA,mCAAmC,CAAC,EAAE,MAAM;KAC9C,CAAC;AAAA,CACH;AAED;;GAEG;AACH,uCAA8C,MAAe,EAAW;IACtE,IAAI,CAAC,MAAM,IAAI,OAAO,MAAM,KAAK,QAAQ,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,CAAC;QACnE,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,IAAI,CAAC,CAAC,QAAA,mCAAmC,IAAI,MAAM,CAAC,EAAE,CAAC;QACrD,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,MAAM,EAAE,CAAC,QAAA,mCAAmC,CAAC,EAAE,cAAc,EAAE,GAAG,IAAI,EAAE,GAAG,MAG1E,CAAC;IACF,KAAK,cAAc,CAAC;IACpB,OAAO,IAAI,CAAC;AAAA,CACb","sourcesContent":["import assert from \"@/common/utils/assert\";\n\n/**\n * Reserved fields that may be injected into tool results for model-only consumption.\n *\n * IMPORTANT: These fields MUST be stripped before persisting tool outputs to disk or\n * sending them to the UI.\n */\nexport const MODEL_ONLY_TOOL_NOTIFICATIONS_FIELD = \"__mux_notifications\" as const;\n\nexport function attachModelOnlyToolNotifications(\n  result: unknown,\n  notifications: string[]\n): unknown {\n  assert(Array.isArray(notifications), \"notifications must be an array\");\n  if (notifications.length === 0) {\n    return result;\n  }\n\n  if (!result || typeof result !== \"object\" || Array.isArray(result)) {\n    return result;\n  }\n\n  const record = result as Record<string, unknown>;\n  const existing = record[MODEL_ONLY_TOOL_NOTIFICATIONS_FIELD];\n  const merged = Array.isArray(existing)\n    ? [\n        ...(existing as unknown[]).filter((item): item is string => typeof item === \"string\"),\n        ...notifications,\n      ]\n    : notifications;\n\n  return {\n    ...record,\n    [MODEL_ONLY_TOOL_NOTIFICATIONS_FIELD]: merged,\n  };\n}\n\n/**\n * Strip model-only fields from tool results before persisting them to history/partial.\n */\nexport function stripInternalToolResultFields(result: unknown): unknown {\n  if (!result || typeof result !== \"object\" || Array.isArray(result)) {\n    return result;\n  }\n\n  if (!(MODEL_ONLY_TOOL_NOTIFICATIONS_FIELD in result)) {\n    return result;\n  }\n\n  const { [MODEL_ONLY_TOOL_NOTIFICATIONS_FIELD]: _notifications, ...rest } = result as Record<\n    string,\n    unknown\n  >;\n  void _notifications;\n  return rest;\n}\n"]}