{"version":3,"file":"schemaSanitizer.test.js","sourceRoot":"","sources":["../../../../src/common/utils/tools/schemaSanitizer.test.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access */\r\nimport { sanitizeToolSchemaForOpenAI, sanitizeMCPToolsForOpenAI } from \"./schemaSanitizer\";\r\nimport type { Tool } from \"ai\";\r\n\r\n// Test helper to access tool parameters\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nfunction getParams(tool: Tool): any {\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  return (tool as any).parameters;\r\n}\r\n\r\n// Test helper to access tool inputSchema (MCP tools)\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nfunction getInputSchema(tool: Tool): any {\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const inputSchema = (tool as any).inputSchema;\r\n  // inputSchema has a jsonSchema getter\r\n  return inputSchema?.jsonSchema;\r\n}\r\n\r\ndescribe(\"schemaSanitizer\", () => {\r\n  describe(\"sanitizeToolSchemaForOpenAI\", () => {\r\n    it(\"should strip minLength from string properties\", () => {\r\n      const tool = {\r\n        description: \"Test tool\",\r\n        parameters: {\r\n          type: \"object\",\r\n          properties: {\r\n            content: { type: \"string\", minLength: 1 },\r\n          },\r\n        },\r\n      } as unknown as Tool;\r\n\r\n      const sanitized = sanitizeToolSchemaForOpenAI(tool);\r\n      const params = getParams(sanitized);\r\n\r\n      expect(params.properties.content).toEqual({ type: \"string\" });\r\n      expect(params.properties.content.minLength).toBeUndefined();\r\n    });\r\n\r\n    it(\"should strip multiple unsupported properties\", () => {\r\n      const tool = {\r\n        description: \"Test tool\",\r\n        parameters: {\r\n          type: \"object\",\r\n          properties: {\r\n            name: { type: \"string\", minLength: 1, maxLength: 100, pattern: \"^[a-z]+$\" },\r\n            age: { type: \"number\", minimum: 0, maximum: 150, default: 25 },\r\n          },\r\n        },\r\n      } as unknown as Tool;\r\n\r\n      const sanitized = sanitizeToolSchemaForOpenAI(tool);\r\n      const params = getParams(sanitized);\r\n\r\n      expect(params.properties.name).toEqual({ type: \"string\" });\r\n      expect(params.properties.age).toEqual({ type: \"number\" });\r\n    });\r\n\r\n    it(\"should handle nested objects\", () => {\r\n      const tool = {\r\n        description: \"Test tool\",\r\n        parameters: {\r\n          type: \"object\",\r\n          properties: {\r\n            user: {\r\n              type: \"object\",\r\n              properties: {\r\n                email: { type: \"string\", format: \"email\", minLength: 5 },\r\n              },\r\n            },\r\n          },\r\n        },\r\n      } as unknown as Tool;\r\n\r\n      const sanitized = sanitizeToolSchemaForOpenAI(tool);\r\n      const params = getParams(sanitized);\r\n\r\n      expect(params.properties.user.properties.email).toEqual({ type: \"string\" });\r\n    });\r\n\r\n    it(\"should handle array items\", () => {\r\n      const tool = {\r\n        description: \"Test tool\",\r\n        parameters: {\r\n          type: \"object\",\r\n          properties: {\r\n            tags: {\r\n              type: \"array\",\r\n              items: { type: \"string\", minLength: 1 },\r\n              minItems: 1,\r\n              maxItems: 10,\r\n            },\r\n          },\r\n        },\r\n      } as unknown as Tool;\r\n\r\n      const sanitized = sanitizeToolSchemaForOpenAI(tool);\r\n      const params = getParams(sanitized);\r\n\r\n      expect(params.properties.tags.items).toEqual({ type: \"string\" });\r\n      expect(params.properties.tags.minItems).toBeUndefined();\r\n      expect(params.properties.tags.maxItems).toBeUndefined();\r\n    });\r\n\r\n    it(\"should handle anyOf/oneOf schemas\", () => {\r\n      const tool = {\r\n        description: \"Test tool\",\r\n        parameters: {\r\n          type: \"object\",\r\n          properties: {\r\n            value: {\r\n              oneOf: [\r\n                { type: \"string\", minLength: 1 },\r\n                { type: \"number\", minimum: 0 },\r\n              ],\r\n            },\r\n          },\r\n        },\r\n      } as unknown as Tool;\r\n\r\n      const sanitized = sanitizeToolSchemaForOpenAI(tool);\r\n      const params = getParams(sanitized);\r\n\r\n      expect(params.properties.value.oneOf[0]).toEqual({ type: \"string\" });\r\n      expect(params.properties.value.oneOf[1]).toEqual({ type: \"number\" });\r\n    });\r\n\r\n    it(\"should preserve required and type properties\", () => {\r\n      const tool = {\r\n        description: \"Test tool\",\r\n        parameters: {\r\n          type: \"object\",\r\n          properties: {\r\n            content: { type: \"string\", minLength: 1 },\r\n          },\r\n          required: [\"content\"],\r\n        },\r\n      } as unknown as Tool;\r\n\r\n      const sanitized = sanitizeToolSchemaForOpenAI(tool);\r\n      const params = getParams(sanitized);\r\n\r\n      expect(params.type).toBe(\"object\");\r\n      expect(params.required).toEqual([\"content\"]);\r\n    });\r\n\r\n    it(\"should return tool as-is if no parameters\", () => {\r\n      const tool = {\r\n        description: \"Test tool\",\r\n      } as unknown as Tool;\r\n\r\n      const sanitized = sanitizeToolSchemaForOpenAI(tool);\r\n\r\n      expect(sanitized).toEqual(tool);\r\n    });\r\n\r\n    it(\"should not mutate the original tool\", () => {\r\n      const tool = {\r\n        description: \"Test tool\",\r\n        parameters: {\r\n          type: \"object\",\r\n          properties: {\r\n            content: { type: \"string\", minLength: 1 },\r\n          },\r\n        },\r\n      } as unknown as Tool;\r\n\r\n      sanitizeToolSchemaForOpenAI(tool);\r\n      const params = getParams(tool);\r\n\r\n      // Original should still have minLength\r\n      expect(params.properties.content.minLength).toBe(1);\r\n    });\r\n\r\n    it(\"should sanitize MCP tools with inputSchema\", () => {\r\n      // MCP tools use inputSchema with a jsonSchema getter instead of parameters\r\n      const jsonSchema = {\r\n        type: \"object\",\r\n        properties: {\r\n          content: { type: \"string\", minLength: 1, maxLength: 100 },\r\n          count: { type: \"number\", minimum: 0, maximum: 10 },\r\n        },\r\n        required: [\"content\"],\r\n      };\r\n\r\n      const mcpTool = {\r\n        type: \"dynamic\",\r\n        description: \"MCP test tool\",\r\n        inputSchema: {\r\n          // Simulate the jsonSchema getter that @ai-sdk/mcp creates\r\n          get jsonSchema() {\r\n            return jsonSchema;\r\n          },\r\n        },\r\n        execute: () => Promise.resolve({}),\r\n      } as unknown as Tool;\r\n\r\n      const sanitized = sanitizeToolSchemaForOpenAI(mcpTool);\r\n      const schema = getInputSchema(sanitized);\r\n\r\n      // Unsupported properties should be stripped\r\n      expect(schema.properties.content).toEqual({ type: \"string\" });\r\n      expect(schema.properties.count).toEqual({ type: \"number\" });\r\n      // Supported properties should be preserved\r\n      expect(schema.type).toBe(\"object\");\r\n      expect(schema.required).toEqual([\"content\"]);\r\n    });\r\n\r\n    it(\"should not mutate the original MCP tool inputSchema\", () => {\r\n      const jsonSchema = {\r\n        type: \"object\",\r\n        properties: {\r\n          content: { type: \"string\", minLength: 1 },\r\n        },\r\n      };\r\n\r\n      const mcpTool = {\r\n        type: \"dynamic\",\r\n        description: \"MCP test tool\",\r\n        inputSchema: {\r\n          get jsonSchema() {\r\n            return jsonSchema;\r\n          },\r\n        },\r\n        execute: () => Promise.resolve({}),\r\n      } as unknown as Tool;\r\n\r\n      sanitizeToolSchemaForOpenAI(mcpTool);\r\n\r\n      // Original should still have minLength\r\n      expect(jsonSchema.properties.content.minLength).toBe(1);\r\n    });\r\n  });\r\n\r\n  describe(\"sanitizeMCPToolsForOpenAI\", () => {\r\n    it(\"should sanitize all tools in a record\", () => {\r\n      const tools = {\r\n        tool1: {\r\n          description: \"Tool 1\",\r\n          parameters: {\r\n            type: \"object\",\r\n            properties: {\r\n              content: { type: \"string\", minLength: 1 },\r\n            },\r\n          },\r\n        },\r\n        tool2: {\r\n          description: \"Tool 2\",\r\n          parameters: {\r\n            type: \"object\",\r\n            properties: {\r\n              count: { type: \"number\", minimum: 0 },\r\n            },\r\n          },\r\n        },\r\n      } as unknown as Record<string, Tool>;\r\n\r\n      const sanitized = sanitizeMCPToolsForOpenAI(tools);\r\n\r\n      expect(getParams(sanitized.tool1).properties.content).toEqual({\r\n        type: \"string\",\r\n      });\r\n      expect(getParams(sanitized.tool2).properties.count).toEqual({\r\n        type: \"number\",\r\n      });\r\n    });\r\n  });\r\n});\r\n"]}