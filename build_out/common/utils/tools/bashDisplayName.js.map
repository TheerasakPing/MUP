{"version":3,"file":"bashDisplayName.js","sourceRoot":"","sources":["../../../../src/common/utils/tools/bashDisplayName.ts"],"names":[],"mappings":";AAAA,wDAAwD;AACxD,EAAE;AACF,qFAAqF;AACrF,yFAAyF;;;;AAEzF,MAAM,yBAAyB,GAAG,MAAM,CAAC;AACzC,MAAM,2BAA2B,GAAG,EAAE,CAAC;AAEvC,MAAM,sBAAsB,GAAG,eAAe,CAAC;AAC/C,MAAM,uBAAuB,GAAG,SAAS,CAAC;AAE1C,SAAS,uBAAuB,CAAC,OAAe,EAAU;IACxD,uDAAuD;IACvD,IAAI,IAAI,GAAG,OAAO,CAAC,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;IAE/C,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC;QAAE,OAAO,yBAAyB,CAAC;IAExD,iFAAiF;IACjF,IAAI,IAAI,CAAC,MAAM,GAAG,2BAA2B,EAAE,CAAC;QAC9C,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,2BAA2B,CAAC,CAAC;IACpD,CAAC;IAED,2EAA2E;IAC3E,IAAI,oBAAoB,GAAG,EAAE,CAAC;IAC9B,KAAK,MAAM,IAAI,IAAI,IAAI,EAAE,CAAC;QACxB,MAAM,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;QACjC,oBAAoB,IAAI,IAAI,KAAK,SAAS,IAAI,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC;IACzE,CAAC;IACD,IAAI,GAAG,oBAAoB,CAAC;IAE5B,2FAA2F;IAC3F,6EAA6E;IAC7E,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,sBAAsB,EAAE,GAAG,CAAC,CAAC;IACjD,4DAA4D;IAC5D,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,uBAAuB,EAAE,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;IAExD,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,IAAI,IAAI,KAAK,GAAG,IAAI,IAAI,KAAK,IAAI;QAAE,OAAO,yBAAyB,CAAC;IAEzF,OAAO,IAAI,CAAC;AAAA,CACb;AAED,mCAA0C,MAAc,EAAU;IAChE,MAAM,iBAAiB,GACrB,MAAM;SACH,KAAK,CAAC,OAAO,CAAC;SACd,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;SAC1B,IAAI,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;IAE3C,OAAO,uBAAuB,CAAC,iBAAiB,CAAC,CAAC;AAAA,CACnD;AAED,gCAAuC,MAAc,EAAE,WAA+B,EAAU;IAC9F,MAAM,OAAO,GAAG,WAAW,EAAE,IAAI,EAAE,CAAC;IACpC,IAAI,OAAO,IAAI,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;QAClC,OAAO,uBAAuB,CAAC,OAAO,CAAC,CAAC;IAC1C,CAAC;IAED,OAAO,yBAAyB,CAAC,MAAM,CAAC,CAAC;AAAA,CAC1C","sourcesContent":["// Shared helper for generating bash task display names.\n//\n// Background process IDs are derived from display names and used as directory names.\n// When display_name is omitted, we derive a short, filesystem-safe name from the script.\n\nconst DEFAULT_BASH_DISPLAY_NAME = \"bash\";\nconst MAX_BASH_DISPLAY_NAME_CHARS = 80;\n\nconst INVALID_FILENAME_CHARS = /[<>:\"/\\\\|?*]/g;\nconst TRAILING_DOTS_OR_SPACES = /[. ]+$/g;\n\nfunction sanitizeBashDisplayName(rawName: string): string {\n  // Collapse whitespace to keep IDs readable and stable.\n  let name = rawName.replace(/\\s+/g, \" \").trim();\n\n  if (name.length === 0) return DEFAULT_BASH_DISPLAY_NAME;\n\n  // Bound the length before filename sanitization to avoid excessively-long paths.\n  if (name.length > MAX_BASH_DISPLAY_NAME_CHARS) {\n    name = name.slice(0, MAX_BASH_DISPLAY_NAME_CHARS);\n  }\n\n  // Replace ASCII control characters (0x00-0x1F) to avoid invalid filenames.\n  let controlCharsStripped = \"\";\n  for (const char of name) {\n    const code = char.codePointAt(0);\n    controlCharsStripped += code !== undefined && code < 0x20 ? \"_\" : char;\n  }\n  name = controlCharsStripped;\n\n  // Replace characters that are illegal in Windows filenames (and also problematic on Unix).\n  // This includes path separators, preventing path traversal via display_name.\n  name = name.replace(INVALID_FILENAME_CHARS, \"_\");\n  // Windows disallows trailing dots/spaces in file/dir names.\n  name = name.replace(TRAILING_DOTS_OR_SPACES, \"\").trim();\n\n  if (name.length === 0 || name === \".\" || name === \"..\") return DEFAULT_BASH_DISPLAY_NAME;\n\n  return name;\n}\n\nexport function getDefaultBashDisplayName(script: string): string {\n  const firstNonEmptyLine =\n    script\n      .split(/\\r?\\n/)\n      .map((line) => line.trim())\n      .find((line) => line.length > 0) ?? \"\";\n\n  return sanitizeBashDisplayName(firstNonEmptyLine);\n}\n\nexport function resolveBashDisplayName(script: string, displayName: string | undefined): string {\n  const trimmed = displayName?.trim();\n  if (trimmed && trimmed.length > 0) {\n    return sanitizeBashDisplayName(trimmed);\n  }\n\n  return getDefaultBashDisplayName(script);\n}\n"]}