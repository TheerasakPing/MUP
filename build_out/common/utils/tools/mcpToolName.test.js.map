{"version":3,"file":"mcpToolName.test.js","sourceRoot":"","sources":["../../../../src/common/utils/tools/mcpToolName.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, expect, test } from \"bun:test\";\r\n\r\nimport { uniqueSuffix } from \"@/common/utils/hasher\";\r\n\r\nimport { buildMcpToolName, normalizeMcpToolNamePart } from \"./mcpToolName\";\r\n\r\ndescribe(\"mcpToolName\", () => {\r\n  describe(\"normalizeMcpToolNamePart\", () => {\r\n    test(\"lowercases and replaces spaces with underscores\", () => {\r\n      expect(normalizeMcpToolNamePart(\"Chrome DevTools\")).toBe(\"chrome_devtools\");\r\n    });\r\n\r\n    test(\"treats non-alphanumeric characters as separators\", () => {\r\n      expect(normalizeMcpToolNamePart(\"chrome-devtools/mcp\")).toBe(\"chrome_devtools_mcp\");\r\n    });\r\n\r\n    test(\"falls back to 'unknown' when nothing is left after sanitization\", () => {\r\n      expect(normalizeMcpToolNamePart(\"!!!\")).toBe(\"unknown\");\r\n    });\r\n  });\r\n\r\n  describe(\"buildMcpToolName\", () => {\r\n    test(\"builds a stable base name for provider-safe MCP tools\", () => {\r\n      const usedNames = new Set<string>();\r\n      const result = buildMcpToolName({\r\n        serverName: \"Chrome DevTools\",\r\n        toolName: \"click\",\r\n        usedNames,\r\n      });\r\n\r\n      expect(result).toEqual({\r\n        toolName: \"chrome_devtools_click\",\r\n        baseName: \"chrome_devtools_click\",\r\n        wasSuffixed: false,\r\n      });\r\n    });\r\n\r\n    test(\"adds a stable suffix on collision\", () => {\r\n      const usedNames = new Set<string>();\r\n\r\n      const first = buildMcpToolName({ serverName: \"foo bar\", toolName: \"baz\", usedNames });\r\n      expect(first).toBeDefined();\r\n      expect(first!.toolName).toBe(\"foo_bar_baz\");\r\n      expect(first!.wasSuffixed).toBe(false);\r\n\r\n      const second = buildMcpToolName({ serverName: \"foo_bar\", toolName: \"baz\", usedNames });\r\n      expect(second).toBeDefined();\r\n      expect(second!.baseName).toBe(\"foo_bar_baz\");\r\n      expect(second!.wasSuffixed).toBe(true);\r\n\r\n      const expectedSuffix = uniqueSuffix([\"foo_bar\", \"baz\"]);\r\n      expect(second!.toolName).toBe(`foo_bar_baz_${expectedSuffix}`);\r\n    });\r\n\r\n    test(\"enforces the 64 character limit via truncation + suffix\", () => {\r\n      const usedNames = new Set<string>();\r\n\r\n      const serverName = \"a\".repeat(60);\r\n      const toolName = \"b\".repeat(10);\r\n\r\n      const result = buildMcpToolName({ serverName, toolName, usedNames });\r\n      expect(result).toBeDefined();\r\n      expect(result!.wasSuffixed).toBe(true);\r\n      expect(result!.toolName.length).toBe(64);\r\n\r\n      const expectedSuffix = uniqueSuffix([serverName, toolName]);\r\n      expect(result!.toolName.endsWith(`_${expectedSuffix}`)).toBe(true);\r\n      expect(result!.toolName).toMatch(/^[a-z0-9_]+$/);\r\n    });\r\n  });\r\n});\r\n"]}