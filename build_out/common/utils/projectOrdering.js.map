{"version":3,"file":"projectOrdering.js","sourceRoot":"","sources":["../../../src/common/utils/projectOrdering.ts"],"names":[],"mappings":"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","sourcesContent":["// Utilities for ordering and reordering projects in the sidebar\r\n// Developer notes:\r\n// - Order is a UI concern only. Persist it with usePersistedState in localStorage.\r\n// - We represent order as an array of project paths (string[]).\r\n// - This file is intentionally framework-agnostic and pure for easy testing.\r\n\r\nimport type { ProjectConfig } from \"@/node/config\";\r\n\r\n/**\r\n * Sort projects by the provided order array. Unknown projects go to the end preserving natural order.\r\n */\r\nexport function sortProjectsByOrder(\r\n  projects: Map<string, ProjectConfig>,\r\n  order: string[]\r\n): Array<[string, ProjectConfig]> {\r\n  const entries = Array.from(projects.entries());\r\n\r\n  if (order.length === 0) {\r\n    // Sort lexically for stable, deterministic order\r\n    return entries.sort(([a], [b]) => a.localeCompare(b));\r\n  }\r\n\r\n  const pos = new Map(order.map((p, i) => [p, i]));\r\n\r\n  return entries.sort(([a], [b]) => {\r\n    const ia = pos.get(a);\r\n    const ib = pos.get(b);\r\n    const da = ia ?? Number.MAX_SAFE_INTEGER;\r\n    const db = ib ?? Number.MAX_SAFE_INTEGER;\r\n    // Stable sort for equal positions: fall back to lexical path\r\n    if (da === db) return a.localeCompare(b);\r\n    return da - db;\r\n  });\r\n}\r\n\r\n/**\r\n * Recompute the order array after dragging one project onto another.\r\n * Drop semantics: place dragged item at the target's index.\r\n */\r\nexport function reorderProjects(\r\n  currentOrder: string[],\r\n  allProjects: Map<string, ProjectConfig>,\r\n  draggedPath: string,\r\n  targetPath: string\r\n): string[] {\r\n  const sorted = sortProjectsByOrder(allProjects, currentOrder).map(([p]) => p);\r\n\r\n  const from = sorted.indexOf(draggedPath);\r\n  const to = sorted.indexOf(targetPath);\r\n\r\n  if (from === -1 || to === -1 || from === to) return sorted;\r\n\r\n  const next = [...sorted];\r\n  const [moved] = next.splice(from, 1);\r\n  next.splice(to, 0, moved);\r\n  return next;\r\n}\r\n\r\n/**\r\n * Normalize an order array against the current set of projects.\r\n * - Removes paths that no longer exist\r\n * - Prepends new paths to the front (preserving their natural order)\r\n *\r\n * UX rationale: when a user adds a project, they almost always want to use it next. Putting newly\r\n * added projects at the top makes that action feel \"recent\" even if the user already has a custom\r\n * project ordering.\r\n */\r\nexport function normalizeOrder(order: string[], projects: Map<string, ProjectConfig>): string[] {\r\n  const present = new Set(projects.keys());\r\n  const filtered = order.filter((p) => present.has(p));\r\n  // Sort missing projects lexically for deterministic order (avoids flaky UI in Storybook)\r\n  const missing = Array.from(projects.keys())\r\n    .filter((p) => !filtered.includes(p))\r\n    .sort((a, b) => a.localeCompare(b));\r\n  return [...missing, ...filtered];\r\n}\r\n\r\n/**\r\n * Shallow equality for string arrays.\r\n */\r\nexport function equalOrders(a: string[], b: string[]): boolean {\r\n  if (a === b) return true;\r\n  if (a.length !== b.length) return false;\r\n  for (let i = 0; i < a.length; i++) if (a[i] !== b[i]) return false;\r\n  return true;\r\n}\r\n"]}