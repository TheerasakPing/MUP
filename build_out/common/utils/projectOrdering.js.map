{"version":3,"file":"projectOrdering.js","sourceRoot":"","sources":["../../../src/common/utils/projectOrdering.ts"],"names":[],"mappings":"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","sourcesContent":["// Utilities for ordering and reordering projects in the sidebar\n// Developer notes:\n// - Order is a UI concern only. Persist it with usePersistedState in localStorage.\n// - We represent order as an array of project paths (string[]).\n// - This file is intentionally framework-agnostic and pure for easy testing.\n\nimport type { ProjectConfig } from \"@/node/config\";\n\n/**\n * Sort projects by the provided order array. Unknown projects go to the end preserving natural order.\n */\nexport function sortProjectsByOrder(\n  projects: Map<string, ProjectConfig>,\n  order: string[]\n): Array<[string, ProjectConfig]> {\n  const entries = Array.from(projects.entries());\n\n  if (order.length === 0) {\n    // Sort lexically for stable, deterministic order\n    return entries.sort(([a], [b]) => a.localeCompare(b));\n  }\n\n  const pos = new Map(order.map((p, i) => [p, i]));\n\n  return entries.sort(([a], [b]) => {\n    const ia = pos.get(a);\n    const ib = pos.get(b);\n    const da = ia ?? Number.MAX_SAFE_INTEGER;\n    const db = ib ?? Number.MAX_SAFE_INTEGER;\n    // Stable sort for equal positions: fall back to lexical path\n    if (da === db) return a.localeCompare(b);\n    return da - db;\n  });\n}\n\n/**\n * Recompute the order array after dragging one project onto another.\n * Drop semantics: place dragged item at the target's index.\n */\nexport function reorderProjects(\n  currentOrder: string[],\n  allProjects: Map<string, ProjectConfig>,\n  draggedPath: string,\n  targetPath: string\n): string[] {\n  const sorted = sortProjectsByOrder(allProjects, currentOrder).map(([p]) => p);\n\n  const from = sorted.indexOf(draggedPath);\n  const to = sorted.indexOf(targetPath);\n\n  if (from === -1 || to === -1 || from === to) return sorted;\n\n  const next = [...sorted];\n  const [moved] = next.splice(from, 1);\n  next.splice(to, 0, moved);\n  return next;\n}\n\n/**\n * Normalize an order array against the current set of projects.\n * - Removes paths that no longer exist\n * - Prepends new paths to the front (preserving their natural order)\n *\n * UX rationale: when a user adds a project, they almost always want to use it next. Putting newly\n * added projects at the top makes that action feel \"recent\" even if the user already has a custom\n * project ordering.\n */\nexport function normalizeOrder(order: string[], projects: Map<string, ProjectConfig>): string[] {\n  const present = new Set(projects.keys());\n  const filtered = order.filter((p) => present.has(p));\n  // Sort missing projects lexically for deterministic order (avoids flaky UI in Storybook)\n  const missing = Array.from(projects.keys())\n    .filter((p) => !filtered.includes(p))\n    .sort((a, b) => a.localeCompare(b));\n  return [...missing, ...filtered];\n}\n\n/**\n * Shallow equality for string arrays.\n */\nexport function equalOrders(a: string[], b: string[]): boolean {\n  if (a === b) return true;\n  if (a.length !== b.length) return false;\n  for (let i = 0; i < a.length; i++) if (a[i] !== b[i]) return false;\n  return true;\n}\n"]}