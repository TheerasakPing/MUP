{"version":3,"file":"parseGitLog.test.js","sourceRoot":"","sources":["../../../../src/common/utils/git/parseGitLog.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, test, expect } from \"bun:test\";\r\nimport { parseGitShowBranch } from \"./parseGitLog\";\r\n\r\ndescribe(\"parseGitShowBranch\", () => {\r\n  test(\"should preserve indicator positions for three-way divergence\", () => {\r\n    // Real output from ci-codex workspace showing HEAD (ci-codex), origin/ci-codex, and origin/main\r\n    // Order: HEAD, origin/<branch>, origin/main\r\n    const output = `! [HEAD]  Trigger CI after resolving Codex comments\r\n ! [origin/ci-codex]  Trigger CI after resolving Codex comments\r\n  ! [origin/main] fix: improve compaction\r\n---\r\n  + [9050a56] fix: improve compaction\r\n  + [dad16a3] feat: change interrupt stream keybind to Ctrl+C\r\n  + [5006273]  Add CI job to block merge on unresolved Codex comments (#76)\r\n++  [027552c]  Trigger CI after resolving Codex comments\r\n++  [2fe99bf]  Fix: Check resolved status for Codex review comments\r\n++  [34f3c52]  Add CI job to block merge on unresolved Codex comments\r\n+++ [9543f22]  Fix: Restore base64: prefix for CSC_LINK (#75)`;\r\n\r\n    const dateMap = new Map([\r\n      [\"9050a56\", \"Oct 07 02:16 PM\"],\r\n      [\"dad16a3\", \"Oct 06 11:22 PM\"],\r\n      [\"5006273\", \"Oct 06 04:49 PM\"],\r\n      [\"027552c\", \"Oct 07 01:16 PM\"],\r\n      [\"2fe99bf\", \"Oct 07 12:49 PM\"],\r\n      [\"34f3c52\", \"Oct 07 12:22 PM\"],\r\n      [\"9543f22\", \"Oct 06 08:49 PM\"],\r\n    ]);\r\n\r\n    const result = parseGitShowBranch(output, dateMap);\r\n\r\n    // Verify headers\r\n    expect(result.headers).toHaveLength(3);\r\n    expect(result.headers[0]).toEqual({ branch: \"HEAD\", columnIndex: 0 });\r\n    expect(result.headers[1]).toEqual({ branch: \"origin/ci-codex\", columnIndex: 1 });\r\n    expect(result.headers[2]).toEqual({ branch: \"origin/main\", columnIndex: 2 });\r\n\r\n    // Verify commits\r\n    expect(result.commits).toHaveLength(7);\r\n\r\n    // First commit: \"  +\" - only on origin/main (column 2)\r\n    expect(result.commits[0].indicators).toBe(\"  +\");\r\n    expect(result.commits[0].indicators.length).toBe(3);\r\n    expect(result.commits[0].indicators[0]).toBe(\" \"); // Not on HEAD\r\n    expect(result.commits[0].indicators[1]).toBe(\" \"); // Not on origin/ci-codex\r\n    expect(result.commits[0].indicators[2]).toBe(\"+\"); // On origin/main\r\n    expect(result.commits[0].hash).toBe(\"9050a56\");\r\n\r\n    // Fourth commit: \"++  \" - on HEAD and origin/ci-codex (columns 0 and 1)\r\n    expect(result.commits[3].indicators).toBe(\"++ \");\r\n    expect(result.commits[3].indicators.length).toBe(3);\r\n    expect(result.commits[3].indicators[0]).toBe(\"+\"); // On HEAD\r\n    expect(result.commits[3].indicators[1]).toBe(\"+\"); // On origin/ci-codex\r\n    expect(result.commits[3].indicators[2]).toBe(\" \"); // Not on origin/main\r\n    expect(result.commits[3].hash).toBe(\"027552c\");\r\n\r\n    // Last commit: \"+++\" - on all three branches\r\n    expect(result.commits[6].indicators).toBe(\"+++\");\r\n    expect(result.commits[6].indicators.length).toBe(3);\r\n    expect(result.commits[6].indicators[0]).toBe(\"+\"); // On HEAD\r\n    expect(result.commits[6].indicators[1]).toBe(\"+\"); // On origin/ci-codex\r\n    expect(result.commits[6].indicators[2]).toBe(\"+\"); // On origin/main\r\n    expect(result.commits[6].hash).toBe(\"9543f22\");\r\n  });\r\n\r\n  test(\"should handle two-branch divergence\", () => {\r\n    const output = `! [HEAD] Latest on HEAD\r\n ! [origin/main] Latest on main\r\n--\r\n + [abc1234] Only on main\r\n+  [def5678] Only on HEAD\r\n++ [012abcd] On both`;\r\n\r\n    const dateMap = new Map<string, string>();\r\n\r\n    const result = parseGitShowBranch(output, dateMap);\r\n\r\n    expect(result.headers).toHaveLength(2);\r\n    expect(result.commits).toHaveLength(3);\r\n\r\n    // Indicators should be exactly 2 characters\r\n    expect(result.commits[0].indicators).toBe(\" +\");\r\n    expect(result.commits[1].indicators).toBe(\"+ \");\r\n    expect(result.commits[2].indicators).toBe(\"++\");\r\n  });\r\n\r\n  test(\"should handle empty output\", () => {\r\n    const result = parseGitShowBranch(\"\", new Map<string, string>());\r\n    expect(result.headers).toHaveLength(0);\r\n    expect(result.commits).toHaveLength(0);\r\n  });\r\n});\r\n"]}