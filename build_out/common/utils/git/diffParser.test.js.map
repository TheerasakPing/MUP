{"version":3,"file":"diffParser.test.js","sourceRoot":"","sources":["../../../../src/common/utils/git/diffParser.test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Tests for git diff parsing using a real git repository\r\n * IMPORTANT: Uses actual git commands, not simulated diffs\r\n */\r\n\r\nimport { describe, it, expect, beforeAll, afterAll } from \"bun:test\";\r\nimport { mkdtempSync, rmSync } from \"fs\";\r\nimport { writeFileSync } from \"fs\";\r\nimport { join } from \"path\";\r\nimport { tmpdir } from \"os\";\r\nimport { execSync } from \"child_process\";\r\nimport { parseDiff, extractAllHunks, buildGitDiffCommand } from \"./diffParser\";\r\n\r\ndescribe(\"git diff parser (real repository)\", () => {\r\n  let testRepoPath: string;\r\n\r\n  beforeAll(() => {\r\n    // Create a temporary directory for our test repo\r\n    testRepoPath = mkdtempSync(join(tmpdir(), \"git-diff-test-\"));\r\n\r\n    // Initialize git repo\r\n    execSync(\"git init\", { cwd: testRepoPath });\r\n    execSync('git config user.email \"test@example.com\"', { cwd: testRepoPath });\r\n    // Disable commit signing (some developer machines enforce signing via global config)\r\n    execSync(\"git config commit.gpgsign false\", { cwd: testRepoPath });\r\n    execSync('git config user.name \"Test User\"', { cwd: testRepoPath });\r\n\r\n    // Create initial commit with a file\r\n    writeFileSync(join(testRepoPath, \"file1.txt\"), \"Line 1\\nLine 2\\nLine 3\\nLine 4\\nLine 5\\n\");\r\n    writeFileSync(\r\n      join(testRepoPath, \"file2.js\"),\r\n      'function hello() {\\n  console.log(\"Hello\");\\n}\\n'\r\n    );\r\n    execSync(\"git add .\", { cwd: testRepoPath });\r\n    execSync('git commit -m \"Initial commit\"', { cwd: testRepoPath });\r\n  });\r\n\r\n  afterAll(() => {\r\n    // Clean up test repo\r\n    rmSync(testRepoPath, { recursive: true, force: true });\r\n  });\r\n\r\n  it(\"should parse single file modification\", () => {\r\n    // Modify file1.txt\r\n    writeFileSync(\r\n      join(testRepoPath, \"file1.txt\"),\r\n      \"Line 1\\nLine 2 modified\\nLine 3\\nLine 4\\nLine 5\\n\"\r\n    );\r\n\r\n    // Get git diff\r\n    const diff = execSync(\"git diff HEAD\", { cwd: testRepoPath, encoding: \"utf-8\" });\r\n\r\n    // Parse diff\r\n    const fileDiffs = parseDiff(diff);\r\n\r\n    expect(fileDiffs.length).toBe(1);\r\n    expect(fileDiffs[0].filePath).toBe(\"file1.txt\");\r\n    expect(fileDiffs[0].hunks.length).toBeGreaterThan(0);\r\n\r\n    const allHunks = extractAllHunks(fileDiffs);\r\n    expect(allHunks.length).toBeGreaterThan(0);\r\n    expect(allHunks[0].filePath).toBe(\"file1.txt\");\r\n    expect(allHunks[0].content.includes(\"modified\")).toBe(true);\r\n  });\r\n\r\n  it(\"should parse multiple file modifications\", () => {\r\n    // Modify both files\r\n    writeFileSync(\r\n      join(testRepoPath, \"file1.txt\"),\r\n      \"Line 1\\nNew line\\nLine 2\\nLine 3\\nLine 4\\nLine 5\\n\"\r\n    );\r\n    writeFileSync(\r\n      join(testRepoPath, \"file2.js\"),\r\n      'function hello() {\\n  console.log(\"Hello World\");\\n  return true;\\n}\\n'\r\n    );\r\n\r\n    const diff = execSync(\"git diff HEAD\", { cwd: testRepoPath, encoding: \"utf-8\" });\r\n    const fileDiffs = parseDiff(diff);\r\n\r\n    expect(fileDiffs.length).toBe(2);\r\n\r\n    const file1Diff = fileDiffs.find((f) => f.filePath === \"file1.txt\");\r\n    const file2Diff = fileDiffs.find((f) => f.filePath === \"file2.js\");\r\n\r\n    expect(file1Diff).toBeDefined();\r\n    expect(file2Diff).toBeDefined();\r\n\r\n    const allHunks = extractAllHunks(fileDiffs);\r\n    expect(allHunks.length).toBeGreaterThan(1);\r\n  });\r\n\r\n  it(\"should parse new file addition\", () => {\r\n    // Reset working directory\r\n    execSync(\"git reset --hard HEAD\", { cwd: testRepoPath });\r\n\r\n    // Add new file\r\n    writeFileSync(join(testRepoPath, \"newfile.md\"), \"# New File\\n\\nContent here\\n\");\r\n    execSync(\"git add newfile.md\", { cwd: testRepoPath });\r\n\r\n    const diff = execSync(\"git diff --cached\", { cwd: testRepoPath, encoding: \"utf-8\" });\r\n    const fileDiffs = parseDiff(diff);\r\n\r\n    expect(fileDiffs).toHaveLength(1);\r\n    expect(fileDiffs[0].filePath).toBe(\"newfile.md\");\r\n    expect(fileDiffs[0].changeType).toBe(\"added\");\r\n    expect(fileDiffs[0].hunks.length).toBeGreaterThan(0);\r\n\r\n    const hunk = fileDiffs[0].hunks[0];\r\n    expect(hunk.oldStart).toBe(0);\r\n    expect(hunk.oldLines).toBe(0);\r\n    expect(hunk.newStart).toBe(1);\r\n    expect(hunk.header).toMatch(/^@@ -0,0 \\+1,\\d+ @@/);\r\n\r\n    const contentLines = hunk.content.split(\"\\n\");\r\n\r\n    // Most lines should be additions. We intentionally tolerate a trailing\r\n    // \"phantom\" context line (\" \") because it helps keep the UI stable when the\r\n    // unified diff ends with a newline.\r\n    const nonPhantomLines = contentLines.filter((l) => l !== \" \");\r\n    expect(nonPhantomLines.length).toBeGreaterThan(0);\r\n    expect(nonPhantomLines.every((l) => l.startsWith(\"+\"))).toBe(true);\r\n  });\r\n\r\n  it(\"should normalize CRLF diff output (no \\\\r in hunk content)\", () => {\r\n    const diffOutput =\r\n      [\r\n        \"diff --git a/crlf.txt b/crlf.txt\",\r\n        \"new file mode 100644\",\r\n        \"index 0000000..1111111\",\r\n        \"--- /dev/null\",\r\n        \"+++ b/crlf.txt\",\r\n        \"@@ -0,0 +1,2 @@\",\r\n        \"+hello\",\r\n        \"+world\",\r\n      ].join(\"\\r\\n\") + \"\\r\\n\";\r\n\r\n    const fileDiffs = parseDiff(diffOutput);\r\n\r\n    expect(fileDiffs).toHaveLength(1);\r\n    expect(fileDiffs[0].filePath).toBe(\"crlf.txt\");\r\n    expect(fileDiffs[0].changeType).toBe(\"added\");\r\n    expect(fileDiffs[0].hunks).toHaveLength(1);\r\n\r\n    const hunk = fileDiffs[0].hunks[0];\r\n    expect(hunk.oldStart).toBe(0);\r\n    expect(hunk.newStart).toBe(1);\r\n\r\n    // `parseDiff` should strip CRLF-derived carriage returns.\r\n    expect(hunk.content.includes(\"\\r\")).toBe(false);\r\n\r\n    // Preserve any trailing phantom context line behavior, but the actual added\r\n    // content should still be present and uncorrupted.\r\n    expect(hunk.content.startsWith(\"+hello\\n+world\")).toBe(true);\r\n  });\r\n\r\n  it(\"should parse file deletion\", () => {\r\n    // Reset and commit newfile\r\n    execSync(\"git add . && git commit -m 'Add newfile'\", { cwd: testRepoPath });\r\n\r\n    // Delete file\r\n    execSync(\"rm newfile.md\", { cwd: testRepoPath });\r\n\r\n    const diff = execSync(\"git diff HEAD\", { cwd: testRepoPath, encoding: \"utf-8\" });\r\n    const fileDiffs = parseDiff(diff);\r\n\r\n    expect(fileDiffs.length).toBe(1);\r\n    expect(fileDiffs[0].filePath).toBe(\"newfile.md\");\r\n\r\n    const allHunks = extractAllHunks(fileDiffs);\r\n    // Check that all content lines start with - (deletions)\r\n    const contentLines = allHunks[0].content.split(\"\\n\");\r\n    expect(contentLines.some((l) => l.startsWith(\"-\"))).toBe(true);\r\n  });\r\n\r\n  it(\"should parse branch comparison (three-dot diff)\", () => {\r\n    // Reset\r\n    execSync(\"git reset --hard HEAD\", { cwd: testRepoPath });\r\n\r\n    // Create a feature branch\r\n    execSync(\"git checkout -b feature\", { cwd: testRepoPath });\r\n\r\n    // Make changes on feature branch\r\n    writeFileSync(join(testRepoPath, \"feature.txt\"), \"Feature content\\n\");\r\n    execSync(\"git add . && git commit -m 'Add feature'\", { cwd: testRepoPath });\r\n\r\n    // Checkout main and compare\r\n    execSync(\"git checkout -\", { cwd: testRepoPath });\r\n    const baseBranch = execSync(\"git rev-parse --abbrev-ref HEAD\", {\r\n      cwd: testRepoPath,\r\n      encoding: \"utf-8\",\r\n    }).trim();\r\n\r\n    const diff = execSync(`git diff ${baseBranch}...feature`, {\r\n      cwd: testRepoPath,\r\n      encoding: \"utf-8\",\r\n    });\r\n\r\n    const fileDiffs = parseDiff(diff);\r\n    expect(fileDiffs.length).toBeGreaterThan(0);\r\n\r\n    const featureFile = fileDiffs.find((f) => f.filePath === \"feature.txt\");\r\n    expect(featureFile).toBeDefined();\r\n  });\r\n\r\n  it(\"should handle empty diff\", () => {\r\n    // Reset to clean state\r\n    execSync(\"git reset --hard HEAD\", { cwd: testRepoPath });\r\n\r\n    const diff = execSync(\"git diff HEAD\", { cwd: testRepoPath, encoding: \"utf-8\" });\r\n    const fileDiffs = parseDiff(diff);\r\n\r\n    expect(fileDiffs.length).toBe(0);\r\n\r\n    const allHunks = extractAllHunks(fileDiffs);\r\n    expect(allHunks.length).toBe(0);\r\n  });\r\n\r\n  it(\"should generate stable hunk IDs for same content\", () => {\r\n    // Reset\r\n    execSync(\"git reset --hard HEAD\", { cwd: testRepoPath });\r\n\r\n    // Make a specific change\r\n    writeFileSync(\r\n      join(testRepoPath, \"file1.txt\"),\r\n      \"Line 1\\nStable change\\nLine 3\\nLine 4\\nLine 5\\n\"\r\n    );\r\n\r\n    const diff1 = execSync(\"git diff HEAD\", { cwd: testRepoPath, encoding: \"utf-8\" });\r\n    const hunks1 = extractAllHunks(parseDiff(diff1));\r\n    const id1 = hunks1[0]?.id;\r\n\r\n    // Reset and make the SAME change again\r\n    execSync(\"git reset --hard HEAD\", { cwd: testRepoPath });\r\n    writeFileSync(\r\n      join(testRepoPath, \"file1.txt\"),\r\n      \"Line 1\\nStable change\\nLine 3\\nLine 4\\nLine 5\\n\"\r\n    );\r\n\r\n    const diff2 = execSync(\"git diff HEAD\", { cwd: testRepoPath, encoding: \"utf-8\" });\r\n    const hunks2 = extractAllHunks(parseDiff(diff2));\r\n    const id2 = hunks2[0]?.id;\r\n\r\n    expect(id1).toBeDefined();\r\n    expect(id2).toBeDefined();\r\n    expect(id1).toBe(id2);\r\n  });\r\n\r\n  it(\"should handle large diffs with many hunks\", () => {\r\n    // Reset\r\n    execSync(\"git reset --hard HEAD\", { cwd: testRepoPath });\r\n\r\n    // Create a file with many lines\r\n    const lines = Array.from({ length: 100 }, (_, i) => `Line ${i + 1}`);\r\n    writeFileSync(join(testRepoPath, \"large.txt\"), lines.join(\"\\n\") + \"\\n\");\r\n    execSync(\"git add . && git commit -m 'Add large file'\", { cwd: testRepoPath });\r\n\r\n    // Modify multiple sections\r\n    const modifiedLines = lines.map((line, i) => {\r\n      if (i % 20 === 0) return `Modified ${line}`;\r\n      return line;\r\n    });\r\n    writeFileSync(join(testRepoPath, \"large.txt\"), modifiedLines.join(\"\\n\") + \"\\n\");\r\n\r\n    const diff = execSync(\"git diff HEAD\", { cwd: testRepoPath, encoding: \"utf-8\" });\r\n    const fileDiffs = parseDiff(diff);\r\n\r\n    expect(fileDiffs.length).toBe(1);\r\n    expect(fileDiffs[0].hunks.length).toBeGreaterThan(1);\r\n\r\n    const allHunks = extractAllHunks(fileDiffs);\r\n    expect(allHunks.length).toBeGreaterThan(1);\r\n\r\n    // All hunks should have valid IDs\r\n    expect(allHunks.every((h) => h.id && h.id.length > 0)).toBe(true);\r\n  });\r\n\r\n  it(\"should handle pure file rename (no content changes)\", () => {\r\n    // Reset\r\n    execSync(\"git reset --hard HEAD\", { cwd: testRepoPath });\r\n\r\n    // Rename a file with git mv (preserves history)\r\n    execSync(\"git mv file1.txt file1-renamed.txt\", { cwd: testRepoPath });\r\n\r\n    // Use -M flag to detect renames (though pure renames are detected by default)\r\n    const diff = execSync(\"git diff --cached -M\", { cwd: testRepoPath, encoding: \"utf-8\" });\r\n    const fileDiffs = parseDiff(diff);\r\n\r\n    // A pure rename should be detected\r\n    expect(fileDiffs.length).toBe(1);\r\n    expect(fileDiffs[0].filePath).toBe(\"file1-renamed.txt\");\r\n    expect(fileDiffs[0].oldPath).toBe(\"file1.txt\");\r\n    expect(fileDiffs[0].changeType).toBe(\"renamed\");\r\n\r\n    const allHunks = extractAllHunks(fileDiffs);\r\n\r\n    // Pure renames with no content changes should have NO hunks\r\n    // because git shows \"similarity index 100%\" with no diff content\r\n    expect(allHunks.length).toBe(0);\r\n  });\r\n\r\n  it(\"should handle file rename with content changes\", () => {\r\n    // Reset\r\n    execSync(\"git reset --hard HEAD\", { cwd: testRepoPath });\r\n\r\n    // Create a larger file so a small change maintains high similarity\r\n    writeFileSync(\r\n      join(testRepoPath, \"large-file.js\"),\r\n      `// Header comment\r\nfunction hello() {\r\n  console.log(\"Hello\");\r\n}\r\n\r\nfunction goodbye() {\r\n  console.log(\"Goodbye\");\r\n}\r\n\r\nfunction greet(name) {\r\n  console.log(\\`Hello \\${name}\\`);\r\n}\r\n\r\n// Footer comment\r\n`\r\n    );\r\n    execSync(\"git add . && git commit -m 'Add large file'\", { cwd: testRepoPath });\r\n\r\n    // Rename and make a small modification (maintains >50% similarity)\r\n    execSync(\"git mv large-file.js renamed-file.js\", { cwd: testRepoPath });\r\n    writeFileSync(\r\n      join(testRepoPath, \"renamed-file.js\"),\r\n      `// Header comment\r\nfunction hello() {\r\n  console.log(\"Hello World\"); // MODIFIED\r\n}\r\n\r\nfunction goodbye() {\r\n  console.log(\"Goodbye\");\r\n}\r\n\r\nfunction greet(name) {\r\n  console.log(\\`Hello \\${name}\\`);\r\n}\r\n\r\n// Footer comment\r\n`\r\n    );\r\n    execSync(\"git add renamed-file.js\", { cwd: testRepoPath });\r\n\r\n    // Use -M flag to detect renames\r\n    const diff = execSync(\"git diff --cached -M\", { cwd: testRepoPath, encoding: \"utf-8\" });\r\n    const fileDiffs = parseDiff(diff);\r\n\r\n    expect(fileDiffs.length).toBe(1);\r\n    expect(fileDiffs[0].filePath).toBe(\"renamed-file.js\");\r\n    expect(fileDiffs[0].oldPath).toBe(\"large-file.js\");\r\n    expect(fileDiffs[0].changeType).toBe(\"renamed\");\r\n\r\n    const allHunks = extractAllHunks(fileDiffs);\r\n    expect(allHunks.length).toBeGreaterThan(0);\r\n\r\n    // Hunks should show the content changes\r\n    expect(allHunks[0].changeType).toBe(\"renamed\");\r\n    expect(allHunks[0].oldPath).toBe(\"large-file.js\");\r\n    expect(allHunks[0].content.includes(\"World\")).toBe(true);\r\n  });\r\n\r\n  it(\"should handle renamed directory with files\", () => {\r\n    // Reset and setup\r\n    execSync(\"git reset --hard HEAD\", { cwd: testRepoPath });\r\n\r\n    // Create a directory structure\r\n    execSync(\"mkdir -p old-dir\", { cwd: testRepoPath });\r\n    writeFileSync(join(testRepoPath, \"old-dir\", \"nested1.txt\"), \"Nested file 1\\n\");\r\n    writeFileSync(join(testRepoPath, \"old-dir\", \"nested2.txt\"), \"Nested file 2\\n\");\r\n    execSync(\"git add . && git commit -m 'Add nested files'\", { cwd: testRepoPath });\r\n\r\n    // Rename the directory\r\n    execSync(\"git mv old-dir new-dir\", { cwd: testRepoPath });\r\n\r\n    // Use -M flag to detect renames\r\n    const diff = execSync(\"git diff --cached -M\", { cwd: testRepoPath, encoding: \"utf-8\" });\r\n    const fileDiffs = parseDiff(diff);\r\n\r\n    // Should detect renames for all files in the directory\r\n    expect(fileDiffs.length).toBeGreaterThanOrEqual(2);\r\n\r\n    const nested1 = fileDiffs.find((f) => f.filePath === \"new-dir/nested1.txt\");\r\n    const nested2 = fileDiffs.find((f) => f.filePath === \"new-dir/nested2.txt\");\r\n\r\n    expect(nested1).toBeDefined();\r\n    expect(nested2).toBeDefined();\r\n\r\n    if (nested1) {\r\n      expect(nested1.changeType).toBe(\"renamed\");\r\n      expect(nested1.oldPath).toBe(\"old-dir/nested1.txt\");\r\n    }\r\n\r\n    if (nested2) {\r\n      expect(nested2.changeType).toBe(\"renamed\");\r\n      expect(nested2.oldPath).toBe(\"old-dir/nested2.txt\");\r\n    }\r\n\r\n    const allHunks = extractAllHunks(fileDiffs);\r\n\r\n    // Pure directory renames should have NO hunks (files are identical)\r\n    expect(allHunks.length).toBe(0);\r\n  });\r\n\r\n  it(\"should show unified diff when includeUncommitted is true\", () => {\r\n    // Verify includeUncommitted produces single unified diff (not separate committed + uncommitted)\r\n    execSync(\"git reset --hard HEAD\", { cwd: testRepoPath });\r\n\r\n    const baseBranch = execSync(\"git rev-parse --abbrev-ref HEAD\", {\r\n      cwd: testRepoPath,\r\n      encoding: \"utf-8\",\r\n    }).trim();\r\n\r\n    execSync(\"git checkout -b unified-test\", { cwd: testRepoPath });\r\n\r\n    // Commit a change, then make uncommitted change\r\n    writeFileSync(join(testRepoPath, \"test-file.txt\"), \"Line 1\\nLine 2\\nLine 3\\n\");\r\n    execSync(\"git add test-file.txt && git commit -m 'Add test file'\", { cwd: testRepoPath });\r\n    writeFileSync(join(testRepoPath, \"test-file.txt\"), \"Line 1\\nLine 2\\nLine 3 modified\\nLine 4\\n\");\r\n\r\n    const gitCommand = buildGitDiffCommand(baseBranch, true, \"\", \"diff\");\r\n    const diffOutput = execSync(gitCommand, { cwd: testRepoPath, encoding: \"utf-8\" });\r\n    const fileDiffs = parseDiff(diffOutput);\r\n\r\n    // Single FileDiff with unified changes (no duplicates)\r\n    expect(fileDiffs.length).toBe(1);\r\n    expect(fileDiffs[0].filePath).toBe(\"test-file.txt\");\r\n\r\n    const allHunks = extractAllHunks(fileDiffs);\r\n    const allContent = allHunks.map((h) => h.content).join(\"\\n\");\r\n    expect(allContent.includes(\"Line 3 modified\") || allContent.includes(\"Line 4\")).toBe(true);\r\n\r\n    execSync(\"git reset --hard HEAD && git checkout -\", { cwd: testRepoPath });\r\n  });\r\n\r\n  it(\"should exclude uncommitted changes when includeUncommitted is false\", () => {\r\n    // Verify includeUncommitted=false uses three-dot (committed only)\r\n    execSync(\"git reset --hard HEAD\", { cwd: testRepoPath });\r\n\r\n    const baseBranch = execSync(\"git rev-parse --abbrev-ref HEAD\", {\r\n      cwd: testRepoPath,\r\n      encoding: \"utf-8\",\r\n    }).trim();\r\n\r\n    execSync(\"git checkout -b committed-only-test\", { cwd: testRepoPath });\r\n\r\n    // Commit a change\r\n    writeFileSync(join(testRepoPath, \"committed-file.txt\"), \"Line 1\\nLine 2\\n\");\r\n    execSync(\"git add committed-file.txt && git commit -m 'Add committed file'\", {\r\n      cwd: testRepoPath,\r\n    });\r\n\r\n    // Make uncommitted change (should NOT appear in diff)\r\n    writeFileSync(join(testRepoPath, \"committed-file.txt\"), \"Line 1\\nLine 2\\nUncommitted line\\n\");\r\n\r\n    const gitCommand = buildGitDiffCommand(baseBranch, false, \"\", \"diff\");\r\n    const diffOutput = execSync(gitCommand, { cwd: testRepoPath, encoding: \"utf-8\" });\r\n    const fileDiffs = parseDiff(diffOutput);\r\n\r\n    // Should get FileDiff showing only committed changes\r\n    expect(fileDiffs.length).toBe(1);\r\n    expect(fileDiffs[0].filePath).toBe(\"committed-file.txt\");\r\n\r\n    const allHunks = extractAllHunks(fileDiffs);\r\n    const allContent = allHunks.map((h) => h.content).join(\"\\n\");\r\n\r\n    // Should NOT include uncommitted \"Uncommitted line\"\r\n    expect(allContent.includes(\"Uncommitted line\")).toBe(false);\r\n    // Should include committed content\r\n    expect(allContent.includes(\"Line 1\") || allContent.includes(\"Line 2\")).toBe(true);\r\n\r\n    execSync(\"git reset --hard HEAD && git checkout -\", { cwd: testRepoPath });\r\n  });\r\n\r\n  it(\"should handle staged + uncommitted when diffBase is --staged\", () => {\r\n    // Verify --staged with includeUncommitted produces TWO diffs (staged + unstaged)\r\n    execSync(\"git reset --hard HEAD\", { cwd: testRepoPath });\r\n\r\n    writeFileSync(join(testRepoPath, \"staged-test.txt\"), \"Line 1\\nLine 2\\nLine 3\\n\");\r\n    execSync(\"git add staged-test.txt\", { cwd: testRepoPath });\r\n\r\n    writeFileSync(join(testRepoPath, \"staged-test.txt\"), \"Line 1\\nLine 2 staged\\nLine 3\\n\");\r\n    execSync(\"git add staged-test.txt\", { cwd: testRepoPath });\r\n\r\n    writeFileSync(\r\n      join(testRepoPath, \"staged-test.txt\"),\r\n      \"Line 1\\nLine 2 staged\\nLine 3 unstaged\\n\"\r\n    );\r\n\r\n    const gitCommand = buildGitDiffCommand(\"--staged\", true, \"\", \"diff\");\r\n    const diffOutput = execSync(gitCommand, { cwd: testRepoPath, encoding: \"utf-8\" });\r\n    const fileDiffs = parseDiff(diffOutput);\r\n\r\n    // Two FileDiff entries (staged + unstaged)\r\n    expect(fileDiffs.length).toBe(2);\r\n    expect(fileDiffs.every((f) => f.filePath === \"staged-test.txt\")).toBe(true);\r\n\r\n    const allHunks = extractAllHunks(fileDiffs);\r\n    expect(allHunks.length).toBe(2);\r\n\r\n    const allContent = allHunks.map((h) => h.content).join(\"\\n\");\r\n    expect(allContent.includes(\"staged\")).toBe(true);\r\n    expect(allContent.includes(\"unstaged\")).toBe(true);\r\n  });\r\n\r\n  it(\"should not show inverse deltas when branch is behind base ref\", () => {\r\n    // Scenario: Branch A is 3 commits behind origin/main\r\n    //\r\n    // Git history:\r\n    //   test-main:  Initial---Y---Z---W (3 commits ahead)\r\n    //                 \\\r\n    //   feature:       Feature (committed) + uncommitted changes\r\n    //\r\n    // Problem: Old behavior with includeUncommitted=true used two-dot diff,\r\n    // comparing W to working directory, showing Y, Z, W as inverse deltas.\r\n    //\r\n    // Expected: Should only show feature branch changes (committed + uncommitted),\r\n    // NOT inverse deltas from Y, Z, W commits that landed on test-main.\r\n    execSync(\"git reset --hard HEAD\", { cwd: testRepoPath });\r\n\r\n    // Create a \"main\" branch and add 3 commits\r\n    execSync(\"git checkout -b test-main\", { cwd: testRepoPath });\r\n    writeFileSync(join(testRepoPath, \"main-file.txt\"), \"Initial content\\n\");\r\n    execSync(\"git add main-file.txt && git commit -m 'Initial on main'\", { cwd: testRepoPath });\r\n\r\n    // Branch off from here (this is the merge-base)\r\n    execSync(\"git checkout -b feature-branch\", { cwd: testRepoPath });\r\n\r\n    // Add commits on feature branch\r\n    writeFileSync(join(testRepoPath, \"feature-file.txt\"), \"Feature content\\n\");\r\n    execSync(\"git add feature-file.txt && git commit -m 'Add feature file'\", {\r\n      cwd: testRepoPath,\r\n    });\r\n\r\n    // Simulate origin/main moving forward (3 commits ahead)\r\n    execSync(\"git checkout test-main\", { cwd: testRepoPath });\r\n    writeFileSync(join(testRepoPath, \"main-file.txt\"), \"Initial content\\nCommit Y\\n\");\r\n    execSync(\"git add main-file.txt && git commit -m 'Commit Y on main'\", {\r\n      cwd: testRepoPath,\r\n    });\r\n\r\n    writeFileSync(join(testRepoPath, \"main-file.txt\"), \"Initial content\\nCommit Y\\nCommit Z\\n\");\r\n    execSync(\"git add main-file.txt && git commit -m 'Commit Z on main'\", {\r\n      cwd: testRepoPath,\r\n    });\r\n\r\n    writeFileSync(\r\n      join(testRepoPath, \"main-file.txt\"),\r\n      \"Initial content\\nCommit Y\\nCommit Z\\nCommit W\\n\"\r\n    );\r\n    execSync(\"git add main-file.txt && git commit -m 'Commit W on main'\", {\r\n      cwd: testRepoPath,\r\n    });\r\n\r\n    // Back to feature branch\r\n    execSync(\"git checkout feature-branch\", { cwd: testRepoPath });\r\n\r\n    // Add uncommitted changes to feature branch\r\n    writeFileSync(join(testRepoPath, \"feature-file.txt\"), \"Feature content\\nUncommitted change\\n\");\r\n\r\n    // Test 1: includeUncommitted=false (committed only, uses three-dot)\r\n    const gitCommandCommittedOnly = buildGitDiffCommand(\"test-main\", false, \"\", \"diff\");\r\n    const diffOutputCommittedOnly = execSync(gitCommandCommittedOnly, {\r\n      cwd: testRepoPath,\r\n      encoding: \"utf-8\",\r\n    });\r\n    const fileDiffsCommittedOnly = parseDiff(diffOutputCommittedOnly);\r\n\r\n    const featureFileCommittedOnly = fileDiffsCommittedOnly.find(\r\n      (f) => f.filePath === \"feature-file.txt\"\r\n    );\r\n    const mainFileCommittedOnly = fileDiffsCommittedOnly.find(\r\n      (f) => f.filePath === \"main-file.txt\"\r\n    );\r\n\r\n    expect(featureFileCommittedOnly).toBeDefined();\r\n    expect(mainFileCommittedOnly).toBeUndefined(); // No inverse deltas\r\n\r\n    const hunksCommittedOnly = extractAllHunks(fileDiffsCommittedOnly);\r\n    const contentCommittedOnly = hunksCommittedOnly.map((h) => h.content).join(\"\\n\");\r\n\r\n    // Should show committed feature work\r\n    expect(contentCommittedOnly.includes(\"Feature content\")).toBe(true);\r\n    // Should NOT show uncommitted changes (key difference from includeUncommitted=true)\r\n    expect(contentCommittedOnly.includes(\"Uncommitted change\")).toBe(false);\r\n    // Should NOT show inverse deltas from main\r\n    expect(contentCommittedOnly.includes(\"Commit Y\")).toBe(false);\r\n    expect(contentCommittedOnly.includes(\"Commit Z\")).toBe(false);\r\n    expect(contentCommittedOnly.includes(\"Commit W\")).toBe(false);\r\n\r\n    // Test 2: includeUncommitted=true (committed + uncommitted, uses merge-base)\r\n    const gitCommand = buildGitDiffCommand(\"test-main\", true, \"\", \"diff\");\r\n    const diffOutput = execSync(gitCommand, { cwd: testRepoPath, encoding: \"utf-8\" });\r\n    const fileDiffs = parseDiff(diffOutput);\r\n\r\n    // Should show only feature-file.txt (the file we added/modified)\r\n    // Should NOT show main-file.txt as deletions (inverse deltas)\r\n    const featureFile = fileDiffs.find((f) => f.filePath === \"feature-file.txt\");\r\n    const mainFile = fileDiffs.find((f) => f.filePath === \"main-file.txt\");\r\n\r\n    expect(featureFile).toBeDefined();\r\n    expect(mainFile).toBeUndefined(); // Should NOT appear\r\n\r\n    // Verify we see both committed and uncommitted changes in feature-file.txt\r\n    const allHunks = extractAllHunks(fileDiffs);\r\n    const allContent = allHunks.map((h) => h.content).join(\"\\n\");\r\n\r\n    expect(allContent.includes(\"Feature content\")).toBe(true);\r\n    expect(allContent.includes(\"Uncommitted change\")).toBe(true);\r\n\r\n    // Critically: should NOT show any deletions from Commit Y, Z, W\r\n    expect(allContent.includes(\"Commit Y\")).toBe(false);\r\n    expect(allContent.includes(\"Commit Z\")).toBe(false);\r\n    expect(allContent.includes(\"Commit W\")).toBe(false);\r\n\r\n    // Cleanup\r\n    execSync(\"git checkout test-main --force\", { cwd: testRepoPath });\r\n    execSync(\"git branch -D feature-branch\", { cwd: testRepoPath });\r\n  });\r\n});\r\n"]}