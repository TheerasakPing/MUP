{"version":3,"file":"parseGitLog.js","sourceRoot":"","sources":["../../../../src/common/utils/git/parseGitLog.ts"],"names":[],"mappings":";;;AAgCA;;;;;;;;;;;;;;;;;;GAkBG;AACH,4BACE,MAAc,EACd,OAA4B,EACP;IACrB,IAAI,CAAC,MAAM,EAAE,IAAI,EAAE,EAAE,CAAC;QACpB,OAAO,EAAE,OAAO,EAAE,EAAE,EAAE,OAAO,EAAE,EAAE,EAAE,CAAC;IACtC,CAAC;IAED,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;IACxC,MAAM,OAAO,GAAsB,EAAE,CAAC;IACtC,MAAM,OAAO,GAAgB,EAAE,CAAC;IAChC,IAAI,eAAe,GAAG,KAAK,CAAC;IAE5B,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE,CAAC;QACzB,iDAAiD;QACjD,IAAI,IAAI,CAAC,IAAI,EAAE,KAAK,IAAI,IAAI,IAAI,CAAC,IAAI,EAAE,KAAK,KAAK,EAAE,CAAC;YAClD,eAAe,GAAG,IAAI,CAAC;YACvB,SAAS;QACX,CAAC;QAED,IAAI,CAAC,eAAe,EAAE,CAAC;YACrB,wDAAwD;YACxD,kFAAkF;YAClF,MAAM,WAAW,GAAG,2BAA2B,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC3D,IAAI,WAAW,EAAE,CAAC;gBAChB,MAAM,CAAC,EAAE,aAAa,EAAE,UAAU,CAAC,GAAG,WAAW,CAAC;gBAClD,MAAM,WAAW,GAAG,aAAa,CAAC,MAAM,CAAC;gBACzC,OAAO,CAAC,IAAI,CAAC;oBACX,MAAM,EAAE,UAAU;oBAClB,WAAW;iBACZ,CAAC,CAAC;YACL,CAAC;YACD,SAAS;QACX,CAAC;QAED,yCAAyC;QACzC,0FAA0F;QAC1F,gEAAgE;QAChE,MAAM,WAAW,GAAG,OAAO,CAAC,MAAM,CAAC;QACnC,IAAI,IAAI,CAAC,MAAM,GAAG,WAAW,EAAE,CAAC;YAC9B,SAAS,CAAC,oCAAoC;QAChD,CAAC;QAED,MAAM,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,WAAW,CAAC,CAAC;QAClD,MAAM,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,IAAI,EAAE,CAAC;QAEhD,iCAAiC;QACjC,MAAM,KAAK,GAAG,0BAA0B,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAEpD,IAAI,CAAC,KAAK,EAAE,CAAC;YACX,SAAS,CAAC,8BAA8B;QAC1C,CAAC;QAED,MAAM,CAAC,EAAE,IAAI,EAAE,OAAO,CAAC,GAAG,KAAK,CAAC;QAEhC,OAAO,CAAC,IAAI,CAAC;YACX,UAAU;YACV,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE;YACjB,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE;YACpC,OAAO,EAAE,OAAO,CAAC,IAAI,EAAE;SACxB,CAAC,CAAC;IACL,CAAC;IAED,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,CAAC;AAAA,CAC7B","sourcesContent":["/**\r\n * Represents a branch header from git show-branch\r\n */\r\nexport interface GitBranchHeader {\r\n  /** Branch name (e.g., \"HEAD\", \"origin/main\") */\r\n  branch: string;\r\n  /** Column index (0-based) */\r\n  columnIndex: number;\r\n}\r\n\r\n/**\r\n * Represents a single commit in the git log\r\n */\r\nexport interface GitCommit {\r\n  /** Branch indicators from git show-branch (e.g., \"+ +\", \"+++\", \"- -\") */\r\n  indicators: string;\r\n  /** Short commit hash */\r\n  hash: string;\r\n  /** Formatted date string */\r\n  date: string;\r\n  /** Commit subject/message */\r\n  subject: string;\r\n}\r\n\r\n/**\r\n * Result of parsing git show-branch output\r\n */\r\nexport interface GitShowBranchResult {\r\n  headers: GitBranchHeader[];\r\n  commits: GitCommit[];\r\n}\r\n\r\n/**\r\n * Parses git show-branch output.\r\n * Expected format:\r\n *   Header section:\r\n *     [!*] [branch-name] commit-subject\r\n *     ...\r\n *   ---\r\n *   Commit section:\r\n *     <indicators> [<hash>] <subject>\r\n *     ...\r\n *\r\n * Example:\r\n *   ! [HEAD] Latest commit on HEAD\r\n *    ! [origin/main] Latest commit on origin/main\r\n *   ---\r\n *   + + [042118f] Clear providerMetadata from tool messages too\r\n *\r\n * Note: Dates are fetched separately and merged in via hash lookup.\r\n */\r\nexport function parseGitShowBranch(\r\n  output: string,\r\n  dateMap: Map<string, string>\r\n): GitShowBranchResult {\r\n  if (!output?.trim()) {\r\n    return { headers: [], commits: [] };\r\n  }\r\n\r\n  const lines = output.trim().split(\"\\n\");\r\n  const headers: GitBranchHeader[] = [];\r\n  const commits: GitCommit[] = [];\r\n  let inCommitSection = false;\r\n\r\n  for (const line of lines) {\r\n    // Skip until we find the separator \"--\" or \"---\"\r\n    if (line.trim() === \"--\" || line.trim() === \"---\") {\r\n      inCommitSection = true;\r\n      continue;\r\n    }\r\n\r\n    if (!inCommitSection) {\r\n      // Parse header lines: [!*] [branch-name] commit-subject\r\n      // The column index is determined by the position of the first non-space character\r\n      const headerMatch = /^(\\s*)[!*]\\s+\\[([^\\]]+)\\]/.exec(line);\r\n      if (headerMatch) {\r\n        const [, leadingSpaces, branchName] = headerMatch;\r\n        const columnIndex = leadingSpaces.length;\r\n        headers.push({\r\n          branch: branchName,\r\n          columnIndex,\r\n        });\r\n      }\r\n      continue;\r\n    }\r\n\r\n    // Match: <indicators> [<hash>] <subject>\r\n    // Indicators are exactly N characters (one per branch), followed by space(s), then [hash]\r\n    // Extract exactly N characters to preserve position information\r\n    const numBranches = headers.length;\r\n    if (line.length < numBranches) {\r\n      continue; // Line too short to have indicators\r\n    }\r\n\r\n    const indicators = line.substring(0, numBranches);\r\n    const rest = line.substring(numBranches).trim();\r\n\r\n    // Parse the rest: [hash] subject\r\n    const match = /^\\[([a-f0-9]+)\\]\\s+(.+)$/.exec(rest);\r\n\r\n    if (!match) {\r\n      continue; // Skip lines that don't match\r\n    }\r\n\r\n    const [, hash, subject] = match;\r\n\r\n    commits.push({\r\n      indicators,\r\n      hash: hash.trim(),\r\n      date: dateMap.get(hash.trim()) ?? \"\",\r\n      subject: subject.trim(),\r\n    });\r\n  }\r\n\r\n  return { headers, commits };\r\n}\r\n"]}