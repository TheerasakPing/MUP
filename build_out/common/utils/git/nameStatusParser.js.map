{"version":3,"file":"nameStatusParser.js","sourceRoot":"","sources":["../../../../src/common/utils/git/nameStatusParser.ts"],"names":[],"mappings":";AAAA;;;;;;;;;GASG;;;AAUH,MAAM,sBAAsB,GAAmC;IAC7D,OAAO,EAAE,CAAC;IACV,KAAK,EAAE,CAAC;IACR,OAAO,EAAE,CAAC;IACV,QAAQ,EAAE,CAAC;CACZ,CAAC;AAEF,SAAS,gBAAgB,CAAC,UAAkB,EAAkB;IAC5D,IAAI,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC;QAAE,OAAO,OAAO,CAAC;IAC/C,IAAI,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC;QAAE,OAAO,SAAS,CAAC;IACjD,IAAI,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC;QAAE,OAAO,SAAS,CAAC;IACjD,0CAA0C;IAC1C,IAAI,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC;QAAE,OAAO,OAAO,CAAC;IAC/C,OAAO,UAAU,CAAC;AAAA,CACnB;AAED;;;;;;GAMG;AACH,yBAAgC,MAAc,EAAqB;IACjE,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;IACxD,MAAM,MAAM,GAAG,IAAI,GAAG,EAA2B,CAAC;IAElD,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE,CAAC;QACzB,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QAC/B,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC;YAAE,SAAS;QAE/B,MAAM,UAAU,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;QAC5B,MAAM,UAAU,GAAG,gBAAgB,CAAC,UAAU,CAAC,CAAC;QAEhD,MAAM,MAAM,GAAG,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QAE1C,MAAM,KAAK,GACT,UAAU,KAAK,SAAS,IAAI,MAAM;YAChC,CAAC,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC;gBACjB,CAAC,CAAC,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,UAAU,EAAE;gBACvD,CAAC,CAAC,IAAI;YACR,CAAC,CAAC,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,UAAU,EAAE,CAAC;QAEzC,IAAI,CAAC,KAAK;YAAE,SAAS;QAErB,MAAM,QAAQ,GAAG,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QAC5C,IAAI,CAAC,QAAQ,EAAE,CAAC;YACd,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;YAClC,SAAS;QACX,CAAC;QAED,MAAM,kBAAkB,GAAG,sBAAsB,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QACvE,MAAM,cAAc,GAAG,sBAAsB,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;QAChE,IAAI,cAAc,GAAG,kBAAkB,EAAE,CAAC;YACxC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;YAClC,SAAS;QACX,CAAC;QAED,wFAAwF;QACxF,IAAI,QAAQ,CAAC,UAAU,KAAK,KAAK,CAAC,UAAU,IAAI,CAAC,QAAQ,CAAC,OAAO,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC;YACnF,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,GAAG,QAAQ,EAAE,OAAO,EAAE,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;QACtE,CAAC;IACH,CAAC;IAED,OAAO,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC;AAAA,CAC7B","sourcesContent":["/**\n * Parse `git diff --name-status` output.\n *\n * Format examples:\n *   M\\tpath/to/file.ts\n *   A\\tpath/to/new.ts\n *   D\\tpath/to/deleted.ts\n *   R100\\told/path.ts\\tnew/path.ts\n *   C100\\told/path.ts\\tnew/path.ts\n */\n\nimport type { FileChangeType } from \"@/common/types/review\";\n\nexport interface NameStatusEntry {\n  filePath: string;\n  changeType: FileChangeType;\n  oldPath?: string;\n}\n\nconst CHANGE_TYPE_PRECEDENCE: Record<FileChangeType, number> = {\n  deleted: 4,\n  added: 3,\n  renamed: 2,\n  modified: 1,\n};\n\nfunction toFileChangeType(statusCode: string): FileChangeType {\n  if (statusCode.startsWith(\"A\")) return \"added\";\n  if (statusCode.startsWith(\"D\")) return \"deleted\";\n  if (statusCode.startsWith(\"R\")) return \"renamed\";\n  // Treat copies as adds (new path exists).\n  if (statusCode.startsWith(\"C\")) return \"added\";\n  return \"modified\";\n}\n\n/**\n * Returns a de-duplicated list of file change entries.\n *\n * `git diff --name-status` can contain duplicates when commands are concatenated\n * (e.g. staged + uncommitted). We keep the \"strongest\" changeType by precedence:\n * `deleted > added > renamed > modified`.\n */\nexport function parseNameStatus(output: string): NameStatusEntry[] {\n  const lines = output.trim().split(\"\\n\").filter(Boolean);\n  const byPath = new Map<string, NameStatusEntry>();\n\n  for (const line of lines) {\n    const parts = line.split(\"\\t\");\n    if (parts.length < 2) continue;\n\n    const statusCode = parts[0];\n    const changeType = toFileChangeType(statusCode);\n\n    const isCopy = statusCode.startsWith(\"C\");\n\n    const entry: NameStatusEntry | null =\n      changeType === \"renamed\" || isCopy\n        ? parts.length >= 3\n          ? { filePath: parts[2], oldPath: parts[1], changeType }\n          : null\n        : { filePath: parts[1], changeType };\n\n    if (!entry) continue;\n\n    const existing = byPath.get(entry.filePath);\n    if (!existing) {\n      byPath.set(entry.filePath, entry);\n      continue;\n    }\n\n    const existingPrecedence = CHANGE_TYPE_PRECEDENCE[existing.changeType];\n    const nextPrecedence = CHANGE_TYPE_PRECEDENCE[entry.changeType];\n    if (nextPrecedence > existingPrecedence) {\n      byPath.set(entry.filePath, entry);\n      continue;\n    }\n\n    // Preserve oldPath if we already have the strongest entry but are missing the old path.\n    if (existing.changeType === entry.changeType && !existing.oldPath && entry.oldPath) {\n      byPath.set(entry.filePath, { ...existing, oldPath: entry.oldPath });\n    }\n  }\n\n  return [...byPath.values()];\n}\n"]}