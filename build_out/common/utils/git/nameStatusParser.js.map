{"version":3,"file":"nameStatusParser.js","sourceRoot":"","sources":["../../../../src/common/utils/git/nameStatusParser.ts"],"names":[],"mappings":";AAAA;;;;;;;;;GASG;;;AAUH,MAAM,sBAAsB,GAAmC;IAC7D,OAAO,EAAE,CAAC;IACV,KAAK,EAAE,CAAC;IACR,OAAO,EAAE,CAAC;IACV,QAAQ,EAAE,CAAC;CACZ,CAAC;AAEF,SAAS,gBAAgB,CAAC,UAAkB,EAAkB;IAC5D,IAAI,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC;QAAE,OAAO,OAAO,CAAC;IAC/C,IAAI,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC;QAAE,OAAO,SAAS,CAAC;IACjD,IAAI,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC;QAAE,OAAO,SAAS,CAAC;IACjD,0CAA0C;IAC1C,IAAI,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC;QAAE,OAAO,OAAO,CAAC;IAC/C,OAAO,UAAU,CAAC;AAAA,CACnB;AAED;;;;;;GAMG;AACH,yBAAgC,MAAc,EAAqB;IACjE,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;IACxD,MAAM,MAAM,GAAG,IAAI,GAAG,EAA2B,CAAC;IAElD,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE,CAAC;QACzB,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QAC/B,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC;YAAE,SAAS;QAE/B,MAAM,UAAU,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;QAC5B,MAAM,UAAU,GAAG,gBAAgB,CAAC,UAAU,CAAC,CAAC;QAEhD,MAAM,MAAM,GAAG,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QAE1C,MAAM,KAAK,GACT,UAAU,KAAK,SAAS,IAAI,MAAM;YAChC,CAAC,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC;gBACjB,CAAC,CAAC,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,UAAU,EAAE;gBACvD,CAAC,CAAC,IAAI;YACR,CAAC,CAAC,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,UAAU,EAAE,CAAC;QAEzC,IAAI,CAAC,KAAK;YAAE,SAAS;QAErB,MAAM,QAAQ,GAAG,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QAC5C,IAAI,CAAC,QAAQ,EAAE,CAAC;YACd,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;YAClC,SAAS;QACX,CAAC;QAED,MAAM,kBAAkB,GAAG,sBAAsB,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QACvE,MAAM,cAAc,GAAG,sBAAsB,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;QAChE,IAAI,cAAc,GAAG,kBAAkB,EAAE,CAAC;YACxC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;YAClC,SAAS;QACX,CAAC;QAED,wFAAwF;QACxF,IAAI,QAAQ,CAAC,UAAU,KAAK,KAAK,CAAC,UAAU,IAAI,CAAC,QAAQ,CAAC,OAAO,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC;YACnF,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,GAAG,QAAQ,EAAE,OAAO,EAAE,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;QACtE,CAAC;IACH,CAAC;IAED,OAAO,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC;AAAA,CAC7B","sourcesContent":["/**\r\n * Parse `git diff --name-status` output.\r\n *\r\n * Format examples:\r\n *   M\\tpath/to/file.ts\r\n *   A\\tpath/to/new.ts\r\n *   D\\tpath/to/deleted.ts\r\n *   R100\\told/path.ts\\tnew/path.ts\r\n *   C100\\told/path.ts\\tnew/path.ts\r\n */\r\n\r\nimport type { FileChangeType } from \"@/common/types/review\";\r\n\r\nexport interface NameStatusEntry {\r\n  filePath: string;\r\n  changeType: FileChangeType;\r\n  oldPath?: string;\r\n}\r\n\r\nconst CHANGE_TYPE_PRECEDENCE: Record<FileChangeType, number> = {\r\n  deleted: 4,\r\n  added: 3,\r\n  renamed: 2,\r\n  modified: 1,\r\n};\r\n\r\nfunction toFileChangeType(statusCode: string): FileChangeType {\r\n  if (statusCode.startsWith(\"A\")) return \"added\";\r\n  if (statusCode.startsWith(\"D\")) return \"deleted\";\r\n  if (statusCode.startsWith(\"R\")) return \"renamed\";\r\n  // Treat copies as adds (new path exists).\r\n  if (statusCode.startsWith(\"C\")) return \"added\";\r\n  return \"modified\";\r\n}\r\n\r\n/**\r\n * Returns a de-duplicated list of file change entries.\r\n *\r\n * `git diff --name-status` can contain duplicates when commands are concatenated\r\n * (e.g. staged + uncommitted). We keep the \"strongest\" changeType by precedence:\r\n * `deleted > added > renamed > modified`.\r\n */\r\nexport function parseNameStatus(output: string): NameStatusEntry[] {\r\n  const lines = output.trim().split(\"\\n\").filter(Boolean);\r\n  const byPath = new Map<string, NameStatusEntry>();\r\n\r\n  for (const line of lines) {\r\n    const parts = line.split(\"\\t\");\r\n    if (parts.length < 2) continue;\r\n\r\n    const statusCode = parts[0];\r\n    const changeType = toFileChangeType(statusCode);\r\n\r\n    const isCopy = statusCode.startsWith(\"C\");\r\n\r\n    const entry: NameStatusEntry | null =\r\n      changeType === \"renamed\" || isCopy\r\n        ? parts.length >= 3\r\n          ? { filePath: parts[2], oldPath: parts[1], changeType }\r\n          : null\r\n        : { filePath: parts[1], changeType };\r\n\r\n    if (!entry) continue;\r\n\r\n    const existing = byPath.get(entry.filePath);\r\n    if (!existing) {\r\n      byPath.set(entry.filePath, entry);\r\n      continue;\r\n    }\r\n\r\n    const existingPrecedence = CHANGE_TYPE_PRECEDENCE[existing.changeType];\r\n    const nextPrecedence = CHANGE_TYPE_PRECEDENCE[entry.changeType];\r\n    if (nextPrecedence > existingPrecedence) {\r\n      byPath.set(entry.filePath, entry);\r\n      continue;\r\n    }\r\n\r\n    // Preserve oldPath if we already have the strongest entry but are missing the old path.\r\n    if (existing.changeType === entry.changeType && !existing.oldPath && entry.oldPath) {\r\n      byPath.set(entry.filePath, { ...existing, oldPath: entry.oldPath });\r\n    }\r\n  }\r\n\r\n  return [...byPath.values()];\r\n}\r\n"]}