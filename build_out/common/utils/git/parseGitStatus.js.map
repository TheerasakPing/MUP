{"version":3,"file":"parseGitStatus.js","sourceRoot":"","sources":["../../../../src/common/utils/git/parseGitStatus.ts"],"names":[],"mappings":";;;;AAEA;;;;;;;GAOG;AACH,yBAAgC,MAAc,EAAoB;IAChE,MAAM,OAAO,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC;IAE9B,IAAI,CAAC,OAAO,EAAE,CAAC;QACb,OAAO,IAAI,CAAC;IACd,CAAC;IAED,oDAAoD;IACpD,MAAM,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IAEnC,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;QACvB,OAAO,IAAI,CAAC;IACd,CAAC;IAED,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;IACrC,MAAM,MAAM,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;IAEtC,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC;QAClC,OAAO,IAAI,CAAC;IACd,CAAC;IAED,2EAA2E;IAC3E,OAAO;QACL,MAAM,EAAE,EAAE;QACV,KAAK;QACL,MAAM;QACN,KAAK,EAAE,KAAK;QACZ,iBAAiB,EAAE,CAAC;QACpB,iBAAiB,EAAE,CAAC;QACpB,iBAAiB,EAAE,CAAC;QACpB,iBAAiB,EAAE,CAAC;KACrB,CAAC;AAAA,CACH;AAED;;;;;;;;;;;;;;;;;;;;GAoBG;AACH,qCAA4C,MAAc,EAAoB;IAC5E,MAAM,OAAO,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC;IAE9B,IAAI,CAAC,OAAO,EAAE,CAAC;QACb,OAAO,IAAI,CAAC;IACd,CAAC;IAED,MAAM,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;IAClC,IAAI,eAAe,GAAG,KAAK,CAAC;IAC5B,IAAI,KAAK,GAAG,CAAC,CAAC;IACd,IAAI,MAAM,GAAG,CAAC,CAAC;IAEf,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE,CAAC;QACzB,iDAAiD;QACjD,IAAI,IAAI,CAAC,IAAI,EAAE,KAAK,IAAI,IAAI,IAAI,CAAC,IAAI,EAAE,KAAK,KAAK,EAAE,CAAC;YAClD,eAAe,GAAG,IAAI,CAAC;YACvB,SAAS;QACX,CAAC;QAED,IAAI,CAAC,eAAe,EAAE,CAAC;YACrB,SAAS,CAAC,oBAAoB;QAChC,CAAC;QAED,sDAAsD;QACtD,2EAA2E;QAC3E,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YACpB,SAAS;QACX,CAAC;QAED,8CAA8C;QAC9C,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;YAChC,SAAS;QACX,CAAC;QAED,2EAA2E;QAC3E,MAAM,aAAa,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QAC9B,MAAM,eAAe,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QAEhC,6CAA6C;QAC7C,IAAI,aAAa,KAAK,GAAG,IAAI,eAAe,KAAK,GAAG,EAAE,CAAC;YACrD,KAAK,EAAE,CAAC;QACV,CAAC;QACD,8CAA8C;aACzC,IAAI,aAAa,KAAK,GAAG,IAAI,eAAe,KAAK,GAAG,EAAE,CAAC;YAC1D,MAAM,EAAE,CAAC;QACX,CAAC;IACH,CAAC;IAED,2EAA2E;IAC3E,OAAO;QACL,MAAM,EAAE,EAAE;QACV,KAAK;QACL,MAAM;QACN,KAAK,EAAE,KAAK;QACZ,iBAAiB,EAAE,CAAC;QACpB,iBAAiB,EAAE,CAAC;QACpB,iBAAiB,EAAE,CAAC;QACpB,iBAAiB,EAAE,CAAC;KACrB,CAAC;AAAA,CACH","sourcesContent":["import type { GitStatus } from \"@/common/types/workspace\";\r\n\r\n/**\r\n * Parse the output of `git rev-list --left-right --count HEAD...origin/branch`\r\n *\r\n * Expected format: \"N\\tM\" where N is ahead count and M is behind count\r\n *\r\n * @param output - The raw output from git rev-list command\r\n * @returns GitStatus object with ahead/behind counts, or null if parsing fails\r\n */\r\nexport function parseGitRevList(output: string): GitStatus | null {\r\n  const trimmed = output.trim();\r\n\r\n  if (!trimmed) {\r\n    return null;\r\n  }\r\n\r\n  // Split by tab - expected format is \"ahead\\tbehind\"\r\n  const parts = trimmed.split(/\\s+/);\r\n\r\n  if (parts.length !== 2) {\r\n    return null;\r\n  }\r\n\r\n  const ahead = parseInt(parts[0], 10);\r\n  const behind = parseInt(parts[1], 10);\r\n\r\n  if (isNaN(ahead) || isNaN(behind)) {\r\n    return null;\r\n  }\r\n\r\n  // Note: dirty + line deltas + branch are computed separately in the caller\r\n  return {\r\n    branch: \"\",\r\n    ahead,\r\n    behind,\r\n    dirty: false,\r\n    outgoingAdditions: 0,\r\n    outgoingDeletions: 0,\r\n    incomingAdditions: 0,\r\n    incomingDeletions: 0,\r\n  };\r\n}\r\n\r\n/**\r\n * Parse the output of `git show-branch --sha1-name HEAD origin/branch` to calculate ahead/behind counts.\r\n *\r\n * This counts commits shown in the show-branch divergence section, which provides a more\r\n * meaningful representation of branch divergence than git rev-list.\r\n *\r\n * Expected format:\r\n *   ! [HEAD] commit message\r\n *    ! [origin/branch] commit message\r\n *   --\r\n *   -  [hash] commit in HEAD but not origin\r\n *   ++ [hash] commit in both\r\n *    + [hash] commit in origin but not HEAD\r\n *\r\n * Indicators:\r\n * - Column 0 (HEAD): non-space means commit is in HEAD, space means not in HEAD\r\n * - Column 1 (origin/branch): non-space means commit is in origin/branch, space means not in origin\r\n *\r\n * @param output - The raw output from git show-branch command\r\n * @returns GitStatus object with ahead/behind counts, or null if parsing fails\r\n */\r\nexport function parseGitShowBranchForStatus(output: string): GitStatus | null {\r\n  const trimmed = output.trim();\r\n\r\n  if (!trimmed) {\r\n    return null;\r\n  }\r\n\r\n  const lines = trimmed.split(\"\\n\");\r\n  let inCommitSection = false;\r\n  let ahead = 0;\r\n  let behind = 0;\r\n\r\n  for (const line of lines) {\r\n    // Skip until we find the separator \"--\" or \"---\"\r\n    if (line.trim() === \"--\" || line.trim() === \"---\") {\r\n      inCommitSection = true;\r\n      continue;\r\n    }\r\n\r\n    if (!inCommitSection) {\r\n      continue; // Skip header lines\r\n    }\r\n\r\n    // Match commit lines: <indicators> [<hash>] <subject>\r\n    // We need at least 2 characters for the indicators (column 0 and column 1)\r\n    if (line.length < 2) {\r\n      continue;\r\n    }\r\n\r\n    // Check if this line has a hash (commit line)\r\n    if (!/\\[[a-f0-9]+\\]/.test(line)) {\r\n      continue;\r\n    }\r\n\r\n    // Extract indicators (first 2 characters represent HEAD and origin/branch)\r\n    const headIndicator = line[0];\r\n    const originIndicator = line[1];\r\n\r\n    // Check if in HEAD but not in origin (ahead)\r\n    if (headIndicator !== \" \" && originIndicator === \" \") {\r\n      ahead++;\r\n    }\r\n    // Check if in origin but not in HEAD (behind)\r\n    else if (headIndicator === \" \" && originIndicator !== \" \") {\r\n      behind++;\r\n    }\r\n  }\r\n\r\n  // Note: dirty + line deltas + branch are computed separately in the caller\r\n  return {\r\n    branch: \"\",\r\n    ahead,\r\n    behind,\r\n    dirty: false,\r\n    outgoingAdditions: 0,\r\n    outgoingDeletions: 0,\r\n    incomingAdditions: 0,\r\n    incomingDeletions: 0,\r\n  };\r\n}\r\n"]}