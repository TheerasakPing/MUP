{"version":3,"file":"atMentions.test.js","sourceRoot":"","sources":["../../../src/common/utils/atMentions.test.ts"],"names":[],"mappings":";;AAAA,uCAAgD;AAEhD,6CAAwE;AAExE,IAAA,mBAAQ,EAAC,YAAY,EAAE,GAAG,EAAE,CAAC;IAC3B,IAAA,mBAAQ,EAAC,mBAAmB,EAAE,GAAG,EAAE,CAAC;QAClC,IAAA,aAAE,EAAC,+BAA+B,EAAE,GAAG,EAAE,CAAC;YACxC,IAAA,iBAAM,EAAC,IAAA,8BAAiB,EAAC,iBAAiB,CAAC,CAAC,CAAC,OAAO,CAAC;gBACnD;oBACE,KAAK,EAAE,YAAY;oBACnB,IAAI,EAAE,YAAY;iBACnB;aACF,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,6BAA6B,EAAE,GAAG,EAAE,CAAC;YACtC,IAAA,iBAAM,EAAC,IAAA,8BAAiB,EAAC,qCAAqC,CAAC,CAAC,CAAC,OAAO,CAAC;gBACvE;oBACE,KAAK,EAAE,YAAY;oBACnB,IAAI,EAAE,YAAY;iBACnB;gBACD;oBACE,KAAK,EAAE,YAAY;oBACnB,IAAI,EAAE,YAAY;iBACnB;aACF,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,+BAA+B,EAAE,GAAG,EAAE,CAAC;YACxC,IAAA,iBAAM,EAAC,IAAA,8BAAiB,EAAC,wBAAwB,CAAC,CAAC,CAAC,OAAO,CAAC;gBAC1D;oBACE,KAAK,EAAE,iBAAiB;oBACxB,IAAI,EAAE,YAAY;oBAClB,KAAK,EAAE,EAAE,SAAS,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE;iBACpC;aACF,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,4CAA4C,EAAE,GAAG,EAAE,CAAC;YACrD,MAAM,QAAQ,GAAG,IAAA,8BAAiB,EAAC,0BAA0B,CAAC,CAAC;YAC/D,IAAA,iBAAM,EAAC,QAAQ,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YACjC,IAAA,iBAAM,EAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC7C,IAAA,iBAAM,EAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,aAAa,EAAE,CAAC;YAC3C,IAAA,iBAAM,EAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC,SAAS,CAAC,0BAA0B,CAAC,CAAC;QAAA,CACvE,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,gCAAgC,EAAE,GAAG,EAAE,CAAC;YACzC,IAAA,iBAAM,EAAC,IAAA,8BAAiB,EAAC,uCAAuC,CAAC,CAAC,CAAC,OAAO,CAAC;gBACzE;oBACE,KAAK,EAAE,YAAY;oBACnB,IAAI,EAAE,YAAY;iBACnB;aACF,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,uBAAuB,EAAE,GAAG,EAAE,CAAC;QACtC,IAAA,aAAE,EAAC,oCAAoC,EAAE,GAAG,EAAE,CAAC;YAC7C,MAAM,IAAI,GAAG,aAAa,CAAC;YAC3B,IAAA,iBAAM,EAAC,IAAA,kCAAqB,EAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC;gBACvD,UAAU,EAAE,CAAC;gBACb,QAAQ,EAAE,IAAI,CAAC,MAAM;gBACrB,KAAK,EAAE,QAAQ;aAChB,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,uCAAuC,EAAE,GAAG,EAAE,CAAC;YAChD,MAAM,IAAI,GAAG,UAAU,CAAC;YACxB,IAAA,iBAAM,EAAC,IAAA,kCAAqB,EAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC;gBACvD,UAAU,EAAE,CAAC;gBACb,QAAQ,EAAE,IAAI,CAAC,MAAM;gBACrB,KAAK,EAAE,QAAQ;aAChB,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,4BAA4B,EAAE,GAAG,EAAE,CAAC;YACrC,MAAM,IAAI,GAAG,SAAS,CAAC;YACvB,IAAA,iBAAM,EAAC,IAAA,kCAAqB,EAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC;QAAA,CAC7D,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,uDAAuD,EAAE,GAAG,EAAE,CAAC;YAChE,MAAM,IAAI,GAAG,kBAAkB,CAAC;YAChC,IAAA,iBAAM,EAAC,IAAA,kCAAqB,EAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC;QAAA,CAC7D,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,8CAA8C,EAAE,GAAG,EAAE,CAAC;YACvD,MAAM,IAAI,GAAG,kBAAkB,CAAC;YAChC,IAAA,iBAAM,EAAC,IAAA,kCAAqB,EAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC;gBACvD,UAAU,EAAE,CAAC;gBACb,QAAQ,EAAE,EAAE;gBACZ,KAAK,EAAE,YAAY;aACpB,CAAC,CAAC;QAAA,CACJ,CAAC,CAAC;IAAA,CACJ,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { describe, expect, it } from \"bun:test\";\r\n\r\nimport { extractAtMentions, findAtMentionAtCursor } from \"./atMentions\";\r\n\r\ndescribe(\"atMentions\", () => {\r\n  describe(\"extractAtMentions\", () => {\r\n    it(\"extracts basic @path mentions\", () => {\r\n      expect(extractAtMentions(\"see @src/foo.ts\")).toEqual([\r\n        {\r\n          token: \"src/foo.ts\",\r\n          path: \"src/foo.ts\",\r\n        },\r\n      ]);\r\n    });\r\n\r\n    it(\"strips trailing punctuation\", () => {\r\n      expect(extractAtMentions(\"see (@src/foo.ts), and @bar/baz.ts.\")).toEqual([\r\n        {\r\n          token: \"src/foo.ts\",\r\n          path: \"src/foo.ts\",\r\n        },\r\n        {\r\n          token: \"bar/baz.ts\",\r\n          path: \"bar/baz.ts\",\r\n        },\r\n      ]);\r\n    });\r\n\r\n    it(\"parses #L<start>-<end> ranges\", () => {\r\n      expect(extractAtMentions(\"check @src/foo.ts#L1-3\")).toEqual([\r\n        {\r\n          token: \"src/foo.ts#L1-3\",\r\n          path: \"src/foo.ts\",\r\n          range: { startLine: 1, endLine: 3 },\r\n        },\r\n      ]);\r\n    });\r\n\r\n    it(\"records an error for unsupported fragments\", () => {\r\n      const mentions = extractAtMentions(\"check @src/foo.ts#anchor\");\r\n      expect(mentions).toHaveLength(1);\r\n      expect(mentions[0]?.path).toBe(\"src/foo.ts\");\r\n      expect(mentions[0]?.range).toBeUndefined();\r\n      expect(mentions[0]?.rangeError).toContain(\"expected #L<start>-<end>\");\r\n    });\r\n\r\n    it(\"does not match email addresses\", () => {\r\n      expect(extractAtMentions(\"email foo@bar.com and see @src/foo.ts\")).toEqual([\r\n        {\r\n          token: \"src/foo.ts\",\r\n          path: \"src/foo.ts\",\r\n        },\r\n      ]);\r\n    });\r\n  });\r\n\r\n  describe(\"findAtMentionAtCursor\", () => {\r\n    it(\"finds the active mention at cursor\", () => {\r\n      const text = \"see @src/fo\";\r\n      expect(findAtMentionAtCursor(text, text.length)).toEqual({\r\n        startIndex: 4,\r\n        endIndex: text.length,\r\n        query: \"src/fo\",\r\n      });\r\n    });\r\n\r\n    it(\"supports leading punctuation before @\", () => {\r\n      const text = \"(@src/fo\";\r\n      expect(findAtMentionAtCursor(text, text.length)).toEqual({\r\n        startIndex: 1,\r\n        endIndex: text.length,\r\n        query: \"src/fo\",\r\n      });\r\n    });\r\n\r\n    it(\"ignores word@word patterns\", () => {\r\n      const text = \"foo@bar\";\r\n      expect(findAtMentionAtCursor(text, text.length)).toBeNull();\r\n    });\r\n\r\n    it(\"ignores tokens that already contain a fragment (#...)\", () => {\r\n      const text = \"@src/foo.ts#L1-3\";\r\n      expect(findAtMentionAtCursor(text, text.length)).toBeNull();\r\n    });\r\n\r\n    it(\"excludes trailing punctuation from the match\", () => {\r\n      const text = \"see @src/foo.ts,\";\r\n      expect(findAtMentionAtCursor(text, text.length)).toEqual({\r\n        startIndex: 4,\r\n        endIndex: 15,\r\n        query: \"src/foo.ts\",\r\n      });\r\n    });\r\n  });\r\n});\r\n"]}