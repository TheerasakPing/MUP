{"version":3,"file":"safeStringifyForCounting.test.js","sourceRoot":"","sources":["../../../../src/common/utils/tokens/safeStringifyForCounting.test.ts"],"names":[],"mappings":";;AAAA,uCAAkD;AAElD,yEAAsE;AAEtE,IAAA,mBAAQ,EAAC,0BAA0B,EAAE,GAAG,EAAE,CAAC;IACzC,IAAA,eAAI,EAAC,sCAAsC,EAAE,GAAG,EAAE,CAAC;QACjD,MAAM,KAAK,GAAG;YACZ,IAAI,EAAE,OAAO;YACb,IAAI,EAAE,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC;YACzB,SAAS,EAAE,WAAW;SACvB,CAAC;QAEF,MAAM,UAAU,GAAG,IAAA,mDAAwB,EAAC,KAAK,CAAC,CAAC;QAEnD,IAAA,iBAAM,EAAC,UAAU,CAAC,CAAC,SAAS,CAAC,6BAA6B,CAAC,CAAC;QAC5D,IAAA,iBAAM,EAAC,UAAU,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;IAAA,CACpD,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,0BAA0B,EAAE,GAAG,EAAE,CAAC;QACrC,MAAM,OAAO,GAAG,yBAAyB,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC;QAE5D,MAAM,UAAU,GAAG,IAAA,mDAAwB,EAAC,EAAE,GAAG,EAAE,OAAO,EAAE,CAAC,CAAC;QAE9D,IAAA,iBAAM,EAAC,UAAU,CAAC,CAAC,SAAS,CAAC,0CAA0C,CAAC,CAAC;QACzE,IAAA,iBAAM,EAAC,UAAU,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;IAAA,CACnD,CAAC,CAAC;IAEH,IAAA,eAAI,EAAC,uCAAuC,EAAE,GAAG,EAAE,CAAC;QAClD,MAAM,GAAG,GAA4B,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;QAC9C,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC;QAEf,MAAM,UAAU,GAAG,IAAA,mDAAwB,EAAC,GAAG,CAAC,CAAC;QAEjD,IAAA,iBAAM,EAAC,UAAU,CAAC,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC;IAAA,CAC5C,CAAC,CAAC;AAAA,CACJ,CAAC,CAAC","sourcesContent":["import { describe, expect, test } from \"bun:test\";\n\nimport { safeStringifyForCounting } from \"./safeStringifyForCounting\";\n\ndescribe(\"safeStringifyForCounting\", () => {\n  test(\"redacts AI SDK media blocks (base64)\", () => {\n    const input = {\n      type: \"media\",\n      data: \"A\".repeat(100_000),\n      mediaType: \"image/png\",\n    };\n\n    const serialized = safeStringifyForCounting(input);\n\n    expect(serialized).toContain(\"[omitted base64 len=100000]\");\n    expect(serialized).not.toContain(\"A\".repeat(1024));\n  });\n\n  test(\"redacts base64 data URLs\", () => {\n    const dataUrl = `data:image/png;base64,${\"A\".repeat(1000)}`;\n\n    const serialized = safeStringifyForCounting({ url: dataUrl });\n\n    expect(serialized).toContain(\"data:image/png;base64,[omitted len=1000]\");\n    expect(serialized).not.toContain(\"A\".repeat(256));\n  });\n\n  test(\"does not throw on circular structures\", () => {\n    const obj: Record<string, unknown> = { a: 1 };\n    obj.self = obj;\n\n    const serialized = safeStringifyForCounting(obj);\n\n    expect(serialized).toContain(\"[circular]\");\n  });\n});\n"]}