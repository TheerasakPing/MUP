{"version":3,"file":"agentTools.js","sourceRoot":"","sources":["../../../src/common/utils/agentTools.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AgentId } from \"@/common/types/agentDefinition\";\r\n\r\nexport interface ToolsConfig {\r\n  add?: readonly string[];\r\n  remove?: readonly string[];\r\n}\r\n\r\nexport interface AgentToolsLike {\r\n  id: AgentId;\r\n  base?: AgentId;\r\n  tools?: ToolsConfig;\r\n}\r\n\r\nexport interface ToolsConfigCarrier {\r\n  tools?: ToolsConfig;\r\n}\r\n\r\nfunction toolMatchesPatterns(toolName: string, patterns: readonly string[]): boolean {\r\n  for (const pattern of patterns) {\r\n    const regex = new RegExp(`^${pattern}$`);\r\n    if (regex.test(toolName)) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Apply add/remove semantics to a single tool name.\r\n *\r\n * `configs` must be ordered base → child.\r\n *\r\n * Semantics:\r\n * - Baseline is deny-all.\r\n * - If a tool matches any `add` pattern it becomes enabled.\r\n * - If a tool matches any `remove` pattern it becomes disabled (overrides earlier adds).\r\n */\r\nexport function isToolEnabledByConfigs(toolName: string, configs: readonly ToolsConfig[]): boolean {\r\n  let enabled = false;\r\n\r\n  for (const config of configs) {\r\n    if (config.add && toolMatchesPatterns(toolName, config.add)) {\r\n      enabled = true;\r\n    }\r\n\r\n    if (config.remove && toolMatchesPatterns(toolName, config.remove)) {\r\n      enabled = false;\r\n    }\r\n  }\r\n\r\n  return enabled;\r\n}\r\n\r\n/**\r\n * Extract tool configs from a resolved inheritance chain.\r\n *\r\n * Input order: child → base (selected agent first)\r\n * Output order: base → child (for correct add/remove semantics)\r\n */\r\nexport function collectToolConfigsFromResolvedChain(\r\n  agents: readonly ToolsConfigCarrier[],\r\n  maxDepth = 10\r\n): ToolsConfig[] {\r\n  return [...agents]\r\n    .slice(0, maxDepth)\r\n    .reverse()\r\n    .filter((agent): agent is ToolsConfigCarrier & { tools: ToolsConfig } => agent.tools != null)\r\n    .map((agent) => agent.tools);\r\n}\r\n\r\n/**\r\n * Extract tool configs by walking `base` pointers in a graph of unique agent IDs.\r\n *\r\n * This is intended for UI usage where the caller has a flat list from discovery.\r\n */\r\nexport function collectToolConfigsFromDefinitionGraph(\r\n  agentId: AgentId,\r\n  agents: readonly AgentToolsLike[],\r\n  maxDepth = 10\r\n): ToolsConfig[] {\r\n  const byId = new Map<AgentId, AgentToolsLike>();\r\n  for (const agent of agents) {\r\n    byId.set(agent.id, agent);\r\n  }\r\n\r\n  const configsChildToBase: ToolsConfig[] = [];\r\n  const visited = new Set<AgentId>();\r\n\r\n  let currentId: AgentId | undefined = agentId;\r\n  let depth = 0;\r\n\r\n  while (currentId && depth < maxDepth) {\r\n    if (visited.has(currentId)) {\r\n      break;\r\n    }\r\n    visited.add(currentId);\r\n\r\n    const agent = byId.get(currentId);\r\n    if (!agent) {\r\n      break;\r\n    }\r\n\r\n    if (agent.tools) {\r\n      configsChildToBase.push(agent.tools);\r\n    }\r\n\r\n    currentId = agent.base;\r\n    depth++;\r\n  }\r\n\r\n  return configsChildToBase.reverse();\r\n}\r\n\r\nexport function isToolEnabledInResolvedChain(\r\n  toolName: string,\r\n  agents: readonly ToolsConfigCarrier[],\r\n  maxDepth = 10\r\n): boolean {\r\n  return isToolEnabledByConfigs(toolName, collectToolConfigsFromResolvedChain(agents, maxDepth));\r\n}\r\n\r\nexport function isPlanLikeInResolvedChain(\r\n  agents: readonly ToolsConfigCarrier[],\r\n  maxDepth = 10\r\n): boolean {\r\n  return isToolEnabledInResolvedChain(\"propose_plan\", agents, maxDepth);\r\n}\r\n\r\nexport function isExecLikeEditingCapableInResolvedChain(\r\n  agents: ReadonlyArray<ToolsConfigCarrier & { id: AgentId }>,\r\n  maxDepth = 10\r\n): boolean {\r\n  const inheritsExec = agents.some((agent) => agent.id === \"exec\");\r\n  if (!inheritsExec) {\r\n    return false;\r\n  }\r\n\r\n  return (\r\n    isToolEnabledInResolvedChain(\"file_edit_insert\", agents, maxDepth) ||\r\n    isToolEnabledInResolvedChain(\"file_edit_replace_string\", agents, maxDepth)\r\n  );\r\n}\r\n"]}