{"version":3,"file":"agentTools.js","sourceRoot":"","sources":["../../../src/common/utils/agentTools.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AgentId } from \"@/common/types/agentDefinition\";\n\nexport interface ToolsConfig {\n  add?: readonly string[];\n  remove?: readonly string[];\n}\n\nexport interface AgentToolsLike {\n  id: AgentId;\n  base?: AgentId;\n  tools?: ToolsConfig;\n}\n\nexport interface ToolsConfigCarrier {\n  tools?: ToolsConfig;\n}\n\nfunction toolMatchesPatterns(toolName: string, patterns: readonly string[]): boolean {\n  for (const pattern of patterns) {\n    const regex = new RegExp(`^${pattern}$`);\n    if (regex.test(toolName)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Apply add/remove semantics to a single tool name.\n *\n * `configs` must be ordered base → child.\n *\n * Semantics:\n * - Baseline is deny-all.\n * - If a tool matches any `add` pattern it becomes enabled.\n * - If a tool matches any `remove` pattern it becomes disabled (overrides earlier adds).\n */\nexport function isToolEnabledByConfigs(toolName: string, configs: readonly ToolsConfig[]): boolean {\n  let enabled = false;\n\n  for (const config of configs) {\n    if (config.add && toolMatchesPatterns(toolName, config.add)) {\n      enabled = true;\n    }\n\n    if (config.remove && toolMatchesPatterns(toolName, config.remove)) {\n      enabled = false;\n    }\n  }\n\n  return enabled;\n}\n\n/**\n * Extract tool configs from a resolved inheritance chain.\n *\n * Input order: child → base (selected agent first)\n * Output order: base → child (for correct add/remove semantics)\n */\nexport function collectToolConfigsFromResolvedChain(\n  agents: readonly ToolsConfigCarrier[],\n  maxDepth = 10\n): ToolsConfig[] {\n  return [...agents]\n    .slice(0, maxDepth)\n    .reverse()\n    .filter((agent): agent is ToolsConfigCarrier & { tools: ToolsConfig } => agent.tools != null)\n    .map((agent) => agent.tools);\n}\n\n/**\n * Extract tool configs by walking `base` pointers in a graph of unique agent IDs.\n *\n * This is intended for UI usage where the caller has a flat list from discovery.\n */\nexport function collectToolConfigsFromDefinitionGraph(\n  agentId: AgentId,\n  agents: readonly AgentToolsLike[],\n  maxDepth = 10\n): ToolsConfig[] {\n  const byId = new Map<AgentId, AgentToolsLike>();\n  for (const agent of agents) {\n    byId.set(agent.id, agent);\n  }\n\n  const configsChildToBase: ToolsConfig[] = [];\n  const visited = new Set<AgentId>();\n\n  let currentId: AgentId | undefined = agentId;\n  let depth = 0;\n\n  while (currentId && depth < maxDepth) {\n    if (visited.has(currentId)) {\n      break;\n    }\n    visited.add(currentId);\n\n    const agent = byId.get(currentId);\n    if (!agent) {\n      break;\n    }\n\n    if (agent.tools) {\n      configsChildToBase.push(agent.tools);\n    }\n\n    currentId = agent.base;\n    depth++;\n  }\n\n  return configsChildToBase.reverse();\n}\n\nexport function isToolEnabledInResolvedChain(\n  toolName: string,\n  agents: readonly ToolsConfigCarrier[],\n  maxDepth = 10\n): boolean {\n  return isToolEnabledByConfigs(toolName, collectToolConfigsFromResolvedChain(agents, maxDepth));\n}\n\nexport function isPlanLikeInResolvedChain(\n  agents: readonly ToolsConfigCarrier[],\n  maxDepth = 10\n): boolean {\n  return isToolEnabledInResolvedChain(\"propose_plan\", agents, maxDepth);\n}\n\nexport function isExecLikeEditingCapableInResolvedChain(\n  agents: ReadonlyArray<ToolsConfigCarrier & { id: AgentId }>,\n  maxDepth = 10\n): boolean {\n  const inheritsExec = agents.some((agent) => agent.id === \"exec\");\n  if (!inheritsExec) {\n    return false;\n  }\n\n  return (\n    isToolEnabledInResolvedChain(\"file_edit_insert\", agents, maxDepth) ||\n    isToolEnabledInResolvedChain(\"file_edit_replace_string\", agents, maxDepth)\n  );\n}\n"]}