import{o as p,a as I,s as d,n as y,f as oe,j as kn,_ as At,l as L,u as te,e as It,r as wn}from"./main-B2XpWmPF.js";import{t as xn,Z as O}from"./types-CUi3gq4E.js";import"./TerminalRouterContext-CeKE7fio.js";var On={},Tn=Object.defineProperty,Pn=Object.defineProperties,Sn=Object.getOwnPropertyDescriptors,Pe=Object.getOwnPropertySymbols,Rt=Object.prototype.hasOwnProperty,Et=Object.prototype.propertyIsEnumerable,$t=e=>{throw TypeError(e)},Ye=(e,t,n)=>t in e?Tn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,c=(e,t)=>{for(var n in t||(t={}))Rt.call(t,n)&&Ye(e,n,t[n]);if(Pe)for(var n of Pe(t))Et.call(t,n)&&Ye(e,n,t[n]);return e},S=(e,t)=>Pn(e,Sn(t)),Le=(e,t)=>{var n={};for(var a in e)Rt.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(e!=null&&Pe)for(var a of Pe(e))t.indexOf(a)<0&&Et.call(e,a)&&(n[a]=e[a]);return n},An=(e,t,n)=>t.has(e)||$t("Cannot "+n),Qe=(e,t,n)=>(An(e,t,"read from private field"),n?n.call(e):t.get(e)),In=(e,t,n)=>t.has(e)?$t("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Ct="vercel.ai.error",Rn=Symbol.for(Ct),et,tt,U=class Dt extends(tt=Error,et=Rn,tt){constructor({name:t,message:n,cause:a}){super(n),this[et]=!0,this.name=t,this.cause=a}static isInstance(t){return Dt.hasMarker(t,Ct)}static hasMarker(t,n){const a=Symbol.for(n);return t!=null&&typeof t=="object"&&a in t&&typeof t[a]=="boolean"&&t[a]===!0}},jt="AI_APICallError",Mt=`vercel.ai.error.${jt}`,En=Symbol.for(Mt),nt,at,ee=class extends(at=U,nt=En,at){constructor({message:e,url:t,requestBodyValues:n,statusCode:a,responseHeaders:r,responseBody:o,cause:s,isRetryable:i=a!=null&&(a===408||a===409||a===429||a>=500),data:l}){super({name:jt,message:e,cause:s}),this[nt]=!0,this.url=t,this.requestBodyValues=n,this.statusCode=a,this.responseHeaders=r,this.responseBody=o,this.isRetryable=i,this.data=l}static isInstance(e){return U.hasMarker(e,Mt)}},Nt="AI_EmptyResponseBodyError",Zt=`vercel.ai.error.${Nt}`,$n=Symbol.for(Zt),rt,ot,Cn=class extends(ot=U,rt=$n,ot){constructor({message:e="Empty response body"}={}){super({name:Nt,message:e}),this[rt]=!0}static isInstance(e){return U.hasMarker(e,Zt)}};function Lt(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var Ut="AI_InvalidArgumentError",qt=`vercel.ai.error.${Ut}`,Dn=Symbol.for(qt),st,it,Bt=class extends(it=U,st=Dn,it){constructor({message:e,cause:t,argument:n}){super({name:Ut,message:e,cause:t}),this[st]=!0,this.argument=n}static isInstance(e){return U.hasMarker(e,qt)}},Ft="AI_InvalidPromptError",zt=`vercel.ai.error.${Ft}`,jn=Symbol.for(zt),lt,ut,Mn=class extends(ut=U,lt=jn,ut){constructor({prompt:e,message:t,cause:n}){super({name:Ft,message:`Invalid prompt: ${t}`,cause:n}),this[lt]=!0,this.prompt=e}static isInstance(e){return U.hasMarker(e,zt)}},Vt="AI_InvalidResponseDataError",Ht=`vercel.ai.error.${Vt}`,Nn=Symbol.for(Ht),ct,pt,_e=class extends(pt=U,ct=Nn,pt){constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:Vt,message:t}),this[ct]=!0,this.data=e}static isInstance(e){return U.hasMarker(e,Ht)}},Jt="AI_JSONParseError",Kt=`vercel.ai.error.${Jt}`,Zn=Symbol.for(Kt),dt,ft,Se=class extends(ft=U,dt=Zn,ft){constructor({text:e,cause:t}){super({name:Jt,message:`JSON parsing failed: Text: ${e}.
Error message: ${Lt(t)}`,cause:t}),this[dt]=!0,this.text=e}static isInstance(e){return U.hasMarker(e,Kt)}},Wt="AI_LoadAPIKeyError",Gt=`vercel.ai.error.${Wt}`,Ln=Symbol.for(Gt),gt,mt,we=class extends(mt=U,gt=Ln,mt){constructor({message:e}){super({name:Wt,message:e}),this[gt]=!0}static isInstance(e){return U.hasMarker(e,Gt)}},Xt="AI_NoContentGeneratedError",Yt=`vercel.ai.error.${Xt}`,Un=Symbol.for(Yt),ht,vt,Ve=class extends(vt=U,ht=Un,vt){constructor({message:e="No content generated."}={}){super({name:Xt,message:e}),this[ht]=!0}static isInstance(e){return U.hasMarker(e,Yt)}},Qt="AI_TypeValidationError",en=`vercel.ai.error.${Qt}`,qn=Symbol.for(en),_t,yt,ye=class Ue extends(yt=U,_t=qn,yt){constructor({value:t,cause:n}){super({name:Qt,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${Lt(n)}`,cause:n}),this[_t]=!0,this.value=t}static isInstance(t){return U.hasMarker(t,en)}static wrap({value:t,cause:n}){return Ue.isInstance(n)&&n.value===t?n:new Ue({value:t,cause:n})}},tn="AI_UnsupportedFunctionalityError",nn=`vercel.ai.error.${tn}`,Bn=Symbol.for(nn),bt,kt,ne=class extends(kt=U,bt=Bn,kt){constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:tn,message:t}),this[bt]=!0,this.functionality=e}static isInstance(e){return U.hasMarker(e,nn)}},wt=class extends Error{constructor(e,t){super(e),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}};function De(e){}function Fn(e){if(typeof e=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:t=De,onError:n=De,onRetry:a=De,onComment:r}=e;let o="",s=!0,i,l="",u="";function b(m){const f=s?m.replace(/^\xEF\xBB\xBF/,""):m,[h,A]=zn(`${o}${f}`);for(const $ of h)v($);o=A,s=!1}function v(m){if(m===""){_();return}if(m.startsWith(":")){r&&r(m.slice(m.startsWith(": ")?2:1));return}const f=m.indexOf(":");if(f!==-1){const h=m.slice(0,f),A=m[f+1]===" "?2:1,$=m.slice(f+A);g(h,$,m);return}g(m,"",m)}function g(m,f,h){switch(m){case"event":u=f;break;case"data":l=`${l}${f}
`;break;case"id":i=f.includes("\0")?void 0:f;break;case"retry":/^\d+$/.test(f)?a(parseInt(f,10)):n(new wt(`Invalid \`retry\` value: "${f}"`,{type:"invalid-retry",value:f,line:h}));break;default:n(new wt(`Unknown field "${m.length>20?`${m.slice(0,20)}â€¦`:m}"`,{type:"unknown-field",field:m,value:f,line:h}));break}}function _(){l.length>0&&t({id:i,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),i=void 0,l="",u=""}function w(m={}){o&&m.consume&&v(o),s=!0,i=void 0,l="",u="",o=""}return{feed:b,reset:w}}function zn(e){const t=[];let n="",a=0;for(;a<e.length;){const r=e.indexOf("\r",a),o=e.indexOf(`
`,a);let s=-1;if(r!==-1&&o!==-1?s=Math.min(r,o):r!==-1?r===e.length-1?s=-1:s=r:o!==-1&&(s=o),s===-1){n=e.slice(a);break}else{const i=e.slice(a,s);t.push(i),a=s+1,e[a-1]==="\r"&&e[a]===`
`&&a++}}return[t,n]}var Vn=class extends TransformStream{constructor({onError:e,onRetry:t,onComment:n}={}){let a;super({start(r){a=Fn({onEvent:o=>{r.enqueue(o)},onError(o){e==="terminate"?r.error(o):typeof e=="function"&&e(o)},onRetry:t,onComment:n})},transform(r){a.feed(r)}})}};function me(...e){return e.reduce((t,n)=>c(c({},t),n??{}),{})}function Re(e){return Object.fromEntries([...e.headers])}var{btoa:Hn}=globalThis;function Jn(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return Hn(t)}var Kn=({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{const r=()=>{const o=n.length,s=new Array(t);for(let i=0;i<t;i++)s[i]=n[Math.random()*o|0];return s.join("")};if(e==null)return r;if(n.includes(a))throw new Bt({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${n}".`});return()=>`${e}${a}${r()}`},Q=Kn();function qe(e){return(e instanceof Error||e instanceof DOMException)&&(e.name==="AbortError"||e.name==="ResponseAborted"||e.name==="TimeoutError")}var Wn=["fetch failed","failed to fetch"];function Gn({error:e,url:t,requestBodyValues:n}){if(qe(e))return e;if(e instanceof TypeError&&Wn.includes(e.message.toLowerCase())){const a=e.cause;if(a!=null)return new ee({message:`Cannot connect to API: ${a.message}`,cause:a,url:t,requestBodyValues:n,isRetryable:!0})}return e}function Xn(e=globalThis){var t,n,a;return e.window?"runtime/browser":(t=e.navigator)!=null&&t.userAgent?`runtime/${e.navigator.userAgent.toLowerCase()}`:(a=(n=e.process)==null?void 0:n.versions)!=null&&a.node?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function Yn(e){if(e==null)return{};const t={};if(e instanceof Headers)e.forEach((n,a)=>{t[a.toLowerCase()]=n});else{Array.isArray(e)||(e=Object.entries(e));for(const[n,a]of e)a!=null&&(t[n.toLowerCase()]=a)}return t}function Qn(e,...t){const n=new Headers(Yn(e)),a=n.get("user-agent")||"";return n.set("user-agent",[a,...t].filter(Boolean).join(" ")),Object.fromEntries(n.entries())}var ea="4.0.1";function an({apiKey:e,environmentVariableName:t,apiKeyParameterName:n="apiKey",description:a}){if(typeof e=="string")return e;if(e!=null)throw new we({message:`${a} API key must be a string.`});if(typeof process>"u")throw new we({message:`${a} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(e=On[t],e==null)throw new we({message:`${a} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new we({message:`${a} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}var ta=/"__proto__"\s*:/,na=/"constructor"\s*:/;function xt(e){const t=JSON.parse(e);return t===null||typeof t!="object"||ta.test(e)===!1&&na.test(e)===!1?t:aa(t)}function aa(e){let t=[e];for(;t.length;){const n=t;t=[];for(const a of n){if(Object.prototype.hasOwnProperty.call(a,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(a,"constructor")&&Object.prototype.hasOwnProperty.call(a.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const r in a){const o=a[r];o&&typeof o=="object"&&t.push(o)}}}return e}function He(e){const{stackTraceLimit:t}=Error;try{Error.stackTraceLimit=0}catch{return xt(e)}try{return xt(e)}finally{Error.stackTraceLimit=t}}function xe(e){if(e.type==="object"){e.additionalProperties=!1;const t=e.properties;if(t!=null)for(const n in t)t[n]=xe(t[n])}return e.type==="array"&&e.items!=null&&(Array.isArray(e.items)?e.items=e.items.map(t=>xe(t)):e.items=xe(e.items)),e}var ra=Symbol("Let zodToJsonSchema decide on which parser to use"),Ot={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},oa=e=>typeof e=="string"?S(c({},Ot),{name:e}):c(c({},Ot),e);function W(){return{}}function sa(e,t){var n,a,r;const o={type:"array"};return(n=e.type)!=null&&n._def&&((r=(a=e.type)==null?void 0:a._def)==null?void 0:r.typeName)!==O.ZodAny&&(o.items=R(e.type._def,S(c({},t),{currentPath:[...t.currentPath,"items"]}))),e.minLength&&(o.minItems=e.minLength.value),e.maxLength&&(o.maxItems=e.maxLength.value),e.exactLength&&(o.minItems=e.exactLength.value,o.maxItems=e.exactLength.value),o}function ia(e){const t={type:"integer",format:"int64"};if(!e.checks)return t;for(const n of e.checks)switch(n.kind){case"min":n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case"max":n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case"multipleOf":t.multipleOf=n.value;break}return t}function la(){return{type:"boolean"}}function rn(e,t){return R(e.type._def,t)}var ua=(e,t)=>R(e.innerType._def,t);function on(e,t,n){const a=n??t.dateStrategy;if(Array.isArray(a))return{anyOf:a.map((r,o)=>on(e,t,r))};switch(a){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return ca(e)}}var ca=e=>{const t={type:"integer",format:"unix-time"};for(const n of e.checks)switch(n.kind){case"min":t.minimum=n.value;break;case"max":t.maximum=n.value;break}return t};function pa(e,t){return S(c({},R(e.innerType._def,t)),{default:e.defaultValue()})}function da(e,t){return t.effectStrategy==="input"?R(e.schema._def,t):W()}function fa(e){return{type:"string",enum:Array.from(e.values)}}var ga=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function ma(e,t){const n=[R(e.left._def,S(c({},t),{currentPath:[...t.currentPath,"allOf","0"]})),R(e.right._def,S(c({},t),{currentPath:[...t.currentPath,"allOf","1"]}))].filter(r=>!!r),a=[];return n.forEach(r=>{if(ga(r))a.push(...r.allOf);else{let o=r;if("additionalProperties"in r&&r.additionalProperties===!1){const s=r,{additionalProperties:i}=s;o=Le(s,["additionalProperties"])}a.push(o)}}),a.length?{allOf:a}:void 0}function ha(e){const t=typeof e.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(e.value)?"array":"object"}:{type:t==="bigint"?"integer":t,const:e.value}}var je=void 0,X={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(je===void 0&&(je=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),je),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function sn(e,t){const n={type:"string"};if(e.checks)for(const a of e.checks)switch(a.kind){case"min":n.minLength=typeof n.minLength=="number"?Math.max(n.minLength,a.value):a.value;break;case"max":n.maxLength=typeof n.maxLength=="number"?Math.min(n.maxLength,a.value):a.value;break;case"email":switch(t.emailStrategy){case"format:email":Y(n,"email",a.message,t);break;case"format:idn-email":Y(n,"idn-email",a.message,t);break;case"pattern:zod":H(n,X.email,a.message,t);break}break;case"url":Y(n,"uri",a.message,t);break;case"uuid":Y(n,"uuid",a.message,t);break;case"regex":H(n,a.regex,a.message,t);break;case"cuid":H(n,X.cuid,a.message,t);break;case"cuid2":H(n,X.cuid2,a.message,t);break;case"startsWith":H(n,RegExp(`^${Me(a.value,t)}`),a.message,t);break;case"endsWith":H(n,RegExp(`${Me(a.value,t)}$`),a.message,t);break;case"datetime":Y(n,"date-time",a.message,t);break;case"date":Y(n,"date",a.message,t);break;case"time":Y(n,"time",a.message,t);break;case"duration":Y(n,"duration",a.message,t);break;case"length":n.minLength=typeof n.minLength=="number"?Math.max(n.minLength,a.value):a.value,n.maxLength=typeof n.maxLength=="number"?Math.min(n.maxLength,a.value):a.value;break;case"includes":{H(n,RegExp(Me(a.value,t)),a.message,t);break}case"ip":{a.version!=="v6"&&Y(n,"ipv4",a.message,t),a.version!=="v4"&&Y(n,"ipv6",a.message,t);break}case"base64url":H(n,X.base64url,a.message,t);break;case"jwt":H(n,X.jwt,a.message,t);break;case"cidr":{a.version!=="v6"&&H(n,X.ipv4Cidr,a.message,t),a.version!=="v4"&&H(n,X.ipv6Cidr,a.message,t);break}case"emoji":H(n,X.emoji(),a.message,t);break;case"ulid":{H(n,X.ulid,a.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{Y(n,"binary",a.message,t);break}case"contentEncoding:base64":{n.contentEncoding="base64";break}case"pattern:zod":{H(n,X.base64,a.message,t);break}}break}case"nanoid":H(n,X.nanoid,a.message,t)}return n}function Me(e,t){return t.patternStrategy==="escape"?_a(e):e}var va=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function _a(e){let t="";for(let n=0;n<e.length;n++)va.has(e[n])||(t+="\\"),t+=e[n];return t}function Y(e,t,n,a){var r;e.format||(r=e.anyOf)!=null&&r.some(o=>o.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push(c({format:t},n&&a.errorMessages&&{errorMessage:{format:n}}))):e.format=t}function H(e,t,n,a){var r;e.pattern||(r=e.allOf)!=null&&r.some(o=>o.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push(c({pattern:Tt(t,a)},n&&a.errorMessages&&{errorMessage:{pattern:n}}))):e.pattern=Tt(t,a)}function Tt(e,t){var n;if(!t.applyRegexFlags||!e.flags)return e.source;const a={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},r=a.i?e.source.toLowerCase():e.source;let o="",s=!1,i=!1,l=!1;for(let u=0;u<r.length;u++){if(s){o+=r[u],s=!1;continue}if(a.i){if(i){if(r[u].match(/[a-z]/)){l?(o+=r[u],o+=`${r[u-2]}-${r[u]}`.toUpperCase(),l=!1):r[u+1]==="-"&&((n=r[u+2])!=null&&n.match(/[a-z]/))?(o+=r[u],l=!0):o+=`${r[u]}${r[u].toUpperCase()}`;continue}}else if(r[u].match(/[a-z]/)){o+=`[${r[u]}${r[u].toUpperCase()}]`;continue}}if(a.m){if(r[u]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(r[u]==="$"){o+=`($|(?=[\r
]))`;continue}}if(a.s&&r[u]==="."){o+=i?`${r[u]}\r
`:`[${r[u]}\r
]`;continue}o+=r[u],r[u]==="\\"?s=!0:i&&r[u]==="]"?i=!1:!i&&r[u]==="["&&(i=!0)}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return o}function ln(e,t){var n,a,r,o,s,i;const l={type:"object",additionalProperties:(n=R(e.valueType._def,S(c({},t),{currentPath:[...t.currentPath,"additionalProperties"]})))!=null?n:t.allowedAdditionalProperties};if(((a=e.keyType)==null?void 0:a._def.typeName)===O.ZodString&&((r=e.keyType._def.checks)!=null&&r.length)){const u=sn(e.keyType._def,t),{type:b}=u,v=Le(u,["type"]);return S(c({},l),{propertyNames:v})}else{if(((o=e.keyType)==null?void 0:o._def.typeName)===O.ZodEnum)return S(c({},l),{propertyNames:{enum:e.keyType._def.values}});if(((s=e.keyType)==null?void 0:s._def.typeName)===O.ZodBranded&&e.keyType._def.type._def.typeName===O.ZodString&&((i=e.keyType._def.type._def.checks)!=null&&i.length)){const u=rn(e.keyType._def,t),{type:b}=u,v=Le(u,["type"]);return S(c({},l),{propertyNames:v})}}return l}function ya(e,t){if(t.mapStrategy==="record")return ln(e,t);const n=R(e.keyType._def,S(c({},t),{currentPath:[...t.currentPath,"items","items","0"]}))||W(),a=R(e.valueType._def,S(c({},t),{currentPath:[...t.currentPath,"items","items","1"]}))||W();return{type:"array",maxItems:125,items:{type:"array",items:[n,a],minItems:2,maxItems:2}}}function ba(e){const t=e.values,a=Object.keys(e.values).filter(o=>typeof t[t[o]]!="number").map(o=>t[o]),r=Array.from(new Set(a.map(o=>typeof o)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:a}}function ka(){return{not:W()}}function wa(){return{type:"null"}}var Be={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function xa(e,t){const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(a=>a._def.typeName in Be&&(!a._def.checks||!a._def.checks.length))){const a=n.reduce((r,o)=>{const s=Be[o._def.typeName];return s&&!r.includes(s)?[...r,s]:r},[]);return{type:a.length>1?a:a[0]}}else if(n.every(a=>a._def.typeName==="ZodLiteral"&&!a.description)){const a=n.reduce((r,o)=>{const s=typeof o._def.value;switch(s){case"string":case"number":case"boolean":return[...r,s];case"bigint":return[...r,"integer"];case"object":if(o._def.value===null)return[...r,"null"];case"symbol":case"undefined":case"function":default:return r}},[]);if(a.length===n.length){const r=a.filter((o,s,i)=>i.indexOf(o)===s);return{type:r.length>1?r:r[0],enum:n.reduce((o,s)=>o.includes(s._def.value)?o:[...o,s._def.value],[])}}}else if(n.every(a=>a._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((a,r)=>[...a,...r._def.values.filter(o=>!a.includes(o))],[])};return Oa(e,t)}var Oa=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((a,r)=>R(a._def,S(c({},t),{currentPath:[...t.currentPath,"anyOf",`${r}`]}))).filter(a=>!!a&&(!t.strictUnions||typeof a=="object"&&Object.keys(a).length>0));return n.length?{anyOf:n}:void 0};function Ta(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[Be[e.innerType._def.typeName],"null"]};const n=R(e.innerType._def,S(c({},t),{currentPath:[...t.currentPath,"anyOf","0"]}));return n&&{anyOf:[n,{type:"null"}]}}function Pa(e){const t={type:"number"};if(!e.checks)return t;for(const n of e.checks)switch(n.kind){case"int":t.type="integer";break;case"min":n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case"max":n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case"multipleOf":t.multipleOf=n.value;break}return t}function Sa(e,t){const n={type:"object",properties:{}},a=[],r=e.shape();for(const s in r){let i=r[s];if(i===void 0||i._def===void 0)continue;const l=Ia(i),u=R(i._def,S(c({},t),{currentPath:[...t.currentPath,"properties",s],propertyPath:[...t.currentPath,"properties",s]}));u!==void 0&&(n.properties[s]=u,l||a.push(s))}a.length&&(n.required=a);const o=Aa(e,t);return o!==void 0&&(n.additionalProperties=o),n}function Aa(e,t){if(e.catchall._def.typeName!=="ZodNever")return R(e.catchall._def,S(c({},t),{currentPath:[...t.currentPath,"additionalProperties"]}));switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function Ia(e){try{return e.isOptional()}catch{return!0}}var Ra=(e,t)=>{var n;if(t.currentPath.toString()===((n=t.propertyPath)==null?void 0:n.toString()))return R(e.innerType._def,t);const a=R(e.innerType._def,S(c({},t),{currentPath:[...t.currentPath,"anyOf","1"]}));return a?{anyOf:[{not:W()},a]}:W()},Ea=(e,t)=>{if(t.pipeStrategy==="input")return R(e.in._def,t);if(t.pipeStrategy==="output")return R(e.out._def,t);const n=R(e.in._def,S(c({},t),{currentPath:[...t.currentPath,"allOf","0"]})),a=R(e.out._def,S(c({},t),{currentPath:[...t.currentPath,"allOf",n?"1":"0"]}));return{allOf:[n,a].filter(r=>r!==void 0)}};function $a(e,t){return R(e.type._def,t)}function Ca(e,t){const a={type:"array",uniqueItems:!0,items:R(e.valueType._def,S(c({},t),{currentPath:[...t.currentPath,"items"]}))};return e.minSize&&(a.minItems=e.minSize.value),e.maxSize&&(a.maxItems=e.maxSize.value),a}function Da(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,a)=>R(n._def,S(c({},t),{currentPath:[...t.currentPath,"items",`${a}`]}))).reduce((n,a)=>a===void 0?n:[...n,a],[]),additionalItems:R(e.rest._def,S(c({},t),{currentPath:[...t.currentPath,"additionalItems"]}))}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,a)=>R(n._def,S(c({},t),{currentPath:[...t.currentPath,"items",`${a}`]}))).reduce((n,a)=>a===void 0?n:[...n,a],[])}}function ja(){return{not:W()}}function Ma(){return W()}var Na=(e,t)=>R(e.innerType._def,t),Za=(e,t,n)=>{switch(t){case O.ZodString:return sn(e,n);case O.ZodNumber:return Pa(e);case O.ZodObject:return Sa(e,n);case O.ZodBigInt:return ia(e);case O.ZodBoolean:return la();case O.ZodDate:return on(e,n);case O.ZodUndefined:return ja();case O.ZodNull:return wa();case O.ZodArray:return sa(e,n);case O.ZodUnion:case O.ZodDiscriminatedUnion:return xa(e,n);case O.ZodIntersection:return ma(e,n);case O.ZodTuple:return Da(e,n);case O.ZodRecord:return ln(e,n);case O.ZodLiteral:return ha(e);case O.ZodEnum:return fa(e);case O.ZodNativeEnum:return ba(e);case O.ZodNullable:return Ta(e,n);case O.ZodOptional:return Ra(e,n);case O.ZodMap:return ya(e,n);case O.ZodSet:return Ca(e,n);case O.ZodLazy:return()=>e.getter()._def;case O.ZodPromise:return $a(e,n);case O.ZodNaN:case O.ZodNever:return ka();case O.ZodEffects:return da(e,n);case O.ZodAny:return W();case O.ZodUnknown:return Ma();case O.ZodDefault:return pa(e,n);case O.ZodBranded:return rn(e,n);case O.ZodReadonly:return Na(e,n);case O.ZodCatch:return ua(e,n);case O.ZodPipeline:return Ea(e,n);case O.ZodFunction:case O.ZodVoid:case O.ZodSymbol:return;default:return(a=>{})()}},La=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")};function R(e,t,n=!1){var a;const r=t.seen.get(e);if(t.override){const l=(a=t.override)==null?void 0:a.call(t,e,t,r,n);if(l!==ra)return l}if(r&&!n){const l=Ua(r,t);if(l!==void 0)return l}const o={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,o);const s=Za(e,e.typeName,t),i=typeof s=="function"?R(s(),t):s;if(i&&qa(e,t,i),t.postProcess){const l=t.postProcess(i,e,t);return o.jsonSchema=i,l}return o.jsonSchema=i,i}var Ua=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:La(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((n,a)=>t.currentPath[a]===n)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),W()):t.$refStrategy==="seen"?W():void 0}},qa=(e,t,n)=>(e.description&&(n.description=e.description),n),Ba=e=>{const t=oa(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return S(c({},t),{currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([a,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,a],jsonSchema:void 0}]))})},Fa=(e,t)=>{var n;const a=Ba(t);let r=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((u,[b,v])=>{var g;return S(c({},u),{[b]:(g=R(v._def,S(c({},a),{currentPath:[...a.basePath,a.definitionPath,b]}),!0))!=null?g:W()})},{}):void 0;const o=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,s=(n=R(e._def,o===void 0?a:S(c({},a),{currentPath:[...a.basePath,a.definitionPath,o]}),!1))!=null?n:W(),i=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;i!==void 0&&(s.title=i);const l=o===void 0?r?S(c({},s),{[a.definitionPath]:r}):s:{$ref:[...a.$refStrategy==="relative"?[]:a.basePath,a.definitionPath,o].join("/"),[a.definitionPath]:S(c({},r),{[o]:s})};return l.$schema="http://json-schema.org/draft-07/schema#",l},Fe=Symbol.for("vercel.ai.schema");function Ee(e,{validate:t}={}){return{[Fe]:!0,_type:void 0,get jsonSchema(){return typeof e=="function"&&(e=e()),e},validate:t}}function za(e){return typeof e=="object"&&e!==null&&Fe in e&&e[Fe]===!0&&"jsonSchema"in e&&"validate"in e}function Va(e){return e==null?Ee({properties:{},additionalProperties:!1}):za(e)?e:"~standard"in e?e["~standard"].vendor==="zod"?Ga(e):Ha(e):e()}function Ha(e){return Ee(()=>e["~standard"].jsonSchema.input({target:"draft-07"}),{validate:async t=>{const n=await e["~standard"].validate(t);return"value"in n?{success:!0,value:n.value}:{success:!1,error:new ye({value:t,cause:n.issues})}}})}function Ja(e,t){var n;const a=(n=void 0)!=null?n:!1;return Ee(()=>Fa(e,{$refStrategy:a?"root":"none"}),{validate:async r=>{const o=await e.safeParseAsync(r);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}}})}function Ka(e,t){var n;const a=(n=void 0)!=null?n:!1;return Ee(()=>xe(xn(e,{target:"draft-7",io:"input",reused:a?"ref":"inline"})),{validate:async r=>{const o=await kn(e,r);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}}})}function Wa(e){return"_zod"in e}function Ga(e,t){return Wa(e)?Ka(e):Ja(e)}async function Xa({value:e,schema:t}){const n=await un({value:e,schema:t});if(!n.success)throw ye.wrap({value:e,cause:n.error});return n.value}async function un({value:e,schema:t}){const n=Va(t);try{if(n.validate==null)return{success:!0,value:e,rawValue:e};const a=await n.validate(e);return a.success?{success:!0,value:a.value,rawValue:e}:{success:!1,error:ye.wrap({value:e,cause:a.error}),rawValue:e}}catch(a){return{success:!1,error:ye.wrap({value:e,cause:a}),rawValue:e}}}async function Ya({text:e,schema:t}){try{const n=He(e);return t==null?n:Xa({value:n,schema:t})}catch(n){throw Se.isInstance(n)||ye.isInstance(n)?n:new Se({text:e,cause:n})}}async function cn({text:e,schema:t}){try{const n=He(e);return t==null?{success:!0,value:n,rawValue:n}:await un({value:n,schema:t})}catch(n){return{success:!1,error:Se.isInstance(n)?n:new Se({text:e,cause:n}),rawValue:void 0}}}function Ne(e){try{return He(e),!0}catch{return!1}}function Qa({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new Vn).pipeThrough(new TransformStream({async transform({data:n},a){n!=="[DONE]"&&a.enqueue(await cn({text:n,schema:t}))}}))}var er=()=>globalThis.fetch,he=async({url:e,headers:t,body:n,failedResponseHandler:a,successfulResponseHandler:r,abortSignal:o,fetch:s})=>tr({url:e,headers:c({"Content-Type":"application/json"},t),body:{content:JSON.stringify(n),values:n},failedResponseHandler:a,successfulResponseHandler:r,abortSignal:o,fetch:s}),tr=async({url:e,headers:t={},body:n,successfulResponseHandler:a,failedResponseHandler:r,abortSignal:o,fetch:s=er()})=>{try{const i=await s(e,{method:"POST",headers:Qn(t,`ai-sdk/provider-utils/${ea}`,Xn()),body:n.content,signal:o}),l=Re(i);if(!i.ok){let u;try{u=await r({response:i,url:e,requestBodyValues:n.values})}catch(b){throw qe(b)||ee.isInstance(b)?b:new ee({message:"Failed to process error response",cause:b,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:n.values})}throw u.value}try{return await a({response:i,url:e,requestBodyValues:n.values})}catch(u){throw u instanceof Error&&(qe(u)||ee.isInstance(u))?u:new ee({message:"Failed to process successful response",cause:u,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:n.values})}}catch(i){throw Gn({error:i,url:e,requestBodyValues:n.values})}},nr=({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:a,url:r,requestBodyValues:o})=>{const s=await a.text(),i=Re(a);if(s.trim()==="")return{responseHeaders:i,value:new ee({message:a.statusText,url:r,requestBodyValues:o,statusCode:a.status,responseHeaders:i,responseBody:s,isRetryable:n?.(a)})};try{const l=await Ya({text:s,schema:e});return{responseHeaders:i,value:new ee({message:t(l),url:r,requestBodyValues:o,statusCode:a.status,responseHeaders:i,responseBody:s,data:l,isRetryable:n?.(a,l)})}}catch{return{responseHeaders:i,value:new ee({message:a.statusText,url:r,requestBodyValues:o,statusCode:a.status,responseHeaders:i,responseBody:s,isRetryable:n?.(a)})}}},pn=e=>async({response:t})=>{const n=Re(t);if(t.body==null)throw new Cn({});return{responseHeaders:n,value:Qa({stream:t.body,schema:e})}},$e=e=>async({response:t,url:n,requestBodyValues:a})=>{const r=await t.text(),o=await cn({text:r,schema:e}),s=Re(t);if(!o.success)throw new ee({message:"Invalid JSON response",cause:o.error,statusCode:t.status,responseHeaders:s,responseBody:r,url:n,requestBodyValues:a});return{responseHeaders:s,value:o.value,rawValue:o.rawValue}};function dn(e){return e?.replace(/\/$/,"")}function Ze(e){return e!=null}var fn=(e=>(e.Unknown="unknown",e.OpenAIResponsesV1="openai-responses-v1",e.XAIResponsesV1="xai-responses-v1",e.AnthropicClaudeV1="anthropic-claude-v1",e.GoogleGeminiV1="google-gemini-v1",e))(fn||{}),Je=p({id:d().nullish(),format:At(fn).nullish(),index:y().optional()}).loose(),ar=p({type:L("reasoning.summary"),summary:d()}).extend(Je.shape),rr=p({type:L("reasoning.encrypted"),data:d()}).extend(Je.shape),or=p({type:L("reasoning.text"),text:d().nullish(),signature:d().nullish()}).extend(Je.shape),Ke=te([ar,rr,or]),Oe=te([Ke,It().transform(()=>null)]),We=I(Oe).transform(e=>e.filter(t=>!!t));te([p({delta:p({reasoning_details:I(Oe)})}).transform(e=>e.delta.reasoning_details.filter(Ze)),p({message:p({reasoning_details:I(Oe)})}).transform(e=>e.message.reasoning_details.filter(Ze)),p({text:d(),reasoning_details:I(Oe)}).transform(e=>e.reasoning_details.filter(Ze))]);var Ce=p({error:p({code:te([d(),y()]).nullable().optional().default(null),message:d(),type:d().nullable().optional().default(null),param:oe().nullable().optional().default(null)}).passthrough()}).passthrough(),ve=nr({errorSchema:Ce,errorToMessage:e=>e.error.message}),gn=p({type:L("file"),file:p({hash:d(),name:d(),content:I(p({type:d(),text:d().optional()}).catchall(oe())).optional()}).catchall(oe())}).catchall(oe()),Ge=p({provider:d(),reasoning_details:I(Ke).optional(),annotations:I(gn).optional(),usage:p({promptTokens:y(),promptTokensDetails:p({cachedTokens:y()}).catchall(oe()).optional(),completionTokens:y(),completionTokensDetails:p({reasoningTokens:y()}).catchall(oe()).optional(),totalTokens:y(),cost:y().optional(),costDetails:p({upstreamInferenceCost:y()}).catchall(oe()).optional()}).catchall(oe())}).catchall(oe()),mn=p({openrouter:p({reasoning_details:I(Ke).optional(),annotations:I(gn).optional()}).optional()}).optional();function sr(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}function Ae(e){return{unified:sr(e),raw:e??void 0}}function pe(e,t){return{unified:e,raw:t}}var Te,ir=class{constructor(){In(this,Te,new Set)}upsert(e){const t=this.getCanonicalKey(e);return t===null||Qe(this,Te).has(t)?!1:(Qe(this,Te).add(t),!0)}getCanonicalKey(e){switch(e.type){case"reasoning.summary":return e.summary;case"reasoning.encrypted":return e.id?e.id:e.data;case"reasoning.text":return e.text?e.text:e.signature?e.signature:null;default:return null}}};Te=new WeakMap;var lr=["wav","mp3","aiff","aac","ogg","flac","m4a","pcm16","pcm24"];function Xe({url:e,protocols:t}){try{const n=new URL(e);return t.has(n.protocol)}catch{return!1}}function ze({part:e,defaultMediaType:t}){var n,a;if(e.data instanceof Uint8Array){const o=Jn(e.data);return`data:${(n=e.mediaType)!=null?n:t};base64,${o}`}const r=e.data.toString();return Xe({url:r,protocols:new Set(["http:","https:"])})||r.startsWith("data:")?r:`data:${(a=e.mediaType)!=null?a:t};base64,${r}`}function Pt(e,t){var n;const a=e.match(/^data:([^;]+)/);return a&&(n=a[1])!=null?n:t}function Ie(e){const t=e.match(/^data:[^;]*;base64,(.+)$/);return t?t[1]:e}var ur={mpeg:"mp3",mp3:"mp3","x-wav":"wav",wave:"wav",wav:"wav",ogg:"ogg",vorbis:"ogg",aac:"aac","x-aac":"aac",m4a:"m4a","x-m4a":"m4a",mp4:"m4a",aiff:"aiff","x-aiff":"aiff",flac:"flac","x-flac":"flac",pcm16:"pcm16",pcm24:"pcm24"};function cr(e){const t=ze({part:e,defaultMediaType:"audio/mpeg"});if(Xe({url:t,protocols:new Set(["http:","https:"])}))throw new Error(`Audio files cannot be provided as URLs.

OpenRouter requires audio to be base64-encoded. Please:
1. Download the audio file locally
2. Read it as a Buffer or Uint8Array
3. Pass it as the data parameter

The AI SDK will automatically handle base64 encoding.

Learn more: https://openrouter.ai/docs/features/multimodal/audio`);const n=Ie(t),a=e.mediaType||"audio/mpeg",r=a.replace("audio/",""),o=ur[r];if(o===void 0){const s=lr.join(", ");throw new Error(`Unsupported audio format: "${a}"

OpenRouter supports the following audio formats: ${s}

Learn more: https://openrouter.ai/docs/features/multimodal/audio`)}return{data:n,format:o}}function ce(e){var t,n,a;const r=e?.anthropic,o=e?.openrouter;return(a=(n=(t=o?.cacheControl)!=null?t:o?.cache_control)!=null?n:r?.cacheControl)!=null?a:r?.cache_control}function pr(e){var t,n,a,r,o,s,i,l;const u=[],b=new ir;for(const{role:v,content:g,providerOptions:_}of e)switch(v){case"system":{u.push({role:"system",content:g,cache_control:ce(_)});break}case"user":{if(g.length===1&&((t=g[0])==null?void 0:t.type)==="text"){const h=(n=ce(_))!=null?n:ce(g[0].providerOptions),A=h?[{type:"text",text:g[0].text,cache_control:h}]:g[0].text;u.push({role:"user",content:A});break}const w=ce(_);let m=-1;for(let h=g.length-1;h>=0;h--)if(((a=g[h])==null?void 0:a.type)==="text"){m=h;break}const f=g.map((h,A)=>{var $,B,M,k,z,K;const V=h.type==="text"&&A===m,N=ce(h.providerOptions),q=h.type==="text"?N??(V?w:void 0):N;switch(h.type){case"text":return c({type:"text",text:h.text},q&&{cache_control:q});case"file":{if(($=h.mediaType)!=null&&$.startsWith("image/")){const ie=ze({part:h,defaultMediaType:"image/jpeg"});return c({type:"image_url",image_url:{url:ie}},q&&{cache_control:q})}if((B=h.mediaType)!=null&&B.startsWith("audio/"))return c({type:"input_audio",input_audio:cr(h)},q&&{cache_control:q});const G=String((K=(z=(k=(M=h.providerOptions)==null?void 0:M.openrouter)==null?void 0:k.filename)!=null?z:h.filename)!=null?K:""),se=ze({part:h,defaultMediaType:"application/pdf"});return Xe({url:se,protocols:new Set(["http:","https:"])})?{type:"file",file:{filename:G,file_data:se}}:c({type:"file",file:{filename:G,file_data:se}},q&&{cache_control:q})}default:return c({type:"text",text:""},q&&{cache_control:q})}});u.push({role:"user",content:f});break}case"assistant":{let w="",m="";const f=[];for(const k of g)switch(k.type){case"text":{w+=k.text;break}case"tool-call":{f.push({id:k.toolCallId,type:"function",function:{name:k.toolName,arguments:JSON.stringify(k.input)}});break}case"reasoning":{m+=k.text;break}}const h=mn.safeParse(_),A=h.success?(o=(r=h.data)==null?void 0:r.openrouter)==null?void 0:o.reasoning_details:void 0,$=h.success?(i=(s=h.data)==null?void 0:s.openrouter)==null?void 0:i.annotations:void 0,B=A&&Array.isArray(A)&&A.length>0?A:fr(g);let M;if(B&&B.length>0){const k=[];for(const z of B)b.upsert(z)&&k.push(z);M=k.length>0?k:void 0}u.push({role:"assistant",content:w,tool_calls:f.length>0?f:void 0,reasoning:m||void 0,reasoning_details:M,annotations:$,cache_control:ce(_)});break}case"tool":{for(const w of g){if(w.type==="tool-approval-response")continue;const m=dr(w);u.push({role:"tool",tool_call_id:w.toolCallId,content:m,cache_control:(l=ce(_))!=null?l:ce(w.providerOptions)})}break}}return u}function dr(e){var t;switch(e.output.type){case"text":case"error-text":return e.output.value;case"json":case"error-json":case"content":return JSON.stringify(e.output.value);case"execution-denied":return(t=e.output.reason)!=null?t:"Tool execution denied"}}function fr(e){var t,n,a;for(const r of e)if(r.type==="tool-call"){const o=(t=r.providerOptions)==null?void 0:t.openrouter,s=o?.reasoning_details;if(Array.isArray(s)&&s.length>0)return s}for(const r of e)if(r.type==="reasoning"){const o=mn.safeParse(r.providerOptions);if(o.success&&((a=(n=o.data)==null?void 0:n.openrouter)!=null&&a.reasoning_details)&&o.data.openrouter.reasoning_details.length>0)return o.data.openrouter.reasoning_details}}te([L("auto"),L("none"),L("required"),p({type:L("function"),function:p({name:d()})})]);function gr(e){switch(e.type){case"auto":case"none":case"required":return e.type;case"tool":return{type:"function",function:{name:e.toolName}};default:throw new Bt({argument:"toolChoice",message:`Invalid tool choice type: ${JSON.stringify(e)}`})}}var mr=p({type:L("image_url"),image_url:p({url:d()}).passthrough()}).passthrough(),hr=te([mr,It().transform(()=>null)]),hn=I(hr).transform(e=>e.filter(t=>!!t)),vn=p({id:d().optional(),model:d().optional(),provider:d().optional(),usage:p({prompt_tokens:y(),prompt_tokens_details:p({cached_tokens:y()}).passthrough().nullish(),completion_tokens:y(),completion_tokens_details:p({reasoning_tokens:y()}).passthrough().nullish(),total_tokens:y(),cost:y().optional(),cost_details:p({upstream_inference_cost:y().nullish()}).passthrough().nullish()}).passthrough().nullish()}).passthrough(),vr=te([vn.extend({choices:I(p({message:p({role:L("assistant"),content:d().nullable().optional(),reasoning:d().nullable().optional(),reasoning_details:We.nullish(),images:hn.nullish(),tool_calls:I(p({id:d().optional().nullable(),type:L("function"),function:p({name:d(),arguments:d().optional()}).passthrough()}).passthrough()).optional(),annotations:I(te([p({type:L("url_citation"),url_citation:p({url:d(),title:d().optional(),start_index:y().optional(),end_index:y().optional(),content:d().optional()}).passthrough()}).passthrough(),p({type:L("file_annotation"),file_annotation:p({file_id:d(),quote:d().optional()}).passthrough()}).passthrough(),p({type:L("file"),file:p({hash:d(),name:d(),content:I(p({type:d(),text:d().optional()}).passthrough()).optional()}).passthrough()}).passthrough()])).nullish()}).passthrough(),index:y().nullish(),logprobs:p({content:I(p({token:d(),logprob:y(),top_logprobs:I(p({token:d(),logprob:y()}).passthrough())}).passthrough()).nullable()}).passthrough().nullable().optional(),finish_reason:d().optional().nullable()}).passthrough())}),Ce.extend({user_id:d().optional()})]),_r=te([vn.extend({choices:I(p({delta:p({role:At(["assistant"]).optional(),content:d().nullish(),reasoning:d().nullish().optional(),reasoning_details:We.nullish(),images:hn.nullish(),tool_calls:I(p({index:y().nullish(),id:d().nullish(),type:L("function").optional(),function:p({name:d().nullish(),arguments:d().nullish()}).passthrough()}).passthrough()).nullish(),annotations:I(te([p({type:L("url_citation"),url_citation:p({url:d(),title:d().optional(),start_index:y().optional(),end_index:y().optional(),content:d().optional()}).passthrough()}).passthrough(),p({type:L("file_annotation"),file_annotation:p({file_id:d(),quote:d().optional()}).passthrough()}).passthrough(),p({type:L("file"),file:p({hash:d(),name:d(),content:I(p({type:d(),text:d().optional()}).passthrough()).optional()}).passthrough()}).passthrough()])).nullish()}).passthrough().nullish(),logprobs:p({content:I(p({token:d(),logprob:y(),top_logprobs:I(p({token:d(),logprob:y()}).passthrough())}).passthrough()).nullable()}).passthrough().nullish(),finish_reason:d().nullable().optional(),index:y().nullish()}).passthrough())}),Ce]),_n=class{constructor(e,t,n){this.specificationVersion="v3",this.provider="openrouter",this.defaultObjectGenerationMode="tool",this.supportsImageUrls=!0,this.supportedUrls={"image/*":[/^data:image\/[a-zA-Z]+;base64,/,/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i],"application/*":[/^data:application\//,/^https?:\/\/.+$/]},this.modelId=e,this.settings=t,this.config=n}getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:a,frequencyPenalty:r,presencePenalty:o,seed:s,stopSequences:i,responseFormat:l,topK:u,tools:b,toolChoice:v}){var g;const _=c(c({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===!0||typeof this.settings.logprobs=="number"?!0:void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:t,temperature:n,top_p:a,frequency_penalty:r,presence_penalty:o,seed:s,stop:i,response_format:l?.type==="json"?l.schema!=null?{type:"json_schema",json_schema:c({schema:l.schema,strict:!0,name:(g=l.name)!=null?g:"response"},l.description&&{description:l.description})}:{type:"json_object"}:void 0,top_k:u,messages:pr(e),include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning,usage:this.settings.usage,plugins:this.settings.plugins,web_search_options:this.settings.web_search_options,provider:this.settings.provider,debug:this.settings.debug},this.config.extraBody),this.settings.extraBody);if(b&&b.length>0){const w=b.filter(m=>m.type==="function").map(m=>({type:"function",function:{name:m.name,description:m.description,parameters:m.inputSchema}}));return S(c({},_),{tools:w,tool_choice:v?gr(v):void 0})}return _}async doGenerate(e){var t,n,a,r,o,s,i,l,u,b,v,g,_,w,m,f,h,A,$,B,M,k,z,K,V,N,q,G;const ie=(e.providerOptions||{}).openrouter||{},ae=c(c({},this.getArgs(e)),ie),{value:E,responseHeaders:le}=await he({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:me(this.config.headers(),e.headers),body:ae,failedResponseHandler:ve,successfulResponseHandler:$e(vr),abortSignal:e.abortSignal,fetch:this.config.fetch});if("error"in E){const T=E.error;throw new ee({message:T.message,url:this.config.url({path:"/chat/completions",modelId:this.modelId}),requestBodyValues:ae,statusCode:200,responseHeaders:le,data:T})}const D=E,j=D.choices[0];if(!j)throw new Ve({message:"No choice in response"});const ue=D.usage?{inputTokens:{total:(t=D.usage.prompt_tokens)!=null?t:0,noCache:void 0,cacheRead:(a=(n=D.usage.prompt_tokens_details)==null?void 0:n.cached_tokens)!=null?a:void 0,cacheWrite:void 0},outputTokens:{total:(r=D.usage.completion_tokens)!=null?r:0,text:void 0,reasoning:(s=(o=D.usage.completion_tokens_details)==null?void 0:o.reasoning_tokens)!=null?s:void 0},raw:D.usage}:{inputTokens:{total:0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:0,text:void 0,reasoning:void 0},raw:void 0},de=(i=j.message.reasoning_details)!=null?i:[],be=de.length>0?de.map(T=>{switch(T.type){case"reasoning.text":{if(T.text)return{type:"reasoning",text:T.text,providerMetadata:{openrouter:{reasoning_details:[T]}}};break}case"reasoning.summary":{if(T.summary)return{type:"reasoning",text:T.summary,providerMetadata:{openrouter:{reasoning_details:[T]}}};break}case"reasoning.encrypted":{if(T.data)return{type:"reasoning",text:"[REDACTED]",providerMetadata:{openrouter:{reasoning_details:[T]}}};break}}return null}).filter(T=>T!==null):j.message.reasoning?[{type:"reasoning",text:j.message.reasoning}]:[],re=[];if(re.push(...be),j.message.content&&re.push({type:"text",text:j.message.content}),j.message.tool_calls){let T=!1;for(const x of j.message.tool_calls)re.push({type:"tool-call",toolCallId:(l=x.id)!=null?l:Q(),toolName:x.function.name,input:(u=x.function.arguments)!=null?u:"{}",providerMetadata:T?void 0:{openrouter:{reasoning_details:de}}}),T=!0}if(j.message.images)for(const T of j.message.images)re.push({type:"file",mediaType:Pt(T.image_url.url,"image/jpeg"),data:Ie(T.image_url.url)});if(j.message.annotations)for(const T of j.message.annotations)T.type==="url_citation"&&re.push({type:"source",sourceType:"url",id:T.url_citation.url,url:T.url_citation.url,title:(b=T.url_citation.title)!=null?b:"",providerMetadata:{openrouter:{content:(v=T.url_citation.content)!=null?v:"",startIndex:(g=T.url_citation.start_index)!=null?g:0,endIndex:(_=T.url_citation.end_index)!=null?_:0}}});const ge=(w=j.message.annotations)==null?void 0:w.filter(T=>T.type==="file"),ke=j.message.tool_calls&&j.message.tool_calls.length>0,C=de.some(T=>T.type==="reasoning.encrypted"&&T.data),F=ke&&C&&j.finish_reason==="stop"?pe("tool-calls",(m=j.finish_reason)!=null?m:void 0):Ae(j.finish_reason);return{content:re,finishReason:F,usage:ue,warnings:[],providerMetadata:{openrouter:Ge.parse({provider:(f=D.provider)!=null?f:"",reasoning_details:(h=j.message.reasoning_details)!=null?h:[],annotations:ge&&ge.length>0?ge:void 0,usage:c(c(c(c({promptTokens:(A=ue.inputTokens.total)!=null?A:0,completionTokens:($=ue.outputTokens.total)!=null?$:0,totalTokens:((B=ue.inputTokens.total)!=null?B:0)+((M=ue.outputTokens.total)!=null?M:0)},((k=D.usage)==null?void 0:k.cost)!=null?{cost:D.usage.cost}:{}),((K=(z=D.usage)==null?void 0:z.prompt_tokens_details)==null?void 0:K.cached_tokens)!=null?{promptTokensDetails:{cachedTokens:D.usage.prompt_tokens_details.cached_tokens}}:{}),((N=(V=D.usage)==null?void 0:V.completion_tokens_details)==null?void 0:N.reasoning_tokens)!=null?{completionTokensDetails:{reasoningTokens:D.usage.completion_tokens_details.reasoning_tokens}}:{}),((G=(q=D.usage)==null?void 0:q.cost_details)==null?void 0:G.upstream_inference_cost)!=null?{costDetails:{upstreamInferenceCost:D.usage.cost_details.upstream_inference_cost}}:{})})},request:{body:ae},response:{id:D.id,modelId:D.model,headers:le}}}async doStream(e){var t;const a=(e.providerOptions||{}).openrouter||{},r=c(c({},this.getArgs(e)),a),{value:o,responseHeaders:s}=await he({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:me(this.config.headers(),e.headers),body:S(c({},r),{stream:!0,stream_options:this.config.compatibility==="strict"?c({include_usage:!0},(t=this.settings.usage)!=null&&t.include?{include_usage:!0}:{}):void 0}),failedResponseHandler:ve,successfulResponseHandler:pn(_r),abortSignal:e.abortSignal,fetch:this.config.fetch}),i=[];let l=pe("other");const u={inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0},b={};let v;const g=[];let _=!1;const w=[];let m=!1,f=!1,h,A,$,B;return{stream:o.pipeThrough(new TransformStream({transform(M,k){var z,K,V,N,q,G,se,ie,ae,E,le,D,j,ue,de,be,re,ge,ke;if(e.includeRawChunks&&k.enqueue({type:"raw",rawValue:M.rawValue}),!M.success){l=pe("error"),k.enqueue({type:"error",error:M.error});return}const C=M.value;if("error"in C){l=pe("error"),k.enqueue({type:"error",error:C.error});return}if(C.provider&&(B=C.provider),C.id&&($=C.id,k.enqueue({type:"response-metadata",id:C.id})),C.model&&k.enqueue({type:"response-metadata",modelId:C.model}),C.usage!=null){if(u.inputTokens.total=C.usage.prompt_tokens,u.outputTokens.total=C.usage.completion_tokens,v=C.usage,b.promptTokens=C.usage.prompt_tokens,C.usage.prompt_tokens_details){const P=(z=C.usage.prompt_tokens_details.cached_tokens)!=null?z:0;u.inputTokens.cacheRead=P,b.promptTokensDetails={cachedTokens:P}}if(b.completionTokens=C.usage.completion_tokens,C.usage.completion_tokens_details){const P=(K=C.usage.completion_tokens_details.reasoning_tokens)!=null?K:0;u.outputTokens.reasoning=P,b.completionTokensDetails={reasoningTokens:P}}C.usage.cost!=null&&(b.cost=C.usage.cost),b.totalTokens=C.usage.total_tokens;const x=(V=C.usage.cost_details)==null?void 0:V.upstream_inference_cost;x!=null&&(b.costDetails={upstreamInferenceCost:x})}const fe=C.choices[0];if(fe?.finish_reason!=null&&(l=Ae(fe.finish_reason)),fe?.delta==null)return;const F=fe.delta,T=(x,P)=>{f||(A=$||Q(),k.enqueue({providerMetadata:P,type:"reasoning-start",id:A}),f=!0),k.enqueue({providerMetadata:P,type:"reasoning-delta",delta:x,id:A||Q()})};if(F.reasoning_details&&F.reasoning_details.length>0){for(const P of F.reasoning_details)if(P.type==="reasoning.text"){const Z=g[g.length-1];Z?.type==="reasoning.text"?(Z.text=(Z.text||"")+(P.text||""),Z.signature=Z.signature||P.signature,Z.format=Z.format||P.format):g.push(c({},P))}else g.push(P);const x={openrouter:{reasoning_details:F.reasoning_details}};for(const P of F.reasoning_details)switch(P.type){case"reasoning.text":{P.text&&T(P.text,x);break}case"reasoning.encrypted":{P.data&&T("[REDACTED]",x);break}case"reasoning.summary":{P.summary&&T(P.summary,x);break}}}else F.reasoning&&T(F.reasoning);if(F.content&&(f&&!m&&(k.enqueue({type:"reasoning-end",id:A||Q()}),f=!1),m||(h=$||Q(),k.enqueue({type:"text-start",id:h}),m=!0),k.enqueue({type:"text-delta",delta:F.content,id:h||Q()})),F.annotations){for(const x of F.annotations)if(x.type==="url_citation")k.enqueue({type:"source",sourceType:"url",id:x.url_citation.url,url:x.url_citation.url,title:(N=x.url_citation.title)!=null?N:"",providerMetadata:{openrouter:{content:(q=x.url_citation.content)!=null?q:"",startIndex:(G=x.url_citation.start_index)!=null?G:0,endIndex:(se=x.url_citation.end_index)!=null?se:0}}});else if(x.type==="file"){const P=x.file;P&&typeof P=="object"&&"hash"in P&&"name"in P&&w.push(x)}}if(F.tool_calls!=null)for(const x of F.tool_calls){const P=(ie=x.index)!=null?ie:i.length-1;if(i[P]==null){if(x.type!=="function")throw new _e({data:x,message:"Expected 'function' type."});if(x.id==null)throw new _e({data:x,message:"Expected 'id' to be a string."});if(((ae=x.function)==null?void 0:ae.name)==null)throw new _e({data:x,message:"Expected 'function.name' to be a string."});i[P]={id:x.id,type:"function",function:{name:x.function.name,arguments:(E=x.function.arguments)!=null?E:""},inputStarted:!1,sent:!1};const J=i[P];if(J==null)throw new _e({data:{index:P,toolCallsLength:i.length},message:`Tool call at index ${P} is missing after creation.`});((le=J.function)==null?void 0:le.name)!=null&&((D=J.function)==null?void 0:D.arguments)!=null&&Ne(J.function.arguments)&&(J.inputStarted=!0,k.enqueue({type:"tool-input-start",id:J.id,toolName:J.function.name}),k.enqueue({type:"tool-input-delta",id:J.id,delta:J.function.arguments}),k.enqueue({type:"tool-input-end",id:J.id}),k.enqueue({type:"tool-call",toolCallId:J.id,toolName:J.function.name,input:J.function.arguments,providerMetadata:_?void 0:{openrouter:{reasoning_details:g}}}),_=!0,J.sent=!0);continue}const Z=i[P];if(Z==null)throw new _e({data:{index:P,toolCallsLength:i.length,toolCallDelta:x},message:`Tool call at index ${P} is missing during merge.`});Z.inputStarted||(Z.inputStarted=!0,k.enqueue({type:"tool-input-start",id:Z.id,toolName:Z.function.name})),((j=x.function)==null?void 0:j.arguments)!=null&&(Z.function.arguments+=(de=(ue=x.function)==null?void 0:ue.arguments)!=null?de:""),k.enqueue({type:"tool-input-delta",id:Z.id,delta:(be=x.function.arguments)!=null?be:""}),((re=Z.function)==null?void 0:re.name)!=null&&((ge=Z.function)==null?void 0:ge.arguments)!=null&&Ne(Z.function.arguments)&&(k.enqueue({type:"tool-call",toolCallId:(ke=Z.id)!=null?ke:Q(),toolName:Z.function.name,input:Z.function.arguments,providerMetadata:_?void 0:{openrouter:{reasoning_details:g}}}),_=!0,Z.sent=!0)}if(F.images!=null)for(const x of F.images)k.enqueue({type:"file",mediaType:Pt(x.image_url.url,"image/jpeg"),data:Ie(x.image_url.url)})},flush(M){var k;const z=i.length>0,K=g.some(N=>N.type==="reasoning.encrypted"&&N.data);if(z&&K&&l.unified==="stop"&&(l=pe("tool-calls",l.raw)),l.unified==="tool-calls")for(const N of i)N&&!N.sent&&(M.enqueue({type:"tool-call",toolCallId:(k=N.id)!=null?k:Q(),toolName:N.function.name,input:Ne(N.function.arguments)?N.function.arguments:"{}",providerMetadata:_?void 0:{openrouter:{reasoning_details:g}}}),_=!0,N.sent=!0);f&&M.enqueue({type:"reasoning-end",id:A||Q()}),m&&M.enqueue({type:"text-end",id:h||Q()});const V={usage:b};B!==void 0&&(V.provider=B),g.length>0&&(V.reasoning_details=g),w.length>0&&(V.annotations=w),u.raw=v,M.enqueue({type:"finish",finishReason:l,usage:u,providerMetadata:{openrouter:V}})}})),warnings:[],request:{body:r},response:{headers:s}}}};function yr({prompt:e,inputFormat:t,user:n="user",assistant:a="assistant"}){if(e.length===1&&e[0]&&e[0].role==="user"&&e[0].content.length===1&&e[0].content[0]&&e[0].content[0].type==="text")return{prompt:e[0].content[0].text};let r="";e[0]&&e[0].role==="system"&&(r+=`${e[0].content}

`,e=e.slice(1));for(const{role:o,content:s}of e)switch(o){case"system":throw new Mn({message:`Unexpected system message in prompt: ${s}`,prompt:e});case"user":{const i=s.map(l=>{switch(l.type){case"text":return l.text;case"file":throw new ne({functionality:"file attachments"});default:return""}}).join("");r+=`${n}:
${i}

`;break}case"assistant":{const i=s.map(l=>{switch(l.type){case"text":return l.text;case"tool-call":throw new ne({functionality:"tool-call messages"});case"tool-result":throw new ne({functionality:"tool-result messages"});case"reasoning":throw new ne({functionality:"reasoning messages"});case"file":throw new ne({functionality:"file attachments"});default:return""}}).join("");r+=`${a}:
${i}

`;break}case"tool":throw new ne({functionality:"tool messages"})}return r+=`${a}:
`,{prompt:r}}var St=te([p({id:d().optional(),model:d().optional(),provider:d().optional(),choices:I(p({text:d(),reasoning:d().nullish().optional(),reasoning_details:We.nullish(),finish_reason:d().nullish(),index:y().nullish(),logprobs:p({tokens:I(d()),token_logprobs:I(y()),top_logprobs:I(wn(d(),y())).nullable()}).passthrough().nullable().optional()}).passthrough()),usage:p({prompt_tokens:y(),prompt_tokens_details:p({cached_tokens:y()}).passthrough().nullish(),completion_tokens:y(),completion_tokens_details:p({reasoning_tokens:y()}).passthrough().nullish(),total_tokens:y(),cost:y().optional(),cost_details:p({upstream_inference_cost:y().nullish()}).passthrough().nullish()}).passthrough().nullish()}).passthrough(),Ce]),yn=class{constructor(e,t,n){this.specificationVersion="v3",this.provider="openrouter",this.supportsImageUrls=!0,this.supportedUrls={"image/*":[/^data:image\/[a-zA-Z]+;base64,/,/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i],"text/*":[/^data:text\//,/^https?:\/\/.+$/],"application/*":[/^data:application\//,/^https?:\/\/.+$/]},this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=n}getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:a,frequencyPenalty:r,presencePenalty:o,seed:s,responseFormat:i,topK:l,stopSequences:u,tools:b,toolChoice:v}){const{prompt:g}=yr({prompt:e,inputFormat:"prompt"});if(b?.length)throw new ne({functionality:"tools"});if(v)throw new ne({functionality:"toolChoice"});return c(c({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:t,temperature:n,top_p:a,frequency_penalty:r,presence_penalty:o,seed:s,stop:u,response_format:i,top_k:l,prompt:g,include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning},this.config.extraBody),this.settings.extraBody)}async doGenerate(e){var t,n,a,r,o,s,i,l,u,b,v,g,_,w,m,f,h,A,$,B,M,k,z,K,V,N,q,G;const ie=(e.providerOptions||{}).openrouter||{},ae=c(c({},this.getArgs(e)),ie),{value:E,responseHeaders:le}=await he({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:me(this.config.headers(),e.headers),body:ae,failedResponseHandler:ve,successfulResponseHandler:$e(St),abortSignal:e.abortSignal,fetch:this.config.fetch});if("error"in E){const j=E.error;throw new ee({message:j.message,url:this.config.url({path:"/completions",modelId:this.modelId}),requestBodyValues:ae,statusCode:200,responseHeaders:le,data:j})}const D=E.choices[0];if(!D)throw new Ve({message:"No choice in OpenRouter completion response"});return{content:[{type:"text",text:(t=D.text)!=null?t:""}],finishReason:Ae(D.finish_reason),usage:{inputTokens:{total:(a=(n=E.usage)==null?void 0:n.prompt_tokens)!=null?a:0,noCache:void 0,cacheRead:(s=(o=(r=E.usage)==null?void 0:r.prompt_tokens_details)==null?void 0:o.cached_tokens)!=null?s:void 0,cacheWrite:void 0},outputTokens:{total:(l=(i=E.usage)==null?void 0:i.completion_tokens)!=null?l:0,text:void 0,reasoning:(v=(b=(u=E.usage)==null?void 0:u.completion_tokens_details)==null?void 0:b.reasoning_tokens)!=null?v:void 0},raw:(g=E.usage)!=null?g:void 0},warnings:[],providerMetadata:{openrouter:Ge.parse({provider:(_=E.provider)!=null?_:"",usage:c(c(c(c({promptTokens:(m=(w=E.usage)==null?void 0:w.prompt_tokens)!=null?m:0,completionTokens:(h=(f=E.usage)==null?void 0:f.completion_tokens)!=null?h:0,totalTokens:(($=(A=E.usage)==null?void 0:A.prompt_tokens)!=null?$:0)+((M=(B=E.usage)==null?void 0:B.completion_tokens)!=null?M:0)},((k=E.usage)==null?void 0:k.cost)!=null?{cost:E.usage.cost}:{}),((K=(z=E.usage)==null?void 0:z.prompt_tokens_details)==null?void 0:K.cached_tokens)!=null?{promptTokensDetails:{cachedTokens:E.usage.prompt_tokens_details.cached_tokens}}:{}),((N=(V=E.usage)==null?void 0:V.completion_tokens_details)==null?void 0:N.reasoning_tokens)!=null?{completionTokensDetails:{reasoningTokens:E.usage.completion_tokens_details.reasoning_tokens}}:{}),((G=(q=E.usage)==null?void 0:q.cost_details)==null?void 0:G.upstream_inference_cost)!=null?{costDetails:{upstreamInferenceCost:E.usage.cost_details.upstream_inference_cost}}:{})})},response:{headers:le}}}async doStream(e){const n=(e.providerOptions||{}).openrouter||{},a=c(c({},this.getArgs(e)),n),{value:r,responseHeaders:o}=await he({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:me(this.config.headers(),e.headers),body:S(c({},a),{stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0}),failedResponseHandler:ve,successfulResponseHandler:pn(St),abortSignal:e.abortSignal,fetch:this.config.fetch});let s=pe("other");const i={inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0},l={};let u,b;return{stream:r.pipeThrough(new TransformStream({transform(v,g){var _,w,m;if(e.includeRawChunks&&g.enqueue({type:"raw",rawValue:v.rawValue}),!v.success){s=pe("error"),g.enqueue({type:"error",error:v.error});return}const f=v.value;if("error"in f){s=pe("error"),g.enqueue({type:"error",error:f.error});return}if(f.provider&&(u=f.provider),f.usage!=null){if(i.inputTokens.total=f.usage.prompt_tokens,i.outputTokens.total=f.usage.completion_tokens,b=f.usage,l.promptTokens=f.usage.prompt_tokens,f.usage.prompt_tokens_details){const $=(_=f.usage.prompt_tokens_details.cached_tokens)!=null?_:0;i.inputTokens.cacheRead=$,l.promptTokensDetails={cachedTokens:$}}if(l.completionTokens=f.usage.completion_tokens,f.usage.completion_tokens_details){const $=(w=f.usage.completion_tokens_details.reasoning_tokens)!=null?w:0;i.outputTokens.reasoning=$,l.completionTokensDetails={reasoningTokens:$}}f.usage.cost!=null&&(l.cost=f.usage.cost),l.totalTokens=f.usage.total_tokens;const A=(m=f.usage.cost_details)==null?void 0:m.upstream_inference_cost;A!=null&&(l.costDetails={upstreamInferenceCost:A})}const h=f.choices[0];h?.finish_reason!=null&&(s=Ae(h.finish_reason)),h?.text!=null&&g.enqueue({type:"text-delta",delta:h.text,id:Q()})},flush(v){i.raw=b;const g={usage:l};u!==void 0&&(g.provider=u),v.enqueue({type:"finish",finishReason:s,usage:i,providerMetadata:{openrouter:g}})}})),response:{headers:o}}}},br=p({prompt_tokens:y(),total_tokens:y(),cost:y().optional()}),kr=p({object:L("embedding"),embedding:I(y()),index:y().optional()}),wr=p({id:d().optional(),object:L("list"),data:I(kr),model:d(),provider:d().optional(),usage:br.optional()}),bn=class{constructor(e,t,n){this.specificationVersion="v3",this.provider="openrouter",this.maxEmbeddingsPerCall=void 0,this.supportsParallelCalls=!0,this.modelId=e,this.settings=t,this.config=n}async doEmbed(e){var t,n,a,r,o,s;const{values:i,abortSignal:l,headers:u}=e,b=c(c({model:this.modelId,input:i,user:this.settings.user,provider:this.settings.provider},this.config.extraBody),this.settings.extraBody),{value:v,responseHeaders:g}=await he({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:me(this.config.headers(),u),body:b,failedResponseHandler:ve,successfulResponseHandler:$e(wr),abortSignal:l,fetch:this.config.fetch});return{embeddings:v.data.map(_=>_.embedding),usage:v.usage?{tokens:v.usage.prompt_tokens}:void 0,providerMetadata:{openrouter:Ge.parse({provider:(t=v.provider)!=null?t:"",usage:c({promptTokens:(a=(n=v.usage)==null?void 0:n.prompt_tokens)!=null?a:0,completionTokens:0,totalTokens:(o=(r=v.usage)==null?void 0:r.total_tokens)!=null?o:0},((s=v.usage)==null?void 0:s.cost)!=null?{cost:v.usage.cost}:{})})},response:{headers:g,body:v},warnings:[]}}},Dr=class{constructor(e={}){var t,n;this.baseURL=(n=dn((t=e.baseURL)!=null?t:e.baseUrl))!=null?n:"https://openrouter.ai/api/v1",this.apiKey=e.apiKey,this.headers=e.headers,this.api_keys=e.api_keys}get baseConfig(){return{baseURL:this.baseURL,headers:()=>c(c({Authorization:`Bearer ${an({apiKey:this.apiKey,environmentVariableName:"OPENROUTER_API_KEY",description:"OpenRouter"})}`},this.headers),this.api_keys&&Object.keys(this.api_keys).length>0&&{"X-Provider-API-Keys":JSON.stringify(this.api_keys)})}}chat(e,t={}){return new _n(e,t,S(c({provider:"openrouter.chat"},this.baseConfig),{compatibility:"strict",url:({path:n})=>`${this.baseURL}${n}`}))}completion(e,t={}){return new yn(e,t,S(c({provider:"openrouter.completion"},this.baseConfig),{compatibility:"strict",url:({path:n})=>`${this.baseURL}${n}`}))}textEmbeddingModel(e,t={}){return new bn(e,t,S(c({provider:"openrouter.embedding"},this.baseConfig),{url:({path:n})=>`${this.baseURL}${n}`}))}embedding(e,t={}){return this.textEmbeddingModel(e,t)}},xr=p({id:d().optional(),object:d().optional(),created:y().optional(),model:d(),choices:I(p({index:y(),message:p({role:d(),content:d().nullable().optional(),images:I(p({type:L("image_url"),image_url:p({url:d()})}).passthrough()).optional()}).passthrough(),finish_reason:d().nullable().optional()}).passthrough()),usage:p({prompt_tokens:y(),completion_tokens:y(),total_tokens:y()}).passthrough().optional()}).passthrough(),Or=class{constructor(e,t,n){this.specificationVersion="v3",this.provider="openrouter",this.maxImagesPerCall=1,this.modelId=e,this.settings=t,this.config=n}async doGenerate(e){var t;const{prompt:n,n:a,size:r,aspectRatio:o,seed:s,files:i,mask:l,abortSignal:u,headers:b,providerOptions:v}=e,g=v?.openrouter||{},_=[];if(i!==void 0&&i.length>0)throw new ne({functionality:"image editing (files parameter)"});if(l!==void 0)throw new ne({functionality:"image inpainting (mask parameter)"});a>1&&_.push({type:"unsupported",feature:"n > 1",details:`OpenRouter image generation returns 1 image per call. Requested ${a} images.`}),r!==void 0&&_.push({type:"unsupported",feature:"size",details:"Use aspectRatio instead. Size parameter is not supported by OpenRouter image generation."});const w=o!==void 0?{aspect_ratio:o}:void 0,m=c(c(c(c(c(c(c({model:this.modelId,messages:[{role:"user",content:n??""}],modalities:["image","text"]},w!==void 0&&{image_config:w}),s!==void 0&&{seed:s}),this.settings.user!==void 0&&{user:this.settings.user}),this.settings.provider!==void 0&&{provider:this.settings.provider}),this.config.extraBody),this.settings.extraBody),g),{value:f,responseHeaders:h}=await he({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:me(this.config.headers(),b),body:m,failedResponseHandler:ve,successfulResponseHandler:$e(xr),abortSignal:u,fetch:this.config.fetch}),A=f.choices[0];if(!A)throw new Ve({message:"No choice in response"});const $=[];if((t=A.message)!=null&&t.images)for(const M of A.message.images){const k=M.image_url.url;$.push(Ie(k))}const B=f.usage?{inputTokens:f.usage.prompt_tokens,outputTokens:f.usage.completion_tokens,totalTokens:f.usage.total_tokens}:void 0;return{images:$,warnings:_,response:{timestamp:new Date,modelId:f.model,headers:h},usage:B}}};function Tr(e){return Object.fromEntries(Object.entries(e).filter(([,t])=>t!=null))}function Pr(e){return e?e instanceof Headers?Object.fromEntries(e.entries()):Array.isArray(e)?Object.fromEntries(e):e:{}}function Sr(e,t){const n=t.toLowerCase();return Object.keys(e).find(a=>a.toLowerCase()===n)}function Ar(e,...t){const n=Pr(e),a=Tr(n),r=Sr(a,"user-agent"),o=r?a[r]:void 0,s=o?.trim()?o:t.filter(Boolean).join(" "),i=Object.fromEntries(Object.entries(a).filter(([l])=>l.toLowerCase()!=="user-agent"));return S(c({},i),{"user-agent":s})}var Ir="2.1.1";function Rr(e={}){var t,n,a;const r=(n=dn((t=e.baseURL)!=null?t:e.baseUrl))!=null?n:"https://openrouter.ai/api/v1",o=(a=e.compatibility)!=null?a:"compatible",s=()=>Ar(c(c({Authorization:`Bearer ${an({apiKey:e.apiKey,environmentVariableName:"OPENROUTER_API_KEY",description:"OpenRouter"})}`},e.headers),e.api_keys&&Object.keys(e.api_keys).length>0&&{"X-Provider-API-Keys":JSON.stringify(e.api_keys)}),`ai-sdk/openrouter/${Ir}`),i=(_,w={})=>new _n(_,w,{provider:"openrouter.chat",url:({path:m})=>`${r}${m}`,headers:s,compatibility:o,fetch:e.fetch,extraBody:e.extraBody}),l=(_,w={})=>new yn(_,w,{provider:"openrouter.completion",url:({path:m})=>`${r}${m}`,headers:s,compatibility:o,fetch:e.fetch,extraBody:e.extraBody}),u=(_,w={})=>new bn(_,w,{provider:"openrouter.embedding",url:({path:m})=>`${r}${m}`,headers:s,fetch:e.fetch,extraBody:e.extraBody}),b=(_,w={})=>new Or(_,w,{provider:"openrouter.image",url:({path:m})=>`${r}${m}`,headers:s,fetch:e.fetch,extraBody:e.extraBody}),v=(_,w)=>{if(new.target)throw new Error("The OpenRouter model function cannot be called with the new keyword.");return _==="openai/gpt-3.5-turbo-instruct"?l(_,w):i(_,w)},g=(_,w)=>v(_,w);return g.languageModel=v,g.chat=i,g.completion=l,g.textEmbeddingModel=u,g.embedding=u,g.imageModel=b,g}var jr=Rr({compatibility:"strict"});export{Dr as OpenRouter,Rr as createOpenRouter,jr as openrouter};
